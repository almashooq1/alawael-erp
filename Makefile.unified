# ğŸš€ AlAwael ERP - Makefile
# Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯

.PHONY: help install start stop test clean docker-up docker-down cleanup

# ============================================
# Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
# ============================================
NODE_ENV ?= development
PORT ?= 3000

# ============================================
# Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
# ============================================
help:
	@echo "ğŸ¯ AlAwael ERP - Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:"
	@echo ""
	@echo "  make install     - ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…"
	@echo "  make start       - ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…"
	@echo "  make dev         - ØªØ´ØºÙŠÙ„ Ù„Ù„ØªØ·ÙˆÙŠØ±"
	@echo "  make test        - ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª"
	@echo "  make clean       - ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©"
	@echo "  make cleanup     - ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©"
	@echo "  make docker-up   - ØªØ´ØºÙŠÙ„ Docker"
	@echo "  make docker-down - Ø¥ÙŠÙ‚Ø§Ù Docker"
	@echo "  make logs        - Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª"
	@echo ""

# ============================================
# Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„ØªØ´ØºÙŠÙ„
# ============================================
install:
	cd backend && npm install

start:
	cd backend && node index.unified.js

dev:
	cd backend && npx nodemon index.unified.js

# ============================================
# Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
# ============================================
test:
	cd backend && npm test

test-coverage:
	cd backend && npm test -- --coverage

# ============================================
# Docker
# ============================================
docker-up:
	docker-compose -f docker-compose.unified.yml up -d

docker-down:
	docker-compose -f docker-compose.unified.yml down

docker-logs:
	docker-compose -f docker-compose.unified.yml logs -f

docker-build:
	docker-compose -f docker-compose.unified.yml build

# ============================================
# Ø§Ù„ØªÙ†Ø¸ÙŠÙ
# ============================================
clean:
	rm -rf node_modules
	rm -rf backend/node_modules
	rm -rf coverage
	rm -rf .nyc_output

cleanup:
	node CLEANUP_DUPLICATES.js

cleanup-live:
	DRY_RUN=false node CLEANUP_DUPLICATES.js

# ============================================
# Ø§Ù„Ø³Ø¬Ù„Ø§Øª
# ============================================
logs:
	tail -f backend/logs/app.log

# ============================================
# Ø§Ù„Ø¨ÙŠØ¦Ø©
# ============================================
env:
	cp backend/.env.unified.example backend/.env
	@echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .env - Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„Ù‡"
