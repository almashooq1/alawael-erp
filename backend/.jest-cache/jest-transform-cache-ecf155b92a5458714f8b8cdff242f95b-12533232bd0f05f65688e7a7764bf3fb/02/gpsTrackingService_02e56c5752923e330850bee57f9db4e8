a1012fedcd26347bdd54410a425e6e5b
/**
 * GPS Tracking Service
 * خدمات تتبع GPS المتقدمة
 */

const GPSLocation = require('../models/GPSLocation');
const Driver = require('../models/Driver');
class GPSTrackingService {
  /**
   * تسجيل موقع جديد
   */
  static async recordLocation(driverId, locationData) {
    try {
      const {
        coordinates,
        speed,
        heading,
        altitude,
        accuracy,
        satellites,
        acceleration,
        seatbeltStatus,
        engineRunning
      } = locationData;

      // التحقق من وجود السائق
      const driver = await Driver.findById(driverId);
      if (!driver) {
        throw new Error('السائق غير موجود');
      }

      // إنشاء موقع جديد
      const location = new GPSLocation({
        driver: driverId,
        location: {
          type: 'Point',
          coordinates: [coordinates.longitude, coordinates.latitude]
        },
        speed,
        heading,
        altitude,
        accuracy,
        satellites,
        acceleration,
        seatbeltStatus,
        engineRunning
      });

      // التحقق من انتهاكات
      const violations = this.checkViolations(location);

      // إضافة التنبيهات
      if (violations.length > 0) {
        location.alerts = violations;
      }

      // حفظ الموقع
      await location.save();

      // تحديث آخر موقع معروف للسائق
      driver.lastKnownLocation = {
        coordinates: [coordinates.longitude, coordinates.latitude],
        timestamp: new Date(),
        speed
      };
      await driver.save();
      return location;
    } catch (error) {
      console.error('خطأ في تسجيل الموقع:', error);
      throw error;
    }
  }

  /**
   * التحقق من الانتهاكات والتنبيهات
   */
  static checkViolations(location) {
    const violations = [];

    // 1. فحص انتهاك السرعة
    if (location.speed > location.maxSpeedAllowed) {
      violations.push({
        type: 'speeding',
        severity: location.speed > location.maxSpeedAllowed * 1.5 ? 'critical' : 'high',
        message: `تجاوز السرعة: ${location.speed} كم/س (الحد: ${location.maxSpeedAllowed} كم/س)`
      });
    }

    // 2. فحص التسارع الحاد
    if (location.acceleration) {
      const totalAccel = Math.sqrt(location.acceleration.x ** 2 + location.acceleration.y ** 2 + location.acceleration.z ** 2);
      if (totalAccel > 0.5) {
        violations.push({
          type: 'harsh_acceleration',
          severity: 'medium',
          message: `تسارع حاد: ${totalAccel.toFixed(2)} G`
        });
      }
    }

    // 3. فحص حزام الأمان
    if (location.seatbeltStatus === 'unfastened' && location.engineRunning) {
      violations.push({
        type: 'seatbelt_unbuckled',
        severity: 'high',
        message: 'حزام الأمان غير مثبت'
      });
    }
    return violations;
  }

  /**
   * الحصول على الموقع الحالي
   */
  static async getCurrentLocation(driverId) {
    try {
      return await GPSLocation.getLatestLocation(driverId);
    } catch (error) {
      console.error('خطأ في جلب الموقع الحالي:', error);
      throw error;
    }
  }

  /**
   * الحصول على خريطة المسار
   */
  static async getRouteMap(driverId, startTime, endTime) {
    try {
      const locations = await GPSLocation.getLocationsInTimeRange(driverId, startTime, endTime);
      if (locations.length === 0) {
        return null;
      }

      // حساب المسافة الكلية
      let totalDistance = 0;
      for (let i = 0; i < locations.length - 1; i++) {
        totalDistance += locations[i].getDistanceTo(locations[i + 1]);
      }

      // حساب متوسط السرعة
      const avgSpeed = locations.reduce((acc, loc) => acc + loc.speed, 0) / locations.length;
      return {
        locations: locations.map(loc => ({
          lat: loc.lat,
          lon: loc.lon,
          speed: loc.speed,
          timestamp: loc.timestamp
        })),
        stats: {
          totalDistance: totalDistance.toFixed(2),
          averageSpeed: avgSpeed.toFixed(2),
          maxSpeed: Math.max(...locations.map(l => l.speed)),
          duration: (locations[locations.length - 1].timestamp - locations[0].timestamp) / 1000 / 60,
          pointCount: locations.length
        }
      };
    } catch (error) {
      console.error('خطأ في جلب خريطة المسار:', error);
      throw error;
    }
  }

  /**
   * الحصول على تقرير السلوك
   */
  static async getBehaviorReport(driverId, startTime, endTime) {
    try {
      const locations = await GPSLocation.getLocationsInTimeRange(driverId, startTime, endTime);
      if (locations.length === 0) {
        throw new Error('لا توجد بيانات علمية');
      }

      // حساب الإحصائيات
      const speedViolations = locations.filter(l => l.speedLimitViolation).length;
      const harshAccelerations = locations.filter(l => l.harshAcceleration).length;
      const harshBrakings = locations.filter(l => l.harshBraking).length;
      const sharpTurns = locations.filter(l => l.sharpTurn).length;

      // حساب درجة السلوك
      const baseScore = 100;
      const penalties = {
        speedViolation: speedViolations * 2,
        harshAcceleration: harshAccelerations * 1,
        harshBraking: harshBrakings * 1,
        sharpTurn: sharpTurns * 1.5
      };
      const totalPenalty = Object.values(penalties).reduce((a, b) => a + b, 0);
      const behaviorScore = Math.max(0, 100 - totalPenalty);
      return {
        score: behaviorScore,
        grading: this.getGradeFromScore(behaviorScore),
        violations: {
          speeding: speedViolations,
          harshAcceleration: harshAccelerations,
          harshBraking: harshBrakings,
          sharpTurn: sharpTurns
        },
        recommendations: this.generateRecommendations(behaviorScore, penalties),
        summary: `السائق لديه سلوك ${this.getGradeFromScore(behaviorScore)} على الطريق`
      };
    } catch (error) {
      console.error('خطأ في جلب تقرير السلوك:', error);
      throw error;
    }
  }

  /**
   * الحصول على درجة من النقاط
   */
  static getGradeFromScore(score) {
    if (score >= 90) return 'ممتاز';
    if (score >= 80) return 'جيد جداً';
    if (score >= 70) return 'جيد';
    if (score >= 60) return 'مقبول';
    return 'ضعيف';
  }

  /**
   * توليد توصيات التحسين
   */
  static generateRecommendations(score, penalties) {
    const recommendations = [];
    if (penalties.speedViolation > 0) {
      recommendations.push('التزم بحدود السرعة المقررة');
    }
    if (penalties.harshAcceleration > 0) {
      recommendations.push('تجنب التسارع المفاجئ');
    }
    if (penalties.harshBraking > 0) {
      recommendations.push('قم بالكبح بسلاسة وتدرج');
    }
    if (penalties.sharpTurn > 0) {
      recommendations.push('خذ المنعطفات بحذر وببطء');
    }
    if (score < 60) {
      recommendations.push('يُنصح بحضور برنامج تدريب السلامة');
    }
    return recommendations;
  }

  /**
   * البحث عن السائقين بالقرب من موقع
   */
  static async findNearbyDrivers(longitude, latitude, maxDistance = 1000) {
    try {
      return await GPSLocation.findNearby(longitude, latitude, maxDistance);
    } catch (error) {
      console.error('خطأ في البحث عن السائقين:', error);
      throw error;
    }
  }

  /**
   * الحصول على إحصائيات الأسطول
   */
  static async getFleetStatistics(driverId = null, timeRange = 'today') {
    try {
      const now = new Date();
      let startTime = new Date();

      // تحديد نطاق الوقت
      if (timeRange === 'today') {
        startTime.setHours(0, 0, 0, 0);
      } else if (timeRange === 'week') {
        startTime.setDate(now.getDate() - 7);
      } else if (timeRange === 'month') {
        startTime.setMonth(now.getMonth() - 1);
      }
      let query = {
        timestamp: {
          $gte: startTime,
          $lte: now
        }
      };
      if (driverId) {
        query.driver = driverId;
      }

      // حساب الإحصائيات
      const locations = await GPSLocation.find(query);
      const avgSpeed = await GPSLocation.getAverageSpeed(driverId, startTime, now);
      return {
        totalLocationsTracked: locations.length,
        totalActiveDrivers: new Set(locations.map(l => l.driver)).size,
        averageSpeed: avgSpeed?.averageSpeed?.toFixed(2) || 0,
        maxSpeed: avgSpeed?.maxSpeed || 0,
        speedViolations: locations.filter(l => l.speedLimitViolation).length,
        totalDistance: locations.reduce((acc, loc) => acc + (loc.distanceDriven || 0), 0).toFixed(2),
        timeRange
      };
    } catch (error) {
      console.error('خطأ في جلب إحصائيات الأسطول:', error);
      throw error;
    }
  }
}
module.exports = GPSTrackingService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHUFNMb2NhdGlvbiIsInJlcXVpcmUiLCJEcml2ZXIiLCJHUFNUcmFja2luZ1NlcnZpY2UiLCJyZWNvcmRMb2NhdGlvbiIsImRyaXZlcklkIiwibG9jYXRpb25EYXRhIiwiY29vcmRpbmF0ZXMiLCJzcGVlZCIsImhlYWRpbmciLCJhbHRpdHVkZSIsImFjY3VyYWN5Iiwic2F0ZWxsaXRlcyIsImFjY2VsZXJhdGlvbiIsInNlYXRiZWx0U3RhdHVzIiwiZW5naW5lUnVubmluZyIsImRyaXZlciIsImZpbmRCeUlkIiwiRXJyb3IiLCJsb2NhdGlvbiIsInR5cGUiLCJsb25naXR1ZGUiLCJsYXRpdHVkZSIsInZpb2xhdGlvbnMiLCJjaGVja1Zpb2xhdGlvbnMiLCJsZW5ndGgiLCJhbGVydHMiLCJzYXZlIiwibGFzdEtub3duTG9jYXRpb24iLCJ0aW1lc3RhbXAiLCJEYXRlIiwiZXJyb3IiLCJjb25zb2xlIiwibWF4U3BlZWRBbGxvd2VkIiwicHVzaCIsInNldmVyaXR5IiwibWVzc2FnZSIsInRvdGFsQWNjZWwiLCJNYXRoIiwic3FydCIsIngiLCJ5IiwieiIsInRvRml4ZWQiLCJnZXRDdXJyZW50TG9jYXRpb24iLCJnZXRMYXRlc3RMb2NhdGlvbiIsImdldFJvdXRlTWFwIiwic3RhcnRUaW1lIiwiZW5kVGltZSIsImxvY2F0aW9ucyIsImdldExvY2F0aW9uc0luVGltZVJhbmdlIiwidG90YWxEaXN0YW5jZSIsImkiLCJnZXREaXN0YW5jZVRvIiwiYXZnU3BlZWQiLCJyZWR1Y2UiLCJhY2MiLCJsb2MiLCJtYXAiLCJsYXQiLCJsb24iLCJzdGF0cyIsImF2ZXJhZ2VTcGVlZCIsIm1heFNwZWVkIiwibWF4IiwibCIsImR1cmF0aW9uIiwicG9pbnRDb3VudCIsImdldEJlaGF2aW9yUmVwb3J0Iiwic3BlZWRWaW9sYXRpb25zIiwiZmlsdGVyIiwic3BlZWRMaW1pdFZpb2xhdGlvbiIsImhhcnNoQWNjZWxlcmF0aW9ucyIsImhhcnNoQWNjZWxlcmF0aW9uIiwiaGFyc2hCcmFraW5ncyIsImhhcnNoQnJha2luZyIsInNoYXJwVHVybnMiLCJzaGFycFR1cm4iLCJiYXNlU2NvcmUiLCJwZW5hbHRpZXMiLCJzcGVlZFZpb2xhdGlvbiIsInRvdGFsUGVuYWx0eSIsIk9iamVjdCIsInZhbHVlcyIsImEiLCJiIiwiYmVoYXZpb3JTY29yZSIsInNjb3JlIiwiZ3JhZGluZyIsImdldEdyYWRlRnJvbVNjb3JlIiwic3BlZWRpbmciLCJyZWNvbW1lbmRhdGlvbnMiLCJnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyIsInN1bW1hcnkiLCJmaW5kTmVhcmJ5RHJpdmVycyIsIm1heERpc3RhbmNlIiwiZmluZE5lYXJieSIsImdldEZsZWV0U3RhdGlzdGljcyIsInRpbWVSYW5nZSIsIm5vdyIsInNldEhvdXJzIiwic2V0RGF0ZSIsImdldERhdGUiLCJzZXRNb250aCIsImdldE1vbnRoIiwicXVlcnkiLCIkZ3RlIiwiJGx0ZSIsImZpbmQiLCJnZXRBdmVyYWdlU3BlZWQiLCJ0b3RhbExvY2F0aW9uc1RyYWNrZWQiLCJ0b3RhbEFjdGl2ZURyaXZlcnMiLCJTZXQiLCJzaXplIiwiZGlzdGFuY2VEcml2ZW4iLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiZ3BzVHJhY2tpbmdTZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBHUFMgVHJhY2tpbmcgU2VydmljZVxyXG4gKiDYrtiv2YXYp9iqINiq2KrYqNi5IEdQUyDYp9mE2YXYqtmC2K/ZhdipXHJcbiAqL1xyXG5cclxuY29uc3QgR1BTTG9jYXRpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvR1BTTG9jYXRpb24nKTtcclxuY29uc3QgRHJpdmVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL0RyaXZlcicpO1xyXG5cclxuY2xhc3MgR1BTVHJhY2tpbmdTZXJ2aWNlIHtcclxuICAvKipcclxuICAgKiDYqtiz2KzZitmEINmF2YjZgti5INis2K/ZitivXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHJlY29yZExvY2F0aW9uKGRyaXZlcklkLCBsb2NhdGlvbkRhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHtcclxuICAgICAgICBjb29yZGluYXRlcyxcclxuICAgICAgICBzcGVlZCxcclxuICAgICAgICBoZWFkaW5nLFxyXG4gICAgICAgIGFsdGl0dWRlLFxyXG4gICAgICAgIGFjY3VyYWN5LFxyXG4gICAgICAgIHNhdGVsbGl0ZXMsXHJcbiAgICAgICAgYWNjZWxlcmF0aW9uLFxyXG4gICAgICAgIHNlYXRiZWx0U3RhdHVzLFxyXG4gICAgICAgIGVuZ2luZVJ1bm5pbmcsXHJcbiAgICAgIH0gPSBsb2NhdGlvbkRhdGE7XHJcblxyXG4gICAgICAvLyDYp9mE2KrYrdmC2YIg2YXZhiDZiNis2YjYryDYp9mE2LPYp9im2YJcclxuICAgICAgY29uc3QgZHJpdmVyID0gYXdhaXQgRHJpdmVyLmZpbmRCeUlkKGRyaXZlcklkKTtcclxuICAgICAgaWYgKCFkcml2ZXIpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9in2YTYs9in2KbZgiDYutmK2LEg2YXZiNis2YjYrycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDYpdmG2LTYp9ihINmF2YjZgti5INis2K/ZitivXHJcbiAgICAgIGNvbnN0IGxvY2F0aW9uID0gbmV3IEdQU0xvY2F0aW9uKHtcclxuICAgICAgICBkcml2ZXI6IGRyaXZlcklkLFxyXG4gICAgICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgICB0eXBlOiAnUG9pbnQnLFxyXG4gICAgICAgICAgY29vcmRpbmF0ZXM6IFtjb29yZGluYXRlcy5sb25naXR1ZGUsIGNvb3JkaW5hdGVzLmxhdGl0dWRlXSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNwZWVkLFxyXG4gICAgICAgIGhlYWRpbmcsXHJcbiAgICAgICAgYWx0aXR1ZGUsXHJcbiAgICAgICAgYWNjdXJhY3ksXHJcbiAgICAgICAgc2F0ZWxsaXRlcyxcclxuICAgICAgICBhY2NlbGVyYXRpb24sXHJcbiAgICAgICAgc2VhdGJlbHRTdGF0dXMsXHJcbiAgICAgICAgZW5naW5lUnVubmluZyxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyDYp9mE2KrYrdmC2YIg2YXZhiDYp9mG2KrZh9in2YPYp9iqXHJcbiAgICAgIGNvbnN0IHZpb2xhdGlvbnMgPSB0aGlzLmNoZWNrVmlvbGF0aW9ucyhsb2NhdGlvbik7XHJcblxyXG4gICAgICAvLyDYpdi22KfZgdipINin2YTYqtmG2KjZitmH2KfYqlxyXG4gICAgICBpZiAodmlvbGF0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbG9jYXRpb24uYWxlcnRzID0gdmlvbGF0aW9ucztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g2K3Zgdi4INin2YTZhdmI2YLYuVxyXG4gICAgICBhd2FpdCBsb2NhdGlvbi5zYXZlKCk7XHJcblxyXG4gICAgICAvLyDYqtit2K/ZitirINii2K7YsSDZhdmI2YLYuSDZhdi52LHZiNmBINmE2YTYs9in2KbZglxyXG4gICAgICBkcml2ZXIubGFzdEtub3duTG9jYXRpb24gPSB7XHJcbiAgICAgICAgY29vcmRpbmF0ZXM6IFtjb29yZGluYXRlcy5sb25naXR1ZGUsIGNvb3JkaW5hdGVzLmxhdGl0dWRlXSxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgc3BlZWQsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhd2FpdCBkcml2ZXIuc2F2ZSgpO1xyXG5cclxuICAgICAgcmV0dXJuIGxvY2F0aW9uO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign2K7Yt9ijINmB2Yog2KrYs9is2YrZhCDYp9mE2YXZiNmC2Lk6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYqtit2YLZgiDZhdmGINin2YTYp9mG2KrZh9in2YPYp9iqINmI2KfZhNiq2YbYqNmK2YfYp9iqXHJcbiAgICovXHJcbiAgc3RhdGljIGNoZWNrVmlvbGF0aW9ucyhsb2NhdGlvbikge1xyXG4gICAgY29uc3QgdmlvbGF0aW9ucyA9IFtdO1xyXG5cclxuICAgIC8vIDEuINmB2K3YtSDYp9mG2KrZh9in2YMg2KfZhNiz2LHYudipXHJcbiAgICBpZiAobG9jYXRpb24uc3BlZWQgPiBsb2NhdGlvbi5tYXhTcGVlZEFsbG93ZWQpIHtcclxuICAgICAgdmlvbGF0aW9ucy5wdXNoKHtcclxuICAgICAgICB0eXBlOiAnc3BlZWRpbmcnLFxyXG4gICAgICAgIHNldmVyaXR5OiBsb2NhdGlvbi5zcGVlZCA+IGxvY2F0aW9uLm1heFNwZWVkQWxsb3dlZCAqIDEuNSA/ICdjcml0aWNhbCcgOiAnaGlnaCcsXHJcbiAgICAgICAgbWVzc2FnZTogYNiq2KzYp9mI2LIg2KfZhNiz2LHYudipOiAke2xvY2F0aW9uLnNwZWVkfSDZg9mFL9izICjYp9mE2K3YrzogJHtsb2NhdGlvbi5tYXhTcGVlZEFsbG93ZWR9INmD2YUv2LMpYCxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMi4g2YHYrdi1INin2YTYqtiz2KfYsdi5INin2YTYrdin2K9cclxuICAgIGlmIChsb2NhdGlvbi5hY2NlbGVyYXRpb24pIHtcclxuICAgICAgY29uc3QgdG90YWxBY2NlbCA9IE1hdGguc3FydChcclxuICAgICAgICBsb2NhdGlvbi5hY2NlbGVyYXRpb24ueCAqKiAyICtcclxuICAgICAgICAgIGxvY2F0aW9uLmFjY2VsZXJhdGlvbi55ICoqIDIgK1xyXG4gICAgICAgICAgbG9jYXRpb24uYWNjZWxlcmF0aW9uLnogKiogMlxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKHRvdGFsQWNjZWwgPiAwLjUpIHtcclxuICAgICAgICB2aW9sYXRpb25zLnB1c2goe1xyXG4gICAgICAgICAgdHlwZTogJ2hhcnNoX2FjY2VsZXJhdGlvbicsXHJcbiAgICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXHJcbiAgICAgICAgICBtZXNzYWdlOiBg2KrYs9in2LHYuSDYrdin2K86ICR7dG90YWxBY2NlbC50b0ZpeGVkKDIpfSBHYCxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIDMuINmB2K3YtSDYrdiy2KfZhSDYp9mE2KPZhdin2YZcclxuICAgIGlmIChsb2NhdGlvbi5zZWF0YmVsdFN0YXR1cyA9PT0gJ3VuZmFzdGVuZWQnICYmIGxvY2F0aW9uLmVuZ2luZVJ1bm5pbmcpIHtcclxuICAgICAgdmlvbGF0aW9ucy5wdXNoKHtcclxuICAgICAgICB0eXBlOiAnc2VhdGJlbHRfdW5idWNrbGVkJyxcclxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfYrdiy2KfZhSDYp9mE2KPZhdin2YYg2LrZitixINmF2KvYqNiqJyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHZpb2xhdGlvbnM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINin2YTZhdmI2YLYuSDYp9mE2K3Yp9mE2YpcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0Q3VycmVudExvY2F0aW9uKGRyaXZlcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gYXdhaXQgR1BTTG9jYXRpb24uZ2V0TGF0ZXN0TG9jYXRpb24oZHJpdmVySWQpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign2K7Yt9ijINmB2Yog2KzZhNioINin2YTZhdmI2YLYuSDYp9mE2K3Yp9mE2Yo6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2K7YsdmK2LfYqSDYp9mE2YXYs9in2LFcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0Um91dGVNYXAoZHJpdmVySWQsIHN0YXJ0VGltZSwgZW5kVGltZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgbG9jYXRpb25zID0gYXdhaXQgR1BTTG9jYXRpb24uZ2V0TG9jYXRpb25zSW5UaW1lUmFuZ2UoXHJcbiAgICAgICAgZHJpdmVySWQsXHJcbiAgICAgICAgc3RhcnRUaW1lLFxyXG4gICAgICAgIGVuZFRpbWVcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGlmIChsb2NhdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINit2LPYp9ioINin2YTZhdiz2KfZgdipINin2YTZg9mE2YrYqVxyXG4gICAgICBsZXQgdG90YWxEaXN0YW5jZSA9IDA7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9jYXRpb25zLmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgIHRvdGFsRGlzdGFuY2UgKz0gbG9jYXRpb25zW2ldLmdldERpc3RhbmNlVG8obG9jYXRpb25zW2kgKyAxXSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINit2LPYp9ioINmF2KrZiNiz2Lcg2KfZhNiz2LHYudipXHJcbiAgICAgIGNvbnN0IGF2Z1NwZWVkID0gbG9jYXRpb25zLnJlZHVjZSgoYWNjLCBsb2MpID0+IGFjYyArIGxvYy5zcGVlZCwgMCkgLyBsb2NhdGlvbnMubGVuZ3RoO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBsb2NhdGlvbnM6IGxvY2F0aW9ucy5tYXAoKGxvYykgPT4gKHtcclxuICAgICAgICAgIGxhdDogbG9jLmxhdCxcclxuICAgICAgICAgIGxvbjogbG9jLmxvbixcclxuICAgICAgICAgIHNwZWVkOiBsb2Muc3BlZWQsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IGxvYy50aW1lc3RhbXAsXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICAgIHN0YXRzOiB7XHJcbiAgICAgICAgICB0b3RhbERpc3RhbmNlOiB0b3RhbERpc3RhbmNlLnRvRml4ZWQoMiksXHJcbiAgICAgICAgICBhdmVyYWdlU3BlZWQ6IGF2Z1NwZWVkLnRvRml4ZWQoMiksXHJcbiAgICAgICAgICBtYXhTcGVlZDogTWF0aC5tYXgoLi4ubG9jYXRpb25zLm1hcCgobCkgPT4gbC5zcGVlZCkpLFxyXG4gICAgICAgICAgZHVyYXRpb246IChsb2NhdGlvbnNbbG9jYXRpb25zLmxlbmd0aCAtIDFdLnRpbWVzdGFtcCAtIGxvY2F0aW9uc1swXS50aW1lc3RhbXApIC8gMTAwMCAvIDYwLFxyXG4gICAgICAgICAgcG9pbnRDb3VudDogbG9jYXRpb25zLmxlbmd0aCxcclxuICAgICAgICB9LFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign2K7Yt9ijINmB2Yog2KzZhNioINiu2LHZiti32Kkg2KfZhNmF2LPYp9ixOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINiq2YLYsdmK2LEg2KfZhNiz2YTZiNmDXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldEJlaGF2aW9yUmVwb3J0KGRyaXZlcklkLCBzdGFydFRpbWUsIGVuZFRpbWUpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGxvY2F0aW9ucyA9IGF3YWl0IEdQU0xvY2F0aW9uLmdldExvY2F0aW9uc0luVGltZVJhbmdlKFxyXG4gICAgICAgIGRyaXZlcklkLFxyXG4gICAgICAgIHN0YXJ0VGltZSxcclxuICAgICAgICBlbmRUaW1lXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBpZiAobG9jYXRpb25zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcign2YTYpyDYqtmI2KzYryDYqNmK2KfZhtin2Kog2LnZhNmF2YrYqScpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDYrdiz2KfYqCDYp9mE2KXYrdi12KfYptmK2KfYqlxyXG4gICAgICBjb25zdCBzcGVlZFZpb2xhdGlvbnMgPSBsb2NhdGlvbnMuZmlsdGVyKChsKSA9PiBsLnNwZWVkTGltaXRWaW9sYXRpb24pLmxlbmd0aDtcclxuICAgICAgY29uc3QgaGFyc2hBY2NlbGVyYXRpb25zID0gbG9jYXRpb25zLmZpbHRlcigobCkgPT4gbC5oYXJzaEFjY2VsZXJhdGlvbikubGVuZ3RoO1xyXG4gICAgICBjb25zdCBoYXJzaEJyYWtpbmdzID0gbG9jYXRpb25zLmZpbHRlcigobCkgPT4gbC5oYXJzaEJyYWtpbmcpLmxlbmd0aDtcclxuICAgICAgY29uc3Qgc2hhcnBUdXJucyA9IGxvY2F0aW9ucy5maWx0ZXIoKGwpID0+IGwuc2hhcnBUdXJuKS5sZW5ndGg7XHJcblxyXG4gICAgICAvLyDYrdiz2KfYqCDYr9ix2KzYqSDYp9mE2LPZhNmI2YNcclxuICAgICAgY29uc3QgYmFzZVNjb3JlID0gMTAwO1xyXG4gICAgICBjb25zdCBwZW5hbHRpZXMgPSB7XHJcbiAgICAgICAgc3BlZWRWaW9sYXRpb246IHNwZWVkVmlvbGF0aW9ucyAqIDIsXHJcbiAgICAgICAgaGFyc2hBY2NlbGVyYXRpb246IGhhcnNoQWNjZWxlcmF0aW9ucyAqIDEsXHJcbiAgICAgICAgaGFyc2hCcmFraW5nOiBoYXJzaEJyYWtpbmdzICogMSxcclxuICAgICAgICBzaGFycFR1cm46IHNoYXJwVHVybnMgKiAxLjUsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCB0b3RhbFBlbmFsdHkgPSBPYmplY3QudmFsdWVzKHBlbmFsdGllcykucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCk7XHJcbiAgICAgIGNvbnN0IGJlaGF2aW9yU2NvcmUgPSBNYXRoLm1heCgwLCAxMDAgLSB0b3RhbFBlbmFsdHkpO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzY29yZTogYmVoYXZpb3JTY29yZSxcclxuICAgICAgICBncmFkaW5nOiB0aGlzLmdldEdyYWRlRnJvbVNjb3JlKGJlaGF2aW9yU2NvcmUpLFxyXG4gICAgICAgIHZpb2xhdGlvbnM6IHtcclxuICAgICAgICAgIHNwZWVkaW5nOiBzcGVlZFZpb2xhdGlvbnMsXHJcbiAgICAgICAgICBoYXJzaEFjY2VsZXJhdGlvbjogaGFyc2hBY2NlbGVyYXRpb25zLFxyXG4gICAgICAgICAgaGFyc2hCcmFraW5nOiBoYXJzaEJyYWtpbmdzLFxyXG4gICAgICAgICAgc2hhcnBUdXJuOiBzaGFycFR1cm5zLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiB0aGlzLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKGJlaGF2aW9yU2NvcmUsIHBlbmFsdGllcyksXHJcbiAgICAgICAgc3VtbWFyeTogYNin2YTYs9in2KbZgiDZhNiv2YrZhyDYs9mE2YjZgyAke3RoaXMuZ2V0R3JhZGVGcm9tU2NvcmUoYmVoYXZpb3JTY29yZSl9INi52YTZiSDYp9mE2LfYsdmK2YJgLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign2K7Yt9ijINmB2Yog2KzZhNioINiq2YLYsdmK2LEg2KfZhNiz2YTZiNmDOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINiv2LHYrNipINmF2YYg2KfZhNmG2YLYp9i3XHJcbiAgICovXHJcbiAgc3RhdGljIGdldEdyYWRlRnJvbVNjb3JlKHNjb3JlKSB7XHJcbiAgICBpZiAoc2NvcmUgPj0gOTApIHJldHVybiAn2YXZhdiq2KfYsic7XHJcbiAgICBpZiAoc2NvcmUgPj0gODApIHJldHVybiAn2KzZitivINis2K/Yp9mLJztcclxuICAgIGlmIChzY29yZSA+PSA3MCkgcmV0dXJuICfYrNmK2K8nO1xyXG4gICAgaWYgKHNjb3JlID49IDYwKSByZXR1cm4gJ9mF2YLYqNmI2YQnO1xyXG4gICAgcmV0dXJuICfYtti52YrZgSc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtmI2YTZitivINiq2YjYtdmK2KfYqiDYp9mE2KrYrdiz2YrZhlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhzY29yZSwgcGVuYWx0aWVzKSB7XHJcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBbXTtcclxuXHJcbiAgICBpZiAocGVuYWx0aWVzLnNwZWVkVmlvbGF0aW9uID4gMCkge1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgn2KfZhNiq2LLZhSDYqNit2K/ZiNivINin2YTYs9ix2LnYqSDYp9mE2YXZgtix2LHYqScpO1xyXG4gICAgfVxyXG4gICAgaWYgKHBlbmFsdGllcy5oYXJzaEFjY2VsZXJhdGlvbiA+IDApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ9iq2KzZhtioINin2YTYqtiz2KfYsdi5INin2YTZhdmB2KfYrNimJyk7XHJcbiAgICB9XHJcbiAgICBpZiAocGVuYWx0aWVzLmhhcnNoQnJha2luZyA+IDApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ9mC2YUg2KjYp9mE2YPYqNitINio2LPZhNin2LPYqSDZiNiq2K/YsdisJyk7XHJcbiAgICB9XHJcbiAgICBpZiAocGVuYWx0aWVzLnNoYXJwVHVybiA+IDApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ9iu2LAg2KfZhNmF2YbYudi32YHYp9iqINio2K3YsNixINmI2KjYqNi32KEnKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc2NvcmUgPCA2MCkge1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgn2YrZj9mG2LXYrSDYqNit2LbZiNixINio2LHZhtin2YXYrCDYqtiv2LHZitioINin2YTYs9mE2KfZhdipJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYqNit2Ksg2LnZhiDYp9mE2LPYp9im2YLZitmGINio2KfZhNmC2LHYqCDZhdmGINmF2YjZgti5XHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGZpbmROZWFyYnlEcml2ZXJzKGxvbmdpdHVkZSwgbGF0aXR1ZGUsIG1heERpc3RhbmNlID0gMTAwMCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IEdQU0xvY2F0aW9uLmZpbmROZWFyYnkobG9uZ2l0dWRlLCBsYXRpdHVkZSwgbWF4RGlzdGFuY2UpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign2K7Yt9ijINmB2Yog2KfZhNio2K3YqyDYudmGINin2YTYs9in2KbZgtmK2YY6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2KXYrdi12KfYptmK2KfYqiDYp9mE2KPYs9i32YjZhFxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBnZXRGbGVldFN0YXRpc3RpY3MoZHJpdmVySWQgPSBudWxsLCB0aW1lUmFuZ2UgPSAndG9kYXknKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICBsZXQgc3RhcnRUaW1lID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICAgIC8vINiq2K3Yr9mK2K8g2YbYt9in2YIg2KfZhNmI2YLYqlxyXG4gICAgICBpZiAodGltZVJhbmdlID09PSAndG9kYXknKSB7XHJcbiAgICAgICAgc3RhcnRUaW1lLnNldEhvdXJzKDAsIDAsIDAsIDApO1xyXG4gICAgICB9IGVsc2UgaWYgKHRpbWVSYW5nZSA9PT0gJ3dlZWsnKSB7XHJcbiAgICAgICAgc3RhcnRUaW1lLnNldERhdGUobm93LmdldERhdGUoKSAtIDcpO1xyXG4gICAgICB9IGVsc2UgaWYgKHRpbWVSYW5nZSA9PT0gJ21vbnRoJykge1xyXG4gICAgICAgIHN0YXJ0VGltZS5zZXRNb250aChub3cuZ2V0TW9udGgoKSAtIDEpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgcXVlcnkgPSB7IHRpbWVzdGFtcDogeyAkZ3RlOiBzdGFydFRpbWUsICRsdGU6IG5vdyB9IH07XHJcbiAgICAgIGlmIChkcml2ZXJJZCkge1xyXG4gICAgICAgIHF1ZXJ5LmRyaXZlciA9IGRyaXZlcklkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDYrdiz2KfYqCDYp9mE2KXYrdi12KfYptmK2KfYqlxyXG4gICAgICBjb25zdCBsb2NhdGlvbnMgPSBhd2FpdCBHUFNMb2NhdGlvbi5maW5kKHF1ZXJ5KTtcclxuICAgICAgY29uc3QgYXZnU3BlZWQgPSBhd2FpdCBHUFNMb2NhdGlvbi5nZXRBdmVyYWdlU3BlZWQoZHJpdmVySWQsIHN0YXJ0VGltZSwgbm93KTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdG90YWxMb2NhdGlvbnNUcmFja2VkOiBsb2NhdGlvbnMubGVuZ3RoLFxyXG4gICAgICAgIHRvdGFsQWN0aXZlRHJpdmVyczogbmV3IFNldChsb2NhdGlvbnMubWFwKChsKSA9PiBsLmRyaXZlcikpLnNpemUsXHJcbiAgICAgICAgYXZlcmFnZVNwZWVkOiBhdmdTcGVlZD8uYXZlcmFnZVNwZWVkPy50b0ZpeGVkKDIpIHx8IDAsXHJcbiAgICAgICAgbWF4U3BlZWQ6IGF2Z1NwZWVkPy5tYXhTcGVlZCB8fCAwLFxyXG4gICAgICAgIHNwZWVkVmlvbGF0aW9uczogbG9jYXRpb25zLmZpbHRlcigobCkgPT4gbC5zcGVlZExpbWl0VmlvbGF0aW9uKS5sZW5ndGgsXHJcbiAgICAgICAgdG90YWxEaXN0YW5jZTogbG9jYXRpb25zLnJlZHVjZSgoYWNjLCBsb2MpID0+IGFjYyArIChsb2MuZGlzdGFuY2VEcml2ZW4gfHwgMCksIDApLnRvRml4ZWQoMiksXHJcbiAgICAgICAgdGltZVJhbmdlLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign2K7Yt9ijINmB2Yog2KzZhNioINil2K3Ytdin2KbZitin2Kog2KfZhNij2LPYt9mI2YQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gR1BTVHJhY2tpbmdTZXJ2aWNlO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLFdBQVcsR0FBR0MsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQ3BELE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBRTFDLE1BQU1FLGtCQUFrQixDQUFDO0VBQ3ZCO0FBQ0Y7QUFDQTtFQUNFLGFBQWFDLGNBQWNBLENBQUNDLFFBQVEsRUFBRUMsWUFBWSxFQUFFO0lBQ2xELElBQUk7TUFDRixNQUFNO1FBQ0pDLFdBQVc7UUFDWEMsS0FBSztRQUNMQyxPQUFPO1FBQ1BDLFFBQVE7UUFDUkMsUUFBUTtRQUNSQyxVQUFVO1FBQ1ZDLFlBQVk7UUFDWkMsY0FBYztRQUNkQztNQUNGLENBQUMsR0FBR1QsWUFBWTs7TUFFaEI7TUFDQSxNQUFNVSxNQUFNLEdBQUcsTUFBTWQsTUFBTSxDQUFDZSxRQUFRLENBQUNaLFFBQVEsQ0FBQztNQUM5QyxJQUFJLENBQUNXLE1BQU0sRUFBRTtRQUNYLE1BQU0sSUFBSUUsS0FBSyxDQUFDLGtCQUFrQixDQUFDO01BQ3JDOztNQUVBO01BQ0EsTUFBTUMsUUFBUSxHQUFHLElBQUluQixXQUFXLENBQUM7UUFDL0JnQixNQUFNLEVBQUVYLFFBQVE7UUFDaEJjLFFBQVEsRUFBRTtVQUNSQyxJQUFJLEVBQUUsT0FBTztVQUNiYixXQUFXLEVBQUUsQ0FBQ0EsV0FBVyxDQUFDYyxTQUFTLEVBQUVkLFdBQVcsQ0FBQ2UsUUFBUTtRQUMzRCxDQUFDO1FBQ0RkLEtBQUs7UUFDTEMsT0FBTztRQUNQQyxRQUFRO1FBQ1JDLFFBQVE7UUFDUkMsVUFBVTtRQUNWQyxZQUFZO1FBQ1pDLGNBQWM7UUFDZEM7TUFDRixDQUFDLENBQUM7O01BRUY7TUFDQSxNQUFNUSxVQUFV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