{"version":3,"names":["EventEmitter","require","mongoose","nodemailer","twilio","e","console","warn","logger","whatsappService","notificationSchema","Schema","id","type","String","unique","index","userId","required","enum","default","title","en","ar","body","category","priority","channels","email","Boolean","sms","whatsapp","inApp","push","dashboard","status","relatedData","entityType","entityId","actionUrl","createdAt","Date","now","scheduledAt","sentAt","readAt","expiresAt","deliveryStatus","sent","error","messageId","metadata","Types","Mixed","tags","rate","Number","ratedAt","feedback","Notification","model","UnifiedNotificationManager","constructor","config","maxRetries","retryDelay","batchSize","emailTransporter","createTransport","service","process","env","EMAIL_SERVICE","auth","user","EMAIL_USER","pass","EMAIL_PASSWORD","twilioClient","TWILIO_ACCOUNT_SID","TWILIO_AUTH_TOKEN","queue","isProcessing","stats","total","failed","channelStats","startQueueProcessor","sendNotification","notificationData","Error","notification","Math","random","toString","substr","savedNotification","save","retries","emit","info","message","sendImmediateNotification","deliverNotification","sendBulkNotifications","userIds","notificationTemplate","results","result","filter","r","length","setInterval","processQueue","batch","splice","item","setTimeout","updateOne","deliveryPromises","sendEmailNotification","catch","err","channel","sendWhatsAppNotification","sendSMSNotification","sendInAppNotification","sendPushNotification","sendDashboardNotification","Promise","allSettled","htmlContent","buildEmailTemplate","mailOptions","from","to","subject","html","sendMail","phoneNumber","buildWhatsAppMessage","sendMessage","skipped","success","substring","smsMessage","messages","create","TWILIO_PHONE_NUMBER","sid","lang","language","isArabic","direction","prefix","getNotificationEmoji","emojis","alert","reminder","warning","critical","getStatistics","successRate","toFixed","queueLength","getUserNotifications","filters","query","notifications","find","sort","limit","exec","markAsRead","notificationId","deleteNotification","deleteOne","rateNotification","rating","min","max","module","exports","notificationManager"],"sources":["unifiedNotificationManager.js"],"sourcesContent":["/**\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * üîî Unified Notification Manager\r\n * ŸÖÿØŸäÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖŸàÿ≠ÿØ ÿßŸÑÿ¥ÿßŸÖŸÑ ŸàÿßŸÑÿ∞ŸÉŸä\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * \r\n * ŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿπÿ®ÿ± ÿ£ŸÜŸàÿßÿ™ ŸÖÿ™ÿπÿØÿØÿ©:\r\n * - ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä (Email)\r\n * - ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÜÿµŸäÿ© (SMS)\r\n * - ÿßŸÑŸàÿßÿ™ÿ≥ ÿ¢ÿ® (WhatsApp)\r\n * - ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸÅŸàÿ±Ÿäÿ© (In-App)\r\n * - ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ (Push Notifications)\r\n * - ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ (Dashboard)\r\n */\r\n\r\nconst EventEmitter = require('events');\r\nconst mongoose = require('mongoose');\r\nconst nodemailer = require('nodemailer');\r\nlet twilio;\r\ntry {\r\n  twilio = require('twilio');\r\n} catch (e) {\r\n  console.warn('‚ö†Ô∏è  Twilio module not installed. SMS via Twilio will be unavailable.');\r\n}\r\nconst logger = require('../utils/logger');\r\nconst whatsappService = require('./whatsappNotificationService');\r\n\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n// üìã ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nconst notificationSchema = new mongoose.Schema({\r\n  // ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©\r\n  id: { type: String, unique: true, index: true },\r\n  userId: { type: String, required: true, index: true },\r\n  type: {\r\n    type: String,\r\n    enum: [\r\n      'alert',      // ÿ™ŸÜÿ®ŸäŸá\r\n      'reminder',   // ÿ™ÿ∞ŸÉŸäÿ±\r\n      'notification', // ÿ•ÿ¥ÿπÿßÿ±\r\n      'warning',    // ÿ™ÿ≠ÿ∞Ÿäÿ±\r\n      'critical',   // ÿ≠ÿ±ÿ¨\r\n      'info',       // ŸÖÿπŸÑŸàŸÖÿ©\r\n    ],\r\n    default: 'notification',\r\n  },\r\n\r\n  // ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ\r\n  title: {\r\n    en: String,\r\n    ar: String,\r\n  },\r\n  body: {\r\n    en: String,\r\n    ar: String,\r\n  },\r\n  category: String,\r\n  priority: {\r\n    type: String,\r\n    enum: ['low', 'medium', 'high', 'critical'],\r\n    default: 'medium',\r\n  },\r\n\r\n  // ŸÇŸÜŸàÿßÿ™ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ\r\n  channels: {\r\n    email: { type: Boolean, default: true },\r\n    sms: { type: Boolean, default: false },\r\n    whatsapp: { type: Boolean, default: false },\r\n    inApp: { type: Boolean, default: true },\r\n    push: { type: Boolean, default: false },\r\n    dashboard: { type: Boolean, default: true },\r\n  },\r\n\r\n  // ÿ≠ÿßŸÑÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ\r\n  status: {\r\n    type: String,\r\n    enum: ['draft', 'scheduled', 'sent', 'failed', 'read', 'archived'],\r\n    default: 'draft',\r\n    index: true,\r\n  },\r\n\r\n  // ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¨Ÿáÿßÿ™ ÿßŸÑŸÖÿ™ÿπŸÑŸÇÿ©\r\n  relatedData: {\r\n    entityType: String,     // ŸÜŸàÿπ ÿßŸÑŸÉÿßÿ¶ŸÜ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑\r\n    entityId: String,       // ŸÖÿπÿ±ŸÅ ÿßŸÑŸÉÿßÿ¶ŸÜ\r\n    actionUrl: String,      // ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°\r\n  },\r\n\r\n  // ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ\r\n  createdAt: { type: Date, default: Date.now, index: true },\r\n  scheduledAt: Date,\r\n  sentAt: Date,\r\n  readAt: Date,\r\n  expiresAt: Date,\r\n\r\n  // ÿßŸÑÿ™ÿ™ÿ®ÿπ\r\n  deliveryStatus: {\r\n    email: {\r\n      sent: Boolean,\r\n      sentAt: Date,\r\n      error: String,\r\n    },\r\n    sms: {\r\n      sent: Boolean,\r\n      sentAt: Date,\r\n      messageId: String,\r\n      error: String,\r\n    },\r\n    whatsapp: {\r\n      sent: Boolean,\r\n      sentAt: Date,\r\n      messageId: String,\r\n      error: String,\r\n    },\r\n    inApp: {\r\n      sent: Boolean,\r\n      sentAt: Date,\r\n    },\r\n    push: {\r\n      sent: Boolean,\r\n      sentAt: Date,\r\n      error: String,\r\n    },\r\n    dashboard: {\r\n      sent: Boolean,\r\n      sentAt: Date,\r\n    },\r\n  },\r\n\r\n  // ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©\r\n  metadata: mongoose.Schema.Types.Mixed,\r\n  tags: [String],\r\n\r\n  // ÿßŸÑÿ£ÿØÿßÿ°\r\n  rate: Number, // ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (1-5)\r\n  ratedAt: Date,\r\n  feedback: String,\r\n});\r\n\r\n// ÿ•ŸÜÿ¥ÿßÿ° ŸÅŸáÿ±ÿ≥ÿ© ŸÖÿ±ŸÉÿ®ÿ© ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿØÿßÿ°\r\nnotificationSchema.index({ userId: 1, createdAt: -1 });\r\nnotificationSchema.index({ userId: 1, status: 1 });\r\nnotificationSchema.index({ userId: 1, category: 1 });\r\n\r\nconst Notification = mongoose.model('Notification', notificationSchema);\r\n\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n// üéØ ŸÖÿØŸäÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖŸàÿ≠ÿØ\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nclass UnifiedNotificationManager extends EventEmitter {\r\n  constructor(config = {}) {\r\n    super();\r\n\r\n    // ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\r\n    this.config = {\r\n      maxRetries: 3,\r\n      retryDelay: 5000,\r\n      batchSize: 50,\r\n      ...config,\r\n    };\r\n\r\n    // ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä\r\n    this.emailTransporter = nodemailer.createTransport({\r\n      service: process.env.EMAIL_SERVICE || 'gmail',\r\n      auth: {\r\n        user: process.env.EMAIL_USER,\r\n        pass: process.env.EMAIL_PASSWORD,\r\n      },\r\n    });\r\n\r\n    // Twilio ŸÑŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿµŸäÿ©\r\n    this.twilioClient = null;\r\n    if (twilio && process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN) {\r\n      this.twilioClient = twilio(\r\n        process.env.TWILIO_ACCOUNT_SID,\r\n        process.env.TWILIO_AUTH_TOKEN\r\n      );\r\n    }\r\n\r\n    // ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±\r\n    this.queue = [];\r\n    this.isProcessing = false;\r\n\r\n    // ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™\r\n    this.stats = {\r\n      total: 0,\r\n      sent: 0,\r\n      failed: 0,\r\n      channelStats: {\r\n        email: { sent: 0, failed: 0 },\r\n        sms: { sent: 0, failed: 0 },\r\n        whatsapp: { sent: 0, failed: 0 },\r\n        inApp: { sent: 0, failed: 0 },\r\n        push: { sent: 0, failed: 0 },\r\n        dashboard: { sent: 0, failed: 0 },\r\n      },\r\n    };\r\n\r\n    this.startQueueProcessor();\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * üì§ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÖŸàÿ≠ÿØ\r\n   */\r\n  async sendNotification(userId, notificationData) {\r\n    try {\r\n      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™\r\n      if (!userId || !notificationData) {\r\n        throw new Error('ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ∫Ÿäÿ± ŸÉÿßŸÖŸÑÿ©');\r\n      }\r\n\r\n      // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n      const notification = new Notification({\r\n        id: `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        userId,\r\n        ...notificationData,\r\n      });\r\n\r\n      // ÿ≠ŸÅÿ∏ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\r\n      const savedNotification = await notification.save();\r\n\r\n      // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±\r\n      this.queue.push({\r\n        notification: savedNotification,\r\n        retries: 0,\r\n      });\r\n\r\n      // ÿ•ÿ∑ŸÑÿßŸÇ ÿ≠ÿØÿ´\r\n      this.emit('notificationCreated', savedNotification);\r\n\r\n      logger.info(`üì¨ ÿ•ÿ¥ÿπÿßÿ± ŸÖŸàÿ≠ÿØ ŸÖÿ∂ÿßŸÅ ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±: ${userId}`);\r\n\r\n      return savedNotification;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±: ${error.message}`);\r\n      this.emit('notificationError', { userId, error: error.message });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÅŸàÿ±Ÿä (ÿ≠ÿßŸÑŸä)\r\n   */\r\n  async sendImmediateNotification(userId, notificationData) {\r\n    try {\r\n      const notification = new Notification({\r\n        id: `insta_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        userId,\r\n        status: 'sent',\r\n        ...notificationData,\r\n      });\r\n\r\n      const savedNotification = await notification.save();\r\n\r\n      // ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÅŸàÿ±Ÿä ÿπÿ®ÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸÜŸàÿßÿ™\r\n      await this.deliverNotification(savedNotification);\r\n\r\n      this.emit('immediateNotificationSent', savedNotification);\r\n\r\n      return savedNotification;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÅŸàÿ±Ÿä: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ¨ŸÖÿßÿπŸäÿ©\r\n   */\r\n  async sendBulkNotifications(userIds, notificationTemplate) {\r\n    try {\r\n      const results = [];\r\n\r\n      for (const userId of userIds) {\r\n        try {\r\n          const result = await this.sendNotification(userId, notificationTemplate);\r\n          results.push({ userId, status: 'queued', id: result.id });\r\n        } catch (error) {\r\n          results.push({ userId, status: 'failed', error: error.message });\r\n        }\r\n      }\r\n\r\n      logger.info(`üì¨ ${results.filter(r => r.status === 'queued').length} ÿ•ÿ¥ÿπÿßÿ± ÿ¨ŸÖÿßÿπŸä ÿ£ÿ∂ŸäŸÅ ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±`);\r\n\r\n      return results;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ¨ŸÖÿßÿπŸä: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * üöö ÿ™ÿ≥ŸÑŸäŸÖ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ŸÖÿπÿßŸÑÿ¨ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±\r\n   */\r\n  startQueueProcessor() {\r\n    setInterval(async () => {\r\n      if (!this.isProcessing && this.queue.length > 0) {\r\n        await this.processQueue();\r\n      }\r\n    }, 1000);\r\n\r\n    logger.info('‚ñ∂Ô∏è ŸÖÿπÿßŸÑÿ¨ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸÜÿ¥ÿ∑');\r\n  }\r\n\r\n  /**\r\n   * ŸÖÿπÿßŸÑÿ¨ÿ© ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±\r\n   */\r\n  async processQueue() {\r\n    if (this.isProcessing || this.queue.length === 0) {\r\n      return;\r\n    }\r\n\r\n    this.isProcessing = true;\r\n\r\n    try {\r\n      const batch = this.queue.splice(0, this.config.batchSize);\r\n\r\n      for (const item of batch) {\r\n        try {\r\n          await this.deliverNotification(item.notification);\r\n        } catch (error) {\r\n          item.retries++;\r\n\r\n          if (item.retries < this.config.maxRetries) {\r\n            // ÿ•ÿπÿßÿØÿ© ŸÖÿ≠ÿßŸàŸÑÿ©\r\n            setTimeout(\r\n              () => this.queue.push(item),\r\n              this.config.retryDelay * item.retries\r\n            );\r\n          } else {\r\n            // ŸÅÿ¥ŸÑ ŸÜŸáÿßÿ¶Ÿä\r\n            await Notification.updateOne(\r\n              { id: item.notification.id },\r\n              { status: 'failed' }\r\n            );\r\n\r\n            logger.error(`‚ùå ŸÅÿ¥ŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ®ÿπÿØ ${item.retries} ŸÖÿ≠ÿßŸàŸÑÿßÿ™: ${item.notification.id}`);\r\n          }\r\n        }\r\n      }\r\n    } finally {\r\n      this.isProcessing = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≥ŸÑŸäŸÖ ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿπÿ®ÿ± ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ©\r\n   */\r\n  async deliverNotification(notification) {\r\n    const deliveryPromises = [];\r\n\r\n    // ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä\r\n    if (notification.channels.email) {\r\n      deliveryPromises.push(\r\n        this.sendEmailNotification(notification).catch(err => ({\r\n          channel: 'email',\r\n          error: err,\r\n        }))\r\n      );\r\n    }\r\n\r\n    // ÿßŸÑŸàÿßÿ™ÿ≥ ÿ¢ÿ®\r\n    if (notification.channels.whatsapp) {\r\n      deliveryPromises.push(\r\n        this.sendWhatsAppNotification(notification).catch(err => ({\r\n          channel: 'whatsapp',\r\n          error: err,\r\n        }))\r\n      );\r\n    }\r\n\r\n    // ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿµŸäÿ©\r\n    if (notification.channels.sms) {\r\n      deliveryPromises.push(\r\n        this.sendSMSNotification(notification).catch(err => ({\r\n          channel: 'sms',\r\n          error: err,\r\n        }))\r\n      );\r\n    }\r\n\r\n    // ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÅŸàÿ±Ÿäÿ©\r\n    if (notification.channels.inApp) {\r\n      deliveryPromises.push(\r\n        this.sendInAppNotification(notification).catch(err => ({\r\n          channel: 'inApp',\r\n          error: err,\r\n        }))\r\n      );\r\n    }\r\n\r\n    // ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ\r\n    if (notification.channels.push) {\r\n      deliveryPromises.push(\r\n        this.sendPushNotification(notification).catch(err => ({\r\n          channel: 'push',\r\n          error: err,\r\n        }))\r\n      );\r\n    }\r\n\r\n    // ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ\r\n    if (notification.channels.dashboard) {\r\n      deliveryPromises.push(\r\n        this.sendDashboardNotification(notification).catch(err => ({\r\n          channel: 'dashboard',\r\n          error: err,\r\n        }))\r\n      );\r\n    }\r\n\r\n    // ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑÿßÿ™\r\n    const results = await Promise.allSettled(deliveryPromises);\r\n\r\n    // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n    notification.status = 'sent';\r\n    notification.sentAt = new Date();\r\n\r\n    await notification.save();\r\n\r\n    this.emit('notificationDelivered', notification);\r\n\r\n    logger.info(`‚úÖ ÿ™ŸÖ ÿ™ÿ≥ŸÑŸäŸÖ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±: ${notification.id}`);\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿπÿ®ÿ± ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä\r\n   */\r\n  async sendEmailNotification(notification) {\r\n    try {\r\n      // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (Ÿäÿ¨ÿ® ÿßÿ≥ÿ™ÿØÿπÿßÿ° ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™)\r\n      // const user = await User.findById(notification.userId);\r\n\r\n      const htmlContent = this.buildEmailTemplate(notification);\r\n\r\n      const mailOptions = {\r\n        from: process.env.EMAIL_USER,\r\n        to: notification.metadata?.email || 'user@example.com',\r\n        subject: notification.title?.ar || notification.title?.en,\r\n        html: htmlContent,\r\n      };\r\n\r\n      await this.emailTransporter.sendMail(mailOptions);\r\n\r\n      // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä\r\n      await Notification.updateOne(\r\n        { id: notification.id },\r\n        {\r\n          'deliveryStatus.email.sent': true,\r\n          'deliveryStatus.email.sentAt': new Date(),\r\n        }\r\n      );\r\n\r\n      this.stats.channelStats.email.sent++;\r\n\r\n      logger.info(`üìß ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÖÿ±ÿ≥ŸÑ: ${notification.userId}`);\r\n    } catch (error) {\r\n      this.stats.channelStats.email.failed++;\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿπÿ®ÿ± ÿßŸÑŸàÿßÿ™ÿ≥ ÿ¢ÿ®\r\n   */\r\n  async sendWhatsAppNotification(notification) {\r\n    try {\r\n      const phoneNumber = notification.metadata?.phoneNumber;\r\n\r\n      if (!phoneNumber) {\r\n        throw new Error('ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±');\r\n      }\r\n\r\n      const message = this.buildWhatsAppMessage(notification);\r\n\r\n      await whatsappService.sendMessage(phoneNumber, message);\r\n\r\n      // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸàÿßÿ™ÿ≥ ÿ¢ÿ®\r\n      await Notification.updateOne(\r\n        { id: notification.id },\r\n        {\r\n          'deliveryStatus.whatsapp.sent': true,\r\n          'deliveryStatus.whatsapp.sentAt': new Date(),\r\n        }\r\n      );\r\n\r\n      this.stats.channelStats.whatsapp.sent++;\r\n\r\n      logger.info(`üí¨ ÿ±ÿ≥ÿßŸÑÿ© Ÿàÿßÿ™ÿ≥ ÿ¢ÿ® ŸÖÿ±ÿ≥ŸÑÿ©: ${phoneNumber}`);\r\n    } catch (error) {\r\n      this.stats.channelStats.whatsapp.failed++;\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸàÿßÿ™ÿ≥ ÿ¢ÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿµŸäÿ©\r\n   */\r\n  async sendSMSNotification(notification) {\r\n    try {\r\n      // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ŸàŸÅÿ± Twilio\r\n      if (!this.twilioClient) {\r\n        logger.warn('‚ö†Ô∏è Twilio client not configured. SMS notification skipped.');\r\n        this.stats.channelStats.sms.skipped = (this.stats.channelStats.sms.skipped || 0) + 1;\r\n        return { success: false, message: 'Twilio not configured' };\r\n      }\r\n\r\n      const phoneNumber = notification.metadata?.phoneNumber;\r\n\r\n      if (!phoneNumber) {\r\n        throw new Error('ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±');\r\n      }\r\n\r\n      const message = (notification.body?.ar || notification.body?.en || '').substring(0, 160);\r\n\r\n      const smsMessage = await this.twilioClient.messages.create({\r\n        body: message,\r\n        from: process.env.TWILIO_PHONE_NUMBER,\r\n        to: phoneNumber,\r\n      });\r\n\r\n      // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿµŸäÿ©\r\n      await Notification.updateOne(\r\n        { id: notification.id },\r\n        {\r\n          'deliveryStatus.sms.sent': true,\r\n          'deliveryStatus.sms.sentAt': new Date(),\r\n          'deliveryStatus.sms.messageId': smsMessage.sid,\r\n        }\r\n      );\r\n\r\n      this.stats.channelStats.sms.sent++;\r\n\r\n      logger.info(`üì± ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿµŸäÿ© ŸÖÿ±ÿ≥ŸÑÿ©: ${phoneNumber}`);\r\n    } catch (error) {\r\n      this.stats.channelStats.sms.failed++;\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿµŸäÿ©: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÅŸàÿ±Ÿä\r\n   */\r\n  async sendInAppNotification(notification) {\r\n    try {\r\n      // ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿßŸÑŸÅŸàÿ±Ÿä ŸäŸèÿÆÿ≤ŸÜ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸàŸäŸèÿπÿ±ÿ∂ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n      // ŸÅŸä ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ£ŸÖÿßŸÖŸäÿ© ÿπŸÜÿØ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÄ API\r\n\r\n      await Notification.updateOne(\r\n        { id: notification.id },\r\n        {\r\n          'deliveryStatus.inApp.sent': true,\r\n          'deliveryStatus.inApp.sentAt': new Date(),\r\n        }\r\n      );\r\n\r\n      this.stats.channelStats.inApp.sent++;\r\n\r\n      logger.info(`üîî ÿ•ÿ¥ÿπÿßÿ± ŸÅŸàÿ±Ÿä ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: ${notification.userId}`);\r\n\r\n      // ÿ®ÿ´ ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿπÿ®ÿ± WebSocket (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)\r\n      this.emit('inAppNotification', {\r\n        userId: notification.userId,\r\n        notification,\r\n      });\r\n    } catch (error) {\r\n      this.stats.channelStats.inApp.failed++;\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ\r\n   */\r\n  async sendPushNotification(notification) {\r\n    try {\r\n      // ÿ™ŸÜŸÅŸäÿ∞ ŸÖÿπ Firebase Cloud Messaging ÿ£Ÿà ÿÆÿØŸÖÿ© ÿ£ÿÆÿ±Ÿâ\r\n      // ŸáŸÜÿß ŸÖÿ´ÿßŸÑ ÿπŸÑŸâ ÿßŸÑŸáŸäŸÉŸÑ ŸÅŸÇÿ∑\r\n\r\n      await Notification.updateOne(\r\n        { id: notification.id },\r\n        {\r\n          'deliveryStatus.push.sent': true,\r\n          'deliveryStatus.push.sentAt': new Date(),\r\n        }\r\n      );\r\n\r\n      this.stats.channelStats.push.sent++;\r\n\r\n      logger.info(`üì≤ ÿ•ÿ¥ÿπÿßÿ± ÿ™ÿ∑ÿ®ŸäŸÇ ŸÖÿ±ÿ≥ŸÑ: ${notification.userId}`);\r\n    } catch (error) {\r\n      this.stats.channelStats.push.failed++;\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ\r\n   */\r\n  async sendDashboardNotification(notification) {\r\n    try {\r\n      await Notification.updateOne(\r\n        { id: notification.id },\r\n        {\r\n          'deliveryStatus.dashboard.sent': true,\r\n          'deliveryStatus.dashboard.sentAt': new Date(),\r\n        }\r\n      );\r\n\r\n      this.stats.channelStats.dashboard.sent++;\r\n\r\n      // ÿ®ÿ´ ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿπÿ®ÿ± WebSocket\r\n      this.emit('dashboardNotification', {\r\n        userId: notification.userId,\r\n        notification,\r\n      });\r\n\r\n      logger.info(`üìä ÿ•ÿ¥ÿπÿßÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ: ${notification.userId}`);\r\n    } catch (error) {\r\n      this.stats.channelStats.dashboard.failed++;\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * üì® ÿ®ŸÜÿßÿ° ŸÇŸàÿßŸÑÿ® ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ®ŸÜÿßÿ° ŸÇÿßŸÑÿ® ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä\r\n   */\r\n  buildEmailTemplate(notification) {\r\n    const lang = notification.metadata?.language || 'ar';\r\n    const title = notification.title?.[lang] || notification.title?.en || '';\r\n    const body = notification.body?.[lang] || notification.body?.en || '';\r\n\r\n    const isArabic = lang === 'ar';\r\n    const direction = isArabic ? 'rtl' : 'ltr';\r\n\r\n    return `\r\n      <!DOCTYPE html>\r\n      <html dir=\"${direction}\">\r\n      <head>\r\n        <meta charset=\"UTF-8\">\r\n        <style>\r\n          body { font-family: Arial, sans-serif; margin: 0; padding: 0; }\r\n          .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n          .header { background-color: #007bff; color: white; padding: 20px; border-radius: 5px 5px 0 0; }\r\n          .content { background-color: #f9f9f9; padding: 20px; }\r\n          .footer { background-color: #e9ecef; padding: 10px; border-radius: 0 0 5px 5px; font-size: 12px; }\r\n          .button { display: inline-block; background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin-top: 10px; }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <div class=\"container\">\r\n          <div class=\"header\">\r\n            <h2>${title}</h2>\r\n          </div>\r\n          <div class=\"content\">\r\n            <p>${body}</p>\r\n            ${notification.relatedData?.actionUrl ? `\r\n              <a href=\"${notification.relatedData.actionUrl}\" class=\"button\">\r\n                ${isArabic ? 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ' : 'View Details'}\r\n              </a>\r\n            ` : ''}\r\n          </div>\r\n          <div class=\"footer\">\r\n            <p>${isArabic ? 'Ÿáÿ∞ÿß ÿ®ÿ±ŸäÿØ ÿ™ŸÑŸÇÿßÿ¶Ÿäÿå Ÿäÿ±ÿ¨Ÿâ ÿπÿØŸÖ ÿßŸÑÿ±ÿØ ÿπŸÑŸäŸá' : 'This is an automated email, please do not reply'}</p>\r\n          </div>\r\n        </div>\r\n      </body>\r\n      </html>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * ÿ®ŸÜÿßÿ° ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸàÿßÿ™ÿ≥ ÿ¢ÿ®\r\n   */\r\n  buildWhatsAppMessage(notification) {\r\n    const lang = notification.metadata?.language || 'ar';\r\n    const title = notification.title?.[lang] || notification.title?.en || '';\r\n    const body = notification.body?.[lang] || notification.body?.en || '';\r\n\r\n    const prefix = this.getNotificationEmoji(notification.type);\r\n\r\n    return `${prefix} *${title}*\\n\\n${body}`;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ±ŸÖŸàÿ≤ ÿßŸÑÿ™ÿπÿ®Ÿäÿ±Ÿäÿ©\r\n   */\r\n  getNotificationEmoji(type) {\r\n    const emojis = {\r\n      alert: 'üö®',\r\n      reminder: '‚è∞',\r\n      notification: 'üì¢',\r\n      warning: '‚ö†Ô∏è',\r\n      critical: 'üî¥',\r\n      info: '‚ÑπÔ∏è',\r\n    };\r\n\r\n    return emojis[type] || 'üì¢';\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * üìä ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸàÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™\r\n   */\r\n  getStatistics() {\r\n    return {\r\n      total: this.stats.total,\r\n      sent: this.stats.sent,\r\n      failed: this.stats.failed,\r\n      successRate: this.stats.total > 0\r\n        ? ((this.stats.sent / this.stats.total) * 100).toFixed(2) + '%'\r\n        : '0%',\r\n      channelStats: this.stats.channelStats,\r\n      queueLength: this.queue.length,\r\n      isProcessing: this.isProcessing,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  async getUserNotifications(userId, filters = {}) {\r\n    try {\r\n      const query = { userId };\r\n\r\n      if (filters.status) {\r\n        query.status = filters.status;\r\n      }\r\n\r\n      if (filters.type) {\r\n        query.type = filters.type;\r\n      }\r\n\r\n      if (filters.category) {\r\n        query.category = filters.category;\r\n      }\r\n\r\n      const notifications = await Notification.find(query)\r\n        .sort({ createdAt: -1 })\r\n        .limit(filters.limit || 50)\r\n        .exec();\r\n\r\n      return notifications;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ÿàÿ∂ÿπ ÿπŸÑÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÉŸÖŸÇÿ±Ÿàÿ°\r\n   */\r\n  async markAsRead(notificationId) {\r\n    try {\r\n      const result = await Notification.updateOne(\r\n        { id: notificationId },\r\n        {\r\n          status: 'read',\r\n          readAt: new Date(),\r\n        }\r\n      );\r\n\r\n      return result;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä Ÿàÿ∂ÿπ ÿπŸÑÿßŸÖÿ© ÿßŸÑŸÖŸÇÿ±Ÿàÿ°: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ≠ÿ∞ŸÅ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n   */\r\n  async deleteNotification(notificationId) {\r\n    try {\r\n      return await Notification.deleteOne({ id: notificationId });\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n   */\r\n  async rateNotification(notificationId, rating, feedback = '') {\r\n    try {\r\n      return await Notification.updateOne(\r\n        { id: notificationId },\r\n        {\r\n          rate: Math.min(5, Math.max(1, rating)),\r\n          feedback,\r\n          ratedAt: new Date(),\r\n        }\r\n      );\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n// üì¶ ÿßŸÑÿ™ÿµÿØŸäÿ±\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nmodule.exports = {\r\n  UnifiedNotificationManager,\r\n  Notification,\r\n  notificationManager: new UnifiedNotificationManager(),\r\n};\r\n"],"mappings":"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","ignoreList":[]}