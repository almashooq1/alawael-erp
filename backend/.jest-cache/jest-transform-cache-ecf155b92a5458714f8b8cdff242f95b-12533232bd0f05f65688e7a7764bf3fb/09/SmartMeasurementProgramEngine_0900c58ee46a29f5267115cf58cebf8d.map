{"version":3,"names":["mongoose","require","MeasurementResult","RehabilitationProgram","ProgramProgress","SmartMeasurementProgramEngine","analyzeMeasurementAndActivatePrograms","measurementResultId","result","findById","populate","Error","previousResults","find","beneficiaryId","typeId","_id","$ne","sort","dateAdministrated","limit","suitablePrograms","findSuitablePrograms","programsWithScores","Promise","all","map","prog","calculateMatchScore","rankedPrograms","a","b","matchScore","slice","activatedPrograms","activateProgramsForBeneficiary","recommendations","generateComprehensiveRecommendations","success","analyzedPrograms","timestamp","Date","totalProgramsActivated","length","error","console","measurementResult","measurement","measurementId","measurementType","programs","isActive","status","filteredPrograms","filter","program","activationRule","linkedMeasurements","m","measurementTypeId","toString","scoreInRange","activationRules","minScore","undefined","rawScore","maxScore","levelMatches","levels","includes","overallLevel","score","weights","measurementCriteria","severity","demographics","evidence","scopeInRange","severityMatch","suitableSeverityLevels","ageMatch","checkAgeMatch","targetAgeGroup","evidenceBase","researchBased","programId","programName","nameAr","reasoning","generateMatchReasoning","programData","existingProgress","findOne","overallStatus","programProgress","enrollmentDate","expectedCompletionDate","calculateExpectedCompletionDate","save","push","progressId","activationDate","linkedMeasurementResult","immediate","shortTerm","longTerm","familyGuidance","educationalSupport","precautions","p","join","recommendedFollowUp","improvement","calculateProgressTrend","trend","rate","interpretation","specialNotes","currentResult","scores","r","reverse","initialScore","latestScore","Math","round","generateProgressRecommendations","ageTarget","durationWeeks","date","setDate","getDate","targetDisabilities","objectives","o","description","generateBeneficiaryReport","latestResults","activePrograms","IndividualRehabPlan","irp","$in","latestMeasurements","individualPlan","generatedAt","trackProgramEffectiveness","programProgressId","progress","effectiveness","attendanceRate","completedSessions","totalPlannedSessions","objectivesMet","objectiveProgress","obj","totalObjectives","skillAcquisitionRate","statistics","engagement","engagementScore","overallEffectiveness","calculateOverallEffectiveness","attendance","objectiveAchievement","skillAcquisition","objectiveRate","skillRate","engagementRate","toFixed","module","exports"],"sources":["SmartMeasurementProgramEngine.js"],"sourcesContent":["/**\r\n * محرك الربط الذكي بين المقاييس والبرامج\r\n * Smart Measurement-Program Linkage Engine\r\n * ========================================\r\n * يقوم بـ:\r\n * - تحليل نتائج المقاييس\r\n * - تفعيل البرامج الملائمة تلقائياً\r\n * - توليد توصيات شاملة\r\n * - تتبع التطابق والفاعلية\r\n */\r\n\r\nconst mongoose = require('mongoose');\r\nconst { MeasurementResult } = require('./MeasurementModels');\r\nconst { RehabilitationProgram, ProgramProgress } = require('./RehabilitationProgramModels');\r\n\r\nclass SmartMeasurementProgramEngine {\r\n  /**\r\n   * تحليل نتيجة قياس وتفعيل البرامج الملائمة\r\n   */\r\n  async analyzeMeasurementAndActivatePrograms(measurementResultId) {\r\n    try {\r\n      // 1. جلب نتيجة القياس\r\n      const result = await MeasurementResult.findById(measurementResultId)\r\n        .populate('measurementId')\r\n        .populate('typeId');\r\n      \r\n      if (!result) {\r\n        throw new Error('نتيجة القياس غير موجودة');\r\n      }\r\n\r\n      // 2. جلب المقاييس والنتائج السابقة للمستفيد\r\n      const previousResults = await MeasurementResult.find({\r\n        beneficiaryId: result.beneficiaryId,\r\n        typeId: result.typeId,\r\n        _id: { $ne: measurementResultId }\r\n      }).sort({ dateAdministrated: -1 }).limit(5);\r\n\r\n      // 3. تحديد البرامج المناسبة\r\n      const suitablePrograms = await this.findSuitablePrograms(\r\n        result,\r\n        previousResults\r\n      );\r\n\r\n      // 4. تقييم درجة التطابق\r\n      const programsWithScores = await Promise.all(\r\n        suitablePrograms.map(prog => this.calculateMatchScore(result, prog))\r\n      );\r\n\r\n      // 5. ترتيب البرامج حسب الأهمية\r\n      const rankedPrograms = programsWithScores\r\n        .sort((a, b) => b.matchScore - a.matchScore)\r\n        .slice(0, 5); // أفضل 5 برامج\r\n\r\n      // 6. تفعيل البرامج\r\n      const activatedPrograms = await this.activateProgramsForBeneficiary(\r\n        result.beneficiaryId,\r\n        rankedPrograms,\r\n        measurementResultId\r\n      );\r\n\r\n      // 7. توليد التقرير والتوصيات\r\n      const recommendations = await this.generateComprehensiveRecommendations(\r\n        result,\r\n        activatedPrograms,\r\n        previousResults\r\n      );\r\n\r\n      return {\r\n        success: true,\r\n        measurementResultId,\r\n        analyzedPrograms: activatedPrograms,\r\n        recommendations,\r\n        timestamp: new Date(),\r\n        totalProgramsActivated: activatedPrograms.length\r\n      };\r\n    } catch (error) {\r\n      console.error('خطأ في محرك الربط الذكي:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * البحث عن البرامج المناسبة بناءً على نتيجة القياس\r\n   */\r\n  async findSuitablePrograms(measurementResult, previousResults) {\r\n    const measurement = measurementResult.measurementId;\r\n    const measurementType = measurementResult.typeId;\r\n\r\n    // البحث عن البرامج المرتبطة بهذا النوع من المقاييس\r\n    const programs = await RehabilitationProgram.find({\r\n      'linkedMeasurements.measurementTypeId': measurementType._id,\r\n      isActive: true,\r\n      status: 'APPROVED'\r\n    });\r\n\r\n    // تصفية البرامج حسب:\r\n    // 1. نطاق العمر\r\n    // 2. نوع الإعاقة\r\n    // 3. مستوى الشدة\r\n    // 4. معايير التفعيل\r\n\r\n    const filteredPrograms = programs.filter(program => {\r\n      // التحقق من معايير التفعيل\r\n      const activationRule = program.linkedMeasurements.find(\r\n        m => m.measurementTypeId.toString() === measurementType._id.toString()\r\n      );\r\n\r\n      if (!activationRule) return false;\r\n\r\n      // التحقق من نطاق الدرجات\r\n      const scoreInRange = \r\n        ((activationRule.activationRules.minScore === undefined || \r\n          measurementResult.rawScore >= activationRule.activationRules.minScore) &&\r\n        (activationRule.activationRules.maxScore === undefined || \r\n          measurementResult.rawScore <= activationRule.activationRules.maxScore));\r\n\r\n      // التحقق من المستوى\r\n      const levelMatches = \r\n        !activationRule.activationRules.levels.length ||\r\n        activationRule.activationRules.levels.includes(measurementResult.overallLevel);\r\n\r\n      return scoreInRange && levelMatches;\r\n    });\r\n\r\n    return filteredPrograms;\r\n  }\r\n\r\n  /**\r\n   * حساب درجة التطابق بين المستفيد والبرنامج\r\n   */\r\n  async calculateMatchScore(measurementResult, program) {\r\n    let score = 0;\r\n    let weights = {\r\n      measurementCriteria: 40,\r\n      severity: 30,\r\n      demographics: 20,\r\n      evidence: 10\r\n    };\r\n\r\n    // 1. معايير القياس\r\n    const activationRule = program.linkedMeasurements[0]?.activationRules;\r\n    if (activationRule) {\r\n      const scopeInRange = \r\n        (activationRule.minScore === undefined || \r\n         measurementResult.rawScore >= activationRule.minScore * 0.9) &&\r\n        (activationRule.maxScore === undefined || \r\n         measurementResult.rawScore <= activationRule.maxScore * 1.1);\r\n      \r\n      if (scopeInRange) {\r\n        score += weights.measurementCriteria;\r\n      } else {\r\n        score += weights.measurementCriteria * 0.5;\r\n      }\r\n    }\r\n\r\n    // 2. مستوى الشدة\r\n    const severityMatch = program.suitableSeverityLevels.includes(\r\n      measurementResult.overallLevel\r\n    );\r\n    if (severityMatch) {\r\n      score += weights.severity;\r\n    } else if (program.suitableSeverityLevels.includes('ALL')) {\r\n      score += weights.severity * 0.8;\r\n    }\r\n\r\n    // 3. البيانات السكانية (العمر)\r\n    const ageMatch = this.checkAgeMatch(\r\n      measurementResult.beneficiaryId,\r\n      program.targetAgeGroup\r\n    );\r\n    if (ageMatch) {\r\n      score += weights.demographics;\r\n    } else {\r\n      score += weights.demographics * 0.3;\r\n    }\r\n\r\n    // 4. الأساس العلمي والفعالية\r\n    if (program.evidenceBase?.researchBased) {\r\n      score += weights.evidence;\r\n    } else {\r\n      score += weights.evidence * 0.5;\r\n    }\r\n\r\n    return {\r\n      programId: program._id,\r\n      programName: program.nameAr,\r\n      matchScore: score,\r\n      reasoning: this.generateMatchReasoning(program, measurementResult)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * تفعيل البرامج للمستفيد\r\n   */\r\n  async activateProgramsForBeneficiary(beneficiaryId, rankedPrograms, measurementResultId) {\r\n    const activatedPrograms = [];\r\n\r\n    for (const programData of rankedPrograms) {\r\n      try {\r\n        // التحقق من عدم وجود برنامج نشط من نفس النوع\r\n        const existingProgress = await ProgramProgress.findOne({\r\n          beneficiaryId,\r\n          programId: programData.programId,\r\n          overallStatus: 'ACTIVE'\r\n        });\r\n\r\n        if (!existingProgress) {\r\n          // إنشاء سجل تقدم جديد\r\n          const programProgress = new ProgramProgress({\r\n            beneficiaryId,\r\n            programId: programData.programId,\r\n            enrollmentDate: new Date(),\r\n            expectedCompletionDate: this.calculateExpectedCompletionDate(),\r\n            overallStatus: 'ENROLLING'\r\n          });\r\n\r\n          await programProgress.save();\r\n\r\n          activatedPrograms.push({\r\n            programId: programData.programId,\r\n            programName: programData.programName,\r\n            matchScore: programData.matchScore,\r\n            progressId: programProgress._id,\r\n            activationDate: new Date(),\r\n            linkedMeasurementResult: measurementResultId\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error(`خطأ في تفعيل البرنامج ${programData.programId}:`, error);\r\n      }\r\n    }\r\n\r\n    return activatedPrograms;\r\n  }\r\n\r\n  /**\r\n   * توليد توصيات شاملة\r\n   */\r\n  async generateComprehensiveRecommendations(\r\n    measurementResult,\r\n    activatedPrograms,\r\n    previousResults\r\n  ) {\r\n    const recommendations = {\r\n      immediate: [],\r\n      shortTerm: [],\r\n      longTerm: [],\r\n      familyGuidance: [],\r\n      educationalSupport: [],\r\n      precautions: []\r\n    };\r\n\r\n    // 1. التوصيات الفورية بناءً على النتيجة\r\n    if (measurementResult.overallLevel === 'PROFOUND' || \r\n        measurementResult.overallLevel === 'SEVERE') {\r\n      recommendations.immediate.push(\r\n        'يوصى ببدء التدخل الفوري والمركز',\r\n        'تقييم شامل من قبل الفريق متعدد التخصصات',\r\n        'تطوير خطة تأهيلية فردية مفصلة'\r\n      );\r\n    }\r\n\r\n    // 2. التوصيات البرنامجية\r\n    if (activatedPrograms.length > 0) {\r\n      recommendations.shortTerm.push(\r\n        `تفعيل ${activatedPrograms.length} برامج تأهيلية`,\r\n        `البدء بأولويات عالية: ${activatedPrograms\r\n          .slice(0, 3)\r\n          .map(p => p.programName)\r\n          .join(', ')}`\r\n      );\r\n    }\r\n\r\n    // 3. التوصيات الأسرية\r\n    const measurementType = measurementResult.typeId;\r\n    if (measurementType.recommendedFollowUp) {\r\n      recommendations.familyGuidance.push(\r\n        'تدريب الأسرة على استراتيجيات التعزيز في البيت',\r\n        'إعداد برنامج بيتي يومي متخصص',\r\n        'توفير استشارات دورية للوالدين'\r\n      );\r\n    }\r\n\r\n    // 4. التقدم المقارن (إن وجد)\r\n    if (previousResults.length > 0) {\r\n      const improvement = this.calculateProgressTrend(\r\n        previousResults,\r\n        measurementResult\r\n      );\r\n      recommendations.longTerm.push(\r\n        `اتجاه التطور: ${improvement.trend}`,\r\n        `معدل التحسن: ${improvement.rate}%`,\r\n        `الإجراءات المستقبلية: ${improvement.recommendations.join(', ')}`\r\n      );\r\n    }\r\n\r\n    // 5. التحذيرات والاحتياطات\r\n    if (measurementResult.interpretation?.specialNotes) {\r\n      recommendations.precautions.push(\r\n        measurementResult.interpretation.specialNotes\r\n      );\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  /**\r\n   * حساب اتجاه التقدم\r\n   */\r\n  calculateProgressTrend(previousResults, currentResult) {\r\n    if (previousResults.length === 0) {\r\n      return { trend: 'بداية جديدة', rate: 0, recommendations: [] };\r\n    }\r\n\r\n    const scores = previousResults.map(r => r.rawScore).reverse();\r\n    scores.push(currentResult.rawScore);\r\n\r\n    const initialScore = scores[0];\r\n    const latestScore = scores[scores.length - 1];\r\n    const improvement = ((latestScore - initialScore) / initialScore) * 100;\r\n\r\n    let trend = 'مستقر';\r\n    if (improvement > 10) trend = 'تحسن ملحوظ';\r\n    if (improvement > 20) trend = 'تحسن قوي';\r\n    if (improvement < -10) trend = 'انخفاض ملحوظ';\r\n    if (improvement < -20) trend = 'انخفاض حاد';\r\n\r\n    return {\r\n      trend,\r\n      rate: Math.round(improvement),\r\n      recommendations: this.generateProgressRecommendations(trend, improvement)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * توليد توصيات بناءً على التقدم\r\n   */\r\n  generateProgressRecommendations(trend, improvement) {\r\n    const recommendations = [];\r\n\r\n    if (improvement > 20) {\r\n      recommendations.push(\r\n        'الاستمرار في البرنامج الحالي',\r\n        'الترقي لمستوى أعلى من الصعوبة'\r\n      );\r\n    } else if (improvement > 10) {\r\n      recommendations.push(\r\n        'الاستمرار مع تعزيز البرنامج قليلاً'\r\n      );\r\n    } else if (improvement > 0) {\r\n      recommendations.push(\r\n        'مراجعة الاستراتيجيات المستخدمة',\r\n        'تكثيف التدخل'\r\n      );\r\n    } else if (improvement >= -10) {\r\n      recommendations.push(\r\n        'تعديل جذري على البرنامج',\r\n        'اجتماع فريق متعدد التخصصات'\r\n      );\r\n    } else {\r\n      recommendations.push(\r\n        'إعادة تقييم شامل',\r\n        'مراجعة التشخيص الأساسي',\r\n        'استشارة متخصصين إضافيين'\r\n      );\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  /**\r\n   * التحقق من تطابق العمر\r\n   */\r\n  async checkAgeMatch(beneficiaryId, ageTarget) {\r\n    // يتم جلب عمر المستفيد من قاعدة البيانات\r\n    // هذا تطبيق بسيط\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * حساب تاريخ الانتهاء المتوقع\r\n   */\r\n  calculateExpectedCompletionDate(durationWeeks = 12) {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() + (durationWeeks * 7));\r\n    return date;\r\n  }\r\n\r\n  /**\r\n   * توليد تفسير التطابق\r\n   */\r\n  generateMatchReasoning(program, measurementResult) {\r\n    return [\r\n      `يطابق نوع الإعاقة: ${program.targetDisabilities.join(', ')}`,\r\n      `مستوى الشدة المناسب: ${measurementResult.overallLevel}`,\r\n      `البرنامج يوفر: ${program.objectives.slice(0, 2).map(o => o.description).join(', ')}`\r\n    ].join(' | ');\r\n  }\r\n\r\n  /**\r\n   * إنشاء تقرير شامل للمستفيد\r\n   */\r\n  async generateBeneficiaryReport(beneficiaryId) {\r\n    try {\r\n      // جلب آخر نتائج القياسات\r\n      const latestResults = await MeasurementResult.find({\r\n        beneficiaryId,\r\n        status: 'APPROVED'\r\n      })\r\n        .sort({ dateAdministrated: -1 })\r\n        .limit(10)\r\n        .populate('typeId')\r\n        .populate('measurementId');\r\n\r\n      // جلب البرامج النشطة\r\n      const activePrograms = await ProgramProgress.find({\r\n        beneficiaryId,\r\n        overallStatus: 'ACTIVE'\r\n      })\r\n        .populate('programId');\r\n\r\n      // جلب الخطة التأهيلية الفردية\r\n      const { IndividualRehabPlan } = require('./MeasurementModels');\r\n      const irp = await IndividualRehabPlan.findOne({\r\n        beneficiaryId,\r\n        status: { $in: ['ACTIVE', 'UNDER_REVIEW'] }\r\n      });\r\n\r\n      return {\r\n        beneficiaryId,\r\n        latestMeasurements: latestResults,\r\n        activePrograms: activePrograms,\r\n        individualPlan: irp,\r\n        generatedAt: new Date()\r\n      };\r\n    } catch (error) {\r\n      console.error('خطأ في إنشاء التقرير:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تتبع فعالية البرنامج\r\n   */\r\n  async trackProgramEffectiveness(programProgressId) {\r\n    const progress = await ProgramProgress.findById(programProgressId);\r\n    \r\n    if (!progress) {\r\n      throw new Error('سجل تقدم البرنامج غير موجود');\r\n    }\r\n\r\n    // حساب مؤشرات الفعالية\r\n    const effectiveness = {\r\n      attendanceRate: (progress.completedSessions / progress.totalPlannedSessions) * 100,\r\n      objectivesMet: progress.objectiveProgress.filter(\r\n        obj => obj.status === 'MET' || obj.status === 'EXCEEDED'\r\n      ).length,\r\n      totalObjectives: progress.objectiveProgress.length,\r\n      skillAcquisitionRate: progress.statistics?.skillAcquisitionRate || 0,\r\n      engagement: progress.statistics?.engagementScore || 0,\r\n      overallEffectiveness: this.calculateOverallEffectiveness(progress)\r\n    };\r\n\r\n    return effectiveness;\r\n  }\r\n\r\n  /**\r\n   * حساب الفعالية الإجمالية\r\n   */\r\n  calculateOverallEffectiveness(progress) {\r\n    const weights = {\r\n      attendance: 0.25,\r\n      objectiveAchievement: 0.40,\r\n      skillAcquisition: 0.20,\r\n      engagement: 0.15\r\n    };\r\n\r\n    const attendanceRate = (progress.completedSessions / progress.totalPlannedSessions) * 100;\r\n    const objectiveRate = (progress.objectiveProgress.filter(\r\n      obj => obj.status === 'MET' || obj.status === 'EXCEEDED'\r\n    ).length / progress.objectiveProgress.length) * 100;\r\n    const skillRate = progress.statistics?.skillAcquisitionRate || 0;\r\n    const engagementRate = progress.statistics?.engagementScore || 0;\r\n\r\n    return (\r\n      (attendanceRate * weights.attendance +\r\n       objectiveRate * weights.objectiveAchievement +\r\n       skillRate * weights.skillAcquisition +\r\n       engagementRate * weights.engagement) / 100\r\n    ).toFixed(2);\r\n  }\r\n}\r\n\r\nmodule.exports = SmartMeasurementProgramEngine;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AACpC,MAAM;EAAEC;AAAkB,CAAC,GAAGD,OAAO,CAAC,qBAAqB,CAAC;AAC5D,MAAM;EAAEE,qBAAqB;EAAEC;AAAgB,CAAC,GAAGH,OAAO,CAAC,+BAA+B,CAAC;AAE3F,MAAMI,6BAA6B,CAAC;EAClC;AACF;AACA;EACE,MAAMC,qCAAqCA,CAACC,mBAAmB,EAAE;IAC/D,IAAI;MACF;MACA,MAAMC,MAAM,GAAG,MAAMN,iBAAiB,CAACO,QAAQ,CAACF,mBAAmB,CAAC,CACjEG,QAAQ,CAAC,eAAe,CAAC,CACzBA,QAAQ,CAAC,QAAQ,CAAC;MAErB,IAAI,CAACF,MAAM,EAAE;QACX,MAAM,IAAIG,KAAK,CAAC,yBAAyB,CAAC;MAC5C;;MAEA;MACA,MAAMC,eAAe,GAAG,MAAMV,iBAAiB,CAACW,IAAI,CAAC;QACnDC,aAAa,EAAEN,MAAM,CAACM,aAAa;QACnCC,MAAM,EAAEP,MAAM,CAACO,MAAM;QACrBC,GAAG,EAAE;UAAEC,GAAG,EAAEV;QAAoB;MAClC,CAAC,CAAC,CAACW,IAAI,CAAC;QAAEC,iBAAiB,EAAE,CAAC;MAAE,CAAC,CAAC,CAACC,KAAK,CAAC,CAAC,CAAC;;MAE3C;MACA,MAAMC,gBAAgB,GAAG,MAAM,IAAI,CAACC,oBAAoB,CACtDd,MAAM,EACNI,eACF,CAAC;;MAED;MACA,MAAMW,kBAAkB,GAAG,MAAMC,OAAO,CAACC,GAAG,CAC1CJ,gBAAgB,CAACK,GAAG,CAACC,IAAI,IAAI,IAAI,CAACC,mBAAmB,CAACpB,MAAM,EAAEmB,IAAI,CAAC,CACrE,CAAC;;MAED;MACA,MAAME,cAAc,GAAGN,kBAAkB,CACtCL,IAAI,CAAC,CAACY,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAACC,UAAU,GAAGF,CAAC,CAACE,UAAU,CAAC,CAC3CC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;;MAEhB;MACA,MAAMC,iBAAiB,GAAG,MAAM,IAAI,CAACC,8BAA8B,CACjE3B,MAAM,CAACM,aAAa,EACpBe,cAAc,EACdtB,mBACF,CAAC;;MAED;MACA,MAAM6B,eAAe,GAAG,MAAM,IAAI,CAACC,oCAAoC,CACrE7B,MAAM,EACN0B,iBAAiB,EACjBtB,eACF,CAAC;MAED,OAAO;QACL0B,OAAO,EAAE,IAAI;QACb/B,mBAAmB;QACnBgC,gBAAgB,EAAEL,iBAAiB;QACnCE,eAAe;QACfI,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC;QACrBC,sBAAsB,EAAER,iBAAiB,CAACS;MAC5C,CAAC;IACH,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChD,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACE,MAAMtB,oBAAoBA,CAACwB,iBAAiB,EAAElC,eAAe,EAAE;IAC7D,MAAMmC,WAAW,GAAGD,iBAAiB,CAACE,aAAa;IACnD,MAAMC,eAAe,GAAGH,iBAAiB,CAAC/B,MAAM;;IAEhD;IACA,MAAMmC,QAAQ,GAAG,MAAM/C,qBAAqB,CAACU,IAAI,CAAC;MAChD,sCAAsC,EAAEoC,eAAe,CAACjC,GAAG;MAC3DmC,QAAQ,EAAE,IAAI;MACdC,MAAM,EAAE;IACV,CAAC,CAAC;;IAEF;IACA;IACA;IACA;IACA;;IAEA,MAAMC,gBAAgB,GAAGH,QAAQ,CAACI,MAAM,CAACC,OAAO,IAAI;MAClD;MACA,MAAMC,cAAc,GAAGD,OAAO,CAACE,kBAAkB,CAAC5C,IAAI,CACpD6C,CAAC,IAAIA,CAAC,CAACC,iBAAiB,CAACC,QAAQ,CAAC,CAAC,KAAKX,eAAe,CAACjC,GAAG,CAAC4C,QAAQ,CAAC,CACvE,CAAC;MAED,IAAI,CAACJ,cAAc,EAAE,OAAO,KAAK;;MAEjC;MACA,MAAMK,YAAY,GACf,CAACL,cAAc,CAACM,eAAe,CAACC,QAAQ,KAAKC,SAAS,IACrDlB,iBAAiB,CAACmB,QAAQ,IAAIT,cAAc,CAACM,eAAe,CAACC,QAAQ,MACtEP,cAAc,CAACM,eAAe,CAACI,QAAQ,KAAKF,SAAS,IACpDlB,iBAAiB,CAACmB,QAAQ,IAAIT,cAAc,CAACM,eAAe,CAACI,QAAQ,CAAE;;MAE3E;MACA,MAAMC,YAAY,GAChB,CAACX,cAAc,CAACM,eAAe,CAACM,MAAM,CAACzB,MAAM,IAC7Ca,cAAc,CAACM,eAAe,CAACM,MAAM,CAACC,QAAQ,CAACvB,iBAAiB,CAACwB,YAAY,CAAC;MAEhF,OAAOT,YAAY,IAAIM,YAAY;IACrC,CAAC,CAAC;IAEF,OAAOd,gBAAgB;EACzB;;EAEA;AACF;AACA;EACE,MAAMzB,mBAAmBA,CAACkB,iBAAiB,EAAES,OAAO,EAAE;IACpD,IAAIgB,KAAK,GAAG,CAAC;IACb,IAAIC,OAAO,GAAG;MACZC,mBAAmB,EAAE,EAAE;MACvBC,QAAQ,EAAE,EAAE;MACZC,YAAY,EAAE,EAAE;MAChBC,QAAQ,EAAE;IACZ,CAAC;;IAED;IACA,MAAMpB,cAAc,GAAGD,OAAO,CAACE,kBAAkB,CAAC,CAAC,CAAC,EAAEK,eAAe;IACrE,IAAIN,cAAc,EAAE;MAClB,MAAMqB,YAAY,GAChB,CAACrB,cAAc,CAACO,QAAQ,KAAKC,SAAS,IACrClB,iBAAiB,CAACmB,QAAQ,IAAIT,cAAc,CAACO,QAAQ,GAAG,GAAG,MAC3DP,cAAc,CAACU,QAAQ,KAAKF,SAAS,IACrClB,iBAAiB,CAACmB,QAAQ,IAAIT,cAAc,CAACU,QAAQ,GAAG,GAAG,CAAC;MAE/D,IAAIW,YAAY,EAAE;QAChBN,KAAK,IAAIC,OAAO,CAACC,mBAAmB;MACtC,CAAC,MAAM;QACLF,KAAK,IAAIC,OAAO,CAACC,mBAAmB,GAAG,GAAG;MAC5C;IACF;;IAEA;IACA,MAAMK,aAAa,GAAGvB,OAAO,CAACwB,sBAAsB,CAACV,QAAQ,CAC3DvB,iBAAiB,CAACwB,YACpB,CAAC;IACD,IAAIQ,aAAa,EAAE;MACjBP,KAAK,IAAIC,OAAO,CAACE,QAAQ;IAC3B,CAAC,MAAM,IAAInB,OAAO,CAACwB,sBAAsB,CAACV,QAAQ,CAAC,KAAK,CAAC,EAAE;MACzDE,KAAK,IAAIC,OAAO,CAACE,QAAQ,GAAG,GAAG;IACjC;;IAEA;IACA,MAAMM,QAAQ,GAAG,IAAI,CAACC,aAAa,CACjCnC,iBAAiB,CAAChC,aAAa,EAC/ByC,OAAO,CAAC2B,cACV,CAAC;IACD,IAAIF,QAAQ,EAAE;MACZT,KAAK,IAAIC,OAAO,CAACG,YAAY;IAC/B,CAAC,MAAM;MACLJ,KAAK,IAAIC,OAAO,CAACG,YAAY,GAAG,GAAG;IACrC;;IAEA;IACA,IAAIpB,OAAO,CAAC4B,YAAY,EAAEC,aAAa,EAAE;MACvCb,KAAK,IAAIC,OAAO,CAACI,QAAQ;IAC3B,CAAC,MAAM;MACLL,KAAK,IAAIC,OAAO,CAACI,QAAQ,GAAG,GAAG;IACjC;IAEA,OAAO;MACLS,SAAS,EAAE9B,OAAO,CAACvC,GAAG;MACtBsE,WAAW,EAAE/B,OAAO,CAACgC,MAAM;MAC3BvD,UAAU,EAAEuC,KAAK;MACjBiB,SAAS,EAAE,IAAI,CAACC,sBAAsB,CAAClC,OAAO,EAAET,iBAAiB;IACnE,CAAC;EACH;;EAEA;AACF;AACA;EACE,MAAMX,8BAA8BA,CAACrB,aAAa,EAAEe,cAAc,EAAEtB,mBAAmB,EAAE;IACvF,MAAM2B,iBAAiB,GAAG,EAAE;IAE5B,KAAK,MAAMwD,WAAW,IAAI7D,cAAc,EAAE;MACxC,IAAI;QACF;QACA,MAAM8D,gBAAgB,GAAG,MAAMvF,eAAe,CAACwF,OAAO,CAAC;UACrD9E,aAAa;UACbuE,SAAS,EAAEK,WAAW,CAACL,SAAS;UAChCQ,aAAa,EAAE;QACjB,CAAC,CAAC;QAEF,IAAI,CAACF,gBAAgB,EAAE;UACrB;UACA,MAAMG,eAAe,GAAG,IAAI1F,eAAe,CAAC;YAC1CU,aAAa;YACbuE,SAAS,EAAEK,WAAW,CAACL,SAAS;YAChCU,cAAc,EAAE,IAAItD,IAAI,CAAC,CAAC;YAC1BuD,sBAAsB,EAAE,IAAI,CAACC,+BAA+B,CAAC,CAAC;YAC9DJ,aAAa,EAAE;UACjB,CAAC,CAAC;UAEF,MAAMC,eAAe,CAACI,IAAI,CAAC,CAAC;UAE5BhE,iBAAiB,CAACiE,IAAI,CAAC;YACrBd,SAAS,EAAEK,WAAW,CAACL,SAAS;YAChCC,WAAW,EAAEI,WAAW,CAACJ,WAAW;YACpCtD,UAAU,EAAE0D,WAAW,CAAC1D,UAAU;YAClCoE,UAAU,EAAEN,eAAe,CAAC9E,GAAG;YAC/BqF,cAAc,EAAE,IAAI5D,IAAI,CAAC,CAAC;YAC1B6D,uBAAuB,EAAE/F;UAC3B,CAAC,CAAC;QACJ;MACF,CAAC,CAAC,OAAOqC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB8C,WAAW,CAACL,SAAS,GAAG,EAAEzC,KAAK,CAAC;MACzE;IACF;IAEA,OAAOV,iBAAiB;EAC1B;;EAEA;AACF;AACA;EACE,MAAMG,oCAAoCA,CACxCS,iBAAiB,EACjBZ,iBAAiB,EACjBtB,eAAe,EACf;IACA,MAAMwB,eAAe,GAAG;MACtBmE,SAAS,EAAE,EAAE;MACbC,SAAS,EAAE,EAAE;MACbC,QAAQ,EAAE,EAAE;MACZC,cAAc,EAAE,EAAE;MAClBC,kBAAkB,EAAE,EAAE;MACtBC,WAAW,EAAE;IACf,CAAC;;IAED;IACA,IAAI9D,iBAAiB,CAACwB,YAAY,KAAK,UAAU,IAC7CxB,iBAAiB,CAACwB,YAAY,KAAK,QAAQ,EAAE;MAC/ClC,eAAe,CAACmE,SAAS,CAACJ,IAAI,CAC5B,iCAAiC,EACjC,yCAAyC,EACzC,+BACF,CAAC;IACH;;IAEA;IACA,IAAIjE,iBAAiB,CAACS,MAAM,GAAG,CAAC,EAAE;MAChCP,eAAe,CAACoE,SAAS,CAACL,IAAI,CAC5B,SAASjE,iBAAiB,CAACS,MAAM,gBAAgB,EACjD,yBAAyBT,iBAAiB,CACvCD,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CACXP,GAAG,CAACmF,CAAC,IAAIA,CAAC,CAACvB,WAAW,CAAC,CACvBwB,IAAI,CAAC,IAAI,CAAC,EACf,CAAC;IACH;;IAEA;IACA,MAAM7D,eAAe,GAAGH,iBAAiB,CAAC/B,MAAM;IAChD,IAAIkC,eAAe,CAAC8D,mBAAmB,EAAE;MACvC3E,eAAe,CAACsE,cAAc,CAACP,IAAI,CACjC,+CAA+C,EAC/C,8BAA8B,EAC9B,+BACF,CAAC;IACH;;IAEA;IACA,IAAIvF,eAAe,CAAC+B,MAAM,GAAG,CAAC,EAAE;MAC9B,MAAMqE,WAAW,GAAG,IAAI,CAACC,sBAAsB,CAC7CrG,eAAe,EACfkC,iBACF,CAAC;MACDV,eAAe,CAACqE,QAAQ,CAACN,IAAI,CAC3B,iBAAiBa,WAAW,CAACE,KAAK,EAAE,EACpC,gBAAgBF,WAAW,CAACG,IAAI,GAAG,EACnC,yBAAyBH,WAAW,CAAC5E,eAAe,CAAC0E,IAAI,CAAC,IAAI,CAAC,EACjE,CAAC;IACH;;IAEA;IACA,IAAIhE,iBAAiB,CAACsE,cAAc,EAAEC,YAAY,EAAE;MAClDjF,eAAe,CAACwE,WAAW,CAACT,IAAI,CAC9BrD,iBAAiB,CAACsE,cAAc,CAACC,YACnC,CAAC;IACH;IAEA,OAAOjF,eAAe;EACxB;;EAEA;AACF;AACA;EACE6E,sBAAsBA,CAACrG,eAAe,EAAE0G,aAAa,EAAE;IACrD,IAAI1G,eAAe,CAAC+B,MAAM,KAAK,CAAC,EAAE;MAChC,OAAO;QAAEuE,KAAK,EAAE,aAAa;QAAEC,IAAI,EAAE,CAAC;QAAE/E,eAAe,EAAE;MAAG,CAAC;IAC/D;IAEA,MAAMmF,MAAM,GAAG3G,eAAe,CAACc,GAAG,CAAC8F,CAAC,IAAIA,CAAC,CAACvD,QAAQ,CAAC,CAACwD,OAAO,CAAC,CAAC;IAC7DF,MAAM,CAACpB,IAAI,CAACmB,aAAa,CAACrD,QAAQ,CAAC;IAEnC,MAAMyD,YAAY,GAAGH,MAAM,CAAC,CAAC,CAAC;IAC9B,MAAMI,WAAW,GAAGJ,MAAM,CAACA,MAAM,CAAC5E,MAAM,GAAG,CAAC,CAAC;IAC7C,MAAMqE,WAAW,GAAI,CAACW,WAAW,GAAGD,YAAY,IAAIA,YAAY,GAAI,GAAG;IAEvE,IAAIR,KAAK,GAAG,OAAO;IACnB,IAAIF,WAAW,GAAG,EAAE,EAAEE,KAAK,GAAG,YAAY;IAC1C,IAAIF,WAAW,GAAG,EAAE,EAAEE,KAAK,GAAG,UAAU;IACxC,IAAIF,WAAW,GAAG,CAAC,EAAE,EAAEE,KAAK,GAAG,cAAc;IAC7C,IAAIF,WAAW,GAAG,CAAC,EAAE,EAAEE,KAAK,GAAG,YAAY;IAE3C,OAAO;MACLA,KAAK;MACLC,IAAI,EAAES,IAAI,CAACC,KAAK,CAACb,WAAW,CAAC;MAC7B5E,eAAe,EAAE,IAAI,CAAC0F,+BAA+B,CAACZ,KAAK,EAAEF,WAAW;IAC1E,CAAC;EACH;;EAEA;AACF;AACA;EACEc,+BAA+BA,CAACZ,KAAK,EAAEF,WAAW,EAAE;IAClD,MAAM5E,eAAe,GAAG,EAAE;IAE1B,IAAI4E,WAAW,GAAG,EAAE,EAAE;MACpB5E,eAAe,CAAC+D,IAAI,CAClB,8BAA8B,EAC9B,+BACF,CAAC;IACH,CAAC,MAAM,IAAIa,WAAW,GAAG,EAAE,EAAE;MAC3B5E,eAAe,CAAC+D,IAAI,CAClB,oCACF,CAAC;IACH,CAAC,MAAM,IAAIa,WAAW,GAAG,CAAC,EAAE;MAC1B5E,eAAe,CAAC+D,IAAI,CAClB,gCAAgC,EAChC,cACF,CAAC;IACH,CAAC,MAAM,IAAIa,WAAW,IAAI,CAAC,EAAE,EAAE;MAC7B5E,eAAe,CAAC+D,IAAI,CAClB,yBAAyB,EACzB,4BACF,CAAC;IACH,CAAC,MAAM;MACL/D,eAAe,CAAC+D,IAAI,CAClB,kBAAkB,EAClB,wBAAwB,EACxB,yBACF,CAAC;IACH;IAEA,OAAO/D,eAAe;EACxB;;EAEA;AACF;AACA;EACE,MAAM6C,aAAaA,CAACnE,aAAa,EAAEiH,SAAS,EAAE;IAC5C;IACA;IACA,OAAO,IAAI;EACb;;EAEA;AACF;AACA;EACE9B,+BAA+BA,CAAC+B,aAAa,GAAG,EAAE,EAAE;IAClD,MAAMC,IAAI,GAAG,IAAIxF,IAAI,CAAC,CAAC;IACvBwF,IAAI,CAACC,OAAO,CAACD,IAAI,CAACE,OAAO,CAAC,CAAC,GAAIH,aAAa,GAAG,CAAE,CAAC;IAClD,OAAOC,IAAI;EACb;;EAEA;AACF;AACA;EACExC,sBAAsBA,CAAClC,OAAO,EAAET,iBAAiB,EAAE;IACjD,OAAO,CACL,sBAAsBS,OAAO,CAAC6E,kBAAkB,CAACtB,IAAI,CAAC,IAAI,CAAC,EAAE,EAC7D,wBAAwBhE,iBAAiB,CAACwB,YAAY,EAAE,EACxD,kBAAkBf,OAAO,CAAC8E,UAAU,CAACpG,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAACP,GAAG,CAAC4G,CAAC,IAAIA,CAAC,CAACC,WAAW,CAAC,CAACzB,IAAI,CAAC,IAAI,CAAC,EAAE,CACtF,CAACA,IAAI,CAAC,KAAK,CAAC;EACf;;EAEA;AACF;AACA;EACE,MAAM0B,yBAAyBA,CAAC1H,aAAa,EAAE;IAC7C,IAAI;MACF;MACA,MAAM2H,aAAa,GAAG,MAAMvI,iBAAiB,CAACW,IAAI,CAAC;QACjDC,aAAa;QACbsC,MAAM,EAAE;MACV,CAAC,CAAC,CACClC,IAAI,CAAC;QAAEC,iBAAiB,EAAE,CAAC;MAAE,CAAC,CAAC,CAC/BC,KAAK,CAAC,EAAE,CAAC,CACTV,QAAQ,CAAC,QAAQ,CAAC,CAClBA,QAAQ,CAAC,eAAe,CAAC;;MAE5B;MACA,MAAMgI,cAAc,GAAG,MAAMtI,eAAe,CAACS,IAAI,CAAC;QAChDC,aAAa;QACb+E,aAAa,EAAE;MACjB,CAAC,CAAC,CACCnF,QAAQ,CAAC,WAAW,CAAC;;MAExB;MACA,MAAM;QAAEiI;MAAoB,CAAC,GAAG1I,OAAO,CAAC,qBAAqB,CAAC;MAC9D,MAAM2I,GAAG,GAAG,MAAMD,mBAAmB,CAAC/C,OAAO,CAAC;QAC5C9E,aAAa;QACbsC,MAAM,EAAE;UAAEyF,GAAG,EAAE,CAAC,QAAQ,EAAE,cAAc;QAAE;MAC5C,CAAC,CAAC;MAEF,OAAO;QACL/H,aAAa;QACbgI,kBAAkB,EAAEL,aAAa;QACjCC,cAAc,EAAEA,cAAc;QAC9BK,cAAc,EAAEH,GAAG;QACnBI,WAAW,EAAE,IAAIvG,IAAI,CAAC;MACxB,CAAC;IACH,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;MAC7C,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACE,MAAMqG,yBAAyBA,CAACC,iBAAiB,EAAE;IACjD,MAAMC,QAAQ,GAAG,MAAM/I,eAAe,CAACK,QAAQ,CAACyI,iBAAiB,CAAC;IAElE,IAAI,CAACC,QAAQ,EAAE;MACb,MAAM,IAAIxI,KAAK,CAAC,6BAA6B,CAAC;IAChD;;IAEA;IACA,MAAMyI,aAAa,GAAG;MACpBC,cAAc,EAAGF,QAAQ,CAACG,iBAAiB,GAAGH,QAAQ,CAACI,oBAAoB,GAAI,GAAG;MAClFC,aAAa,EAAEL,QAAQ,CAACM,iBAAiB,CAACnG,MAAM,CAC9CoG,GAAG,IAAIA,GAAG,CAACtG,MAAM,KAAK,KAAK,IAAIsG,GAAG,CAACtG,MAAM,KAAK,UAChD,CAAC,CAACT,MAAM;MACRgH,eAAe,EAAER,QAAQ,CAACM,iBAAiB,CAAC9G,MAAM;MAClDiH,oBAAoB,EAAET,QAAQ,CAACU,UAAU,EAAED,oBAAoB,IAAI,CAAC;MACpEE,UAAU,EAAEX,QAAQ,CAACU,UAAU,EAAEE,eAAe,IAAI,CAAC;MACrDC,oBAAoB,EAAE,IAAI,CAACC,6BAA6B,CAACd,QAAQ;IACnE,CAAC;IAED,OAAOC,aAAa;EACtB;;EAEA;AACF;AACA;EACEa,6BAA6BA,CAACd,QAAQ,EAAE;IACtC,MAAM3E,OAAO,GAAG;MACd0F,UAAU,EAAE,IAAI;MAChBC,oBAAoB,EAAE,IAAI;MAC1BC,gBAAgB,EAAE,IAAI;MACtBN,UAAU,EAAE;IACd,CAAC;IAED,MAAMT,cAAc,GAAIF,QAAQ,CAACG,iBAAiB,GAAGH,QAAQ,CAACI,oBAAoB,GAAI,GAAG;IACzF,MAAMc,aAAa,GAAIlB,QAAQ,CAACM,iBAAiB,CAACnG,MAAM,CACtDoG,GAAG,IAAIA,GAAG,CAACtG,MAAM,KAAK,KAAK,IAAIsG,GAAG,CAACtG,MAAM,KAAK,UAChD,CAAC,CAACT,MAAM,GAAGwG,QAAQ,CAACM,iBAAiB,CAAC9G,MAAM,GAAI,GAAG;IACnD,MAAM2H,SAAS,GAAGnB,QAAQ,CAACU,UAAU,EAAED,oBAAoB,IAAI,CAAC;IAChE,MAAMW,cAAc,GAAGpB,QAAQ,CAACU,UAAU,EAAEE,eAAe,IAAI,CAAC;IAEhE,OAAO,CACL,CAACV,cAAc,GAAG7E,OAAO,CAAC0F,UAAU,GACnCG,aAAa,GAAG7F,OAAO,CAAC2F,oBAAoB,GAC5CG,SAAS,GAAG9F,OAAO,CAAC4F,gBAAgB,GACpCG,cAAc,GAAG/F,OAAO,CAACsF,UAAU,IAAI,GAAG,EAC3CU,OAAO,CAAC,CAAC,CAAC;EACd;AACF;AAEAC,MAAM,CAACC,OAAO,GAAGrK,6BAA6B","ignoreList":[]}