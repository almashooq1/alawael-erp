de76f31af7695ee2cc82297769468b60
// Database Configuration
// ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™

const mongoose = require('mongoose');

// MongoDB Connection Configuration
const dbConfig = {
  development: {
    url: process.env.MONGODB_URL || 'mongodb://localhost:27017/erp_new',
    options: {
      retryWrites: false,
      serverSelectionTimeoutMS: 16000,
      // Increased from 5000ms to handle timeout issues
      socketTimeoutMS: 45000,
      // Connection socket timeout
      connectTimeoutMS: 10000,
      // Initial connection timeout
      maxPoolSize: 10,
      // Connection pooling
      minPoolSize: 5
    }
  },
  production: {
    url: process.env.MONGODB_PROD_URL || 'mongodb+srv://user:password@cluster.mongodb.net/erp_prod',
    options: {
      retryWrites: true,
      w: 'majority',
      serverSelectionTimeoutMS: 30000,
      socketTimeoutMS: 45000,
      connectTimeoutMS: 10000,
      maxPoolSize: 20,
      minPoolSize: 10
    }
  },
  test: {
    url: process.env.MONGODB_TEST_URL || 'mongodb://localhost:27017/erp_test',
    options: {
      retryWrites: false,
      serverSelectionTimeoutMS: 16000,
      socketTimeoutMS: 45000,
      connectTimeoutMS: 10000,
      maxPoolSize: 10,
      minPoolSize: 5
    }
  }
};

// Get current environment config
const env = process.env.NODE_ENV || 'development';
const config = dbConfig[env];

// Connection function
const connectDB = async () => {
  // Check if using Mock DB
  if (process.env.USE_MOCK_DB === 'true') {
    console.log(`\nüì¶ Using Mock Database (Development Mode)`);
    console.log(`   Environment: ${env}`);
    console.log(`   ‚úÖ Mock DB ready - No MongoDB required\n`);
    return {
      connection: {
        host: 'mock',
        name: 'mock-db'
      }
    };
  }
  try {
    console.log(`\nüì° Connecting to MongoDB (${env})...`);
    console.log(`   URL: ${config.url}`);
    const conn = await mongoose.connect(config.url, config.options);
    console.log(`‚úÖ MongoDB connected successfully`);
    console.log(`   Host: ${conn.connection.host}`);
    console.log(`   Database: ${conn.connection.name}`);
    console.log(`   Collections: ${Object.keys(conn.connection.collections).length}\n`);
    return conn;
  } catch (error) {
    console.error(`\n‚ùå MongoDB connection failed:`);
    console.error(`   Error: ${error.message}`);
    console.error(`\nüí° TIP: Set USE_MOCK_DB=true in .env to use Mock DB\n`);
    process.exit(1);
  }
};

// Disconnect function
const disconnectDB = async () => {
  try {
    await mongoose.disconnect();
    console.log('‚úÖ MongoDB disconnected');
  } catch (error) {
    console.error('‚ùå Error disconnecting MongoDB:', error.message);
  }
};

// Connection event listeners
mongoose.connection.on('connected', () => {
  console.log('üîó Mongoose connected');
});
mongoose.connection.on('disconnected', () => {
  console.log('üîå Mongoose disconnected');
});
mongoose.connection.on('error', error => {
  console.error('‚ùå Mongoose connection error:', error.message);
});
module.exports = {
  connectDB,
  disconnectDB,
  mongoose
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJkYkNvbmZpZyIsImRldmVsb3BtZW50IiwidXJsIiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfVVJMIiwib3B0aW9ucyIsInJldHJ5V3JpdGVzIiwic2VydmVyU2VsZWN0aW9uVGltZW91dE1TIiwic29ja2V0VGltZW91dE1TIiwiY29ubmVjdFRpbWVvdXRNUyIsIm1heFBvb2xTaXplIiwibWluUG9vbFNpemUiLCJwcm9kdWN0aW9uIiwiTU9OR09EQl9QUk9EX1VSTCIsInciLCJ0ZXN0IiwiTU9OR09EQl9URVNUX1VSTCIsIk5PREVfRU5WIiwiY29uZmlnIiwiY29ubmVjdERCIiwiVVNFX01PQ0tfREIiLCJjb25zb2xlIiwibG9nIiwiY29ubmVjdGlvbiIsImhvc3QiLCJuYW1lIiwiY29ubiIsImNvbm5lY3QiLCJPYmplY3QiLCJrZXlzIiwiY29sbGVjdGlvbnMiLCJsZW5ndGgiLCJlcnJvciIsIm1lc3NhZ2UiLCJleGl0IiwiZGlzY29ubmVjdERCIiwiZGlzY29ubmVjdCIsIm9uIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImRhdGFiYXNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIERhdGFiYXNlIENvbmZpZ3VyYXRpb25cclxuLy8g2KXYudiv2KfYr9in2Kog2YLYp9i52K/YqSDYp9mE2KjZitin2YbYp9iqXHJcblxyXG5jb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG4vLyBNb25nb0RCIENvbm5lY3Rpb24gQ29uZmlndXJhdGlvblxyXG5jb25zdCBkYkNvbmZpZyA9IHtcclxuICBkZXZlbG9wbWVudDoge1xyXG4gICAgdXJsOiBwcm9jZXNzLmVudi5NT05HT0RCX1VSTCB8fCAnbW9uZ29kYjovL2xvY2FsaG9zdDoyNzAxNy9lcnBfbmV3JyxcclxuICAgIG9wdGlvbnM6IHtcclxuICAgICAgcmV0cnlXcml0ZXM6IGZhbHNlLFxyXG4gICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDE2MDAwLCAgLy8gSW5jcmVhc2VkIGZyb20gNTAwMG1zIHRvIGhhbmRsZSB0aW1lb3V0IGlzc3Vlc1xyXG4gICAgICBzb2NrZXRUaW1lb3V0TVM6IDQ1MDAwLCAgICAgICAgICAgIC8vIENvbm5lY3Rpb24gc29ja2V0IHRpbWVvdXRcclxuICAgICAgY29ubmVjdFRpbWVvdXRNUzogMTAwMDAsICAgICAgICAgICAvLyBJbml0aWFsIGNvbm5lY3Rpb24gdGltZW91dFxyXG4gICAgICBtYXhQb29sU2l6ZTogMTAsICAgICAgICAgICAgICAgICAgIC8vIENvbm5lY3Rpb24gcG9vbGluZ1xyXG4gICAgICBtaW5Qb29sU2l6ZTogNSxcclxuICAgIH0sXHJcbiAgfSxcclxuICBwcm9kdWN0aW9uOiB7XHJcbiAgICB1cmw6IHByb2Nlc3MuZW52Lk1PTkdPREJfUFJPRF9VUkwgfHwgJ21vbmdvZGIrc3J2Oi8vdXNlcjpwYXNzd29yZEBjbHVzdGVyLm1vbmdvZGIubmV0L2VycF9wcm9kJyxcclxuICAgIG9wdGlvbnM6IHtcclxuICAgICAgcmV0cnlXcml0ZXM6IHRydWUsXHJcbiAgICAgIHc6ICdtYWpvcml0eScsXHJcbiAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogMzAwMDAsXHJcbiAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIGNvbm5lY3RUaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICBtYXhQb29sU2l6ZTogMjAsXHJcbiAgICAgIG1pblBvb2xTaXplOiAxMCxcclxuICAgIH0sXHJcbiAgfSxcclxuICB0ZXN0OiB7XHJcbiAgICB1cmw6IHByb2Nlc3MuZW52Lk1PTkdPREJfVEVTVF9VUkwgfHwgJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvZXJwX3Rlc3QnLFxyXG4gICAgb3B0aW9uczoge1xyXG4gICAgICByZXRyeVdyaXRlczogZmFsc2UsXHJcbiAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogMTYwMDAsXHJcbiAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIGNvbm5lY3RUaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICBtYXhQb29sU2l6ZTogMTAsXHJcbiAgICAgIG1pblBvb2xTaXplOiA1LFxyXG4gICAgfSxcclxuICB9LFxyXG59O1xyXG5cclxuLy8gR2V0IGN1cnJlbnQgZW52aXJvbm1lbnQgY29uZmlnXHJcbmNvbnN0IGVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCc7XHJcbmNvbnN0IGNvbmZpZyA9IGRiQ29uZmlnW2Vudl07XHJcblxyXG4vLyBDb25uZWN0aW9uIGZ1bmN0aW9uXHJcbmNvbnN0IGNvbm5lY3REQiA9IGFzeW5jICgpID0+IHtcclxuICAvLyBDaGVjayBpZiB1c2luZyBNb2NrIERCXHJcbiAgaWYgKHByb2Nlc3MuZW52LlVTRV9NT0NLX0RCID09PSAndHJ1ZScpIHtcclxuICAgIGNvbnNvbGUubG9nKGBcXG7wn5OmIFVzaW5nIE1vY2sgRGF0YWJhc2UgKERldmVsb3BtZW50IE1vZGUpYCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgRW52aXJvbm1lbnQ6ICR7ZW52fWApO1xyXG4gICAgY29uc29sZS5sb2coYCAgIOKchSBNb2NrIERCIHJlYWR5IC0gTm8gTW9uZ29EQiByZXF1aXJlZFxcbmApO1xyXG4gICAgcmV0dXJuIHsgY29ubmVjdGlvbjogeyBob3N0OiAnbW9jaycsIG5hbWU6ICdtb2NrLWRiJyB9IH07XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coYFxcbvCfk6EgQ29ubmVjdGluZyB0byBNb25nb0RCICgke2Vudn0pLi4uYCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgVVJMOiAke2NvbmZpZy51cmx9YCk7XHJcblxyXG4gICAgY29uc3QgY29ubiA9IGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QoY29uZmlnLnVybCwgY29uZmlnLm9wdGlvbnMpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGDinIUgTW9uZ29EQiBjb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5YCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAgSG9zdDogJHtjb25uLmNvbm5lY3Rpb24uaG9zdH1gKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICBEYXRhYmFzZTogJHtjb25uLmNvbm5lY3Rpb24ubmFtZX1gKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICBDb2xsZWN0aW9uczogJHtPYmplY3Qua2V5cyhjb25uLmNvbm5lY3Rpb24uY29sbGVjdGlvbnMpLmxlbmd0aH1cXG5gKTtcclxuXHJcbiAgICByZXR1cm4gY29ubjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihgXFxu4p2MIE1vbmdvREIgY29ubmVjdGlvbiBmYWlsZWQ6YCk7XHJcbiAgICBjb25zb2xlLmVycm9yKGAgICBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgY29uc29sZS5lcnJvcihgXFxu8J+SoSBUSVA6IFNldCBVU0VfTU9DS19EQj10cnVlIGluIC5lbnYgdG8gdXNlIE1vY2sgREJcXG5gKTtcclxuXHJcbiAgICBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRGlzY29ubmVjdCBmdW5jdGlvblxyXG5jb25zdCBkaXNjb25uZWN0REIgPSBhc3luYyAoKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IG1vbmdvb3NlLmRpc2Nvbm5lY3QoKTtcclxuICAgIGNvbnNvbGUubG9nKCfinIUgTW9uZ29EQiBkaXNjb25uZWN0ZWQnKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRpc2Nvbm5lY3RpbmcgTW9uZ29EQjonLCBlcnJvci5tZXNzYWdlKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBDb25uZWN0aW9uIGV2ZW50IGxpc3RlbmVyc1xyXG5tb25nb29zZS5jb25uZWN0aW9uLm9uKCdjb25uZWN0ZWQnLCAoKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ/CflJcgTW9uZ29vc2UgY29ubmVjdGVkJyk7XHJcbn0pO1xyXG5cclxubW9uZ29vc2UuY29ubmVjdGlvbi5vbignZGlzY29ubmVjdGVkJywgKCkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKCfwn5SMIE1vbmdvb3NlIGRpc2Nvbm5lY3RlZCcpO1xyXG59KTtcclxuXHJcbm1vbmdvb3NlLmNvbm5lY3Rpb24ub24oJ2Vycm9yJywgZXJyb3IgPT4ge1xyXG4gIGNvbnNvbGUuZXJyb3IoJ+KdjCBNb25nb29zZSBjb25uZWN0aW9uIGVycm9yOicsIGVycm9yLm1lc3NhZ2UpO1xyXG59KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIGNvbm5lY3REQixcclxuICBkaXNjb25uZWN0REIsXHJcbiAgbW9uZ29vc2UsXHJcbn07XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTs7QUFFQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7O0FBRXBDO0FBQ0EsTUFBTUMsUUFBUSxHQUFHO0VBQ2ZDLFdBQVcsRUFBRTtJQUNYQyxHQUFHLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxXQUFXLElBQUksbUNBQW1DO0lBQ25FQyxPQUFPLEVBQUU7TUFDUEMsV0FBVyxFQUFFLEtBQUs7TUFDbEJDLHdCQUF3QixFQUFFLEtBQUs7TUFBRztNQUNsQ0MsZUFBZSxFQUFFLEtBQUs7TUFBYTtNQUNuQ0MsZ0JBQWdCLEVBQUUsS0FBSztNQUFZO01BQ25DQyxXQUFXLEVBQUUsRUFBRTtNQUFvQjtNQUNuQ0MsV0FBVyxFQUFFO0lBQ2Y7RUFDRixDQUFDO0VBQ0RDLFVBQVUsRUFBRTtJQUNWWCxHQUFHLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDVSxnQkFBZ0IsSUFBSSwwREFBMEQ7SUFDL0ZSLE9BQU8sRUFBRTtNQUNQQyxXQUFXLEVBQUUsSUFBSTtNQUNqQlEsQ0FBQyxFQUFFLFVBQVU7TUFDYlAsd0JBQXdCLEVBQUUsS0FBSztNQUMvQkMsZUFBZSxFQUFFLEtBQUs7TUFDdEJDLGdCQUFnQixFQUFFLEtBQUs7TUFDdkJDLFdB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