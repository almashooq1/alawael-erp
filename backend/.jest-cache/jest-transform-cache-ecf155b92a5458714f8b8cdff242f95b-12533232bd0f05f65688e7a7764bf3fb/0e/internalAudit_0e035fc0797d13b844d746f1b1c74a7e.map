{"version":3,"names":["express","require","router","Router","authenticate","authorize","AnnualAuditPlan","SurpriseAudit","NonConformanceReport","CorrectivePreventiveAction","ClosureFollowUp","post","req","res","plan","body","createdBy","user","_id","save","status","json","success","message","data","error","get","year","page","limit","query","filter","plans","find","skip","sort","createdDate","total","countDocuments","pages","Math","ceil","findOne","planId","params","put","findOneAndUpdate","lastModifiedBy","lastModifiedDate","Date","new","audit","department","audits","auditId","$push","observations","report","reportedBy","category","reports","ncrId","ownerId","ownerName","ownerDepartment","ownerEmail","verificationMethod","comments","action","type","actions","actionId","progressPercentage","results","isEffective","score","overallStatus","comment","followUp","linkedType","statusOverall","followUps","followUpId","allMet","notes","approvalStatus","rejectionReason","totalPlans","activePlans","totalAudits","completedAudits","totalNCRs","openNCRs","criticalNCRs","totalActions","completeActions","totalFollowUps","closedFollowUps","auditPlans","active","completionRate","toFixed","surpriseAudits","completed","nonConformances","open","critical","openRate","closed","closureRate","aggregate","$group","$sum","criticalCount","$cond","$eq","majorCount","minorCount","$sort","count","avgProgress","$avg","module","exports"],"sources":["internalAudit.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { authenticate, authorize } = require('../middleware/auth');\r\n\r\n// استيراد النماذج\r\nconst {\r\n  AnnualAuditPlan,\r\n  SurpriseAudit,\r\n  NonConformanceReport,\r\n  CorrectivePreventiveAction,\r\n  ClosureFollowUp,\r\n} = require('../models/internalAudit');\r\n\r\n// ==========================================\r\n// 1. ANNUAL AUDIT PLAN ROUTES - خطط التدقيق السنوية\r\n// ==========================================\r\n\r\n// إنشاء خطة تدقيق سنوية جديدة\r\nrouter.post('/audit-plans', authenticate, authorize('admin', 'audit_manager'), async (req, res) => {\r\n  try {\r\n    const plan = new AnnualAuditPlan({\r\n      ...req.body,\r\n      createdBy: req.user._id,\r\n    });\r\n    await plan.save();\r\n    res.status(201).json({\r\n      success: true,\r\n      message: 'تم إنشاء خطة التدقيق بنجاح',\r\n      data: plan,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'خطأ في إنشاء خطة التدقيق',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// الحصول على جميع خطط التدقيق\r\nrouter.get('/audit-plans', authenticate, async (req, res) => {\r\n  try {\r\n    const { year, status, page = 1, limit = 10 } = req.query;\r\n    const filter = {};\r\n    if (year) filter.year = year;\r\n    if (status) filter.status = status;\r\n\r\n    const plans = await AnnualAuditPlan.find(filter)\r\n      .limit(limit * 1)\r\n      .skip((page - 1) * limit)\r\n      .sort({ createdDate: -1 });\r\n\r\n    const total = await AnnualAuditPlan.countDocuments(filter);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: plans,\r\n      total,\r\n      pages: Math.ceil(total / limit),\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// الحصول على خطة تدقيق محددة\r\nrouter.get('/audit-plans/:planId', authenticate, async (req, res) => {\r\n  try {\r\n    const plan = await AnnualAuditPlan.findOne({ planId: req.params.planId });\r\n    if (!plan) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'خطة التدقيق غير موجودة',\r\n      });\r\n    }\r\n    res.json({ success: true, data: plan });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تحديث خطة تدقيق\r\nrouter.put(\r\n  '/audit-plans/:planId',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const plan = await AnnualAuditPlan.findOneAndUpdate(\r\n        { planId: req.params.planId },\r\n        {\r\n          ...req.body,\r\n          lastModifiedBy: req.user._id,\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث خطة التدقيق بنجاح',\r\n        data: plan,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// ==========================================\r\n// 2. SURPRISE AUDIT ROUTES - عمليات التدقيق المفاجئة\r\n// ==========================================\r\n\r\n// إنشاء تدقيق مفاجئ\r\nrouter.post(\r\n  '/surprise-audits',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const audit = new SurpriseAudit({\r\n        ...req.body,\r\n        createdBy: req.user._id,\r\n      });\r\n      await audit.save();\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'تم إنشاء عملية التدقيق المفاجئة بنجاح',\r\n        data: audit,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// الحصول على عمليات التدقيق المفاجئة\r\nrouter.get('/surprise-audits', authenticate, async (req, res) => {\r\n  try {\r\n    const { status, department, page = 1, limit = 10 } = req.query;\r\n    const filter = {};\r\n    if (status) filter.status = status;\r\n    if (department) filter['auditScope.departmentId'] = department;\r\n\r\n    const audits = await SurpriseAudit.find(filter)\r\n      .limit(limit * 1)\r\n      .skip((page - 1) * limit)\r\n      .sort({ createdDate: -1 });\r\n\r\n    const total = await SurpriseAudit.countDocuments(filter);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: audits,\r\n      total,\r\n      pages: Math.ceil(total / limit),\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// الحصول على تفاصيل تدقيق محدد\r\nrouter.get('/surprise-audits/:auditId', authenticate, async (req, res) => {\r\n  try {\r\n    const audit = await SurpriseAudit.findOne({ auditId: req.params.auditId });\r\n    if (!audit) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'عملية التدقيق غير موجودة',\r\n      });\r\n    }\r\n    res.json({ success: true, data: audit });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تحديث حالة التدقيق\r\nrouter.put(\r\n  '/surprise-audits/:auditId',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const audit = await SurpriseAudit.findOneAndUpdate(\r\n        { auditId: req.params.auditId },\r\n        {\r\n          ...req.body,\r\n          lastModifiedBy: req.user._id,\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث عملية التدقيق بنجاح',\r\n        data: audit,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// إضافة ملاحظات تدقيق\r\nrouter.post(\r\n  '/surprise-audits/:auditId/observations',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const audit = await SurpriseAudit.findOneAndUpdate(\r\n        { auditId: req.params.auditId },\r\n        {\r\n          $push: { observations: req.body },\r\n          lastModifiedBy: req.user._id,\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تمت إضافة الملاحظة بنجاح',\r\n        data: audit,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// ==========================================\r\n// 3. NON-CONFORMANCE REPORTS ROUTES - تقارير عدم المطابقة\r\n// ==========================================\r\n\r\n// إنشاء تقرير عدم مطابقة\r\nrouter.post('/non-conformance-reports', authenticate, async (req, res) => {\r\n  try {\r\n    const report = new NonConformanceReport({\r\n      ...req.body,\r\n      reportedBy: req.user._id,\r\n      createdBy: req.user._id,\r\n    });\r\n    await report.save();\r\n    res.status(201).json({\r\n      success: true,\r\n      message: 'تم إنشاء تقرير عدم المطابقة بنجاح',\r\n      data: report,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// الحصول على جميع تقارير عدم المطابقة\r\nrouter.get('/non-conformance-reports', authenticate, async (req, res) => {\r\n  try {\r\n    const { status, category, department, page = 1, limit = 10 } = req.query;\r\n    const filter = {};\r\n    if (status) filter.status = status;\r\n    if (category) filter['classification.category'] = category;\r\n    if (department) filter['details.affectedDepartment'] = department;\r\n\r\n    const reports = await NonConformanceReport.find(filter)\r\n      .limit(limit * 1)\r\n      .skip((page - 1) * limit)\r\n      .sort({ createdDate: -1 });\r\n\r\n    const total = await NonConformanceReport.countDocuments(filter);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: reports,\r\n      total,\r\n      pages: Math.ceil(total / limit),\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// الحصول على تقرير محدد\r\nrouter.get('/non-conformance-reports/:ncrId', authenticate, async (req, res) => {\r\n  try {\r\n    const report = await NonConformanceReport.findOne({ ncrId: req.params.ncrId });\r\n    if (!report) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'التقرير غير موجود',\r\n      });\r\n    }\r\n    res.json({ success: true, data: report });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تحديث تقرير عدم المطابقة\r\nrouter.put('/non-conformance-reports/:ncrId', authenticate, async (req, res) => {\r\n  try {\r\n    const report = await NonConformanceReport.findOneAndUpdate(\r\n      { ncrId: req.params.ncrId },\r\n      {\r\n        ...req.body,\r\n        lastModifiedBy: req.user._id,\r\n        lastModifiedDate: new Date(),\r\n      },\r\n      { new: true }\r\n    );\r\n    res.json({\r\n      success: true,\r\n      message: 'تم تحديث التقرير بنجاح',\r\n      data: report,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تعيين المالك للتقرير\r\nrouter.put(\r\n  '/non-conformance-reports/:ncrId/assign',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const report = await NonConformanceReport.findOneAndUpdate(\r\n        { ncrId: req.params.ncrId },\r\n        {\r\n          'ownership.ownerId': req.body.ownerId,\r\n          'ownership.ownerName': req.body.ownerName,\r\n          'ownership.ownerDepartment': req.body.ownerDepartment,\r\n          'ownership.ownerEmail': req.body.ownerEmail,\r\n          'ownership.assignmentDate': new Date(),\r\n          status: 'acknowledged',\r\n          lastModifiedBy: req.user._id,\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تعيين المالك بنجاح',\r\n        data: report,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// إغلاق تقرير عدم المطابقة\r\nrouter.put(\r\n  '/non-conformance-reports/:ncrId/close',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const report = await NonConformanceReport.findOneAndUpdate(\r\n        { ncrId: req.params.ncrId },\r\n        {\r\n          status: 'closed',\r\n          'closingInfo.closedDate': new Date(),\r\n          'closingInfo.closedBy': req.user._id,\r\n          'closingInfo.verificationMethod': req.body.verificationMethod,\r\n          'closingInfo.closingComments': req.body.comments,\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم إغلاق التقرير بنجاح',\r\n        data: report,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// ==========================================\r\n// 4. CORRECTIVE/PREVENTIVE ACTIONS ROUTES - الخطط التصحيحية والوقائية\r\n// ==========================================\r\n\r\n// إنشاء إجراء تصحيحي أو وقائي\r\nrouter.post('/corrective-preventive-actions', authenticate, async (req, res) => {\r\n  try {\r\n    const action = new CorrectivePreventiveAction({\r\n      ...req.body,\r\n      createdBy: req.user._id,\r\n    });\r\n    await action.save();\r\n    res.status(201).json({\r\n      success: true,\r\n      message: 'تم إنشاء الإجراء بنجاح',\r\n      data: action,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// الحصول على جميع الإجراءات\r\nrouter.get('/corrective-preventive-actions', authenticate, async (req, res) => {\r\n  try {\r\n    const { type, status, page = 1, limit = 10 } = req.query;\r\n    const filter = {};\r\n    if (type) filter.type = type;\r\n    if (status) filter['implementation.status'] = status;\r\n\r\n    const actions = await CorrectivePreventiveAction.find(filter)\r\n      .limit(limit * 1)\r\n      .skip((page - 1) * limit)\r\n      .sort({ createdDate: -1 });\r\n\r\n    const total = await CorrectivePreventiveAction.countDocuments(filter);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: actions,\r\n      total,\r\n      pages: Math.ceil(total / limit),\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// الحصول على إجراء محدد\r\nrouter.get('/corrective-preventive-actions/:actionId', authenticate, async (req, res) => {\r\n  try {\r\n    const action = await CorrectivePreventiveAction.findOne({ actionId: req.params.actionId });\r\n    if (!action) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'الإجراء غير موجود',\r\n      });\r\n    }\r\n    res.json({ success: true, data: action });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تحديث الإجراء\r\nrouter.put('/corrective-preventive-actions/:actionId', authenticate, async (req, res) => {\r\n  try {\r\n    const action = await CorrectivePreventiveAction.findOneAndUpdate(\r\n      { actionId: req.params.actionId },\r\n      {\r\n        ...req.body,\r\n        lastModifiedBy: req.user._id,\r\n        lastModifiedDate: new Date(),\r\n      },\r\n      { new: true }\r\n    );\r\n    res.json({\r\n      success: true,\r\n      message: 'تم تحديث الإجراء بنجاح',\r\n      data: action,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تحديث التقدم\r\nrouter.put('/corrective-preventive-actions/:actionId/progress', authenticate, async (req, res) => {\r\n  try {\r\n    const action = await CorrectivePreventiveAction.findOneAndUpdate(\r\n      { actionId: req.params.actionId },\r\n      {\r\n        'implementation.progressPercentage': req.body.progressPercentage,\r\n        'implementation.status': req.body.status,\r\n        lastModifiedDate: new Date(),\r\n      },\r\n      { new: true }\r\n    );\r\n    res.json({\r\n      success: true,\r\n      message: 'تم تحديث التقدم بنجاح',\r\n      data: action,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// التحقق من الفعالية\r\nrouter.put(\r\n  '/corrective-preventive-actions/:actionId/verify-effectiveness',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const action = await CorrectivePreventiveAction.findOneAndUpdate(\r\n        { actionId: req.params.actionId },\r\n        {\r\n          'effectiveness.verificationDate': new Date(),\r\n          'effectiveness.verificationResults': req.body.results,\r\n          'effectiveness.isEffective': req.body.isEffective,\r\n          'effectiveness.effectivenessScore': req.body.score,\r\n          'effectiveness.verificationBy': req.user._id,\r\n          overallStatus: req.body.isEffective ? 'effective' : 'ineffective',\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم التحقق من الفعالية بنجاح',\r\n        data: action,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// إغلاق الإجراء\r\nrouter.put(\r\n  '/corrective-preventive-actions/:actionId/close',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const action = await CorrectivePreventiveAction.findOneAndUpdate(\r\n        { actionId: req.params.actionId },\r\n        {\r\n          'closure.closureDate': new Date(),\r\n          'closure.closedBy': req.user._id,\r\n          'closure.closureComment': req.body.comment,\r\n          overallStatus: 'closed',\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم إغلاق الإجراء بنجاح',\r\n        data: action,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// ==========================================\r\n// 5. CLOSURE FOLLOW-UP ROUTES - متابعة الإغلاق\r\n// ==========================================\r\n\r\n// إنشاء متابعة إغلاق\r\nrouter.post('/closure-followups', authenticate, async (req, res) => {\r\n  try {\r\n    const followUp = new ClosureFollowUp({\r\n      ...req.body,\r\n      createdBy: req.user._id,\r\n    });\r\n    await followUp.save();\r\n    res.status(201).json({\r\n      success: true,\r\n      message: 'تم إنشاء متابعة الإغلاق بنجاح',\r\n      data: followUp,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// الحصول على متابعات الإغلاق\r\nrouter.get('/closure-followups', authenticate, async (req, res) => {\r\n  try {\r\n    const { status, linkedType, page = 1, limit = 10 } = req.query;\r\n    const filter = {};\r\n    if (status) filter.statusOverall = status;\r\n    if (linkedType) filter['linkedTo.type'] = linkedType;\r\n\r\n    const followUps = await ClosureFollowUp.find(filter)\r\n      .limit(limit * 1)\r\n      .skip((page - 1) * limit)\r\n      .sort({ createdDate: -1 });\r\n\r\n    const total = await ClosureFollowUp.countDocuments(filter);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: followUps,\r\n      total,\r\n      pages: Math.ceil(total / limit),\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// الحصول على متابعة محددة\r\nrouter.get('/closure-followups/:followUpId', authenticate, async (req, res) => {\r\n  try {\r\n    const followUp = await ClosureFollowUp.findOne({ followUpId: req.params.followUpId });\r\n    if (!followUp) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'المتابعة غير موجودة',\r\n      });\r\n    }\r\n    res.json({ success: true, data: followUp });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تحديث متابعة الإغلاق\r\nrouter.put('/closure-followups/:followUpId', authenticate, async (req, res) => {\r\n  try {\r\n    const followUp = await ClosureFollowUp.findOneAndUpdate(\r\n      { followUpId: req.params.followUpId },\r\n      {\r\n        ...req.body,\r\n        lastModifiedBy: req.user._id,\r\n        lastModifiedDate: new Date(),\r\n      },\r\n      { new: true }\r\n    );\r\n    res.json({\r\n      success: true,\r\n      message: 'تم تحديث المتابعة بنجاح',\r\n      data: followUp,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// التحقق من معايير الإغلاق\r\nrouter.put(\r\n  '/closure-followups/:followUpId/verify-closure',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const followUp = await ClosureFollowUp.findOneAndUpdate(\r\n        { followUpId: req.params.followUpId },\r\n        {\r\n          'closureVerification.verificationDate': new Date(),\r\n          'closureVerification.verifiedBy': req.user._id,\r\n          'closureVerification.allCriteriaMet': req.body.allMet,\r\n          'closureVerification.verificationNotes': req.body.notes,\r\n          'followUpInfo.status': req.body.allMet ? 'completed' : 'awaiting-evidence',\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم التحقق من معايير الإغلاق بنجاح',\r\n        data: followUp,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// الموافقة النهائية والإغلاق\r\nrouter.put(\r\n  '/closure-followups/:followUpId/final-closure',\r\n  authenticate,\r\n  authorize('admin', 'audit_manager'),\r\n  async (req, res) => {\r\n    try {\r\n      const followUp = await ClosureFollowUp.findOneAndUpdate(\r\n        { followUpId: req.params.followUpId },\r\n        {\r\n          'finalApproval.approvalStatus': req.body.approvalStatus,\r\n          'finalApproval.approvedBy': req.user._id,\r\n          'finalApproval.approvalDate': new Date(),\r\n          'finalApproval.rejectionReason': req.body.rejectionReason,\r\n          'finalClosure.closureDate': req.body.approvalStatus === 'approved' ? new Date() : null,\r\n          'finalClosure.closedBy': req.body.approvalStatus === 'approved' ? req.user._id : null,\r\n          statusOverall: req.body.approvalStatus === 'approved' ? 'closed' : 'pending',\r\n          lastModifiedDate: new Date(),\r\n        },\r\n        { new: true }\r\n      );\r\n      res.json({\r\n        success: true,\r\n        message: 'تم الموافقة والإغلاق بنجاح',\r\n        data: followUp,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  }\r\n);\r\n\r\n// ==========================================\r\n// DASHBOARD AND REPORTS\r\n// ==========================================\r\n\r\n// لوحة تحكم التدقيق الداخلي\r\nrouter.get('/internal-audit-dashboard', authenticate, async (req, res) => {\r\n  try {\r\n    const totalPlans = await AnnualAuditPlan.countDocuments();\r\n    const activePlans = await AnnualAuditPlan.countDocuments({ status: 'active' });\r\n\r\n    const totalAudits = await SurpriseAudit.countDocuments();\r\n    const completedAudits = await SurpriseAudit.countDocuments({ status: 'completed' });\r\n\r\n    const totalNCRs = await NonConformanceReport.countDocuments();\r\n    const openNCRs = await NonConformanceReport.countDocuments({ status: 'open' });\r\n    const criticalNCRs = await NonConformanceReport.countDocuments({\r\n      'classification.category': 'critical',\r\n    });\r\n\r\n    const totalActions = await CorrectivePreventiveAction.countDocuments();\r\n    const completeActions = await CorrectivePreventiveAction.countDocuments({\r\n      'implementation.status': 'completed',\r\n    });\r\n\r\n    const totalFollowUps = await ClosureFollowUp.countDocuments();\r\n    const closedFollowUps = await ClosureFollowUp.countDocuments({ statusOverall: 'closed' });\r\n\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        auditPlans: {\r\n          total: totalPlans,\r\n          active: activePlans,\r\n          completionRate: totalPlans > 0 ? ((activePlans / totalPlans) * 100).toFixed(2) : 0,\r\n        },\r\n        surpriseAudits: {\r\n          total: totalAudits,\r\n          completed: completedAudits,\r\n          completionRate: totalAudits > 0 ? ((completedAudits / totalAudits) * 100).toFixed(2) : 0,\r\n        },\r\n        nonConformances: {\r\n          total: totalNCRs,\r\n          open: openNCRs,\r\n          critical: criticalNCRs,\r\n          openRate: totalNCRs > 0 ? ((openNCRs / totalNCRs) * 100).toFixed(2) : 0,\r\n        },\r\n        actions: {\r\n          total: totalActions,\r\n          completed: completeActions,\r\n          completionRate:\r\n            totalActions > 0 ? ((completeActions / totalActions) * 100).toFixed(2) : 0,\r\n        },\r\n        followUps: {\r\n          total: totalFollowUps,\r\n          closed: closedFollowUps,\r\n          closureRate:\r\n            totalFollowUps > 0 ? ((closedFollowUps / totalFollowUps) * 100).toFixed(2) : 0,\r\n        },\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تقرير الامتثال بواسطة القسم\r\nrouter.get('/reports/compliance-by-department', authenticate, async (req, res) => {\r\n  try {\r\n    const report = await NonConformanceReport.aggregate([\r\n      {\r\n        $group: {\r\n          _id: '$details.affectedDepartment',\r\n          totalNCRs: { $sum: 1 },\r\n          criticalCount: {\r\n            $sum: {\r\n              $cond: [{ $eq: ['$classification.category', 'critical'] }, 1, 0],\r\n            },\r\n          },\r\n          majorCount: {\r\n            $sum: {\r\n              $cond: [{ $eq: ['$classification.category', 'major'] }, 1, 0],\r\n            },\r\n          },\r\n          minorCount: {\r\n            $sum: {\r\n              $cond: [{ $eq: ['$classification.category', 'minor'] }, 1, 0],\r\n            },\r\n          },\r\n        },\r\n      },\r\n      { $sort: { totalNCRs: -1 } },\r\n    ]);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: report,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\n// تقرير حالة الإجراءات التصحيحية\r\nrouter.get('/reports/actions-status', authenticate, async (req, res) => {\r\n  try {\r\n    const report = await CorrectivePreventiveAction.aggregate([\r\n      {\r\n        $group: {\r\n          _id: '$implementation.status',\r\n          count: { $sum: 1 },\r\n          avgProgress: { $avg: '$implementation.progressPercentage' },\r\n        },\r\n      },\r\n    ]);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: report,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: error.message });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]}