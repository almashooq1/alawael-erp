{"version":3,"names":["EventEmitter","require","uuid","randomUUID","Logger","PushNotificationOptimizer","constructor","pushQueue","Map","deviceTokens","notificationStats","testResults","tokenValidation","registerPushToken","userId","deviceId","pushToken","metadata","tokenRecord","platform","registered","Date","isValid","lastValidated","environment","key","set","info","emit","error","unregisterPushToken","delete","validatePushToken","get","valid","reason","Math","random","message","sendPushNotification","data","notificationId","notification","id","title","body","badge","sound","priority","ttl","collapseKey","customData","action","imageUrl","createdAt","scheduledFor","status","sentAt","deliveredAt","openedAt","clickedAt","stats","sent","delivered","opened","clicked","failureReason","optimized","_optimizeForDevice","sendBatchNotifications","deviceList","results","successful","failed","totalCount","length","device","result","push","processPendingNotifications","processed","now","notifId","_recordNotificationSent","processedCount","recordInteraction","Error","timestamp","_recordNotificationInteraction","getNotificationStats","timeframe","total","deliveryRate","openRate","clickRate","toFixed","testPushDelivery","testId","testNotification","test","testStartTime","deliveryTime","setTimeout","getTime","configureOptimization","settings","optimizationSettings","batteryOptimization","networkOptimization","quietHoursEnabled","quietHoursStart","quietHoursEnd","bundleNotifications","maxNotificationsPerHour","payloadSize","JSON","stringify","_compressPayload","has","payload","essential","essentialFields","field","undefined","module","exports"],"sources":["pushNotificationOptimizer.service.js"],"sourcesContent":["/**\r\n * Push Notifications Optimizer Service\r\n * ÿÆÿØŸÖÿ© ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿØŸÅÿπ ŸÑŸÑŸáÿßÿ™ŸÅ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ\r\n * \r\n * ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäÿßÿ™:\r\n * - ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿ®ÿØŸÅÿπ ŸÅÿπÿßŸÑÿ©\r\n * - ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑÿ¨Ÿáÿßÿ≤ ŸàÿßŸÑÿ¥ÿ®ŸÉÿ©\r\n * - ÿ•ÿØÿßÿ±ÿ© ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑÿ®ÿ∑ÿßÿ±Ÿäÿ©\r\n * - ÿ™ÿ™ÿ®ÿπ ŸÖÿπÿØŸÑÿßÿ™ ÿßŸÑŸÅÿ™ÿ≠ ŸàÿßŸÑŸÜŸÇÿ±\r\n * - ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™\r\n */\r\n\r\nconst EventEmitter = require('events');\r\nconst uuid = require('crypto').randomUUID;\r\nconst { Logger } = require('../utils/logger');\r\n\r\nclass PushNotificationOptimizer extends EventEmitter {\r\n  constructor() {\r\n    super();\r\n    this.pushQueue = new Map();\r\n    this.deviceTokens = new Map();\r\n    this.notificationStats = new Map();\r\n    this.testResults = new Map();\r\n    this.tokenValidation = new Map();\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ±ŸÖÿ≤ ÿ™ŸÜÿ®ŸäŸá ÿßŸÑÿ¨Ÿáÿßÿ≤\r\n   * Register device push token\r\n   */\r\n  registerPushToken(userId, deviceId, pushToken, metadata = {}) {\r\n    try {\r\n      const tokenRecord = {\r\n        userId,\r\n        deviceId,\r\n        pushToken,\r\n        platform: metadata.platform || 'unknown', // iOS, Android, Web\r\n        registered: new Date(),\r\n        isValid: true,\r\n        lastValidated: new Date(),\r\n        environment: metadata.environment || 'production', // production, sandbox\r\n      };\r\n\r\n      const key = `${userId}:${deviceId}`;\r\n      this.deviceTokens.set(key, tokenRecord);\r\n\r\n      Logger.info(`‚úÖ Push token registered for ${deviceId} (${metadata.platform})`);\r\n\r\n      this.emit('token:registered', {\r\n        userId,\r\n        deviceId,\r\n        platform: metadata.platform,\r\n      });\r\n\r\n      return tokenRecord;\r\n    } catch (error) {\r\n      Logger.error('Push token registration error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ≠ÿ∞ŸÅ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ŸÜÿ®ŸäŸá\r\n   * Unregister device push token\r\n   */\r\n  unregisterPushToken(userId, deviceId) {\r\n    const key = `${userId}:${deviceId}`;\r\n    this.deviceTokens.delete(key);\r\n\r\n    Logger.info(`‚ùå Push token unregistered for ${deviceId}`);\r\n\r\n    this.emit('token:unregistered', { userId, deviceId });\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿ±ŸÖÿ≤ ÿßŸÑÿ™ŸÜÿ®ŸäŸá\r\n   * Validate push token\r\n   */\r\n  async validatePushToken(userId, deviceId) {\r\n    try {\r\n      const key = `${userId}:${deviceId}`;\r\n      const tokenRecord = this.deviceTokens.get(key);\r\n\r\n      if (!tokenRecord) {\r\n        return { valid: false, reason: 'Token not found' };\r\n      }\r\n\r\n      // Simulate token validation with provider\r\n      const isValid = Math.random() > 0.05; // 95% valid\r\n\r\n      tokenRecord.isValid = isValid;\r\n      tokenRecord.lastValidated = new Date();\r\n\r\n      if (!isValid) {\r\n        this.emit('token:invalid', { userId, deviceId });\r\n      }\r\n\r\n      return { valid: isValid };\r\n    } catch (error) {\r\n      Logger.error('Token validation error:', error);\r\n      return { valid: false, reason: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÖŸèÿ≠ÿ≥ŸëŸÜ ŸÑŸÑÿØŸÅÿπ\r\n   * Send optimized push notification\r\n   */\r\n  async sendPushNotification(data) {\r\n    try {\r\n      const notificationId = uuid();\r\n      const notification = {\r\n        id: notificationId,\r\n        userId: data.userId,\r\n        deviceId: data.deviceId,\r\n        title: data.title,\r\n        body: data.body,\r\n        badge: data.badge || 1,\r\n        sound: data.sound || 'default',\r\n        priority: data.priority || 'normal', // low, normal, high\r\n        ttl: data.ttl || 3600, // seconds to live\r\n        collapseKey: data.collapseKey || null,\r\n        customData: data.customData || {},\r\n        action: data.action || null,\r\n        imageUrl: data.imageUrl || null,\r\n        createdAt: new Date(),\r\n        scheduledFor: data.scheduledFor || new Date(),\r\n        status: 'pending',\r\n        sentAt: null,\r\n        deliveredAt: null,\r\n        openedAt: null,\r\n        clickedAt: null,\r\n        stats: {\r\n          sent: false,\r\n          delivered: false,\r\n          opened: false,\r\n          clicked: false,\r\n          failureReason: null,\r\n        },\r\n      };\r\n\r\n      // Optimize based on device and network\r\n      const optimized = this._optimizeForDevice(notification);\r\n\r\n      this.pushQueue.set(notificationId, optimized);\r\n\r\n      Logger.info(`üì≤ Push notification queued: ${notificationId}`);\r\n\r\n      this.emit('notification:queued', {\r\n        notificationId,\r\n        userId: data.userId,\r\n        deviceId: data.deviceId,\r\n      });\r\n\r\n      return optimized;\r\n    } catch (error) {\r\n      Logger.error('Push notification error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸÖÿ¨ŸÖŸàÿπŸäÿ©\r\n   * Send batch push notifications\r\n   */\r\n  async sendBatchNotifications(deviceList, notification) {\r\n    try {\r\n      const results = {\r\n        successful: [],\r\n        failed: [],\r\n        totalCount: deviceList.length,\r\n      };\r\n\r\n      for (const device of deviceList) {\r\n        try {\r\n          const result = await this.sendPushNotification({\r\n            ...notification,\r\n            userId: device.userId,\r\n            deviceId: device.deviceId,\r\n          });\r\n\r\n          results.successful.push(result.id);\r\n        } catch (error) {\r\n          results.failed.push({\r\n            device: device.deviceId,\r\n            error: error.message,\r\n          });\r\n        }\r\n      }\r\n\r\n      Logger.info(\r\n        `üì§ Batch push sent: ${results.successful.length}/${results.totalCount} successful`\r\n      );\r\n\r\n      this.emit('batch:sent', results);\r\n\r\n      return results;\r\n    } catch (error) {\r\n      Logger.error('Batch notification error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿπŸÑŸÇÿ©\r\n   * Process pending notifications\r\n   */\r\n  async processPendingNotifications() {\r\n    try {\r\n      let processed = 0;\r\n      const now = new Date();\r\n\r\n      for (const [notifId, notification] of this.pushQueue) {\r\n        if (notification.status === 'pending' && notification.scheduledFor <= now) {\r\n          // Simulate sending\r\n          notification.status = 'sent';\r\n          notification.sentAt = new Date();\r\n\r\n          // Record stats\r\n          this._recordNotificationSent(notification);\r\n\r\n          processed++;\r\n\r\n          this.emit('notification:sent', {\r\n            notificationId: notifId,\r\n            userId: notification.userId,\r\n          });\r\n        }\r\n      }\r\n\r\n      if (processed > 0) {\r\n        Logger.info(`üì¨ Processed ${processed} pending notifications`);\r\n      }\r\n\r\n      return { processedCount: processed };\r\n    } catch (error) {\r\n      Logger.error('Process pending notifications error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ™ŸÅÿßÿπŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿπ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n   * Record notification interaction\r\n   */\r\n  recordInteraction(notificationId, action) {\r\n    try {\r\n      const notification = this.pushQueue.get(notificationId);\r\n\r\n      if (!notification) {\r\n        throw new Error('Notification not found');\r\n      }\r\n\r\n      const timestamp = new Date();\r\n\r\n      switch (action) {\r\n        case 'delivered':\r\n          notification.stats.delivered = true;\r\n          notification.deliveredAt = timestamp;\r\n          break;\r\n        case 'opened':\r\n          notification.stats.opened = true;\r\n          notification.openedAt = timestamp;\r\n          break;\r\n        case 'clicked':\r\n          notification.stats.clicked = true;\r\n          notification.clickedAt = timestamp;\r\n          break;\r\n      }\r\n\r\n      this._recordNotificationInteraction(notification, action);\r\n\r\n      this.emit('notification:interaction', {\r\n        notificationId,\r\n        action,\r\n        timestamp,\r\n      });\r\n\r\n      return notification;\r\n    } catch (error) {\r\n      Logger.error('Record interaction error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™\r\n   * Get push notification statistics\r\n   */\r\n  getNotificationStats(userId, timeframe = 'day') {\r\n    try {\r\n      const key = userId;\r\n      const stats = this.notificationStats.get(key) || {\r\n        total: 0,\r\n        sent: 0,\r\n        delivered: 0,\r\n        opened: 0,\r\n        clicked: 0,\r\n        failed: 0,\r\n        deliveryRate: 0,\r\n        openRate: 0,\r\n        clickRate: 0,\r\n      };\r\n\r\n      // Calculate rates\r\n      stats.deliveryRate =\r\n        stats.sent > 0 ? ((stats.delivered / stats.sent) * 100).toFixed(2) : 0;\r\n      stats.openRate =\r\n        stats.delivered > 0 ? ((stats.opened / stats.delivered) * 100).toFixed(2) : 0;\r\n      stats.clickRate =\r\n        stats.opened > 0 ? ((stats.clicked / stats.opened) * 100).toFixed(2) : 0;\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      Logger.error('Get stats error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿßÿÆÿ™ÿ®ÿßÿ± ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™\r\n   * Test push notification delivery\r\n   */\r\n  async testPushDelivery(userId, deviceId) {\r\n    try {\r\n      const testId = uuid();\r\n      const testNotification = {\r\n        id: testId,\r\n        userId,\r\n        deviceId,\r\n        title: 'ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ•ÿ¥ÿπÿßÿ±',\r\n        body: 'Test notification - if you see this, push notifications are working!',\r\n        customData: {\r\n          testId,\r\n          test: true,\r\n        },\r\n        priority: 'high',\r\n        createdAt: new Date(),\r\n        status: 'testing',\r\n      };\r\n\r\n      this.testResults.set(testId, {\r\n        ...testNotification,\r\n        testStartTime: new Date(),\r\n        delivered: false,\r\n        deliveryTime: null,\r\n      });\r\n\r\n      // Simulate test delivery\r\n      setTimeout(() => {\r\n        const result = this.testResults.get(testId);\r\n        if (result) {\r\n          result.delivered = true;\r\n          result.deliveryTime = new Date();\r\n\r\n          this.emit('test:completed', {\r\n            testId,\r\n            delivered: true,\r\n            deliveryTime: result.deliveryTime.getTime() - result.testStartTime.getTime(),\r\n          });\r\n        }\r\n      }, Math.random() * 3000 + 1000); // 1-4 seconds\r\n\r\n      return {\r\n        testId,\r\n        message: 'Test notification sent. Check your device.',\r\n      };\r\n    } catch (error) {\r\n      Logger.error('Test push delivery error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ∂ÿ®ÿ∑ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸëŸÜÿ©\r\n   * Configure notification optimization\r\n   */\r\n  configureOptimization(settings = {}) {\r\n    this.optimizationSettings = {\r\n      batteryOptimization: settings.batteryOptimization !== false,\r\n      networkOptimization: settings.networkOptimization !== false,\r\n      quietHoursEnabled: settings.quietHoursEnabled || false,\r\n      quietHoursStart: settings.quietHoursStart || '22:00',\r\n      quietHoursEnd: settings.quietHoursEnd || '08:00',\r\n      bundleNotifications: settings.bundleNotifications !== false,\r\n      maxNotificationsPerHour: settings.maxNotificationsPerHour || 10,\r\n    };\r\n\r\n    Logger.info('‚öôÔ∏è  Notification optimization configured');\r\n\r\n    return this.optimizationSettings;\r\n  }\r\n\r\n  /**\r\n   * ===== Private Methods =====\r\n   */\r\n\r\n  /**\r\n   * Optimize notification for device\r\n   */\r\n  _optimizeForDevice(notification) {\r\n    const optimized = { ...notification };\r\n\r\n    // Reduce priority on WiFi since battery is not a concern\r\n    // Keep high priority on cellular\r\n\r\n    // Compress payload\r\n    const payloadSize = JSON.stringify(notification.customData).length;\r\n    if (payloadSize > 1000) {\r\n      // Compress large payloads\r\n      optimized.customData = this._compressPayload(notification.customData);\r\n    }\r\n\r\n    return optimized;\r\n  }\r\n\r\n  /**\r\n   * Record notification sent\r\n   */\r\n  _recordNotificationSent(notification) {\r\n    const key = notification.userId;\r\n\r\n    if (!this.notificationStats.has(key)) {\r\n      this.notificationStats.set(key, {\r\n        total: 0,\r\n        sent: 0,\r\n        delivered: 0,\r\n        opened: 0,\r\n        clicked: 0,\r\n        failed: 0,\r\n      });\r\n    }\r\n\r\n    const stats = this.notificationStats.get(key);\r\n    stats.total++;\r\n    stats.sent++;\r\n  }\r\n\r\n  /**\r\n   * Record notification interaction\r\n   */\r\n  _recordNotificationInteraction(notification, action) {\r\n    const key = notification.userId;\r\n    const stats = this.notificationStats.get(key);\r\n\r\n    if (stats) {\r\n      if (action === 'delivered') stats.delivered++;\r\n      if (action === 'opened') stats.opened++;\r\n      if (action === 'clicked') stats.clicked++;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compress payload\r\n   */\r\n  _compressPayload(payload) {\r\n    // Remove unnecessary fields\r\n    const essential = {};\r\n\r\n    const essentialFields = ['action', 'id', 'type', 'url'];\r\n    for (const field of essentialFields) {\r\n      if (payload[field] !== undefined) {\r\n        essential[field] = payload[field];\r\n      }\r\n    }\r\n\r\n    return essential;\r\n  }\r\n}\r\n\r\nmodule.exports = new PushNotificationOptimizer();\r\n"],"mappings":"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","ignoreList":[]}