31c16e37ce828a87bb774dc9eeefbdf1
/**
 * =====================================================
 * ADVANCED VALIDATION MIDDLEWARE - Phase 6
 * =====================================================
 * Comprehensive input validation for all endpoints
 */

const {
  _ApiError
} = require('../utils/apiResponse');
const {
  URL
} = require('url');

// ==================== VALIDATORS ====================

/**
 * Email validation
 */
const isEmail = value => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(value || '');
};

/**
 * Password strength validation
 */
const isStrongPassword = password => {
  const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
  return passwordRegex.test(password);
};

/**
 * Phone number validation
 */
const isPhoneNumber = phone => {
  const phoneRegex = /^[\d\s\-\+\(\)]+$/;
  return phoneRegex.test(phone) && phone.replace(/\D/g, '').length >= 10;
};

/**
 * URL validation
 */
const isValidUrl = url => {
  try {
    return Boolean(new URL(url));
  } catch (_e) {
    return false;
  }
};

/**
 * ID validation (MongoDB ObjectId)
 */
const isValidObjectId = id => {
  return /^[0-9a-f]{24}$/.test(id);
};

// ==================== SANITIZERS ====================

/**
 * Sanitize string input
 */
const sanitizeString = str => {
  if (!str) return '';
  return String(str).trim().replace(/[<>\"'&]/g, char => {
    const escape = {
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#x27;',
      '&': '&amp;'
    };
    return escape[char];
  });
};

/**
 * Sanitize email
 */
const sanitizeEmail = email => {
  return String(email || '').toLowerCase().trim();
};

/**
 * Sanitize request body
 */
const sanitizeBody = obj => {
  const sanitized = {};
  for (const [key, value] of Object.entries(obj)) {
    if (typeof value === 'string') {
      sanitized[key] = sanitizeString(value);
    } else if (typeof value === 'object' && value !== null) {
      sanitized[key] = sanitizeBody(value);
    } else {
      sanitized[key] = value;
    }
  }
  return sanitized;
};

// ==================== VALIDATION MIDDLEWARE ====================

/**
 * Registration validation
 */
const validateRegistration = (req, res, next) => {
  try {
    const {
      name,
      email,
      password,
      confirmPassword
    } = req.body || {};

    // Required fields
    if (!name || !email || !password) {
      return res.status(400).json({
        success: false,
        error: 'name, email, and password are required',
        errors: {
          name: !name ? 'Name is required' : undefined,
          email: !email ? 'Email is required' : undefined,
          password: !password ? 'Password is required' : undefined
        }
      });
    }

    // Email validation
    if (!isEmail(email)) {
      return res.status(400).json({
        success: false,
        error: 'Invalid email format',
        errors: {
          email: 'Please provide a valid email address'
        }
      });
    }

    // Password length
    if (String(password).length < 8) {
      return res.status(400).json({
        success: false,
        error: 'Password must be at least 8 characters',
        errors: {
          password: 'Password must have at least 8 characters'
        }
      });
    }

    // Confirm password
    if (confirmPassword && password !== confirmPassword) {
      return res.status(400).json({
        success: false,
        error: 'Passwords do not match',
        errors: {
          confirmPassword: 'Passwords must match'
        }
      });
    }

    // Sanitize inputs
    req.body.name = sanitizeString(name);
    req.body.email = sanitizeEmail(email);
    next();
  } catch (_error) {
    res.status(500).json({
      success: false,
      error: 'Validation error',
      message: error.message
    });
  }
};

/**
 * Login validation
 */
const validateLogin = (req, res, next) => {
  try {
    const {
      email,
      password
    } = req.body || {};
    if (!email || !password) {
      return res.status(400).json({
        success: false,
        error: 'email and password are required',
        errors: {
          email: !email ? 'Email is required' : undefined,
          password: !password ? 'Password is required' : undefined
        }
      });
    }
    if (!isEmail(email)) {
      return res.status(400).json({
        success: false,
        error: 'Invalid email format',
        errors: {
          email: 'Please provide a valid email address'
        }
      });
    }

    // Sanitize
    req.body.email = sanitizeEmail(email);
    next();
  } catch (_error) {
    res.status(500).json({
      success: false,
      error: 'Validation error',
      message: error.message
    });
  }
};

/**
 * Create user validation
 */
const validateCreateUser = (req, res, next) => {
  try {
    const {
      name,
      email,
      role,
      department
    } = req.body || {};
    if (!name || !email || !role) {
      return res.status(400).json({
        success: false,
        error: 'name, email, and role are required'
      });
    }
    if (!isEmail(email)) {
      return res.status(400).json({
        success: false,
        error: 'Invalid email format'
      });
    }
    const validRoles = ['admin', 'manager', 'employee', 'viewer'];
    if (!validRoles.includes(role)) {
      return res.status(400).json({
        success: false,
        error: `Invalid role. Must be one of: ${validRoles.join(', ')}`
      });
    }

    // Sanitize
    req.body.name = sanitizeString(name);
    req.body.email = sanitizeEmail(email);
    if (department) req.body.department = sanitizeString(department);
    next();
  } catch (error) {
    res.status(500).json({
      success: false,
      error: 'Validation error',
      message: error.message
    });
  }
};

/**
 * Validate ID parameter
 */
const validateId = (req, res, next) => {
  const {
    id
  } = req.params;
  if (!id) {
    return res.status(400).json({
      success: false,
      error: 'ID parameter is required'
    });
  }
  if (!isValidObjectId(id)) {
    return res.status(400).json({
      success: false,
      error: 'Invalid ID format'
    });
  }
  next();
};

/**
 * Validate pagination
 */
const validatePagination = (req, res, next) => {
  const {
    page = 1,
    limit = 10
  } = req.query;
  const pageNum = parseInt(page);
  const limitNum = parseInt(limit);
  if (isNaN(pageNum) || pageNum < 1) {
    return res.status(400).json({
      success: false,
      error: 'Invalid page number'
    });
  }
  if (isNaN(limitNum) || limitNum < 1 || limitNum > 100) {
    return res.status(400).json({
      success: false,
      error: 'Invalid limit. Must be between 1 and 100'
    });
  }
  req.pagination = {
    page: pageNum,
    limit: limitNum,
    skip: (pageNum - 1) * limitNum
  };
  next();
};
module.exports = {
  // Validators
  isEmail,
  isStrongPassword,
  isPhoneNumber,
  isValidUrl,
  isValidObjectId,
  // Sanitizers
  sanitizeString,
  sanitizeEmail,
  sanitizeBody,
  // Middleware
  validateRegistration,
  validateLogin,
  validateCreateUser,
  validateId,
  validatePagination
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfQXBpRXJyb3IiLCJyZXF1aXJlIiwiVVJMIiwiaXNFbWFpbCIsInZhbHVlIiwiZW1haWxSZWdleCIsInRlc3QiLCJpc1N0cm9uZ1Bhc3N3b3JkIiwicGFzc3dvcmQiLCJwYXNzd29yZFJlZ2V4IiwiaXNQaG9uZU51bWJlciIsInBob25lIiwicGhvbmVSZWdleCIsInJlcGxhY2UiLCJsZW5ndGgiLCJpc1ZhbGlkVXJsIiwidXJsIiwiQm9vbGVhbiIsIl9lIiwiaXNWYWxpZE9iamVjdElkIiwiaWQiLCJzYW5pdGl6ZVN0cmluZyIsInN0ciIsIlN0cmluZyIsInRyaW0iLCJjaGFyIiwiZXNjYXBlIiwic2FuaXRpemVFbWFpbCIsImVtYWlsIiwidG9Mb3dlckNhc2UiLCJzYW5pdGl6ZUJvZHkiLCJvYmoiLCJzYW5pdGl6ZWQiLCJrZXkiLCJPYmplY3QiLCJlbnRyaWVzIiwidmFsaWRhdGVSZWdpc3RyYXRpb24iLCJyZXEiLCJyZXMiLCJuZXh0IiwibmFtZSIsImNvbmZpcm1QYXNzd29yZCIsImJvZHkiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiZXJyb3JzIiwidW5kZWZpbmVkIiwiX2Vycm9yIiwibWVzc2FnZSIsInZhbGlkYXRlTG9naW4iLCJ2YWxpZGF0ZUNyZWF0ZVVzZXIiLCJyb2xlIiwiZGVwYXJ0bWVudCIsInZhbGlkUm9sZXMiLCJpbmNsdWRlcyIsImpvaW4iLCJ2YWxpZGF0ZUlkIiwicGFyYW1zIiwidmFsaWRhdGVQYWdpbmF0aW9uIiwicGFnZSIsImxpbWl0IiwicXVlcnkiLCJwYWdlTnVtIiwicGFyc2VJbnQiLCJsaW1pdE51bSIsImlzTmFOIiwicGFnaW5hdGlvbiIsInNraXAiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsidmFsaWRhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogQURWQU5DRUQgVkFMSURBVElPTiBNSURETEVXQVJFIC0gUGhhc2UgNlxyXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gKiBDb21wcmVoZW5zaXZlIGlucHV0IHZhbGlkYXRpb24gZm9yIGFsbCBlbmRwb2ludHNcclxuICovXHJcblxyXG5jb25zdCB7IF9BcGlFcnJvciB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvYXBpUmVzcG9uc2UnKTtcclxuY29uc3QgeyBVUkwgfSA9IHJlcXVpcmUoJ3VybCcpO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT0gVkFMSURBVE9SUyA9PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIEVtYWlsIHZhbGlkYXRpb25cclxuICovXHJcbmNvbnN0IGlzRW1haWwgPSAodmFsdWUpID0+IHtcclxuICBjb25zdCBlbWFpbFJlZ2V4ID0gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC87XHJcbiAgcmV0dXJuIGVtYWlsUmVnZXgudGVzdCh2YWx1ZSB8fCAnJyk7XHJcbn07XHJcblxyXG4vKipcclxuICogUGFzc3dvcmQgc3RyZW5ndGggdmFsaWRhdGlvblxyXG4gKi9cclxuY29uc3QgaXNTdHJvbmdQYXNzd29yZCA9IChwYXNzd29yZCkgPT4ge1xyXG4gIGNvbnN0IHBhc3N3b3JkUmVnZXggPSAvXig/PS4qW2Etel0pKD89LipbQS1aXSkoPz0uKlxcZCkoPz0uKltAJCElKj8mXSlbQS1aYS16XFxkQCQhJSo/Jl17OCx9JC87XHJcbiAgcmV0dXJuIHBhc3N3b3JkUmVnZXgudGVzdChwYXNzd29yZCk7XHJcbn07XHJcblxyXG4vKipcclxuICogUGhvbmUgbnVtYmVyIHZhbGlkYXRpb25cclxuICovXHJcbmNvbnN0IGlzUGhvbmVOdW1iZXIgPSAocGhvbmUpID0+IHtcclxuICBjb25zdCBwaG9uZVJlZ2V4ID0gL15bXFxkXFxzXFwtXFwrXFwoXFwpXSskLztcclxuICByZXR1cm4gcGhvbmVSZWdleC50ZXN0KHBob25lKSAmJiBwaG9uZS5yZXBsYWNlKC9cXEQvZywgJycpLmxlbmd0aCA+PSAxMDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBVUkwgdmFsaWRhdGlvblxyXG4gKi9cclxuY29uc3QgaXNWYWxpZFVybCA9ICh1cmwpID0+IHtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIEJvb2xlYW4obmV3IFVSTCh1cmwpKTtcclxuICB9IGNhdGNoIChfZSkge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBJRCB2YWxpZGF0aW9uIChNb25nb0RCIE9iamVjdElkKVxyXG4gKi9cclxuY29uc3QgaXNWYWxpZE9iamVjdElkID0gKGlkKSA9PiB7XHJcbiAgcmV0dXJuIC9eWzAtOWEtZl17MjR9JC8udGVzdChpZCk7XHJcbn07XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PSBTQU5JVElaRVJTID09PT09PT09PT09PT09PT09PT09XHJcblxyXG4vKipcclxuICogU2FuaXRpemUgc3RyaW5nIGlucHV0XHJcbiAqL1xyXG5jb25zdCBzYW5pdGl6ZVN0cmluZyA9IChzdHIpID0+IHtcclxuICBpZiAoIXN0cikgcmV0dXJuICcnO1xyXG4gIHJldHVybiBTdHJpbmcoc3RyKS50cmltKCkucmVwbGFjZSgvWzw+XFxcIicmXS9nLCAoY2hhcikgPT4ge1xyXG4gICAgY29uc3QgZXNjYXBlID0geyAnPCc6ICcmbHQ7JywgJz4nOiAnJmd0OycsICdcIic6ICcmcXVvdDsnLCBcIidcIjogJyYjeDI3OycsICcmJzogJyZhbXA7JyB9O1xyXG4gICAgcmV0dXJuIGVzY2FwZVtjaGFyXTtcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTYW5pdGl6ZSBlbWFpbFxyXG4gKi9cclxuY29uc3Qgc2FuaXRpemVFbWFpbCA9IChlbWFpbCkgPT4ge1xyXG4gIHJldHVybiBTdHJpbmcoZW1haWwgfHwgJycpLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNhbml0aXplIHJlcXVlc3QgYm9keVxyXG4gKi9cclxuY29uc3Qgc2FuaXRpemVCb2R5ID0gKG9iaikgPT4ge1xyXG4gIGNvbnN0IHNhbml0aXplZCA9IHt9O1xyXG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG9iaikpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHNhbml0aXplZFtrZXldID0gc2FuaXRpemVTdHJpbmcodmFsdWUpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7XHJcbiAgICAgIHNhbml0aXplZFtrZXldID0gc2FuaXRpemVCb2R5KHZhbHVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNhbml0aXplZFtrZXldID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBzYW5pdGl6ZWQ7XHJcbn07XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PSBWQUxJREFUSU9OIE1JRERMRVdBUkUgPT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBSZWdpc3RyYXRpb24gdmFsaWRhdGlvblxyXG4gKi9cclxuY29uc3QgdmFsaWRhdGVSZWdpc3RyYXRpb24gPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIGNvbmZpcm1QYXNzd29yZCB9ID0gcmVxLmJvZHkgfHwge307XHJcblxyXG4gICAgLy8gUmVxdWlyZWQgZmllbGRzXHJcbiAgICBpZiAoIW5hbWUgfHwgIWVtYWlsIHx8ICFwYXNzd29yZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnbmFtZSwgZW1haWwsIGFuZCBwYXNzd29yZCBhcmUgcmVxdWlyZWQnLFxyXG4gICAgICAgIGVycm9yczoge1xyXG4gICAgICAgICAgbmFtZTogIW5hbWUgPyAnTmFtZSBpcyByZXF1aXJlZCcgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICBlbWFpbDogIWVtYWlsID8gJ0VtYWlsIGlzIHJlcXVpcmVkJyA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgIHBhc3N3b3JkOiAhcGFzc3dvcmQgPyAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnIDogdW5kZWZpbmVkLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEVtYWlsIHZhbGlkYXRpb25cclxuICAgIGlmICghaXNFbWFpbChlbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ludmFsaWQgZW1haWwgZm9ybWF0JyxcclxuICAgICAgICBlcnJvcnM6IHsgZW1haWw6ICdQbGVhc2UgcHJvdmlkZSBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFBhc3N3b3JkIGxlbmd0aFxyXG4gICAgaWYgKFN0cmluZyhwYXNzd29yZCkubGVuZ3RoIDwgOCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMnLFxyXG4gICAgICAgIGVycm9yczogeyBwYXNzd29yZDogJ1Bhc3N3b3JkIG11c3QgaGF2ZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMnIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbmZpcm0gcGFzc3dvcmRcclxuICAgIGlmIChjb25maXJtUGFzc3dvcmQgJiYgcGFzc3dvcmQgIT09IGNvbmZpcm1QYXNzd29yZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnUGFzc3dvcmRzIGRvIG5vdCBtYXRjaCcsXHJcbiAgICAgICAgZXJyb3JzOiB7IGNvbmZpcm1QYXNzd29yZDogJ1Bhc3N3b3JkcyBtdXN0IG1hdGNoJyB9LFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTYW5pdGl6ZSBpbnB1dHNcclxuICAgIHJlcS5ib2R5Lm5hbWUgPSBzYW5pdGl6ZVN0cmluZyhuYW1lKTtcclxuICAgIHJlcS5ib2R5LmVtYWlsID0gc2FuaXRpemVFbWFpbChlbWFpbCk7XHJcblxyXG4gICAgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggKF9lcnJvcikge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdWYWxpZGF0aW9uIGVycm9yJyxcclxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcclxuICAgIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBMb2dpbiB2YWxpZGF0aW9uXHJcbiAqL1xyXG5jb25zdCB2YWxpZGF0ZUxvZ2luID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSByZXEuYm9keSB8fCB7fTtcclxuXHJcbiAgICBpZiAoIWVtYWlsIHx8ICFwYXNzd29yZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnZW1haWwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCcsXHJcbiAgICAgICAgZXJyb3JzOiB7XHJcbiAgICAgICAgICBlbWFpbDogIWVtYWlsID8gJ0VtYWlsIGlzIHJlcXVpcmVkJyA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgIHBhc3N3b3JkOiAhcGFzc3dvcmQgPyAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnIDogdW5kZWZpbmVkLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghaXNFbWFpbChlbWFpbCkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0ludmFsaWQgZW1haWwgZm9ybWF0JyxcclxuICAgICAgICBlcnJvcnM6IHsgZW1haWw6ICdQbGVhc2UgcHJvdmlkZSBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNhbml0aXplXHJcbiAgICByZXEuYm9keS5lbWFpbCA9IHNhbml0aXplRW1haWwoZW1haWwpO1xyXG5cclxuICAgIG5leHQoKTtcclxuICB9IGNhdGNoIChfZXJyb3IpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXHJcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHVzZXIgdmFsaWRhdGlvblxyXG4gKi9cclxuY29uc3QgdmFsaWRhdGVDcmVhdGVVc2VyID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgbmFtZSwgZW1haWwsIHJvbGUsIGRlcGFydG1lbnQgfSA9IHJlcS5ib2R5IHx8IHt9O1xyXG5cclxuICAgIGlmICghbmFtZSB8fCAhZW1haWwgfHwgIXJvbGUpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ25hbWUsIGVtYWlsLCBhbmQgcm9sZSBhcmUgcmVxdWlyZWQnLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWlzRW1haWwoZW1haWwpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdJbnZhbGlkIGVtYWlsIGZvcm1hdCcsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHZhbGlkUm9sZXMgPSBbJ2FkbWluJywgJ21hbmFnZXInLCAnZW1wbG95ZWUnLCAndmlld2VyJ107XHJcbiAgICBpZiAoIXZhbGlkUm9sZXMuaW5jbHVkZXMocm9sZSkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogYEludmFsaWQgcm9sZS4gTXVzdCBiZSBvbmUgb2Y6ICR7dmFsaWRSb2xlcy5qb2luKCcsICcpfWAsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNhbml0aXplXHJcbiAgICByZXEuYm9keS5uYW1lID0gc2FuaXRpemVTdHJpbmcobmFtZSk7XHJcbiAgICByZXEuYm9keS5lbWFpbCA9IHNhbml0aXplRW1haWwoZW1haWwpO1xyXG4gICAgaWYgKGRlcGFydG1lbnQpIHJlcS5ib2R5LmRlcGFydG1lbnQgPSBzYW5pdGl6ZVN0cmluZyhkZXBhcnRtZW50KTtcclxuXHJcbiAgICBuZXh0KCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXHJcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgSUQgcGFyYW1ldGVyXHJcbiAqL1xyXG5jb25zdCB2YWxpZGF0ZUlkID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICBcclxuICBpZiAoIWlkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdJRCBwYXJhbWV0ZXIgaXMgcmVxdWlyZWQnLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWlzVmFsaWRPYmplY3RJZChpZCkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ0ludmFsaWQgSUQgZm9ybWF0JyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmV4dCgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFZhbGlkYXRlIHBhZ2luYXRpb25cclxuICovXHJcbmNvbnN0IHZhbGlkYXRlUGFnaW5hdGlvbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIGNvbnN0IHsgcGFnZSA9IDEsIGxpbWl0ID0gMTAgfSA9IHJlcS5xdWVyeTtcclxuXHJcbiAgY29uc3QgcGFnZU51bSA9IHBhcnNlSW50KHBhZ2UpO1xyXG4gIGNvbnN0IGxpbWl0TnVtID0gcGFyc2VJbnQobGltaXQpO1xyXG5cclxuICBpZiAoaXNOYU4ocGFnZU51bSkgfHwgcGFnZU51bSA8IDEpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ0ludmFsaWQgcGFnZSBudW1iZXInLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoaXNOYU4obGltaXROdW0pIHx8IGxpbWl0TnVtIDwgMSB8fCBsaW1pdE51bSA+IDEwMCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnSW52YWxpZCBsaW1pdC4gTXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDEwMCcsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlcS5wYWdpbmF0aW9uID0ge1xyXG4gICAgcGFnZTogcGFnZU51bSxcclxuICAgIGxpbWl0OiBsaW1pdE51bSxcclxuICAgIHNraXA6IChwYWdlTnVtIC0gMSkgKiBsaW1pdE51bSxcclxuICB9O1xyXG5cclxuICBuZXh0KCk7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAvLyBWYWxpZGF0b3JzXHJcbiAgaXNFbWFpbCxcclxuICBpc1N0cm9uZ1Bhc3N3b3JkLFxyXG4gIGlzUGhvbmVOdW1iZXIsXHJcbiAgaXNWYWxpZFVybCxcclxuICBpc1ZhbGlkT2JqZWN0SWQsXHJcblxyXG4gIC8vIFNhbml0aXplcnNcclxuICBzYW5pdGl6ZVN0cmluZyxcclxuICBzYW5pdGl6ZUVtYWlsLFxyXG4gIHNhbml0aXplQm9keSxcclxuXHJcbiAgLy8gTWlkZGxld2FyZVxyXG4gIHZhbGlkYXRlUmVnaXN0cmF0aW9uLFxyXG4gIHZhbGlkYXRlTG9naW4sXHJcbiAgdmFsaWRhdGVDcmVhdGVVc2VyLFxyXG4gIHZhbGlkYXRlSWQsXHJcbiAgdmFsaWRhdGVQYWdpbmF0aW9uLFxyXG59O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNO0VBQUVBO0FBQVUsQ0FBQyxHQUFHQyxPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDckQsTUFBTTtFQUFFQztBQUFJLENBQUMsR0FBR0QsT0FBTyxDQUFDLEtBQUssQ0FBQzs7QUFFOUI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTUUsT0FBTyxHQUFJQyxLQUFLLElBQUs7RUFDekIsTUFBTUMsVUFBVSxHQUFHLDRCQUE0QjtFQUMvQyxPQUFPQSxV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