ff7a91d8f1107e67735ced24b4d08f33
/**
 * OAuth 2.0 & OpenID Connect Service
 * خدمة OAuth 2.0 و OpenID Connect
 */

const crypto = require('crypto');
const SSOService = require('./sso.service');
const logger = require('../utils/logger');
class OAuthService {
  constructor() {
    this.ssoService = new SSOService();
    this.OAUTH_CLIENT_SECRET = process.env.OAUTH_CLIENT_SECRET || 'oauth-secret';
  }

  /**
   * OAuth 2.0 Authorization Code Flow
   * إنشاء طلب تفويض جديد
   */
  async initiateAuthorizationCodeFlow(clientId, redirectUri, scope, state, nonce = null) {
    try {
      // Validate OAuth request
      const validation = await this.ssoService.validateOAuthRequest(clientId, redirectUri, scope, state);
      if (!validation.valid) {
        throw new Error('Invalid OAuth request');
      }

      // Generate state if not provided
      const authState = state || crypto.randomBytes(32).toString('hex');

      // Store OAuth state for CSRF protection
      const stateData = {
        clientId,
        redirectUri,
        scope,
        nonce,
        createdAt: Date.now(),
        expiresAt: Date.now() + 600000 // 10 minutes
      };

      // Store in Redis (implementation in SSOService)
      const authCode = await this.ssoService.generateAuthorizationCode(null,
      // userId will be set after login
      clientId, scope, redirectUri);
      return {
        authCode,
        state: authState,
        redirectUri: `${redirectUri}?code=${authCode}&state=${authState}`
      };
    } catch (error) {
      logger.error('Authorization code flow initiation failed:', error);
      throw error;
    }
  }

  /**
   * Exchange authorization code for tokens
   * تبديل رمز التفويض بالتوكنات
   */
  async exchangeAuthorizationCode(code, clientId, clientSecret, redirectUri) {
    try {
      // Verify client credentials
      if (clientSecret !== this.OAUTH_CLIENT_SECRET) {
        throw new Error('Invalid client credentials');
      }

      // Exchange code for tokens
      const session = await this.ssoService.exchangeAuthorizationCode(code, clientId, clientSecret);
      return {
        accessToken: session.accessToken,
        refreshToken: session.refreshToken,
        idToken: session.idToken,
        tokenType: 'Bearer',
        expiresIn: 3600,
        scope: 'openid profile email'
      };
    } catch (error) {
      logger.error('Authorization code exchange failed:', error);
      throw error;
    }
  }

  /**
   * OAuth 2.0 Implicit Flow
   * تدفق Implicit (للتطبيقات أحادية الصفحة)
   */
  async initiateImplicitFlow(clientId, redirectUri, scope, state, responseTypes = ['token']) {
    try {
      const accessToken = crypto.randomBytes(32).toString('hex');
      const token = {
        accessToken,
        tokenType: 'Bearer',
        expiresIn: 3600,
        scope
      };

      // Build redirect URL with token in fragment
      let redirectUrl = `${redirectUri}#`;
      const params = new URLSearchParams();
      if (responseTypes.includes('token')) {
        params.append('access_token', accessToken);
        params.append('token_type', token.tokenType);
        params.append('expires_in', token.expiresIn);
      }
      if (state) {
        params.append('state', state);
      }
      redirectUrl += params.toString();
      return {
        redirectUrl,
        token
      };
    } catch (error) {
      logger.error('Implicit flow initiation failed:', error);
      throw error;
    }
  }

  /**
   * OAuth 2.0 Client Credentials Flow
   * تدفق بيانات اعتماد العميل (للتطبيقات)
   */
  async initiateClientCredentialsFlow(clientId, clientSecret, scope) {
    try {
      // Verify client credentials
      if (clientSecret !== this.OAUTH_CLIENT_SECRET) {
        throw new Error('Invalid client credentials');
      }
      const now = Date.now();
      const accessToken = crypto.randomBytes(32).toString('hex');
      const token = {
        accessToken,
        tokenType: 'Bearer',
        expiresIn: 3600,
        scope: scope || 'api'
      };
      logger.info(`Client credentials flow successful for client: ${clientId}`);
      return token;
    } catch (error) {
      logger.error('Client credentials flow failed:', error);
      throw error;
    }
  }

  /**
   * OAuth 2.0 Resource Owner Password Flow
   * تدفق كلمة مرور مالك المورد
   */
  async initiateResourceOwnerPasswordFlow(username, password, scope, clientId) {
    try {
      // This would typically validate against your user database
      // For security, this flow should only be used for trusted clients

      // Validate credentials (implementation depends on your auth system)
      const userPayload = {
        username,
        scope: scope || 'api',
        clientId
      };

      // Create session through SSO service
      const session = await this.ssoService.createSession(username, userPayload, {
        source: 'password_grant'
      });
      return {
        accessToken: session.accessToken,
        refreshToken: session.refreshToken,
        tokenType: 'Bearer',
        expiresIn: session.expiresIn
      };
    } catch (error) {
      logger.error('Resource owner password flow failed:', error);
      throw error;
    }
  }

  /**
   * OpenID Connect: UserInfo Endpoint
   * إرجاع معلومات المستخدم
   */
  async getUserInfo(accessToken) {
    try {
      // Verify token and get user information
      const introspection = await this.ssoService.introspectToken(accessToken);
      if (!introspection.active) {
        throw new Error('Invalid access token');
      }
      const userId = introspection.sub;

      // This would fetch user details from database
      const userInfo = {
        sub: userId,
        name: `User ${userId}`,
        email: `user${userId}@example.com`,
        email_verified: true,
        iss: 'https://sso.yourdomain.com',
        aud: introspection.clientId,
        iat: introspection.iat,
        auth_time: introspection.iat
      };
      return userInfo;
    } catch (error) {
      logger.error('UserInfo endpoint failed:', error);
      throw error;
    }
  }

  /**
   * OpenID Connect: Token Endpoint
   * نقطة نهاية التوكن
   */
  async getTokens(grantType, params) {
    try {
      switch (grantType) {
        case 'authorization_code':
          return await this.exchangeAuthorizationCode(params.code, params.clientId, params.clientSecret, params.redirectUri);
        case 'refresh_token':
          return await this.refreshTokenGrant(params.refreshToken, params.clientId);
        case 'client_credentials':
          return await this.initiateClientCredentialsFlow(params.clientId, params.clientSecret, params.scope);
        case 'password':
          return await this.initiateResourceOwnerPasswordFlow(params.username, params.password, params.scope, params.clientId);
        default:
          throw new Error(`Unsupported grant type: ${grantType}`);
      }
    } catch (error) {
      logger.error('Token endpoint failed:', error);
      throw error;
    }
  }

  /**
   * Refresh Token Grant
   * تحديث التوكن
   */
  async refreshTokenGrant(refreshToken, clientId) {
    try {
      // This would parse the refresh token and generate new access token
      const newSession = await this.ssoService.refreshAccessToken(null, refreshToken);
      return {
        accessToken: newSession.accessToken,
        tokenType: 'Bearer',
        expiresIn: newSession.expiresIn
      };
    } catch (error) {
      logger.error('Refresh token grant failed:', error);
      throw error;
    }
  }

  /**
   * OpenID Connect: .well-known/openid-configuration
   * معايير OpenID Connect
   */
  getOpenIDConfiguration() {
    const baseUrl = process.env.SSO_BASE_URL || 'https://sso.yourdomain.com';
    return {
      issuer: baseUrl,
      authorization_endpoint: `${baseUrl}/oauth2/authorize`,
      token_endpoint: `${baseUrl}/oauth2/token`,
      userinfo_endpoint: `${baseUrl}/oauth2/userinfo`,
      jwks_uri: `${baseUrl}/.well-known/jwks.json`,
      registration_endpoint: `${baseUrl}/oauth2/register`,
      revocation_endpoint: `${baseUrl}/oauth2/revoke`,
      end_session_endpoint: `${baseUrl}/oauth2/logout`,
      response_types_supported: ['code', 'token', 'id_token', 'code id_token', 'token id_token', 'code token id_token'],
      grant_types_supported: ['authorization_code', 'implicit', 'refresh_token', 'client_credentials', 'password'],
      subject_types_supported: ['public', 'pairwise'],
      id_token_signing_alg_values_supported: ['HS256', 'RS256'],
      scopes_supported: ['openid', 'profile', 'email', 'address', 'phone', 'offline_access'],
      claims_supported: ['sub', 'name', 'given_name', 'family_name', 'email', 'email_verified', 'address', 'phone_number', 'auth_time'],
      token_endpoint_auth_methods_supported: ['client_secret_basic', 'client_secret_post', 'client_secret_jwt', 'private_key_jwt'],
      claim_types_supported: ['normal', 'aggregated', 'distributed'],
      code_challenge_methods_supported: ['plain', 'S256'],
      request_parameter_supported: true,
      request_uri_parameter_supported: true
    };
  }

  /**
   * PKCE (Proof Key for Public Clients) Support
   * دعم PKCE لحماية العملاء العامين
   */
  async verifyPKCE(codeVerifier, codeChallenge, method = 'S256') {
    try {
      let computedChallenge;
      if (method === 'S256') {
        // SHA256 hash
        const hash = crypto.createHash('sha256').update(codeVerifier).digest();
        computedChallenge = Buffer.from(hash).toString('base64').replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
      } else if (method === 'plain') {
        computedChallenge = codeVerifier;
      } else {
        throw new Error(`Unsupported PKCE method: ${method}`);
      }
      return computedChallenge === codeChallenge;
    } catch (error) {
      logger.error('PKCE verification failed:', error);
      throw error;
    }
  }

  /**
   * Revoke Token
   * إلغاء التوكن
   */
  async revokeToken(token, tokenTypeHint = 'access_token') {
    try {
      // In production, would invalidate token in Redis
      logger.info(`Token revoked: type=${tokenTypeHint}`);
      return {
        success: true
      };
    } catch (error) {
      logger.error('Token revocation failed:', error);
      throw error;
    }
  }

  /**
   * Dynamic Client Registration
   * تسجيل عميل ديناميكي
   */
  async registerClient(clientMetadata) {
    try {
      const clientId = crypto.randomBytes(16).toString('hex');
      const clientSecret = crypto.randomBytes(32).toString('hex');
      const client = {
        clientId,
        clientSecret,
        clientName: clientMetadata.clientName,
        redirectUris: clientMetadata.redirectUris || [],
        responseTypes: clientMetadata.responseTypes || ['code'],
        grantTypes: clientMetadata.grantTypes || ['authorization_code', 'refresh_token'],
        scopes: clientMetadata.scopes || ['openid', 'profile', 'email'],
        contacts: clientMetadata.contacts || [],
        registrationTime: Date.now()
      };
      logger.info(`Client registered: ${clientId}`);
      return {
        client,
        clientSecret
      };
    } catch (error) {
      logger.error('Client registration failed:', error);
      throw error;
    }
  }

  /**
   * Introspect Token (Token Introspection)
   * فحص البيانات الوصفية للتوكن
   */
  async introspectToken(token, clientId) {
    try {
      const introspection = await this.ssoService.introspectToken(token);

      // Verify client has permission to introspect
      if (introspection.clientId && introspection.clientId !== clientId) {
        logger.warn(`Unauthorized introspection attempt by client: ${clientId}`);
        return {
          active: false
        };
      }
      return introspection;
    } catch (error) {
      logger.error('Token introspection failed:', error);
      return {
        active: false
      };
    }
  }
}
module.exports = OAuthService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcnlwdG8iLCJyZXF1aXJlIiwiU1NPU2VydmljZSIsImxvZ2dlciIsIk9BdXRoU2VydmljZSIsImNvbnN0cnVjdG9yIiwic3NvU2VydmljZSIsIk9BVVRIX0NMSUVOVF9TRUNSRVQiLCJwcm9jZXNzIiwiZW52IiwiaW5pdGlhdGVBdXRob3JpemF0aW9uQ29kZUZsb3ciLCJjbGllbnRJZCIsInJlZGlyZWN0VXJpIiwic2NvcGUiLCJzdGF0ZSIsIm5vbmNlIiwidmFsaWRhdGlvbiIsInZhbGlkYXRlT0F1dGhSZXF1ZXN0IiwidmFsaWQiLCJFcnJvciIsImF1dGhTdGF0ZSIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciLCJzdGF0ZURhdGEiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwiZXhwaXJlc0F0IiwiYXV0aENvZGUiLCJnZW5lcmF0ZUF1dGhvcml6YXRpb25Db2RlIiwiZXJyb3IiLCJleGNoYW5nZUF1dGhvcml6YXRpb25Db2RlIiwiY29kZSIsImNsaWVudFNlY3JldCIsInNlc3Npb24iLCJhY2Nlc3NUb2tlbiIsInJlZnJlc2hUb2tlbiIsImlkVG9rZW4iLCJ0b2tlblR5cGUiLCJleHBpcmVzSW4iLCJpbml0aWF0ZUltcGxpY2l0RmxvdyIsInJlc3BvbnNlVHlwZXMiLCJ0b2tlbiIsInJlZGlyZWN0VXJsIiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwiaW5jbHVkZXMiLCJhcHBlbmQiLCJpbml0aWF0ZUNsaWVudENyZWRlbnRpYWxzRmxvdyIsImluZm8iLCJpbml0aWF0ZVJlc291cmNlT3duZXJQYXNzd29yZEZsb3ciLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwidXNlclBheWxvYWQiLCJjcmVhdGVTZXNzaW9uIiwic291cmNlIiwiZ2V0VXNlckluZm8iLCJpbnRyb3NwZWN0aW9uIiwiaW50cm9zcGVjdFRva2VuIiwiYWN0aXZlIiwidXNlcklkIiwic3ViIiwidXNlckluZm8iLCJuYW1lIiwiZW1haWwiLCJlbWFpbF92ZXJpZmllZCIsImlzcyIsImF1ZCIsImlhdCIsImF1dGhfdGltZSIsImdldFRva2VucyIsImdyYW50VHlwZSIsInJlZnJlc2hUb2tlbkdyYW50IiwibmV3U2Vzc2lvbiIsInJlZnJlc2hBY2Nlc3NUb2tlbiIsImdldE9wZW5JRENvbmZpZ3VyYXRpb24iLCJiYXNlVXJsIiwiU1NPX0JBU0VfVVJMIiwiaXNzdWVyIiwiYXV0aG9yaXphdGlvbl9lbmRwb2ludCIsInRva2VuX2VuZHBvaW50IiwidXNlcmluZm9fZW5kcG9pbnQiLCJqd2tzX3VyaSIsInJlZ2lzdHJhdGlvbl9lbmRwb2ludCIsInJldm9jYXRpb25fZW5kcG9pbnQiLCJlbmRfc2Vzc2lvbl9lbmRwb2ludCIsInJlc3BvbnNlX3R5cGVzX3N1cHBvcnRlZCIsImdyYW50X3R5cGVzX3N1cHBvcnRlZCIsInN1YmplY3RfdHlwZXNfc3VwcG9ydGVkIiwiaWRfdG9rZW5fc2lnbmluZ19hbGdfdmFsdWVzX3N1cHBvcnRlZCIsInNjb3Blc19zdXBwb3J0ZWQiLCJjbGFpbXNfc3VwcG9ydGVkIiwidG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2RzX3N1cHBvcnRlZCIsImNsYWltX3R5cGVzX3N1cHBvcnRlZCIsImNvZGVfY2hhbGxlbmdlX21ldGhvZHNfc3VwcG9ydGVkIiwicmVxdWVzdF9wYXJhbWV0ZXJfc3VwcG9ydGVkIiwicmVxdWVzdF91cmlfcGFyYW1ldGVyX3N1cHBvcnRlZCIsInZlcmlmeVBLQ0UiLCJjb2RlVmVyaWZpZXIiLCJjb2RlQ2hhbGxlbmdlIiwibWV0aG9kIiwiY29tcHV0ZWRDaGFsbGVuZ2UiLCJoYXNoIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsIkJ1ZmZlciIsImZyb20iLCJyZXBsYWNlIiwicmV2b2tlVG9rZW4iLCJ0b2tlblR5cGVIaW50Iiwic3VjY2VzcyIsInJlZ2lzdGVyQ2xpZW50IiwiY2xpZW50TWV0YWRhdGEiLCJjbGllbnQiLCJjbGllbnROYW1lIiwicmVkaXJlY3RVcmlzIiwiZ3JhbnRUeXBlcyIsInNjb3BlcyIsImNvbnRhY3RzIiwicmVnaXN0cmF0aW9uVGltZSIsIndhcm4iLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsib2F1dGguc2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogT0F1dGggMi4wICYgT3BlbklEIENvbm5lY3QgU2VydmljZVxyXG4gKiDYrtiv2YXYqSBPQXV0aCAyLjAg2YggT3BlbklEIENvbm5lY3RcclxuICovXHJcblxyXG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcclxuY29uc3QgU1NPU2VydmljZSA9IHJlcXVpcmUoJy4vc3NvLnNlcnZpY2UnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XHJcblxyXG5jbGFzcyBPQXV0aFNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5zc29TZXJ2aWNlID0gbmV3IFNTT1NlcnZpY2UoKTtcclxuICAgIHRoaXMuT0FVVEhfQ0xJRU5UX1NFQ1JFVCA9IHByb2Nlc3MuZW52Lk9BVVRIX0NMSUVOVF9TRUNSRVQgfHwgJ29hdXRoLXNlY3JldCc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPQXV0aCAyLjAgQXV0aG9yaXphdGlvbiBDb2RlIEZsb3dcclxuICAgKiDYpdmG2LTYp9ihINi32YTYqCDYqtmB2YjZiti2INis2K/ZitivXHJcbiAgICovXHJcbiAgYXN5bmMgaW5pdGlhdGVBdXRob3JpemF0aW9uQ29kZUZsb3coY2xpZW50SWQsIHJlZGlyZWN0VXJpLCBzY29wZSwgc3RhdGUsIG5vbmNlID0gbnVsbCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVmFsaWRhdGUgT0F1dGggcmVxdWVzdFxyXG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gYXdhaXQgdGhpcy5zc29TZXJ2aWNlLnZhbGlkYXRlT0F1dGhSZXF1ZXN0KFxyXG4gICAgICAgIGNsaWVudElkLFxyXG4gICAgICAgIHJlZGlyZWN0VXJpLFxyXG4gICAgICAgIHNjb3BlLFxyXG4gICAgICAgIHN0YXRlXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBpZiAoIXZhbGlkYXRpb24udmFsaWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgT0F1dGggcmVxdWVzdCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZW5lcmF0ZSBzdGF0ZSBpZiBub3QgcHJvdmlkZWRcclxuICAgICAgY29uc3QgYXV0aFN0YXRlID0gc3RhdGUgfHwgY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7XHJcblxyXG4gICAgICAvLyBTdG9yZSBPQXV0aCBzdGF0ZSBmb3IgQ1NSRiBwcm90ZWN0aW9uXHJcbiAgICAgIGNvbnN0IHN0YXRlRGF0YSA9IHtcclxuICAgICAgICBjbGllbnRJZCxcclxuICAgICAgICByZWRpcmVjdFVyaSxcclxuICAgICAgICBzY29wZSxcclxuICAgICAgICBub25jZSxcclxuICAgICAgICBjcmVhdGVkQXQ6IERhdGUubm93KCksXHJcbiAgICAgICAgZXhwaXJlc0F0OiBEYXRlLm5vdygpICsgNjAwMDAwIC8vIDEwIG1pbnV0ZXNcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIFN0b3JlIGluIFJlZGlzIChpbXBsZW1lbnRhdGlvbiBpbiBTU09TZXJ2aWNlKVxyXG4gICAgICBjb25zdCBhdXRoQ29kZSA9IGF3YWl0IHRoaXMuc3NvU2VydmljZS5nZW5lcmF0ZUF1dGhvcml6YXRpb25Db2RlKFxyXG4gICAgICAgIG51bGwsIC8vIHVzZXJJZCB3aWxsIGJlIHNldCBhZnRlciBsb2dpblxyXG4gICAgICAgIGNsaWVudElkLFxyXG4gICAgICAgIHNjb3BlLFxyXG4gICAgICAgIHJlZGlyZWN0VXJpXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGF1dGhDb2RlLFxyXG4gICAgICAgIHN0YXRlOiBhdXRoU3RhdGUsXHJcbiAgICAgICAgcmVkaXJlY3RVcmk6IGAke3JlZGlyZWN0VXJpfT9jb2RlPSR7YXV0aENvZGV9JnN0YXRlPSR7YXV0aFN0YXRlfWBcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignQXV0aG9yaXphdGlvbiBjb2RlIGZsb3cgaW5pdGlhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEV4Y2hhbmdlIGF1dGhvcml6YXRpb24gY29kZSBmb3IgdG9rZW5zXHJcbiAgICog2KrYqNiv2YrZhCDYsdmF2LIg2KfZhNiq2YHZiNmK2LYg2KjYp9mE2KrZiNmD2YbYp9iqXHJcbiAgICovXHJcbiAgYXN5bmMgZXhjaGFuZ2VBdXRob3JpemF0aW9uQ29kZShjb2RlLCBjbGllbnRJZCwgY2xpZW50U2VjcmV0LCByZWRpcmVjdFVyaSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVmVyaWZ5IGNsaWVudCBjcmVkZW50aWFsc1xyXG4gICAgICBpZiAoY2xpZW50U2VjcmV0ICE9PSB0aGlzLk9BVVRIX0NMSUVOVF9TRUNSRVQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY2xpZW50IGNyZWRlbnRpYWxzJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEV4Y2hhbmdlIGNvZGUgZm9yIHRva2Vuc1xyXG4gICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgdGhpcy5zc29TZXJ2aWNlLmV4Y2hhbmdlQXV0aG9yaXphdGlvbkNvZGUoXHJcbiAgICAgICAgY29kZSxcclxuICAgICAgICBjbGllbnRJZCxcclxuICAgICAgICBjbGllbnRTZWNyZXRcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgYWNjZXNzVG9rZW46IHNlc3Npb24uYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgcmVmcmVzaFRva2VuOiBzZXNzaW9uLnJlZnJlc2hUb2tlbixcclxuICAgICAgICBpZFRva2VuOiBzZXNzaW9uLmlkVG9rZW4sXHJcbiAgICAgICAgdG9rZW5UeXBlOiAnQmVhcmVyJyxcclxuICAgICAgICBleHBpcmVzSW46IDM2MDAsXHJcbiAgICAgICAgc2NvcGU6ICdvcGVuaWQgcHJvZmlsZSBlbWFpbCdcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignQXV0aG9yaXphdGlvbiBjb2RlIGV4Y2hhbmdlIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogT0F1dGggMi4wIEltcGxpY2l0IEZsb3dcclxuICAgKiDYqtiv2YHZgiBJbXBsaWNpdCAo2YTZhNiq2LfYqNmK2YLYp9iqINij2K3Yp9iv2YrYqSDYp9mE2LXZgdit2KkpXHJcbiAgICovXHJcbiAgYXN5bmMgaW5pdGlhdGVJbXBsaWNpdEZsb3coY2xpZW50SWQsIHJlZGlyZWN0VXJpLCBzY29wZSwgc3RhdGUsIHJlc3BvbnNlVHlwZXMgPSBbJ3Rva2VuJ10pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB0b2tlbiA9IHtcclxuICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICB0b2tlblR5cGU6ICdCZWFyZXInLFxyXG4gICAgICAgIGV4cGlyZXNJbjogMzYwMCxcclxuICAgICAgICBzY29wZVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gQnVpbGQgcmVkaXJlY3QgVVJMIHdpdGggdG9rZW4gaW4gZnJhZ21lbnRcclxuICAgICAgbGV0IHJlZGlyZWN0VXJsID0gYCR7cmVkaXJlY3RVcml9I2A7XHJcbiAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXNwb25zZVR5cGVzLmluY2x1ZGVzKCd0b2tlbicpKSB7XHJcbiAgICAgICAgcGFyYW1zLmFwcGVuZCgnYWNjZXNzX3Rva2VuJywgYWNjZXNzVG9rZW4pO1xyXG4gICAgICAgIHBhcmFtcy5hcHBlbmQoJ3Rva2VuX3R5cGUnLCB0b2tlbi50b2tlblR5cGUpO1xyXG4gICAgICAgIHBhcmFtcy5hcHBlbmQoJ2V4cGlyZXNfaW4nLCB0b2tlbi5leHBpcmVzSW4pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoc3RhdGUpIHtcclxuICAgICAgICBwYXJhbXMuYXBwZW5kKCdzdGF0ZScsIHN0YXRlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmVkaXJlY3RVcmwgKz0gcGFyYW1zLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICByZXR1cm4geyByZWRpcmVjdFVybCwgdG9rZW4gfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignSW1wbGljaXQgZmxvdyBpbml0aWF0aW9uIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogT0F1dGggMi4wIENsaWVudCBDcmVkZW50aWFscyBGbG93XHJcbiAgICog2KrYr9mB2YIg2KjZitin2YbYp9iqINin2LnYqtmF2KfYryDYp9mE2LnZhdmK2YQgKNmE2YTYqti32KjZitmC2KfYqilcclxuICAgKi9cclxuICBhc3luYyBpbml0aWF0ZUNsaWVudENyZWRlbnRpYWxzRmxvdyhjbGllbnRJZCwgY2xpZW50U2VjcmV0LCBzY29wZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVmVyaWZ5IGNsaWVudCBjcmVkZW50aWFsc1xyXG4gICAgICBpZiAoY2xpZW50U2VjcmV0ICE9PSB0aGlzLk9BVVRIX0NMSUVOVF9TRUNSRVQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY2xpZW50IGNyZWRlbnRpYWxzJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7XHJcblxyXG4gICAgICBjb25zdCB0b2tlbiA9IHtcclxuICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICB0b2tlblR5cGU6ICdCZWFyZXInLFxyXG4gICAgICAgIGV4cGlyZXNJbjogMzYwMCxcclxuICAgICAgICBzY29wZTogc2NvcGUgfHwgJ2FwaSdcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxvZ2dlci5pbmZvKGBDbGllbnQgY3JlZGVudGlhbHMgZmxvdyBzdWNjZXNzZnVsIGZvciBjbGllbnQ6ICR7Y2xpZW50SWR9YCk7XHJcbiAgICAgIHJldHVybiB0b2tlbjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignQ2xpZW50IGNyZWRlbnRpYWxzIGZsb3cgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPQXV0aCAyLjAgUmVzb3VyY2UgT3duZXIgUGFzc3dvcmQgRmxvd1xyXG4gICAqINiq2K/ZgdmCINmD2YTZhdipINmF2LHZiNixINmF2KfZhNmDINin2YTZhdmI2LHYr1xyXG4gICAqL1xyXG4gIGFzeW5jIGluaXRpYXRlUmVzb3VyY2VPd25lclBhc3N3b3JkRmxvdyh1c2VybmFtZSwgcGFzc3dvcmQsIHNjb3BlLCBjbGllbnRJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVGhpcyB3b3VsZCB0eXBpY2FsbHkgdmFsaWRhdGUgYWdhaW5zdCB5b3VyIHVzZXIgZGF0YWJhc2VcclxuICAgICAgLy8gRm9yIHNlY3VyaXR5LCB0aGlzIGZsb3cgc2hvdWxkIG9ubHkgYmUgdXNlZCBmb3IgdHJ1c3RlZCBjbGllbnRzXHJcbiAgICAgIFxyXG4gICAgICAvLyBWYWxpZGF0ZSBjcmVkZW50aWFscyAoaW1wbGVtZW50YXRpb24gZGVwZW5kcyBvbiB5b3VyIGF1dGggc3lzdGVtKVxyXG4gICAgICBjb25zdCB1c2VyUGF5bG9hZCA9IHtcclxuICAgICAgICB1c2VybmFtZSxcclxuICAgICAgICBzY29wZTogc2NvcGUgfHwgJ2FwaScsXHJcbiAgICAgICAgY2xpZW50SWRcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBzZXNzaW9uIHRocm91Z2ggU1NPIHNlcnZpY2VcclxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHRoaXMuc3NvU2VydmljZS5jcmVhdGVTZXNzaW9uKFxyXG4gICAgICAgIHVzZXJuYW1lLFxyXG4gICAgICAgIHVzZXJQYXlsb2FkLFxyXG4gICAgICAgIHsgc291cmNlOiAncGFzc3dvcmRfZ3JhbnQnIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgYWNjZXNzVG9rZW46IHNlc3Npb24uYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgcmVmcmVzaFRva2VuOiBzZXNzaW9uLnJlZnJlc2hUb2tlbixcclxuICAgICAgICB0b2tlblR5cGU6ICdCZWFyZXInLFxyXG4gICAgICAgIGV4cGlyZXNJbjogc2Vzc2lvbi5leHBpcmVzSW5cclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignUmVzb3VyY2Ugb3duZXIgcGFzc3dvcmQgZmxvdyBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wZW5JRCBDb25uZWN0OiBVc2VySW5mbyBFbmRwb2ludFxyXG4gICAqINil2LHYrNin2Lkg2YXYudmE2YjZhdin2Kog2KfZhNmF2LPYqtiu2K/ZhVxyXG4gICAqL1xyXG4gIGFzeW5jIGdldFVzZXJJbmZvKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBWZXJpZnkgdG9rZW4gYW5kIGdldCB1c2VyIGluZm9ybWF0aW9uXHJcbiAgICAgIGNvbnN0IGludHJvc3BlY3Rpb24gPSBhd2FpdCB0aGlzLnNzb1NlcnZpY2UuaW50cm9zcGVjdFRva2VuKGFjY2Vzc1Rva2VuKTtcclxuXHJcbiAgICAgIGlmICghaW50cm9zcGVjdGlvbi5hY3RpdmUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYWNjZXNzIHRva2VuJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGludHJvc3BlY3Rpb24uc3ViO1xyXG5cclxuICAgICAgLy8gVGhpcyB3b3VsZCBmZXRjaCB1c2VyIGRldGFpbHMgZnJvbSBkYXRhYmFzZVxyXG4gICAgICBjb25zdCB1c2VySW5mbyA9IHtcclxuICAgICAgICBzdWI6IHVzZXJJZCxcclxuICAgICAgICBuYW1lOiBgVXNlciAke3VzZXJJZH1gLFxyXG4gICAgICAgIGVtYWlsOiBgdXNlciR7dXNlcklkfUBleGFtcGxlLmNvbWAsXHJcbiAgICAgICAgZW1haWxfdmVyaWZpZWQ6IHRydWUsXHJcbiAgICAgICAgaXNzOiAnaHR0cHM6Ly9zc28ueW91cmRvbWFpbi5jb20nLFxyXG4gICAgICAgIGF1ZDogaW50cm9zcGVjdGlvbi5jbGllbnRJZCxcclxuICAgICAgICBpYXQ6IGludHJvc3BlY3Rpb24uaWF0LFxyXG4gICAgICAgIGF1dGhfdGltZTogaW50cm9zcGVjdGlvbi5pYXRcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiB1c2VySW5mbztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignVXNlckluZm8gZW5kcG9pbnQgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPcGVuSUQgQ29ubmVjdDogVG9rZW4gRW5kcG9pbnRcclxuICAgKiDZhtmC2LfYqSDZhtmH2KfZitipINin2YTYqtmI2YPZhlxyXG4gICAqL1xyXG4gIGFzeW5jIGdldFRva2VucyhncmFudFR5cGUsIHBhcmFtcykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3dpdGNoIChncmFudFR5cGUpIHtcclxuICAgICAgICBjYXNlICdhdXRob3JpemF0aW9uX2NvZGUnOlxyXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhjaGFuZ2VBdXRob3JpemF0aW9uQ29kZShcclxuICAgICAgICAgICAgcGFyYW1zLmNvZGUsXHJcbiAgICAgICAgICAgIHBhcmFtcy5jbGllbnRJZCxcclxuICAgICAgICAgICAgcGFyYW1zLmNsaWVudFNlY3JldCxcclxuICAgICAgICAgICAgcGFyYW1zLnJlZGlyZWN0VXJpXHJcbiAgICAgICAgICApO1xyXG5cclxuICAgICAgICBjYXNlICdyZWZyZXNoX3Rva2VuJzpcclxuICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlZnJlc2hUb2tlbkdyYW50KHBhcmFtcy5yZWZyZXNoVG9rZW4sIHBhcmFtcy5jbGllbnRJZCk7XHJcblxyXG4gICAgICAgIGNhc2UgJ2NsaWVudF9jcmVkZW50aWFscyc6XHJcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5pbml0aWF0ZUNsaWVudENyZWRlbnRpYWxzRmxvdyhcclxuICAgICAgICAgICAgcGFyYW1zLmNsaWVudElkLFxyXG4gICAgICAgICAgICBwYXJhbXMuY2xpZW50U2VjcmV0LFxyXG4gICAgICAgICAgICBwYXJhbXMuc2NvcGVcclxuICAgICAgICAgICk7XHJcblxyXG4gICAgICAgIGNhc2UgJ3Bhc3N3b3JkJzpcclxuICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmluaXRpYXRlUmVzb3VyY2VPd25lclBhc3N3b3JkRmxvdyhcclxuICAgICAgICAgICAgcGFyYW1zLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICBwYXJhbXMucGFzc3dvcmQsXHJcbiAgICAgICAgICAgIHBhcmFtcy5zY29wZSxcclxuICAgICAgICAgICAgcGFyYW1zLmNsaWVudElkXHJcbiAgICAgICAgICApO1xyXG5cclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBncmFudCB0eXBlOiAke2dyYW50VHlwZX1gKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdUb2tlbiBlbmRwb2ludCBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZnJlc2ggVG9rZW4gR3JhbnRcclxuICAgKiDYqtit2K/ZitirINin2YTYqtmI2YPZhlxyXG4gICAqL1xyXG4gIGFzeW5jIHJlZnJlc2hUb2tlbkdyYW50KHJlZnJlc2hUb2tlbiwgY2xpZW50SWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFRoaXMgd291bGQgcGFyc2UgdGhlIHJlZnJlc2ggdG9rZW4gYW5kIGdlbmVyYXRlIG5ldyBhY2Nlc3MgdG9rZW5cclxuICAgICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IHRoaXMuc3NvU2VydmljZS5yZWZyZXNoQWNjZXNzVG9rZW4oXHJcbiAgICAgICAgbnVsbCxcclxuICAgICAgICByZWZyZXNoVG9rZW5cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgYWNjZXNzVG9rZW46IG5ld1Nlc3Npb24uYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgdG9rZW5UeXBlOiAnQmVhcmVyJyxcclxuICAgICAgICBleHBpcmVzSW46IG5ld1Nlc3Npb24uZXhwaXJlc0luXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ1JlZnJlc2ggdG9rZW4gZ3JhbnQgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPcGVuSUQgQ29ubmVjdDogLndlbGwta25vd24vb3BlbmlkLWNvbmZpZ3VyYXRpb25cclxuICAgKiDZhdi52KfZitmK2LEgT3BlbklEIENvbm5lY3RcclxuICAgKi9cclxuICBnZXRPcGVuSURDb25maWd1cmF0aW9uKCkge1xyXG4gICAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52LlNTT19CQVNFX1VSTCB8fCAnaHR0cHM6Ly9zc28ueW91cmRvbWFpbi5jb20nO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlzc3VlcjogYmFzZVVybCxcclxuICAgICAgYXV0aG9yaXphdGlvbl9lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgyL2F1dGhvcml6ZWAsXHJcbiAgICAgIHRva2VuX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aDIvdG9rZW5gLFxyXG4gICAgICB1c2VyaW5mb19lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgyL3VzZXJpbmZvYCxcclxuICAgICAgandrc191cmk6IGAke2Jhc2VVcmx9Ly53ZWxsLWtub3duL2p3a3MuanNvbmAsXHJcbiAgICAgIHJlZ2lzdHJhdGlvbl9lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgyL3JlZ2lzdGVyYCxcclxuICAgICAgcmV2b2NhdGlvbl9lbmRwb2ludDogYCR7YmFzZVVybH0vb2F1dGgyL3Jldm9rZWAsXHJcbiAgICAgIGVuZF9zZXNzaW9uX2VuZHBvaW50OiBgJHtiYXNlVXJsfS9vYXV0aDIvbG9nb3V0YCxcclxuICAgICAgcmVzcG9uc2VfdHlwZXNfc3VwcG9ydGVkOiBbXHJcbiAgICAgICAgJ2NvZGUnLFxyXG4gICAgICAgICd0b2tlbicsXHJcbiAgICAgICAgJ2lkX3Rva2VuJyxcclxuICAgICAgICAnY29kZSBpZF90b2tlbicsXHJcbiAgICAgICAgJ3Rva2VuIGlkX3Rva2VuJyxcclxuICAgICAgICAnY29kZSB0b2tlbiBpZF90b2tlbidcclxuICAgICAgXSxcclxuICAgICAgZ3JhbnRfdHlwZXNfc3VwcG9ydGVkOiBbXHJcbiAgICAgICAgJ2F1dGhvcml6YXRpb25fY29kZScsXHJcbiAgICAgICAgJ2ltcGxpY2l0JyxcclxuICAgICAgICAncmVmcmVzaF90b2tlbicsXHJcbiAgICAgICAgJ2NsaWVudF9jcmVkZW50aWFscycsXHJcbiAgICAgICAgJ3Bhc3N3b3JkJ1xyXG4gICAgICBdLFxyXG4gICAgICBzdWJqZWN0X3R5cGVzX3N1cHBvcnRlZDogWydwdWJsaWMnLCAncGFpcndpc2UnXSxcclxuICAgICAgaWRfdG9rZW5fc2lnbmluZ19hbGdfdmFsdWVzX3N1cHBvcnRlZDogWydIUzI1NicsICdSUzI1NiddLFxyXG4gICAgICBzY29wZXNfc3VwcG9ydGVkOiBbXHJcbiAgICAgICAgJ29wZW5pZCcsXHJcbiAgICAgICAgJ3Byb2ZpbGUnLFxyXG4gICAgICAgICdlbWFpbCcsXHJcbiAgICAgICAgJ2FkZHJlc3MnLFxyXG4gICAgICAgICdwaG9uZScsXHJcbiAgICAgICAgJ29mZmxpbmVfYWNjZXNzJ1xyXG4gICAgICBdLFxyXG4gICAgICBjbGFpbXNfc3VwcG9ydGVkOiBbXHJcbiAgICAgICAgJ3N1YicsXHJcbiAgICAgICAgJ25hbWUnLFxyXG4gICAgICAgICdnaXZlbl9uYW1lJyxcclxuICAgICAgICAnZmFtaWx5X25hbWUnLFxyXG4gICAgICAgICdlbWFpbCcsXHJcbiAgICAgICAgJ2VtYWlsX3ZlcmlmaWVkJyxcclxuICAgICAgICAnYWRkcmVzcycsXHJcbiAgICAgICAgJ3Bob25lX251bWJlcicsXHJcbiAgICAgICAgJ2F1dGhfdGltZSdcclxuICAgICAgXSxcclxuICAgICAgdG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2RzX3N1cHBvcnRlZDogW1xyXG4gICAgICAgICdjbGllbnRfc2VjcmV0X2Jhc2ljJyxcclxuICAgICAgICAnY2xpZW50X3NlY3JldF9wb3N0JyxcclxuICAgICAgICAnY2xpZW50X3NlY3JldF9qd3QnLFxyXG4gICAgICAgICdwcml2YXRlX2tleV9qd3QnXHJcbiAgICAgIF0sXHJcbiAgICAgIGNsYWltX3R5cGVzX3N1cHBvcnRlZDogWydub3JtYWwnLCAnYWdncmVnYXRlZCcsICdkaXN0cmlidXRlZCddLFxyXG4gICAgICBjb2RlX2NoYWxsZW5nZV9tZXRob2RzX3N1cHBvcnRlZDogWydwbGFpbicsICdTMjU2J10sXHJcbiAgICAgIHJlcXVlc3RfcGFyYW1ldGVyX3N1cHBvcnRlZDogdHJ1ZSxcclxuICAgICAgcmVxdWVzdF91cmlfcGFyYW1ldGVyX3N1cHBvcnRlZDogdHJ1ZVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBLQ0UgKFByb29mIEtleSBmb3IgUHVibGljIENsaWVudHMpIFN1cHBvcnRcclxuICAgKiDYr9i52YUgUEtDRSDZhNit2YXYp9mK2Kkg2KfZhNi52YXZhNin2KEg2KfZhNi52KfZhdmK2YZcclxuICAgKi9cclxuICBhc3luYyB2ZXJpZnlQS0NFKGNvZGVWZXJpZmllciwgY29kZUNoYWxsZW5nZSwgbWV0aG9kID0gJ1MyNTYnKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgY29tcHV0ZWRDaGFsbGVuZ2U7XHJcblxyXG4gICAgICBpZiAobWV0aG9kID09PSAnUzI1NicpIHtcclxuICAgICAgICAvLyBTSEEyNTYgaGFzaFxyXG4gICAgICAgIGNvbnN0IGhhc2ggPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKGNvZGVWZXJpZmllcikuZGlnZXN0KCk7XHJcbiAgICAgICAgY29tcHV0ZWRDaGFsbGVuZ2UgPSBCdWZmZXIuZnJvbShoYXNoKS50b1N0cmluZygnYmFzZTY0JylcclxuICAgICAgICAgIC5yZXBsYWNlKC9cXCsvZywgJy0nKVxyXG4gICAgICAgICAgLnJlcGxhY2UoL1xcLy9nLCAnXycpXHJcbiAgICAgICAgICAucmVwbGFjZSgvPS9nLCAnJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSAncGxhaW4nKSB7XHJcbiAgICAgICAgY29tcHV0ZWRDaGFsbGVuZ2UgPSBjb2RlVmVyaWZpZXI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBQS0NFIG1ldGhvZDogJHttZXRob2R9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBjb21wdXRlZENoYWxsZW5nZSA9PT0gY29kZUNoYWxsZW5nZTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignUEtDRSB2ZXJpZmljYXRpb24gZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXZva2UgVG9rZW5cclxuICAgKiDYpdmE2LrYp9ihINin2YTYqtmI2YPZhlxyXG4gICAqL1xyXG4gIGFzeW5jIHJldm9rZVRva2VuKHRva2VuLCB0b2tlblR5cGVIaW50ID0gJ2FjY2Vzc190b2tlbicpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEluIHByb2R1Y3Rpb24sIHdvdWxkIGludmFsaWRhdGUgdG9rZW4gaW4gUmVkaXNcclxuICAgICAgbG9nZ2VyLmluZm8oYFRva2VuIHJldm9rZWQ6IHR5cGU9JHt0b2tlblR5cGVIaW50fWApO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ1Rva2VuIHJldm9jYXRpb24gZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEeW5hbWljIENsaWVudCBSZWdpc3RyYXRpb25cclxuICAgKiDYqtiz2KzZitmEINi52YXZitmEINiv2YrZhtin2YXZitmD2YpcclxuICAgKi9cclxuICBhc3luYyByZWdpc3RlckNsaWVudChjbGllbnRNZXRhZGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50SWQgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKTtcclxuICAgICAgY29uc3QgY2xpZW50U2VjcmV0ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7XHJcblxyXG4gICAgICBjb25zdCBjbGllbnQgPSB7XHJcbiAgICAgICAgY2xpZW50SWQsXHJcbiAgICAgICAgY2xpZW50U2VjcmV0LFxyXG4gICAgICAgIGNsaWVudE5hbWU6IGNsaWVudE1ldGFkYXRhLmNsaWVudE5hbWUsXHJcbiAgICAgICAgcmVkaXJlY3RVcmlzOiBjbGllbnRNZXRhZGF0YS5yZWRpcmVjdFVyaXMgfHwgW10sXHJcbiAgICAgICAgcmVzcG9uc2VUeXBlczogY2xpZW50TWV0YWRhdGEucmVzcG9uc2VUeXBlcyB8fCBbJ2NvZGUnXSxcclxuICAgICAgICBncmFudFR5cGVzOiBjbGllbnRNZXRhZGF0YS5ncmFudFR5cGVzIHx8IFsnYXV0aG9yaXphdGlvbl9jb2RlJywgJ3JlZnJlc2hfdG9rZW4nXSxcclxuICAgICAgICBzY29wZXM6IGNsaWVudE1ldGFkYXRhLnNjb3BlcyB8fCBbJ29wZW5pZCcsICdwcm9maWxlJywgJ2VtYWlsJ10sXHJcbiAgICAgICAgY29udGFjdHM6IGNsaWVudE1ldGFkYXRhLmNvbnRhY3RzIHx8IFtdLFxyXG4gICAgICAgIHJlZ2lzdHJhdGlvblRpbWU6IERhdGUubm93KClcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxvZ2dlci5pbmZvKGBDbGllbnQgcmVnaXN0ZXJlZDogJHtjbGllbnRJZH1gKTtcclxuICAgICAgcmV0dXJuIHsgY2xpZW50LCBjbGllbnRTZWNyZXQgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignQ2xpZW50IHJlZ2lzdHJhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEludHJvc3BlY3QgVG9rZW4gKFRva2VuIEludHJvc3BlY3Rpb24pXHJcbiAgICog2YHYrdi1INin2YTYqNmK2KfZhtin2Kog2KfZhNmI2LXZgdmK2Kkg2YTZhNiq2YjZg9mGXHJcbiAgICovXHJcbiAgYXN5bmMgaW50cm9zcGVjdFRva2VuKHRva2VuLCBjbGllbnRJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgaW50cm9zcGVjdGlvbiA9IGF3YWl0IHRoaXMuc3NvU2VydmljZS5pbnRyb3NwZWN0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgLy8gVmVyaWZ5IGNsaWVudCBoYXMgcGVybWlzc2lvbiB0byBpbnRyb3NwZWN0XHJcbiAgICAgIGlmIChpbnRyb3NwZWN0aW9uLmNsaWVudElkICYmIGludHJvc3BlY3Rpb24uY2xpZW50SWQgIT09IGNsaWVudElkKSB7XHJcbiAgICAgICAgbG9nZ2VyLndhcm4oYFVuYXV0aG9yaXplZCBpbnRyb3NwZWN0aW9uIGF0dGVtcHQgYnkgY2xpZW50OiAke2NsaWVudElkfWApO1xyXG4gICAgICAgIHJldHVybiB7IGFjdGl2ZTogZmFsc2UgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGludHJvc3BlY3Rpb247XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ1Rva2VuIGludHJvc3BlY3Rpb24gZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgYWN0aXZlOiBmYWxzZSB9O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBPQXV0aFNlcnZpY2U7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLE1BQU1DLFVBQVUsR0FBR0QsT0FBTyxDQUFDLGVBQWUsQ0FBQztBQUMzQyxNQUFNRSxNQUFNLEdBQUdGLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUV6QyxNQUFNRyxZQUFZLENBQUM7RUFDakJDLFdBQVdBLENBQUEsRUFB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