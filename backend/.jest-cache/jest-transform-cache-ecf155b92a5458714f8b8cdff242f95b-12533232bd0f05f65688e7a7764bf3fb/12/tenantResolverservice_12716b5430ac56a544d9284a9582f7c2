cd9e69111c60f86e88b0a84e4bd60679
/**
 * Tenant Resolver Service
 * خدمة حل الالتزامات
 * 
 * المسؤوليات:
 * - حل الالتزامات من الطلبات
 * - عزل بيانات الالتزام
 * - إدارة سياق الالتزام
 * - التحقق من وصول الالتزام
 */

const {
  EventEmitter
} = require('events');
const Logger = require('../utils/logger');
const tenantService = require('./tenant.service');
class TenantResolverService extends EventEmitter {
  constructor() {
    super();
    this.logger = Logger;

    // Context storage (tenant-request mapping)
    this.requestContext = new Map();

    // Tenant cache
    this.tenantCache = new Map();

    // Cache TTL: 5 minutes
    this.cacheTTL = 5 * 60 * 1000;
  }

  /**
   * Resolve tenant from request
   * حل الالتزام من الطلب
   * 
   * Tries to resolve tenant from:
   * 1. X-Tenant-ID header
   * 2. Subdomain
   * 3. User's primary tenant
   * 
   * @param {Object} req - Express request
   * @returns {Object} Tenant or null
   */
  resolveTenant(req) {
    try {
      let tenant = null;

      // 1. Check X-Tenant-ID header
      const headerTenantId = req.headers['x-tenant-id'];
      if (headerTenantId) {
        tenant = this._getCachedOrFetch('id', headerTenantId);
        if (tenant && this._canUserAccessTenant(req.user?.id, tenant.id)) {
          return tenant;
        }
      }

      // 2. Check subdomain
      const subdomain = this._extractSubdomain(req);
      if (subdomain && subdomain !== 'www' && subdomain !== 'api') {
        tenant = this._getCachedOrFetch('subdomain', subdomain);
        if (tenant && this._canUserAccessTenant(req.user?.id, tenant.id)) {
          return tenant;
        }
      }

      // 3. Check hostname-based routing
      const hostname = req.hostname;
      tenant = this._resolveTenantFromHostname(hostname);
      if (tenant && this._canUserAccessTenant(req.user?.id, tenant.id)) {
        return tenant;
      }

      // 4. Use user's primary tenant
      if (req.user?.id) {
        const userTenants = tenantService.getUserTenants(req.user.id);
        if (userTenants.length > 0) {
          return userTenants[0]; // Primary tenant
        }
      }
      return null;
    } catch (error) {
      this.logger.error(`Error resolving tenant: ${error.message}`);
      return null;
    }
  }

  /**
   * Extract subdomain from request
   * استخراج النطاق الفرعي من الطلب
   * 
   * @private
   */
  _extractSubdomain(req) {
    try {
      const hostname = req.hostname;
      const parts = hostname.split('.');

      // localhost:3000 has no subdomain
      if (parts.length <= 1 || hostname.includes(':')) {
        return null;
      }

      // For example.com, return 'example'
      // For tenant.example.com, return 'tenant'
      return parts[0];
    } catch (error) {
      return null;
    }
  }

  /**
   * Resolve tenant from hostname
   * حل الالتزام من اسم المضيف
   * 
   * @private
   */
  _resolveTenantFromHostname(hostname) {
    try {
      // Check if it's a tenant subdomain
      const tenants = tenantService.getAllTenants();
      return tenants.find(t => t.subdomain === hostname);
    } catch (error) {
      return null;
    }
  }

  /**
   * Get cached or fetch tenant
   * الحصول على الالتزام المخزن مؤقتًا أو جلبه
   * 
   * @private
   */
  _getCachedOrFetch(type, value) {
    try {
      const cacheKey = `${type}:${value}`;

      // Check cache
      const cached = this.tenantCache.get(cacheKey);
      if (cached && cached.expiresAt > Date.now()) {
        return cached.tenant;
      }

      // Fetch from service
      let tenant;
      if (type === 'id') {
        tenant = tenantService.getTenant(value);
      } else if (type === 'subdomain') {
        tenant = tenantService.getTenantBySlug(value);
      }

      // Cache result
      if (tenant) {
        this.tenantCache.set(cacheKey, {
          tenant,
          expiresAt: Date.now() + this.cacheTTL
        });
      }
      return tenant;
    } catch (error) {
      return null;
    }
  }

  /**
   * Check if user can access tenant
   * التحقق من إمكانية وصول المستخدم للالتزام
   * 
   * @private
   */
  _canUserAccessTenant(userId, tenantId) {
    try {
      if (!userId) return false;
      const users = tenantService.tenantUsers.get(tenantId);
      return users ? users.has(userId) : false;
    } catch (error) {
      return false;
    }
  }

  /**
   * Set request tenant context
   * تعيين سياق الالتزام للطلب
   * 
   * @param {Object} req - Express request
   * @param {Object} tenant - Tenant object
   */
  setTenantContext(req, tenant) {
    try {
      const requestId = req.id || `${Date.now()}-${Math.random()}`;
      req.tenant = tenant;
      req.tenantId = tenant?.id;
      this.requestContext.set(requestId, {
        tenantId: tenant?.id,
        userId: req.user?.id,
        timestamp: new Date(),
        method: req.method,
        path: req.path
      });
      this.emit('tenant:context_set', {
        requestId,
        tenantId: tenant?.id
      });
    } catch (error) {
      this.logger.error(`Error setting tenant context: ${error.message}`);
    }
  }

  /**
   * Build tenant-scoped query
   * بناء استعلام نطاقه الالتزام
   * 
   * Automatically adds tenantId filter to MongoDB queries
   * 
   * @param {String} tenantId - Tenant ID
   * @param {Object} baseQuery - Base query
   * @returns {Object} Tenant-scoped query
   */
  buildTenantQuery(tenantId, baseQuery = {}) {
    try {
      return {
        ...baseQuery,
        tenantId: tenantId
      };
    } catch (error) {
      this.logger.error(`Error building tenant query: ${error.message}`);
      return baseQuery;
    }
  }

  /**
   * Validate tenant access
   * التحقق من وصول الالتزام
   * 
   * @param {Object} req - Express request
   * @returns {Boolean} Can access
   */
  canAccessTenant(req) {
    try {
      const tenant = req.tenant;
      const userId = req.user?.id;
      if (!tenant || !userId) {
        return false;
      }
      if (tenant.status !== 'active') {
        return false;
      }

      // Check if user belongs to tenant
      const users = tenantService.tenantUsers.get(tenant.id);
      if (!users || !users.has(userId)) {
        return false;
      }
      return true;
    } catch (error) {
      this.logger.error(`Error validating tenant access: ${error.message}`);
      return false;
    }
  }

  /**
   * Get tenant resources
   * الحصول على موارد الالتزام
   * 
   * Returns all resources (filtered by tenant)
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} resourceType - Resource type
   * @param {Object} filters - Filters
   * @returns {Array} Resources
   */
  getTenantResources(tenantId, resourceType, filters = {}) {
    try {
      const tenantQuery = this.buildTenantQuery(tenantId, filters);

      // This would be called on actual database queries
      // For now, return structured query
      return {
        tenantId,
        resourceType,
        query: tenantQuery
      };
    } catch (error) {
      this.logger.error(`Error getting tenant resources: ${error.message}`);
      return [];
    }
  }

  /**
   * Check quota
   * التحقق من الحصة
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} quotaType - quota type (users, storage, api)
   * @returns {Boolean} Within quota
   */
  checkQuota(tenantId, quotaType = 'api') {
    try {
      const quota = tenantService.getTenantQuota(tenantId);
      if (!quota) return false;
      switch (quotaType) {
        case 'users':
          return quota.usedUsers < quota.maxUsers;
        case 'storage':
          return quota.usedStorage < quota.storageGB;
        case 'api':
          return quota.usedApiCalls < quota.apiCallsPerDay;
        default:
          return true;
      }
    } catch (error) {
      this.logger.error(`Error checking quota: ${error.message}`);
      return false;
    }
  }

  /**
   * Get tenant user role
   * الحصول على دور مستخدم الالتزام
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @returns {String} User role
   */
  getTenantUserRole(tenantId, userId) {
    try {
      const users = tenantService.tenantUsers.get(tenantId);
      if (!users) return null;
      const userData = users.get(userId);
      return userData ? userData.role : null;
    } catch (error) {
      this.logger.error(`Error getting user role: ${error.message}`);
      return null;
    }
  }

  /**
   * Check tenant permission
   * التحقق من إذن الالتزام
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @param {String} permission - Permission
   * @returns {Boolean} Has permission
   */
  hasTenantPermission(tenantId, userId, permission) {
    try {
      const role = this.getTenantUserRole(tenantId, userId);
      if (!role) return false;

      // Role-based permission mapping
      const rolePermissions = {
        owner: ['*'],
        admin: ['read', 'write', 'delete', 'manage_users'],
        manager: ['read', 'write', 'manage_own_data'],
        member: ['read', 'write_own_data'],
        viewer: ['read']
      };
      const permissions = rolePermissions[role] || [];
      return permissions.includes('*') || permissions.includes(permission);
    } catch (error) {
      this.logger.error(`Error checking permission: ${error.message}`);
      return false;
    }
  }

  /**
   * Clear expired cache
   * تنظيف الذاكرة المؤقتة المنتهية الصلاحية
   * 
   * @private
   */
  clearExpiredCache() {
    try {
      const now = Date.now();
      const toDelete = [];
      this.tenantCache.forEach((value, key) => {
        if (value.expiresAt <= now) {
          toDelete.push(key);
        }
      });
      toDelete.forEach(key => this.tenantCache.delete(key));
      if (toDelete.length > 0) {
        this.logger.info(`Cleared ${toDelete.length} expired tenant cache entries`);
      }
    } catch (error) {
      this.logger.error(`Error clearing cache: ${error.message}`);
    }
  }

  /**
   * Start cache cleanup interval
   * بدء فترة تنظيف الذاكرة المؤقتة
   */
  startCacheCleanup() {
    setInterval(() => {
      this.clearExpiredCache();
    }, 60 * 1000); // Every minute
  }

  /**
   * Get statistics
   * الحصول على الإحصائيات
   * 
   * @returns {Object} Statistics
   */
  getStatistics() {
    return {
      cachedTenants: this.tenantCache.size,
      requestContexts: this.requestContext.size,
      cacheHitRate: this._calculateCacheHitRate()
    };
  }

  /**
   * Calculate cache hit rate
   * حساب معدل الإصابة في الذاكرة المؤقتة
   * 
   * @private
   */
  _calculateCacheHitRate() {
    // Placeholder - would track hits/misses in production
    return '0.00%';
  }
}
module.exports = new TenantResolverService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJyZXF1aXJlIiwiTG9nZ2VyIiwidGVuYW50U2VydmljZSIsIlRlbmFudFJlc29sdmVyU2VydmljZSIsImNvbnN0cnVjdG9yIiwibG9nZ2VyIiwicmVxdWVzdENvbnRleHQiLCJNYXAiLCJ0ZW5hbnRDYWNoZSIsImNhY2hlVFRMIiwicmVzb2x2ZVRlbmFudCIsInJlcSIsInRlbmFudCIsImhlYWRlclRlbmFudElkIiwiaGVhZGVycyIsIl9nZXRDYWNoZWRPckZldGNoIiwiX2NhblVzZXJBY2Nlc3NUZW5hbnQiLCJ1c2VyIiwiaWQiLCJzdWJkb21haW4iLCJfZXh0cmFjdFN1YmRvbWFpbiIsImhvc3RuYW1lIiwiX3Jlc29sdmVUZW5hbnRGcm9tSG9zdG5hbWUiLCJ1c2VyVGVuYW50cyIsImdldFVzZXJUZW5hbnRzIiwibGVuZ3RoIiwiZXJyb3IiLCJtZXNzYWdlIiwicGFydHMiLCJzcGxpdCIsImluY2x1ZGVzIiwidGVuYW50cyIsImdldEFsbFRlbmFudHMiLCJmaW5kIiwidCIsInR5cGUiLCJ2YWx1ZSIsImNhY2hlS2V5IiwiY2FjaGVkIiwiZ2V0IiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsImdldFRlbmFudCIsImdldFRlbmFudEJ5U2x1ZyIsInNldCIsInVzZXJJZCIsInRlbmFudElkIiwidXNlcnMiLCJ0ZW5hbnRVc2VycyIsImhhcyIsInNldFRlbmFudENvbnRleHQiLCJyZXF1ZXN0SWQiLCJNYXRoIiwicmFuZG9tIiwidGltZXN0YW1wIiwibWV0aG9kIiwicGF0aCIsImVtaXQiLCJidWlsZFRlbmFudFF1ZXJ5IiwiYmFzZVF1ZXJ5IiwiY2FuQWNjZXNzVGVuYW50Iiwic3RhdHVzIiwiZ2V0VGVuYW50UmVzb3VyY2VzIiwicmVzb3VyY2VUeXBlIiwiZmlsdGVycyIsInRlbmFudFF1ZXJ5IiwicXVlcnkiLCJjaGVja1F1b3RhIiwicXVvdGFUeXBlIiwicXVvdGEiLCJnZXRUZW5hbnRRdW90YSIsInVzZWRVc2VycyIsIm1heFVzZXJzIiwidXNlZFN0b3JhZ2UiLCJzdG9yYWdlR0IiLCJ1c2VkQXBpQ2FsbHMiLCJhcGlDYWxsc1BlckRheSIsImdldFRlbmFudFVzZXJSb2xlIiwidXNlckRhdGEiLCJyb2xlIiwiaGFzVGVuYW50UGVybWlzc2lvbiIsInBlcm1pc3Npb24iLCJyb2xlUGVybWlzc2lvbnMiLCJvd25lciIsImFkbWluIiwibWFuYWdlciIsIm1lbWJlciIsInZpZXdlciIsInBlcm1pc3Npb25zIiwiY2xlYXJFeHBpcmVkQ2FjaGUiLCJ0b0RlbGV0ZSIsImZvckVhY2giLCJrZXkiLCJwdXNoIiwiZGVsZXRlIiwiaW5mbyIsInN0YXJ0Q2FjaGVDbGVhbnVwIiwic2V0SW50ZXJ2YWwiLCJnZXRTdGF0aXN0aWNzIiwiY2FjaGVkVGVuYW50cyIsInNpemUiLCJyZXF1ZXN0Q29udGV4dHMiLCJjYWNoZUhpdFJhdGUiLCJfY2FsY3VsYXRlQ2FjaGVIaXRSYXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInRlbmFudFJlc29sdmVyLnNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFRlbmFudCBSZXNvbHZlciBTZXJ2aWNlXHJcbiAqINiu2K/ZhdipINit2YQg2KfZhNin2YTYqtiy2KfZhdin2KpcclxuICogXHJcbiAqINin2YTZhdiz2KTZiNmE2YrYp9iqOlxyXG4gKiAtINit2YQg2KfZhNin2YTYqtiy2KfZhdin2Kog2YXZhiDYp9mE2LfZhNio2KfYqlxyXG4gKiAtINi52LLZhCDYqNmK2KfZhtin2Kog2KfZhNin2YTYqtiy2KfZhVxyXG4gKiAtINil2K/Yp9ix2Kkg2LPZitin2YIg2KfZhNin2YTYqtiy2KfZhVxyXG4gKiAtINin2YTYqtit2YLZgiDZhdmGINmI2LXZiNmEINin2YTYp9mE2KrYstin2YVcclxuICovXHJcblxyXG5jb25zdCB7IEV2ZW50RW1pdHRlciB9ID0gcmVxdWlyZSgnZXZlbnRzJyk7XHJcbmNvbnN0IExvZ2dlciA9IHJlcXVpcmUoJy4uL3V0aWxzL2xvZ2dlcicpO1xyXG5jb25zdCB0ZW5hbnRTZXJ2aWNlID0gcmVxdWlyZSgnLi90ZW5hbnQuc2VydmljZScpO1xyXG5cclxuY2xhc3MgVGVuYW50UmVzb2x2ZXJTZXJ2aWNlIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLmxvZ2dlciA9IExvZ2dlcjtcclxuXHJcbiAgICAvLyBDb250ZXh0IHN0b3JhZ2UgKHRlbmFudC1yZXF1ZXN0IG1hcHBpbmcpXHJcbiAgICB0aGlzLnJlcXVlc3RDb250ZXh0ID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIC8vIFRlbmFudCBjYWNoZVxyXG4gICAgdGhpcy50ZW5hbnRDYWNoZSA9IG5ldyBNYXAoKTtcclxuXHJcbiAgICAvLyBDYWNoZSBUVEw6IDUgbWludXRlc1xyXG4gICAgdGhpcy5jYWNoZVRUTCA9IDUgKiA2MCAqIDEwMDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNvbHZlIHRlbmFudCBmcm9tIHJlcXVlc3RcclxuICAgKiDYrdmEINin2YTYp9mE2KrYstin2YUg2YXZhiDYp9mE2LfZhNioXHJcbiAgICogXHJcbiAgICogVHJpZXMgdG8gcmVzb2x2ZSB0ZW5hbnQgZnJvbTpcclxuICAgKiAxLiBYLVRlbmFudC1JRCBoZWFkZXJcclxuICAgKiAyLiBTdWJkb21haW5cclxuICAgKiAzLiBVc2VyJ3MgcHJpbWFyeSB0ZW5hbnRcclxuICAgKiBcclxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gRXhwcmVzcyByZXF1ZXN0XHJcbiAgICogQHJldHVybnMge09iamVjdH0gVGVuYW50IG9yIG51bGxcclxuICAgKi9cclxuICByZXNvbHZlVGVuYW50KHJlcSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IHRlbmFudCA9IG51bGw7XHJcblxyXG4gICAgICAvLyAxLiBDaGVjayBYLVRlbmFudC1JRCBoZWFkZXJcclxuICAgICAgY29uc3QgaGVhZGVyVGVuYW50SWQgPSByZXEuaGVhZGVyc1sneC10ZW5hbnQtaWQnXTtcclxuICAgICAgaWYgKGhlYWRlclRlbmFudElkKSB7XHJcbiAgICAgICAgdGVuYW50ID0gdGhpcy5fZ2V0Q2FjaGVkT3JGZXRjaCgnaWQnLCBoZWFkZXJUZW5hbnRJZCk7XHJcbiAgICAgICAgaWYgKHRlbmFudCAmJiB0aGlzLl9jYW5Vc2VyQWNjZXNzVGVuYW50KHJlcS51c2VyPy5pZCwgdGVuYW50LmlkKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHRlbmFudDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIDIuIENoZWNrIHN1YmRvbWFpblxyXG4gICAgICBjb25zdCBzdWJkb21haW4gPSB0aGlzLl9leHRyYWN0U3ViZG9tYWluKHJlcSk7XHJcbiAgICAgIGlmIChzdWJkb21haW4gJiYgc3ViZG9tYWluICE9PSAnd3d3JyAmJiBzdWJkb21haW4gIT09ICdhcGknKSB7XHJcbiAgICAgICAgdGVuYW50ID0gdGhpcy5fZ2V0Q2FjaGVkT3JGZXRjaCgnc3ViZG9tYWluJywgc3ViZG9tYWluKTtcclxuICAgICAgICBpZiAodGVuYW50ICYmIHRoaXMuX2NhblVzZXJBY2Nlc3NUZW5hbnQocmVxLnVzZXI/LmlkLCB0ZW5hbnQuaWQpKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGVuYW50O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gMy4gQ2hlY2sgaG9zdG5hbWUtYmFzZWQgcm91dGluZ1xyXG4gICAgICBjb25zdCBob3N0bmFtZSA9IHJlcS5ob3N0bmFtZTtcclxuICAgICAgdGVuYW50ID0gdGhpcy5fcmVzb2x2ZVRlbmFudEZyb21Ib3N0bmFtZShob3N0bmFtZSk7XHJcbiAgICAgIGlmICh0ZW5hbnQgJiYgdGhpcy5fY2FuVXNlckFjY2Vzc1RlbmFudChyZXEudXNlcj8uaWQsIHRlbmFudC5pZCkpIHtcclxuICAgICAgICByZXR1cm4gdGVuYW50O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyA0LiBVc2UgdXNlcidzIHByaW1hcnkgdGVuYW50XHJcbiAgICAgIGlmIChyZXEudXNlcj8uaWQpIHtcclxuICAgICAgICBjb25zdCB1c2VyVGVuYW50cyA9IHRlbmFudFNlcnZpY2UuZ2V0VXNlclRlbmFudHMocmVxLnVzZXIuaWQpO1xyXG4gICAgICAgIGlmICh1c2VyVGVuYW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICByZXR1cm4gdXNlclRlbmFudHNbMF07IC8vIFByaW1hcnkgdGVuYW50XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciByZXNvbHZpbmcgdGVuYW50OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRXh0cmFjdCBzdWJkb21haW4gZnJvbSByZXF1ZXN0XHJcbiAgICog2KfYs9iq2K7Ysdin2Kwg2KfZhNmG2LfYp9mCINin2YTZgdix2LnZiiDZhdmGINin2YTYt9mE2KhcclxuICAgKiBcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIF9leHRyYWN0U3ViZG9tYWluKHJlcSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgaG9zdG5hbWUgPSByZXEuaG9zdG5hbWU7XHJcbiAgICAgIGNvbnN0IHBhcnRzID0gaG9zdG5hbWUuc3BsaXQoJy4nKTtcclxuXHJcbiAgICAgIC8vIGxvY2FsaG9zdDozMDAwIGhhcyBubyBzdWJkb21haW5cclxuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA8PSAxIHx8IGhvc3RuYW1lLmluY2x1ZGVzKCc6JykpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRm9yIGV4YW1wbGUuY29tLCByZXR1cm4gJ2V4YW1wbGUnXHJcbiAgICAgIC8vIEZvciB0ZW5hbnQuZXhhbXBsZS5jb20sIHJldHVybiAndGVuYW50J1xyXG4gICAgICByZXR1cm4gcGFydHNbMF07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc29sdmUgdGVuYW50IGZyb20gaG9zdG5hbWVcclxuICAgKiDYrdmEINin2YTYp9mE2KrYstin2YUg2YXZhiDYp9iz2YUg2KfZhNmF2LbZitmBXHJcbiAgICogXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBfcmVzb2x2ZVRlbmFudEZyb21Ib3N0bmFtZShob3N0bmFtZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhIHRlbmFudCBzdWJkb21haW5cclxuICAgICAgY29uc3QgdGVuYW50cyA9IHRlbmFudFNlcnZpY2UuZ2V0QWxsVGVuYW50cygpO1xyXG4gICAgICByZXR1cm4gdGVuYW50cy5maW5kKHQgPT4gdC5zdWJkb21haW4gPT09IGhvc3RuYW1lKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGNhY2hlZCBvciBmZXRjaCB0ZW5hbnRcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINin2YTYp9mE2KrYstin2YUg2KfZhNmF2K7YstmGINmF2KTZgtiq2YvYpyDYo9mIINis2YTYqNmHXHJcbiAgICogXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBfZ2V0Q2FjaGVkT3JGZXRjaCh0eXBlLCB2YWx1ZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2FjaGVLZXkgPSBgJHt0eXBlfToke3ZhbHVlfWA7XHJcblxyXG4gICAgICAvLyBDaGVjayBjYWNoZVxyXG4gICAgICBjb25zdCBjYWNoZWQgPSB0aGlzLnRlbmFudENhY2hlLmdldChjYWNoZUtleSk7XHJcbiAgICAgIGlmIChjYWNoZWQgJiYgY2FjaGVkLmV4cGlyZXNBdCA+IERhdGUubm93KCkpIHtcclxuICAgICAgICByZXR1cm4gY2FjaGVkLnRlbmFudDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRmV0Y2ggZnJvbSBzZXJ2aWNlXHJcbiAgICAgIGxldCB0ZW5hbnQ7XHJcbiAgICAgIGlmICh0eXBlID09PSAnaWQnKSB7XHJcbiAgICAgICAgdGVuYW50ID0gdGVuYW50U2VydmljZS5nZXRUZW5hbnQodmFsdWUpO1xyXG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdzdWJkb21haW4nKSB7XHJcbiAgICAgICAgdGVuYW50ID0gdGVuYW50U2VydmljZS5nZXRUZW5hbnRCeVNsdWcodmFsdWUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDYWNoZSByZXN1bHRcclxuICAgICAgaWYgKHRlbmFudCkge1xyXG4gICAgICAgIHRoaXMudGVuYW50Q2FjaGUuc2V0KGNhY2hlS2V5LCB7XHJcbiAgICAgICAgICB0ZW5hbnQsXHJcbiAgICAgICAgICBleHBpcmVzQXQ6IERhdGUubm93KCkgKyB0aGlzLmNhY2hlVFRMXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0ZW5hbnQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIHVzZXIgY2FuIGFjY2VzcyB0ZW5hbnRcclxuICAgKiDYp9mE2KrYrdmC2YIg2YXZhiDYpdmF2YPYp9mG2YrYqSDZiNi12YjZhCDYp9mE2YXYs9iq2K7Yr9mFINmE2YTYp9mE2KrYstin2YVcclxuICAgKiBcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIF9jYW5Vc2VyQWNjZXNzVGVuYW50KHVzZXJJZCwgdGVuYW50SWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghdXNlcklkKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICBjb25zdCB1c2VycyA9IHRlbmFudFNlcnZpY2UudGVuYW50VXNlcnMuZ2V0KHRlbmFudElkKTtcclxuICAgICAgcmV0dXJuIHVzZXJzID8gdXNlcnMuaGFzKHVzZXJJZCkgOiBmYWxzZTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCByZXF1ZXN0IHRlbmFudCBjb250ZXh0XHJcbiAgICog2KrYudmK2YrZhiDYs9mK2KfZgiDYp9mE2KfZhNiq2LLYp9mFINmE2YTYt9mE2KhcclxuICAgKiBcclxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gRXhwcmVzcyByZXF1ZXN0XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHRlbmFudCAtIFRlbmFudCBvYmplY3RcclxuICAgKi9cclxuICBzZXRUZW5hbnRDb250ZXh0KHJlcSwgdGVuYW50KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXF1ZXN0SWQgPSByZXEuaWQgfHwgYCR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpfWA7XHJcblxyXG4gICAgICByZXEudGVuYW50ID0gdGVuYW50O1xyXG4gICAgICByZXEudGVuYW50SWQgPSB0ZW5hbnQ/LmlkO1xyXG5cclxuICAgICAgdGhpcy5yZXF1ZXN0Q29udGV4dC5zZXQocmVxdWVzdElkLCB7XHJcbiAgICAgICAgdGVuYW50SWQ6IHRlbmFudD8uaWQsXHJcbiAgICAgICAgdXNlcklkOiByZXEudXNlcj8uaWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcclxuICAgICAgICBwYXRoOiByZXEucGF0aFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuZW1pdCgndGVuYW50OmNvbnRleHRfc2V0JywgeyByZXF1ZXN0SWQsIHRlbmFudElkOiB0ZW5hbnQ/LmlkIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIHNldHRpbmcgdGVuYW50IGNvbnRleHQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJ1aWxkIHRlbmFudC1zY29wZWQgcXVlcnlcclxuICAgKiDYqNmG2KfYoSDYp9iz2KrYudmE2KfZhSDZhti32KfZgtmHINin2YTYp9mE2KrYstin2YVcclxuICAgKiBcclxuICAgKiBBdXRvbWF0aWNhbGx5IGFkZHMgdGVuYW50SWQgZmlsdGVyIHRvIE1vbmdvREIgcXVlcmllc1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBiYXNlUXVlcnkgLSBCYXNlIHF1ZXJ5XHJcbiAgICogQHJldHVybnMge09iamVjdH0gVGVuYW50LXNjb3BlZCBxdWVyeVxyXG4gICAqL1xyXG4gIGJ1aWxkVGVuYW50UXVlcnkodGVuYW50SWQsIGJhc2VRdWVyeSA9IHt9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLmJhc2VRdWVyeSxcclxuICAgICAgICB0ZW5hbnRJZDogdGVuYW50SWRcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBidWlsZGluZyB0ZW5hbnQgcXVlcnk6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmV0dXJuIGJhc2VRdWVyeTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlIHRlbmFudCBhY2Nlc3NcclxuICAgKiDYp9mE2KrYrdmC2YIg2YXZhiDZiNi12YjZhCDYp9mE2KfZhNiq2LLYp9mFXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHJlcSAtIEV4cHJlc3MgcmVxdWVzdFxyXG4gICAqIEByZXR1cm5zIHtCb29sZWFufSBDYW4gYWNjZXNzXHJcbiAgICovXHJcbiAgY2FuQWNjZXNzVGVuYW50KHJlcSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdGVuYW50ID0gcmVxLnRlbmFudDtcclxuICAgICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkO1xyXG5cclxuICAgICAgaWYgKCF0ZW5hbnQgfHwgIXVzZXJJZCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRlbmFudC5zdGF0dXMgIT09ICdhY3RpdmUnKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGJlbG9uZ3MgdG8gdGVuYW50XHJcbiAgICAgIGNvbnN0IHVzZXJzID0gdGVuYW50U2VydmljZS50ZW5hbnRVc2Vycy5nZXQodGVuYW50LmlkKTtcclxuICAgICAgaWYgKCF1c2VycyB8fCAhdXNlcnMuaGFzKHVzZXJJZCkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIHZhbGlkYXRpbmcgdGVuYW50IGFjY2VzczogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGVuYW50IHJlc291cmNlc1xyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2YXZiNin2LHYryDYp9mE2KfZhNiq2LLYp9mFXHJcbiAgICogXHJcbiAgICogUmV0dXJucyBhbGwgcmVzb3VyY2VzIChmaWx0ZXJlZCBieSB0ZW5hbnQpXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHRlbmFudElkIC0gVGVuYW50IElEXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHJlc291cmNlVHlwZSAtIFJlc291cmNlIHR5cGVcclxuICAgKiBAcGFyYW0ge09iamVjdH0gZmlsdGVycyAtIEZpbHRlcnNcclxuICAgKiBAcmV0dXJucyB7QXJyYXl9IFJlc291cmNlc1xyXG4gICAqL1xyXG4gIGdldFRlbmFudFJlc291cmNlcyh0ZW5hbnRJZCwgcmVzb3VyY2VUeXBlLCBmaWx0ZXJzID0ge30pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHRlbmFudFF1ZXJ5ID0gdGhpcy5idWlsZFRlbmFudFF1ZXJ5KHRlbmFudElkLCBmaWx0ZXJzKTtcclxuXHJcbiAgICAgIC8vIFRoaXMgd291bGQgYmUgY2FsbGVkIG9uIGFjdHVhbCBkYXRhYmFzZSBxdWVyaWVzXHJcbiAgICAgIC8vIEZvciBub3csIHJldHVybiBzdHJ1Y3R1cmVkIHF1ZXJ5XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdGVuYW50SWQsXHJcbiAgICAgICAgcmVzb3VyY2VUeXBlLFxyXG4gICAgICAgIHF1ZXJ5OiB0ZW5hbnRRdWVyeVxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGdldHRpbmcgdGVuYW50IHJlc291cmNlczogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBxdW90YVxyXG4gICAqINin2YTYqtit2YLZgiDZhdmGINin2YTYrdi12KlcclxuICAgKiBcclxuICAgKiBAcGFyYW0ge1N0cmluZ30gdGVuYW50SWQgLSBUZW5hbnQgSURcclxuICAgKiBAcGFyYW0ge1N0cmluZ30gcXVvdGFUeXBlIC0gcXVvdGEgdHlwZSAodXNlcnMsIHN0b3JhZ2UsIGFwaSlcclxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gV2l0aGluIHF1b3RhXHJcbiAgICovXHJcbiAgY2hlY2tRdW90YSh0ZW5hbnRJZCwgcXVvdGFUeXBlID0gJ2FwaScpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHF1b3RhID0gdGVuYW50U2VydmljZS5nZXRUZW5hbnRRdW90YSh0ZW5hbnRJZCk7XHJcbiAgICAgIGlmICghcXVvdGEpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgIHN3aXRjaCAocXVvdGFUeXBlKSB7XHJcbiAgICAgICAgY2FzZSAndXNlcnMnOlxyXG4gICAgICAgICAgcmV0dXJuIHF1b3RhLnVzZWRVc2VycyA8IHF1b3RhLm1heFVzZXJzO1xyXG4gICAgICAgIGNhc2UgJ3N0b3JhZ2UnOlxyXG4gICAgICAgICAgcmV0dXJuIHF1b3RhLnVzZWRTdG9yYWdlIDwgcXVvdGEuc3RvcmFnZUdCO1xyXG4gICAgICAgIGNhc2UgJ2FwaSc6XHJcbiAgICAgICAgICByZXR1cm4gcXVvdGEudXNlZEFwaUNhbGxzIDwgcXVvdGEuYXBpQ2FsbHNQZXJEYXk7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgY2hlY2tpbmcgcXVvdGE6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHRlbmFudCB1c2VyIHJvbGVcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINiv2YjYsSDZhdiz2KrYrtiv2YUg2KfZhNin2YTYqtiy2KfZhVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHJldHVybnMge1N0cmluZ30gVXNlciByb2xlXHJcbiAgICovXHJcbiAgZ2V0VGVuYW50VXNlclJvbGUodGVuYW50SWQsIHVzZXJJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdXNlcnMgPSB0ZW5hbnRTZXJ2aWNlLnRlbmFudFVzZXJzLmdldCh0ZW5hbnRJZCk7XHJcbiAgICAgIGlmICghdXNlcnMpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgY29uc3QgdXNlckRhdGEgPSB1c2Vycy5nZXQodXNlcklkKTtcclxuICAgICAgcmV0dXJuIHVzZXJEYXRhID8gdXNlckRhdGEucm9sZSA6IG51bGw7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyB1c2VyIHJvbGU6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayB0ZW5hbnQgcGVybWlzc2lvblxyXG4gICAqINin2YTYqtit2YLZgiDZhdmGINil2LDZhiDYp9mE2KfZhNiq2LLYp9mFXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHRlbmFudElkIC0gVGVuYW50IElEXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge1N0cmluZ30gcGVybWlzc2lvbiAtIFBlcm1pc3Npb25cclxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gSGFzIHBlcm1pc3Npb25cclxuICAgKi9cclxuICBoYXNUZW5hbnRQZXJtaXNzaW9uKHRlbmFudElkLCB1c2VySWQsIHBlcm1pc3Npb24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJvbGUgPSB0aGlzLmdldFRlbmFudFVzZXJSb2xlKHRlbmFudElkLCB1c2VySWQpO1xyXG4gICAgICBpZiAoIXJvbGUpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgIC8vIFJvbGUtYmFzZWQgcGVybWlzc2lvbiBtYXBwaW5nXHJcbiAgICAgIGNvbnN0IHJvbGVQZXJtaXNzaW9ucyA9IHtcclxuICAgICAgICBvd25lcjogWycqJ10sXHJcbiAgICAgICAgYWRtaW46IFsncmVhZCcsICd3cml0ZScsICdkZWxldGUnLCAnbWFuYWdlX3VzZXJzJ10sXHJcbiAgICAgICAgbWFuYWdlcjogWydyZWFkJywgJ3dyaXRlJywgJ21hbmFnZV9vd25fZGF0YSddLFxyXG4gICAgICAgIG1lbWJlcjogWydyZWFkJywgJ3dyaXRlX293bl9kYXRhJ10sXHJcbiAgICAgICAgdmlld2VyOiBbJ3JlYWQnXVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcGVybWlzc2lvbnMgPSByb2xlUGVybWlzc2lvbnNbcm9sZV0gfHwgW107XHJcbiAgICAgIHJldHVybiBwZXJtaXNzaW9ucy5pbmNsdWRlcygnKicpIHx8IHBlcm1pc3Npb25zLmluY2x1ZGVzKHBlcm1pc3Npb24pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGNoZWNraW5nIHBlcm1pc3Npb246ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xlYXIgZXhwaXJlZCBjYWNoZVxyXG4gICAqINiq2YbYuNmK2YEg2KfZhNiw2KfZg9ix2Kkg2KfZhNmF2KTZgtiq2Kkg2KfZhNmF2YbYqtmH2YrYqSDYp9mE2LXZhNin2K3ZitipXHJcbiAgICogXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBjbGVhckV4cGlyZWRDYWNoZSgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICAgIGNvbnN0IHRvRGVsZXRlID0gW107XHJcblxyXG4gICAgICB0aGlzLnRlbmFudENhY2hlLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcclxuICAgICAgICBpZiAodmFsdWUuZXhwaXJlc0F0IDw9IG5vdykge1xyXG4gICAgICAgICAgdG9EZWxldGUucHVzaChrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0b0RlbGV0ZS5mb3JFYWNoKGtleSA9PiB0aGlzLnRlbmFudENhY2hlLmRlbGV0ZShrZXkpKTtcclxuXHJcbiAgICAgIGlmICh0b0RlbGV0ZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgQ2xlYXJlZCAke3RvRGVsZXRlLmxlbmd0aH0gZXhwaXJlZCB0ZW5hbnQgY2FjaGUgZW50cmllc2ApO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgY2xlYXJpbmcgY2FjaGU6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0IGNhY2hlIGNsZWFudXAgaW50ZXJ2YWxcclxuICAgKiDYqNiv2KEg2YHYqtix2Kkg2KrZhti42YrZgSDYp9mE2LDYp9mD2LHYqSDYp9mE2YXYpNmC2KrYqVxyXG4gICAqL1xyXG4gIHN0YXJ0Q2FjaGVDbGVhbnVwKCkge1xyXG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICB0aGlzLmNsZWFyRXhwaXJlZENhY2hlKCk7XHJcbiAgICB9LCA2MCAqIDEwMDApOyAvLyBFdmVyeSBtaW51dGVcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBzdGF0aXN0aWNzXHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYp9mE2KXYrdi12KfYptmK2KfYqlxyXG4gICAqIFxyXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFN0YXRpc3RpY3NcclxuICAgKi9cclxuICBnZXRTdGF0aXN0aWNzKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY2FjaGVkVGVuYW50czogdGhpcy50ZW5hbnRDYWNoZS5zaXplLFxyXG4gICAgICByZXF1ZXN0Q29udGV4dHM6IHRoaXMucmVxdWVzdENvbnRleHQuc2l6ZSxcclxuICAgICAgY2FjaGVIaXRSYXRlOiB0aGlzLl9jYWxjdWxhdGVDYWNoZUhpdFJhdGUoKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSBjYWNoZSBoaXQgcmF0ZVxyXG4gICAqINit2LPYp9ioINmF2LnYr9mEINin2YTYpdi12KfYqNipINmB2Yog2KfZhNiw2KfZg9ix2Kkg2KfZhNmF2KTZgtiq2KlcclxuICAgKiBcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIF9jYWxjdWxhdGVDYWNoZUhpdFJhdGUoKSB7XHJcbiAgICAvLyBQbGFjZWhvbGRlciAtIHdvdWxkIHRyYWNrIGhpdHMvbWlzc2VzIGluIHByb2R1Y3Rpb25cclxuICAgIHJldHVybiAnMC4wMCUnO1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgVGVuYW50UmVzb2x2ZXJTZXJ2aWNlKCk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTTtFQUFFQTtBQUFhLENBQUMsR0FBR0MsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQUMxQyxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUN6QyxNQUFNRSxhQUFhLEdBQUdGLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQztBQUVqRCxNQUFNRyxxQkFBcUIsU0FBU0osWUFBWSxDQUFDO0VBQy9DSyxXQUFXQSxDQUFBLEVBQUc7SUFDWixLQUFLLENBQUMsQ0FBQztJQUNQLElBQUksQ0FBQ0MsTUFBTSxHQUFHSixNQUFNOztJQUVwQjtJQUNBLElBQUksQ0FBQ0ssY0FBYyxHQUFHLElBQUlDLEdBQUcsQ0FBQyxDQUFDOztJQUUvQjtJQUNBLElBQUksQ0FBQ0MsV0FBVyxHQUFHLElBQUlELEdBQUcsQ0FBQyxDQUFDOztJQUU1QjtJQUNBLElBQUksQ0FBQ0UsUUFBUSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSTtFQUMvQjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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