5ef3d356e7c8ac17885edcf688a56fb9
const redis = require('redis');
const logger = require('../utils/logger');

// Simple in-memory store used when USE_MOCK_CACHE=true
const createMemoryStore = () => {
  const store = new Map();
  return {
    async incr(key) {
      const current = (store.get(key) || 0) + 1;
      store.set(key, current);
      return current;
    },
    async expire(key, seconds) {
      // Basic expiry using timeout; good enough for local mock
      setTimeout(() => store.delete(key), seconds * 1000).unref?.();
      return true;
    },
    async del(key) {
      store.delete(key);
      return true;
    },
    async get(key) {
      return store.get(key) || null;
    }
  };
};
class RateLimiter {
  constructor(options = {}) {
    this.windowMs = options.windowMs || 60 * 1000; // 1 minute
    this.maxRequests = options.maxRequests || 100;
    this.message = options.message || 'Too many requests';
    this.statusCode = options.statusCode || 429;
    const client = options.client || (process.env.USE_MOCK_CACHE === 'true' ? createMemoryStore() : redis.createClient());

    // Ensure Redis clients attempt a connection; mock store is synchronous
    if (client.connect) {
      client.connect().catch(err => logger.warn('Redis connect error:', err.message));
    }
    this.client = client;
  }

  // Generate rate limit key
  getKey(req) {
    const identifier = req.user?.id || req.ip || req.socket.remoteAddress;
    return `ratelimit:${identifier}`;
  }

  // Check rate limit
  middleware = async (req, res, next) => {
    try {
      const key = this.getKey(req);
      const current = await this.client.incr(key);
      if (current === 1) {
        await this.client.expire(key, Math.ceil(this.windowMs / 1000));
      }
      res.set('X-RateLimit-Limit', this.maxRequests);
      res.set('X-RateLimit-Remaining', Math.max(0, this.maxRequests - current));
      if (current > this.maxRequests) {
        return res.status(this.statusCode).json({
          error: this.message,
          retryAfter: Math.ceil(this.windowMs / 1000)
        });
      }
      next();
    } catch (error) {
      logger.error('Rate limit error:', error);
      next(); // Continue on error
    }
  };

  // Reset rate limit for user
  reset = async req => {
    try {
      const key = this.getKey(req);
      await this.client.del(key);
      return true;
    } catch (error) {
      logger.error('Rate limit reset error:', error);
      return false;
    }
  };

  // Get current rate limit status
  getStatus = async req => {
    try {
      const key = this.getKey(req);
      const current = await this.client.get(key);
      return {
        current: parseInt(current) || 0,
        limit: this.maxRequests,
        remaining: Math.max(0, this.maxRequests - (parseInt(current) || 0))
      };
    } catch (error) {
      logger.error('Rate limit getStatus error:', error);
      return null;
    }
  };
}

// Pre-configured rate limiters
const limiters = {
  // General API rate limiter
  api: new RateLimiter({
    windowMs: 15 * 60 * 1000,
    // 15 minutes
    maxRequests: 100,
    message: 'Too many API requests'
  }),
  // Login attempts rate limiter
  login: new RateLimiter({
    windowMs: 15 * 60 * 1000,
    maxRequests: 5,
    message: 'Too many login attempts'
  }),
  // Password reset rate limiter
  passwordReset: new RateLimiter({
    windowMs: 60 * 60 * 1000,
    // 1 hour
    maxRequests: 3,
    message: 'Too many password reset attempts'
  }),
  // File upload rate limiter
  upload: new RateLimiter({
    windowMs: 60 * 60 * 1000,
    // 1 hour
    maxRequests: 50,
    message: 'Too many file uploads'
  }),
  // Strict rate limiter for sensitive operations
  strict: new RateLimiter({
    windowMs: 15 * 60 * 1000,
    maxRequests: 10,
    message: 'Too many requests for this operation'
  })
};
module.exports = {
  RateLimiter,
  limiters
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZWRpcyIsInJlcXVpcmUiLCJsb2dnZXIiLCJjcmVhdGVNZW1vcnlTdG9yZSIsInN0b3JlIiwiTWFwIiwiaW5jciIsImtleSIsImN1cnJlbnQiLCJnZXQiLCJzZXQiLCJleHBpcmUiLCJzZWNvbmRzIiwic2V0VGltZW91dCIsImRlbGV0ZSIsInVucmVmIiwiZGVsIiwiUmF0ZUxpbWl0ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJ3aW5kb3dNcyIsIm1heFJlcXVlc3RzIiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJjbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiVVNFX01PQ0tfQ0FDSEUiLCJjcmVhdGVDbGllbnQiLCJjb25uZWN0IiwiY2F0Y2giLCJlcnIiLCJ3YXJuIiwiZ2V0S2V5IiwicmVxIiwiaWRlbnRpZmllciIsInVzZXIiLCJpZCIsImlwIiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsIm1pZGRsZXdhcmUiLCJyZXMiLCJuZXh0IiwiTWF0aCIsImNlaWwiLCJtYXgiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJyZXRyeUFmdGVyIiwicmVzZXQiLCJnZXRTdGF0dXMiLCJwYXJzZUludCIsImxpbWl0IiwicmVtYWluaW5nIiwibGltaXRlcnMiLCJhcGkiLCJsb2dpbiIsInBhc3N3b3JkUmVzZXQiLCJ1cGxvYWQiLCJzdHJpY3QiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmF0ZUxpbWl0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlZGlzID0gcmVxdWlyZSgncmVkaXMnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XHJcblxyXG4vLyBTaW1wbGUgaW4tbWVtb3J5IHN0b3JlIHVzZWQgd2hlbiBVU0VfTU9DS19DQUNIRT10cnVlXHJcbmNvbnN0IGNyZWF0ZU1lbW9yeVN0b3JlID0gKCkgPT4ge1xyXG4gIGNvbnN0IHN0b3JlID0gbmV3IE1hcCgpO1xyXG4gIHJldHVybiB7XHJcbiAgICBhc3luYyBpbmNyKGtleSkge1xyXG4gICAgICBjb25zdCBjdXJyZW50ID0gKHN0b3JlLmdldChrZXkpIHx8IDApICsgMTtcclxuICAgICAgc3RvcmUuc2V0KGtleSwgY3VycmVudCk7XHJcbiAgICAgIHJldHVybiBjdXJyZW50O1xyXG4gICAgfSxcclxuICAgIGFzeW5jIGV4cGlyZShrZXksIHNlY29uZHMpIHtcclxuICAgICAgLy8gQmFzaWMgZXhwaXJ5IHVzaW5nIHRpbWVvdXQ7IGdvb2QgZW5vdWdoIGZvciBsb2NhbCBtb2NrXHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gc3RvcmUuZGVsZXRlKGtleSksIHNlY29uZHMgKiAxMDAwKS51bnJlZj8uKCk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuICAgIGFzeW5jIGRlbChrZXkpIHtcclxuICAgICAgc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuICAgIGFzeW5jIGdldChrZXkpIHtcclxuICAgICAgcmV0dXJuIHN0b3JlLmdldChrZXkpIHx8IG51bGw7XHJcbiAgICB9LFxyXG4gIH07XHJcbn07XHJcblxyXG5jbGFzcyBSYXRlTGltaXRlciB7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XHJcbiAgICB0aGlzLndpbmRvd01zID0gb3B0aW9ucy53aW5kb3dNcyB8fCA2MCAqIDEwMDA7IC8vIDEgbWludXRlXHJcbiAgICB0aGlzLm1heFJlcXVlc3RzID0gb3B0aW9ucy5tYXhSZXF1ZXN0cyB8fCAxMDA7XHJcbiAgICB0aGlzLm1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2UgfHwgJ1RvbyBtYW55IHJlcXVlc3RzJztcclxuICAgIHRoaXMuc3RhdHVzQ29kZSA9IG9wdGlvbnMuc3RhdHVzQ29kZSB8fCA0Mjk7XHJcblxyXG4gICAgY29uc3QgY2xpZW50ID1cclxuICAgICAgb3B0aW9ucy5jbGllbnQgfHxcclxuICAgICAgKHByb2Nlc3MuZW52LlVTRV9NT0NLX0NBQ0hFID09PSAndHJ1ZScgPyBjcmVhdGVNZW1vcnlTdG9yZSgpIDogcmVkaXMuY3JlYXRlQ2xpZW50KCkpO1xyXG5cclxuICAgIC8vIEVuc3VyZSBSZWRpcyBjbGllbnRzIGF0dGVtcHQgYSBjb25uZWN0aW9uOyBtb2NrIHN0b3JlIGlzIHN5bmNocm9ub3VzXHJcbiAgICBpZiAoY2xpZW50LmNvbm5lY3QpIHtcclxuICAgICAgY2xpZW50LmNvbm5lY3QoKS5jYXRjaChlcnIgPT4gbG9nZ2VyLndhcm4oJ1JlZGlzIGNvbm5lY3QgZXJyb3I6JywgZXJyLm1lc3NhZ2UpKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcclxuICB9XHJcblxyXG4gIC8vIEdlbmVyYXRlIHJhdGUgbGltaXQga2V5XHJcbiAgZ2V0S2V5KHJlcSkge1xyXG4gICAgY29uc3QgaWRlbnRpZmllciA9IHJlcS51c2VyPy5pZCB8fCByZXEuaXAgfHwgcmVxLnNvY2tldC5yZW1vdGVBZGRyZXNzO1xyXG4gICAgcmV0dXJuIGByYXRlbGltaXQ6JHtpZGVudGlmaWVyfWA7XHJcbiAgfVxyXG5cclxuICAvLyBDaGVjayByYXRlIGxpbWl0XHJcbiAgbWlkZGxld2FyZSA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXkocmVxKTtcclxuICAgICAgY29uc3QgY3VycmVudCA9IGF3YWl0IHRoaXMuY2xpZW50LmluY3Ioa2V5KTtcclxuXHJcbiAgICAgIGlmIChjdXJyZW50ID09PSAxKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5jbGllbnQuZXhwaXJlKGtleSwgTWF0aC5jZWlsKHRoaXMud2luZG93TXMgLyAxMDAwKSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlcy5zZXQoJ1gtUmF0ZUxpbWl0LUxpbWl0JywgdGhpcy5tYXhSZXF1ZXN0cyk7XHJcbiAgICAgIHJlcy5zZXQoJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZycsIE1hdGgubWF4KDAsIHRoaXMubWF4UmVxdWVzdHMgLSBjdXJyZW50KSk7XHJcblxyXG4gICAgICBpZiAoY3VycmVudCA+IHRoaXMubWF4UmVxdWVzdHMpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyh0aGlzLnN0YXR1c0NvZGUpLmpzb24oe1xyXG4gICAgICAgICAgZXJyb3I6IHRoaXMubWVzc2FnZSxcclxuICAgICAgICAgIHJldHJ5QWZ0ZXI6IE1hdGguY2VpbCh0aGlzLndpbmRvd01zIC8gMTAwMCksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG5leHQoKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignUmF0ZSBsaW1pdCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIG5leHQoKTsgLy8gQ29udGludWUgb24gZXJyb3JcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyBSZXNldCByYXRlIGxpbWl0IGZvciB1c2VyXHJcbiAgcmVzZXQgPSBhc3luYyByZXEgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXkocmVxKTtcclxuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuZGVsKGtleSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdSYXRlIGxpbWl0IHJlc2V0IGVycm9yOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8vIEdldCBjdXJyZW50IHJhdGUgbGltaXQgc3RhdHVzXHJcbiAgZ2V0U3RhdHVzID0gYXN5bmMgcmVxID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KHJlcSk7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnQgPSBhd2FpdCB0aGlzLmNsaWVudC5nZXQoa2V5KTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBjdXJyZW50OiBwYXJzZUludChjdXJyZW50KSB8fCAwLFxyXG4gICAgICAgIGxpbWl0OiB0aGlzLm1heFJlcXVlc3RzLFxyXG4gICAgICAgIHJlbWFpbmluZzogTWF0aC5tYXgoMCwgdGhpcy5tYXhSZXF1ZXN0cyAtIChwYXJzZUludChjdXJyZW50KSB8fCAwKSksXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ1JhdGUgbGltaXQgZ2V0U3RhdHVzIGVycm9yOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuLy8gUHJlLWNvbmZpZ3VyZWQgcmF0ZSBsaW1pdGVyc1xyXG5jb25zdCBsaW1pdGVycyA9IHtcclxuICAvLyBHZW5lcmFsIEFQSSByYXRlIGxpbWl0ZXJcclxuICBhcGk6IG5ldyBSYXRlTGltaXRlcih7XHJcbiAgICB3aW5kb3dNczogMTUgKiA2MCAqIDEwMDAsIC8vIDE1IG1pbnV0ZXNcclxuICAgIG1heFJlcXVlc3RzOiAxMDAsXHJcbiAgICBtZXNzYWdlOiAnVG9vIG1hbnkgQVBJIHJlcXVlc3RzJyxcclxuICB9KSxcclxuXHJcbiAgLy8gTG9naW4gYXR0ZW1wdHMgcmF0ZSBsaW1pdGVyXHJcbiAgbG9naW46IG5ldyBSYXRlTGltaXRlcih7XHJcbiAgICB3aW5kb3dNczogMTUgKiA2MCAqIDEwMDAsXHJcbiAgICBtYXhSZXF1ZXN0czogNSxcclxuICAgIG1lc3NhZ2U6ICdUb28gbWFueSBsb2dpbiBhdHRlbXB0cycsXHJcbiAgfSksXHJcblxyXG4gIC8vIFBhc3N3b3JkIHJlc2V0IHJhdGUgbGltaXRlclxyXG4gIHBhc3N3b3JkUmVzZXQ6IG5ldyBSYXRlTGltaXRlcih7XHJcbiAgICB3aW5kb3dNczogNjAgKiA2MCAqIDEwMDAsIC8vIDEgaG91clxyXG4gICAgbWF4UmVxdWVzdHM6IDMsXHJcbiAgICBtZXNzYWdlOiAnVG9vIG1hbnkgcGFzc3dvcmQgcmVzZXQgYXR0ZW1wdHMnLFxyXG4gIH0pLFxyXG5cclxuICAvLyBGaWxlIHVwbG9hZCByYXRlIGxpbWl0ZXJcclxuICB1cGxvYWQ6IG5ldyBSYXRlTGltaXRlcih7XHJcbiAgICB3aW5kb3dNczogNjAgKiA2MCAqIDEwMDAsIC8vIDEgaG91clxyXG4gICAgbWF4UmVxdWVzdHM6IDUwLFxyXG4gICAgbWVzc2FnZTogJ1RvbyBtYW55IGZpbGUgdXBsb2FkcycsXHJcbiAgfSksXHJcblxyXG4gIC8vIFN0cmljdCByYXRlIGxpbWl0ZXIgZm9yIHNlbnNpdGl2ZSBvcGVyYXRpb25zXHJcbiAgc3RyaWN0OiBuZXcgUmF0ZUxpbWl0ZXIoe1xyXG4gICAgd2luZG93TXM6IDE1ICogNjAgKiAxMDAwLFxyXG4gICAgbWF4UmVxdWVzdHM6IDEwLFxyXG4gICAgbWVzc2FnZTogJ1RvbyBtYW55IHJlcXVlc3RzIGZvciB0aGlzIG9wZXJhdGlvbicsXHJcbiAgfSksXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgUmF0ZUxpbWl0ZXIsIGxpbWl0ZXJzIH07XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBTyxDQUFDO0FBQzlCLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGlCQUFpQixDQUFDOztBQUV6QztBQUNBLE1BQU1FLGlCQUFpQixHQUFHQSxDQUFBLEtBQU07RUFDOUIsTUFBTUMsS0FBSyxHQUFHLElBQUlDLEdBQUcsQ0FBQyxDQUFDO0VBQ3ZCLE9BQU87SUFDTCxNQUFNQyxJQUFJQSxDQUFDQyxHQUFHLEVBQUU7TUFDZCxNQUFNQyxPQUFPLEdBQUcsQ0FBQ0osS0FBSyxDQUFDSyxHQUFHLENBQUNGLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO01BQ3pDSCxLQUFLLENBQUNNLEdBQUcsQ0FBQ0gsR0FBRyxFQUFFQyxPQUFPLENBQUM7TUFDdkIsT0FBT0EsT0FBTztJQUNoQixDQUFDO0lBQ0QsTUFBTUcsTUFBTUEsQ0FB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