{"version":3,"names":["TrafficAccidentReport","require","logger","TrafficAccidentAnalytics","analyzeTimelineTrends","startDate","endDate","trends","aggregate","$match","archived","$gte","Date","$lt","$group","_id","year","$year","month","$month","day","$dayOfMonth","totalReports","$sum","injuries","$size","deaths","totalLoss","$sort","error","message","analyzeHotspots","limit","hotspots","city","address","count","avgLoss","$avg","$limit","analyzeViolationPatterns","patterns","$unwind","severityBreakdown","$push","avgFineAmount","analyzeInjuryAndFatalityRates","filters","matchStage","stats","$facet","$count","totalInjuries","total","totalDeaths","injuryBySeverity","result","injuryRatePerReport","toFixed","fatalityRatePerReport","analyzeFinancialImpact","severity","analysis","summary","highestLoss","$max","lowestLoss","$min","medicalCosts","repairCosts","finesTotal","bySeverity","getInvestigatorPerformance","performance","totalInvestigations","completedCount","$cond","$eq","inProgressCount","avgResolutionTime","$divide","$subtract","$lookup","from","localField","foreignField","as","path","preserveNullAndEmptyArrays","$project","officerName","$ifNull","completionRate","$gt","$multiply","$ceil","analyzeSeasonalTrends","monthName","$arrayElemAt","$round","generateComprehensiveSummary","statistics","violationPatterns","injuryRates","financialImpact","investigatorPerformance","seasonalTrends","Promise","all","getStatistics","generatedAt","extractKeyInsights","insights","push","type","title","value","description","criticalSeverity","criticalPercentage","percentage","alert","totalFinancialLoss","toLocaleString","average","averageFinancialLoss","length","location","violation","module","exports"],"sources":["trafficAccidentAnalytics.js"],"sourcesContent":["/**\r\n * Traffic Accident Analytics Module - وحدة تحليل الحوادث المرورية\r\n * تحليلات متقدمة ورؤى حول الحوادث المرورية\r\n */\r\n\r\nconst TrafficAccidentReport = require('../models/TrafficAccidentReport');\r\nconst logger = require('../utils/logger');\r\n\r\nclass TrafficAccidentAnalytics {\r\n  /**\r\n   * تحليل الاتجاهات على مدى الوقت\r\n   */\r\n  async analyzeTimelineTrends(startDate, endDate) {\r\n    try {\r\n      const trends = await TrafficAccidentReport.aggregate([\r\n        {\r\n          $match: {\r\n            archived: false,\r\n            'accidentInfo.accidentDateTime': {\r\n              $gte: new Date(startDate),\r\n              $lt: new Date(endDate)\r\n            }\r\n          }\r\n        },\r\n        {\r\n          $group: {\r\n            _id: {\r\n              year: { $year: '$accidentInfo.accidentDateTime' },\r\n              month: { $month: '$accidentInfo.accidentDateTime' },\r\n              day: { $dayOfMonth: '$accidentInfo.accidentDateTime' }\r\n            },\r\n            totalReports: { $sum: 1 },\r\n            injuries: { $sum: { $size: '$people.injuries' } },\r\n            deaths: { $sum: '$people.deaths.count' },\r\n            totalLoss: { $sum: '$financialImpact.totalLoss' }\r\n          }\r\n        },\r\n        { $sort: { '_id.year': 1, '_id.month': 1, '_id.day': 1 } }\r\n      ]);\r\n\r\n      return trends;\r\n    } catch (error) {\r\n      logger.error('Error analyzing timeline trends', { error: error.message });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحليل الأماكن (Hotspots)\r\n   */\r\n  async analyzeHotspots(limit = 10) {\r\n    try {\r\n      const hotspots = await TrafficAccidentReport.aggregate([\r\n        {\r\n          $match: { archived: false }\r\n        },\r\n        {\r\n          $group: {\r\n            _id: {\r\n              city: '$accidentInfo.location.city',\r\n              address: '$accidentInfo.location.address'\r\n            },\r\n            count: { $sum: 1 },\r\n            injuries: { $sum: { $size: '$people.injuries' } },\r\n            deaths: { $sum: '$people.deaths.count' },\r\n            avgLoss: { $avg: '$financialImpact.totalLoss' }\r\n          }\r\n        },\r\n        {\r\n          $sort: { count: -1 }\r\n        },\r\n        {\r\n          $limit: limit\r\n        }\r\n      ]);\r\n\r\n      return hotspots;\r\n    } catch (error) {\r\n      logger.error('Error analyzing hotspots', { error: error.message });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحليل أنواع المخالفات\r\n   */\r\n  async analyzeViolationPatterns() {\r\n    try {\r\n      const patterns = await TrafficAccidentReport.aggregate([\r\n        {\r\n          $match: { archived: false }\r\n        },\r\n        {\r\n          $unwind: '$violations'\r\n        },\r\n        {\r\n          $group: {\r\n            _id: '$violations.violationType',\r\n            count: { $sum: 1 },\r\n            severityBreakdown: {\r\n              $push: '$violations.severity'\r\n            },\r\n            avgFineAmount: { $avg: '$violations.fineAmount' }\r\n          }\r\n        },\r\n        {\r\n          $sort: { count: -1 }\r\n        }\r\n      ]);\r\n\r\n      return patterns;\r\n    } catch (error) {\r\n      logger.error('Error analyzing violation patterns', {\r\n        error: error.message\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحليل معدلات الإصابات والوفيات\r\n   */\r\n  async analyzeInjuryAndFatalityRates(filters = {}) {\r\n    try {\r\n      const matchStage = { archived: false };\r\n\r\n      if (filters.startDate && filters.endDate) {\r\n        matchStage['accidentInfo.accidentDateTime'] = {\r\n          $gte: new Date(filters.startDate),\r\n          $lt: new Date(filters.endDate)\r\n        };\r\n      }\r\n\r\n      const stats = await TrafficAccidentReport.aggregate([\r\n        { $match: matchStage },\r\n        {\r\n          $facet: {\r\n            totalReports: [{ $count: 'count' }],\r\n            totalInjuries: [\r\n              {\r\n                $group: {\r\n                  _id: null,\r\n                  total: { $sum: { $size: '$people.injuries' } }\r\n                }\r\n              }\r\n            ],\r\n            totalDeaths: [\r\n              {\r\n                $group: {\r\n                  _id: null,\r\n                  total: { $sum: '$people.deaths.count' }\r\n                }\r\n              }\r\n            ],\r\n            injuryBySeverity: [\r\n              {\r\n                $unwind: '$people.injuries'\r\n              },\r\n              {\r\n                $group: {\r\n                  _id: '$people.injuries.type',\r\n                  count: { $sum: 1 }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]);\r\n\r\n      const result = stats[0];\r\n\r\n      // Calculate rates\r\n      const totalReports = result.totalReports[0]?.count || 0;\r\n      const totalInjuries = result.totalInjuries[0]?.total || 0;\r\n      const totalDeaths = result.totalDeaths[0]?.total || 0;\r\n\r\n      return {\r\n        totalReports,\r\n        totalInjuries,\r\n        totalDeaths,\r\n        injuryRatePerReport: totalReports > 0 ? (totalInjuries / totalReports).toFixed(2) : 0,\r\n        fatalityRatePerReport: totalReports > 0 ? (totalDeaths / totalReports).toFixed(2) : 0,\r\n        injuryBySeverity: result.injuryBySeverity\r\n      };\r\n    } catch (error) {\r\n      logger.error('Error analyzing injury rates', { error: error.message });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحليل الخسائر المالية\r\n   */\r\n  async analyzeFinancialImpact(filters = {}) {\r\n    try {\r\n      const matchStage = { archived: false };\r\n\r\n      if (filters.severity) {\r\n        matchStage.severity = filters.severity;\r\n      }\r\n\r\n      if (filters.startDate && filters.endDate) {\r\n        matchStage['accidentInfo.accidentDateTime'] = {\r\n          $gte: new Date(filters.startDate),\r\n          $lt: new Date(filters.endDate)\r\n        };\r\n      }\r\n\r\n      const analysis = await TrafficAccidentReport.aggregate([\r\n        { $match: matchStage },\r\n        {\r\n          $facet: {\r\n            summary: [\r\n              {\r\n                $group: {\r\n                  _id: null,\r\n                  totalLoss: { $sum: '$financialImpact.totalLoss' },\r\n                  avgLoss: { $avg: '$financialImpact.totalLoss' },\r\n                  highestLoss: { $max: '$financialImpact.totalLoss' },\r\n                  lowestLoss: { $min: '$financialImpact.totalLoss' },\r\n                  medicalCosts: { $sum: '$financialImpact.medicalCosts' },\r\n                  repairCosts: { $sum: '$financialImpact.repairCosts' },\r\n                  finesTotal: { $sum: '$financialImpact.finesAmount' }\r\n                }\r\n              }\r\n            ],\r\n            bySeverity: [\r\n              {\r\n                $group: {\r\n                  _id: '$severity',\r\n                  totalLoss: { $sum: '$financialImpact.totalLoss' },\r\n                  avgLoss: { $avg: '$financialImpact.totalLoss' },\r\n                  count: { $sum: 1 }\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      ]);\r\n\r\n      return analysis[0];\r\n    } catch (error) {\r\n      logger.error('Error analyzing financial impact', {\r\n        error: error.message\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تقرير الأداء حسب المحقق\r\n   */\r\n  async getInvestigatorPerformance() {\r\n    try {\r\n      const performance = await TrafficAccidentReport.aggregate([\r\n        {\r\n          $match: { archived: false }\r\n        },\r\n        {\r\n          $group: {\r\n            _id: '$investigation.investigatingOfficer',\r\n            totalInvestigations: { $sum: 1 },\r\n            completedCount: {\r\n              $sum: {\r\n                $cond: [\r\n                  { $eq: ['$investigation.status', 'completed'] },\r\n                  1,\r\n                  0\r\n                ]\r\n              }\r\n            },\r\n            inProgressCount: {\r\n              $sum: {\r\n                $cond: [\r\n                  { $eq: ['$investigation.status', 'in_progress'] },\r\n                  1,\r\n                  0\r\n                ]\r\n              }\r\n            },\r\n            avgResolutionTime: {\r\n              $avg: {\r\n                $cond: [\r\n                  { $gte: ['$investigation.completedDate', null] },\r\n                  {\r\n                    $divide: [\r\n                      {\r\n                        $subtract: [\r\n                          '$investigation.completedDate',\r\n                          '$investigation.startDate'\r\n                        ]\r\n                      },\r\n                      86400000 // Convert milliseconds to days\r\n                    ]\r\n                  },\r\n                  null\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        },\r\n        {\r\n          $lookup: {\r\n            from: 'users',\r\n            localField: '_id',\r\n            foreignField: '_id',\r\n            as: 'officer'\r\n          }\r\n        },\r\n        {\r\n          $unwind: {\r\n            path: '$officer',\r\n            preserveNullAndEmptyArrays: true\r\n          }\r\n        },\r\n        {\r\n          $project: {\r\n            officerName: { $ifNull: ['$officer.name', 'Unknown'] },\r\n            totalInvestigations: 1,\r\n            completedCount: 1,\r\n            inProgressCount: 1,\r\n            completionRate: {\r\n              $cond: [\r\n                { $gt: ['$totalInvestigations', 0] },\r\n                {\r\n                  $multiply: [\r\n                    {\r\n                      $divide: ['$completedCount', '$totalInvestigations']\r\n                    },\r\n                    100\r\n                  ]\r\n                },\r\n                0\r\n              ]\r\n            },\r\n            avgResolutionTime: {\r\n              $ceil: { $ifNull: ['$avgResolutionTime', 0] }\r\n            }\r\n          }\r\n        },\r\n        {\r\n          $sort: { totalInvestigations: -1 }\r\n        }\r\n      ]);\r\n\r\n      return performance;\r\n    } catch (error) {\r\n      logger.error('Error analyzing investigator performance', {\r\n        error: error.message\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحليل الاتجاهات الموسمية\r\n   */\r\n  async analyzeSeasonalTrends() {\r\n    try {\r\n      const trends = await TrafficAccidentReport.aggregate([\r\n        {\r\n          $match: { archived: false }\r\n        },\r\n        {\r\n          $group: {\r\n            _id: { $month: '$accidentInfo.accidentDateTime' },\r\n            count: { $sum: 1 },\r\n            injuries: { $sum: { $size: '$people.injuries' } },\r\n            deaths: { $sum: '$people.deaths.count' },\r\n            avgLoss: { $avg: '$financialImpact.totalLoss' }\r\n          }\r\n        },\r\n        {\r\n          $sort: { _id: 1 }\r\n        },\r\n        {\r\n          $project: {\r\n            _id: 0,\r\n            month: '$_id',\r\n            monthName: {\r\n              $arrayElemAt: [\r\n                [\r\n                  'يناير',\r\n                  'فبراير',\r\n                  'مارس',\r\n                  'أبريل',\r\n                  'مايو',\r\n                  'يونيو',\r\n                  'يوليو',\r\n                  'أغسطس',\r\n                  'سبتمبر',\r\n                  'أكتوبر',\r\n                  'نوفمبر',\r\n                  'ديسمبر'\r\n                ],\r\n                { $subtract: ['$month', 1] }\r\n              ]\r\n            },\r\n            count: 1,\r\n            injuries: 1,\r\n            deaths: 1,\r\n            avgLoss: { $round: ['$avgLoss', 2] }\r\n          }\r\n        }\r\n      ]);\r\n\r\n      return trends;\r\n    } catch (error) {\r\n      logger.error('Error analyzing seasonal trends', { error: error.message });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تقرير الملخص الشامل\r\n   */\r\n  async generateComprehensiveSummary(filters = {}) {\r\n    try {\r\n      const [\r\n        statistics,\r\n        hotspots,\r\n        violationPatterns,\r\n        injuryRates,\r\n        financialImpact,\r\n        investigatorPerformance,\r\n        seasonalTrends\r\n      ] = await Promise.all([\r\n        TrafficAccidentReport.getStatistics(filters),\r\n        this.analyzeHotspots(5),\r\n        this.analyzeViolationPatterns(),\r\n        this.analyzeInjuryAndFatalityRates(filters),\r\n        this.analyzeFinancialImpact(filters),\r\n        this.getInvestigatorPerformance(),\r\n        this.analyzeSeasonalTrends()\r\n      ]);\r\n\r\n      return {\r\n        generatedAt: new Date(),\r\n        filters,\r\n        summary: statistics[0] || {},\r\n        hotspots,\r\n        violationPatterns,\r\n        injuryRates,\r\n        financialImpact,\r\n        investigatorPerformance,\r\n        seasonalTrends\r\n      };\r\n    } catch (error) {\r\n      logger.error('Error generating comprehensive summary', {\r\n        error: error.message\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * استخراج الرؤى الرئيسية (Key Insights)\r\n   */\r\n  async extractKeyInsights(filters = {}) {\r\n    try {\r\n      const summary = await this.generateComprehensiveSummary(filters);\r\n      const stats = summary.summary;\r\n\r\n      const insights = [];\r\n\r\n      // Insight 1: Total Cases\r\n      if (stats.totalReports > 0) {\r\n        insights.push({\r\n          type: 'CASE_VOLUME',\r\n          title: 'حجم القضايا',\r\n          value: stats.totalReports,\r\n          description: `تم تسجيل ${stats.totalReports} حادثة مرورية`\r\n        });\r\n      }\r\n\r\n      // Insight 2: Severity Distribution\r\n      if (stats.criticalSeverity > 0) {\r\n        const criticalPercentage = (\r\n          (stats.criticalSeverity / stats.totalReports) *\r\n          100\r\n        ).toFixed(1);\r\n        insights.push({\r\n          type: 'CRITICAL_CASES',\r\n          title: 'الحالات الحرجة',\r\n          value: stats.criticalSeverity,\r\n          percentage: criticalPercentage,\r\n          description: `${criticalPercentage}% من الحوادث حالات حرجة`,\r\n          alert: true\r\n        });\r\n      }\r\n\r\n      // Insight 3: Fatality Rate\r\n      if (stats.totalDeaths > 0) {\r\n        insights.push({\r\n          type: 'FATALITY_RATE',\r\n          title: 'معدل الوفيات',\r\n          value: stats.totalDeaths,\r\n          description: `${stats.totalDeaths} وفيات مسجلة`,\r\n          alert: true\r\n        });\r\n      }\r\n\r\n      // Insight 4: Financial Impact\r\n      if (stats.totalFinancialLoss > 0) {\r\n        insights.push({\r\n          type: 'FINANCIAL_LOSS',\r\n          title: 'الخسائر المالية',\r\n          value: `${stats.totalFinancialLoss.toLocaleString('ar-SA')} SAR`,\r\n          average: `${(stats.averageFinancialLoss || 0).toLocaleString('ar-SA')} SAR`,\r\n          description: 'إجمالي الخسائر المالية من الحوادث'\r\n        });\r\n      }\r\n\r\n      // Insight 5: Hotspot Alert\r\n      if (summary.hotspots && summary.hotspots.length > 0) {\r\n        insights.push({\r\n          type: 'HOTSPOT',\r\n          title: 'منطقة الخطر',\r\n          location: summary.hotspots[0]._id.city,\r\n          count: summary.hotspots[0].count,\r\n          description: `أكثر المناطق خطورة: ${summary.hotspots[0]._id.city}`\r\n        });\r\n      }\r\n\r\n      // Insight 6: Top Violation\r\n      if (summary.violationPatterns && summary.violationPatterns.length > 0) {\r\n        insights.push({\r\n          type: 'VIOLATION_PATTERN',\r\n          title: 'أكثر المخالفات شيوعاً',\r\n          violation: summary.violationPatterns[0]._id,\r\n          count: summary.violationPatterns[0].count,\r\n          description: `المخالفة الأكثر شيوعاً: ${summary.violationPatterns[0]._id}`\r\n        });\r\n      }\r\n\r\n      return insights;\r\n    } catch (error) {\r\n      logger.error('Error extracting key insights', { error: error.message });\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = new TrafficAccidentAnalytics();\r\n"],"mappings":"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","ignoreList":[]}