{"version":3,"names":["admin","require","path","apps","length","initializeApp","credential","cert","join","__dirname","e","sendPush","tokens","title","body","data","success","error","message","notification","response","messaging","sendMulticast","module","exports"],"sources":["pushService.js"],"sourcesContent":["// pushService.js\r\n// خدمة إرسال إشعارات Push عبر FCM\r\n// يتطلب إضافة ملف serviceAccountKey.json في backend/config أو backend/\r\n\r\nconst admin = require('firebase-admin');\r\nconst path = require('path');\r\n\r\n// تهيئة Firebase Admin SDK مرة واحدة فقط\r\nif (!admin.apps.length) {\r\n  try {\r\n    admin.initializeApp({\r\n      credential: admin.credential.cert(path.join(__dirname, '../config/serviceAccountKey.json')),\r\n    });\r\n  } catch (e) {\r\n    // إذا لم يوجد ملف الخدمة، تجاهل التهيئة (للاختبار فقط)\r\n  }\r\n}\r\n\r\nasync function sendPush({ tokens, title, body, data }) {\r\n  if (!admin.apps.length) return { success: false, error: 'FCM not configured' };\r\n  if (!tokens || tokens.length === 0) return { success: false, error: 'No tokens' };\r\n  const message = {\r\n    notification: { title, body },\r\n    data: data || {},\r\n    tokens,\r\n  };\r\n  try {\r\n    const response = await admin.messaging().sendMulticast(message);\r\n    return { success: true, response };\r\n  } catch (error) {\r\n    return { success: false, error };\r\n  }\r\n}\r\n\r\nmodule.exports = { sendPush };\r\n"],"mappings":"AAAA;AACA;AACA;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AACvC,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;;AAE5B;AACA,IAAI,CAACD,KAAK,CAACG,IAAI,CAACC,MAAM,EAAE;EACtB,IAAI;IACFJ,KAAK,CAACK,aAAa,CAAC;MAClBC,UAAU,EAAEN,KAAK,CAACM,UAAU,CAACC,IAAI,CAACL,IAAI,CAACM,IAAI,CAACC,SAAS,EAAE,kCAAkC,CAAC;IAC5F,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOC,CAAC,EAAE;IACV;EAAA;AAEJ;AAEA,eAAeC,QAAQA,CAAC;EAAEC,MAAM;EAAEC,KAAK;EAAEC,IAAI;EAAEC;AAAK,CAAC,EAAE;EACrD,IAAI,CAACf,KAAK,CAACG,IAAI,CAACC,MAAM,EAAE,OAAO;IAAEY,OAAO,EAAE,KAAK;IAAEC,KAAK,EAAE;EAAqB,CAAC;EAC9E,IAAI,CAACL,MAAM,IAAIA,MAAM,CAACR,MAAM,KAAK,CAAC,EAAE,OAAO;IAAEY,OAAO,EAAE,KAAK;IAAEC,KAAK,EAAE;EAAY,CAAC;EACjF,MAAMC,OAAO,GAAG;IACdC,YAAY,EAAE;MAAEN,KAAK;MAAEC;IAAK,CAAC;IAC7BC,IAAI,EAAEA,IAAI,IAAI,CAAC,CAAC;IAChBH;EACF,CAAC;EACD,IAAI;IACF,MAAMQ,QAAQ,GAAG,MAAMpB,KAAK,CAACqB,SAAS,CAAC,CAAC,CAACC,aAAa,CAACJ,OAAO,CAAC;IAC/D,OAAO;MAAEF,OAAO,EAAE,IAAI;MAAEI;IAAS,CAAC;EACpC,CAAC,CAAC,OAAOH,KAAK,EAAE;IACd,OAAO;MAAED,OAAO,EAAE,KAAK;MAAEC;IAAM,CAAC;EAClC;AACF;AAEAM,MAAM,CAACC,OAAO,GAAG;EAAEb;AAAS,CAAC","ignoreList":[]}