ab8774bf446cf354bea068698ca56345
/**
 * Recommendations Engine Service
 * خدمة محرك التوصيات
 * 
 * المسؤوليات:
 * - توليد التوصيات الشخصية
 * - تحليل سلوك المستخدم
 * - تصنيف التوصيات
 * - مراقبة ردود الفعل
 */

const {
  EventEmitter
} = require('events');
const {
  v4: uuidv4
} = require('uuid');
const Logger = require('../utils/logger');
const aiModels = require('./aiModels.service');
class RecommendationsEngineService extends EventEmitter {
  constructor() {
    super();
    this.logger = Logger;

    // Recommendation cache
    this.recommendationCache = new Map();

    // User preferences
    this.userPreferences = new Map();

    // Recommendation history
    this.recommendationHistory = new Map();

    // User feedback collection
    this.userFeedback = new Map();

    // A/B test variations
    this.abTests = new Map();

    // Recommendation strategies
    this.strategies = new Map();

    // Statistics
    this.stats = {
      totalRecommendations: 0,
      totalFeedback: 0,
      positiveRatings: 0,
      averageRating: 0,
      cacheHits: 0,
      cacheMisses: 0
    };
    this._initializeStrategies();
  }

  /**
   * Initialize recommendation strategies
   * تهيئة استراتيجيات التوصية
   * 
   * @private
   */
  _initializeStrategies() {
    try {
      this.strategies.set('collaborative_filtering', {
        name: 'Collaborative Filtering',
        description: 'يوصي بناءً على تفضيلات المستخدمين المشابهين',
        weight: 0.35,
        active: true
      });
      this.strategies.set('content_based', {
        name: 'Content-Based Filtering',
        description: 'يوصي بناءً على خصائص المحتوى المفضل',
        weight: 0.30,
        active: true
      });
      this.strategies.set('hybrid', {
        name: 'Hybrid Recommendation',
        description: 'يجمع بين عدة استراتيجيات',
        weight: 0.25,
        active: true
      });
      this.strategies.set('context_aware', {
        name: 'Context-Aware Recommendation',
        description: 'يأخذ في الاعتبار السياق والموقع والوقت',
        weight: 0.10,
        active: true
      });
      this.logger.info('✅ Recommendation strategies initialized');
    } catch (error) {
      this.logger.error(`Error initializing strategies: ${error.message}`);
    }
  }

  /**
   * Generate recommendations for user
   * توليد التوصيات للمستخدم
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @param {Object} params - Generation parameters
   * @returns {Object} Recommendations
   */
  generateRecommendations(tenantId, userId, params = {}) {
    try {
      const cacheKey = `${tenantId}:${userId}`;

      // Check cache
      if (this.recommendationCache.has(cacheKey)) {
        const cached = this.recommendationCache.get(cacheKey);
        if (new Date() - cached.timestamp < (params.cacheMaxAge || 5 * 60 * 1000)) {
          this.stats.cacheHits++;
          return cached.recommendations;
        }
      }
      this.stats.cacheMisses++;

      // Get user context
      const userContext = this._getUserContext(tenantId, userId);

      // Generate recommendations using different strategies
      let recommendations = [];

      // Collaborative filtering
      const cfRecs = this._collaborativeFiltering(tenantId, userId, userContext);
      recommendations.push(...cfRecs.map(r => ({
        ...r,
        strategy: 'collaborative_filtering',
        score: r.score * 0.35
      })));

      // Content-based filtering
      const cbRecs = this._contentBasedFiltering(tenantId, userId, userContext);
      recommendations.push(...cbRecs.map(r => ({
        ...r,
        strategy: 'content_based',
        score: r.score * 0.30
      })));

      // Hybrid approach
      const hybridRecs = this._hybridRecommendation(tenantId, userId, userContext);
      recommendations.push(...hybridRecs.map(r => ({
        ...r,
        strategy: 'hybrid',
        score: r.score * 0.25
      })));

      // Context-aware
      const contextRecs = this._contextAwareRecommendation(tenantId, userId, userContext);
      recommendations.push(...contextRecs.map(r => ({
        ...r,
        strategy: 'context_aware',
        score: r.score * 0.10
      })));

      // Deduplicate and aggregate scores
      const aggregated = this._aggregateRecommendations(recommendations);

      // Sort by score
      aggregated.sort((a, b) => b.finalScore - a.finalScore);

      // Apply limit
      const limit = params.limit || 10;
      const result = {
        tenantId,
        userId,
        recommendations: aggregated.slice(0, limit),
        count: Math.min(limit, aggregated.length),
        generatedAt: new Date(),
        strategies: Array.from(this.strategies.entries()).filter(([, s]) => s.active).map(([key, s]) => ({
          id: key,
          ...s
        }))
      };

      // Cache results
      this.recommendationCache.set(cacheKey, {
        recommendations: result,
        timestamp: new Date(),
        expiresAt: new Date(Date.now() + (params.cacheTTL || 5 * 60 * 1000))
      });

      // Store in history
      this._storeRecommendationHistory(tenantId, userId, result);
      this.stats.totalRecommendations++;
      this.emit('recommendations:generated', {
        tenantId,
        userId,
        count: result.count
      });
      return result;
    } catch (error) {
      this.logger.error(`Error generating recommendations: ${error.message}`);
      throw error;
    }
  }

  /**
   * Record user feedback on recommendation
   * تسجيل ردود فعل المستخدم على التوصية
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @param {String} recommendationId - Recommendation ID
   * @param {Object} feedback - Feedback data
   */
  recordFeedback(tenantId, userId, recommendationId, feedback) {
    try {
      const feedbackRecord = {
        id: `feedback-${uuidv4()}`,
        tenantId,
        userId,
        recommendationId,
        rating: feedback.rating,
        // 1-5
        helpful: feedback.helpful || feedback.rating >= 4,
        comment: feedback.comment || '',
        action: feedback.action || null,
        // clicked, ignored, dismissed, etc
        timestamp: new Date()
      };
      const userKey = `${tenantId}:${userId}`;
      if (!this.userFeedback.has(userKey)) {
        this.userFeedback.set(userKey, []);
      }
      this.userFeedback.get(userKey).push(feedbackRecord);

      // Update statistics
      this.stats.totalFeedback++;
      if (feedbackRecord.helpful) {
        this.stats.positiveRatings++;
      }
      this.stats.averageRating = this.stats.totalFeedback > 0 ? this.stats.positiveRatings / this.stats.totalFeedback * 5 : 0;

      // Update user preferences based on feedback
      this._updateUserPreferences(tenantId, userId, feedbackRecord);

      // Invalidate cache for this user
      this.recommendationCache.delete(userKey);
      this.emit('feedback:recorded', {
        feedbackRecord
      });
      this.logger.info(`Feedback recorded: ${userId} rated recommendation ${recommendationId}`);
      return feedbackRecord;
    } catch (error) {
      this.logger.error(`Error recording feedback: ${error.message}`);
      throw error;
    }
  }

  /**
   * Get user preferences
   * الحصول على تفضيلات المستخدم
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @returns {Object} User preferences
   */
  getUserPreferences(tenantId, userId) {
    try {
      const key = `${tenantId}:${userId}`;
      return this.userPreferences.get(key) || this._createDefaultPreferences(tenantId, userId);
    } catch (error) {
      this.logger.error(`Error getting user preferences: ${error.message}`);
      return this._createDefaultPreferences(tenantId, userId);
    }
  }

  /**
   * Update user preferences
   * تحديث تفضيلات المستخدم
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @param {Object} preferences - Preferences to update
   * @returns {Object} Updated preferences
   */
  updateUserPreferences(tenantId, userId, preferences) {
    try {
      const key = `${tenantId}:${userId}`;
      let prefs = this.userPreferences.get(key) || this._createDefaultPreferences(tenantId, userId);

      // Update allowed fields
      if (preferences.categories) prefs.categories = preferences.categories;
      if (preferences.excludeCategories) prefs.excludeCategories = preferences.excludeCategories;
      if (preferences.topics) prefs.topics = preferences.topics;
      if (preferences.maxRecommendations !== undefined) prefs.maxRecommendations = preferences.maxRecommendations;
      if (preferences.diversity !== undefined) prefs.diversity = preferences.diversity;
      if (preferences.freshness !== undefined) prefs.freshness = preferences.freshness;
      prefs.updatedAt = new Date();
      this.userPreferences.set(key, prefs);
      this.emit('preferences:updated', {
        tenantId,
        userId,
        preferences: prefs
      });
      this.logger.info(`User preferences updated: ${userId}`);
      return prefs;
    } catch (error) {
      this.logger.error(`Error updating preferences: ${error.message}`);
      throw error;
    }
  }

  /**
   * Get recommendation history for user
   * الحصول على سجل التوصيات للمستخدم
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @param {Object} filters - Filters
   * @returns {Array} Recommendation history
   */
  getRecommendationHistory(tenantId, userId, filters = {}) {
    try {
      const key = `${tenantId}:${userId}`;
      let history = this.recommendationHistory.get(key) || [];

      // Apply filters
      if (filters.limit) {
        history = history.slice(-filters.limit);
      }
      if (filters.startDate) {
        history = history.filter(r => r.generatedAt >= filters.startDate);
      }
      if (filters.endDate) {
        history = history.filter(r => r.generatedAt <= filters.endDate);
      }
      return history;
    } catch (error) {
      this.logger.error(`Error getting recommendation history: ${error.message}`);
      return [];
    }
  }

  /**
   * Get user feedback
   * الحصول على ردود فعل المستخدم
   * 
   * @param {String} tenantId - Tenant ID
   * @param {String} userId - User ID
   * @returns {Array} User feedback
   */
  getUserFeedback(tenantId, userId) {
    try {
      const key = `${tenantId}:${userId}`;
      return this.userFeedback.get(key) || [];
    } catch (error) {
      this.logger.error(`Error getting user feedback: ${error.message}`);
      return [];
    }
  }

  /**
   * Create A/B test
   * إنشاء اختبار A/B
   * 
   * @param {String} tenantId - Tenant ID
   * @param {Object} testConfig - Test configuration
   * @returns {Object} A/B test
   */
  createABTest(tenantId, testConfig) {
    try {
      const test = {
        id: `test-${uuidv4()}`,
        tenantId,
        name: testConfig.name,
        description: testConfig.description,
        variants: testConfig.variants || ['control', 'variant_a', 'variant_b'],
        startDate: testConfig.startDate || new Date(),
        endDate: testConfig.endDate,
        status: 'active',
        results: {},
        createdAt: new Date()
      };

      // Initialize results for each variant
      test.variants.forEach(variant => {
        test.results[variant] = {
          clicks: 0,
          conversions: 0,
          impressions: 0,
          ctr: 0,
          conversionRate: 0
        };
      });
      this.abTests.set(test.id, test);
      this.emit('abtest:created', {
        test
      });
      this.logger.info(`A/B test created: ${test.name}`);
      return test;
    } catch (error) {
      this.logger.error(`Error creating A/B test: ${error.message}`);
      throw error;
    }
  }

  /**
   * Record A/B test event
   * تسجيل حدث اختبار A/B
   * 
   * @param {String} testId - Test ID
   * @param {String} variant - Variant name
   * @param {String} eventType - Event type (impression, click, conversion)
   */
  recordABTestEvent(testId, variant, eventType) {
    try {
      const test = this.abTests.get(testId);
      if (!test) {
        throw new Error(`A/B test not found: ${testId}`);
      }
      const results = test.results[variant];
      if (!results) {
        throw new Error(`Variant not found: ${variant}`);
      }
      if (eventType === 'impression') {
        results.impressions++;
      } else if (eventType === 'click') {
        results.clicks++;
      } else if (eventType === 'conversion') {
        results.conversions++;
      }

      // Calculate metrics
      results.ctr = results.impressions > 0 ? results.clicks / results.impressions * 100 : 0;
      results.conversionRate = results.clicks > 0 ? results.conversions / results.clicks * 100 : 0;
      this.emit('abtest:event_recorded', {
        testId,
        variant,
        eventType
      });
    } catch (error) {
      this.logger.error(`Error recording A/B test event: ${error.message}`);
    }
  }

  /**
   * Get A/B test results
   * الحصول على نتائج اختبار A/B
   * 
   * @param {String} testId - Test ID
   * @returns {Object} Test results
   */
  getABTestResults(testId) {
    try {
      return this.abTests.get(testId) || null;
    } catch (error) {
      this.logger.error(`Error getting A/B test results: ${error.message}`);
      return null;
    }
  }

  /**
   * Personalize recommendations for tenant
   * شخصنة التوصيات للالتزام
   * 
   * @param {String} tenantId - Tenant ID
   * @param {Array} users - Users array
   * @param {Object} options - Options
   * @returns {Object} Personalized recommendations
   */
  personalizeForTenant(tenantId, users, options = {}) {
    try {
      const personalizedRecs = {};
      users.forEach(user => {
        const recs = this.generateRecommendations(tenantId, user.id, options);
        personalizedRecs[user.id] = recs;
      });
      return {
        tenantId,
        userCount: users.length,
        recommendations: personalizedRecs,
        generatedAt: new Date()
      };
    } catch (error) {
      this.logger.error(`Error personalizing for tenant: ${error.message}`);
      throw error;
    }
  }

  /**
   * Get recommendations statistics
   * الحصول على إحصائيات التوصيات
   * 
   * @returns {Object} Statistics
   */
  getStatistics() {
    try {
      return {
        totalRecommendations: this.stats.totalRecommendations,
        totalFeedback: this.stats.totalFeedback,
        positiveRatings: this.stats.positiveRatings,
        averageRating: parseFloat(this.stats.averageRating.toFixed(2)),
        cacheHitRate: this.stats.totalRecommendations > 0 ? Math.round(this.stats.cacheHits / (this.stats.cacheHits + this.stats.cacheMisses) * 100) : 0,
        cachedUsers: this.recommendationCache.size,
        activeABTests: Array.from(this.abTests.values()).filter(t => t.status === 'active').length,
        totalUsers: this.userPreferences.size,
        strategies: Array.from(this.strategies.entries()).map(([key, s]) => ({
          id: key,
          name: s.name,
          active: s.active,
          weight: s.weight
        }))
      };
    } catch (error) {
      this.logger.error(`Error getting statistics: ${error.message}`);
      return {};
    }
  }

  /**
   * Get user context
   * الحصول على سياق المستخدم
   * 
   * @private
   */
  _getUserContext(tenantId, userId) {
    const key = `${tenantId}:${userId}`;
    const prefs = this.userPreferences.get(key) || this._createDefaultPreferences(tenantId, userId);
    const feedback = this.userFeedback.get(key) || [];
    const history = this.recommendationHistory.get(key) || [];
    return {
      preferences: prefs,
      feedbackCount: feedback.length,
      positiveRatings: feedback.filter(f => f.helpful).length,
      recentRecommendations: history.slice(-5),
      engagementLevel: feedback.length / Math.max(1, history.length)
    };
  }

  /**
   * Create default preferences
   * إنشاء التفضيلات الافتراضية
   * 
   * @private
   */
  _createDefaultPreferences(tenantId, userId) {
    const prefs = {
      tenantId,
      userId,
      categories: ['rehabilitation', 'education', 'performance'],
      excludeCategories: [],
      topics: [],
      maxRecommendations: 10,
      diversity: 0.5,
      // 0-1, how diverse recommendations should be
      freshness: 0.3,
      // 0-1, preference for recent items
      createdAt: new Date(),
      updatedAt: new Date()
    };
    this.userPreferences.set(`${tenantId}:${userId}`, prefs);
    return prefs;
  }

  /**
   * Collaborative filtering recommendations
   * توصيات تصفية التعاون
   * 
   * @private
   */
  _collaborativeFiltering(tenantId, userId, context) {
    try {
      const recommendations = [{
        id: `rec-${uuidv4()}`,
        title: 'Similar User Preferences',
        description: 'Based on users with similar interests',
        category: 'rehabilitation',
        score: 0.9,
        reasoning: 'Users like you found this helpful'
      }, {
        id: `rec-${uuidv4()}`,
        title: 'Trending Among Your Peers',
        description: 'Popular items in your user group',
        category: 'education',
        score: 0.85,
        reasoning: 'Popular in your organization'
      }];
      return recommendations;
    } catch (error) {
      this.logger.error(`Error in collaborative filtering: ${error.message}`);
      return [];
    }
  }

  /**
   * Content-based filtering recommendations
   * توصيات تصفية القائمة على المحتوى
   * 
   * @private
   */
  _contentBasedFiltering(tenantId, userId, context) {
    try {
      const recommendations = [{
        id: `rec-${uuidv4()}`,
        title: 'Related to Your Interests',
        description: 'Content matching your preferences',
        category: context.preferences.categories[0],
        score: 0.88,
        reasoning: 'Matches your saved preferences'
      }, {
        id: `rec-${uuidv4()}`,
        title: 'Advanced Topics',
        description: 'Higher level materials in your area',
        category: 'education',
        score: 0.82,
        reasoning: 'Based on your learning level'
      }];
      return recommendations;
    } catch (error) {
      this.logger.error(`Error in content-based filtering: ${error.message}`);
      return [];
    }
  }

  /**
   * Hybrid recommendation approach
   * منهج التوصية الهجين
   * 
   * @private
   */
  _hybridRecommendation(tenantId, userId, context) {
    try {
      const recommendations = [{
        id: `rec-${uuidv4()}`,
        title: 'Personalized Learning Path',
        description: 'Custom learning sequence',
        category: 'education',
        score: 0.87,
        reasoning: 'Combines your history and preferences'
      }];
      return recommendations;
    } catch (error) {
      this.logger.error(`Error in hybrid recommendation: ${error.message}`);
      return [];
    }
  }

  /**
   * Context-aware recommendation
   * توصية مراعية للسياق
   * 
   * @private
   */
  _contextAwareRecommendation(tenantId, userId, context) {
    try {
      const now = new Date();
      const hour = now.getHours();
      let timeContext = 'general';
      if (hour >= 6 && hour < 12) timeContext = 'morning';else if (hour >= 12 && hour < 18) timeContext = 'afternoon';else timeContext = 'evening';
      const recommendations = [{
        id: `rec-${uuidv4()}`,
        title: `Perfect for ${timeContext} sessions`,
        description: 'Optimized for this time of day',
        category: 'performance',
        score: 0.80,
        reasoning: `Recommended for ${timeContext} engagement`
      }];
      return recommendations;
    } catch (error) {
      this.logger.error(`Error in context-aware recommendation: ${error.message}`);
      return [];
    }
  }

  /**
   * Aggregate recommendations from all strategies
   * دمج التوصيات من جميع الاستراتيجيات
   * 
   * @private
   */
  _aggregateRecommendations(recommendations) {
    const aggregated = new Map();
    recommendations.forEach(rec => {
      const key = rec.id;
      if (aggregated.has(key)) {
        const existing = aggregated.get(key);
        existing.score += rec.score;
        existing.strategies.push(rec.strategy);
      } else {
        aggregated.set(key, {
          ...rec,
          finalScore: rec.score,
          strategies: [rec.strategy]
        });
      }
    });
    return Array.from(aggregated.values()).map(rec => ({
      ...rec,
      finalScore: parseFloat(rec.finalScore.toFixed(3))
    }));
  }

  /**
   * Store recommendation in history
   * تخزين التوصية في السجل
   * 
   * @private
   */
  _storeRecommendationHistory(tenantId, userId, recommendations) {
    const key = `${tenantId}:${userId}`;
    if (!this.recommendationHistory.has(key)) {
      this.recommendationHistory.set(key, []);
    }
    const historyRecord = {
      ...recommendations,
      storedAt: new Date()
    };
    const history = this.recommendationHistory.get(key);
    history.push(historyRecord);

    // Keep only last 100 records
    if (history.length > 100) {
      this.recommendationHistory.set(key, history.slice(-100));
    }
  }

  /**
   * Update user preferences based on feedback
   * تحديث تفضيلات المستخدم بناءً على الملاحظات
   * 
   * @private
   */
  _updateUserPreferences(tenantId, userId, feedback) {
    try {
      const key = `${tenantId}:${userId}`;
      let prefs = this.userPreferences.get(key);
      if (prefs && feedback.helpful) {
        // Boost category if feedback was positive
        if (!prefs.categories.includes(feedback.category)) {
          prefs.categories.push(feedback.category);
        }
        prefs.updatedAt = new Date();
        this.userPreferences.set(key, prefs);
      }
    } catch (error) {
      this.logger.error(`Error updating preferences from feedback: ${error.message}`);
    }
  }
}
module.exports = new RecommendationsEngineService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJyZXF1aXJlIiwidjQiLCJ1dWlkdjQiLCJMb2dnZXIiLCJhaU1vZGVscyIsIlJlY29tbWVuZGF0aW9uc0VuZ2luZVNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImxvZ2dlciIsInJlY29tbWVuZGF0aW9uQ2FjaGUiLCJNYXAiLCJ1c2VyUHJlZmVyZW5jZXMiLCJyZWNvbW1lbmRhdGlvbkhpc3RvcnkiLCJ1c2VyRmVlZGJhY2siLCJhYlRlc3RzIiwic3RyYXRlZ2llcyIsInN0YXRzIiwidG90YWxSZWNvbW1lbmRhdGlvbnMiLCJ0b3RhbEZlZWRiYWNrIiwicG9zaXRpdmVSYXRpbmdzIiwiYXZlcmFnZVJhdGluZyIsImNhY2hlSGl0cyIsImNhY2hlTWlzc2VzIiwiX2luaXRpYWxpemVTdHJhdGVnaWVzIiwic2V0IiwibmFtZSIsImRlc2NyaXB0aW9uIiwid2VpZ2h0IiwiYWN0aXZlIiwiaW5mbyIsImVycm9yIiwibWVzc2FnZSIsImdlbmVyYXRlUmVjb21tZW5kYXRpb25zIiwidGVuYW50SWQiLCJ1c2VySWQiLCJwYXJhbXMiLCJjYWNoZUtleSIsImhhcyIsImNhY2hlZCIsImdldCIsIkRhdGUiLCJ0aW1lc3RhbXAiLCJjYWNoZU1heEFnZSIsInJlY29tbWVuZGF0aW9ucyIsInVzZXJDb250ZXh0IiwiX2dldFVzZXJDb250ZXh0IiwiY2ZSZWNzIiwiX2NvbGxhYm9yYXRpdmVGaWx0ZXJpbmciLCJwdXNoIiwibWFwIiwiciIsInN0cmF0ZWd5Iiwic2NvcmUiLCJjYlJlY3MiLCJfY29udGVudEJhc2VkRmlsdGVyaW5nIiwiaHlicmlkUmVjcyIsIl9oeWJyaWRSZWNvbW1lbmRhdGlvbiIsImNvbnRleHRSZWNzIiwiX2NvbnRleHRBd2FyZVJlY29tbWVuZGF0aW9uIiwiYWdncmVnYXRlZCIsIl9hZ2dyZWdhdGVSZWNvbW1lbmRhdGlvbnMiLCJzb3J0IiwiYSIsImIiLCJmaW5hbFNjb3JlIiwibGltaXQiLCJyZXN1bHQiLCJzbGljZSIsImNvdW50IiwiTWF0aCIsIm1pbiIsImxlbmd0aCIsImdlbmVyYXRlZEF0IiwiQXJyYXkiLCJmcm9tIiwiZW50cmllcyIsImZpbHRlciIsInMiLCJrZXkiLCJpZCIsImV4cGlyZXNBdCIsIm5vdyIsImNhY2hlVFRMIiwiX3N0b3JlUmVjb21tZW5kYXRpb25IaXN0b3J5IiwiZW1pdCIsInJlY29yZEZlZWRiYWNrIiwicmVjb21tZW5kYXRpb25JZCIsImZlZWRiYWNrIiwiZmVlZGJhY2tSZWNvcmQiLCJyYXRpbmciLCJoZWxwZnVsIiwiY29tbWVudCIsImFjdGlvbiIsInVzZXJLZXkiLCJfdXBkYXRlVXNlclByZWZlcmVuY2VzIiwiZGVsZXRlIiwiZ2V0VXNlclByZWZlcmVuY2VzIiwiX2NyZWF0ZURlZmF1bHRQcmVmZXJlbmNlcyIsInVwZGF0ZVVzZXJQcmVmZXJlbmNlcyIsInByZWZlcmVuY2VzIiwicHJlZnMiLCJjYXRlZ29yaWVzIiwiZXhjbHVkZUNhdGVnb3JpZXMiLCJ0b3BpY3MiLCJtYXhSZWNvbW1lbmRhdGlvbnMiLCJ1bmRlZmluZWQiLCJkaXZlcnNpdHkiLCJmcmVzaG5lc3MiLCJ1cGRhdGVkQXQiLCJnZXRSZWNvbW1lbmRhdGlvbkhpc3RvcnkiLCJmaWx0ZXJzIiwiaGlzdG9yeSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJnZXRVc2VyRmVlZGJhY2siLCJjcmVhdGVBQlRlc3QiLCJ0ZXN0Q29uZmlnIiwidGVzdCIsInZhcmlhbnRzIiwic3RhdHVzIiwicmVzdWx0cyIsImNyZWF0ZWRBdCIsImZvckVhY2giLCJ2YXJpYW50IiwiY2xpY2tzIiwiY29udmVyc2lvbnMiLCJpbXByZXNzaW9ucyIsImN0ciIsImNvbnZlcnNpb25SYXRlIiwicmVjb3JkQUJUZXN0RXZlbnQiLCJ0ZXN0SWQiLCJldmVudFR5cGUiLCJFcnJvciIsImdldEFCVGVzdFJlc3VsdHMiLCJwZXJzb25hbGl6ZUZvclRlbmFudCIsInVzZXJzIiwib3B0aW9ucyIsInBlcnNvbmFsaXplZFJlY3MiLCJ1c2VyIiwicmVjcyIsInVzZXJDb3VudCIsImdldFN0YXRpc3RpY3MiLCJwYXJzZUZsb2F0IiwidG9GaXhlZCIsImNhY2hlSGl0UmF0ZSIsInJvdW5kIiwiY2FjaGVkVXNlcnMiLCJzaXplIiwiYWN0aXZlQUJUZXN0cyIsInZhbHVlcyIsInQiLCJ0b3RhbFVzZXJzIiwiZmVlZGJhY2tDb3VudCIsImYiLCJyZWNlbnRSZWNvbW1lbmRhdGlvbnMiLCJlbmdhZ2VtZW50TGV2ZWwiLCJtYXgiLCJjb250ZXh0IiwidGl0bGUiLCJjYXRlZ29yeSIsInJlYXNvbmluZyIsImhvdXIiLCJnZXRIb3VycyIsInRpbWVDb250ZXh0IiwicmVjIiwiZXhpc3RpbmciLCJoaXN0b3J5UmVjb3JkIiwic3RvcmVkQXQiLCJpbmNsdWRlcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyZWNvbW1lbmRhdGlvbnNFbmdpbmUuc2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogUmVjb21tZW5kYXRpb25zIEVuZ2luZSBTZXJ2aWNlXHJcbiAqINiu2K/ZhdipINmF2K3YsdmDINin2YTYqtmI2LXZitin2KpcclxuICogXHJcbiAqINin2YTZhdiz2KTZiNmE2YrYp9iqOlxyXG4gKiAtINiq2YjZhNmK2K8g2KfZhNiq2YjYtdmK2KfYqiDYp9mE2LTYrti12YrYqVxyXG4gKiAtINiq2K3ZhNmK2YQg2LPZhNmI2YMg2KfZhNmF2LPYqtiu2K/ZhVxyXG4gKiAtINiq2LXZhtmK2YEg2KfZhNiq2YjYtdmK2KfYqlxyXG4gKiAtINmF2LHYp9mC2KjYqSDYsdiv2YjYryDYp9mE2YHYudmEXHJcbiAqL1xyXG5cclxuY29uc3QgeyBFdmVudEVtaXR0ZXIgfSA9IHJlcXVpcmUoJ2V2ZW50cycpO1xyXG5jb25zdCB7IHY0OiB1dWlkdjQgfSA9IHJlcXVpcmUoJ3V1aWQnKTtcclxuY29uc3QgTG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XHJcbmNvbnN0IGFpTW9kZWxzID0gcmVxdWlyZSgnLi9haU1vZGVscy5zZXJ2aWNlJyk7XHJcblxyXG5jbGFzcyBSZWNvbW1lbmRhdGlvbnNFbmdpbmVTZXJ2aWNlIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLmxvZ2dlciA9IExvZ2dlcjtcclxuXHJcbiAgICAvLyBSZWNvbW1lbmRhdGlvbiBjYWNoZVxyXG4gICAgdGhpcy5yZWNvbW1lbmRhdGlvbkNhY2hlID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIC8vIFVzZXIgcHJlZmVyZW5jZXNcclxuICAgIHRoaXMudXNlclByZWZlcmVuY2VzID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIC8vIFJlY29tbWVuZGF0aW9uIGhpc3RvcnlcclxuICAgIHRoaXMucmVjb21tZW5kYXRpb25IaXN0b3J5ID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIC8vIFVzZXIgZmVlZGJhY2sgY29sbGVjdGlvblxyXG4gICAgdGhpcy51c2VyRmVlZGJhY2sgPSBuZXcgTWFwKCk7XHJcblxyXG4gICAgLy8gQS9CIHRlc3QgdmFyaWF0aW9uc1xyXG4gICAgdGhpcy5hYlRlc3RzID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIC8vIFJlY29tbWVuZGF0aW9uIHN0cmF0ZWdpZXNcclxuICAgIHRoaXMuc3RyYXRlZ2llcyA9IG5ldyBNYXAoKTtcclxuXHJcbiAgICAvLyBTdGF0aXN0aWNzXHJcbiAgICB0aGlzLnN0YXRzID0ge1xyXG4gICAgICB0b3RhbFJlY29tbWVuZGF0aW9uczogMCxcclxuICAgICAgdG90YWxGZWVkYmFjazogMCxcclxuICAgICAgcG9zaXRpdmVSYXRpbmdzOiAwLFxyXG4gICAgICBhdmVyYWdlUmF0aW5nOiAwLFxyXG4gICAgICBjYWNoZUhpdHM6IDAsXHJcbiAgICAgIGNhY2hlTWlzc2VzOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuX2luaXRpYWxpemVTdHJhdGVnaWVzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbml0aWFsaXplIHJlY29tbWVuZGF0aW9uIHN0cmF0ZWdpZXNcclxuICAgKiDYqtmH2YrYptipINin2LPYqtix2KfYqtmK2KzZitin2Kog2KfZhNiq2YjYtdmK2KlcclxuICAgKiBcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIF9pbml0aWFsaXplU3RyYXRlZ2llcygpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMuc3RyYXRlZ2llcy5zZXQoJ2NvbGxhYm9yYXRpdmVfZmlsdGVyaW5nJywge1xyXG4gICAgICAgIG5hbWU6ICdDb2xsYWJvcmF0aXZlIEZpbHRlcmluZycsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICfZitmI2LXZiiDYqNmG2KfYodmLINi52YTZiSDYqtmB2LbZitmE2KfYqiDYp9mE2YXYs9iq2K7Yr9mF2YrZhiDYp9mE2YXYtNin2KjZh9mK2YYnLFxyXG4gICAgICAgIHdlaWdodDogMC4zNSxcclxuICAgICAgICBhY3RpdmU6IHRydWVcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLnN0cmF0ZWdpZXMuc2V0KCdjb250ZW50X2Jhc2VkJywge1xyXG4gICAgICAgIG5hbWU6ICdDb250ZW50LUJhc2VkIEZpbHRlcmluZycsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICfZitmI2LXZiiDYqNmG2KfYodmLINi52YTZiSDYrti12KfYpti1INin2YTZhdit2KrZiNmJINin2YTZhdmB2LbZhCcsXHJcbiAgICAgICAgd2VpZ2h0OiAwLjMwLFxyXG4gICAgICAgIGFjdGl2ZTogdHJ1ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuc3RyYXRlZ2llcy5zZXQoJ2h5YnJpZCcsIHtcclxuICAgICAgICBuYW1lOiAnSHlicmlkIFJlY29tbWVuZGF0aW9uJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ9mK2KzZhdi5INio2YrZhiDYudiv2Kkg2KfYs9iq2LHYp9iq2YrYrNmK2KfYqicsXHJcbiAgICAgICAgd2VpZ2h0OiAwLjI1LFxyXG4gICAgICAgIGFjdGl2ZTogdHJ1ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuc3RyYXRlZ2llcy5zZXQoJ2NvbnRleHRfYXdhcmUnLCB7XHJcbiAgICAgICAgbmFtZTogJ0NvbnRleHQtQXdhcmUgUmVjb21tZW5kYXRpb24nLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn2YrYo9iu2LAg2YHZiiDYp9mE2KfYudiq2KjYp9ixINin2YTYs9mK2KfZgiDZiNin2YTZhdmI2YLYuSDZiNin2YTZiNmC2KonLFxyXG4gICAgICAgIHdlaWdodDogMC4xMCxcclxuICAgICAgICBhY3RpdmU6IHRydWVcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKCfinIUgUmVjb21tZW5kYXRpb24gc3RyYXRlZ2llcyBpbml0aWFsaXplZCcpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGluaXRpYWxpemluZyBzdHJhdGVnaWVzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSByZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXJcclxuICAgKiDYqtmI2YTZitivINin2YTYqtmI2LXZitin2Kog2YTZhNmF2LPYqtiu2K/ZhVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyAtIEdlbmVyYXRpb24gcGFyYW1ldGVyc1xyXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFJlY29tbWVuZGF0aW9uc1xyXG4gICAqL1xyXG4gIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHRlbmFudElkLCB1c2VySWQsIHBhcmFtcyA9IHt9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjYWNoZUtleSA9IGAke3RlbmFudElkfToke3VzZXJJZH1gO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgY2FjaGVcclxuICAgICAgaWYgKHRoaXMucmVjb21tZW5kYXRpb25DYWNoZS5oYXMoY2FjaGVLZXkpKSB7XHJcbiAgICAgICAgY29uc3QgY2FjaGVkID0gdGhpcy5yZWNvbW1lbmRhdGlvbkNhY2hlLmdldChjYWNoZUtleSk7XHJcbiAgICAgICAgaWYgKG5ldyBEYXRlKCkgLSBjYWNoZWQudGltZXN0YW1wIDwgKHBhcmFtcy5jYWNoZU1heEFnZSB8fCA1ICogNjAgKiAxMDAwKSkge1xyXG4gICAgICAgICAgdGhpcy5zdGF0cy5jYWNoZUhpdHMrKztcclxuICAgICAgICAgIHJldHVybiBjYWNoZWQucmVjb21tZW5kYXRpb25zO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5zdGF0cy5jYWNoZU1pc3NlcysrO1xyXG5cclxuICAgICAgLy8gR2V0IHVzZXIgY29udGV4dFxyXG4gICAgICBjb25zdCB1c2VyQ29udGV4dCA9IHRoaXMuX2dldFVzZXJDb250ZXh0KHRlbmFudElkLCB1c2VySWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gR2VuZXJhdGUgcmVjb21tZW5kYXRpb25zIHVzaW5nIGRpZmZlcmVudCBzdHJhdGVnaWVzXHJcbiAgICAgIGxldCByZWNvbW1lbmRhdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgIC8vIENvbGxhYm9yYXRpdmUgZmlsdGVyaW5nXHJcbiAgICAgIGNvbnN0IGNmUmVjcyA9IHRoaXMuX2NvbGxhYm9yYXRpdmVGaWx0ZXJpbmcodGVuYW50SWQsIHVzZXJJZCwgdXNlckNvbnRleHQpO1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCguLi5jZlJlY3MubWFwKHIgPT4gKHsgLi4uciwgc3RyYXRlZ3k6ICdjb2xsYWJvcmF0aXZlX2ZpbHRlcmluZycsIHNjb3JlOiByLnNjb3JlICogMC4zNSB9KSkpO1xyXG5cclxuICAgICAgLy8gQ29udGVudC1iYXNlZCBmaWx0ZXJpbmdcclxuICAgICAgY29uc3QgY2JSZWNzID0gdGhpcy5fY29udGVudEJhc2VkRmlsdGVyaW5nKHRlbmFudElkLCB1c2VySWQsIHVzZXJDb250ZXh0KTtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goLi4uY2JSZWNzLm1hcChyID0+ICh7IC4uLnIsIHN0cmF0ZWd5OiAnY29udGVudF9iYXNlZCcsIHNjb3JlOiByLnNjb3JlICogMC4zMCB9KSkpO1xyXG5cclxuICAgICAgLy8gSHlicmlkIGFwcHJvYWNoXHJcbiAgICAgIGNvbnN0IGh5YnJpZFJlY3MgPSB0aGlzLl9oeWJyaWRSZWNvbW1lbmRhdGlvbih0ZW5hbnRJZCwgdXNlcklkLCB1c2VyQ29udGV4dCk7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKC4uLmh5YnJpZFJlY3MubWFwKHIgPT4gKHsgLi4uciwgc3RyYXRlZ3k6ICdoeWJyaWQnLCBzY29yZTogci5zY29yZSAqIDAuMjUgfSkpKTtcclxuXHJcbiAgICAgIC8vIENvbnRleHQtYXdhcmVcclxuICAgICAgY29uc3QgY29udGV4dFJlY3MgPSB0aGlzLl9jb250ZXh0QXdhcmVSZWNvbW1lbmRhdGlvbih0ZW5hbnRJZCwgdXNlcklkLCB1c2VyQ29udGV4dCk7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKC4uLmNvbnRleHRSZWNzLm1hcChyID0+ICh7IC4uLnIsIHN0cmF0ZWd5OiAnY29udGV4dF9hd2FyZScsIHNjb3JlOiByLnNjb3JlICogMC4xMCB9KSkpO1xyXG5cclxuICAgICAgLy8gRGVkdXBsaWNhdGUgYW5kIGFnZ3JlZ2F0ZSBzY29yZXNcclxuICAgICAgY29uc3QgYWdncmVnYXRlZCA9IHRoaXMuX2FnZ3JlZ2F0ZVJlY29tbWVuZGF0aW9ucyhyZWNvbW1lbmRhdGlvbnMpO1xyXG5cclxuICAgICAgLy8gU29ydCBieSBzY29yZVxyXG4gICAgICBhZ2dyZWdhdGVkLnNvcnQoKGEsIGIpID0+IGIuZmluYWxTY29yZSAtIGEuZmluYWxTY29yZSk7XHJcblxyXG4gICAgICAvLyBBcHBseSBsaW1pdFxyXG4gICAgICBjb25zdCBsaW1pdCA9IHBhcmFtcy5saW1pdCB8fCAxMDtcclxuICAgICAgY29uc3QgcmVzdWx0ID0ge1xyXG4gICAgICAgIHRlbmFudElkLFxyXG4gICAgICAgIHVzZXJJZCxcclxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IGFnZ3JlZ2F0ZWQuc2xpY2UoMCwgbGltaXQpLFxyXG4gICAgICAgIGNvdW50OiBNYXRoLm1pbihsaW1pdCwgYWdncmVnYXRlZC5sZW5ndGgpLFxyXG4gICAgICAgIGdlbmVyYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIHN0cmF0ZWdpZXM6IEFycmF5LmZyb20odGhpcy5zdHJhdGVnaWVzLmVudHJpZXMoKSlcclxuICAgICAgICAgIC5maWx0ZXIoKFssIHNdKSA9PiBzLmFjdGl2ZSlcclxuICAgICAgICAgIC5tYXAoKFtrZXksIHNdKSA9PiAoeyBpZDoga2V5LCAuLi5zIH0pKVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gQ2FjaGUgcmVzdWx0c1xyXG4gICAgICB0aGlzLnJlY29tbWVuZGF0aW9uQ2FjaGUuc2V0KGNhY2hlS2V5LCB7XHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiByZXN1bHQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIChwYXJhbXMuY2FjaGVUVEwgfHwgNSAqIDYwICogMTAwMCkpXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gU3RvcmUgaW4gaGlzdG9yeVxyXG4gICAgICB0aGlzLl9zdG9yZVJlY29tbWVuZGF0aW9uSGlzdG9yeSh0ZW5hbnRJZCwgdXNlcklkLCByZXN1bHQpO1xyXG5cclxuICAgICAgdGhpcy5zdGF0cy50b3RhbFJlY29tbWVuZGF0aW9ucysrO1xyXG4gICAgICB0aGlzLmVtaXQoJ3JlY29tbWVuZGF0aW9uczpnZW5lcmF0ZWQnLCB7IHRlbmFudElkLCB1c2VySWQsIGNvdW50OiByZXN1bHQuY291bnQgfSk7XHJcblxyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmVjb21tZW5kYXRpb25zOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVjb3JkIHVzZXIgZmVlZGJhY2sgb24gcmVjb21tZW5kYXRpb25cclxuICAgKiDYqtiz2KzZitmEINix2K/ZiNivINmB2LnZhCDYp9mE2YXYs9iq2K7Yr9mFINi52YTZiSDYp9mE2KrZiNi12YrYqVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHJlY29tbWVuZGF0aW9uSWQgLSBSZWNvbW1lbmRhdGlvbiBJRFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBmZWVkYmFjayAtIEZlZWRiYWNrIGRhdGFcclxuICAgKi9cclxuICByZWNvcmRGZWVkYmFjayh0ZW5hbnRJZCwgdXNlcklkLCByZWNvbW1lbmRhdGlvbklkLCBmZWVkYmFjaykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZmVlZGJhY2tSZWNvcmQgPSB7XHJcbiAgICAgICAgaWQ6IGBmZWVkYmFjay0ke3V1aWR2NCgpfWAsXHJcbiAgICAgICAgdGVuYW50SWQsXHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uSWQsXHJcbiAgICAgICAgcmF0aW5nOiBmZWVkYmFjay5yYXRpbmcsIC8vIDEtNVxyXG4gICAgICAgIGhlbHBmdWw6IGZlZWRiYWNrLmhlbHBmdWwgfHwgZmVlZGJhY2sucmF0aW5nID49IDQsXHJcbiAgICAgICAgY29tbWVudDogZmVlZGJhY2suY29tbWVudCB8fCAnJyxcclxuICAgICAgICBhY3Rpb246IGZlZWRiYWNrLmFjdGlvbiB8fCBudWxsLCAvLyBjbGlja2VkLCBpZ25vcmVkLCBkaXNtaXNzZWQsIGV0Y1xyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgdXNlcktleSA9IGAke3RlbmFudElkfToke3VzZXJJZH1gO1xyXG4gICAgICBpZiAoIXRoaXMudXNlckZlZWRiYWNrLmhhcyh1c2VyS2V5KSkge1xyXG4gICAgICAgIHRoaXMudXNlckZlZWRiYWNrLnNldCh1c2VyS2V5LCBbXSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy51c2VyRmVlZGJhY2suZ2V0KHVzZXJLZXkpLnB1c2goZmVlZGJhY2tSZWNvcmQpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIHN0YXRpc3RpY3NcclxuICAgICAgdGhpcy5zdGF0cy50b3RhbEZlZWRiYWNrKys7XHJcbiAgICAgIGlmIChmZWVkYmFja1JlY29yZC5oZWxwZnVsKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0cy5wb3NpdGl2ZVJhdGluZ3MrKztcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnN0YXRzLmF2ZXJhZ2VSYXRpbmcgPSB0aGlzLnN0YXRzLnRvdGFsRmVlZGJhY2sgPiAwXHJcbiAgICAgICAgPyAodGhpcy5zdGF0cy5wb3NpdGl2ZVJhdGluZ3MgLyB0aGlzLnN0YXRzLnRvdGFsRmVlZGJhY2spICogNVxyXG4gICAgICAgIDogMDtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSB1c2VyIHByZWZlcmVuY2VzIGJhc2VkIG9uIGZlZWRiYWNrXHJcbiAgICAgIHRoaXMuX3VwZGF0ZVVzZXJQcmVmZXJlbmNlcyh0ZW5hbnRJZCwgdXNlcklkLCBmZWVkYmFja1JlY29yZCk7XHJcblxyXG4gICAgICAvLyBJbnZhbGlkYXRlIGNhY2hlIGZvciB0aGlzIHVzZXJcclxuICAgICAgdGhpcy5yZWNvbW1lbmRhdGlvbkNhY2hlLmRlbGV0ZSh1c2VyS2V5KTtcclxuXHJcbiAgICAgIHRoaXMuZW1pdCgnZmVlZGJhY2s6cmVjb3JkZWQnLCB7IGZlZWRiYWNrUmVjb3JkIH0pO1xyXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBGZWVkYmFjayByZWNvcmRlZDogJHt1c2VySWR9IHJhdGVkIHJlY29tbWVuZGF0aW9uICR7cmVjb21tZW5kYXRpb25JZH1gKTtcclxuXHJcbiAgICAgIHJldHVybiBmZWVkYmFja1JlY29yZDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciByZWNvcmRpbmcgZmVlZGJhY2s6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdXNlciBwcmVmZXJlbmNlc1xyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2KrZgdi22YrZhNin2Kog2KfZhNmF2LPYqtiu2K/ZhVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHJldHVybnMge09iamVjdH0gVXNlciBwcmVmZXJlbmNlc1xyXG4gICAqL1xyXG4gIGdldFVzZXJQcmVmZXJlbmNlcyh0ZW5hbnRJZCwgdXNlcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBrZXkgPSBgJHt0ZW5hbnRJZH06JHt1c2VySWR9YDtcclxuICAgICAgcmV0dXJuIHRoaXMudXNlclByZWZlcmVuY2VzLmdldChrZXkpIHx8IHRoaXMuX2NyZWF0ZURlZmF1bHRQcmVmZXJlbmNlcyh0ZW5hbnRJZCwgdXNlcklkKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBnZXR0aW5nIHVzZXIgcHJlZmVyZW5jZXM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NyZWF0ZURlZmF1bHRQcmVmZXJlbmNlcyh0ZW5hbnRJZCwgdXNlcklkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSB1c2VyIHByZWZlcmVuY2VzXHJcbiAgICog2KrYrdiv2YrYqyDYqtmB2LbZitmE2KfYqiDYp9mE2YXYs9iq2K7Yr9mFXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHRlbmFudElkIC0gVGVuYW50IElEXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge09iamVjdH0gcHJlZmVyZW5jZXMgLSBQcmVmZXJlbmNlcyB0byB1cGRhdGVcclxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBVcGRhdGVkIHByZWZlcmVuY2VzXHJcbiAgICovXHJcbiAgdXBkYXRlVXNlclByZWZlcmVuY2VzKHRlbmFudElkLCB1c2VySWQsIHByZWZlcmVuY2VzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBrZXkgPSBgJHt0ZW5hbnRJZH06JHt1c2VySWR9YDtcclxuICAgICAgbGV0IHByZWZzID0gdGhpcy51c2VyUHJlZmVyZW5jZXMuZ2V0KGtleSkgfHwgdGhpcy5fY3JlYXRlRGVmYXVsdFByZWZlcmVuY2VzKHRlbmFudElkLCB1c2VySWQpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIGFsbG93ZWQgZmllbGRzXHJcbiAgICAgIGlmIChwcmVmZXJlbmNlcy5jYXRlZ29yaWVzKSBwcmVmcy5jYXRlZ29yaWVzID0gcHJlZmVyZW5jZXMuY2F0ZWdvcmllcztcclxuICAgICAgaWYgKHByZWZlcmVuY2VzLmV4Y2x1ZGVDYXRlZ29yaWVzKSBwcmVmcy5leGNsdWRlQ2F0ZWdvcmllcyA9IHByZWZlcmVuY2VzLmV4Y2x1ZGVDYXRlZ29yaWVzO1xyXG4gICAgICBpZiAocHJlZmVyZW5jZXMudG9waWNzKSBwcmVmcy50b3BpY3MgPSBwcmVmZXJlbmNlcy50b3BpY3M7XHJcbiAgICAgIGlmIChwcmVmZXJlbmNlcy5tYXhSZWNvbW1lbmRhdGlvbnMgIT09IHVuZGVmaW5lZCkgcHJlZnMubWF4UmVjb21tZW5kYXRpb25zID0gcHJlZmVyZW5jZXMubWF4UmVjb21tZW5kYXRpb25zO1xyXG4gICAgICBpZiAocHJlZmVyZW5jZXMuZGl2ZXJzaXR5ICE9PSB1bmRlZmluZWQpIHByZWZzLmRpdmVyc2l0eSA9IHByZWZlcmVuY2VzLmRpdmVyc2l0eTtcclxuICAgICAgaWYgKHByZWZlcmVuY2VzLmZyZXNobmVzcyAhPT0gdW5kZWZpbmVkKSBwcmVmcy5mcmVzaG5lc3MgPSBwcmVmZXJlbmNlcy5mcmVzaG5lc3M7XHJcblxyXG4gICAgICBwcmVmcy51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgdGhpcy51c2VyUHJlZmVyZW5jZXMuc2V0KGtleSwgcHJlZnMpO1xyXG5cclxuICAgICAgdGhpcy5lbWl0KCdwcmVmZXJlbmNlczp1cGRhdGVkJywgeyB0ZW5hbnRJZCwgdXNlcklkLCBwcmVmZXJlbmNlczogcHJlZnMgfSk7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oYFVzZXIgcHJlZmVyZW5jZXMgdXBkYXRlZDogJHt1c2VySWR9YCk7XHJcblxyXG4gICAgICByZXR1cm4gcHJlZnM7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgdXBkYXRpbmcgcHJlZmVyZW5jZXM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgcmVjb21tZW5kYXRpb24gaGlzdG9yeSBmb3IgdXNlclxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2LPYrNmEINin2YTYqtmI2LXZitin2Kog2YTZhNmF2LPYqtiu2K/ZhVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGZpbHRlcnMgLSBGaWx0ZXJzXHJcbiAgICogQHJldHVybnMge0FycmF5fSBSZWNvbW1lbmRhdGlvbiBoaXN0b3J5XHJcbiAgICovXHJcbiAgZ2V0UmVjb21tZW5kYXRpb25IaXN0b3J5KHRlbmFudElkLCB1c2VySWQsIGZpbHRlcnMgPSB7fSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qga2V5ID0gYCR7dGVuYW50SWR9OiR7dXNlcklkfWA7XHJcbiAgICAgIGxldCBoaXN0b3J5ID0gdGhpcy5yZWNvbW1lbmRhdGlvbkhpc3RvcnkuZ2V0KGtleSkgfHwgW107XHJcblxyXG4gICAgICAvLyBBcHBseSBmaWx0ZXJzXHJcbiAgICAgIGlmIChmaWx0ZXJzLmxpbWl0KSB7XHJcbiAgICAgICAgaGlzdG9yeSA9IGhpc3Rvcnkuc2xpY2UoLWZpbHRlcnMubGltaXQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZmlsdGVycy5zdGFydERhdGUpIHtcclxuICAgICAgICBoaXN0b3J5ID0gaGlzdG9yeS5maWx0ZXIociA9PiByLmdlbmVyYXRlZEF0ID49IGZpbHRlcnMuc3RhcnREYXRlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGZpbHRlcnMuZW5kRGF0ZSkge1xyXG4gICAgICAgIGhpc3RvcnkgPSBoaXN0b3J5LmZpbHRlcihyID0+IHIuZ2VuZXJhdGVkQXQgPD0gZmlsdGVycy5lbmREYXRlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGhpc3Rvcnk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyByZWNvbW1lbmRhdGlvbiBoaXN0b3J5OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB1c2VyIGZlZWRiYWNrXHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYsdiv2YjYryDZgdi52YQg2KfZhNmF2LPYqtiu2K/ZhVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHJldHVybnMge0FycmF5fSBVc2VyIGZlZWRiYWNrXHJcbiAgICovXHJcbiAgZ2V0VXNlckZlZWRiYWNrKHRlbmFudElkLCB1c2VySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGtleSA9IGAke3RlbmFudElkfToke3VzZXJJZH1gO1xyXG4gICAgICByZXR1cm4gdGhpcy51c2VyRmVlZGJhY2suZ2V0KGtleSkgfHwgW107XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyB1c2VyIGZlZWRiYWNrOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBBL0IgdGVzdFxyXG4gICAqINil2YbYtNin2KEg2KfYrtiq2KjYp9ixIEEvQlxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZW5hbnRJZCAtIFRlbmFudCBJRFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB0ZXN0Q29uZmlnIC0gVGVzdCBjb25maWd1cmF0aW9uXHJcbiAgICogQHJldHVybnMge09iamVjdH0gQS9CIHRlc3RcclxuICAgKi9cclxuICBjcmVhdGVBQlRlc3QodGVuYW50SWQsIHRlc3RDb25maWcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHRlc3QgPSB7XHJcbiAgICAgICAgaWQ6IGB0ZXN0LSR7dXVpZHY0KCl9YCxcclxuICAgICAgICB0ZW5hbnRJZCxcclxuICAgICAgICBuYW1lOiB0ZXN0Q29uZmlnLm5hbWUsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IHRlc3RDb25maWcuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgdmFyaWFudHM6IHRlc3RDb25maWcudmFyaWFudHMgfHwgWydjb250cm9sJywgJ3ZhcmlhbnRfYScsICd2YXJpYW50X2InXSxcclxuICAgICAgICBzdGFydERhdGU6IHRlc3RDb25maWcuc3RhcnREYXRlIHx8IG5ldyBEYXRlKCksXHJcbiAgICAgICAgZW5kRGF0ZTogdGVzdENvbmZpZy5lbmREYXRlLFxyXG4gICAgICAgIHN0YXR1czogJ2FjdGl2ZScsXHJcbiAgICAgICAgcmVzdWx0czoge30sXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBJbml0aWFsaXplIHJlc3VsdHMgZm9yIGVhY2ggdmFyaWFudFxyXG4gICAgICB0ZXN0LnZhcmlhbnRzLmZvckVhY2godmFyaWFudCA9PiB7XHJcbiAgICAgICAgdGVzdC5yZXN1bHRzW3ZhcmlhbnRdID0ge1xyXG4gICAgICAgICAgY2xpY2tzOiAwLFxyXG4gICAgICAgICAgY29udmVyc2lvbnM6IDAsXHJcbiAgICAgICAgICBpbXByZXNzaW9uczogMCxcclxuICAgICAgICAgIGN0cjogMCxcclxuICAgICAgICAgIGNvbnZlcnNpb25SYXRlOiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmFiVGVzdHMuc2V0KHRlc3QuaWQsIHRlc3QpO1xyXG5cclxuICAgICAgdGhpcy5lbWl0KCdhYnRlc3Q6Y3JlYXRlZCcsIHsgdGVzdCB9KTtcclxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgQS9CIHRlc3QgY3JlYXRlZDogJHt0ZXN0Lm5hbWV9YCk7XHJcblxyXG4gICAgICByZXR1cm4gdGVzdDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBjcmVhdGluZyBBL0IgdGVzdDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlY29yZCBBL0IgdGVzdCBldmVudFxyXG4gICAqINiq2LPYrNmK2YQg2K3Yr9irINin2K7Yqtio2KfYsSBBL0JcclxuICAgKiBcclxuICAgKiBAcGFyYW0ge1N0cmluZ30gdGVzdElkIC0gVGVzdCBJRFxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB2YXJpYW50IC0gVmFyaWFudCBuYW1lXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50VHlwZSAtIEV2ZW50IHR5cGUgKGltcHJlc3Npb24sIGNsaWNrLCBjb252ZXJzaW9uKVxyXG4gICAqL1xyXG4gIHJlY29yZEFCVGVzdEV2ZW50KHRlc3RJZCwgdmFyaWFudCwgZXZlbnRUeXBlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB0ZXN0ID0gdGhpcy5hYlRlc3RzLmdldCh0ZXN0SWQpO1xyXG4gICAgICBpZiAoIXRlc3QpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEEvQiB0ZXN0IG5vdCBmb3VuZDogJHt0ZXN0SWR9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSB0ZXN0LnJlc3VsdHNbdmFyaWFudF07XHJcbiAgICAgIGlmICghcmVzdWx0cykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVmFyaWFudCBub3QgZm91bmQ6ICR7dmFyaWFudH1gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGV2ZW50VHlwZSA9PT0gJ2ltcHJlc3Npb24nKSB7XHJcbiAgICAgICAgcmVzdWx0cy5pbXByZXNzaW9ucysrO1xyXG4gICAgICB9IGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gJ2NsaWNrJykge1xyXG4gICAgICAgIHJlc3VsdHMuY2xpY2tzKys7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXZlbnRUeXBlID09PSAnY29udmVyc2lvbicpIHtcclxuICAgICAgICByZXN1bHRzLmNvbnZlcnNpb25zKys7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENhbGN1bGF0ZSBtZXRyaWNzXHJcbiAgICAgIHJlc3VsdHMuY3RyID0gcmVzdWx0cy5pbXByZXNzaW9ucyA+IDAgPyAocmVzdWx0cy5jbGlja3MgLyByZXN1bHRzLmltcHJlc3Npb25zKSAqIDEwMCA6IDA7XHJcbiAgICAgIHJlc3VsdHMuY29udmVyc2lvblJhdGUgPSByZXN1bHRzLmNsaWNrcyA+IDAgPyAocmVzdWx0cy5jb252ZXJzaW9ucyAvIHJlc3VsdHMuY2xpY2tzKSAqIDEwMCA6IDA7XHJcblxyXG4gICAgICB0aGlzLmVtaXQoJ2FidGVzdDpldmVudF9yZWNvcmRlZCcsIHsgdGVzdElkLCB2YXJpYW50LCBldmVudFR5cGUgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgcmVjb3JkaW5nIEEvQiB0ZXN0IGV2ZW50OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgQS9CIHRlc3QgcmVzdWx0c1xyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2YbYqtin2KbYrCDYp9iu2KrYqNin2LEgQS9CXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IHRlc3RJZCAtIFRlc3QgSURcclxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBUZXN0IHJlc3VsdHNcclxuICAgKi9cclxuICBnZXRBQlRlc3RSZXN1bHRzKHRlc3RJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIHRoaXMuYWJUZXN0cy5nZXQodGVzdElkKSB8fCBudWxsO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGdldHRpbmcgQS9CIHRlc3QgcmVzdWx0czogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBlcnNvbmFsaXplIHJlY29tbWVuZGF0aW9ucyBmb3IgdGVuYW50XHJcbiAgICog2LTYrti12YbYqSDYp9mE2KrZiNi12YrYp9iqINmE2YTYp9mE2KrYstin2YVcclxuICAgKiBcclxuICAgKiBAcGFyYW0ge1N0cmluZ30gdGVuYW50SWQgLSBUZW5hbnQgSURcclxuICAgKiBAcGFyYW0ge0FycmF5fSB1c2VycyAtIFVzZXJzIGFycmF5XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zXHJcbiAgICogQHJldHVybnMge09iamVjdH0gUGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9uc1xyXG4gICAqL1xyXG4gIHBlcnNvbmFsaXplRm9yVGVuYW50KHRlbmFudElkLCB1c2Vycywgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBwZXJzb25hbGl6ZWRSZWNzID0ge307XHJcblxyXG4gICAgICB1c2Vycy5mb3JFYWNoKHVzZXIgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlY3MgPSB0aGlzLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHRlbmFudElkLCB1c2VyLmlkLCBvcHRpb25zKTtcclxuICAgICAgICBwZXJzb25hbGl6ZWRSZWNzW3VzZXIuaWRdID0gcmVjcztcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHRlbmFudElkLFxyXG4gICAgICAgIHVzZXJDb3VudDogdXNlcnMubGVuZ3RoLFxyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogcGVyc29uYWxpemVkUmVjcyxcclxuICAgICAgICBnZW5lcmF0ZWRBdDogbmV3IERhdGUoKVxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIHBlcnNvbmFsaXppbmcgZm9yIHRlbmFudDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCByZWNvbW1lbmRhdGlvbnMgc3RhdGlzdGljc1xyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2KXYrdi12KfYptmK2KfYqiDYp9mE2KrZiNi12YrYp9iqXHJcbiAgICogXHJcbiAgICogQHJldHVybnMge09iamVjdH0gU3RhdGlzdGljc1xyXG4gICAqL1xyXG4gIGdldFN0YXRpc3RpY3MoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zOiB0aGlzLnN0YXRzLnRvdGFsUmVjb21tZW5kYXRpb25zLFxyXG4gICAgICAgIHRvdGFsRmVlZGJhY2s6IHRoaXMuc3RhdHMudG90YWxGZWVkYmFjayxcclxuICAgICAgICBwb3NpdGl2ZVJhdGluZ3M6IHRoaXMuc3RhdHMucG9zaXRpdmVSYXRpbmdzLFxyXG4gICAgICAgIGF2ZXJhZ2VSYXRpbmc6IHBhcnNlRmxvYXQodGhpcy5zdGF0cy5hdmVyYWdlUmF0aW5nLnRvRml4ZWQoMikpLFxyXG4gICAgICAgIGNhY2hlSGl0UmF0ZTogdGhpcy5zdGF0cy50b3RhbFJlY29tbWVuZGF0aW9ucyA+IDBcclxuICAgICAgICAgID8gTWF0aC5yb3VuZCgodGhpcy5zdGF0cy5jYWNoZUhpdHMgLyAodGhpcy5zdGF0cy5jYWNoZUhpdHMgKyB0aGlzLnN0YXRzLmNhY2hlTWlzc2VzKSkgKiAxMDApXHJcbiAgICAgICAgICA6IDAsXHJcbiAgICAgICAgY2FjaGVkVXNlcnM6IHRoaXMucmVjb21tZW5kYXRpb25DYWNoZS5zaXplLFxyXG4gICAgICAgIGFjdGl2ZUFCVGVzdHM6IEFycmF5LmZyb20odGhpcy5hYlRlc3RzLnZhbHVlcygpKS5maWx0ZXIodCA9PiB0LnN0YXR1cyA9PT0gJ2FjdGl2ZScpLmxlbmd0aCxcclxuICAgICAgICB0b3RhbFVzZXJzOiB0aGlzLnVzZXJQcmVmZXJlbmNlcy5zaXplLFxyXG4gICAgICAgIHN0cmF0ZWdpZXM6IEFycmF5LmZyb20odGhpcy5zdHJhdGVnaWVzLmVudHJpZXMoKSkubWFwKChba2V5LCBzXSkgPT4gKHtcclxuICAgICAgICAgIGlkOiBrZXksXHJcbiAgICAgICAgICBuYW1lOiBzLm5hbWUsXHJcbiAgICAgICAgICBhY3RpdmU6IHMuYWN0aXZlLFxyXG4gICAgICAgICAgd2VpZ2h0OiBzLndlaWdodFxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGdldHRpbmcgc3RhdGlzdGljczogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICByZXR1cm4ge307XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdXNlciBjb250ZXh0XHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYs9mK2KfZgiDYp9mE2YXYs9iq2K7Yr9mFXHJcbiAgICogXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBfZ2V0VXNlckNvbnRleHQodGVuYW50SWQsIHVzZXJJZCkge1xyXG4gICAgY29uc3Qga2V5ID0gYCR7dGVuYW50SWR9OiR7dXNlcklkfWA7XHJcbiAgICBjb25zdCBwcmVmcyA9IHRoaXMudXNlclByZWZlcmVuY2VzLmdldChrZXkpIHx8IHRoaXMuX2NyZWF0ZURlZmF1bHRQcmVmZXJlbmNlcyh0ZW5hbnRJZCwgdXNlcklkKTtcclxuICAgIGNvbnN0IGZlZWRiYWNrID0gdGhpcy51c2VyRmVlZGJhY2suZ2V0KGtleSkgfHwgW107XHJcbiAgICBjb25zdCBoaXN0b3J5ID0gdGhpcy5yZWNvbW1lbmRhdGlvbkhpc3RvcnkuZ2V0KGtleSkgfHwgW107XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcHJlZmVyZW5jZXM6IHByZWZzLFxyXG4gICAgICBmZWVkYmFja0NvdW50OiBmZWVkYmFjay5sZW5ndGgsXHJcbiAgICAgIHBvc2l0aXZlUmF0aW5nczogZmVlZGJhY2suZmlsdGVyKGYgPT4gZi5oZWxwZnVsKS5sZW5ndGgsXHJcbiAgICAgIHJlY2VudFJlY29tbWVuZGF0aW9uczogaGlzdG9yeS5zbGljZSgtNSksXHJcbiAgICAgIGVuZ2FnZW1lbnRMZXZlbDogZmVlZGJhY2subGVuZ3RoIC8gTWF0aC5tYXgoMSwgaGlzdG9yeS5sZW5ndGgpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGRlZmF1bHQgcHJlZmVyZW5jZXNcclxuICAgKiDYpdmG2LTYp9ihINin2YTYqtmB2LbZitmE2KfYqiDYp9mE2KfZgdiq2LHYp9i22YrYqVxyXG4gICAqIFxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgX2NyZWF0ZURlZmF1bHRQcmVmZXJlbmNlcyh0ZW5hbnRJZCwgdXNlcklkKSB7XHJcbiAgICBjb25zdCBwcmVmcyA9IHtcclxuICAgICAgdGVuYW50SWQsXHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgY2F0ZWdvcmllczogWydyZWhhYmlsaXRhdGlvbicsICdlZHVjYXRpb24nLCAncGVyZm9ybWFuY2UnXSxcclxuICAgICAgZXhjbHVkZUNhdGVnb3JpZXM6IFtdLFxyXG4gICAgICB0b3BpY3M6IFtdLFxyXG4gICAgICBtYXhSZWNvbW1lbmRhdGlvbnM6IDEwLFxyXG4gICAgICBkaXZlcnNpdHk6IDAuNSwgLy8gMC0xLCBob3cgZGl2ZXJzZSByZWNvbW1lbmRhdGlvbnMgc2hvdWxkIGJlXHJcbiAgICAgIGZyZXNobmVzczogMC4zLCAvLyAwLTEsIHByZWZlcmVuY2UgZm9yIHJlY2VudCBpdGVtc1xyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnVzZXJQcmVmZXJlbmNlcy5zZXQoYCR7dGVuYW50SWR9OiR7dXNlcklkfWAsIHByZWZzKTtcclxuICAgIHJldHVybiBwcmVmcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbGxhYm9yYXRpdmUgZmlsdGVyaW5nIHJlY29tbWVuZGF0aW9uc1xyXG4gICAqINiq2YjYtdmK2KfYqiDYqti12YHZitipINin2YTYqti52KfZiNmGXHJcbiAgICogXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBfY29sbGFib3JhdGl2ZUZpbHRlcmluZyh0ZW5hbnRJZCwgdXNlcklkLCBjb250ZXh0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6IGByZWMtJHt1dWlkdjQoKX1gLFxyXG4gICAgICAgICAgdGl0bGU6ICdTaW1pbGFyIFVzZXIgUHJlZmVyZW5jZXMnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdCYXNlZCBvbiB1c2VycyB3aXRoIHNpbWlsYXIgaW50ZXJlc3RzJyxcclxuICAgICAgICAgIGNhdGVnb3J5OiAncmVoYWJpbGl0YXRpb24nLFxyXG4gICAgICAgICAgc2NvcmU6IDAuOSxcclxuICAgICAgICAgIHJlYXNvbmluZzogJ1VzZXJzIGxpa2UgeW91IGZvdW5kIHRoaXMgaGVscGZ1bCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBgcmVjLSR7dXVpZHY0KCl9YCxcclxuICAgICAgICAgIHRpdGxlOiAnVHJlbmRpbmcgQW1vbmcgWW91ciBQZWVycycsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1BvcHVsYXIgaXRlbXMgaW4geW91ciB1c2VyIGdyb3VwJyxcclxuICAgICAgICAgIGNhdGVnb3J5OiAnZWR1Y2F0aW9uJyxcclxuICAgICAgICAgIHNjb3JlOiAwLjg1LFxyXG4gICAgICAgICAgcmVhc29uaW5nOiAnUG9wdWxhciBpbiB5b3VyIG9yZ2FuaXphdGlvbidcclxuICAgICAgICB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGluIGNvbGxhYm9yYXRpdmUgZmlsdGVyaW5nOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnRlbnQtYmFzZWQgZmlsdGVyaW5nIHJlY29tbWVuZGF0aW9uc1xyXG4gICAqINiq2YjYtdmK2KfYqiDYqti12YHZitipINin2YTZgtin2KbZhdipINi52YTZiSDYp9mE2YXYrdiq2YjZiVxyXG4gICAqIFxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgX2NvbnRlbnRCYXNlZEZpbHRlcmluZyh0ZW5hbnRJZCwgdXNlcklkLCBjb250ZXh0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6IGByZWMtJHt1dWlkdjQoKX1gLFxyXG4gICAgICAgICAgdGl0bGU6ICdSZWxhdGVkIHRvIFlvdXIgSW50ZXJlc3RzJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ29udGVudCBtYXRjaGluZyB5b3VyIHByZWZlcmVuY2VzJyxcclxuICAgICAgICAgIGNhdGVnb3J5OiBjb250ZXh0LnByZWZlcmVuY2VzLmNhdGVnb3JpZXNbMF0sXHJcbiAgICAgICAgICBzY29yZTogMC44OCxcclxuICAgICAgICAgIHJlYXNvbmluZzogJ01hdGNoZXMgeW91ciBzYXZlZCBwcmVmZXJlbmNlcydcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBgcmVjLSR7dXVpZHY0KCl9YCxcclxuICAgICAgICAgIHRpdGxlOiAnQWR2YW5jZWQgVG9waWNzJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnSGlnaGVyIGxldmVsIG1hdGVyaWFscyBpbiB5b3VyIGFyZWEnLFxyXG4gICAgICAgICAgY2F0ZWdvcnk6ICdlZHVjYXRpb24nLFxyXG4gICAgICAgICAgc2NvcmU6IDAuODIsXHJcbiAgICAgICAgICByZWFzb25pbmc6ICdCYXNlZCBvbiB5b3VyIGxlYXJuaW5nIGxldmVsJ1xyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuXHJcbiAgICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgaW4gY29udGVudC1iYXNlZCBmaWx0ZXJpbmc6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSHlicmlkIHJlY29tbWVuZGF0aW9uIGFwcHJvYWNoXHJcbiAgICog2YXZhtmH2Kwg2KfZhNiq2YjYtdmK2Kkg2KfZhNmH2KzZitmGXHJcbiAgICogXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBfaHlicmlkUmVjb21tZW5kYXRpb24odGVuYW50SWQsIHVzZXJJZCwgY29udGV4dCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25zID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBgcmVjLSR7dXVpZHY0KCl9YCxcclxuICAgICAgICAgIHRpdGxlOiAnUGVyc29uYWxpemVkIExlYXJuaW5nIFBhdGgnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdDdXN0b20gbGVhcm5pbmcgc2VxdWVuY2UnLFxyXG4gICAgICAgICAgY2F0ZWdvcnk6ICdlZHVjYXRpb24nLFxyXG4gICAgICAgICAgc2NvcmU6IDAuODcsXHJcbiAgICAgICAgICByZWFzb25pbmc6ICdDb21iaW5lcyB5b3VyIGhpc3RvcnkgYW5kIHByZWZlcmVuY2VzJ1xyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuXHJcbiAgICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgaW4gaHlicmlkIHJlY29tbWVuZGF0aW9uOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnRleHQtYXdhcmUgcmVjb21tZW5kYXRpb25cclxuICAgKiDYqtmI2LXZitipINmF2LHYp9i52YrYqSDZhNmE2LPZitin2YJcclxuICAgKiBcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIF9jb250ZXh0QXdhcmVSZWNvbW1lbmRhdGlvbih0ZW5hbnRJZCwgdXNlcklkLCBjb250ZXh0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICBjb25zdCBob3VyID0gbm93LmdldEhvdXJzKCk7XHJcbiAgICAgIGxldCB0aW1lQ29udGV4dCA9ICdnZW5lcmFsJztcclxuICAgICAgXHJcbiAgICAgIGlmIChob3VyID49IDYgJiYgaG91ciA8IDEyKSB0aW1lQ29udGV4dCA9ICdtb3JuaW5nJztcclxuICAgICAgZWxzZSBpZiAoaG91ciA+PSAxMiAmJiBob3VyIDwgMTgpIHRpbWVDb250ZXh0ID0gJ2FmdGVybm9vbic7XHJcbiAgICAgIGVsc2UgdGltZUNvbnRleHQgPSAnZXZlbmluZyc7XHJcblxyXG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6IGByZWMtJHt1dWlkdjQoKX1gLFxyXG4gICAgICAgICAgdGl0bGU6IGBQZXJmZWN0IGZvciAke3RpbWVDb250ZXh0fSBzZXNzaW9uc2AsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ09wdGltaXplZCBmb3IgdGhpcyB0aW1lIG9mIGRheScsXHJcbiAgICAgICAgICBjYXRlZ29yeTogJ3BlcmZvcm1hbmNlJyxcclxuICAgICAgICAgIHNjb3JlOiAwLjgwLFxyXG4gICAgICAgICAgcmVhc29uaW5nOiBgUmVjb21tZW5kZWQgZm9yICR7dGltZUNvbnRleHR9IGVuZ2FnZW1lbnRgXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBpbiBjb250ZXh0LWF3YXJlIHJlY29tbWVuZGF0aW9uOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFnZ3JlZ2F0ZSByZWNvbW1lbmRhdGlvbnMgZnJvbSBhbGwgc3RyYXRlZ2llc1xyXG4gICAqINiv2YXYrCDYp9mE2KrZiNi12YrYp9iqINmF2YYg2KzZhdmK2Lkg2KfZhNin2LPYqtix2KfYqtmK2KzZitin2KpcclxuICAgKiBcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIF9hZ2dyZWdhdGVSZWNvbW1lbmRhdGlvbnMocmVjb21tZW5kYXRpb25zKSB7XHJcbiAgICBjb25zdCBhZ2dyZWdhdGVkID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIHJlY29tbWVuZGF0aW9ucy5mb3JFYWNoKHJlYyA9PiB7XHJcbiAgICAgIGNvbnN0IGtleSA9IHJlYy5pZDtcclxuICAgICAgaWYgKGFnZ3JlZ2F0ZWQuaGFzKGtleSkpIHtcclxuICAgICAgICBjb25zdCBleGlzdGluZyA9IGFnZ3JlZ2F0ZWQuZ2V0KGtleSk7XHJcbiAgICAgICAgZXhpc3Rpbmcuc2NvcmUgKz0gcmVjLnNjb3JlO1xyXG4gICAgICAgIGV4aXN0aW5nLnN0cmF0ZWdpZXMucHVzaChyZWMuc3RyYXRlZ3kpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFnZ3JlZ2F0ZWQuc2V0KGtleSwge1xyXG4gICAgICAgICAgLi4ucmVjLFxyXG4gICAgICAgICAgZmluYWxTY29yZTogcmVjLnNjb3JlLFxyXG4gICAgICAgICAgc3RyYXRlZ2llczogW3JlYy5zdHJhdGVneV1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oYWdncmVnYXRlZC52YWx1ZXMoKSkubWFwKHJlYyA9PiAoe1xyXG4gICAgICAuLi5yZWMsXHJcbiAgICAgIGZpbmFsU2NvcmU6IHBhcnNlRmxvYXQocmVjLmZpbmFsU2NvcmUudG9GaXhlZCgzKSlcclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3JlIHJlY29tbWVuZGF0aW9uIGluIGhpc3RvcnlcclxuICAgKiDYqtiu2LLZitmGINin2YTYqtmI2LXZitipINmB2Yog2KfZhNiz2KzZhFxyXG4gICAqIFxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgX3N0b3JlUmVjb21tZW5kYXRpb25IaXN0b3J5KHRlbmFudElkLCB1c2VySWQsIHJlY29tbWVuZGF0aW9ucykge1xyXG4gICAgY29uc3Qga2V5ID0gYCR7dGVuYW50SWR9OiR7dXNlcklkfWA7XHJcbiAgICBpZiAoIXRoaXMucmVjb21tZW5kYXRpb25IaXN0b3J5LmhhcyhrZXkpKSB7XHJcbiAgICAgIHRoaXMucmVjb21tZW5kYXRpb25IaXN0b3J5LnNldChrZXksIFtdKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBoaXN0b3J5UmVjb3JkID0ge1xyXG4gICAgICAuLi5yZWNvbW1lbmRhdGlvbnMsXHJcbiAgICAgIHN0b3JlZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGhpc3RvcnkgPSB0aGlzLnJlY29tbWVuZGF0aW9uSGlzdG9yeS5nZXQoa2V5KTtcclxuICAgIGhpc3RvcnkucHVzaChoaXN0b3J5UmVjb3JkKTtcclxuXHJcbiAgICAvLyBLZWVwIG9ubHkgbGFzdCAxMDAgcmVjb3Jkc1xyXG4gICAgaWYgKGhpc3RvcnkubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgIHRoaXMucmVjb21tZW5kYXRpb25IaXN0b3J5LnNldChrZXksIGhpc3Rvcnkuc2xpY2UoLTEwMCkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHVzZXIgcHJlZmVyZW5jZXMgYmFzZWQgb24gZmVlZGJhY2tcclxuICAgKiDYqtit2K/ZitirINiq2YHYttmK2YTYp9iqINin2YTZhdiz2KrYrtiv2YUg2KjZhtin2KHZiyDYudmE2Ykg2KfZhNmF2YTYp9it2LjYp9iqXHJcbiAgICogXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBfdXBkYXRlVXNlclByZWZlcmVuY2VzKHRlbmFudElkLCB1c2VySWQsIGZlZWRiYWNrKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBrZXkgPSBgJHt0ZW5hbnRJZH06JHt1c2VySWR9YDtcclxuICAgICAgbGV0IHByZWZzID0gdGhpcy51c2VyUHJlZmVyZW5jZXMuZ2V0KGtleSk7XHJcblxyXG4gICAgICBpZiAocHJlZnMgJiYgZmVlZGJhY2suaGVscGZ1bCkge1xyXG4gICAgICAgIC8vIEJvb3N0IGNhdGVnb3J5IGlmIGZlZWRiYWNrIHdhcyBwb3NpdGl2ZVxyXG4gICAgICAgIGlmICghcHJlZnMuY2F0ZWdvcmllcy5pbmNsdWRlcyhmZWVkYmFjay5jYXRlZ29yeSkpIHtcclxuICAgICAgICAgIHByZWZzLmNhdGVnb3JpZXMucHVzaChmZWVkYmFjay5jYXRlZ29yeSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcmVmcy51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHRoaXMudXNlclByZWZlcmVuY2VzLnNldChrZXksIHByZWZzKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIHVwZGF0aW5nIHByZWZlcmVuY2VzIGZyb20gZmVlZGJhY2s6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbmV3IFJlY29tbWVuZGF0aW9uc0VuZ2luZVNlcnZpY2UoKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtB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