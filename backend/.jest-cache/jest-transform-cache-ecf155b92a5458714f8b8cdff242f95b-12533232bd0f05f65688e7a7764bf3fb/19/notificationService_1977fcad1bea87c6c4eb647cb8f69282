44aa69fa35519cf3e86119ec54852110
/**
 * Notification Service - Multi-channel Notifications
 */

const {
  sendEmail
} = require('./emailService');
const {
  sendSMS
} = require('./smsService');
const {
  sendPush
} = require('./pushService');
class NotificationService {
  static notifications = [];

  /**
   * إرسال إشعار
   */
  static async sendNotification(userId, notificationData) {
    try {
      const notif = {
        id: `notif_${Date.now()}`,
        userId,
        title: notificationData.title,
        message: notificationData.message,
        channels: notificationData.channels || ['in-app'],
        priority: notificationData.priority || 'normal',
        createdAt: new Date(),
        sent: true,
        deliveryStatus: {}
      };

      // إرسال عبر القنوات المطلوبة

      // جلب بيانات المستخدم (للحصول على البريد، الجوال، fcmTokens)
      let user = notificationData.userObj;
      if (!user) {
        user = await User.findById(userId).lean();
      }
      for (const channel of notif.channels) {
        if (channel === 'email') {
          const to = notificationData.email || user && user.email || 'test@example.com';
          const subject = notif.title;
          const text = notif.message;
          const result = await sendEmail({
            to,
            subject,
            text
          });
          notif.deliveryStatus.email = result.success ? 'sent' : 'failed';
        } else if (channel === 'sms') {
          const to = notificationData.phone || user && user.phone || '+201234567890';
          const message = notif.message;
          const result = await sendSMS({
            to,
            message
          });
          notif.deliveryStatus.sms = result.success ? 'sent' : 'failed';
        } else if (channel === 'push') {
          const tokens = user && user.fcmTokens || [];
          if (tokens.length > 0) {
            const result = await sendPush({
              tokens,
              title: notif.title,
              body: notif.message
            });
            notif.deliveryStatus.push = result.success ? 'sent' : 'failed';
          } else {
            notif.deliveryStatus.push = 'no-tokens';
          }
        } else if (channel === 'in-app') {
          notif.deliveryStatus.inApp = 'delivered';
        }
      }
      this.notifications.push(notif);
      return {
        success: true,
        notificationId: notif.id,
        sentTo: notif.channels,
        deliveryStatus: notif.deliveryStatus,
        timestamp: new Date()
      };
    } catch (err) {
      throw new Error(`Notification send failed: ${err.message}`);
    }
  }

  /**
   * الحصول على إشعارات المستخدم
   */
  static async getNotifications(userId, limit = 50, unreadOnly = false) {
    try {
      let userNotifs = this.notifications.filter(n => n.userId === userId);
      if (unreadOnly) {
        userNotifs = userNotifs.filter(n => !n.read);
      }
      return {
        success: true,
        count: userNotifs.length,
        notifications: userNotifs.slice(-limit),
        timestamp: new Date()
      };
    } catch (err) {
      throw new Error(`Get notifications failed: ${err.message}`);
    }
  }

  /**
   * وضع علامة على الإشعار كمقروء
   */
  static async markAsRead(notificationId) {
    try {
      const notif = this.notifications.find(n => n.id === notificationId);
      if (notif) {
        notif.read = true;
      }
      return {
        success: true,
        message: 'Marked as read'
      };
    } catch (err) {
      throw new Error(`Mark as read failed: ${err.message}`);
    }
  }

  /**
   * حذف الإشعار
   */
  static async deleteNotification(notificationId) {
    try {
      this.notifications = this.notifications.filter(n => n.id !== notificationId);
      return {
        success: true,
        message: 'Notification deleted'
      };
    } catch (err) {
      throw new Error(`Delete notification failed: ${err.message}`);
    }
  }

  /**
   * حذف جميع إشعارات المستخدم
   */
  static async deleteAllNotifications(userId) {
    try {
      const countBefore = this.notifications.length;
      this.notifications = this.notifications.filter(n => n.userId !== userId);
      const deletedCount = countBefore - this.notifications.length;
      return {
        success: true,
        message: `${deletedCount} notifications deleted`
      };
    } catch (err) {
      throw new Error(`Delete all notifications failed: ${err.message}`);
    }
  }

  /**
   * جدولة إشعار (محاكاة)
   */
  static async scheduleNotification(userId, notificationData, scheduleTime) {
    try {
      return {
        success: true,
        message: 'Notification scheduled',
        scheduledFor: scheduleTime,
        userId,
        status: 'pending'
      };
    } catch (err) {
      throw new Error(`Schedule notification failed: ${err.message}`);
    }
  }

  // Helper Methods
  static _simulateDelivery(channels) {
    const delivery = {};
    channels.forEach(channel => {
      delivery[channel] = {
        status: 'delivered',
        timestamp: new Date(),
        attempts: 1
      };
    });
    return delivery;
  }
}
module.exports = NotificationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzZW5kRW1haWwiLCJyZXF1aXJlIiwic2VuZFNNUyIsInNlbmRQdXNoIiwiTm90aWZpY2F0aW9uU2VydmljZSIsIm5vdGlmaWNhdGlvbnMiLCJzZW5kTm90aWZpY2F0aW9uIiwidXNlcklkIiwibm90aWZpY2F0aW9uRGF0YSIsIm5vdGlmIiwiaWQiLCJEYXRlIiwibm93IiwidGl0bGUiLCJtZXNzYWdlIiwiY2hhbm5lbHMiLCJwcmlvcml0eSIsImNyZWF0ZWRBdCIsInNlbnQiLCJkZWxpdmVyeVN0YXR1cyIsInVzZXIiLCJ1c2VyT2JqIiwiVXNlciIsImZpbmRCeUlkIiwibGVhbiIsImNoYW5uZWwiLCJ0byIsImVtYWlsIiwic3ViamVjdCIsInRleHQiLCJyZXN1bHQiLCJzdWNjZXNzIiwicGhvbmUiLCJzbXMiLCJ0b2tlbnMiLCJmY21Ub2tlbnMiLCJsZW5ndGgiLCJib2R5IiwicHVzaCIsImluQXBwIiwibm90aWZpY2F0aW9uSWQiLCJzZW50VG8iLCJ0aW1lc3RhbXAiLCJlcnIiLCJFcnJvciIsImdldE5vdGlmaWNhdGlvbnMiLCJsaW1pdCIsInVucmVhZE9ubHkiLCJ1c2VyTm90aWZzIiwiZmlsdGVyIiwibiIsInJlYWQiLCJjb3VudCIsInNsaWNlIiwibWFya0FzUmVhZCIsImZpbmQiLCJkZWxldGVOb3RpZmljYXRpb24iLCJkZWxldGVBbGxOb3RpZmljYXRpb25zIiwiY291bnRCZWZvcmUiLCJkZWxldGVkQ291bnQiLCJzY2hlZHVsZU5vdGlmaWNhdGlvbiIsInNjaGVkdWxlVGltZSIsInNjaGVkdWxlZEZvciIsInN0YXR1cyIsIl9zaW11bGF0ZURlbGl2ZXJ5IiwiZGVsaXZlcnkiLCJmb3JFYWNoIiwiYXR0ZW1wdHMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsibm90aWZpY2F0aW9uU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogTm90aWZpY2F0aW9uIFNlcnZpY2UgLSBNdWx0aS1jaGFubmVsIE5vdGlmaWNhdGlvbnNcclxuICovXHJcblxyXG5jb25zdCB7IHNlbmRFbWFpbCB9ID0gcmVxdWlyZSgnLi9lbWFpbFNlcnZpY2UnKTtcclxuY29uc3QgeyBzZW5kU01TIH0gPSByZXF1aXJlKCcuL3Ntc1NlcnZpY2UnKTtcclxuY29uc3QgeyBzZW5kUHVzaCB9ID0gcmVxdWlyZSgnLi9wdXNoU2VydmljZScpO1xyXG5cclxuY2xhc3MgTm90aWZpY2F0aW9uU2VydmljZSB7XHJcbiAgc3RhdGljIG5vdGlmaWNhdGlvbnMgPSBbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog2KXYsdiz2KfZhCDYpdi02LnYp9ixXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHNlbmROb3RpZmljYXRpb24odXNlcklkLCBub3RpZmljYXRpb25EYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBub3RpZiA9IHtcclxuICAgICAgICBpZDogYG5vdGlmXyR7RGF0ZS5ub3coKX1gLFxyXG4gICAgICAgIHVzZXJJZCxcclxuICAgICAgICB0aXRsZTogbm90aWZpY2F0aW9uRGF0YS50aXRsZSxcclxuICAgICAgICBtZXNzYWdlOiBub3RpZmljYXRpb25EYXRhLm1lc3NhZ2UsXHJcbiAgICAgICAgY2hhbm5lbHM6IG5vdGlmaWNhdGlvbkRhdGEuY2hhbm5lbHMgfHwgWydpbi1hcHAnXSxcclxuICAgICAgICBwcmlvcml0eTogbm90aWZpY2F0aW9uRGF0YS5wcmlvcml0eSB8fCAnbm9ybWFsJyxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgc2VudDogdHJ1ZSxcclxuICAgICAgICBkZWxpdmVyeVN0YXR1czoge30sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyDYpdix2LPYp9mEINi52KjYsSDYp9mE2YLZhtmI2KfYqiDYp9mE2YXYt9mE2YjYqNipXHJcblxyXG4gICAgICAvLyDYrNmE2Kgg2KjZitin2YbYp9iqINin2YTZhdiz2KrYrtiv2YUgKNmE2YTYrdi12YjZhCDYudmE2Ykg2KfZhNio2LHZitiv2Iwg2KfZhNis2YjYp9mE2IwgZmNtVG9rZW5zKVxyXG4gICAgICBsZXQgdXNlciA9IG5vdGlmaWNhdGlvbkRhdGEudXNlck9iajtcclxuICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlcklkKS5sZWFuKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoY29uc3QgY2hhbm5lbCBvZiBub3RpZi5jaGFubmVscykge1xyXG4gICAgICAgIGlmIChjaGFubmVsID09PSAnZW1haWwnKSB7XHJcbiAgICAgICAgICBjb25zdCB0byA9IG5vdGlmaWNhdGlvbkRhdGEuZW1haWwgfHwgKHVzZXIgJiYgdXNlci5lbWFpbCkgfHwgJ3Rlc3RAZXhhbXBsZS5jb20nO1xyXG4gICAgICAgICAgY29uc3Qgc3ViamVjdCA9IG5vdGlmLnRpdGxlO1xyXG4gICAgICAgICAgY29uc3QgdGV4dCA9IG5vdGlmLm1lc3NhZ2U7XHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZW5kRW1haWwoeyB0bywgc3ViamVjdCwgdGV4dCB9KTtcclxuICAgICAgICAgIG5vdGlmLmRlbGl2ZXJ5U3RhdHVzLmVtYWlsID0gcmVzdWx0LnN1Y2Nlc3MgPyAnc2VudCcgOiAnZmFpbGVkJztcclxuICAgICAgICB9IGVsc2UgaWYgKGNoYW5uZWwgPT09ICdzbXMnKSB7XHJcbiAgICAgICAgICBjb25zdCB0byA9IG5vdGlmaWNhdGlvbkRhdGEucGhvbmUgfHwgKHVzZXIgJiYgdXNlci5waG9uZSkgfHwgJysyMDEyMzQ1Njc4OTAnO1xyXG4gICAgICAgICAgY29uc3QgbWVzc2FnZSA9IG5vdGlmLm1lc3NhZ2U7XHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZW5kU01TKHsgdG8sIG1lc3NhZ2UgfSk7XHJcbiAgICAgICAgICBub3RpZi5kZWxpdmVyeVN0YXR1cy5zbXMgPSByZXN1bHQuc3VjY2VzcyA/ICdzZW50JyA6ICdmYWlsZWQnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoY2hhbm5lbCA9PT0gJ3B1c2gnKSB7XHJcbiAgICAgICAgICBjb25zdCB0b2tlbnMgPSAodXNlciAmJiB1c2VyLmZjbVRva2VucykgfHwgW107XHJcbiAgICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VuZFB1c2goeyB0b2tlbnMsIHRpdGxlOiBub3RpZi50aXRsZSwgYm9keTogbm90aWYubWVzc2FnZSB9KTtcclxuICAgICAgICAgICAgbm90aWYuZGVsaXZlcnlTdGF0dXMucHVzaCA9IHJlc3VsdC5zdWNjZXNzID8gJ3NlbnQnIDogJ2ZhaWxlZCc7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBub3RpZi5kZWxpdmVyeVN0YXR1cy5wdXNoID0gJ25vLXRva2Vucyc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChjaGFubmVsID09PSAnaW4tYXBwJykge1xyXG4gICAgICAgICAgbm90aWYuZGVsaXZlcnlTdGF0dXMuaW5BcHAgPSAnZGVsaXZlcmVkJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMubm90aWZpY2F0aW9ucy5wdXNoKG5vdGlmKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBub3RpZmljYXRpb25JZDogbm90aWYuaWQsXHJcbiAgICAgICAgc2VudFRvOiBub3RpZi5jaGFubmVscyxcclxuICAgICAgICBkZWxpdmVyeVN0YXR1czogbm90aWYuZGVsaXZlcnlTdGF0dXMsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm90aWZpY2F0aW9uIHNlbmQgZmFpbGVkOiAke2Vyci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYpdi02LnYp9ix2KfYqiDYp9mE2YXYs9iq2K7Yr9mFXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldE5vdGlmaWNhdGlvbnModXNlcklkLCBsaW1pdCA9IDUwLCB1bnJlYWRPbmx5ID0gZmFsc2UpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxldCB1c2VyTm90aWZzID0gdGhpcy5ub3RpZmljYXRpb25zLmZpbHRlcihuID0+IG4udXNlcklkID09PSB1c2VySWQpO1xyXG5cclxuICAgICAgaWYgKHVucmVhZE9ubHkpIHtcclxuICAgICAgICB1c2VyTm90aWZzID0gdXNlck5vdGlmcy5maWx0ZXIobiA9PiAhbi5yZWFkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGNvdW50OiB1c2VyTm90aWZzLmxlbmd0aCxcclxuICAgICAgICBub3RpZmljYXRpb25zOiB1c2VyTm90aWZzLnNsaWNlKC1saW1pdCksXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgR2V0IG5vdGlmaWNhdGlvbnMgZmFpbGVkOiAke2Vyci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2YjYtti5INi52YTYp9mF2Kkg2LnZhNmJINin2YTYpdi02LnYp9ixINmD2YXZgtix2YjYoVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBtYXJrQXNSZWFkKG5vdGlmaWNhdGlvbklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBub3RpZiA9IHRoaXMubm90aWZpY2F0aW9ucy5maW5kKG4gPT4gbi5pZCA9PT0gbm90aWZpY2F0aW9uSWQpO1xyXG4gICAgICBpZiAobm90aWYpIHtcclxuICAgICAgICBub3RpZi5yZWFkID0gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ01hcmtlZCBhcyByZWFkJyB9O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTWFyayBhcyByZWFkIGZhaWxlZDogJHtlcnIubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINit2LDZgSDYp9mE2KXYtNi52KfYsVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBkZWxldGVOb3RpZmljYXRpb24obm90aWZpY2F0aW9uSWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IHRoaXMubm90aWZpY2F0aW9ucy5maWx0ZXIobiA9PiBuLmlkICE9PSBub3RpZmljYXRpb25JZCk7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdOb3RpZmljYXRpb24gZGVsZXRlZCcgfTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERlbGV0ZSBub3RpZmljYXRpb24gZmFpbGVkOiAke2Vyci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2K3YsNmBINis2YXZiti5INil2LTYudin2LHYp9iqINin2YTZhdiz2KrYrtiv2YVcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZGVsZXRlQWxsTm90aWZpY2F0aW9ucyh1c2VySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGNvdW50QmVmb3JlID0gdGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aDtcclxuICAgICAgdGhpcy5ub3RpZmljYXRpb25zID0gdGhpcy5ub3RpZmljYXRpb25zLmZpbHRlcihuID0+IG4udXNlcklkICE9PSB1c2VySWQpO1xyXG4gICAgICBjb25zdCBkZWxldGVkQ291bnQgPSBjb3VudEJlZm9yZSAtIHRoaXMubm90aWZpY2F0aW9ucy5sZW5ndGg7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogYCR7ZGVsZXRlZENvdW50fSBub3RpZmljYXRpb25zIGRlbGV0ZWRgLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRGVsZXRlIGFsbCBub3RpZmljYXRpb25zIGZhaWxlZDogJHtlcnIubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINis2K/ZiNmE2Kkg2KXYtNi52KfYsSAo2YXYrdin2YPYp9ipKVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBzY2hlZHVsZU5vdGlmaWNhdGlvbih1c2VySWQsIG5vdGlmaWNhdGlvbkRhdGEsIHNjaGVkdWxlVGltZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdOb3RpZmljYXRpb24gc2NoZWR1bGVkJyxcclxuICAgICAgICBzY2hlZHVsZWRGb3I6IHNjaGVkdWxlVGltZSxcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBTY2hlZHVsZSBub3RpZmljYXRpb24gZmFpbGVkOiAke2Vyci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gSGVscGVyIE1ldGhvZHNcclxuICBzdGF0aWMgX3NpbXVsYXRlRGVsaXZlcnkoY2hhbm5lbHMpIHtcclxuICAgIGNvbnN0IGRlbGl2ZXJ5ID0ge307XHJcbiAgICBjaGFubmVscy5mb3JFYWNoKGNoYW5uZWwgPT4ge1xyXG4gICAgICBkZWxpdmVyeVtjaGFubmVsXSA9IHtcclxuICAgICAgICBzdGF0dXM6ICdkZWxpdmVyZWQnLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgICBhdHRlbXB0czogMSxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGRlbGl2ZXJ5O1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBOb3RpZmljYXRpb25TZXJ2aWNlO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNO0VBQUVBO0FBQVUsQ0FBQyxHQUFHQyxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDL0MsTUFBTTtFQUFFQztBQUFRLENBQUMsR0FBR0QsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUMzQyxNQUFNO0VBQUVFO0FBQVMsQ0FBQyxHQUFHRixPQUFPLENBQUMsZUFBZSxDQUFDO0FBRTdDLE1BQU1HLG1CQUFtQixDQUFDO0VBQ3hCLE9BQU9DLGFBQWEsR0FBRyxFQUFFOztFQUV6QjtBQUNGO0FBQ0E7RUFDRSxhQUFhQyxnQkFBZ0JBLENBQUNDLE1BQU0sRUFBRUMsZ0JBQWdCLEVBQUU7SUFDdEQsSUFBSTtNQUNGLE1BQU1DLEtBQUssR0FBRztRQUNaQyxFQUFFLEVBQUUsU0FBU0MsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFO1FBQ3pCTCxNQUFNO1FBQ05NLEtBQUssRUFBRUwsZ0JBQWdCLENBQUNLLEtBQUs7UUFDN0JDLE9BQU8sRUFBRU4sZ0JBQWdCLENBQUNNLE9BQU87UUFDakNDLFFBQVEsRUFBRVAsZ0JBQWdCLENBQUNPLFFBQVEsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNqREMsUUFBUSxFQUFFUixnQkFBZ0IsQ0FBQ1EsUUFBUSxJQUFJLFFBQVE7UUFDL0NDLFNBQVMsRUFBRSxJQUFJTixJQUFJLENBQUMsQ0FBQztRQUNyQk8sSUFBSSxFQUFFLElBQUk7UUFDVkMsY0FBYyxFQUFFLENBQUM7TUFDbkIsQ0FBQzs7TUFFRDs7TUFFQTtNQUNBLElBQUlDLElBQUksR0FB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