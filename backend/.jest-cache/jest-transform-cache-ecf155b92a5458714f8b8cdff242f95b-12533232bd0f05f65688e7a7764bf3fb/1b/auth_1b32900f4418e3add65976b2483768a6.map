{"version":3,"names":["express","require","router","Router","AuthService","validateRegistration","validateLogin","ApiResponse","ApiError","post","req","res","_next","name","email","password","passwordConfirm","body","status","json","success","message","data","result","registerUser","user","error","console","next","User","dbUser","findOne","select","e","debug","loginPayload","role","userId","_id","toString","login","requires2fa","sessionId","devCode","accessToken","token","headers","authorization","split","logout","verifyToken","valid","tokenValid","sendVerificationCode","code","verifyEmail","forgotPassword","newPassword","confirmPassword","resetPassword","oldPassword","changePassword","enableTwoFactor","verifyTwoFactor","put","updateProfile","get","params","getUserSessions","delete","terminateSession","module","exports"],"sources":["auth.js"],"sourcesContent":["// Authentication Routes\r\n// نقاط المصادقة والتوثيق\r\n\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst AuthService = require('../services/authService');\r\nconst { validateRegistration, validateLogin } = require('../middleware/validation');\r\nconst { ApiResponse, ApiError } = require('../utils/apiResponse');\r\n\r\n// تسجيل مستخدم جديد\r\nrouter.post('/register', validateRegistration, (req, res, _next) => {\r\n  try {\r\n    const { name, email, password, passwordConfirm } = req.body;\r\n\r\n    if (password !== passwordConfirm) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Passwords do not match',\r\n        data: {},\r\n      });\r\n    }\r\n\r\n    const result = AuthService.registerUser({ name, email, password });\r\n\r\n    return res.status(201).json({\r\n      success: true,\r\n      message: 'User registered successfully',\r\n      user: result.user,\r\n      data: { user: result.user },\r\n    });\r\n  } catch (error) {\r\n    console.error('Registration error:', error);\r\n    return res.status(500).json({\r\n      success: false,\r\n      message: 'Registration failed',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// تسجيل الدخول\r\nrouter.post('/login', validateLogin, async (req, res, next) => {\r\n  try {\r\n    const { email, password } = req.body;\r\n    const User = require('../models/User');\r\n\r\n    // Check if user exists in database\r\n    let dbUser = null;\r\n    try {\r\n      dbUser = await User.findOne({ email }).select('+password');\r\n    } catch (e) {\r\n      // User model might not be available in all environments\r\n      console.debug('Could not check database user:', e.message);\r\n    }\r\n\r\n    // If user exists in DB, include their actual role in the token\r\n    let loginPayload = { email, password };\r\n    if (dbUser) {\r\n      loginPayload.role = dbUser.role;\r\n      loginPayload.userId = dbUser._id?.toString();\r\n    }\r\n\r\n    const result = AuthService.login(loginPayload);\r\n\r\n    if (!result.success) {\r\n      return res.status(401).json({\r\n        success: false,\r\n        message: result.message || 'Invalid credentials',\r\n        data: {},\r\n      });\r\n    }\r\n\r\n    // If 2FA is required, return sessionId and do not issue token yet\r\n    if (result.requires2fa) {\r\n      return res.status(200).json({\r\n        success: true,\r\n        message: result.message || '2FA required',\r\n        requires2fa: true,\r\n        sessionId: result.sessionId,\r\n        user: result.user,\r\n        // Expose devCode only for development/testing\r\n        devCode: result.devCode,\r\n        data: { user: result.user, requires2fa: true, sessionId: result.sessionId },\r\n      });\r\n    }\r\n\r\n    return res.status(200).json({\r\n      success: true,\r\n      message: 'Login successful',\r\n      accessToken: result.token,\r\n      user: result.user,\r\n      data: { user: result.user, token: result.token },\r\n    });\r\n  } catch (error) {\r\n    console.error('Login error:', error);\r\n    return res.status(500).json({\r\n      success: false,\r\n      message: 'Login failed',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// تسجيل الخروج\r\nrouter.post('/logout', (req, res, _next) => {\r\n  try {\r\n    const token = req.headers.authorization?.split(' ')[1];\r\n\r\n    if (!token) {\r\n      return res.status(400).json({ success: false, message: 'Token required', data: {} });\r\n    }\r\n\r\n    const result = AuthService.logout(token);\r\n\r\n    return res.status(200).json({\r\n      success: true,\r\n      message: 'Logout successful',\r\n      data: result || {},\r\n    });\r\n  } catch (error) {\r\n    return res.status(500).json({ success: false, message: 'Logout failed', error: error.message });\r\n  }\r\n});\r\n\r\n// التحقق من رمز التحقق\r\nrouter.post('/verify-token', (req, res, _next) => {\r\n  try {\r\n    const token = req.headers.authorization?.split(' ')[1];\r\n\r\n    if (!token) {\r\n      return res.status(400).json({ success: false, message: 'Token required', data: {} });\r\n    }\r\n\r\n    const result = AuthService.verifyToken(token);\r\n\r\n    if (!result?.valid) {\r\n      return res\r\n        .status(401)\r\n        .json({ success: false, message: result?.error || 'Invalid token', data: {} });\r\n    }\r\n\r\n    return res.status(200).json({\r\n      success: true,\r\n      message: 'Token verified',\r\n      user: result.user,\r\n      data: { user: result.user, tokenValid: true },\r\n    });\r\n  } catch (error) {\r\n    return res\r\n      .status(500)\r\n      .json({ success: false, message: 'Token verification failed', error: error.message });\r\n  }\r\n});\r\n\r\n// إرسال كود التحقق من البريد الإلكتروني\r\nrouter.post('/send-verification-code', (req, res, next) => {\r\n  try {\r\n    const { email } = req.body;\r\n\r\n    if (!email) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'Email required'));\r\n    }\r\n\r\n    const result = AuthService.sendVerificationCode(email);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Verification code sent'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Failed to send verification code', [error.message]));\r\n  }\r\n});\r\n\r\n// التحقق من البريد الإلكتروني\r\nrouter.post('/verify-email', (req, res, next) => {\r\n  try {\r\n    const { email, code } = req.body;\r\n\r\n    if (!email || !code) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'Email and code required'));\r\n    }\r\n\r\n    const result = AuthService.verifyEmail(email, code);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Email verified'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Email verification failed', [error.message]));\r\n  }\r\n});\r\n\r\n// نسيان كلمة المرور\r\nrouter.post('/forgot-password', (req, res, next) => {\r\n  try {\r\n    const { email } = req.body;\r\n\r\n    if (!email) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'Email required'));\r\n    }\r\n\r\n    const result = AuthService.forgotPassword(email);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Recovery email sent'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Password recovery failed', [error.message]));\r\n  }\r\n});\r\n\r\n// إعادة تعيين كلمة المرور\r\nrouter.post('/reset-password', (req, res, next) => {\r\n  try {\r\n    const { token, newPassword, confirmPassword } = req.body;\r\n\r\n    if (!token || !newPassword) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'Token and new password required'));\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'Passwords do not match'));\r\n    }\r\n\r\n    const result = AuthService.resetPassword(token, newPassword);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Password reset successfully'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Password reset failed', [error.message]));\r\n  }\r\n});\r\n\r\n// تغيير كلمة المرور\r\nrouter.post('/change-password', (req, res, next) => {\r\n  try {\r\n    const { userId, oldPassword, newPassword, confirmPassword } = req.body;\r\n\r\n    if (!userId || !oldPassword || !newPassword) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'Missing required fields'));\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'Passwords do not match'));\r\n    }\r\n\r\n    const result = AuthService.changePassword(userId, oldPassword, newPassword);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Password changed successfully'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Password change failed', [error.message]));\r\n  }\r\n});\r\n\r\n// تفعيل المصادقة الثنائية\r\nrouter.post('/enable-2fa', (req, res, next) => {\r\n  try {\r\n    const { userId } = req.body;\r\n\r\n    if (!userId) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'User ID required'));\r\n    }\r\n\r\n    const result = AuthService.enableTwoFactor(userId);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, '2FA enabled'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Failed to enable 2FA', [error.message]));\r\n  }\r\n});\r\n\r\n// التحقق من المصادقة الثنائية\r\nrouter.post('/verify-2fa', (req, res, next) => {\r\n  try {\r\n    const { userId, code, sessionId } = req.body;\r\n\r\n    if (!userId || !code) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'User ID and code required'));\r\n    }\r\n\r\n    const result = AuthService.verifyTwoFactor(userId, code, sessionId);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, '2FA verified'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, '2FA verification failed', [error.message]));\r\n  }\r\n});\r\n\r\n// تحديث الملف الشخصي\r\nrouter.put('/update-profile', (req, res, next) => {\r\n  try {\r\n    const { userId, ...data } = req.body;\r\n\r\n    if (!userId) {\r\n      return res.status(400).json(new ApiResponse(400, {}, 'User ID required'));\r\n    }\r\n\r\n    const result = AuthService.updateProfile(userId, data);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Profile updated'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Profile update failed', [error.message]));\r\n  }\r\n});\r\n\r\n// الحصول على جلسات المستخدم\r\nrouter.get('/sessions/:userId', (req, res, next) => {\r\n  try {\r\n    const { userId } = req.params;\r\n\r\n    const result = AuthService.getUserSessions(userId);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Sessions fetched'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Failed to fetch sessions', [error.message]));\r\n  }\r\n});\r\n\r\n// إنهاء جلسة\r\nrouter.delete('/sessions/:userId/:sessionId', (req, res, next) => {\r\n  try {\r\n    const { userId, sessionId } = req.params;\r\n\r\n    const result = AuthService.terminateSession(userId, sessionId);\r\n\r\n    return res.status(200).json(new ApiResponse(200, result, 'Session terminated'));\r\n  } catch (error) {\r\n    return next(new ApiError(500, 'Failed to terminate session', [error.message]));\r\n  }\r\n});\r\n\r\n// الحصول على معلومات المستخدم الحالي\r\nrouter.get('/me', (req, res, next) => {\r\n  try {\r\n    const token = req.headers.authorization?.split(' ')[1];\r\n\r\n    if (!token) {\r\n      return res.status(401).json({ success: false, message: 'No token provided', data: {} });\r\n    }\r\n\r\n    const result = AuthService.verifyToken(token);\r\n\r\n    if (!result.success) {\r\n      return res.status(401).json({ success: false, message: 'Invalid token', data: {} });\r\n    }\r\n\r\n    return res.status(200).json({\r\n      success: true,\r\n      message: 'User info fetched',\r\n      user: result.user,\r\n      data: { user: result.user },\r\n    });\r\n  } catch (error) {\r\n    return res\r\n      .status(500)\r\n      .json({ success: false, message: 'Failed to fetch user info', error: error.message });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]}