{"version":3,"names":["express","require","router","Router","validator","responseFormatter","optionalAuth","registerSchema","name","required","type","minLength","maxLength","email","phone","age","min","max","password","price","category","enum","sku","pattern","description","customerId","items","totalAmount","status","post","req","res","schemaName","data","body","json","validationError","result","validate","valid","errors","success","error","serverError","field","value","rules","undefined","isValidEmail","push","isValidPhone","url","isValidUrl","length","sanitized","sanitize","get","stats","getStats","module","exports"],"sources":["validate.js"],"sourcesContent":["/**\n * Validation Routes\n * Data validation endpoints and schema management\n * Phase 10: Advanced Features\n */\n\nconst express = require('express');\nconst router = express.Router();\nconst validator = require('../services/validator');\nconst responseFormatter = require('../services/responseFormatter');\nconst { optionalAuth } = require('../middleware/auth');\n\n// Register default schemas\nvalidator.registerSchema('user', {\n  name: { required: true, type: 'string', minLength: 2, maxLength: 100 },\n  email: { required: true, type: 'email' },\n  phone: { required: false, type: 'phone' },\n  age: { required: false, type: 'number', min: 0, max: 150 },\n  password: { required: true, type: 'string', minLength: 8 },\n});\n\nvalidator.registerSchema('product', {\n  name: { required: true, type: 'string', minLength: 3, maxLength: 200 },\n  price: { required: true, type: 'number', min: 0 },\n  category: { required: true, type: 'string', enum: ['electronics', 'clothing', 'food', 'other'] },\n  sku: { required: true, type: 'string', pattern: '^[A-Z0-9]{5,10}$' },\n  description: { required: false, type: 'string', maxLength: 1000 },\n});\n\nvalidator.registerSchema('order', {\n  customerId: { required: true, type: 'string' },\n  items: { required: true, type: 'array' },\n  totalAmount: { required: true, type: 'number', min: 0 },\n  status: {\n    required: true,\n    type: 'string',\n    enum: ['pending', 'confirmed', 'shipped', 'delivered'],\n  },\n});\n\n/**\n * POST /api/validate/schema\n * Validate data against registered schema\n */\nrouter.post('/schema', optionalAuth, (req, res) => {\n  try {\n    const { schemaName, data } = req.body;\n\n    if (!schemaName || !data) {\n      return res\n        .status(400)\n        .json(\n          responseFormatter.validationError(\n            ['schemaName and data are required'],\n            'Validation failed'\n          )\n        );\n    }\n\n    const result = validator.validate(data, schemaName);\n\n    if (!result.valid) {\n      return res\n        .status(400)\n        .json(responseFormatter.validationError(result.errors, 'Data validation failed'));\n    }\n\n    res.json(responseFormatter.success({ valid: true }, 'Data validation successful'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Validation failed', error));\n  }\n});\n\n/**\n * POST /api/validate/custom\n * Validate with custom rules\n */\nrouter.post('/custom', optionalAuth, (req, res) => {\n  try {\n    const { field, value, rules } = req.body;\n\n    if (!field || value === undefined || !rules) {\n      return res\n        .status(400)\n        .json(responseFormatter.validationError('field, value, and rules are required'));\n    }\n\n    const errors = [];\n\n    if (rules.email && !validator.isValidEmail(value)) {\n      errors.push('Invalid email format');\n    }\n\n    if (rules.phone && !validator.isValidPhone(value)) {\n      errors.push('Invalid phone format');\n    }\n\n    if (rules.url && !validator.isValidUrl(value)) {\n      errors.push('Invalid URL format');\n    }\n\n    if (rules.minLength && value.length < rules.minLength) {\n      errors.push(`Minimum length is ${rules.minLength}`);\n    }\n\n    if (rules.maxLength && value.length > rules.maxLength) {\n      errors.push(`Maximum length is ${rules.maxLength}`);\n    }\n\n    if (errors.length > 0) {\n      return res.status(400).json(responseFormatter.validationError(errors));\n    }\n\n    res.json(responseFormatter.success(null, 'Validation passed'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Custom validation failed', error));\n  }\n});\n\n/**\n * POST /api/validate/sanitize\n * Sanitize input data\n */\nrouter.post('/sanitize', optionalAuth, (req, res) => {\n  try {\n    const { data } = req.body;\n\n    if (!data) {\n      return res.status(400).json(responseFormatter.validationError('data is required'));\n    }\n\n    const sanitized = validator.sanitize(data);\n\n    res.json(responseFormatter.success({ data: sanitized }, 'Data sanitized'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Sanitization failed', error));\n  }\n});\n\n/**\n * GET /api/validate/schemas\n * List registered schemas\n */\nrouter.get('/schemas', optionalAuth, (req, res) => {\n  try {\n    const stats = validator.getStats();\n\n    res.json(responseFormatter.success(stats, 'Registered schemas'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Failed to retrieve schemas', error));\n  }\n});\n\n/**\n * POST /api/validate/email\n * Validate email\n */\nrouter.post('/email', optionalAuth, (req, res) => {\n  try {\n    const { email } = req.body;\n\n    if (!email) {\n      return res.status(400).json(responseFormatter.validationError('email is required'));\n    }\n\n    const valid = validator.isValidEmail(email);\n\n    res.json(\n      responseFormatter.success({ email, valid }, valid ? 'Email is valid' : 'Email is invalid')\n    );\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Email validation failed', error));\n  }\n});\n\n/**\n * POST /api/validate/phone\n * Validate phone number\n */\nrouter.post('/phone', optionalAuth, (req, res) => {\n  try {\n    const { phone } = req.body;\n\n    if (!phone) {\n      return res.status(400).json(responseFormatter.validationError('phone is required'));\n    }\n\n    const valid = validator.isValidPhone(phone);\n\n    res.json(\n      responseFormatter.success({ phone, valid }, valid ? 'Phone is valid' : 'Phone is invalid')\n    );\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Phone validation failed', error));\n  }\n});\n\n/**\n * POST /api/validate/url\n * Validate URL\n */\nrouter.post('/url', optionalAuth, (req, res) => {\n  try {\n    const { url } = req.body;\n\n    if (!url) {\n      return res.status(400).json(responseFormatter.validationError('url is required'));\n    }\n\n    const valid = validator.isValidUrl(url);\n\n    res.json(responseFormatter.success({ url, valid }, valid ? 'URL is valid' : 'URL is invalid'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('URL validation failed', error));\n  }\n});\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]}