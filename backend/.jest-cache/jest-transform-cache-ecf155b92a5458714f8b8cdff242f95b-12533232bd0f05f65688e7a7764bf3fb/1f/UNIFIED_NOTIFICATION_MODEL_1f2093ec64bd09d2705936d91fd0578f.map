{"version":3,"names":["mongoose","require","moment","notificationSchema","Schema","recipientId","type","Types","ObjectId","ref","required","userId","recipient","recipientEmail","String","recipientPhone","notificationId","unique","sparse","enum","default","title","trim","message","description","icon","color","link","actionUrl","actionLabel","actions","label","url","isRead","Boolean","read","readAt","Date","archived","archiveStatus","archiveId","archivedAt","status","sentAt","deliveredAt","signatureStatus","signatureId","stampStatus","stampId","sentViaWebSocket","channels","channelStatus","channel","failureReason","deliveryId","priority","isUrgent","requiresAction","category","tags","relatedEntityType","relatedEntityId","scheduledFor","expiresAt","respectQuietHours","templateId","templateName","variableData","Mixed","metadata","meta","userPreferencesApplied","favorite","snoozed","snoozedUntil","openCount","Number","clickCount","bounceCount","retryCount","lastRetryAt","campaignId","campaignName","batchId","unsubscribeToken","isUnsubscribed","unsubscribedAt","conversionTracking","converted","conversionDate","conversionValue","senderId","createdBy","sentBy","ipAddress","userAgent","serialNumber","barcode","deletedAt","timestamps","expires","index","createdAt","expireAfterSeconds","$in","virtual","get","undefined","diff","isBefore","now","seconds","Math","floor","minutes","hours","days","pre","next","colorMap","info","success","warning","error","system","task","reminder","INFO","WARNING","SUCCESS","ERROR","random","toString","substr","methods","markAsRead","save","markAsUnread","markAsDelivered","find","cs","recordClick","markAsFailed","reason","push","retry","trackConversion","value","unsubscribe","archive","softDelete","statics","getUnread","$or","$exists","sort","getPending","$lte","getFailed","retryThreshold","$lt","getByType","getHighImpactInsights","limit","getActiveModels","getModelsNeedingRetraining","getDeliveryStats","sinceDate","subtract","toDate","aggregate","$match","$gte","$group","_id","total","$sum","sent","$cond","$eq","delivered","failed","opened","clicked","$gt","avgRetries","$avg","deliveryRate","$divide","openRate","clickRate","createNotification","data","notification","createBulkNotifications","recipientIds","notificationData","notifications","map","insertMany","deleteOldNotifications","cutoffDate","setDate","getDate","deleteMany","Notification","models","model","module","exports"],"sources":["UNIFIED_NOTIFICATION_MODEL.js"],"sourcesContent":["/**\r\n * UNIFIED NOTIFICATION MODEL\r\n * Consolidated from 4 different notification schemas across the system\r\n * Combines features from: erp_new_system, backend, alawael-erp, and supply-chain-management\r\n * \r\n * This is the CANONICAL notification model for the entire system.\r\n * All backends should reference this file to prevent model registration conflicts.\r\n */\r\n\r\nconst mongoose = require('mongoose');\r\nconst moment = require('moment');\r\n\r\nconst notificationSchema = new mongoose.Schema(\r\n  {\r\n    // ==================== RECIPIENT FIELDS (Support all variants for compatibility) ====================\r\n    \r\n    // Primary recipient reference (unified field)\r\n    recipientId: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: 'User',\r\n      required: true,\r\n    },\r\n\r\n    // Legacy aliases for backward compatibility\r\n    userId: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: 'User',\r\n    },\r\n    recipient: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: 'User',\r\n    },\r\n\r\n    recipientEmail: String,\r\n    recipientPhone: String,\r\n\r\n    // ==================== CORE NOTIFICATION FIELDS ====================\r\n\r\n    // Unique notification identifier\r\n    notificationId: {\r\n      type: String,\r\n      unique: true,\r\n      sparse: true,\r\n    },\r\n\r\n    // Notification type (comprehensive enum combining all systems)\r\n    type: {\r\n      type: String,\r\n      enum: [\r\n        // ERP/Business types\r\n        'payment_confirmation',\r\n        'invoice_reminder',\r\n        'budget_alert',\r\n        'document_shared',\r\n        'order_update',\r\n        'task_assigned',\r\n        'deadline_reminder',\r\n        'promotion',\r\n        // Basic types\r\n        'info',\r\n        'success',\r\n        'warning',\r\n        'error',\r\n        'system',\r\n        'message',\r\n        'task',\r\n        'reminder',\r\n        // Legacy capitalized variants\r\n        'INFO',\r\n        'WARNING',\r\n        'SUCCESS',\r\n        'ERROR',\r\n        'TASK',\r\n        'MESSAGE',\r\n      ],\r\n      default: 'info',\r\n    },\r\n\r\n    // Title and message\r\n    title: {\r\n      type: String,\r\n      required: true,\r\n      trim: true,\r\n    },\r\n\r\n    message: {\r\n      type: String,\r\n      required: true,\r\n      trim: true,\r\n    },\r\n\r\n    description: String,\r\n\r\n    // ==================== VISUAL/DISPLAY FIELDS ====================\r\n\r\n    icon: {\r\n      type: String,\r\n      default: 'NotificationsIcon',\r\n    },\r\n\r\n    color: {\r\n      type: String,\r\n      default: '#1976d2',\r\n    },\r\n\r\n    link: String,\r\n\r\n    actionUrl: String,\r\n    actionLabel: String,\r\n\r\n    // Action buttons\r\n    actions: [\r\n      {\r\n        label: String,\r\n        url: String,\r\n        type: String,\r\n      },\r\n    ],\r\n\r\n    // ==================== STATUS FIELDS ====================\r\n\r\n    // Read status (support both variants)\r\n    isRead: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    read: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    readAt: Date,\r\n\r\n    // Archive status\r\n    archived: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    archiveStatus: {\r\n      type: String,\r\n      enum: ['pending', 'archived', 'failed'],\r\n      default: 'pending',\r\n    },\r\n    archiveId: String,\r\n    archivedAt: Date,\r\n\r\n    // Delivery status\r\n    status: {\r\n      type: String,\r\n      enum: ['scheduled', 'pending', 'sending', 'sent', 'delivered', 'failed', 'bounced', 'unopened'],\r\n      default: 'pending',\r\n    },\r\n\r\n    sentAt: Date,\r\n    deliveredAt: Date,\r\n\r\n    // ==================== ADVANCED STATUS FIELDS ====================\r\n\r\n    // Electronic signatures and stamps\r\n    signatureStatus: {\r\n      type: String,\r\n      enum: ['none', 'pending', 'signed', 'failed'],\r\n      default: 'none',\r\n    },\r\n    signatureId: String,\r\n\r\n    stampStatus: {\r\n      type: String,\r\n      enum: ['none', 'pending', 'stamped', 'failed'],\r\n      default: 'none',\r\n    },\r\n    stampId: String,\r\n\r\n    // WebSocket delivery\r\n    sentViaWebSocket: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    // ==================== MULTI-CHANNEL DELIVERY ====================\r\n\r\n    // Notification channels\r\n    channels: [\r\n      {\r\n        type: String,\r\n        enum: ['email', 'sms', 'push', 'in_app', 'slack', 'webhook'],\r\n      },\r\n    ],\r\n\r\n    // Per-channel status\r\n    channelStatus: [\r\n      {\r\n        channel: {\r\n          type: String,\r\n          enum: ['email', 'sms', 'push', 'in_app', 'slack', 'webhook'],\r\n        },\r\n        status: {\r\n          type: String,\r\n          enum: ['pending', 'sent', 'failed', 'bounced', 'delivered'],\r\n        },\r\n        sentAt: Date,\r\n        failureReason: String,\r\n        deliveryId: String,\r\n      },\r\n    ],\r\n\r\n    // ==================== PRIORITY & URGENCY ====================\r\n\r\n    priority: {\r\n      type: String,\r\n      enum: ['low', 'normal', 'high', 'critical', 'urgent'],\r\n      default: 'normal',\r\n    },\r\n\r\n    isUrgent: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    requiresAction: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    // ==================== CATEGORIZATION ====================\r\n\r\n    category: {\r\n      type: String,\r\n      default: 'general',\r\n    },\r\n\r\n    tags: [String],\r\n\r\n    relatedEntityType: String, // 'invoice', 'payment', 'budget', 'document', etc.\r\n    relatedEntityId: mongoose.Schema.Types.ObjectId,\r\n\r\n    // ==================== SCHEDULING ====================\r\n\r\n    scheduledFor: Date,\r\n\r\n    expiresAt: Date,\r\n\r\n    respectQuietHours: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n\r\n    // ==================== TEMPLATE & VARIABLES ====================\r\n\r\n    templateId: mongoose.Schema.Types.ObjectId,\r\n    templateName: String,\r\n\r\n    variableData: {\r\n      type: mongoose.Schema.Types.Mixed,\r\n      default: {},\r\n    },\r\n\r\n    metadata: {\r\n      type: mongoose.Schema.Types.Mixed,\r\n      default: {},\r\n    },\r\n\r\n    meta: {\r\n      type: mongoose.Schema.Types.Mixed,\r\n    },\r\n\r\n    // ==================== USER PREFERENCES ====================\r\n\r\n    userPreferencesApplied: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n\r\n    favorite: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    snoozed: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    snoozedUntil: Date,\r\n\r\n    // ==================== TRACKING METRICS ====================\r\n\r\n    openCount: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n\r\n    clickCount: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n\r\n    bounceCount: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n\r\n    retryCount: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n\r\n    lastRetryAt: Date,\r\n\r\n    // ==================== CAMPAIGN TRACKING ====================\r\n\r\n    campaignId: mongoose.Schema.Types.ObjectId,\r\n    campaignName: String,\r\n    batchId: String,\r\n\r\n    // ==================== UNSUBSCRIBE MANAGEMENT ====================\r\n\r\n    unsubscribeToken: String,\r\n    isUnsubscribed: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    unsubscribedAt: Date,\r\n\r\n    // ==================== CONVERSION TRACKING ====================\r\n\r\n    conversionTracking: {\r\n      converted: Boolean,\r\n      conversionDate: Date,\r\n      conversionValue: Number,\r\n    },\r\n\r\n    // ==================== AUDIT TRAIL ====================\r\n\r\n    senderId: mongoose.Schema.Types.ObjectId,\r\n    createdBy: mongoose.Schema.Types.ObjectId,\r\n    sentBy: String, // Service name\r\n\r\n    ipAddress: String,\r\n    userAgent: String,\r\n\r\n    // ==================== SPECIAL FIELDS ====================\r\n\r\n    serialNumber: {\r\n      type: String,\r\n      unique: true,\r\n      sparse: true,\r\n    },\r\n\r\n    barcode: String,\r\n\r\n    // ==================== SOFT DELETE ====================\r\n\r\n    deletedAt: {\r\n      type: Date,\r\n      default: null,\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n    // TTL index for 30 days auto-delete\r\n    expires: 2592000,\r\n  }\r\n);\r\n\r\n// ==================== INDEXES FOR PERFORMANCE ====================\r\n\r\n// Core lookups\r\nnotificationSchema.index({ recipientId: 1, isRead: 1, createdAt: -1 });\r\nnotificationSchema.index({ recipientId: 1, createdAt: -1 });\r\nnotificationSchema.index({ userId: 1, isRead: 1 });\r\nnotificationSchema.index({ recipient: 1, isRead: 1, createdAt: -1 });\r\n\r\n// Status queries\r\nnotificationSchema.index({ status: 1, recipientId: 1 });\r\nnotificationSchema.index({ type: 1, status: 1 });\r\n\r\n// Scheduling and expiration\r\nnotificationSchema.index({ scheduledFor: 1 });\r\nnotificationSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 });\r\n\r\n// Campaign and entity tracking\r\nnotificationSchema.index({ campaignId: 1 });\r\nnotificationSchema.index({ relatedEntityId: 1 });\r\n\r\n// Delivery and retry\r\nnotificationSchema.index({ sentAt: 1, deliveredAt: 1 });\r\nnotificationSchema.index({ status: { $in: ['pending', 'scheduled'] } });\r\n\r\n// ==================== VIRTUALS ====================\r\n\r\n/**\r\n * Check if notification is read\r\n */\r\nnotificationSchema.virtual('isReadVirtual').get(function () {\r\n  return this.readAt !== undefined && this.readAt !== null;\r\n});\r\n\r\n/**\r\n * Time until scheduled send\r\n */\r\nnotificationSchema.virtual('timeUntilSend').get(function () {\r\n  if (!this.scheduledFor) return 0;\r\n  return moment(this.scheduledFor).diff(moment(), 'seconds');\r\n});\r\n\r\n/**\r\n * Is scheduled in past\r\n */\r\nnotificationSchema.virtual('isScheduledInPast').get(function () {\r\n  if (!this.scheduledFor) return false;\r\n  return moment(this.scheduledFor).isBefore(moment());\r\n});\r\n\r\n/**\r\n * Time ago (Arabic and English)\r\n */\r\nnotificationSchema.virtual('timeAgo').get(function () {\r\n  const now = new Date();\r\n  const diff = now - this.createdAt;\r\n  const seconds = Math.floor(diff / 1000);\r\n  const minutes = Math.floor(seconds / 60);\r\n  const hours = Math.floor(minutes / 60);\r\n  const days = Math.floor(hours / 24);\r\n\r\n  if (days > 0) return `منذ ${days} يوم`;\r\n  if (hours > 0) return `منذ ${hours} ساعة`;\r\n  if (minutes > 0) return `منذ ${minutes} دقيقة`;\r\n  return 'الآن';\r\n});\r\n\r\n/**\r\n * Days since sent\r\n */\r\nnotificationSchema.virtual('daysSinceSent').get(function () {\r\n  if (!this.sentAt) return 0;\r\n  return moment().diff(moment(this.sentAt), 'days');\r\n});\r\n\r\n// ==================== PRE-SAVE MIDDLEWARE ====================\r\n\r\nnotificationSchema.pre('save', function (next) {\r\n  // Synchronize userId/recipient/recipientId fields\r\n  if (this.recipientId && !this.userId) {\r\n    this.userId = this.recipientId;\r\n  }\r\n  if (this.recipientId && !this.recipient) {\r\n    this.recipient = this.recipientId;\r\n  }\r\n  if (this.userId && !this.recipientId) {\r\n    this.recipientId = this.userId;\r\n  }\r\n  if (this.recipient && !this.recipientId) {\r\n    this.recipientId = this.recipient;\r\n  }\r\n\r\n  // Synchronize read/isRead fields\r\n  if (this.read !== undefined) {\r\n    this.isRead = this.read;\r\n  }\r\n  if (this.isRead !== undefined) {\r\n    this.read = this.isRead;\r\n  }\r\n\r\n  // Set default color based on type\r\n  if (!this.color) {\r\n    const colorMap = {\r\n      info: '#1976d2',\r\n      success: '#2e7d32',\r\n      warning: '#ed6c02',\r\n      error: '#d32f2f',\r\n      system: '#9c27b0',\r\n      message: '#0288d1',\r\n      task: '#f57c00',\r\n      reminder: '#7b1fa2',\r\n      INFO: '#1976d2',\r\n      WARNING: '#ed6c02',\r\n      SUCCESS: '#2e7d32',\r\n      ERROR: '#d32f2f',\r\n    };\r\n    this.color = colorMap[this.type] || '#1976d2';\r\n  }\r\n\r\n  // Initialize notificationId if not set\r\n  if (!this.notificationId) {\r\n    this.notificationId = `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  next();\r\n});\r\n\r\n// ==================== INSTANCE METHODS ====================\r\n\r\n/**\r\n * Mark as read\r\n */\r\nnotificationSchema.methods.markAsRead = async function () {\r\n  this.isRead = true;\r\n  this.read = true;\r\n  this.readAt = new Date();\r\n  return await this.save();\r\n};\r\n\r\n/**\r\n * Mark as unread\r\n */\r\nnotificationSchema.methods.markAsUnread = async function () {\r\n  this.isRead = false;\r\n  this.read = false;\r\n  this.readAt = null;\r\n  return await this.save();\r\n};\r\n\r\n/**\r\n * Mark as delivered\r\n */\r\nnotificationSchema.methods.markAsDelivered = function (channel) {\r\n  this.deliveredAt = new Date();\r\n  this.status = 'delivered';\r\n\r\n  if (channel && this.channelStatus) {\r\n    const channelStatus = this.channelStatus.find(cs => cs.channel === channel);\r\n    if (channelStatus) {\r\n      channelStatus.status = 'delivered';\r\n      channelStatus.deliveryId = `DEL-${Date.now()}`;\r\n    }\r\n  }\r\n  return this.save();\r\n};\r\n\r\n/**\r\n * Record click\r\n */\r\nnotificationSchema.methods.recordClick = function () {\r\n  this.clickCount = (this.clickCount || 0) + 1;\r\n  return this.save();\r\n};\r\n\r\n/**\r\n * Mark as failed\r\n */\r\nnotificationSchema.methods.markAsFailed = function (channel, reason) {\r\n  this.status = 'failed';\r\n\r\n  if (channel && this.channelStatus) {\r\n    const channelStatus = this.channelStatus.find(cs => cs.channel === channel);\r\n    if (channelStatus) {\r\n      channelStatus.status = 'failed';\r\n      channelStatus.failureReason = reason;\r\n    } else {\r\n      this.channelStatus.push({\r\n        channel,\r\n        status: 'failed',\r\n        failureReason: reason,\r\n      });\r\n    }\r\n  }\r\n  return this.save();\r\n};\r\n\r\n/**\r\n * Retry sending\r\n */\r\nnotificationSchema.methods.retry = function () {\r\n  this.retryCount = (this.retryCount || 0) + 1;\r\n  this.lastRetryAt = new Date();\r\n  this.status = 'pending';\r\n  return this.save();\r\n};\r\n\r\n/**\r\n * Track conversion\r\n */\r\nnotificationSchema.methods.trackConversion = function (value = 0) {\r\n  this.conversionTracking = {\r\n    converted: true,\r\n    conversionDate: new Date(),\r\n    conversionValue: value,\r\n  };\r\n  return this.save();\r\n};\r\n\r\n/**\r\n * Unsubscribe\r\n */\r\nnotificationSchema.methods.unsubscribe = function () {\r\n  this.isUnsubscribed = true;\r\n  this.unsubscribedAt = new Date();\r\n  return this.save();\r\n};\r\n\r\n/**\r\n * Archive notification\r\n */\r\nnotificationSchema.methods.archive = function () {\r\n  this.archived = true;\r\n  this.archiveStatus = 'archived';\r\n  this.archivedAt = new Date();\r\n  return this.save();\r\n};\r\n\r\n/**\r\n * Soft delete\r\n */\r\nnotificationSchema.methods.softDelete = function () {\r\n  this.deletedAt = new Date();\r\n  return this.save();\r\n};\r\n\r\n// ==================== STATIC METHODS ====================\r\n\r\n/**\r\n * Get unread notifications\r\n */\r\nnotificationSchema.statics.getUnread = function (recipientId) {\r\n  return this.find({\r\n    $or: [\r\n      { recipientId },\r\n      { userId: recipientId },\r\n      { recipient: recipientId },\r\n    ],\r\n    readAt: { $exists: false },\r\n    isRead: false,\r\n    deletedAt: null,\r\n  }).sort({ createdAt: -1 });\r\n};\r\n\r\n/**\r\n * Get pending notifications to send\r\n */\r\nnotificationSchema.statics.getPending = function () {\r\n  return this.find({\r\n    status: { $in: ['pending', 'scheduled'] },\r\n    $or: [\r\n      { scheduledFor: { $lte: new Date() } },\r\n      { scheduledFor: { $exists: false } },\r\n    ],\r\n    deletedAt: null,\r\n  }).sort({ scheduledFor: 1 });\r\n};\r\n\r\n/**\r\n * Get failed notifications\r\n */\r\nnotificationSchema.statics.getFailed = function (retryThreshold = 3) {\r\n  return this.find({\r\n    status: 'failed',\r\n    retryCount: { $lt: retryThreshold },\r\n    deletedAt: null,\r\n  });\r\n};\r\n\r\n/**\r\n * Get notifications by type\r\n */\r\nnotificationSchema.statics.getByType = function (recipientId, type) {\r\n  return this.find({\r\n    $or: [\r\n      { recipientId },\r\n      { userId: recipientId },\r\n      { recipient: recipientId },\r\n    ],\r\n    type,\r\n    deletedAt: null,\r\n  }).sort({ createdAt: -1 });\r\n};\r\n\r\n/**\r\n * Get high impact insights\r\n */\r\nnotificationSchema.statics.getHighImpactInsights = function (limit = 10) {\r\n  return this.find({\r\n    priority: { $in: ['high', 'critical', 'urgent'] },\r\n    deletedAt: null,\r\n  })\r\n    .limit(limit)\r\n    .sort({ createdAt: -1 });\r\n};\r\n\r\n/**\r\n * Get active models\r\n */\r\nnotificationSchema.statics.getActiveModels = function () {\r\n  return this.find({\r\n    status: 'sent',\r\n    deletedAt: null,\r\n  }).sort({ createdAt: -1 });\r\n};\r\n\r\n/**\r\n * Get models needing retraining\r\n */\r\nnotificationSchema.statics.getModelsNeedingRetraining = function () {\r\n  return this.find({\r\n    status: 'failed',\r\n    retryCount: { $lt: 3 },\r\n    deletedAt: null,\r\n  });\r\n};\r\n\r\n/**\r\n * Calculate delivery rate\r\n */\r\nnotificationSchema.statics.getDeliveryStats = function (hours = 24) {\r\n  const sinceDate = moment().subtract(hours, 'hours').toDate();\r\n  return this.aggregate([\r\n    {\r\n      $match: {\r\n        createdAt: { $gte: sinceDate },\r\n        deletedAt: null,\r\n      },\r\n    },\r\n    {\r\n      $group: {\r\n        _id: null,\r\n        total: { $sum: 1 },\r\n        sent: { $sum: { $cond: [{ $eq: ['$status', 'sent'] }, 1, 0] } },\r\n        delivered: { $sum: { $cond: [{ $eq: ['$status', 'delivered'] }, 1, 0] } },\r\n        failed: { $sum: { $cond: [{ $eq: ['$status', 'failed'] }, 1, 0] } },\r\n        opened: { $sum: { $cond: ['$readAt', 1, 0] } },\r\n        clicked: { $sum: { $cond: [{ $gt: ['$clickCount', 0] }, 1, 0] } },\r\n        avgRetries: { $avg: '$retryCount' },\r\n        deliveryRate: {\r\n          $cond: [\r\n            { $gt: ['$total', 0] },\r\n            { $divide: ['$delivered', '$total'] },\r\n            0,\r\n          ],\r\n        },\r\n        openRate: {\r\n          $cond: [\r\n            { $gt: ['$total', 0] },\r\n            { $divide: ['$opened', '$total'] },\r\n            0,\r\n          ],\r\n        },\r\n        clickRate: {\r\n          $cond: [\r\n            { $gt: ['$total', 0] },\r\n            { $divide: ['$clicked', '$total'] },\r\n            0,\r\n          ],\r\n        },\r\n      },\r\n    },\r\n  ]);\r\n};\r\n\r\n/**\r\n * Create notification\r\n */\r\nnotificationSchema.statics.createNotification = async function (data) {\r\n  const notification = new this(data);\r\n  return await notification.save();\r\n};\r\n\r\n/**\r\n * Create bulk notifications\r\n */\r\nnotificationSchema.statics.createBulkNotifications = async function (\r\n  recipientIds,\r\n  notificationData\r\n) {\r\n  const notifications = recipientIds.map(recipientId => ({\r\n    ...notificationData,\r\n    recipientId,\r\n  }));\r\n  return await this.insertMany(notifications);\r\n};\r\n\r\n/**\r\n * Delete old notifications\r\n */\r\nnotificationSchema.statics.deleteOldNotifications = async function (days = 30) {\r\n  const cutoffDate = new Date();\r\n  cutoffDate.setDate(cutoffDate.getDate() - days);\r\n\r\n  return await this.deleteMany({\r\n    createdAt: { $lt: cutoffDate },\r\n    isRead: true,\r\n  });\r\n};\r\n\r\n/**\r\n * Safety: Prevent model recompilation in tests and multiple requires\r\n * This is critical for preventing duplicate model registration\r\n */\r\nconst Notification =\r\n  mongoose.models.Notification || mongoose.model('Notification', notificationSchema);\r\n\r\nmodule.exports = Notification;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AACpC,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAQ,CAAC;AAEhC,MAAME,kBAAkB,GAAG,IAAIH,QAAQ,CAACI,MAAM,CAC5C;EACE;;EAEA;EACAC,WAAW,EAAE;IACXC,IAAI,EAAEN,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,MAAM;IACXC,QAAQ,EAAE;EACZ,CAAC;EAED;EACAC,MAAM,EAAE;IACNL,IAAI,EAAEN,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE;EACP,CAAC;EACDG,SAAS,EAAE;IACTN,IAAI,EAAEN,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE;EACP,CAAC;EAEDI,cAAc,EAAEC,MAAM;EACtBC,cAAc,EAAED,MAAM;EAEtB;;EAEA;EACAE,cAAc,EAAE;IACdV,IAAI,EAAEQ,MAAM;IACZG,MAAM,EAAE,IAAI;IACZC,MAAM,EAAE;EACV,CAAC;EAED;EACAZ,IAAI,EAAE;IACJA,IAAI,EAAEQ,MAAM;IACZK,IAAI,EAAE;IACJ;IACA,sBAAsB,EACtB,kBAAkB,EAClB,cAAc,EACd,iBAAiB,EACjB,cAAc,EACd,eAAe,EACf,mBAAmB,EACnB,WAAW;IACX;IACA,MAAM,EACN,SAAS,EACT,SAAS,EACT,OAAO,EACP,QAAQ,EACR,SAAS,EACT,MAAM,EACN,UAAU;IACV;IACA,MAAM,EACN,SAAS,EACT,SAAS,EACT,OAAO,EACP,MAAM,EACN,SAAS,CACV;IACDC,OAAO,EAAE;EACX,CAAC;EAED;EACAC,KAAK,EAAE;IACLf,IAAI,EAAEQ,MAAM;IACZJ,QAAQ,EAAE,IAAI;IACdY,IAAI,EAAE;EACR,CAAC;EAEDC,OAAO,EAAE;IACPjB,IAAI,EAAEQ,MAAM;IACZJ,QAAQ,EAAE,IAAI;IACdY,IAAI,EAAE;EACR,CAAC;EAEDE,WAAW,EAAEV,MAAM;EAEnB;;EAEAW,IAAI,EAAE;IACJnB,IAAI,EAAEQ,MAAM;IACZM,OAAO,EAAE;EACX,CAAC;EAEDM,KAAK,EAAE;IACLpB,IAAI,EAAEQ,MAAM;IACZM,OAAO,EAAE;EACX,CAAC;EAEDO,IAAI,EAAEb,MAAM;EAEZc,SAAS,EAAEd,MAAM;EACjBe,WAAW,EAAEf,MAAM;EAEnB;EACAgB,OAAO,EAAE,CACP;IACEC,KAAK,EAAEjB,MAAM;IACbkB,GAAG,EAAElB,MAAM;IACXR,IAAI,EAAEQ;EACR,CAAC,CACF;EAED;;EAEA;EACAmB,MAAM,EAAE;IACN3B,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EACDe,IAAI,EAAE;IACJ7B,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EAEDgB,MAAM,EAAEC,IAAI;EAEZ;EACAC,QAAQ,EAAE;IACRhC,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EACDmB,aAAa,EAAE;IACbjC,IAAI,EAAEQ,MAAM;IACZK,IAAI,EAAE,CAAC,SAAS,EAAE,UAAU,EAAE,QAAQ,CAAC;IACvCC,OAAO,EAAE;EACX,CAAC;EACDoB,SAAS,EAAE1B,MAAM;EACjB2B,UAAU,EAAEJ,IAAI;EAEhB;EACAK,MAAM,EAAE;IACNpC,IAAI,EAAEQ,MAAM;IACZK,IAAI,EAAE,CAAC,WAAW,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE,WAAW,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,CAAC;IAC/FC,OAAO,EAAE;EACX,CAAC;EAEDuB,MAAM,EAAEN,IAAI;EACZO,WAAW,EAAEP,IAAI;EAEjB;;EAEA;EACAQ,eAAe,EAAE;IACfvC,IAAI,EAAEQ,MAAM;IACZK,IAAI,EAAE,CAAC,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,CAAC;IAC7CC,OAAO,EAAE;EACX,CAAC;EACD0B,WAAW,EAAEhC,MAAM;EAEnBiC,WAAW,EAAE;IACXzC,IAAI,EAAEQ,MAAM;IACZK,IAAI,EAAE,CAAC,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,QAAQ,CAAC;IAC9CC,OAAO,EAAE;EACX,CAAC;EACD4B,OAAO,EAAElC,MAAM;EAEf;EACAmC,gBAAgB,EAAE;IAChB3C,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EAED;;EAEA;EACA8B,QAAQ,EAAE,CACR;IACE5C,IAAI,EAAEQ,MAAM;IACZK,IAAI,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS;EAC7D,CAAC,CACF;EAED;EACAgC,aAAa,EAAE,CACb;IACEC,OAAO,EAAE;MACP9C,IAAI,EAAEQ,MAAM;MACZK,IAAI,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS;IAC7D,CAAC;IACDuB,MAAM,EAAE;MACNpC,IAAI,EAAEQ,MAAM;MACZK,IAAI,EAAE,CAAC,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,WAAW;IAC5D,CAAC;IACDwB,MAAM,EAAEN,IAAI;IACZgB,aAAa,EAAEvC,MAAM;IACrBwC,UAAU,EAAExC;EACd,CAAC,CACF;EAED;;EAEAyC,QAAQ,EAAE;IACRjD,IAAI,EAAEQ,MAAM;IACZK,IAAI,EAAE,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE,UAAU,EAAE,QAAQ,CAAC;IACrDC,OAAO,EAAE;EACX,CAAC;EAEDoC,QAAQ,EAAE;IACRlD,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EAEDqC,cAAc,EAAE;IACdnD,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EAED;;EAEAsC,QAAQ,EAAE;IACRpD,IAAI,EAAEQ,MAAM;IACZM,OAAO,EAAE;EACX,CAAC;EAEDuC,IAAI,EAAE,CAAC7C,MAAM,CAAC;EAEd8C,iBAAiB,EAAE9C,MAAM;EAAE;EAC3B+C,eAAe,EAAE7D,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;EAE/C;;EAEAsD,YAAY,EAAEzB,IAAI;EAElB0B,SAAS,EAAE1B,IAAI;EAEf2B,iBAAiB,EAAE;IACjB1D,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EAED;;EAEA6C,UAAU,EAAEjE,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;EAC1C0D,YAAY,EAAEpD,MAAM;EAEpBqD,YAAY,EAAE;IACZ7D,IAAI,EAAEN,QAAQ,CAACI,MAAM,CAACG,KAAK,CAAC6D,KAAK;IACjChD,OAAO,EAAE,CAAC;EACZ,CAAC;EAEDiD,QAAQ,EAAE;IACR/D,IAAI,EAAEN,QAAQ,CAACI,MAAM,CAACG,KAAK,CAAC6D,KAAK;IACjChD,OAAO,EAAE,CAAC;EACZ,CAAC;EAEDkD,IAAI,EAAE;IACJhE,IAAI,EAAEN,QAAQ,CAACI,MAAM,CAACG,KAAK,CAAC6D;EAC9B,CAAC;EAED;;EAEAG,sBAAsB,EAAE;IACtBjE,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EAEDoD,QAAQ,EAAE;IACRlE,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EAEDqD,OAAO,EAAE;IACPnE,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EACDsD,YAAY,EAAErC,IAAI;EAElB;;EAEAsC,SAAS,EAAE;IACTrE,IAAI,EAAEsE,MAAM;IACZxD,OAAO,EAAE;EACX,CAAC;EAEDyD,UAAU,EAAE;IACVvE,IAAI,EAAEsE,MAAM;IACZxD,OAAO,EAAE;EACX,CAAC;EAED0D,WAAW,EAAE;IACXxE,IAAI,EAAEsE,MAAM;IACZxD,OAAO,EAAE;EACX,CAAC;EAED2D,UAAU,EAAE;IACVzE,IAAI,EAAEsE,MAAM;IACZxD,OAAO,EAAE;EACX,CAAC;EAED4D,WAAW,EAAE3C,IAAI;EAEjB;;EAEA4C,UAAU,EAAEjF,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;EAC1C0E,YAAY,EAAEpE,MAAM;EACpBqE,OAAO,EAAErE,MAAM;EAEf;;EAEAsE,gBAAgB,EAAEtE,MAAM;EACxBuE,cAAc,EAAE;IACd/E,IAAI,EAAE4B,OAAO;IACbd,OAAO,EAAE;EACX,CAAC;EACDkE,cAAc,EAAEjD,IAAI;EAEpB;;EAEAkD,kBAAkB,EAAE;IAClBC,SAAS,EAAEtD,OAAO;IAClBuD,cAAc,EAAEpD,IAAI;IACpBqD,eAAe,EAAEd;EACnB,CAAC;EAED;;EAEAe,QAAQ,EAAE3F,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;EACxCoF,SAAS,EAAE5F,QAAQ,CAACI,MAAM,CAACG,KAAK,CAACC,QAAQ;EACzCqF,MAAM,EAAE/E,MAAM;EAAE;;EAEhBgF,SAAS,EAAEhF,MAAM;EACjBiF,SAAS,EAAEjF,MAAM;EAEjB;;EAEAkF,YAAY,EAAE;IACZ1F,IAAI,EAAEQ,MAAM;IACZG,MAAM,EAAE,IAAI;IACZC,MAAM,EAAE;EACV,CAAC;EAED+E,OAAO,EAAEnF,MAAM;EAEf;;EAEAoF,SAAS,EAAE;IACT5F,IAAI,EAAE+B,IAAI;IACVjB,OAAO,EAAE;EACX;AACF,CAAC,EACD;EACE+E,UAAU,EAAE,IAAI;EAChB;EACAC,OAAO,EAAE;AACX,CACF,CAAC;;AAED;;AAEA;AACAjG,kBAAkB,CAACkG,KAAK,CAAC;EAAEhG,WAAW,EAAE,CAAC;EAAE4B,MAAM,EAAE,CAAC;EAAEqE,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC;AACtEnG,kBAAkB,CAACkG,KAAK,CAAC;EAAEhG,WAAW,EAAE,CAAC;EAAEiG,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC;AAC3DnG,kBAAkB,CAACkG,KAAK,CAAC;EAAE1F,MAAM,EAAE,CAAC;EAAEsB,MAAM,EAAE;AAAE,CAAC,CAAC;AAClD9B,kBAAkB,CAACkG,KAAK,CAAC;EAAEzF,SAAS,EAAE,CAAC;EAAEqB,MAAM,EAAE,CAAC;EAAEqE,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC;;AAEpE;AACAnG,kBAAkB,CAACkG,KAAK,CAAC;EAAE3D,MAAM,EAAE,CAAC;EAAErC,WAAW,EAAE;AAAE,CAAC,CAAC;AACvDF,kBAAkB,CAACkG,KAAK,CAAC;EAAE/F,IAAI,EAAE,CAAC;EAAEoC,MAAM,EAAE;AAAE,CAAC,CAAC;;AAEhD;AACAvC,kBAAkB,CAACkG,KAAK,CAAC;EAAEvC,YAAY,EAAE;AAAE,CAAC,CAAC;AAC7C3D,kBAAkB,CAACkG,KAAK,CAAC;EAAEtC,SAAS,EAAE;AAAE,CAAC,EAAE;EAAEwC,kBAAkB,EAAE;AAAE,CAAC,CAAC;;AAErE;AACApG,kBAAkB,CAACkG,KAAK,CAAC;EAAEpB,UAAU,EAAE;AAAE,CAAC,CAAC;AAC3C9E,kBAAkB,CAACkG,KAAK,CAAC;EAAExC,eAAe,EAAE;AAAE,CAAC,CAAC;;AAEhD;AACA1D,kBAAkB,CAACkG,KAAK,CAAC;EAAE1D,MAAM,EAAE,CAAC;EAAEC,WAAW,EAAE;AAAE,CAAC,CAAC;AACvDzC,kBAAkB,CAACkG,KAAK,CAAC;EAAE3D,MAAM,EAAE;IAAE8D,GAAG,EAAE,CAAC,SAAS,EAAE,WAAW;EAAE;AAAE,CAAC,CAAC;;AAEvE;;AAEA;AACA;AACA;AACArG,kBAAkB,CAACsG,OAAO,CAAC,eAAe,CAAC,CAACC,GAAG,CAAC,YAAY;EAC1D,OAAO,IAAI,CAACtE,MAAM,KAAKuE,SAAS,IAAI,IAAI,CAACvE,MAAM,KAAK,IAAI;AAC1D,CAAC,CAAC;;AAEF;AACA;AACA;AACAjC,kBAAkB,CAACsG,OAAO,CAAC,eAAe,CAAC,CAACC,GAAG,CAAC,YAAY;EAC1D,IAAI,CAAC,IAAI,CAAC5C,YAAY,EAAE,OAAO,CAAC;EAChC,OAAO5D,MAAM,CAAC,IAAI,CAAC4D,YAAY,CAAC,CAAC8C,IAAI,CAAC1G,MAAM,CAAC,CAAC,EAAE,SAAS,CAAC;AAC5D,CAAC,CAAC;;AAEF;AACA;AACA;AACAC,kBAAkB,CAACsG,OAAO,CAAC,mBAAmB,CAAC,CAACC,GAAG,CAAC,YAAY;EAC9D,IAAI,CAAC,IAAI,CAAC5C,YAAY,EAAE,OAAO,KAAK;EACpC,OAAO5D,MAAM,CAAC,IAAI,CAAC4D,YAAY,CAAC,CAAC+C,QAAQ,CAAC3G,MAAM,CAAC,CAAC,CAAC;AACrD,CAAC,CAAC;;AAEF;AACA;AACA;AACAC,kBAAkB,CAACsG,OAAO,CAAC,SAAS,CAAC,CAACC,GAAG,CAAC,YAAY;EACpD,MAAMI,GAAG,GAAG,IAAIzE,IAAI,CAAC,CAAC;EACtB,MAAMuE,IAAI,GAAGE,GAAG,GAAG,IAAI,CAACR,SAAS;EACjC,MAAMS,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACL,IAAI,GAAG,IAAI,CAAC;EACvC,MAAMM,OAAO,GAAGF,IAAI,CAACC,KAAK,CAACF,OAAO,GAAG,EAAE,CAAC;EACxC,MAAMI,KAAK,GAAGH,IAAI,CAACC,KAAK,CAACC,OAAO,GAAG,EAAE,CAAC;EACtC,MAAME,IAAI,GAAGJ,IAAI,CAACC,KAAK,CAACE,KAAK,GAAG,EAAE,CAAC;EAEnC,IAAIC,IAAI,GAAG,CAAC,EAAE,OAAO,OAAOA,IAAI,MAAM;EACtC,IAAID,KAAK,GAAG,CAAC,EAAE,OAAO,OAAOA,KAAK,OAAO;EACzC,IAAID,OAAO,GAAG,CAAC,EAAE,OAAO,OAAOA,OAAO,QAAQ;EAC9C,OAAO,MAAM;AACf,CAAC,CAAC;;AAEF;AACA;AACA;AACA/G,kBAAkB,CAACsG,OAAO,CAAC,eAAe,CAAC,CAACC,GAAG,CAAC,YAAY;EAC1D,IAAI,CAAC,IAAI,CAAC/D,MAAM,EAAE,OAAO,CAAC;EAC1B,OAAOzC,MAAM,CAAC,CAAC,CAAC0G,IAAI,CAAC1G,MAAM,CAAC,IAAI,CAACyC,MAAM,CAAC,EAAE,MAAM,CAAC;AACnD,CAAC,CAAC;;AAEF;;AAEAxC,kBAAkB,CAACkH,GAAG,CAAC,MAAM,EAAE,UAAUC,IAAI,EAAE;EAC7C;EACA,IAAI,IAAI,CAACjH,WAAW,IAAI,CAAC,IAAI,CAACM,MAAM,EAAE;IACpC,IAAI,CAACA,MAAM,GAAG,IAAI,CAACN,WAAW;EAChC;EACA,IAAI,IAAI,CAACA,WAAW,IAAI,CAAC,IAAI,CAACO,SAAS,EAAE;IACvC,IAAI,CAACA,SAAS,GAAG,IAAI,CAACP,WAAW;EACnC;EACA,IAAI,IAAI,CAACM,MAAM,IAAI,CAAC,IAAI,CAACN,WAAW,EAAE;IACpC,IAAI,CAACA,WAAW,GAAG,IAAI,CAACM,MAAM;EAChC;EACA,IAAI,IAAI,CAACC,SAAS,IAAI,CAAC,IAAI,CAACP,WAAW,EAAE;IACvC,IAAI,CAACA,WAAW,GAAG,IAAI,CAACO,SAAS;EACnC;;EAEA;EACA,IAAI,IAAI,CAACuB,IAAI,KAAKwE,SAAS,EAAE;IAC3B,IAAI,CAAC1E,MAAM,GAAG,IAAI,CAACE,IAAI;EACzB;EACA,IAAI,IAAI,CAACF,MAAM,KAAK0E,SAAS,EAAE;IAC7B,IAAI,CAACxE,IAAI,GAAG,IAAI,CAACF,MAAM;EACzB;;EAEA;EACA,IAAI,CAAC,IAAI,CAACP,KAAK,EAAE;IACf,MAAM6F,QAAQ,GAAG;MACfC,IAAI,EAAE,SAAS;MACfC,OAAO,EAAE,SAAS;MAClBC,OAAO,EAAE,SAAS;MAClBC,KAAK,EAAE,SAAS;MAChBC,MAAM,EAAE,SAAS;MACjBrG,OAAO,EAAE,SAAS;MAClBsG,IAAI,EAAE,SAAS;MACfC,QAAQ,EAAE,SAAS;MACnBC,IAAI,EAAE,SAAS;MACfC,OAAO,EAAE,SAAS;MAClBC,OAAO,EAAE,SAAS;MAClBC,KAAK,EAAE;IACT,CAAC;IACD,IAAI,CAACxG,KAAK,GAAG6F,QAAQ,CAAC,IAAI,CAACjH,IAAI,CAAC,IAAI,SAAS;EAC/C;;EAEA;EACA,IAAI,CAAC,IAAI,CAACU,cAAc,EAAE;IACxB,IAAI,CAACA,cAAc,GAAG,SAASqB,IAAI,CAACyE,GAAG,CAAC,CAAC,IAAIE,IAAI,CAACmB,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;EACxF;EAEAf,IAAI,CAAC,CAAC;AACR,CAAC,CAAC;;AAEF;;AAEA;AACA;AACA;AACAnH,kBAAkB,CAACmI,OAAO,CAACC,UAAU,GAAG,kBAAkB;EACxD,IAAI,CAACtG,MAAM,GAAG,IAAI;EAClB,IAAI,CAACE,IAAI,GAAG,IAAI;EAChB,IAAI,CAACC,MAAM,GAAG,IAAIC,IAAI,CAAC,CAAC;EACxB,OAAO,MAAM,IAAI,CAACmG,IAAI,CAAC,CAAC;AAC1B,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACG,YAAY,GAAG,kBAAkB;EAC1D,IAAI,CAACxG,MAAM,GAAG,KAAK;EACnB,IAAI,CAACE,IAAI,GAAG,KAAK;EACjB,IAAI,CAACC,MAAM,GAAG,IAAI;EAClB,OAAO,MAAM,IAAI,CAACoG,IAAI,CAAC,CAAC;AAC1B,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACI,eAAe,GAAG,UAAUtF,OAAO,EAAE;EAC9D,IAAI,CAACR,WAAW,GAAG,IAAIP,IAAI,CAAC,CAAC;EAC7B,IAAI,CAACK,MAAM,GAAG,WAAW;EAEzB,IAAIU,OAAO,IAAI,IAAI,CAACD,aAAa,EAAE;IACjC,MAAMA,aAAa,GAAG,IAAI,CAACA,aAAa,CAACwF,IAAI,CAACC,EAAE,IAAIA,EAAE,CAACxF,OAAO,KAAKA,OAAO,CAAC;IAC3E,IAAID,aAAa,EAAE;MACjBA,aAAa,CAACT,MAAM,GAAG,WAAW;MAClCS,aAAa,CAACG,UAAU,GAAG,OAAOjB,IAAI,CAACyE,GAAG,CAAC,CAAC,EAAE;IAChD;EACF;EACA,OAAO,IAAI,CAAC0B,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACO,WAAW,GAAG,YAAY;EACnD,IAAI,CAAChE,UAAU,GAAG,CAAC,IAAI,CAACA,UAAU,IAAI,CAAC,IAAI,CAAC;EAC5C,OAAO,IAAI,CAAC2D,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACQ,YAAY,GAAG,UAAU1F,OAAO,EAAE2F,MAAM,EAAE;EACnE,IAAI,CAACrG,MAAM,GAAG,QAAQ;EAEtB,IAAIU,OAAO,IAAI,IAAI,CAACD,aAAa,EAAE;IACjC,MAAMA,aAAa,GAAG,IAAI,CAACA,aAAa,CAACwF,IAAI,CAACC,EAAE,IAAIA,EAAE,CAACxF,OAAO,KAAKA,OAAO,CAAC;IAC3E,IAAID,aAAa,EAAE;MACjBA,aAAa,CAACT,MAAM,GAAG,QAAQ;MAC/BS,aAAa,CAACE,aAAa,GAAG0F,MAAM;IACtC,CAAC,MAAM;MACL,IAAI,CAAC5F,aAAa,CAAC6F,IAAI,CAAC;QACtB5F,OAAO;QACPV,MAAM,EAAE,QAAQ;QAChBW,aAAa,EAAE0F;MACjB,CAAC,CAAC;IACJ;EACF;EACA,OAAO,IAAI,CAACP,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACW,KAAK,GAAG,YAAY;EAC7C,IAAI,CAAClE,UAAU,GAAG,CAAC,IAAI,CAACA,UAAU,IAAI,CAAC,IAAI,CAAC;EAC5C,IAAI,CAACC,WAAW,GAAG,IAAI3C,IAAI,CAAC,CAAC;EAC7B,IAAI,CAACK,MAAM,GAAG,SAAS;EACvB,OAAO,IAAI,CAAC8F,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACY,eAAe,GAAG,UAAUC,KAAK,GAAG,CAAC,EAAE;EAChE,IAAI,CAAC5D,kBAAkB,GAAG;IACxBC,SAAS,EAAE,IAAI;IACfC,cAAc,EAAE,IAAIpD,IAAI,CAAC,CAAC;IAC1BqD,eAAe,EAAEyD;EACnB,CAAC;EACD,OAAO,IAAI,CAACX,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACc,WAAW,GAAG,YAAY;EACnD,IAAI,CAAC/D,cAAc,GAAG,IAAI;EAC1B,IAAI,CAACC,cAAc,GAAG,IAAIjD,IAAI,CAAC,CAAC;EAChC,OAAO,IAAI,CAACmG,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACe,OAAO,GAAG,YAAY;EAC/C,IAAI,CAAC/G,QAAQ,GAAG,IAAI;EACpB,IAAI,CAACC,aAAa,GAAG,UAAU;EAC/B,IAAI,CAACE,UAAU,GAAG,IAAIJ,IAAI,CAAC,CAAC;EAC5B,OAAO,IAAI,CAACmG,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACmI,OAAO,CAACgB,UAAU,GAAG,YAAY;EAClD,IAAI,CAACpD,SAAS,GAAG,IAAI7D,IAAI,CAAC,CAAC;EAC3B,OAAO,IAAI,CAACmG,IAAI,CAAC,CAAC;AACpB,CAAC;;AAED;;AAEA;AACA;AACA;AACArI,kBAAkB,CAACoJ,OAAO,CAACC,SAAS,GAAG,UAAUnJ,WAAW,EAAE;EAC5D,OAAO,IAAI,CAACsI,IAAI,CAAC;IACfc,GAAG,EAAE,CACH;MAAEpJ;IAAY,CAAC,EACf;MAAEM,MAAM,EAAEN;IAAY,CAAC,EACvB;MAAEO,SAAS,EAAEP;IAAY,CAAC,CAC3B;IACD+B,MAAM,EAAE;MAAEsH,OAAO,EAAE;IAAM,CAAC;IAC1BzH,MAAM,EAAE,KAAK;IACbiE,SAAS,EAAE;EACb,CAAC,CAAC,CAACyD,IAAI,CAAC;IAAErD,SAAS,EAAE,CAAC;EAAE,CAAC,CAAC;AAC5B,CAAC;;AAED;AACA;AACA;AACAnG,kBAAkB,CAACoJ,OAAO,CAACK,UAAU,GAAG,YAAY;EAClD,OAAO,IAAI,CAACjB,IAAI,CAAC;IACfjG,MAAM,EAAE;MAAE8D,GAAG,EAAE,CAAC,SAAS,EAAE,WAAW;IAAE,CAAC;IACzCiD,GAAG,EAAE,CACH;MAAE3F,YAAY,EAAE;QAAE+F,IAAI,EAAE,IAAIxH,IAAI,CAAC;MAAE;IAAE,CAAC,EACtC;MAAEyB,YAAY,EAAE;QAAE4F,OAAO,EAAE;MAAM;IAAE,CAAC,CACrC;IACDxD,SAAS,EAAE;EACb,CAAC,CAAC,CAACyD,IAAI,CAAC;IAAE7F,YAAY,EAAE;EAAE,CAAC,CAAC;AAC9B,CAAC;;AAED;AACA;AACA;AACA3D,kBAAkB,CAACoJ,OAAO,CAACO,SAAS,GAAG,UAAUC,cAAc,GAAG,CAAC,EAAE;EACnE,OAAO,IAAI,CAACpB,IAAI,CAAC;IACfjG,MAAM,EAAE,QAAQ;IAChBqC,UAAU,EAAE;MAAEiF,GAAG,EAAED;IAAe,CAAC;IACnC7D,SAAS,EAAE;EACb,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA/F,kBAAkB,CAACoJ,OAAO,CAACU,SAAS,GAAG,UAAU5J,WAAW,EAAEC,IAAI,EAAE;EAClE,OAAO,IAAI,CAACqI,IAAI,CAAC;IACfc,GAAG,EAAE,CACH;MAAEpJ;IAAY,CAAC,EACf;MAAEM,MAAM,EAAEN;IAAY,CAAC,EACvB;MAAEO,SAAS,EAAEP;IAAY,CAAC,CAC3B;IACDC,IAAI;IACJ4F,SAAS,EAAE;EACb,CAAC,CAAC,CAACyD,IAAI,CAAC;IAAErD,SAAS,EAAE,CAAC;EAAE,CAAC,CAAC;AAC5B,CAAC;;AAED;AACA;AACA;AACAnG,kBAAkB,CAACoJ,OAAO,CAACW,qBAAqB,GAAG,UAAUC,KAAK,GAAG,EAAE,EAAE;EACvE,OAAO,IAAI,CAACxB,IAAI,CAAC;IACfpF,QAAQ,EAAE;MAAEiD,GAAG,EAAE,CAAC,MAAM,EAAE,UAAU,EAAE,QAAQ;IAAE,CAAC;IACjDN,SAAS,EAAE;EACb,CAAC,CAAC,CACCiE,KAAK,CAACA,KAAK,CAAC,CACZR,IAAI,CAAC;IAAErD,SAAS,EAAE,CAAC;EAAE,CAAC,CAAC;AAC5B,CAAC;;AAED;AACA;AACA;AACAnG,kBAAkB,CAACoJ,OAAO,CAACa,eAAe,GAAG,YAAY;EACvD,OAAO,IAAI,CAACzB,IAAI,CAAC;IACfjG,MAAM,EAAE,MAAM;IACdwD,SAAS,EAAE;EACb,CAAC,CAAC,CAACyD,IAAI,CAAC;IAAErD,SAAS,EAAE,CAAC;EAAE,CAAC,CAAC;AAC5B,CAAC;;AAED;AACA;AACA;AACAnG,kBAAkB,CAACoJ,OAAO,CAACc,0BAA0B,GAAG,YAAY;EAClE,OAAO,IAAI,CAAC1B,IAAI,CAAC;IACfjG,MAAM,EAAE,QAAQ;IAChBqC,UAAU,EAAE;MAAEiF,GAAG,EAAE;IAAE,CAAC;IACtB9D,SAAS,EAAE;EACb,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA/F,kBAAkB,CAACoJ,OAAO,CAACe,gBAAgB,GAAG,UAAUnD,KAAK,GAAG,EAAE,EAAE;EAClE,MAAMoD,SAAS,GAAGrK,MAAM,CAAC,CAAC,CAACsK,QAAQ,CAACrD,KAAK,EAAE,OAAO,CAAC,CAACsD,MAAM,CAAC,CAAC;EAC5D,OAAO,IAAI,CAACC,SAAS,CAAC,CACpB;IACEC,MAAM,EAAE;MACNrE,SAAS,EAAE;QAAEsE,IAAI,EAAEL;MAAU,CAAC;MAC9BrE,SAAS,EAAE;IACb;EACF,CAAC,EACD;IACE2E,MAAM,EAAE;MACNC,GAAG,EAAE,IAAI;MACTC,KAAK,EAAE;QAAEC,IAAI,EAAE;MAAE,CAAC;MAClBC,IAAI,EAAE;QAAED,IAAI,EAAE;UAAEE,KAAK,EAAE,CAAC;YAAEC,GAAG,EAAE,CAAC,SAAS,EAAE,MAAM;UAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAAE;MAAE,CAAC;MAC/DC,SAAS,EAAE;QAAEJ,IAAI,EAAE;UAAEE,KAAK,EAAE,CAAC;YAAEC,GAAG,EAAE,CAAC,SAAS,EAAE,WAAW;UAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAAE;MAAE,CAAC;MACzEE,MAAM,EAAE;QAAEL,IAAI,EAAE;UAAEE,KAAK,EAAE,CAAC;YAAEC,GAAG,EAAE,CAAC,SAAS,EAAE,QAAQ;UAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAAE;MAAE,CAAC;MACnEG,MAAM,EAAE;QAAEN,IAAI,EAAE;UAAEE,KAAK,EAAE,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC;QAAE;MAAE,CAAC;MAC9CK,OAAO,EAAE;QAAEP,IAAI,EAAE;UAAEE,KAAK,EAAE,CAAC;YAAEM,GAAG,EAAE,CAAC,aAAa,EAAE,CAAC;UAAE,CAAC,EAAE,CAAC,EAAE,CAAC;QAAE;MAAE,CAAC;MACjEC,UAAU,EAAE;QAAEC,IAAI,EAAE;MAAc,CAAC;MACnCC,YAAY,EAAE;QACZT,KAAK,EAAE,CACL;UAAEM,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;QAAE,CAAC,EACtB;UAAEI,OAAO,EAAE,CAAC,YAAY,EAAE,QAAQ;QAAE,CAAC,EACrC,CAAC;MAEL,CAAC;MACDC,QAAQ,EAAE;QACRX,KAAK,EAAE,CACL;UAAEM,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;QAAE,CAAC,EACtB;UAAEI,OAAO,EAAE,CAAC,SAAS,EAAE,QAAQ;QAAE,CAAC,EAClC,CAAC;MAEL,CAAC;MACDE,SAAS,EAAE;QACTZ,KAAK,EAAE,CACL;UAAEM,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;QAAE,CAAC,EACtB;UAAEI,OAAO,EAAE,CAAC,UAAU,EAAE,QAAQ;QAAE,CAAC,EACnC,CAAC;MAEL;IACF;EACF,CAAC,CACF,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACAzL,kBAAkB,CAACoJ,OAAO,CAACwC,kBAAkB,GAAG,gBAAgBC,IAAI,EAAE;EACpE,MAAMC,YAAY,GAAG,IAAI,IAAI,CAACD,IAAI,CAAC;EACnC,OAAO,MAAMC,YAAY,CAACzD,IAAI,CAAC,CAAC;AAClC,CAAC;;AAED;AACA;AACA;AACArI,kBAAkB,CAACoJ,OAAO,CAAC2C,uBAAuB,GAAG,gBACnDC,YAAY,EACZC,gBAAgB,EAChB;EACA,MAAMC,aAAa,GAAGF,YAAY,CAACG,GAAG,CAACjM,WAAW,KAAK;IACrD,GAAG+L,gBAAgB;IACnB/L;EACF,CAAC,CAAC,CAAC;EACH,OAAO,MAAM,IAAI,CAACkM,UAAU,CAACF,aAAa,CAAC;AAC7C,CAAC;;AAED;AACA;AACA;AACAlM,kBAAkB,CAACoJ,OAAO,CAACiD,sBAAsB,GAAG,gBAAgBpF,IAAI,GAAG,EAAE,EAAE;EAC7E,MAAMqF,UAAU,GAAG,IAAIpK,IAAI,CAAC,CAAC;EAC7BoK,UAAU,CAACC,OAAO,CAACD,UAAU,CAACE,OAAO,CAAC,CAAC,GAAGvF,IAAI,CAAC;EAE/C,OAAO,MAAM,IAAI,CAACwF,UAAU,CAAC;IAC3BtG,SAAS,EAAE;MAAE0D,GAAG,EAAEyC;IAAW,CAAC;IAC9BxK,MAAM,EAAE;EACV,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA,MAAM4K,YAAY,GAChB7M,QAAQ,CAAC8M,MAAM,CAACD,YAAY,IAAI7M,QAAQ,CAAC+M,KAAK,CAAC,cAAc,EAAE5M,kBAAkB,CAAC;AAEpF6M,MAAM,CAACC,OAAO,GAAGJ,YAAY","ignoreList":[]}