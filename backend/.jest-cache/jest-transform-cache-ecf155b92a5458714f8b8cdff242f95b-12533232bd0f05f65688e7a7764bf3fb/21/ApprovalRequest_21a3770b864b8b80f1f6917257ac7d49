c89097bf6b6e0ba36397e8c84a0504a0
// ApprovalRequest.js
// نموذج موافقة ذكي للطلبات
const mongoose = require('mongoose');
const approvalRequestSchema = new mongoose.Schema({
  requestType: {
    type: String,
    required: true
  },
  // مثال: "إجازة"، "صرف مالي"، "تعديل بيانات"
  requestRefId: {
    type: mongoose.Schema.Types.ObjectId
  },
  // مرجع للطلب الأصلي
  requester: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  status: {
    type: String,
    enum: ['pending', 'approved', 'rejected', 'cancelled'],
    default: 'pending'
  },
  steps: [{
    approver: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User'
    },
    action: {
      type: String,
      enum: ['pending', 'approved', 'rejected'],
      default: 'pending'
    },
    actedAt: Date,
    comment: String
  }],
  currentStep: {
    type: Number,
    default: 0
  },
  comments: [{
    user: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User'
    },
    text: String,
    createdAt: {
      type: Date,
      default: Date.now
    }
  }],
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
});
module.exports = mongoose.model('ApprovalRequest', approvalRequestSchema);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJhcHByb3ZhbFJlcXVlc3RTY2hlbWEiLCJTY2hlbWEiLCJyZXF1ZXN0VHlwZSIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsInJlcXVlc3RSZWZJZCIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZXF1ZXN0ZXIiLCJyZWYiLCJzdGF0dXMiLCJlbnVtIiwiZGVmYXVsdCIsInN0ZXBzIiwiYXBwcm92ZXIiLCJhY3Rpb24iLCJhY3RlZEF0IiwiRGF0ZSIsImNvbW1lbnQiLCJjdXJyZW50U3RlcCIsIk51bWJlciIsImNvbW1lbnRzIiwidXNlciIsInRleHQiLCJjcmVhdGVkQXQiLCJub3ciLCJ1cGRhdGVkQXQiLCJtb2R1bGUiLCJleHBvcnRzIiwibW9kZWwiXSwic291cmNlcyI6WyJBcHByb3ZhbFJlcXVlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQXBwcm92YWxSZXF1ZXN0LmpzXHJcbi8vINmG2YXZiNiw2Kwg2YXZiNin2YHZgtipINiw2YPZiiDZhNmE2LfZhNio2KfYqlxyXG5jb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG5jb25zdCBhcHByb3ZhbFJlcXVlc3RTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcclxuICByZXF1ZXN0VHlwZTogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sIC8vINmF2KvYp9mEOiBcItil2KzYp9iy2KlcItiMIFwi2LXYsdmBINmF2KfZhNmKXCLYjCBcItiq2LnYr9mK2YQg2KjZitin2YbYp9iqXCJcclxuICByZXF1ZXN0UmVmSWQ6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkIH0sIC8vINmF2LHYrNi5INmE2YTYt9mE2Kgg2KfZhNij2LXZhNmKXHJcbiAgcmVxdWVzdGVyOiB7IHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCwgcmVmOiAnVXNlcicsIHJlcXVpcmVkOiB0cnVlIH0sXHJcbiAgc3RhdHVzOiB7XHJcbiAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICBlbnVtOiBbJ3BlbmRpbmcnLCAnYXBwcm92ZWQnLCAncmVqZWN0ZWQnLCAnY2FuY2VsbGVkJ10sXHJcbiAgICBkZWZhdWx0OiAncGVuZGluZycsXHJcbiAgfSxcclxuICBzdGVwczogW1xyXG4gICAge1xyXG4gICAgICBhcHByb3ZlcjogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ1VzZXInIH0sXHJcbiAgICAgIGFjdGlvbjogeyB0eXBlOiBTdHJpbmcsIGVudW06IFsncGVuZGluZycsICdhcHByb3ZlZCcsICdyZWplY3RlZCddLCBkZWZhdWx0OiAncGVuZGluZycgfSxcclxuICAgICAgYWN0ZWRBdDogRGF0ZSxcclxuICAgICAgY29tbWVudDogU3RyaW5nLFxyXG4gICAgfSxcclxuICBdLFxyXG4gIGN1cnJlbnRTdGVwOiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LFxyXG4gIGNvbW1lbnRzOiBbXHJcbiAgICB7XHJcbiAgICAgIHVzZXI6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdVc2VyJyB9LFxyXG4gICAgICB0ZXh0OiBTdHJpbmcsXHJcbiAgICAgIGNyZWF0ZWRBdDogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9LFxyXG4gICAgfSxcclxuICBdLFxyXG4gIGNyZWF0ZWRBdDogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9LFxyXG4gIHVwZGF0ZWRBdDogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9LFxyXG59KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ0FwcHJvdmFsUmVxdWVzdCcsIGFwcHJvdmFsUmVxdWVzdFNjaGVtYSk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUVwQyxNQUFNQyxxQkFBcUIsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUNoREMsV0FBVyxFQUFFO0lBQUVDLElBQUksRUFBRUMsTUFBTTtJQUFFQyxRQUFRLEVBQUU7RUFBSyxDQUFDO0VBQUU7RUFDL0NDLFlBQVksRUFBRTtJQUFFSCxJQUFJLEVBQUVMLFFBQVEsQ0FBQ0csTUFBTSxDQUFDTSxLQUFLLENBQUNDO0VBQVMsQ0FBQztFQUFFO0VBQ3hEQyxTQUFTLEVBQUU7SUFBRU4sSUFBSSxFQUFFTCxRQUFRLENBQUNHLE1BQU0sQ0FBQ00sS0FBSyxDQUFDQyxRQUFRO0lBQUVFLEdBQUcsRUFBRSxNQUFNO0lBQUVMLFFBQVEsRUFBRTtFQUFLLENBQUM7RUFDaEZNLE1BQU0sRUFBRTtJQUNOUixJQUFJLEVBQUVDLE1BQU07SUFDWlEsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsV0FBVyxDQUFDO0lBQ3REQyxPQUFPLEVBQUU7RUFDWCxDQUFDO0VBQ0RDLEtBQUssRUFBRSxDQUNMO0lBQ0VDLFFBQVEsRUFBRTtNQUFFWixJQUFJLEVBQUVMLFFBQVEsQ0FBQ0csTUFBTSxDQUFDTSxLQUFLLENBQUNDLFFBQVE7TUFBRUUsR0FBRyxFQUFFO0lBQU8sQ0FBQztJQUMvRE0sTUFBTSxFQUFFO01BQUViLElBQUksRUFBRUMsTUFBTTtNQUFFUSxJQUFJLEVBQUUsQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLFVBQVUsQ0FBQztNQUFFQyxPQUFPLEVBQUU7SUFBVSxDQUFDO0lBQ3ZGSSxPQUFPLEVBQUVDLElBQUk7SUFDYkMsT0FBTyxFQUFFZjtFQUNYLENBQUMsQ0FDRjtFQUNEZ0IsV0FBVyxFQUFFO0lBQUVqQixJQUFJLEVBQUVrQixNQUFNO0lBQUVSLE9BQU8sRUFBRTtFQUFFLENBQUM7RUFDekNTLFFBQVEsRUFBRSxDQUNSO0lBQ0VDLElBQUksRUFBRTtNQUFFcEIsSUFBSSxFQUFFTCxRQUFRLENBQUNHLE1BQU0sQ0FBQ00sS0FBSyxDQUFDQyxRQUFRO01BQUVFLEdBQUcsRUFBRTtJQUFPLENBQUM7SUFDM0RjLElBQUksRUFBRXBCLE1BQU07SUFDWnFCLFNBQVMsRUFBRTtNQUFFdEIsSUFBSSxFQUFFZSxJQUFJO01BQUVMLE9BQU8sRUFBRUssSUFBSSxDQUFDUTtJQUFJO0VBQzdDLENBQUMsQ0FDRjtFQUNERCxTQUFTLEVBQUU7SUFBRXRCLElBQUksRUFBRWUsSUFBSTtJQUFFTCxPQUFPLEVBQUVLLElBQUksQ0FBQ1E7RUFBSSxDQUFDO0VBQzVDQyxTQUFTLEVBQUU7SUFBRXhCLElBQUksRUFBRWUsSUFBSTtJQUFFTCxPQUFPLEVBQUVLLElBQUksQ0FBQ1E7RUFBSTtBQUM3QyxDQUFDLENBQUM7QUFFRkUsTUFBTSxDQUFDQyxPQUFPLEdBQUcvQixRQUFRLENBQUNnQyxLQUFLLENBQUMsaUJBQWlCLEVBQUU5QixxQkFBcUIsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==