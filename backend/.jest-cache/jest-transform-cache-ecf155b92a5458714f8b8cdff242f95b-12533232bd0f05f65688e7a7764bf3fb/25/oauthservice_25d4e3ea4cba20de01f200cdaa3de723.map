{"version":3,"names":["crypto","require","SSOService","logger","OAuthService","constructor","ssoService","OAUTH_CLIENT_SECRET","process","env","initiateAuthorizationCodeFlow","clientId","redirectUri","scope","state","nonce","validation","validateOAuthRequest","valid","Error","authState","randomBytes","toString","stateData","createdAt","Date","now","expiresAt","authCode","generateAuthorizationCode","error","exchangeAuthorizationCode","code","clientSecret","session","accessToken","refreshToken","idToken","tokenType","expiresIn","initiateImplicitFlow","responseTypes","token","redirectUrl","params","URLSearchParams","includes","append","initiateClientCredentialsFlow","_now","info","initiateResourceOwnerPasswordFlow","username","password","userPayload","createSession","source","getUserInfo","introspection","introspectToken","active","userId","sub","userInfo","name","email","email_verified","iss","aud","iat","auth_time","getTokens","grantType","refreshTokenGrant","newSession","refreshAccessToken","getOpenIDConfiguration","baseUrl","SSO_BASE_URL","issuer","authorization_endpoint","token_endpoint","userinfo_endpoint","jwks_uri","registration_endpoint","revocation_endpoint","end_session_endpoint","response_types_supported","grant_types_supported","subject_types_supported","id_token_signing_alg_values_supported","scopes_supported","claims_supported","token_endpoint_auth_methods_supported","claim_types_supported","code_challenge_methods_supported","request_parameter_supported","request_uri_parameter_supported","verifyPKCE","codeVerifier","codeChallenge","method","computedChallenge","hash","createHash","update","digest","Buffer","from","replace","revokeToken","tokenTypeHint","success","registerClient","clientMetadata","client","clientName","redirectUris","grantTypes","scopes","contacts","registrationTime","warn","module","exports"],"sources":["oauth.service.js"],"sourcesContent":["/**\r\n * OAuth 2.0 & OpenID Connect Service\r\n * خدمة OAuth 2.0 و OpenID Connect\r\n */\r\n\r\nconst crypto = require('crypto');\r\nconst SSOService = require('./sso.service');\r\nconst logger = require('../utils/logger');\r\n\r\nclass OAuthService {\r\n  constructor() {\r\n    this.ssoService = new SSOService();\r\n    this.OAUTH_CLIENT_SECRET = process.env.OAUTH_CLIENT_SECRET || 'oauth-secret';\r\n  }\r\n\r\n  /**\r\n   * OAuth 2.0 Authorization Code Flow\r\n   * إنشاء طلب تفويض جديد\r\n   */\r\n  async initiateAuthorizationCodeFlow(clientId, redirectUri, scope, state, nonce = null) {\r\n    try {\r\n      // Validate OAuth request\r\n      const validation = await this.ssoService.validateOAuthRequest(\r\n        clientId,\r\n        redirectUri,\r\n        scope,\r\n        state\r\n      );\r\n\r\n      if (!validation.valid) {\r\n        throw new Error('Invalid OAuth request');\r\n      }\r\n\r\n      // Generate state if not provided\r\n      const authState = state || crypto.randomBytes(32).toString('hex');\r\n\r\n      // Store OAuth state for CSRF protection\r\n      const stateData = {\r\n        clientId,\r\n        redirectUri,\r\n        scope,\r\n        nonce,\r\n        createdAt: Date.now(),\r\n        expiresAt: Date.now() + 600000 // 10 minutes\r\n      };\r\n\r\n      // Store in Redis (implementation in SSOService)\r\n      const authCode = await this.ssoService.generateAuthorizationCode(\r\n        null, // userId will be set after login\r\n        clientId,\r\n        scope,\r\n        redirectUri\r\n      );\r\n\r\n      return {\r\n        authCode,\r\n        state: authState,\r\n        redirectUri: `${redirectUri}?code=${authCode}&state=${authState}`\r\n      };\r\n    } catch (error) {\r\n      logger.error('Authorization code flow initiation failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Exchange authorization code for tokens\r\n   * تبديل رمز التفويض بالتوكنات\r\n   */\r\n  async exchangeAuthorizationCode(code, clientId, clientSecret, redirectUri) {\r\n    try {\r\n      // Verify client credentials\r\n      if (clientSecret !== this.OAUTH_CLIENT_SECRET) {\r\n        throw new Error('Invalid client credentials');\r\n      }\r\n\r\n      // Exchange code for tokens\r\n      const session = await this.ssoService.exchangeAuthorizationCode(\r\n        code,\r\n        clientId,\r\n        clientSecret\r\n      );\r\n\r\n      return {\r\n        accessToken: session.accessToken,\r\n        refreshToken: session.refreshToken,\r\n        idToken: session.idToken,\r\n        tokenType: 'Bearer',\r\n        expiresIn: 3600,\r\n        scope: 'openid profile email'\r\n      };\r\n    } catch (error) {\r\n      logger.error('Authorization code exchange failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * OAuth 2.0 Implicit Flow\r\n   * تدفق Implicit (للتطبيقات أحادية الصفحة)\r\n   */\r\n  async initiateImplicitFlow(clientId, redirectUri, scope, state, responseTypes = ['token']) {\r\n    try {\r\n      const accessToken = crypto.randomBytes(32).toString('hex');\r\n      \r\n      const token = {\r\n        accessToken,\r\n        tokenType: 'Bearer',\r\n        expiresIn: 3600,\r\n        scope\r\n      };\r\n\r\n      // Build redirect URL with token in fragment\r\n      let redirectUrl = `${redirectUri}#`;\r\n      const params = new URLSearchParams();\r\n      \r\n      if (responseTypes.includes('token')) {\r\n        params.append('access_token', accessToken);\r\n        params.append('token_type', token.tokenType);\r\n        params.append('expires_in', token.expiresIn);\r\n      }\r\n      \r\n      if (state) {\r\n        params.append('state', state);\r\n      }\r\n\r\n      redirectUrl += params.toString();\r\n\r\n      return { redirectUrl, token };\r\n    } catch (error) {\r\n      logger.error('Implicit flow initiation failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * OAuth 2.0 Client Credentials Flow\r\n   * تدفق بيانات اعتماد العميل (للتطبيقات)\r\n   */\r\n  async initiateClientCredentialsFlow(clientId, clientSecret, scope) {\r\n    try {\r\n      // Verify client credentials\r\n      if (clientSecret !== this.OAUTH_CLIENT_SECRET) {\r\n        throw new Error('Invalid client credentials');\r\n      }\r\n\r\n      const _now = Date.now();\r\n      const accessToken = crypto.randomBytes(32).toString('hex');\r\n\r\n      const token = {\r\n        accessToken,\r\n        tokenType: 'Bearer',\r\n        expiresIn: 3600,\r\n        scope: scope || 'api'\r\n      };\r\n\r\n      logger.info(`Client credentials flow successful for client: ${clientId}`);\r\n      return token;\r\n    } catch (error) {\r\n      logger.error('Client credentials flow failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * OAuth 2.0 Resource Owner Password Flow\r\n   * تدفق كلمة مرور مالك المورد\r\n   */\r\n  async initiateResourceOwnerPasswordFlow(username, password, scope, clientId) {\r\n    try {\r\n      // This would typically validate against your user database\r\n      // For security, this flow should only be used for trusted clients\r\n      \r\n      // Validate credentials (implementation depends on your auth system)\r\n      const userPayload = {\r\n        username,\r\n        scope: scope || 'api',\r\n        clientId\r\n      };\r\n\r\n      // Create session through SSO service\r\n      const session = await this.ssoService.createSession(\r\n        username,\r\n        userPayload,\r\n        { source: 'password_grant' }\r\n      );\r\n\r\n      return {\r\n        accessToken: session.accessToken,\r\n        refreshToken: session.refreshToken,\r\n        tokenType: 'Bearer',\r\n        expiresIn: session.expiresIn\r\n      };\r\n    } catch (error) {\r\n      logger.error('Resource owner password flow failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * OpenID Connect: UserInfo Endpoint\r\n   * إرجاع معلومات المستخدم\r\n   */\r\n  async getUserInfo(accessToken) {\r\n    try {\r\n      // Verify token and get user information\r\n      const introspection = await this.ssoService.introspectToken(accessToken);\r\n\r\n      if (!introspection.active) {\r\n        throw new Error('Invalid access token');\r\n      }\r\n\r\n      const userId = introspection.sub;\r\n\r\n      // This would fetch user details from database\r\n      const userInfo = {\r\n        sub: userId,\r\n        name: `User ${userId}`,\r\n        email: `user${userId}@example.com`,\r\n        email_verified: true,\r\n        iss: 'https://sso.yourdomain.com',\r\n        aud: introspection.clientId,\r\n        iat: introspection.iat,\r\n        auth_time: introspection.iat\r\n      };\r\n\r\n      return userInfo;\r\n    } catch (error) {\r\n      logger.error('UserInfo endpoint failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * OpenID Connect: Token Endpoint\r\n   * نقطة نهاية التوكن\r\n   */\r\n  async getTokens(grantType, params) {\r\n    try {\r\n      switch (grantType) {\r\n        case 'authorization_code':\r\n          return await this.exchangeAuthorizationCode(\r\n            params.code,\r\n            params.clientId,\r\n            params.clientSecret,\r\n            params.redirectUri\r\n          );\r\n\r\n        case 'refresh_token':\r\n          return await this.refreshTokenGrant(params.refreshToken, params.clientId);\r\n\r\n        case 'client_credentials':\r\n          return await this.initiateClientCredentialsFlow(\r\n            params.clientId,\r\n            params.clientSecret,\r\n            params.scope\r\n          );\r\n\r\n        case 'password':\r\n          return await this.initiateResourceOwnerPasswordFlow(\r\n            params.username,\r\n            params.password,\r\n            params.scope,\r\n            params.clientId\r\n          );\r\n\r\n        default:\r\n          throw new Error(`Unsupported grant type: ${grantType}`);\r\n      }\r\n    } catch (error) {\r\n      logger.error('Token endpoint failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh Token Grant\r\n   * تحديث التوكن\r\n   */\r\n  async refreshTokenGrant(refreshToken, clientId) {\r\n    try {\r\n      // This would parse the refresh token and generate new access token\r\n      const newSession = await this.ssoService.refreshAccessToken(\r\n        null,\r\n        refreshToken\r\n      );\r\n\r\n      return {\r\n        accessToken: newSession.accessToken,\r\n        tokenType: 'Bearer',\r\n        expiresIn: newSession.expiresIn\r\n      };\r\n    } catch (error) {\r\n      logger.error('Refresh token grant failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * OpenID Connect: .well-known/openid-configuration\r\n   * معايير OpenID Connect\r\n   */\r\n  getOpenIDConfiguration() {\r\n    const baseUrl = process.env.SSO_BASE_URL || 'https://sso.yourdomain.com';\r\n\r\n    return {\r\n      issuer: baseUrl,\r\n      authorization_endpoint: `${baseUrl}/oauth2/authorize`,\r\n      token_endpoint: `${baseUrl}/oauth2/token`,\r\n      userinfo_endpoint: `${baseUrl}/oauth2/userinfo`,\r\n      jwks_uri: `${baseUrl}/.well-known/jwks.json`,\r\n      registration_endpoint: `${baseUrl}/oauth2/register`,\r\n      revocation_endpoint: `${baseUrl}/oauth2/revoke`,\r\n      end_session_endpoint: `${baseUrl}/oauth2/logout`,\r\n      response_types_supported: [\r\n        'code',\r\n        'token',\r\n        'id_token',\r\n        'code id_token',\r\n        'token id_token',\r\n        'code token id_token'\r\n      ],\r\n      grant_types_supported: [\r\n        'authorization_code',\r\n        'implicit',\r\n        'refresh_token',\r\n        'client_credentials',\r\n        'password'\r\n      ],\r\n      subject_types_supported: ['public', 'pairwise'],\r\n      id_token_signing_alg_values_supported: ['HS256', 'RS256'],\r\n      scopes_supported: [\r\n        'openid',\r\n        'profile',\r\n        'email',\r\n        'address',\r\n        'phone',\r\n        'offline_access'\r\n      ],\r\n      claims_supported: [\r\n        'sub',\r\n        'name',\r\n        'given_name',\r\n        'family_name',\r\n        'email',\r\n        'email_verified',\r\n        'address',\r\n        'phone_number',\r\n        'auth_time'\r\n      ],\r\n      token_endpoint_auth_methods_supported: [\r\n        'client_secret_basic',\r\n        'client_secret_post',\r\n        'client_secret_jwt',\r\n        'private_key_jwt'\r\n      ],\r\n      claim_types_supported: ['normal', 'aggregated', 'distributed'],\r\n      code_challenge_methods_supported: ['plain', 'S256'],\r\n      request_parameter_supported: true,\r\n      request_uri_parameter_supported: true\r\n    };\r\n  }\r\n\r\n  /**\r\n   * PKCE (Proof Key for Public Clients) Support\r\n   * دعم PKCE لحماية العملاء العامين\r\n   */\r\n  async verifyPKCE(codeVerifier, codeChallenge, method = 'S256') {\r\n    try {\r\n      let computedChallenge;\r\n\r\n      if (method === 'S256') {\r\n        // SHA256 hash\r\n        const hash = crypto.createHash('sha256').update(codeVerifier).digest();\r\n        computedChallenge = Buffer.from(hash).toString('base64')\r\n          .replace(/\\+/g, '-')\r\n          .replace(/\\//g, '_')\r\n          .replace(/=/g, '');\r\n      } else if (method === 'plain') {\r\n        computedChallenge = codeVerifier;\r\n      } else {\r\n        throw new Error(`Unsupported PKCE method: ${method}`);\r\n      }\r\n\r\n      return computedChallenge === codeChallenge;\r\n    } catch (error) {\r\n      logger.error('PKCE verification failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Revoke Token\r\n   * إلغاء التوكن\r\n   */\r\n  async revokeToken(token, tokenTypeHint = 'access_token') {\r\n    try {\r\n      // In production, would invalidate token in Redis\r\n      logger.info(`Token revoked: type=${tokenTypeHint}`);\r\n      return { success: true };\r\n    } catch (error) {\r\n      logger.error('Token revocation failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dynamic Client Registration\r\n   * تسجيل عميل ديناميكي\r\n   */\r\n  async registerClient(clientMetadata) {\r\n    try {\r\n      const clientId = crypto.randomBytes(16).toString('hex');\r\n      const clientSecret = crypto.randomBytes(32).toString('hex');\r\n\r\n      const client = {\r\n        clientId,\r\n        clientSecret,\r\n        clientName: clientMetadata.clientName,\r\n        redirectUris: clientMetadata.redirectUris || [],\r\n        responseTypes: clientMetadata.responseTypes || ['code'],\r\n        grantTypes: clientMetadata.grantTypes || ['authorization_code', 'refresh_token'],\r\n        scopes: clientMetadata.scopes || ['openid', 'profile', 'email'],\r\n        contacts: clientMetadata.contacts || [],\r\n        registrationTime: Date.now()\r\n      };\r\n\r\n      logger.info(`Client registered: ${clientId}`);\r\n      return { client, clientSecret };\r\n    } catch (error) {\r\n      logger.error('Client registration failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Introspect Token (Token Introspection)\r\n   * فحص البيانات الوصفية للتوكن\r\n   */\r\n  async introspectToken(token, clientId) {\r\n    try {\r\n      const introspection = await this.ssoService.introspectToken(token);\r\n\r\n      // Verify client has permission to introspect\r\n      if (introspection.clientId && introspection.clientId !== clientId) {\r\n        logger.warn(`Unauthorized introspection attempt by client: ${clientId}`);\r\n        return { active: false };\r\n      }\r\n\r\n      return introspection;\r\n    } catch (error) {\r\n      logger.error('Token introspection failed:', error);\r\n      return { active: false };\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = OAuthService;\r\n"],"mappings":"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","ignoreList":[]}