{"version":3,"names":["express","require","router","Router","authenticate","authorize","Standard","Accreditation","QualityAudit","ComplianceTracking","QualityIndicator","get","req","res","category","status","search","page","limit","query","filter","$or","name","$regex","$options","nameAr","standardId","skip","standards","total","Promise","all","find","populate","parseInt","sort","createdAt","countDocuments","json","success","data","pagination","pages","Math","ceil","error","message","standard","findById","params","id","post","standardData","body","createdBy","user","_id","save","put","updateData","lastModifiedBy","findByIdAndUpdate","new","runValidators","delete","findByIdAndDelete","type","expiringSoon","ninetyDaysFromNow","Date","setDate","getDate","expiryDate","$gte","$lte","accreditations","accreditation","fromDate","toDate","auditDate","audits","audit","auditData","findings","push","patch","auditId","finding","findingId","department","complianceLevel","trackings","assessmentDate","trackingData","assessor","tracking","trackingId","gapIndex","gaps","indicators","indicator","measurement","recordedBy","measurements","standardsByCategory","aggregate","$match","$group","count","$sum","accreditationsByStatus","expiringAccreditations","recentAudits","select","openFindings","$unwind","$in","$count","complianceOverview","indicatorsPerformance","lean","indicatorsSummary","map","ind","latestMeasurement","length","indicatorId","targetValue","currentValue","value","achieving","report","compliance","$push","level","$sort","matchFilter","trend","year","$year","month","$month","module","exports"],"sources":["quality.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { authenticate, authorize } = require('../middleware/auth');\r\nconst {\r\n  Standard,\r\n  Accreditation,\r\n  QualityAudit,\r\n  ComplianceTracking,\r\n  QualityIndicator,\r\n} = require('../models/qualityManagement');\r\n\r\n// ============================================\r\n// STANDARDS ROUTES - معايير الجودة\r\n// ============================================\r\n\r\n// Get all standards\r\nrouter.get('/standards', authenticate, async (req, res) => {\r\n  try {\r\n    const { category, status, search, page = 1, limit = 20 } = req.query;\r\n\r\n    const filter = {};\r\n    if (category) filter.category = category;\r\n    if (status) filter.status = status;\r\n    if (search) {\r\n      filter.$or = [\r\n        { name: { $regex: search, $options: 'i' } },\r\n        { nameAr: { $regex: search, $options: 'i' } },\r\n        { standardId: { $regex: search, $options: 'i' } },\r\n      ];\r\n    }\r\n\r\n    const skip = (page - 1) * limit;\r\n    const [standards, total] = await Promise.all([\r\n      Standard.find(filter)\r\n        .populate('createdBy', 'name email')\r\n        .populate('lastModifiedBy', 'name email')\r\n        .skip(skip)\r\n        .limit(parseInt(limit))\r\n        .sort({ createdAt: -1 }),\r\n      Standard.countDocuments(filter),\r\n    ]);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        standards,\r\n        pagination: {\r\n          page: parseInt(page),\r\n          limit: parseInt(limit),\r\n          total,\r\n          pages: Math.ceil(total / limit),\r\n        },\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching standards',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Get single standard\r\nrouter.get('/standards/:id', authenticate, async (req, res) => {\r\n  try {\r\n    const standard = await Standard.findById(req.params.id)\r\n      .populate('createdBy', 'name email')\r\n      .populate('lastModifiedBy', 'name email');\r\n\r\n    if (!standard) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Standard not found',\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      data: standard,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching standard',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Create standard\r\nrouter.post(\r\n  '/standards',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager']),\r\n  async (req, res) => {\r\n    try {\r\n      const standardData = {\r\n        ...req.body,\r\n        createdBy: req.user._id,\r\n      };\r\n\r\n      const standard = new Standard(standardData);\r\n      await standard.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'Standard created successfully',\r\n        data: standard,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error creating standard',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Update standard\r\nrouter.put(\r\n  '/standards/:id',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager']),\r\n  async (req, res) => {\r\n    try {\r\n      const updateData = {\r\n        ...req.body,\r\n        lastModifiedBy: req.user._id,\r\n      };\r\n\r\n      const standard = await Standard.findByIdAndUpdate(req.params.id, updateData, {\r\n        new: true,\r\n        runValidators: true,\r\n      });\r\n\r\n      if (!standard) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'Standard not found',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'Standard updated successfully',\r\n        data: standard,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error updating standard',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Delete standard\r\nrouter.delete('/standards/:id', authenticate, authorize(['admin']), async (req, res) => {\r\n  try {\r\n    const standard = await Standard.findByIdAndDelete(req.params.id);\r\n\r\n    if (!standard) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Standard not found',\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'Standard deleted successfully',\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error deleting standard',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// ACCREDITATIONS ROUTES - الاعتمادات\r\n// ============================================\r\n\r\n// Get all accreditations\r\nrouter.get('/accreditations', authenticate, async (req, res) => {\r\n  try {\r\n    const { type, status, expiringSoon } = req.query;\r\n\r\n    const filter = {};\r\n    if (type) filter.type = type;\r\n    if (status) filter.status = status;\r\n\r\n    // Get accreditations expiring in next 90 days\r\n    if (expiringSoon === 'true') {\r\n      const ninetyDaysFromNow = new Date();\r\n      ninetyDaysFromNow.setDate(ninetyDaysFromNow.getDate() + 90);\r\n      filter.expiryDate = {\r\n        $gte: new Date(),\r\n        $lte: ninetyDaysFromNow,\r\n      };\r\n      filter.status = 'active';\r\n    }\r\n\r\n    const accreditations = await Accreditation.find(filter)\r\n      .populate('standards')\r\n      .populate('responsiblePerson', 'name email')\r\n      .sort({ expiryDate: 1 });\r\n\r\n    res.json({\r\n      success: true,\r\n      data: accreditations,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching accreditations',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Get single accreditation\r\nrouter.get('/accreditations/:id', authenticate, async (req, res) => {\r\n  try {\r\n    const accreditation = await Accreditation.findById(req.params.id)\r\n      .populate('standards')\r\n      .populate('responsiblePerson', 'name email');\r\n\r\n    if (!accreditation) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Accreditation not found',\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      data: accreditation,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching accreditation',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Create accreditation\r\nrouter.post(\r\n  '/accreditations',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager']),\r\n  async (req, res) => {\r\n    try {\r\n      const accreditation = new Accreditation(req.body);\r\n      await accreditation.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'Accreditation created successfully',\r\n        data: accreditation,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error creating accreditation',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Update accreditation\r\nrouter.put(\r\n  '/accreditations/:id',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager']),\r\n  async (req, res) => {\r\n    try {\r\n      const accreditation = await Accreditation.findByIdAndUpdate(req.params.id, req.body, {\r\n        new: true,\r\n        runValidators: true,\r\n      });\r\n\r\n      if (!accreditation) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'Accreditation not found',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'Accreditation updated successfully',\r\n        data: accreditation,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error updating accreditation',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Delete accreditation\r\nrouter.delete('/accreditations/:id', authenticate, authorize(['admin']), async (req, res) => {\r\n  try {\r\n    const accreditation = await Accreditation.findByIdAndDelete(req.params.id);\r\n\r\n    if (!accreditation) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Accreditation not found',\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'Accreditation deleted successfully',\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error deleting accreditation',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// QUALITY AUDITS ROUTES - مراجعات الجودة\r\n// ============================================\r\n\r\n// Get all audits\r\nrouter.get('/audits', authenticate, async (req, res) => {\r\n  try {\r\n    const { type, status, fromDate, toDate } = req.query;\r\n\r\n    const filter = {};\r\n    if (type) filter.type = type;\r\n    if (status) filter.status = status;\r\n    if (fromDate || toDate) {\r\n      filter.auditDate = {};\r\n      if (fromDate) filter.auditDate.$gte = new Date(fromDate);\r\n      if (toDate) filter.auditDate.$lte = new Date(toDate);\r\n    }\r\n\r\n    const audits = await QualityAudit.find(filter)\r\n      .populate('accreditation')\r\n      .populate('standards')\r\n      .populate('createdBy', 'name email')\r\n      .populate('findings.responsiblePerson', 'name email')\r\n      .sort({ auditDate: -1 });\r\n\r\n    res.json({\r\n      success: true,\r\n      data: audits,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching audits',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Get single audit\r\nrouter.get('/audits/:id', authenticate, async (req, res) => {\r\n  try {\r\n    const audit = await QualityAudit.findById(req.params.id)\r\n      .populate('accreditation')\r\n      .populate('standards')\r\n      .populate('createdBy', 'name email')\r\n      .populate('findings.responsiblePerson', 'name email');\r\n\r\n    if (!audit) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Audit not found',\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      data: audit,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching audit',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Create audit\r\nrouter.post(\r\n  '/audits',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager', 'auditor']),\r\n  async (req, res) => {\r\n    try {\r\n      const auditData = {\r\n        ...req.body,\r\n        createdBy: req.user._id,\r\n      };\r\n\r\n      const audit = new QualityAudit(auditData);\r\n      await audit.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'Audit created successfully',\r\n        data: audit,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error creating audit',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Update audit\r\nrouter.put(\r\n  '/audits/:id',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager', 'auditor']),\r\n  async (req, res) => {\r\n    try {\r\n      const audit = await QualityAudit.findByIdAndUpdate(req.params.id, req.body, {\r\n        new: true,\r\n        runValidators: true,\r\n      });\r\n\r\n      if (!audit) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'Audit not found',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'Audit updated successfully',\r\n        data: audit,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error updating audit',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Add finding to audit\r\nrouter.post(\r\n  '/audits/:id/findings',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager', 'auditor']),\r\n  async (req, res) => {\r\n    try {\r\n      const audit = await QualityAudit.findById(req.params.id);\r\n\r\n      if (!audit) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'Audit not found',\r\n        });\r\n      }\r\n\r\n      audit.findings.push(req.body);\r\n      await audit.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'Finding added successfully',\r\n        data: audit,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error adding finding',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Update finding status\r\nrouter.patch('/audits/:auditId/findings/:findingId/status', authenticate, async (req, res) => {\r\n  try {\r\n    const { status } = req.body;\r\n\r\n    const audit = await QualityAudit.findById(req.params.auditId);\r\n    if (!audit) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Audit not found',\r\n      });\r\n    }\r\n\r\n    const finding = audit.findings.id(req.params.findingId);\r\n    if (!finding) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Finding not found',\r\n      });\r\n    }\r\n\r\n    finding.status = status;\r\n    await audit.save();\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'Finding status updated',\r\n      data: finding,\r\n    });\r\n  } catch (error) {\r\n    res.status(400).json({\r\n      success: false,\r\n      message: 'Error updating finding status',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// COMPLIANCE TRACKING ROUTES - تتبع الامتثال\r\n// ============================================\r\n\r\n// Get compliance trackings\r\nrouter.get('/compliance', authenticate, async (req, res) => {\r\n  try {\r\n    const { standard, department, complianceLevel } = req.query;\r\n\r\n    const filter = {};\r\n    if (standard) filter.standard = standard;\r\n    if (department) filter.department = department;\r\n    if (complianceLevel) filter.complianceLevel = complianceLevel;\r\n\r\n    const trackings = await ComplianceTracking.find(filter)\r\n      .populate('standard')\r\n      .populate('assessor', 'name email')\r\n      .populate('gaps.responsiblePerson', 'name email')\r\n      .sort({ assessmentDate: -1 });\r\n\r\n    res.json({\r\n      success: true,\r\n      data: trackings,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching compliance trackings',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Create compliance tracking\r\nrouter.post(\r\n  '/compliance',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager', 'auditor']),\r\n  async (req, res) => {\r\n    try {\r\n      const trackingData = {\r\n        ...req.body,\r\n        assessor: req.user._id,\r\n      };\r\n\r\n      const tracking = new ComplianceTracking(trackingData);\r\n      await tracking.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'Compliance tracking created successfully',\r\n        data: tracking,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error creating compliance tracking',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Update compliance tracking\r\nrouter.put(\r\n  '/compliance/:id',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager', 'auditor']),\r\n  async (req, res) => {\r\n    try {\r\n      const tracking = await ComplianceTracking.findByIdAndUpdate(req.params.id, req.body, {\r\n        new: true,\r\n        runValidators: true,\r\n      });\r\n\r\n      if (!tracking) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'Compliance tracking not found',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'Compliance tracking updated successfully',\r\n        data: tracking,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error updating compliance tracking',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Update gap status\r\nrouter.patch('/compliance/:trackingId/gaps/:gapIndex/status', authenticate, async (req, res) => {\r\n  try {\r\n    const { status } = req.body;\r\n    const { trackingId, gapIndex } = req.params;\r\n\r\n    const tracking = await ComplianceTracking.findById(trackingId);\r\n    if (!tracking) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Compliance tracking not found',\r\n      });\r\n    }\r\n\r\n    if (!tracking.gaps[gapIndex]) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Gap not found',\r\n      });\r\n    }\r\n\r\n    tracking.gaps[gapIndex].status = status;\r\n    await tracking.save();\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'Gap status updated',\r\n      data: tracking,\r\n    });\r\n  } catch (error) {\r\n    res.status(400).json({\r\n      success: false,\r\n      message: 'Error updating gap status',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// QUALITY INDICATORS ROUTES - مؤشرات الجودة\r\n// ============================================\r\n\r\n// Get all indicators\r\nrouter.get('/indicators', authenticate, async (req, res) => {\r\n  try {\r\n    const { category, status } = req.query;\r\n\r\n    const filter = {};\r\n    if (category) filter.category = category;\r\n    if (status) filter.status = status;\r\n\r\n    const indicators = await QualityIndicator.find(filter)\r\n      .populate('relatedStandards')\r\n      .populate('responsible', 'name email')\r\n      .populate('measurements.recordedBy', 'name email')\r\n      .sort({ category: 1 });\r\n\r\n    res.json({\r\n      success: true,\r\n      data: indicators,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching indicators',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Get single indicator\r\nrouter.get('/indicators/:id', authenticate, async (req, res) => {\r\n  try {\r\n    const indicator = await QualityIndicator.findById(req.params.id)\r\n      .populate('relatedStandards')\r\n      .populate('responsible', 'name email')\r\n      .populate('measurements.recordedBy', 'name email');\r\n\r\n    if (!indicator) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Indicator not found',\r\n      });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      data: indicator,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching indicator',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Create indicator\r\nrouter.post(\r\n  '/indicators',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager']),\r\n  async (req, res) => {\r\n    try {\r\n      const indicator = new QualityIndicator(req.body);\r\n      await indicator.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'Indicator created successfully',\r\n        data: indicator,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error creating indicator',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// Add measurement to indicator\r\nrouter.post(\r\n  '/indicators/:id/measurements',\r\n  authenticate,\r\n  authorize(['admin', 'quality_manager', 'data_collector']),\r\n  async (req, res) => {\r\n    try {\r\n      const indicator = await QualityIndicator.findById(req.params.id);\r\n\r\n      if (!indicator) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'Indicator not found',\r\n        });\r\n      }\r\n\r\n      const measurement = {\r\n        ...req.body,\r\n        recordedBy: req.user._id,\r\n      };\r\n\r\n      indicator.measurements.push(measurement);\r\n      await indicator.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'Measurement added successfully',\r\n        data: indicator,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'Error adding measurement',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n// ============================================\r\n// DASHBOARD & ANALYTICS ROUTES\r\n// ============================================\r\n\r\n// Quality dashboard overview\r\nrouter.get('/dashboard', authenticate, async (req, res) => {\r\n  try {\r\n    // Count standards by category\r\n    const standardsByCategory = await Standard.aggregate([\r\n      { $match: { status: 'active' } },\r\n      { $group: { _id: '$category', count: { $sum: 1 } } },\r\n    ]);\r\n\r\n    // Count accreditations by status\r\n    const accreditationsByStatus = await Accreditation.aggregate([\r\n      { $group: { _id: '$status', count: { $sum: 1 } } },\r\n    ]);\r\n\r\n    // Expiring accreditations (next 90 days)\r\n    const ninetyDaysFromNow = new Date();\r\n    ninetyDaysFromNow.setDate(ninetyDaysFromNow.getDate() + 90);\r\n    const expiringAccreditations = await Accreditation.countDocuments({\r\n      status: 'active',\r\n      expiryDate: { $gte: new Date(), $lte: ninetyDaysFromNow },\r\n    });\r\n\r\n    // Recent audits\r\n    const recentAudits = await QualityAudit.find()\r\n      .sort({ auditDate: -1 })\r\n      .limit(5)\r\n      .populate('accreditation', 'name nameAr')\r\n      .select('auditId title titleAr auditDate status overallScore');\r\n\r\n    // Open findings count\r\n    const openFindings = await QualityAudit.aggregate([\r\n      { $unwind: '$findings' },\r\n      { $match: { 'findings.status': { $in: ['open', 'in_progress'] } } },\r\n      { $count: 'total' },\r\n    ]);\r\n\r\n    // Compliance overview\r\n    const complianceOverview = await ComplianceTracking.aggregate([\r\n      { $group: { _id: '$complianceLevel', count: { $sum: 1 } } },\r\n    ]);\r\n\r\n    // Quality indicators performance\r\n    const indicatorsPerformance = await QualityIndicator.find({ status: 'active' })\r\n      .select('indicatorId name nameAr targetValue measurements')\r\n      .lean();\r\n\r\n    const indicatorsSummary = indicatorsPerformance.map(ind => {\r\n      const latestMeasurement = ind.measurements[ind.measurements.length - 1];\r\n      return {\r\n        indicatorId: ind.indicatorId,\r\n        name: ind.name,\r\n        nameAr: ind.nameAr,\r\n        targetValue: ind.targetValue,\r\n        currentValue: latestMeasurement?.value || 0,\r\n        achieving: latestMeasurement ? latestMeasurement.value >= ind.targetValue : false,\r\n      };\r\n    });\r\n\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        standardsByCategory,\r\n        accreditationsByStatus,\r\n        expiringAccreditations,\r\n        recentAudits,\r\n        openFindings: openFindings[0]?.total || 0,\r\n        complianceOverview,\r\n        indicatorsSummary,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error fetching dashboard data',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Compliance report by department\r\nrouter.get('/reports/compliance-by-department', authenticate, async (req, res) => {\r\n  try {\r\n    const report = await ComplianceTracking.aggregate([\r\n      {\r\n        $group: {\r\n          _id: {\r\n            department: '$department',\r\n            complianceLevel: '$complianceLevel',\r\n          },\r\n          count: { $sum: 1 },\r\n        },\r\n      },\r\n      {\r\n        $group: {\r\n          _id: '$_id.department',\r\n          compliance: {\r\n            $push: {\r\n              level: '$_id.complianceLevel',\r\n              count: '$count',\r\n            },\r\n          },\r\n          total: { $sum: '$count' },\r\n        },\r\n      },\r\n      { $sort: { _id: 1 } },\r\n    ]);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: report,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error generating compliance report',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\n// Audit findings trend\r\nrouter.get('/reports/findings-trend', authenticate, async (req, res) => {\r\n  try {\r\n    const { fromDate, toDate } = req.query;\r\n\r\n    const matchFilter = {};\r\n    if (fromDate || toDate) {\r\n      matchFilter.auditDate = {};\r\n      if (fromDate) matchFilter.auditDate.$gte = new Date(fromDate);\r\n      if (toDate) matchFilter.auditDate.$lte = new Date(toDate);\r\n    }\r\n\r\n    const trend = await QualityAudit.aggregate([\r\n      { $match: matchFilter },\r\n      { $unwind: '$findings' },\r\n      {\r\n        $group: {\r\n          _id: {\r\n            year: { $year: '$auditDate' },\r\n            month: { $month: '$auditDate' },\r\n            type: '$findings.type',\r\n          },\r\n          count: { $sum: 1 },\r\n        },\r\n      },\r\n      { $sort: { '_id.year': 1, '_id.month': 1 } },\r\n    ]);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: trend,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Error generating findings trend',\r\n      error: error.message,\r\n    });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]}