{"version":3,"names":["sendWhatsApp","to","message","accountSid","process","env","TWILIO_ACCOUNT_SID","authToken","TWILIO_AUTH_TOKEN","from","TWILIO_WHATSAPP_FROM","twilio","require","messages","create","body","startsWith","replace","err","multer","path","fs","uploadDir","join","__dirname","existsSync","mkdirSync","storage","diskStorage","destination","req","file","cb","filename","unique","Date","now","Math","round","random","originalname","upload","router","post","auth","single","res","status","json","error","url","name","type","mimetype","size","uploadedAt","use","express","static","Router","Template","requireAdmin","next","user","isAdmin","tpl","findById","params","id","populate","approvedBy","_id","approvedAt","rejectedBy","rejectedAt","rejectionReason","history","push","action","by","at","details","save","channels","createdBy","notificationChannels","inApp","email","sms","whatsapp","Notification","createNotification","userId","title","link","metadata","templateId","senderId","sendStatusChangeEmail","referenceNumber","subject","description","phone","sendSMS","e","reason","orgId","organizationId","get","query","$or","shared","category","language","keywords","$in","split","tpls","find","put","findOneAndUpdate","updatedAt","new","delete","findOneAndDelete","success","findByIdAndUpdate","$inc","usageCount","module","exports"],"sources":["templates.js"],"sourcesContent":["// إرسال رسالة WhatsApp عبر Twilio (مبسط)\r\nasync function sendWhatsApp(to, message) {\r\n  try {\r\n    const accountSid = process.env.TWILIO_ACCOUNT_SID;\r\n    const authToken = process.env.TWILIO_AUTH_TOKEN;\r\n    const from = process.env.TWILIO_WHATSAPP_FROM || 'whatsapp:+14155238886';\r\n    if (!accountSid || !authToken) return;\r\n    const twilio = require('twilio')(accountSid, authToken);\r\n    await twilio.messages.create({\r\n      body: message,\r\n      from,\r\n      to: to.startsWith('whatsapp:') ? to : 'whatsapp:' + to.replace(/^\\+/, ''),\r\n    });\r\n  } catch (err) {\r\n    /* ignore WhatsApp errors */\r\n  }\r\n}\r\n// دعم رفع الملفات\r\nconst multer = require('multer');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst uploadDir = path.join(__dirname, '../uploads');\r\nif (!fs.existsSync(uploadDir)) fs.mkdirSync(uploadDir);\r\nconst storage = multer.diskStorage({\r\n  destination: (req, file, cb) => cb(null, uploadDir),\r\n  filename: (req, file, cb) => {\r\n    const unique = Date.now() + '-' + Math.round(Math.random() * 1e9);\r\n    cb(null, unique + '-' + file.originalname.replace(/\\s+/g, '_'));\r\n  },\r\n});\r\nconst upload = multer({ storage });\r\n\r\n// رفع ملف مرفق (جميع الأنواع)\r\nrouter.post('/upload', auth, upload.single('file'), (req, res) => {\r\n  if (!req.file) return res.status(400).json({ error: 'لم يتم رفع أي ملف' });\r\n  const file = req.file;\r\n  const url = `/api/templates/attachments/${file.filename}`;\r\n  res.json({\r\n    name: file.originalname,\r\n    url,\r\n    type: file.mimetype,\r\n    size: file.size,\r\n    uploadedAt: new Date(),\r\n  });\r\n});\r\n// تقديم الملفات المرفقة مباشرة\r\nrouter.use('/attachments', express.static(uploadDir));\r\n// مسارات إدارة القوالب الذكية\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst Template = require('../models/Template');\r\nconst { auth } = require('../middleware/auth');\r\n\r\n// تحقق من صلاحية المسؤول\r\nfunction requireAdmin(req, res, next) {\r\n  if (!req.user || !req.user.isAdmin) return res.status(403).json({ error: 'صلاحية غير كافية' });\r\n  next();\r\n}\r\n// الموافقة على قالب\r\nrouter.post('/:id/approve', auth, requireAdmin, async (req, res) => {\r\n  try {\r\n    const tpl = await Template.findById(req.params.id).populate('createdBy', 'email name');\r\n    if (!tpl) return res.status(404).json({ error: 'القالب غير موجود' });\r\n    tpl.status = 'approved';\r\n    tpl.approvedBy = req.user._id;\r\n    tpl.approvedAt = new Date();\r\n    tpl.rejectedBy = null;\r\n    tpl.rejectedAt = null;\r\n    tpl.rejectionReason = null;\r\n    tpl.history = tpl.history || [];\r\n    tpl.history.push({ action: 'approved', by: req.user._id, at: new Date(), details: '' });\r\n    await tpl.save();\r\n    // إشعار لصاحب القالب (تحقق من إعدادات القنوات)\r\n    const channels = tpl.createdBy.notificationChannels || {\r\n      inApp: true,\r\n      email: true,\r\n      sms: true,\r\n      whatsapp: true,\r\n    };\r\n    // إشعار داخلي\r\n    if (channels.inApp !== false) {\r\n      try {\r\n        const Notification = require('../models/Notification');\r\n        await Notification.createNotification({\r\n          userId: tpl.createdBy._id,\r\n          title: 'تم اعتماد القالب',\r\n          message: `تم اعتماد القالب: ${tpl.title}`,\r\n          type: 'success',\r\n          link: `/templates/${tpl._id}`,\r\n          metadata: { templateId: tpl._id, status: 'approved' },\r\n          senderId: req.user._id,\r\n        });\r\n      } catch (err) {\r\n        /* ignore notification errors */\r\n      }\r\n    }\r\n    // بريد إلكتروني\r\n    if (channels.email !== false) {\r\n      try {\r\n        if (tpl.createdBy.email) {\r\n          const { sendStatusChangeEmail } = require('../../../backend/utils/emailService');\r\n          await sendStatusChangeEmail(\r\n            {\r\n              title: tpl.title,\r\n              referenceNumber: tpl._id,\r\n              subject: tpl.description || tpl.title,\r\n            },\r\n            tpl.createdBy.email,\r\n            'draft',\r\n            'approved'\r\n          );\r\n        }\r\n      } catch (err) {\r\n        /* ignore email errors */\r\n      }\r\n    }\r\n    // SMS\r\n    if (channels.sms !== false) {\r\n      try {\r\n        if (tpl.createdBy.phone) {\r\n          const { sendSMS } = require('../../../backend/services/smsService');\r\n          await sendSMS(tpl.createdBy.phone, `تم اعتماد القالب: ${tpl.title}`);\r\n        }\r\n      } catch (err) {\r\n        /* ignore sms errors */\r\n      }\r\n    }\r\n    // WhatsApp\r\n    if (channels.whatsapp !== false) {\r\n      try {\r\n        if (tpl.createdBy.phone) {\r\n          await sendWhatsApp(tpl.createdBy.phone, `تم اعتماد القالب: ${tpl.title}`);\r\n        }\r\n      } catch (err) {\r\n        /* ignore wa errors */\r\n      }\r\n    }\r\n    res.json(tpl);\r\n  } catch (e) {\r\n    res.status(500).json({ error: e.message });\r\n  }\r\n});\r\n\r\n// رفض قالب\r\nrouter.post('/:id/reject', auth, requireAdmin, async (req, res) => {\r\n  try {\r\n    const { reason } = req.body;\r\n    const tpl = await Template.findById(req.params.id).populate('createdBy', 'email name');\r\n    if (!tpl) return res.status(404).json({ error: 'القالب غير موجود' });\r\n    tpl.status = 'rejected';\r\n    tpl.rejectedBy = req.user._id;\r\n    tpl.rejectedAt = new Date();\r\n    tpl.rejectionReason = reason || '';\r\n    tpl.history = tpl.history || [];\r\n    tpl.history.push({ action: 'rejected', by: req.user._id, at: new Date(), details: reason });\r\n    await tpl.save();\r\n    // إشعار لصاحب القالب (تحقق من إعدادات القنوات)\r\n    const channels = tpl.createdBy.notificationChannels || {\r\n      inApp: true,\r\n      email: true,\r\n      sms: true,\r\n      whatsapp: true,\r\n    };\r\n    // إشعار داخلي\r\n    if (channels.inApp !== false) {\r\n      try {\r\n        const Notification = require('../models/Notification');\r\n        await Notification.createNotification({\r\n          userId: tpl.createdBy._id,\r\n          title: 'تم رفض القالب',\r\n          message: `تم رفض القالب: ${tpl.title}${reason ? ' - السبب: ' + reason : ''}`,\r\n          type: 'error',\r\n          link: `/templates/${tpl._id}`,\r\n          metadata: { templateId: tpl._id, status: 'rejected', reason },\r\n          senderId: req.user._id,\r\n        });\r\n      } catch (err) {\r\n        /* ignore notification errors */\r\n      }\r\n    }\r\n    // بريد إلكتروني\r\n    if (channels.email !== false) {\r\n      try {\r\n        if (tpl.createdBy.email) {\r\n          const { sendStatusChangeEmail } = require('../../../backend/utils/emailService');\r\n          await sendStatusChangeEmail(\r\n            {\r\n              title: tpl.title,\r\n              referenceNumber: tpl._id,\r\n              subject: tpl.description || tpl.title,\r\n            },\r\n            tpl.createdBy.email,\r\n            'draft',\r\n            'rejected'\r\n          );\r\n        }\r\n      } catch (err) {\r\n        /* ignore email errors */\r\n      }\r\n    }\r\n    // SMS\r\n    if (channels.sms !== false) {\r\n      try {\r\n        if (tpl.createdBy.phone) {\r\n          const { sendSMS } = require('../../../backend/services/smsService');\r\n          await sendSMS(\r\n            tpl.createdBy.phone,\r\n            `تم رفض القالب: ${tpl.title}${reason ? ' - السبب: ' + reason : ''}`\r\n          );\r\n        }\r\n      } catch (err) {\r\n        /* ignore sms errors */\r\n      }\r\n    }\r\n    // WhatsApp\r\n    if (channels.whatsapp !== false) {\r\n      try {\r\n        if (tpl.createdBy.phone) {\r\n          await sendWhatsApp(\r\n            tpl.createdBy.phone,\r\n            `تم رفض القالب: ${tpl.title}${reason ? ' - السبب: ' + reason : ''}`\r\n          );\r\n        }\r\n      } catch (err) {\r\n        /* ignore wa errors */\r\n      }\r\n    }\r\n    res.json(tpl);\r\n  } catch (e) {\r\n    res.status(500).json({ error: e.message });\r\n  }\r\n});\r\n\r\n// إنشاء قالب جديد\r\nrouter.post('/', auth, async (req, res) => {\r\n  try {\r\n    const tpl = await Template.create({\r\n      ...req.body,\r\n      createdBy: req.user._id,\r\n      orgId: req.user.organizationId,\r\n    });\r\n    res.status(201).json(tpl);\r\n  } catch (e) {\r\n    res.status(400).json({ error: e.message });\r\n  }\r\n});\r\n\r\n// جلب جميع القوالب (حسب الصلاحيات)\r\nrouter.get('/', auth, async (req, res) => {\r\n  try {\r\n    const query = {\r\n      $or: [{ shared: true }, { createdBy: req.user._id }, { orgId: req.user.organizationId }],\r\n    };\r\n    if (req.query.category) query.category = req.query.category;\r\n    if (req.query.language) query.language = req.query.language;\r\n    if (req.query.keywords) query.keywords = { $in: req.query.keywords.split(',') };\r\n    const tpls = await Template.find(query);\r\n    res.json(tpls);\r\n  } catch (e) {\r\n    res.status(500).json({ error: e.message });\r\n  }\r\n});\r\n\r\n// تحديث قالب\r\nrouter.put('/:id', auth, async (req, res) => {\r\n  try {\r\n    const tpl = await Template.findOneAndUpdate(\r\n      { _id: req.params.id, createdBy: req.user._id },\r\n      { ...req.body, updatedAt: Date.now() },\r\n      { new: true }\r\n    );\r\n    if (!tpl) return res.status(404).json({ error: 'Template not found or not allowed' });\r\n    res.json(tpl);\r\n  } catch (e) {\r\n    res.status(400).json({ error: e.message });\r\n  }\r\n});\r\n\r\n// حذف قالب\r\nrouter.delete('/:id', auth, async (req, res) => {\r\n  try {\r\n    const tpl = await Template.findOneAndDelete({ _id: req.params.id, createdBy: req.user._id });\r\n    if (!tpl) return res.status(404).json({ error: 'Template not found or not allowed' });\r\n    res.json({ success: true });\r\n  } catch (e) {\r\n    res.status(400).json({ error: e.message });\r\n  }\r\n});\r\n\r\n// زيادة عداد الاستخدام\r\nrouter.post('/:id/use', auth, async (req, res) => {\r\n  try {\r\n    await Template.findByIdAndUpdate(req.params.id, { $inc: { usageCount: 1 } });\r\n    res.json({ success: true });\r\n  } catch (e) {\r\n    res.status(400).json({ error: e.message });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]}