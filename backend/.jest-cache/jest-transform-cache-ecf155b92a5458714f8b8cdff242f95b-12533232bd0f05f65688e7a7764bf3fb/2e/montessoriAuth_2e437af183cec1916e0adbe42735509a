032965696c6445c88657434373826ce0
const jwt = require('jsonwebtoken');
const User = require('../models/User');

// التحقق من التوكن
function authenticateToken(req, res, next) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];
  if (!token) return res.sendStatus(401);
  jwt.verify(token, process.env.JWT_SECRET, (err, user) => {
    if (err) return res.sendStatus(403);
    req.user = user;
    next();
  });
}

// التحقق من الدور
function authorizeRoles(...roles) {
  return (req, res, next) => {
    if (!req.user || !roles.includes(req.user.role)) {
      return res.status(403).json({
        message: 'غير مصرح'
      });
    }
    next();
  };
}
module.exports = {
  authenticateToken,
  authorizeRoles
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiVXNlciIsImF1dGhlbnRpY2F0ZVRva2VuIiwicmVxIiwicmVzIiwibmV4dCIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwidG9rZW4iLCJzcGxpdCIsInNlbmRTdGF0dXMiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImVyciIsInVzZXIiLCJhdXRob3JpemVSb2xlcyIsInJvbGVzIiwiaW5jbHVkZXMiLCJyb2xlIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsibW9udGVzc29yaUF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xyXG5cclxuLy8g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNiq2YjZg9mGXHJcbmZ1bmN0aW9uIGF1dGhlbnRpY2F0ZVRva2VuKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzWydhdXRob3JpemF0aW9uJ107XHJcbiAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyICYmIGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXTtcclxuICBpZiAoIXRva2VuKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAxKTtcclxuICBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCAoZXJyLCB1c2VyKSA9PiB7XHJcbiAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnNlbmRTdGF0dXMoNDAzKTtcclxuICAgIHJlcS51c2VyID0gdXNlcjtcclxuICAgIG5leHQoKTtcclxuICB9KTtcclxufVxyXG5cclxuLy8g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNiv2YjYsVxyXG5mdW5jdGlvbiBhdXRob3JpemVSb2xlcyguLi5yb2xlcykge1xyXG4gIHJldHVybiAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIGlmICghcmVxLnVzZXIgfHwgIXJvbGVzLmluY2x1ZGVzKHJlcS51c2VyLnJvbGUpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICfYutmK2LEg2YXYtdix2K0nIH0pO1xyXG4gICAgfVxyXG4gICAgbmV4dCgpO1xyXG4gIH07XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0geyBhdXRoZW50aWNhdGVUb2tlbiwgYXV0aG9yaXplUm9sZXMgfTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbkMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7O0FBRXRDO0FBQ0EsU0FBU0UsaUJBQWlCQSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxFQUFFO0VBQ3pDLE1BQU1DLFVBQVUsR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUMsZUFBZSxDQUFDO0VBQy9DLE1BQU1DLEtBQUssR0FBR0YsVUFBVSxJQUFJQSxVQUFVLENBQUNHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7RUFDcEQsSUFBSSxDQUFDRCxLQUFLLEVBQUUsT0FBT0osR0FBRyxDQUFDTSxVQUFVLENBQUMsR0FBRyxDQUFDO0VBQ3RDWCxHQUFHLENBQUNZLE1BQU0sQ0FBQ0gsS0FBSyxFQUFFSSxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxFQUFFLENBQUNDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0lBQ3ZELElBQUlELEdBQUcsRUFBRSxPQUFPWCxHQUFHLENBQUNNLFVBQVUsQ0FBQyxHQUFHLENBQUM7SUFDbkNQLEdBQUcsQ0FBQ2EsSUFBSSxHQUFHQSxJQUFJO0lBQ2ZYLElBQUksQ0FBQyxDQUFDO0VBQ1IsQ0FBQyxDQUFDO0FBQ0o7O0FBRUE7QUFDQSxTQUFTWSxjQUFjQSxDQUFDLEdBQUdDLEtBQUssRUFBRTtFQUNoQyxPQUFPLENBQUNmLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7SUFDekIsSUFBSSxDQUFDRixHQUFHLENBQUNhLElBQUksSUFBSSxDQUFDRSxLQUFLLENBQUNDLFFBQVEsQ0FBQ2hCLEdBQUcsQ0FBQ2EsSUFBSSxDQUFDSSxJQUFJLENBQUMsRUFBRTtNQUMvQyxPQUFPaEIsR0FBRyxDQUFDaUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7UUFBRUMsT0FBTyxFQUFFO01BQVcsQ0FBQyxDQUFDO0lBQ3REO0lBQ0FsQixJQUFJLENBQUMsQ0FBQztFQUNSLENBQUM7QUFDSDtBQUVBbUIsTUFBTSxDQUFDQyxPQUFPLEdBQUc7RUFBRXZCLGlCQUFpQjtFQUFFZTtBQUFlLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=