{"version":3,"names":["mongoose","require","processScheduledNotifications","startScheduledNotificationsJob","setTimeout","setInterval","connection","readyState","console","log","err","name","message","includes","error","module","exports"],"sources":["scheduledNotificationsJob.js"],"sourcesContent":["const mongoose = require('mongoose');\r\nconst processScheduledNotifications = require('./processScheduledNotifications');\r\n\r\n// جدولة تنفيذ الإشعارات المجدولة كل دقيقة\r\nfunction startScheduledNotificationsJob() {\r\n  // تأخير البداية لتجنب التضارب مع تهيئة قاعدة البيانات\r\n  setTimeout(() => {\r\n    setInterval(async () => {\r\n      try {\r\n        // تحقق من أن قاعدة البيانات متصلة\r\n        // readyState: 0 = disconnected, 1 = connected, 2 = connecting, 3 = disconnecting\r\n        if (mongoose.connection.readyState !== 1) {\r\n          console.log('⏭️  MongoDB not connected, skipping scheduled notifications');\r\n          return;\r\n        }\r\n\r\n        await processScheduledNotifications();\r\n      } catch (err) {\r\n        if (err.name === 'MongooseError' && err.message?.includes('buffering timed out')) {\r\n          // صامت بشأن timeout errors\r\n        } else {\r\n          console.error('❌ Scheduled notifications job error:', err.message);\r\n        }\r\n      }\r\n    }, 60 * 1000); // كل دقيقة\r\n  }, 5000); // تأخير 5 ثواني قبل البدء\r\n}\r\n\r\nmodule.exports = startScheduledNotificationsJob;\r\n"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AACpC,MAAMC,6BAA6B,GAAGD,OAAO,CAAC,iCAAiC,CAAC;;AAEhF;AACA,SAASE,8BAA8BA,CAAA,EAAG;EACxC;EACAC,UAAU,CAAC,MAAM;IACfC,WAAW,CAAC,YAAY;MACtB,IAAI;QACF;QACA;QACA,IAAIL,QAAQ,CAACM,UAAU,CAACC,UAAU,KAAK,CAAC,EAAE;UACxCC,OAAO,CAACC,GAAG,CAAC,6DAA6D,CAAC;UAC1E;QACF;QAEA,MAAMP,6BAA6B,CAAC,CAAC;MACvC,CAAC,CAAC,OAAOQ,GAAG,EAAE;QACZ,IAAIA,GAAG,CAACC,IAAI,KAAK,eAAe,IAAID,GAAG,CAACE,OAAO,EAAEC,QAAQ,CAAC,qBAAqB,CAAC,EAAE;UAChF;QAAA,CACD,MAAM;UACLL,OAAO,CAACM,KAAK,CAAC,sCAAsC,EAAEJ,GAAG,CAACE,OAAO,CAAC;QACpE;MACF;IACF,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC;EACjB,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;AACZ;AAEAG,MAAM,CAACC,OAAO,GAAGb,8BAA8B","ignoreList":[]}