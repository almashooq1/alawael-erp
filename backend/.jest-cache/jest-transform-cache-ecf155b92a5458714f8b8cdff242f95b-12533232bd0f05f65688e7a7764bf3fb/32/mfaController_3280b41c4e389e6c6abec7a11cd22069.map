{"version":3,"names":["crypto","require","mfaService","emailService","smsService","MFASettings","MFASession","OTPLog","MFAAuditLog","TrustedDevice","_MFARecoveryLog","User","exports","getMFASetupGuide","req","res","guide","status","json","success","data","error","message","initiateTOTPSetup","userId","user","_id","totpData","generateTOTPSecret","email","mfaSettings","findOne","create","action","method","details","reason","ipAddress","ip","userAgent","get","qrCode","manualEntryKey","secret","setupInstructions","step1","step2","step3","step4","verifyAndEnableTOTP","token","body","isValid","verifyTOTP","backupCodes","generateBackupCodes","hashedBackupCodes","map","code","hashBackupCode","used","_mfaSettings","findOneAndUpdate","$set","totp","enabled","verifiedAt","Date","backupCodesGenerated","primaryMethod","$push","$each","new","upsert","findByIdAndUpdate","twoFactorEnabled","twoFactorSecret","initiateEmailOTP","findById","otpData","generateEmailOTP","otpHash","createHash","update","digest","recipient","expiresAt","sendOTPEmail","name","purpose","expiresIn","substring","verifyAndEnableEmailOTP","otpLog","sort","createdAt","_codeHash","verification","verifyOTP","verificationAttempts","save","emailOTP","initiateSMSOTP","phoneNumber","countryCode","generateSMSOTP","fullPhoneNumber","sendOTP","verifyAndEnableSMSOTP","smsOTP","verifyMFALogin","sessionId","mfaSession","validation","validateMFASession","select","backupCode","find","bc","verifyBackupCode","usedAt","attempts","attemptsRemaining","verified","getMFASettings","secureSettings","toObject","recovery","recoveryKey","disableMFAMethod","includes","enabledMethods","filter","Boolean","length","methodField","updateData","_updated","trustDevice","deviceName","deviceFingerprint","deviceToken","generateTrustedDeviceToken","_trustedDevice","deviceId","randomBytes","toString","fingerprint","getTrustedDevices","devices","isActive","$gt","revokeTrustedDevice","params","device","revokedAt","revokeReason","module"],"sources":["mfaController.js"],"sourcesContent":["/**\r\n * MFA Controller\r\n * تحكم المصادقة متعددة العوامل\r\n */\r\n\r\nconst crypto = require('crypto');\r\nconst mfaService = require('../services/mfaService');\r\nconst emailService = require('../services/emailService');\r\nconst smsService = require('../services/smsService');\r\nconst {\r\n  MFASettings,\r\n  MFASession,\r\n  OTPLog,\r\n  MFAAuditLog,\r\n  TrustedDevice,\r\n  _MFARecoveryLog,\r\n} = require('../models/mfa.models');\r\nconst { User } = require('../models/schemas');\r\n\r\n// ============ SETUP ENDPOINTS ============\r\n\r\n/**\r\n * Get MFA Setup Guide\r\n * الحصول على دليل إعداد MFA\r\n */\r\nexports.getMFASetupGuide = async (req, res) => {\r\n  try {\r\n    const guide = mfaService.getMFASetupGuide();\r\n    res.status(200).json({\r\n      success: true,\r\n      data: guide,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Initialize TOTP Setup\r\n * بدء إعداد TOTP\r\n */\r\nexports.initiateTOTPSetup = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n\r\n    // Generate TOTP secret and QR code\r\n    const totpData = await mfaService.generateTOTPSecret(req.user.email);\r\n\r\n    // Create MFA settings if doesn't exist\r\n    let mfaSettings = await MFASettings.findOne({ userId });\r\n    if (!mfaSettings) {\r\n      mfaSettings = await MFASettings.create({ userId });\r\n    }\r\n\r\n    // Log the setup initiation\r\n    await MFAAuditLog.create({\r\n      userId,\r\n      action: 'mfa_setup',\r\n      status: 'success',\r\n      method: 'totp',\r\n      details: {\r\n        reason: 'User initiated TOTP setup',\r\n      },\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'TOTP setup initiated',\r\n      data: {\r\n        qrCode: totpData.qrCode,\r\n        manualEntryKey: totpData.manualEntryKey,\r\n        secret: totpData.secret,\r\n        setupInstructions: {\r\n          step1: 'Download an authenticator app',\r\n          step2: 'Scan the QR code or enter the manual key',\r\n          step3: 'Enter the 6-digit code to verify',\r\n          step4: 'Save your backup codes in a safe place',\r\n        },\r\n      },\r\n    });\r\n  } catch (error) {\r\n    await MFAAuditLog.create({\r\n      userId: req.user._id,\r\n      action: 'mfa_setup',\r\n      status: 'failed',\r\n      method: 'totp',\r\n      error: error.message,\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Verify TOTP and Enable\r\n * التحقق من TOTP وتفعيله\r\n */\r\nexports.verifyAndEnableTOTP = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const { token, secret } = req.body;\r\n\r\n    if (!token || !secret) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Token and secret are required',\r\n      });\r\n    }\r\n\r\n    // Verify TOTP token\r\n    const isValid = mfaService.verifyTOTP(token, secret);\r\n    if (!isValid) {\r\n      await MFAAuditLog.create({\r\n        userId,\r\n        action: 'verification_failed',\r\n        status: 'failed',\r\n        method: 'totp',\r\n        error: 'Invalid TOTP token',\r\n        ipAddress: req.ip,\r\n        userAgent: req.get('user-agent'),\r\n      });\r\n\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Invalid TOTP token',\r\n      });\r\n    }\r\n\r\n    // Generate backup codes\r\n    const backupCodes = mfaService.generateBackupCodes();\r\n    const hashedBackupCodes = backupCodes.map((code) => ({\r\n      code: mfaService.hashBackupCode(code),\r\n      used: false,\r\n    }));\r\n\r\n    // Update MFA settings\r\n    let _mfaSettings = await MFASettings.findOneAndUpdate(\r\n      { userId },\r\n      {\r\n        $set: {\r\n          totp: {\r\n            enabled: true,\r\n            secret,\r\n            verifiedAt: new Date(),\r\n            backupCodesGenerated: true,\r\n          },\r\n          primaryMethod: 'totp',\r\n        },\r\n        $push: {\r\n          backupCodes: { $each: hashedBackupCodes },\r\n        },\r\n      },\r\n      { new: true, upsert: true }\r\n    );\r\n\r\n    // Update user\r\n    await User.findByIdAndUpdate(userId, {\r\n      twoFactorEnabled: true,\r\n      twoFactorSecret: secret,\r\n    });\r\n\r\n    // Log success\r\n    await MFAAuditLog.create({\r\n      userId,\r\n      action: 'mfa_enable',\r\n      status: 'success',\r\n      method: 'totp',\r\n      details: {\r\n        reason: 'User enabled TOTP authentication',\r\n      },\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'TOTP enabled successfully',\r\n      data: {\r\n        backupCodes,\r\n        message: 'Save these backup codes in a safe place. You can use them to regain access if you lose your authenticator.',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Start Email OTP Verification\r\n * بدء التحقق من OTP عبر البريد الإلكتروني\r\n */\r\nexports.initiateEmailOTP = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const user = await User.findById(userId);\r\n\r\n    // Generate OTP\r\n    const otpData = mfaService.generateEmailOTP();\r\n\r\n    // Hash OTP for storage\r\n    const otpHash = crypto.createHash('sha256').update(otpData.code).digest('hex');\r\n\r\n    // Create MFA settings if doesn't exist\r\n    let mfaSettings = await MFASettings.findOne({ userId });\r\n    if (!mfaSettings) {\r\n      mfaSettings = await MFASettings.create({ userId });\r\n    }\r\n\r\n    // Log OTP\r\n    await OTPLog.create({\r\n      userId,\r\n      method: 'email',\r\n      recipient: user.email,\r\n      otpHash,\r\n      expiresAt: otpData.expiresAt,\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n      reason: 'mfa_setup',\r\n    });\r\n\r\n    // Send OTP email\r\n    await emailService.sendOTPEmail(user.email, otpData.code, {\r\n      name: user.name,\r\n      purpose: 'Multi-Factor Authentication Setup',\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'OTP sent to your email',\r\n      data: {\r\n        expiresIn: otpData.expiresIn,\r\n        recipient: `${user.email.substring(0, 5)}***`,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Verify Email OTP and Enable\r\n * التحقق من OTP البريدي وتفعيله\r\n */\r\nexports.verifyAndEnableEmailOTP = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const { code } = req.body;\r\n\r\n    if (!code) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'OTP code is required',\r\n      });\r\n    }\r\n\r\n    // Find the most recent OTP log\r\n    const otpLog = await OTPLog.findOne({ userId, method: 'email' })\r\n      .sort({ createdAt: -1 });\r\n\r\n    if (!otpLog) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'No OTP request found',\r\n      });\r\n    }\r\n\r\n    // Verify OTP\r\n    const _codeHash = crypto.createHash('sha256').update(code).digest('hex');\r\n    const verification = mfaService.verifyOTP(code, otpLog.otpHash, otpLog.expiresAt);\r\n\r\n    if (!verification.isValid) {\r\n      otpLog.verificationAttempts += 1;\r\n      await otpLog.save();\r\n\r\n      await MFAAuditLog.create({\r\n        userId,\r\n        action: 'verification_failed',\r\n        status: 'failed',\r\n        method: 'email',\r\n        error: verification.message,\r\n        ipAddress: req.ip,\r\n        userAgent: req.get('user-agent'),\r\n      });\r\n\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: verification.message,\r\n      });\r\n    }\r\n\r\n    // Update OTP log\r\n    otpLog.status = 'verified';\r\n    otpLog.verifiedAt = new Date();\r\n    await otpLog.save();\r\n\r\n    // Update MFA settings\r\n    let _mfaSettings = await MFASettings.findOneAndUpdate(\r\n      { userId },\r\n      {\r\n        $set: {\r\n          emailOTP: {\r\n            enabled: true,\r\n            verifiedAt: new Date(),\r\n          },\r\n          primaryMethod: 'email',\r\n        },\r\n      },\r\n      { new: true, upsert: true }\r\n    );\r\n\r\n    // Log success\r\n    await MFAAuditLog.create({\r\n      userId,\r\n      action: 'mfa_enable',\r\n      status: 'success',\r\n      method: 'email',\r\n      details: {\r\n        reason: 'User enabled Email OTP authentication',\r\n      },\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Email OTP enabled successfully',\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Initiate SMS OTP Verification\r\n * بدء التحقق من OTP عبر الرسائل النصية\r\n */\r\nexports.initiateSMSOTP = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const { phoneNumber, countryCode } = req.body;\r\n\r\n    if (!phoneNumber || !countryCode) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Phone number and country code are required',\r\n      });\r\n    }\r\n\r\n    const user = await User.findById(userId);\r\n\r\n    // Generate OTP\r\n    const otpData = mfaService.generateSMSOTP();\r\n    const otpHash = crypto.createHash('sha256').update(otpData.code).digest('hex');\r\n\r\n    // Create MFA settings if doesn't exist\r\n    let mfaSettings = await MFASettings.findOne({ userId });\r\n    if (!mfaSettings) {\r\n      mfaSettings = await MFASettings.create({ userId });\r\n    }\r\n\r\n    // Log OTP\r\n    await OTPLog.create({\r\n      userId,\r\n      method: 'sms',\r\n      recipient: phoneNumber,\r\n      otpHash,\r\n      expiresAt: otpData.expiresAt,\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n      reason: 'mfa_setup',\r\n    });\r\n\r\n    // Send OTP SMS\r\n    const fullPhoneNumber = `${countryCode}${phoneNumber}`;\r\n    await smsService.sendOTP(fullPhoneNumber, otpData.code, {\r\n      name: user.name,\r\n      purpose: 'Multi-Factor Authentication',\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'OTP sent to your phone',\r\n      data: {\r\n        expiresIn: otpData.expiresIn,\r\n        recipient: `${phoneNumber.substring(0, 3)}***`,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Verify SMS OTP and Enable\r\n * التحقق من OTP الرسائل النصية وتفعيله\r\n */\r\nexports.verifyAndEnableSMSOTP = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const { code, phoneNumber, countryCode } = req.body;\r\n\r\n    if (!code || !phoneNumber || !countryCode) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Code, phone number, and country code are required',\r\n      });\r\n    }\r\n\r\n    // Find the most recent OTP log\r\n    const otpLog = await OTPLog.findOne({ userId, method: 'sms' })\r\n      .sort({ createdAt: -1 });\r\n\r\n    if (!otpLog) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'No OTP request found',\r\n      });\r\n    }\r\n\r\n    // Verify OTP\r\n    const verification = mfaService.verifyOTP(code, otpLog.otpHash, otpLog.expiresAt);\r\n\r\n    if (!verification.isValid) {\r\n      otpLog.verificationAttempts += 1;\r\n      await otpLog.save();\r\n\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: verification.message,\r\n      });\r\n    }\r\n\r\n    // Update OTP log\r\n    otpLog.status = 'verified';\r\n    otpLog.verifiedAt = new Date();\r\n    await otpLog.save();\r\n\r\n    // Update MFA settings\r\n    const _mfaSettings = await MFASettings.findOneAndUpdate(\r\n      { userId },\r\n      {\r\n        $set: {\r\n          smsOTP: {\r\n            enabled: true,\r\n            phoneNumber,\r\n            countryCode,\r\n            verifiedAt: new Date(),\r\n          },\r\n          primaryMethod: 'sms',\r\n        },\r\n      },\r\n      { new: true, upsert: true }\r\n    );\r\n\r\n    // Log success\r\n    await MFAAuditLog.create({\r\n      userId,\r\n      action: 'mfa_enable',\r\n      status: 'success',\r\n      method: 'sms',\r\n      details: {\r\n        reason: 'User enabled SMS OTP authentication',\r\n        phoneNumber,\r\n      },\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'SMS OTP enabled successfully',\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n// ============ VERIFICATION ENDPOINTS ============\r\n\r\n/**\r\n * Verify MFA During Login\r\n * التحقق من MFA أثناء تسجيل الدخول\r\n */\r\nexports.verifyMFALogin = async (req, res) => {\r\n  try {\r\n    const { sessionId, token, method } = req.body;\r\n\r\n    if (!sessionId || !token || !method) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Session ID, token, and method are required',\r\n      });\r\n    }\r\n\r\n    // Find MFA session\r\n    const mfaSession = await MFASession.findOne({ sessionId });\r\n    if (!mfaSession) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Invalid MFA session',\r\n      });\r\n    }\r\n\r\n    // Validate session\r\n    const validation = mfaService.validateMFASession(mfaSession);\r\n    if (!validation.isValid) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: validation.message,\r\n      });\r\n    }\r\n\r\n    // Get user and MFA settings\r\n    const user = await User.findById(mfaSession.userId).select('+twoFactorSecret');\r\n    const mfaSettings = await MFASettings.findOne({ userId: mfaSession.userId });\r\n\r\n    let isValid = false;\r\n\r\n    // Verify based on method\r\n    if (method === 'totp') {\r\n      isValid = mfaService.verifyTOTP(token, user.twoFactorSecret);\r\n    } else if (method === 'backup') {\r\n      // Verify backup code\r\n      const backupCode = mfaSettings.backupCodes.find(\r\n        (bc) => !bc.used && mfaService.verifyBackupCode(token, bc.code)\r\n      );\r\n      if (backupCode) {\r\n        backupCode.used = true;\r\n        backupCode.usedAt = new Date();\r\n        await mfaSettings.save();\r\n        isValid = true;\r\n\r\n        // Log backup code usage\r\n        await MFAAuditLog.create({\r\n          userId: mfaSession.userId,\r\n          action: 'backup_code_used',\r\n          status: 'success',\r\n          ipAddress: req.ip,\r\n          userAgent: req.get('user-agent'),\r\n        });\r\n      }\r\n    }\r\n\r\n    if (!isValid) {\r\n      mfaSession.attempts += 1;\r\n      await mfaSession.save();\r\n\r\n      await MFAAuditLog.create({\r\n        userId: mfaSession.userId,\r\n        action: 'verification_failed',\r\n        status: 'failed',\r\n        method,\r\n        error: 'Invalid MFA token',\r\n        ipAddress: req.ip,\r\n        userAgent: req.get('user-agent'),\r\n      });\r\n\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Invalid MFA token',\r\n        attemptsRemaining: validation.attemptsRemaining - 1,\r\n      });\r\n    }\r\n\r\n    // MFA verified\r\n    mfaSession.status = 'verified';\r\n    mfaSession.verifiedAt = new Date();\r\n    await mfaSession.save();\r\n\r\n    // Log success\r\n    await MFAAuditLog.create({\r\n      userId: mfaSession.userId,\r\n      action: 'verification_success',\r\n      status: 'success',\r\n      method,\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'MFA verification successful',\r\n      data: {\r\n        sessionId,\r\n        userId: mfaSession.userId,\r\n        verified: true,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n// ============ SETTINGS ENDPOINTS ============\r\n\r\n/**\r\n * Get MFA Settings\r\n * الحصول على إعدادات MFA\r\n */\r\nexports.getMFASettings = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n\r\n    let mfaSettings = await MFASettings.findOne({ userId });\r\n    if (!mfaSettings) {\r\n      mfaSettings = await MFASettings.create({ userId });\r\n    }\r\n\r\n    // Remove sensitive data\r\n    const secureSettings = mfaSettings.toObject();\r\n    if (secureSettings.totp) delete secureSettings.totp.secret;\r\n    if (secureSettings.recovery) delete secureSettings.recovery.recoveryKey;\r\n    secureSettings.backupCodes = secureSettings.backupCodes.map(({ used, usedAt }) => ({\r\n      used,\r\n      usedAt,\r\n    }));\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      data: secureSettings,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Disable MFA Method\r\n * تعطيل طريقة MFA\r\n */\r\nexports.disableMFAMethod = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const { method } = req.body;\r\n\r\n    if (!['totp', 'email', 'sms'].includes(method)) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Invalid MFA method',\r\n      });\r\n    }\r\n\r\n    const mfaSettings = await MFASettings.findOne({ userId });\r\n\r\n    // Cannot disable all methods\r\n    const enabledMethods = [\r\n      mfaSettings?.totp?.enabled,\r\n      mfaSettings?.emailOTP?.enabled,\r\n      mfaSettings?.smsOTP?.enabled,\r\n    ].filter(Boolean);\r\n\r\n    if (enabledMethods.length <= 1) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'At least one MFA method must remain enabled',\r\n      });\r\n    }\r\n\r\n    // Disable method\r\n    const methodField = method === 'totp' ? 'totp' : method === 'email' ? 'emailOTP' : 'smsOTP';\r\n    const updateData = {};\r\n    updateData[`${methodField}.enabled`] = false;\r\n\r\n    const _updated = await MFASettings.findOneAndUpdate(\r\n      { userId },\r\n      { $set: updateData },\r\n      { new: true }\r\n    );\r\n\r\n    // Log action\r\n    await MFAAuditLog.create({\r\n      userId,\r\n      action: 'mfa_disable',\r\n      status: 'success',\r\n      method,\r\n      details: {\r\n        reason: `User disabled ${method} authentication`,\r\n      },\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: `${method} MFA method disabled successfully`,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n// ============ TRUSTED DEVICE ENDPOINTS ============\r\n\r\n/**\r\n * Trust Current Device\r\n * وضع علامة على الجهاز الحالي كموثوق\r\n */\r\nexports.trustDevice = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const { deviceName, deviceFingerprint } = req.body;\r\n\r\n    if (!deviceFingerprint) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: 'Device fingerprint is required',\r\n      });\r\n    }\r\n\r\n    // Generate device token\r\n    const deviceToken = mfaService.generateTrustedDeviceToken(userId, deviceFingerprint);\r\n\r\n    const _trustedDevice = await TrustedDevice.create({\r\n      userId,\r\n      deviceId: crypto.randomBytes(12).toString('hex'),\r\n      deviceName: deviceName || 'Unknown Device',\r\n      fingerprint: deviceFingerprint,\r\n      token: deviceToken.token,\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n      expiresAt: deviceToken.expiresAt,\r\n    });\r\n\r\n    // Log action\r\n    await MFAAuditLog.create({\r\n      userId,\r\n      action: 'device_trusted',\r\n      status: 'success',\r\n      details: {\r\n        deviceName: deviceName || 'Unknown Device',\r\n      },\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Device trusted successfully',\r\n      data: {\r\n        deviceToken: deviceToken.token,\r\n        expiresAt: deviceToken.expiresAt,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Get Trusted Devices\r\n * الحصول على قائمة الأجهزة الموثوقة\r\n */\r\nexports.getTrustedDevices = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n\r\n    const devices = await TrustedDevice.find({\r\n      userId,\r\n      isActive: true,\r\n      expiresAt: { $gt: new Date() },\r\n    }).select('-token');\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      data: devices,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Revoke Trusted Device\r\n * إلغاء وضع العلامة على جهاز\r\n */\r\nexports.revokeTrustedDevice = async (req, res) => {\r\n  try {\r\n    const userId = req.user._id;\r\n    const { deviceId } = req.params;\r\n\r\n    const device = await TrustedDevice.findOneAndUpdate(\r\n      { _id: deviceId, userId },\r\n      {\r\n        isActive: false,\r\n        revokedAt: new Date(),\r\n        revokeReason: 'User revoked trust',\r\n      },\r\n      { new: true }\r\n    );\r\n\r\n    if (!device) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'Device not found',\r\n      });\r\n    }\r\n\r\n    // Log action\r\n    await MFAAuditLog.create({\r\n      userId,\r\n      action: 'device_revoked',\r\n      status: 'success',\r\n      details: {\r\n        deviceName: device.deviceName,\r\n      },\r\n      ipAddress: req.ip,\r\n      userAgent: req.get('user-agent'),\r\n    });\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Device revoked successfully',\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: error.message,\r\n    });\r\n  }\r\n};\r\n\r\nmodule.exports = exports;\r\n"],"mappings":"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","ignoreList":[]}