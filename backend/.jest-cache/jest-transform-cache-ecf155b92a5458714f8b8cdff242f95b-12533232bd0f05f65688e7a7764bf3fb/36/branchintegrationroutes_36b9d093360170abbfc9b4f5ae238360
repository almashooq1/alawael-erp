630e15a0d8fc438a0adaff0d0f8a8a11
/**
 * Branch-ERP Integration Routes
 * Handles all integration endpoints between ERP and Advanced Branch Management System
 * Version: 2.0.0
 * Date: February 18, 2026
 */

const express = require('express');
const router = express.Router();
const {
  BranchERPIntegrationService
} = require('../integration/erp-branch-integration');

// Initialize integration service
const integrationService = new BranchERPIntegrationService();

// Track sync statistics
integrationService.lastSyncTime = null;
integrationService.syncCount = 0;

// =============================================
// MIDDLEWARE
// =============================================

/**
 * Verify API key for integration endpoints
 */
const verifyIntegrationKey = (req, res, next) => {
  const apiKey = req.headers['x-integration-key'] || req.headers['authorization']?.replace('Bearer ', '');
  if (!apiKey || apiKey !== process.env.INTEGRATION_SECRET_KEY) {
    return res.status(401).json({
      success: false,
      error: 'Invalid or missing integration API key',
      timestamp: new Date().toISOString()
    });
  }
  next();
};

// =============================================
// PUBLIC ENDPOINTS (No Auth Required)
// =============================================

/**
 * Health Check Endpoint
 * GET /api/integration/health
 */
router.get('/health', (req, res) => {
  try {
    return res.status(200).json({
      success: true,
      status: 'healthy',
      service: 'Branch-ERP Integration Service',
      version: '2.0.0',
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    return res.status(500).json({
      success: false,
      status: 'unhealthy',
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Get Integration Status
 * GET /api/integration/status
 */
router.get('/status', async (req, res) => {
  try {
    const status = {
      success: true,
      status: 'operational',
      service: 'Branch-ERP Integration Service',
      version: '2.0.0',
      timestamp: new Date().toISOString(),
      endpoints: {
        sync: 'POST /api/integration/sync/branches',
        kpis: 'GET /api/integration/branches/:branchId/kpis',
        inventory: 'GET /api/integration/branches/:branchId/inventory-sync',
        reports: 'GET /api/integration/branches/:branchId/reports/:reportType',
        forecasts: 'GET /api/integration/branches/:branchId/forecasts',
        dashboard: 'GET /api/integration/branches/:branchId/dashboard'
      },
      authentication: process.env.INTEGRATION_SECRET_KEY ? 'required' : 'disabled'
    };
    return res.status(200).json(status);
  } catch (error) {
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

// =============================================
// PROTECTED ENDPOINTS (Auth Required)
// =============================================

// Apply auth middleware to protected routes (optional based on config)
if (process.env.REQUIRE_INTEGRATION_AUTH === 'true') {
  router.use(verifyIntegrationKey);
}

/**
 * Sync Branches to ERP
 * POST /api/integration/sync/branches
 * Manually trigger branch data synchronization
 */
router.post('/sync/branches', async (req, res) => {
  try {
    const result = await integrationService.syncBranchesToERP();
    integrationService.lastSyncTime = new Date();
    integrationService.syncCount = (integrationService.syncCount || 0) + 1;
    return res.status(200).json({
      success: result.success,
      message: `Synced ${result.synced_count} branches`,
      data: result,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Sync error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Get Branch Performance Metrics (KPIs)
 * GET /api/integration/branches/:branchId/kpis
 */
router.get('/branches/:branchId/kpis', async (req, res) => {
  try {
    const {
      branchId
    } = req.params;
    if (!branchId) {
      return res.status(400).json({
        success: false,
        error: 'Branch ID is required',
        timestamp: new Date().toISOString()
      });
    }
    const metrics = await integrationService.getBranchPerformanceMetrics(branchId);
    return res.status(200).json({
      success: true,
      data: metrics,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('KPI retrieval error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Get Branch Inventory Data
 * GET /api/integration/branches/:branchId/inventory-sync
 */
router.get('/branches/:branchId/inventory-sync', async (req, res) => {
  try {
    const {
      branchId
    } = req.params;
    if (!branchId) {
      return res.status(400).json({
        success: false,
        error: 'Branch ID is required',
        timestamp: new Date().toISOString()
      });
    }
    const inventory = await integrationService.getBranchInventory(branchId);
    return res.status(200).json({
      success: true,
      data: inventory,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Inventory retrieval error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Get Branch Reports
 * GET /api/integration/branches/:branchId/reports/:reportType
 * Report types: OPERATIONAL, FINANCIAL, QUALITY
 */
router.get('/branches/:branchId/reports/:reportType', async (req, res) => {
  try {
    const {
      branchId,
      reportType
    } = req.params;
    if (!branchId || !reportType) {
      return res.status(400).json({
        success: false,
        error: 'Branch ID and report type are required',
        timestamp: new Date().toISOString()
      });
    }
    const validTypes = ['OPERATIONAL', 'FINANCIAL', 'QUALITY'];
    if (!validTypes.includes(reportType)) {
      return res.status(400).json({
        success: false,
        error: `Invalid report type. Allowed: ${validTypes.join(', ')}`,
        timestamp: new Date().toISOString()
      });
    }
    const report = await integrationService.getBranchReports(branchId, reportType);
    return res.status(200).json({
      success: true,
      data: report,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Report retrieval error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Get Branch Forecasts
 * GET /api/integration/branches/:branchId/forecasts
 * Includes demand, budget, and performance predictions
 */
router.get('/branches/:branchId/forecasts', async (req, res) => {
  try {
    const {
      branchId
    } = req.params;
    if (!branchId) {
      return res.status(400).json({
        success: false,
        error: 'Branch ID is required',
        timestamp: new Date().toISOString()
      });
    }
    const forecasts = await integrationService.getBranchForecasts(branchId);
    return res.status(200).json({
      success: true,
      data: forecasts,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Forecast retrieval error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Get Comprehensive Branch Dashboard
 * GET /api/integration/branches/:branchId/dashboard
 * Aggregates KPIs, inventory, reports, and forecasts
 */
router.get('/branches/:branchId/dashboard', async (req, res) => {
  try {
    const {
      branchId
    } = req.params;
    if (!branchId) {
      return res.status(400).json({
        success: false,
        error: 'Branch ID is required',
        timestamp: new Date().toISOString()
      });
    }

    // Fetch all dashboard components in parallel
    const [kpis, inventory, reports, forecasts] = await Promise.all([integrationService.getBranchPerformanceMetrics(branchId), integrationService.getBranchInventory(branchId), integrationService.getBranchReports(branchId, 'FINANCIAL'), integrationService.getBranchForecasts(branchId)]).catch(error => {
      console.error('Dashboard aggregation error:', error);
      return [null, null, null, null];
    });
    return res.status(200).json({
      success: true,
      data: {
        branchId,
        timestamp: new Date().toISOString(),
        components: {
          kpis,
          inventory,
          financialReport: reports,
          forecasts
        }
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Dashboard retrieval error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Start Continuous Sync (if enabled)
 * POST /api/integration/sync/start
 */
router.post('/sync/start', async (req, res) => {
  try {
    if (process.env.ENABLE_CONTINUOUS_SYNC !== 'true') {
      return res.status(400).json({
        success: false,
        error: 'Continuous sync is not enabled. Set ENABLE_CONTINUOUS_SYNC=true',
        timestamp: new Date().toISOString()
      });
    }
    integrationService.startContinuousSync();
    return res.status(200).json({
      success: true,
      message: 'Continuous sync started',
      interval: `${integrationService.syncInterval}ms`,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Sync start error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Stop Continuous Sync
 * POST /api/integration/sync/stop
 */
router.post('/sync/stop', async (req, res) => {
  try {
    integrationService.stopContinuousSync();
    return res.status(200).json({
      success: true,
      message: 'Continuous sync stopped',
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Sync stop error:', error);
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

/**
 * Get Sync Status
 * GET /api/integration/sync/status
 */
router.get('/sync/status', async (req, res) => {
  try {
    const status = {
      success: true,
      syncStatus: {
        enabled: process.env.ENABLE_CONTINUOUS_SYNC === 'true',
        interval: `${integrationService.syncInterval}ms`,
        nextSync: new Date(Date.now() + integrationService.syncInterval).toISOString(),
        lastSync: integrationService.lastSyncTime || null,
        syncCount: integrationService.syncCount || 0
      },
      timestamp: new Date().toISOString()
    };
    return res.status(200).json(status);
  } catch (error) {
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

// =============================================
// HEALTH CHECK & VALIDATION
// =============================================

/**
 * Validate Integration Connection
 * GET /api/integration/validate
 */
router.get('/validate', async (req, res) => {
  try {
    const validation = {
      success: true,
      validation: {
        branchApiUrl: integrationService.baseURL,
        branchApiKeyConfigured: !!integrationService.apiKey,
        continuousSyncEnabled: process.env.ENABLE_CONTINUOUS_SYNC === 'true',
        integrationAuthRequired: process.env.REQUIRE_INTEGRATION_AUTH === 'true'
      },
      timestamp: new Date().toISOString()
    };
    return res.status(200).json(validation);
  } catch (error) {
    return res.status(500).json({
      success: false,
      error: error.message,
      timestamp: new Date().toISOString()
    });
  }
});

// =============================================
// ERROR HANDLING
// =============================================

router.use((err, req, res, next) => {
  console.error('Integration route error:', err);
  res.status(500).json({
    success: false,
    error: err.message || 'Internal server error',
    timestamp: new Date().toISOString()
  });
});

// =============================================
// EXPORTS
// =============================================

module.exports = {
  router,
  integrationService
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIkJyYW5jaEVSUEludGVncmF0aW9uU2VydmljZSIsImludGVncmF0aW9uU2VydmljZSIsImxhc3RTeW5jVGltZSIsInN5bmNDb3VudCIsInZlcmlmeUludGVncmF0aW9uS2V5IiwicmVxIiwicmVzIiwibmV4dCIsImFwaUtleSIsImhlYWRlcnMiLCJyZXBsYWNlIiwicHJvY2VzcyIsImVudiIsIklOVEVHUkFUSU9OX1NFQ1JFVF9LRVkiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZ2V0Iiwic2VydmljZSIsInZlcnNpb24iLCJtZXNzYWdlIiwiZW5kcG9pbnRzIiwic3luYyIsImtwaXMiLCJpbnZlbnRvcnkiLCJyZXBvcnRzIiwiZm9yZWNhc3RzIiwiZGFzaGJvYXJkIiwiYXV0aGVudGljYXRpb24iLCJSRVFVSVJFX0lOVEVHUkFUSU9OX0FVVEgiLCJ1c2UiLCJwb3N0IiwicmVzdWx0Iiwic3luY0JyYW5jaGVzVG9FUlAiLCJzeW5jZWRfY291bnQiLCJkYXRhIiwiY29uc29sZSIsImJyYW5jaElkIiwicGFyYW1zIiwibWV0cmljcyIsImdldEJyYW5jaFBlcmZvcm1hbmNlTWV0cmljcyIsImdldEJyYW5jaEludmVudG9yeSIsInJlcG9ydFR5cGUiLCJ2YWxpZFR5cGVzIiwiaW5jbHVkZXMiLCJqb2luIiwicmVwb3J0IiwiZ2V0QnJhbmNoUmVwb3J0cyIsImdldEJyYW5jaEZvcmVjYXN0cyIsIlByb21pc2UiLCJhbGwiLCJjYXRjaCIsImNvbXBvbmVudHMiLCJmaW5hbmNpYWxSZXBvcnQiLCJFTkFCTEVfQ09OVElOVU9VU19TWU5DIiwic3RhcnRDb250aW51b3VzU3luYyIsImludGVydmFsIiwic3luY0ludGVydmFsIiwic3RvcENvbnRpbnVvdXNTeW5jIiwic3luY1N0YXR1cyIsImVuYWJsZWQiLCJuZXh0U3luYyIsIm5vdyIsImxhc3RTeW5jIiwidmFsaWRhdGlvbiIsImJyYW5jaEFwaVVybCIsImJhc2VVUkwiLCJicmFuY2hBcGlLZXlDb25maWd1cmVkIiwiY29udGludW91c1N5bmNFbmFibGVkIiwiaW50ZWdyYXRpb25BdXRoUmVxdWlyZWQiLCJlcnIiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiYnJhbmNoLWludGVncmF0aW9uLnJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQnJhbmNoLUVSUCBJbnRlZ3JhdGlvbiBSb3V0ZXNcclxuICogSGFuZGxlcyBhbGwgaW50ZWdyYXRpb24gZW5kcG9pbnRzIGJldHdlZW4gRVJQIGFuZCBBZHZhbmNlZCBCcmFuY2ggTWFuYWdlbWVudCBTeXN0ZW1cclxuICogVmVyc2lvbjogMi4wLjBcclxuICogRGF0ZTogRmVicnVhcnkgMTgsIDIwMjZcclxuICovXHJcblxyXG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCB7IEJyYW5jaEVSUEludGVncmF0aW9uU2VydmljZSB9ID0gcmVxdWlyZSgnLi4vaW50ZWdyYXRpb24vZXJwLWJyYW5jaC1pbnRlZ3JhdGlvbicpO1xyXG5cclxuLy8gSW5pdGlhbGl6ZSBpbnRlZ3JhdGlvbiBzZXJ2aWNlXHJcbmNvbnN0IGludGVncmF0aW9uU2VydmljZSA9IG5ldyBCcmFuY2hFUlBJbnRlZ3JhdGlvblNlcnZpY2UoKTtcclxuXHJcbi8vIFRyYWNrIHN5bmMgc3RhdGlzdGljc1xyXG5pbnRlZ3JhdGlvblNlcnZpY2UubGFzdFN5bmNUaW1lID0gbnVsbDtcclxuaW50ZWdyYXRpb25TZXJ2aWNlLnN5bmNDb3VudCA9IDA7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gTUlERExFV0FSRVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBWZXJpZnkgQVBJIGtleSBmb3IgaW50ZWdyYXRpb24gZW5kcG9pbnRzXHJcbiAqL1xyXG5jb25zdCB2ZXJpZnlJbnRlZ3JhdGlvbktleSA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIGNvbnN0IGFwaUtleSA9IHJlcS5oZWFkZXJzWyd4LWludGVncmF0aW9uLWtleSddIHx8IHJlcS5oZWFkZXJzWydhdXRob3JpemF0aW9uJ10/LnJlcGxhY2UoJ0JlYXJlciAnLCAnJyk7XHJcbiAgXHJcbiAgaWYgKCFhcGlLZXkgfHwgYXBpS2V5ICE9PSBwcm9jZXNzLmVudi5JTlRFR1JBVElPTl9TRUNSRVRfS0VZKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdJbnZhbGlkIG9yIG1pc3NpbmcgaW50ZWdyYXRpb24gQVBJIGtleScsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9XHJcbiAgXHJcbiAgbmV4dCgpO1xyXG59O1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIFBVQkxJQyBFTkRQT0lOVFMgKE5vIEF1dGggUmVxdWlyZWQpXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIEhlYWx0aCBDaGVjayBFbmRwb2ludFxyXG4gKiBHRVQgL2FwaS9pbnRlZ3JhdGlvbi9oZWFsdGhcclxuICovXHJcbnJvdXRlci5nZXQoJy9oZWFsdGgnLCAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgc3RhdHVzOiAnaGVhbHRoeScsXHJcbiAgICAgIHNlcnZpY2U6ICdCcmFuY2gtRVJQIEludGVncmF0aW9uIFNlcnZpY2UnLFxyXG4gICAgICB2ZXJzaW9uOiAnMi4wLjAnLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBzdGF0dXM6ICd1bmhlYWx0aHknLFxyXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR2V0IEludGVncmF0aW9uIFN0YXR1c1xyXG4gKiBHRVQgL2FwaS9pbnRlZ3JhdGlvbi9zdGF0dXNcclxuICovXHJcbnJvdXRlci5nZXQoJy9zdGF0dXMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3RhdHVzID0ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBzdGF0dXM6ICdvcGVyYXRpb25hbCcsXHJcbiAgICAgIHNlcnZpY2U6ICdCcmFuY2gtRVJQIEludGVncmF0aW9uIFNlcnZpY2UnLFxyXG4gICAgICB2ZXJzaW9uOiAnMi4wLjAnLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgZW5kcG9pbnRzOiB7XHJcbiAgICAgICAgc3luYzogJ1BPU1QgL2FwaS9pbnRlZ3JhdGlvbi9zeW5jL2JyYW5jaGVzJyxcclxuICAgICAgICBrcGlzOiAnR0VUIC9hcGkvaW50ZWdyYXRpb24vYnJhbmNoZXMvOmJyYW5jaElkL2twaXMnLFxyXG4gICAgICAgIGludmVudG9yeTogJ0dFVCAvYXBpL2ludGVncmF0aW9uL2JyYW5jaGVzLzpicmFuY2hJZC9pbnZlbnRvcnktc3luYycsXHJcbiAgICAgICAgcmVwb3J0czogJ0dFVCAvYXBpL2ludGVncmF0aW9uL2JyYW5jaGVzLzpicmFuY2hJZC9yZXBvcnRzLzpyZXBvcnRUeXBlJyxcclxuICAgICAgICBmb3JlY2FzdHM6ICdHRVQgL2FwaS9pbnRlZ3JhdGlvbi9icmFuY2hlcy86YnJhbmNoSWQvZm9yZWNhc3RzJyxcclxuICAgICAgICBkYXNoYm9hcmQ6ICdHRVQgL2FwaS9pbnRlZ3JhdGlvbi9icmFuY2hlcy86YnJhbmNoSWQvZGFzaGJvYXJkJ1xyXG4gICAgICB9LFxyXG4gICAgICBhdXRoZW50aWNhdGlvbjogcHJvY2Vzcy5lbnYuSU5URUdSQVRJT05fU0VDUkVUX0tFWSA/ICdyZXF1aXJlZCcgOiAnZGlzYWJsZWQnXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oc3RhdHVzKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQUk9URUNURUQgRU5EUE9JTlRTIChBdXRoIFJlcXVpcmVkKVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8vIEFwcGx5IGF1dGggbWlkZGxld2FyZSB0byBwcm90ZWN0ZWQgcm91dGVzIChvcHRpb25hbCBiYXNlZCBvbiBjb25maWcpXHJcbmlmIChwcm9jZXNzLmVudi5SRVFVSVJFX0lOVEVHUkFUSU9OX0FVVEggPT09ICd0cnVlJykge1xyXG4gIHJvdXRlci51c2UodmVyaWZ5SW50ZWdyYXRpb25LZXkpO1xyXG59XHJcblxyXG4vKipcclxuICogU3luYyBCcmFuY2hlcyB0byBFUlBcclxuICogUE9TVCAvYXBpL2ludGVncmF0aW9uL3N5bmMvYnJhbmNoZXNcclxuICogTWFudWFsbHkgdHJpZ2dlciBicmFuY2ggZGF0YSBzeW5jaHJvbml6YXRpb25cclxuICovXHJcbnJvdXRlci5wb3N0KCcvc3luYy9icmFuY2hlcycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbnRlZ3JhdGlvblNlcnZpY2Uuc3luY0JyYW5jaGVzVG9FUlAoKTtcclxuICAgIGludGVncmF0aW9uU2VydmljZS5sYXN0U3luY1RpbWUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgaW50ZWdyYXRpb25TZXJ2aWNlLnN5bmNDb3VudCA9IChpbnRlZ3JhdGlvblNlcnZpY2Uuc3luY0NvdW50IHx8IDApICsgMTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogcmVzdWx0LnN1Y2Nlc3MsXHJcbiAgICAgIG1lc3NhZ2U6IGBTeW5jZWQgJHtyZXN1bHQuc3luY2VkX2NvdW50fSBicmFuY2hlc2AsXHJcbiAgICAgIGRhdGE6IHJlc3VsdCxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdTeW5jIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR2V0IEJyYW5jaCBQZXJmb3JtYW5jZSBNZXRyaWNzIChLUElzKVxyXG4gKiBHRVQgL2FwaS9pbnRlZ3JhdGlvbi9icmFuY2hlcy86YnJhbmNoSWQva3Bpc1xyXG4gKi9cclxucm91dGVyLmdldCgnL2JyYW5jaGVzLzpicmFuY2hJZC9rcGlzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgYnJhbmNoSWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBcclxuICAgIGlmICghYnJhbmNoSWQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0JyYW5jaCBJRCBpcyByZXF1aXJlZCcsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBpbnRlZ3JhdGlvblNlcnZpY2UuZ2V0QnJhbmNoUGVyZm9ybWFuY2VNZXRyaWNzKGJyYW5jaElkKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogbWV0cmljcyxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdLUEkgcmV0cmlldmFsIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR2V0IEJyYW5jaCBJbnZlbnRvcnkgRGF0YVxyXG4gKiBHRVQgL2FwaS9pbnRlZ3JhdGlvbi9icmFuY2hlcy86YnJhbmNoSWQvaW52ZW50b3J5LXN5bmNcclxuICovXHJcbnJvdXRlci5nZXQoJy9icmFuY2hlcy86YnJhbmNoSWQvaW52ZW50b3J5LXN5bmMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBicmFuY2hJZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIFxyXG4gICAgaWYgKCFicmFuY2hJZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnQnJhbmNoIElEIGlzIHJlcXVpcmVkJyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgaW52ZW50b3J5ID0gYXdhaXQgaW50ZWdyYXRpb25TZXJ2aWNlLmdldEJyYW5jaEludmVudG9yeShicmFuY2hJZCk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGRhdGE6IGludmVudG9yeSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdJbnZlbnRvcnkgcmV0cmlldmFsIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR2V0IEJyYW5jaCBSZXBvcnRzXHJcbiAqIEdFVCAvYXBpL2ludGVncmF0aW9uL2JyYW5jaGVzLzpicmFuY2hJZC9yZXBvcnRzLzpyZXBvcnRUeXBlXHJcbiAqIFJlcG9ydCB0eXBlczogT1BFUkFUSU9OQUwsIEZJTkFOQ0lBTCwgUVVBTElUWVxyXG4gKi9cclxucm91dGVyLmdldCgnL2JyYW5jaGVzLzpicmFuY2hJZC9yZXBvcnRzLzpyZXBvcnRUeXBlJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgYnJhbmNoSWQsIHJlcG9ydFR5cGUgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBcclxuICAgIGlmICghYnJhbmNoSWQgfHwgIXJlcG9ydFR5cGUpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0JyYW5jaCBJRCBhbmQgcmVwb3J0IHR5cGUgYXJlIHJlcXVpcmVkJyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgdmFsaWRUeXBlcyA9IFsnT1BFUkFUSU9OQUwnLCAnRklOQU5DSUFMJywgJ1FVQUxJVFknXTtcclxuICAgIGlmICghdmFsaWRUeXBlcy5pbmNsdWRlcyhyZXBvcnRUeXBlKSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBgSW52YWxpZCByZXBvcnQgdHlwZS4gQWxsb3dlZDogJHt2YWxpZFR5cGVzLmpvaW4oJywgJyl9YCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgaW50ZWdyYXRpb25TZXJ2aWNlLmdldEJyYW5jaFJlcG9ydHMoYnJhbmNoSWQsIHJlcG9ydFR5cGUpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiByZXBvcnQsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignUmVwb3J0IHJldHJpZXZhbCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEdldCBCcmFuY2ggRm9yZWNhc3RzXHJcbiAqIEdFVCAvYXBpL2ludGVncmF0aW9uL2JyYW5jaGVzLzpicmFuY2hJZC9mb3JlY2FzdHNcclxuICogSW5jbHVkZXMgZGVtYW5kLCBidWRnZXQsIGFuZCBwZXJmb3JtYW5jZSBwcmVkaWN0aW9uc1xyXG4gKi9cclxucm91dGVyLmdldCgnL2JyYW5jaGVzLzpicmFuY2hJZC9mb3JlY2FzdHMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBicmFuY2hJZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIFxyXG4gICAgaWYgKCFicmFuY2hJZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnQnJhbmNoIElEIGlzIHJlcXVpcmVkJyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgZm9yZWNhc3RzID0gYXdhaXQgaW50ZWdyYXRpb25TZXJ2aWNlLmdldEJyYW5jaEZvcmVjYXN0cyhicmFuY2hJZCk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGRhdGE6IGZvcmVjYXN0cyxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdGb3JlY2FzdCByZXRyaWV2YWwgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgQ29tcHJlaGVuc2l2ZSBCcmFuY2ggRGFzaGJvYXJkXHJcbiAqIEdFVCAvYXBpL2ludGVncmF0aW9uL2JyYW5jaGVzLzpicmFuY2hJZC9kYXNoYm9hcmRcclxuICogQWdncmVnYXRlcyBLUElzLCBpbnZlbnRvcnksIHJlcG9ydHMsIGFuZCBmb3JlY2FzdHNcclxuICovXHJcbnJvdXRlci5nZXQoJy9icmFuY2hlcy86YnJhbmNoSWQvZGFzaGJvYXJkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgYnJhbmNoSWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBcclxuICAgIGlmICghYnJhbmNoSWQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ0JyYW5jaCBJRCBpcyByZXF1aXJlZCcsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZldGNoIGFsbCBkYXNoYm9hcmQgY29tcG9uZW50cyBpbiBwYXJhbGxlbFxyXG4gICAgY29uc3QgW2twaXMsIGludmVudG9yeSwgcmVwb3J0cywgZm9yZWNhc3RzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgaW50ZWdyYXRpb25TZXJ2aWNlLmdldEJyYW5jaFBlcmZvcm1hbmNlTWV0cmljcyhicmFuY2hJZCksXHJcbiAgICAgIGludGVncmF0aW9uU2VydmljZS5nZXRCcmFuY2hJbnZlbnRvcnkoYnJhbmNoSWQpLFxyXG4gICAgICBpbnRlZ3JhdGlvblNlcnZpY2UuZ2V0QnJhbmNoUmVwb3J0cyhicmFuY2hJZCwgJ0ZJTkFOQ0lBTCcpLFxyXG4gICAgICBpbnRlZ3JhdGlvblNlcnZpY2UuZ2V0QnJhbmNoRm9yZWNhc3RzKGJyYW5jaElkKVxyXG4gICAgXSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdEYXNoYm9hcmQgYWdncmVnYXRpb24gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gW251bGwsIG51bGwsIG51bGwsIG51bGxdO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBicmFuY2hJZCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBjb21wb25lbnRzOiB7XHJcbiAgICAgICAgICBrcGlzLFxyXG4gICAgICAgICAgaW52ZW50b3J5LFxyXG4gICAgICAgICAgZmluYW5jaWFsUmVwb3J0OiByZXBvcnRzLFxyXG4gICAgICAgICAgZm9yZWNhc3RzXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Rhc2hib2FyZCByZXRyaWV2YWwgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBTdGFydCBDb250aW51b3VzIFN5bmMgKGlmIGVuYWJsZWQpXHJcbiAqIFBPU1QgL2FwaS9pbnRlZ3JhdGlvbi9zeW5jL3N0YXJ0XHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL3N5bmMvc3RhcnQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKHByb2Nlc3MuZW52LkVOQUJMRV9DT05USU5VT1VTX1NZTkMgIT09ICd0cnVlJykge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnQ29udGludW91cyBzeW5jIGlzIG5vdCBlbmFibGVkLiBTZXQgRU5BQkxFX0NPTlRJTlVPVVNfU1lOQz10cnVlJyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaW50ZWdyYXRpb25TZXJ2aWNlLnN0YXJ0Q29udGludW91c1N5bmMoKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogJ0NvbnRpbnVvdXMgc3luYyBzdGFydGVkJyxcclxuICAgICAgaW50ZXJ2YWw6IGAke2ludGVncmF0aW9uU2VydmljZS5zeW5jSW50ZXJ2YWx9bXNgLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1N5bmMgc3RhcnQgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBTdG9wIENvbnRpbnVvdXMgU3luY1xyXG4gKiBQT1NUIC9hcGkvaW50ZWdyYXRpb24vc3luYy9zdG9wXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL3N5bmMvc3RvcCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBpbnRlZ3JhdGlvblNlcnZpY2Uuc3RvcENvbnRpbnVvdXNTeW5jKCk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIG1lc3NhZ2U6ICdDb250aW51b3VzIHN5bmMgc3RvcHBlZCcsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignU3luYyBzdG9wIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR2V0IFN5bmMgU3RhdHVzXHJcbiAqIEdFVCAvYXBpL2ludGVncmF0aW9uL3N5bmMvc3RhdHVzXHJcbiAqL1xyXG5yb3V0ZXIuZ2V0KCcvc3luYy9zdGF0dXMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3RhdHVzID0ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBzeW5jU3RhdHVzOiB7XHJcbiAgICAgICAgZW5hYmxlZDogcHJvY2Vzcy5lbnYuRU5BQkxFX0NPTlRJTlVPVVNfU1lOQyA9PT0gJ3RydWUnLFxyXG4gICAgICAgIGludGVydmFsOiBgJHtpbnRlZ3JhdGlvblNlcnZpY2Uuc3luY0ludGVydmFsfW1zYCxcclxuICAgICAgICBuZXh0U3luYzogbmV3IERhdGUoRGF0ZS5ub3coKSArIGludGVncmF0aW9uU2VydmljZS5zeW5jSW50ZXJ2YWwpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgbGFzdFN5bmM6IGludGVncmF0aW9uU2VydmljZS5sYXN0U3luY1RpbWUgfHwgbnVsbCxcclxuICAgICAgICBzeW5jQ291bnQ6IGludGVncmF0aW9uU2VydmljZS5zeW5jQ291bnQgfHwgMFxyXG4gICAgICB9LFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHN0YXR1cyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gSEVBTFRIIENIRUNLICYgVkFMSURBVElPTlxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSBJbnRlZ3JhdGlvbiBDb25uZWN0aW9uXHJcbiAqIEdFVCAvYXBpL2ludGVncmF0aW9uL3ZhbGlkYXRlXHJcbiAqL1xyXG5yb3V0ZXIuZ2V0KCcvdmFsaWRhdGUnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgdmFsaWRhdGlvbjoge1xyXG4gICAgICAgIGJyYW5jaEFwaVVybDogaW50ZWdyYXRpb25TZXJ2aWNlLmJhc2VVUkwsXHJcbiAgICAgICAgYnJhbmNoQXBpS2V5Q29uZmlndXJlZDogISFpbnRlZ3JhdGlvblNlcnZpY2UuYXBpS2V5LFxyXG4gICAgICAgIGNvbnRpbnVvdXNTeW5jRW5hYmxlZDogcHJvY2Vzcy5lbnYuRU5BQkxFX0NPTlRJTlVPVVNfU1lOQyA9PT0gJ3RydWUnLFxyXG4gICAgICAgIGludGVncmF0aW9uQXV0aFJlcXVpcmVkOiBwcm9jZXNzLmVudi5SRVFVSVJFX0lOVEVHUkFUSU9OX0FVVEggPT09ICd0cnVlJ1xyXG4gICAgICB9LFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHZhbGlkYXRpb24pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEVSUk9SIEhBTkRMSU5HXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxucm91dGVyLnVzZSgoZXJyLCByZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIGNvbnNvbGUuZXJyb3IoJ0ludGVncmF0aW9uIHJvdXRlIGVycm9yOicsIGVycik7XHJcbiAgXHJcbiAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICBlcnJvcjogZXJyLm1lc3NhZ2UgfHwgJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXHJcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBFWFBPUlRTXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgcm91dGVyLFxyXG4gIGludGVncmF0aW9uU2VydmljZVxyXG59O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU07RUFBRUM7QUFBNEIsQ0FBQyxHQUFHSCxPQUFPLENBQUMsdUNBQXVDLENBQUM7O0FBRXhGO0FBQ0EsTUFBTUksa0JBQWtCLEdBQUcsSUFBSUQsMkJBQTJCLENBQUMsQ0FBQzs7QUFFNUQ7QUFDQUMsa0JBQWtCLENBQUNDLFlBQVksR0FBRyxJQUFJO0FBQ3RDRCxrQkFBa0IsQ0FBQ0UsU0FBUyxHQUFHLENBQUM7O0FBRWhDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQyxvQkFBb0IsR0FBR0EsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUMvQyxNQUFNQyxNQUFNLEdBQUdILEdBQUcsQ0FBQ0ksT0FBTyxDQUFDLG1CQUFtQixDQUFDLElBQUlKLEdBQUcsQ0FBQ0ksT0FBTyxDQUFDLGVBQWUsQ0FBQyxFQUFFQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQztFQUV2RyxJQUFJLENBQUNGLE1BQU0sSUFBSUEsTUFBTSxLQUFLRyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0Msc0JBQXNCLEVBQUU7SUFDNUQsT0FBT1AsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUMxQkMsT0FBTyxFQUFFLEtBQUs7TUFDZEMsS0FBSyxFQUFFLHdDQUF3QztNQUMvQ0MsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtFQUVBYixJQUFJLENBQUMsQ0FBQztBQUNSLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FULE1BQU0sQ0FBQ3VCLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQ2hCLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ2xDLElBQUk7SUFDRixPQUFPQSxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQzFCQyxPQUFPLEVBQUUsSUFBSTtNQUNiRixNQUFNLEVBQUUsU0FBUztNQUNqQlEsT0FBTyxFQUFFLGdDQUFnQztNQUN6Q0MsT0FBTyxFQUFFLE9BQU87TUFDaEJMLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU9ILEtBQUssRUFBRTtJQUNkLE9BQU9YLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxLQUFLO01BQ2RGLE1BQU0sRUFBRSxXQUFXO01BQ25CRyxLQUFLLEVBQUVBLEtBQUssQ0FBQ08sT0FBTztNQUNwQk4sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBdEIsTUFBTSxDQUFDdUIsR0FBRyxDQUFDLFNBQVMsRUFBRSxPQUFPaEIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDeEMsSUFBSTtJQUNGLE1BQU1RLE1BQU0sR0FBRztNQUNiRSxPQUFPLEVBQUUsSUFBSTtNQUNiRixNQUFNLEVBQUUsYUFBYTtNQUNyQlEsT0FBTyxFQUFFLGdDQUFnQztNQUN6Q0MsT0FBTyxFQUFFLE9BQU87TUFDaEJMLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUMsQ0FBQztNQUNuQ0ssU0FBUyxFQUFFO1FBQ1RDLElBQUksRUFBRSxxQ0FBcUM7UUFDM0NDLElBQUksRUFBRSw4Q0FBOEM7UUFDcERDLFNBQVMsRUFBRSx3REFBd0Q7UUFDbkVDLE9BQU8sRUFBRSw2REFBNkQ7UUFDdEVDLFNBQVMsRUFBRSxtREFBbUQ7UUFDOURDLFNBQVMsRUFBRTtNQUNiLENBQUM7TUFDREMsY0FBYyxFQUFFckIsT0FBTyxDQUFDQyxHQUFHLENBQUNDLHNCQUFzQixHQUFHLFVBQVUsR0FBRztJQUNwRSxDQUFDO0lBRUQsT0FBT1AsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQ0QsTUFBTSxDQUFDO0VBQ3JDLENBQUMsQ0FBQyxPQUFPRyxLQUFLLEVBQUU7SUFDZCxPQUFPWCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQzFCQyxPQUFPLEVBQUUsS0FBSztNQUNkQyxLQUFLLEVBQUVBLEtBQUssQ0FBQ08sT0FBTztNQUNwQk4sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJVCxPQUFPLENBQUNDLEdBQUcsQ0FBQ3FCLHdCQUF3QixLQUFLLE1BQU0sRUFBRTtFQUNuRG5DLE1BQU0sQ0FBQ29DLEdBQUcsQ0FBQzlCLG9CQUFvQixDQUFDO0FBQ2xDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQU4sTUFBTSxDQUFDcUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLE9BQU85QixHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNoRCxJQUFJO0lBQ0YsTUFBTThCLE1BQU0sR0FBRyxNQUFNbkMsa0JBQWtCLENBQUNvQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQzNEcEMsa0JBQWtCLENBQUNDLFlBQVksR0FBRyxJQUFJaUIsSUFBSSxDQUFDLENBQUM7SUFDNUNsQixrQkFBa0IsQ0FBQ0UsU0FBUyxHQUFHLENBQUNGLGtCQUFrQixDQUFDRSxTQUFTLElBQUksQ0FBQyxJQUFJLENBQUM7SUFFdEUsT0FBT0csR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUMxQkMsT0FBTyxFQUFFb0IsTUFBTSxDQUFDcEIsT0FBTztNQUN2QlEsT0FBTyxFQUFFLFVBQVVZLE1BQU0sQ0FBQ0UsWUFBWSxXQUFXO01BQ2pEQyxJQUFJLEVBQUVILE1BQU07TUFDWmxCLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU9ILEtBQUssRUFBRTtJQUNkdUIsT0FBTyxDQUFDdkIsS0FBSyxDQUFDLGFBQWEsRUFBRUEsS0FBSyxDQUFDO0lBQ25DLE9BQU9YLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxLQUFLO01BQ2RDLEtBQUssRUFBRUEsS0FBSyxDQUFDTyxPQUFPO01BQ3BCTixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0F0QixNQUFNLENBQUN1QixHQUFHLENBQUMsMEJBQTBCLEVBQUUsT0FBT2hCLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ3pELElBQUk7SUFDRixNQUFNO01BQUVtQztJQUFTLENBQUMsR0FBR3BDLEdBQUcsQ0FBQ3FDLE1BQU07SUFFL0IsSUFBSSxDQUFDRCxRQUFRLEVBQUU7TUFDYixPQUFPbkMsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQkMsT0FBTyxFQUFFLEtBQUs7UUFDZEMsS0FBSyxFQUFFLHVCQUF1QjtRQUM5QkMsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztNQUNwQyxDQUFDLENBQUM7SUFDSjtJQUVBLE1BQU11QixPQUFPLEdBQUcsTUFBTTFDLGtCQUFrQixDQUFDMkMsMkJBQTJCLENBQUNILFFBQVEsQ0FBQztJQUU5RSxPQUFPbkMsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUMxQkMsT0FBTyxFQUFFLElBQUk7TUFDYnVCLElBQUksRUFBRUksT0FBTztNQUNiekIsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUMsT0FBT0gsS0FBSyxFQUFFO0lBQ2R1QixPQUFPLENBQUN2QixLQUFLLENBQUMsc0JBQXNCLEVBQUVBLEtBQUssQ0FBQztJQUM1QyxPQUFPWCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQzFCQyxPQUFPLEVBQUUsS0FBSztNQUNkQyxLQUFLLEVBQUVBLEtBQUssQ0FBQ08sT0FBTztNQUNwQk4sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBdEIsTUFBTSxDQUFDdUIsR0FBRyxDQUFDLG9DQUFvQyxFQUFFLE9BQU9oQixHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNuRSxJQUFJO0lBQ0YsTUFBTTtNQUFFbUM7SUFBUyxDQUFDLEdBQUdwQyxHQUFHLENBQUNxQyxNQUFNO0lBRS9CLElBQUksQ0FBQ0QsUUFBUSxFQUFFO01BQ2IsT0FBT25DLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7UUFDMUJDLE9BQU8sRUFBRSxLQUFLO1FBQ2RDLEtBQUssRUFBRSx1QkFBdUI7UUFDOUJDLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7TUFDcEMsQ0FBQyxDQUFDO0lBQ0o7SUFFQSxNQUFNUSxTQUFTLEdBQUcsTUFBTTNCLGtCQUFrQixDQUFDNEMsa0JBQWtCLENBQUNKLFFBQVEsQ0FBQztJQUV2RSxPQUFPbkMsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUMxQkMsT0FBTyxFQUFFLElBQUk7TUFDYnVCLElBQUksRUFBRVgsU0FBUztNQUNmVixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQyxPQUFPSCxLQUFLLEVBQUU7SUFDZHVCLE9BQU8sQ0FBQ3ZCLEtBQUssQ0FBQyw0QkFBNEIsRUFBRUEsS0FBSyxDQUFDO0lBQ2xELE9BQU9YLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxLQUFLO01BQ2RDLEtBQUssRUFBRUEsS0FBSyxDQUFDTyxPQUFPO01BQ3BCTixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQXRCLE1BQU0sQ0FBQ3VCLEdBQUcsQ0FBQyx5Q0FBeUMsRUFBRSxPQUFPaEIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDeEUsSUFBSTtJQUNGLE1BQU07TUFBRW1DLFFBQVE7TUFBRUs7SUFBVyxDQUFDLEdBQUd6QyxHQUFHLENBQUNxQyxNQUFNO0lBRTNDLElBQUksQ0FBQ0QsUUFBUSxJQUFJLENBQUNLLFVBQVUsRUFBRTtNQUM1QixPQUFPeEMsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQkMsT0FBTyxFQUFFLEtBQUs7UUFDZEMsS0FBSyxFQUFFLHdDQUF3QztRQUMvQ0MsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztNQUNwQyxDQUFDLENBQUM7SUFDSjtJQUVBLE1BQU0yQixVQUFVLEdBQUcsQ0FBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLFNBQVMsQ0FBQztJQUMxRCxJQUFJLENBQUNBLFVBQVUsQ0FBQ0MsUUFBUSxDQUFDRixVQUFVLENBQUMsRUFBRTtNQUNwQyxPQUFPeEMsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQkMsT0FBTyxFQUFFLEtBQUs7UUFDZEMsS0FBSyxFQUFFLGlDQUFpQzhCLFVBQVUsQ0FBQ0UsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQy9EL0IsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztNQUNwQyxDQUFDLENBQUM7SUFDSjtJQUVBLE1BQU04QixNQUFNLEdBQUcsTUFBTWpELGtCQUFrQixDQUFDa0QsZ0JBQWdCLENBQUNWLFFBQVEsRUFBRUssVUFBVSxDQUFDO0lBRTlFLE9BQU94QyxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQzFCQyxPQUFPLEVBQUUsSUFBSTtNQUNidUIsSUFBSSxFQUFFVyxNQUFNO01BQ1poQyxTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQyxPQUFPSCxLQUFLLEVBQUU7SUFDZHVCLE9BQU8sQ0FBQ3ZCLEtBQUssQ0FBQyx5QkFBeUIsRUFBRUEsS0FBSyxDQUFDO0lBQy9DLE9BQU9YLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxLQUFLO01BQ2RDLEtBQUssRUFBRUEsS0FBSyxDQUFDTyxPQUFPO01BQ3BCTixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQXRCLE1BQU0sQ0FBQ3VCLEdBQUcsQ0FBQywrQkFBK0IsRUFBRSxPQUFPaEIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDOUQsSUFBSTtJQUNGLE1BQU07TUFBRW1DO0lBQVMsQ0FBQyxHQUFHcEMsR0FBRyxDQUFDcUMsTUFBTTtJQUUvQixJQUFJLENBQUNELFFBQVEsRUFBRTtNQUNiLE9BQU9uQyxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQzFCQyxPQUFPLEVBQUUsS0FBSztRQUNkQyxLQUFLLEVBQUUsdUJBQXVCO1FBQzlCQyxTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO01BQ3BDLENBQUMsQ0FBQztJQUNKO0lBRUEsTUFBTVUsU0FBUyxHQUFHLE1BQU03QixrQkFBa0IsQ0FBQ21ELGtCQUFrQixDQUFDWCxRQUFRLENBQUM7SUFFdkUsT0FBT25DLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxJQUFJO01BQ2J1QixJQUFJLEVBQUVULFNBQVM7TUFDZlosU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUMsT0FBT0gsS0FBSyxFQUFFO0lBQ2R1QixPQUFPLENBQUN2QixLQUFLLENBQUMsMkJBQTJCLEVBQUVBLEtBQUssQ0FBQztJQUNqRCxPQUFPWCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQzFCQyxPQUFPLEVBQUUsS0FBSztNQUNkQyxLQUFLLEVBQUVBLEtBQUssQ0FBQ08sT0FBTztNQUNwQk4sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0F0QixNQUFNLENBQUN1QixHQUFHLENBQUMsK0JBQStCLEVBQUUsT0FBT2hCLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQzlELElBQUk7SUFDRixNQUFNO01BQUVtQztJQUFTLENBQUMsR0FBR3BDLEdBQUcsQ0FBQ3FDLE1BQU07SUFFL0IsSUFBSSxDQUFDRCxRQUFRLEVBQUU7TUFDYixPQUFPbkMsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUMxQkMsT0FBTyxFQUFFLEtBQUs7UUFDZEMsS0FBSyxFQUFFLHVCQUF1QjtRQUM5QkMsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztNQUNwQyxDQUFDLENBQUM7SUFDSjs7SUFFQTtJQUNBLE1BQU0sQ0FBQ08sSUFBSSxFQUFFQyxTQUFTLEVBQUVDLE9BQU8sRUFBRUMsU0FBUyxDQUFDLEdBQUcsTUFBTXVCLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLENBQzlEckQsa0JBQWtCLENBQUMyQywyQkFBMkIsQ0FBQ0gsUUFBUSxDQUFDLEVBQ3hEeEMsa0JBQWtCLENBQUM0QyxrQkFBa0IsQ0FBQ0osUUFBUSxDQUFDLEVBQy9DeEMsa0JBQWtCLENBQUNrRCxnQkFBZ0IsQ0FBQ1YsUUFBUSxFQUFFLFdBQVcsQ0FBQyxFQUMxRHhDLGtCQUFrQixDQUFDbUQsa0JBQWtCLENBQUNYLFFBQVEsQ0FBQyxDQUNoRCxDQUFDLENBQUNjLEtBQUssQ0FBQ3RDLEtBQUssSUFBSTtNQUNoQnVCLE9BQU8sQ0FBQ3ZCLEtBQUssQ0FBQyw4QkFBOEIsRUFBRUEsS0FBSyxDQUFDO01BQ3BELE9BQU8sQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUM7SUFDakMsQ0FBQyxDQUFDO0lBRUYsT0FBT1gsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUMxQkMsT0FBTyxFQUFFLElBQUk7TUFDYnVCLElBQUksRUFBRTtRQUNKRSxRQUFRO1FBQ1J2QixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7UUFDbkNvQyxVQUFVLEVBQUU7VUFDVjdCLElBQUk7VUFDSkMsU0FBUztVQUNUNkIsZUFBZSxFQUFFNUIsT0FBTztVQUN4QkM7UUFDRjtNQUNGLENBQUM7TUFDRFosU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUMsT0FBT0gsS0FBSyxFQUFFO0lBQ2R1QixPQUFPLENBQUN2QixLQUFLLENBQUMsNEJBQTRCLEVBQUVBLEtBQUssQ0FBQztJQUNsRCxPQUFPWCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQzFCQyxPQUFPLEVBQUUsS0FBSztNQUNkQyxLQUFLLEVBQUVBLEtBQUssQ0FBQ08sT0FBTztNQUNwQk4sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBdEIsTUFBTSxDQUFDcUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxPQUFPOUIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDN0MsSUFBSTtJQUNGLElBQUlLLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDOEMsc0JBQXNCLEtBQUssTUFBTSxFQUFFO01BQ2pELE9BQU9wRCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQzFCQyxPQUFPLEVBQUUsS0FBSztRQUNkQyxLQUFLLEVBQUUsaUVBQWlFO1FBQ3hFQyxTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO01BQ3BDLENBQUMsQ0FBQztJQUNKO0lBRUFuQixrQkFBa0IsQ0FBQzBELG1CQUFtQixDQUFDLENBQUM7SUFFeEMsT0FBT3JELEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxJQUFJO01BQ2JRLE9BQU8sRUFBRSx5QkFBeUI7TUFDbENvQyxRQUFRLEVBQUUsR0FBRzNELGtCQUFrQixDQUFDNEQsWUFBWSxJQUFJO01BQ2hEM0MsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSixDQUFDLENBQUMsT0FBT0gsS0FBSyxFQUFFO0lBQ2R1QixPQUFPLENBQUN2QixLQUFLLENBQUMsbUJBQW1CLEVBQUVBLEtBQUssQ0FBQztJQUN6QyxPQUFPWCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQzFCQyxPQUFPLEVBQUUsS0FBSztNQUNkQyxLQUFLLEVBQUVBLEtBQUssQ0FBQ08sT0FBTztNQUNwQk4sU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDLENBQUM7RUFDSjtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBdEIsTUFBTSxDQUFDcUMsSUFBSSxDQUFDLFlBQVksRUFBRSxPQUFPOUIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDNUMsSUFBSTtJQUNGTCxrQkFBa0IsQ0FBQzZELGtCQUFrQixDQUFDLENBQUM7SUFFdkMsT0FBT3hELEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxJQUFJO01BQ2JRLE9BQU8sRUFBRSx5QkFBeUI7TUFDbENOLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDLE9BQU9ILEtBQUssRUFBRTtJQUNkdUIsT0FBTyxDQUFDdkIsS0FBSyxDQUFDLGtCQUFrQixFQUFFQSxLQUFLLENBQUM7SUFDeEMsT0FBT1gsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUMxQkMsT0FBTyxFQUFFLEtBQUs7TUFDZEMsS0FBSyxFQUFFQSxLQUFLLENBQUNPLE9BQU87TUFDcEJOLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0VBQ0o7QUFDRixDQUFDLENBQUM7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQXRCLE1BQU0sQ0FBQ3VCLEdBQUcsQ0FBQyxjQUFjLEVBQUUsT0FBT2hCLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQzdDLElBQUk7SUFDRixNQUFNUSxNQUFNLEdBQUc7TUFDYkUsT0FBTyxFQUFFLElBQUk7TUFDYitDLFVBQVUsRUFBRTtRQUNWQyxPQUFPLEVBQUVyRCxPQUFPLENBQUNDLEdBQUcsQ0FBQzhDLHNCQUFzQixLQUFLLE1BQU07UUFDdERFLFFBQVEsRUFBRSxHQUFHM0Qsa0JBQWtCLENBQUM0RCxZQUFZLElBQUk7UUFDaERJLFFBQVEsRUFBRSxJQUFJOUMsSUFBSSxDQUFDQSxJQUFJLENBQUMrQyxHQUFHLENBQUMsQ0FBQyxHQUFHakUsa0JBQWtCLENBQUM0RCxZQUFZLENBQUMsQ0FBQ3pDLFdBQVcsQ0FBQyxDQUFDO1FBQzlFK0MsUUFBUSxFQUFFbEUsa0JBQWtCLENBQUNDLFlBQVksSUFBSSxJQUFJO1FBQ2pEQyxTQUFTLEVBQUVGLGtCQUFrQixDQUFDRSxTQUFTLElBQUk7TUFDN0MsQ0FBQztNQUNEZSxTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxPQUFPZCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDRCxNQUFNLENBQUM7RUFDckMsQ0FBQyxDQUFDLE9BQU9HLEtBQUssRUFBRTtJQUNkLE9BQU9YLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxLQUFLO01BQ2RDLEtBQUssRUFBRUEsS0FBSyxDQUFDTyxPQUFPO01BQ3BCTixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBdEIsTUFBTSxDQUFDdUIsR0FBRyxDQUFDLFdBQVcsRUFBRSxPQUFPaEIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDMUMsSUFBSTtJQUNGLE1BQU04RCxVQUFVLEdBQUc7TUFDakJwRCxPQUFPLEVBQUUsSUFBSTtNQUNib0QsVUFBVSxFQUFFO1FBQ1ZDLFlBQVksRUFBRXBFLGtCQUFrQixDQUFDcUUsT0FBTztRQUN4Q0Msc0JBQXNCLEVBQUUsQ0FBQyxDQUFDdEUsa0JBQWtCLENBQUNPLE1BQU07UUFDbkRnRSxxQkFBcUIsRUFBRTdELE9BQU8sQ0FBQ0MsR0FBRyxDQUFDOEMsc0JBQXNCLEtBQUssTUFBTTtRQUNwRWUsdUJBQXVCLEVBQUU5RCxPQUFPLENBQUNDLEdBQUcsQ0FBQ3FCLHdCQUF3QixLQUFLO01BQ3BFLENBQUM7TUFDRGYsU0FBUyxFQUFFLElBQUlDLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQztJQUNwQyxDQUFDO0lBRUQsT0FBT2QsR0FBRyxDQUFDUSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQ3FELFVBQVUsQ0FBQztFQUN6QyxDQUFDLENBQUMsT0FBT25ELEtBQUssRUFBRTtJQUNkLE9BQU9YLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDMUJDLE9BQU8sRUFBRSxLQUFLO01BQ2RDLEtBQUssRUFBRUEsS0FBSyxDQUFDTyxPQUFPO01BQ3BCTixTQUFTLEVBQUUsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztFQUNKO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0E7QUFDQTs7QUFFQXRCLE1BQU0sQ0FBQ29DLEdBQUcsQ0FBQyxDQUFDd0MsR0FBRyxFQUFFckUsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUNsQ2lDLE9BQU8sQ0FBQ3ZCLEtBQUssQ0FBQywwQkFBMEIsRUFBRXlELEdBQUcsQ0FBQztFQUU5Q3BFLEdBQUcsQ0FBQ1EsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7SUFDbkJDLE9BQU8sRUFBRSxLQUFLO0lBQ2RDLEtBQUssRUFBRXlELEdBQUcsQ0FBQ2xELE9BQU8sSUFBSSx1QkFBdUI7SUFDN0NOLFNBQVMsRUFBRSxJQUFJQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUM7RUFDcEMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDOztBQUVGO0FBQ0E7QUFDQTs7QUFFQXVELE1BQU0sQ0FBQ0MsT0FBTyxHQUFHO0VBQ2Y5RSxNQUFNO0VBQ05HO0FBQ0YsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==