{"version":3,"names":["crypto","require","AuthService","otpStore","Map","resetTokenStore","twoFactorEnabled","twoFactorCodes","pendingLoginSessions","activeSessions","revokedTokens","Set","registerUser","data","hashedPassword","createHash","update","password","digest","user","id","Date","now","email","name","role","createdAt","toISOString","status","verified","success","message","login","credentials","userId","slice","tf","get","enabled","code","Math","floor","random","toString","expiresAt","set","sessionId","randomUUID","requires2fa","devCode","iat","exp","token","Buffer","from","JSON","stringify","issuedAt","expiresIn","updateProfile","phone","avatar","updatedAt","changePassword","oldPassword","newPassword","timestamp","forgotPassword","resetToken","resetPassword","record","delete","logout","add","verifyToken","has","valid","error","decoded","parse","console","warn","verifyEmail","entry","attempts","sendVerificationCode","existing","lastRequestedAt","enableTwoFactor","secret","backupCodes","qrCode","verifyTwoFactor","pending","finalSessionId","getUserSessions","sessions","sess","entries","push","device","ip","lastActivity","current","terminateSession","module","exports"],"sources":["authService.js"],"sourcesContent":["// Authentication Service\r\n// خدمة المصادقة والتوثيق\r\n\r\nconst crypto = require('crypto');\r\n\r\nclass AuthService {\r\n  // In-memory stores for development\r\n  static otpStore = new Map(); // email -> { code, expiresAt, attempts, lastRequestedAt }\r\n  static resetTokenStore = new Map(); // token -> { email, expiresAt }\r\n  static twoFactorEnabled = new Map(); // userId -> { enabled: true, secret, backupCodes }\r\n  static twoFactorCodes = new Map(); // userId -> { code, expiresAt }\r\n  static pendingLoginSessions = new Map(); // sessionId -> { user }\r\n  static activeSessions = new Map(); // token -> { user, sessionId, issuedAt, expiresAt }\r\n  static revokedTokens = new Set();\r\n\r\n  // تسجيل مستخدم جديد\r\n  static registerUser(data) {\r\n    // محاكاة تخزين كلمة المرور (في الإنتاج استخدم bcrypt)\r\n    const hashedPassword = crypto.createHash('sha256').update(data.password).digest('hex');\r\n\r\n    const user = {\r\n      id: `USER_${Date.now()}`,\r\n      email: data.email,\r\n      name: data.name,\r\n      password: hashedPassword,\r\n      role: data.role || 'user',\r\n      createdAt: new Date().toISOString(),\r\n      status: 'active',\r\n      verified: false,\r\n    };\r\n\r\n    return {\r\n      success: true,\r\n      user: {\r\n        id: user.id,\r\n        email: user.email,\r\n        name: user.name,\r\n        role: user.role,\r\n      },\r\n      message: 'User registered successfully',\r\n    };\r\n  }\r\n\r\n  // تسجيل الدخول\r\n  static login(credentials) {\r\n    // محاكاة التحقق من بيانات المستخدم\r\n    if (!credentials?.email || !credentials?.password) {\r\n      return { success: false, message: 'Email and password are required' };\r\n    }\r\n\r\n    const userId = credentials.userId || `USER_${crypto.createHash('sha1').update(credentials.email).digest('hex').slice(0, 8)}`;\r\n    const user = { \r\n      id: userId, \r\n      email: credentials.email, \r\n      role: credentials.role || 'user'  // Use provided role or default to 'user'\r\n    };\r\n\r\n    // If 2FA is enabled for this user, generate a one-time code and require verification\r\n    const tf = this.twoFactorEnabled.get(user.id);\r\n    if (tf?.enabled) {\r\n      const code = Math.floor(100000 + Math.random() * 900000).toString(); // 6-digit\r\n      const expiresAt = Date.now() + 5 * 60 * 1000; // 5 minutes\r\n      this.twoFactorCodes.set(user.id, { code, expiresAt });\r\n\r\n      // Create a pending session to finalize after 2FA verification\r\n      const sessionId = `SESS_${crypto.randomUUID?.() || Math.random().toString(36).slice(2)}`;\r\n      this.pendingLoginSessions.set(sessionId, { user });\r\n\r\n      return {\r\n        success: true,\r\n        requires2fa: true,\r\n        message: '2FA required. Verification code sent.',\r\n        sessionId,\r\n        user,\r\n        // Note: In real system, code would be sent via email/SMS. For dev, we expose it for testing.\r\n        devCode: code,\r\n      };\r\n    }\r\n\r\n    // محاكاة JWT token\r\n    const iat = Date.now();\r\n    const exp = iat + 24 * 60 * 60 * 1000; // 24 hours\r\n    const token = Buffer.from(\r\n      JSON.stringify({\r\n        email: credentials.email,\r\n        role: user.role,\r\n        iat,\r\n        exp,\r\n      })\r\n    ).toString('base64');\r\n    const sessionId = `SESS_${crypto.randomUUID?.() || Math.random().toString(36).slice(2)}`;\r\n    this.activeSessions.set(token, { user, sessionId, issuedAt: iat, expiresAt: exp });\r\n\r\n    return {\r\n      success: true,\r\n      token: token,\r\n      user,\r\n      expiresIn: '24h',\r\n      message: 'Login successful',\r\n    };\r\n  }\r\n\r\n  // تحديث الملف الشخصي\r\n  static updateProfile(userId, data) {\r\n    return {\r\n      success: true,\r\n      user: {\r\n        id: userId,\r\n        name: data.name,\r\n        email: data.email,\r\n        phone: data.phone,\r\n        avatar: data.avatar,\r\n        updatedAt: new Date().toISOString(),\r\n      },\r\n      message: 'Profile updated successfully',\r\n    };\r\n  }\r\n\r\n  // تغيير كلمة المرور\r\n  static changePassword(userId, oldPassword, newPassword) {\r\n    void userId;\r\n    void oldPassword;\r\n    void newPassword;\r\n    return {\r\n      success: true,\r\n      message: 'Password changed successfully',\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // نسيان كلمة المرور\r\n  static forgotPassword(email) {\r\n    const token = `RT_${crypto.randomUUID?.() || Math.random().toString(36).slice(2)}`;\r\n    const expiresAt = Date.now() + 60 * 60 * 1000; // 1 hour\r\n    this.resetTokenStore.set(token, { email, expiresAt });\r\n    return {\r\n      success: true,\r\n      resetToken: token,\r\n      expiresIn: '1h',\r\n      message: 'Reset email sent successfully',\r\n    };\r\n  }\r\n\r\n  // إعادة تعيين كلمة المرور\r\n  static resetPassword(token, newPassword) {\r\n    void newPassword;\r\n    const record = this.resetTokenStore.get(token);\r\n    if (!record) {\r\n      return { success: false, message: 'Invalid reset token' };\r\n    }\r\n    if (record.expiresAt < Date.now()) {\r\n      this.resetTokenStore.delete(token);\r\n      return { success: false, message: 'Reset token expired' };\r\n    }\r\n    // Simulate password update\r\n    this.resetTokenStore.delete(token);\r\n    return {\r\n      success: true,\r\n      message: 'Password reset successfully',\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تسجيل الخروج\r\n  static logout(token) {\r\n    if (token) {\r\n      this.revokedTokens.add(token);\r\n      this.activeSessions.delete(token);\r\n    }\r\n    return {\r\n      success: true,\r\n      message: 'Logout successful',\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // التحقق من التوكن\r\n  static verifyToken(token) {\r\n    try {\r\n      if (this.revokedTokens.has(token)) {\r\n        return { valid: false, error: 'Token revoked' };\r\n      }\r\n      const decoded = JSON.parse(Buffer.from(token, 'base64').toString());\r\n\r\n      if (decoded.exp < Date.now()) {\r\n        return {\r\n          valid: false,\r\n          error: 'Token expired',\r\n        };\r\n      }\r\n\r\n      return {\r\n        valid: true,\r\n        user: {\r\n          email: decoded.email,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      console.warn('verifyToken error:', error);\r\n      return {\r\n        valid: false,\r\n        error: 'Invalid token',\r\n      };\r\n    }\r\n  }\r\n\r\n  // تفعيل حساب المستخدم\r\n  static verifyEmail(email, code) {\r\n    const entry = this.otpStore.get(email);\r\n    if (!entry) {\r\n      return { success: false, message: 'No code requested' };\r\n    }\r\n    if (entry.expiresAt < Date.now()) {\r\n      this.otpStore.delete(email);\r\n      return { success: false, message: 'Code expired' };\r\n    }\r\n    if (entry.code !== code) {\r\n      entry.attempts = (entry.attempts || 0) + 1;\r\n      return { success: false, message: 'Invalid code', attempts: entry.attempts };\r\n    }\r\n    this.otpStore.delete(email);\r\n    return {\r\n      success: true,\r\n      message: 'Email verified successfully',\r\n      verified: true,\r\n    };\r\n  }\r\n\r\n  // إرسال رمز التحقق\r\n  static sendVerificationCode(email) {\r\n    const now = Date.now();\r\n    const existing = this.otpStore.get(email);\r\n    if (existing && existing.lastRequestedAt && now - existing.lastRequestedAt < 30 * 1000) {\r\n      return { success: false, message: 'Too many requests. Please wait.' };\r\n    }\r\n    const code = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const expiresAt = now + 10 * 60 * 1000; // 10 minutes\r\n    this.otpStore.set(email, {\r\n      code,\r\n      expiresAt,\r\n      attempts: 0,\r\n      lastRequestedAt: now,\r\n    });\r\n    return {\r\n      success: true,\r\n      code,\r\n      expiresIn: '10m',\r\n      message: 'Verification code sent',\r\n    };\r\n  }\r\n\r\n  // تفعيل المصادقة الثنائية\r\n  static enableTwoFactor(userId) {\r\n    const secret = `SECRET_${crypto.randomUUID?.() || Math.random().toString(36).slice(2)}`;\r\n    const backupCodes = ['BACKUP_001', 'BACKUP_002', 'BACKUP_003'];\r\n    this.twoFactorEnabled.set(userId, { enabled: true, secret, backupCodes });\r\n    return {\r\n      success: true,\r\n      secret,\r\n      qrCode: 'data:image/png;base64,...',\r\n      backupCodes,\r\n      message: '2FA enabled successfully',\r\n    };\r\n  }\r\n\r\n  // التحقق من المصادقة الثنائية\r\n  static verifyTwoFactor(userId, code, sessionId) {\r\n    const entry = this.twoFactorCodes.get(userId);\r\n    if (!entry) {\r\n      return { success: false, message: 'No pending 2FA' };\r\n    }\r\n    if (entry.expiresAt < Date.now()) {\r\n      this.twoFactorCodes.delete(userId);\r\n      return { success: false, message: '2FA code expired' };\r\n    }\r\n    if (entry.code !== code) {\r\n      return { success: false, message: 'Invalid 2FA code' };\r\n    }\r\n    this.twoFactorCodes.delete(userId);\r\n\r\n    // Finalize login and issue token\r\n    const pending = sessionId ? this.pendingLoginSessions.get(sessionId) : null;\r\n    const user = pending?.user || { id: userId, email: `${userId}@example.com`, role: 'user' };\r\n    if (pending) this.pendingLoginSessions.delete(sessionId);\r\n\r\n    const iat = Date.now();\r\n    const exp = iat + 24 * 60 * 60 * 1000;\r\n    const token = Buffer.from(JSON.stringify({ email: user.email, iat, exp })).toString('base64');\r\n    const finalSessionId =\r\n      sessionId || `SESS_${crypto.randomUUID?.() || Math.random().toString(36).slice(2)}`;\r\n    this.activeSessions.set(token, {\r\n      user,\r\n      sessionId: finalSessionId,\r\n      issuedAt: iat,\r\n      expiresAt: exp,\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: '2FA verified successfully',\r\n      token,\r\n      user,\r\n    };\r\n  }\r\n\r\n  // الحصول على جلسات المستخدم\r\n  static getUserSessions(userId) {\r\n    const sessions = [];\r\n    for (const [, sess] of this.activeSessions.entries()) {\r\n      if (sess.user?.id === userId) {\r\n        sessions.push({\r\n          id: sess.sessionId,\r\n          device: 'Unknown Device',\r\n          ip: '127.0.0.1',\r\n          lastActivity: new Date().toISOString(),\r\n          createdAt: new Date(sess.issuedAt).toISOString(),\r\n          current: true,\r\n        });\r\n      }\r\n    }\r\n    return { success: true, sessions };\r\n  }\r\n\r\n  // إنهاء جلسة\r\n  static terminateSession(userId, sessionId) {\r\n    for (const [token, sess] of this.activeSessions.entries()) {\r\n      if (sess.user?.id === userId && sess.sessionId === sessionId) {\r\n        this.revokedTokens.add(token);\r\n        this.activeSessions.delete(token);\r\n        return { success: true, message: 'Session terminated successfully' };\r\n      }\r\n    }\r\n    return { success: false, message: 'Session not found' };\r\n  }\r\n}\r\n\r\nmodule.exports = AuthService;\r\n"],"mappings":"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","ignoreList":[]}