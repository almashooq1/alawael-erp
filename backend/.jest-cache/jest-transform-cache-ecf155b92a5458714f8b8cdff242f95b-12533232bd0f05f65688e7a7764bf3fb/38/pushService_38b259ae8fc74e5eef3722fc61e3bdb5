7720874c7d34b60bc8b3a56cfdb5d501
// pushService.js
// خدمة إرسال إشعارات Push عبر FCM
// يتطلب إضافة ملف serviceAccountKey.json في backend/config أو backend/

const admin = require('firebase-admin');
const path = require('path');

// تهيئة Firebase Admin SDK مرة واحدة فقط
if (!admin.apps.length) {
  try {
    admin.initializeApp({
      credential: admin.credential.cert(path.join(__dirname, '../config/serviceAccountKey.json'))
    });
  } catch (e) {
    // إذا لم يوجد ملف الخدمة، تجاهل التهيئة (للاختبار فقط)
  }
}
async function sendPush({
  tokens,
  title,
  body,
  data
}) {
  if (!admin.apps.length) return {
    success: false,
    error: 'FCM not configured'
  };
  if (!tokens || tokens.length === 0) return {
    success: false,
    error: 'No tokens'
  };
  const message = {
    notification: {
      title,
      body
    },
    data: data || {},
    tokens
  };
  try {
    const response = await admin.messaging().sendMulticast(message);
    return {
      success: true,
      response
    };
  } catch (error) {
    return {
      success: false,
      error
    };
  }
}
module.exports = {
  sendPush
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhZG1pbiIsInJlcXVpcmUiLCJwYXRoIiwiYXBwcyIsImxlbmd0aCIsImluaXRpYWxpemVBcHAiLCJjcmVkZW50aWFsIiwiY2VydCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJlIiwic2VuZFB1c2giLCJ0b2tlbnMiLCJ0aXRsZSIsImJvZHkiLCJkYXRhIiwic3VjY2VzcyIsImVycm9yIiwibWVzc2FnZSIsIm5vdGlmaWNhdGlvbiIsInJlc3BvbnNlIiwibWVzc2FnaW5nIiwic2VuZE11bHRpY2FzdCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJwdXNoU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwdXNoU2VydmljZS5qc1xyXG4vLyDYrtiv2YXYqSDYpdix2LPYp9mEINil2LTYudin2LHYp9iqIFB1c2gg2LnYqNixIEZDTVxyXG4vLyDZitiq2LfZhNioINil2LbYp9mB2Kkg2YXZhNmBIHNlcnZpY2VBY2NvdW50S2V5Lmpzb24g2YHZiiBiYWNrZW5kL2NvbmZpZyDYo9mIIGJhY2tlbmQvXHJcblxyXG5jb25zdCBhZG1pbiA9IHJlcXVpcmUoJ2ZpcmViYXNlLWFkbWluJyk7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcblxyXG4vLyDYqtmH2YrYptipIEZpcmViYXNlIEFkbWluIFNESyDZhdix2Kkg2YjYp9it2K/YqSDZgdmC2LdcclxuaWYgKCFhZG1pbi5hcHBzLmxlbmd0aCkge1xyXG4gIHRyeSB7XHJcbiAgICBhZG1pbi5pbml0aWFsaXplQXBwKHtcclxuICAgICAgY3JlZGVudGlhbDogYWRtaW4uY3JlZGVudGlhbC5jZXJ0KHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9jb25maWcvc2VydmljZUFjY291bnRLZXkuanNvbicpKSxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIC8vINil2LDYpyDZhNmFINmK2YjYrNivINmF2YTZgSDYp9mE2K7Yr9mF2KnYjCDYqtis2KfZh9mEINin2YTYqtmH2YrYptipICjZhNmE2KfYrtiq2KjYp9ixINmB2YLYtylcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHNlbmRQdXNoKHsgdG9rZW5zLCB0aXRsZSwgYm9keSwgZGF0YSB9KSB7XHJcbiAgaWYgKCFhZG1pbi5hcHBzLmxlbmd0aCkgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRkNNIG5vdCBjb25maWd1cmVkJyB9O1xyXG4gIGlmICghdG9rZW5zIHx8IHRva2Vucy5sZW5ndGggPT09IDApIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIHRva2VucycgfTtcclxuICBjb25zdCBtZXNzYWdlID0ge1xyXG4gICAgbm90aWZpY2F0aW9uOiB7IHRpdGxlLCBib2R5IH0sXHJcbiAgICBkYXRhOiBkYXRhIHx8IHt9LFxyXG4gICAgdG9rZW5zLFxyXG4gIH07XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW4ubWVzc2FnaW5nKCkuc2VuZE11bHRpY2FzdChtZXNzYWdlKTtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHJlc3BvbnNlIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvciB9O1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7IHNlbmRQdXNoIH07XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUVBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3ZDLE1BQU1DLElBQUksR0FBR0QsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7QUFFNUI7QUFDQSxJQUFJLENBQUNELEtBQUssQ0FBQ0csSUFBSSxDQUFDQyxNQUFNLEVBQUU7RUFDdEIsSUFBSTtJQUNGSixLQUFLLENBQUNLLGFBQWEsQ0FBQztNQUNsQkMsVUFBVSxFQUFFTixLQUFLLENBQUNNLFVBQVUsQ0FBQ0MsSUFBSSxDQUFDTCxJQUFJLENBQUNNLElBQUksQ0FBQ0MsU0FBUyxFQUFFLGtDQUFrQyxDQUFDO0lBQzVGLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQyxPQUFPQyxDQUFDLEVBQUU7SUFDVjtFQUFBO0FBRUo7QUFFQSxlQUFlQyxRQUFRQSxDQUFDO0VBQUVDLE1BQU07RUFBRUMsS0FBSztFQUFFQyxJQUFJO0VBQUVDO0FBQUssQ0FBQyxFQUFFO0VBQ3JELElBQUksQ0FBQ2YsS0FBSyxDQUFDRyxJQUFJLENBQUNDLE1BQU0sRUFBRSxPQUFPO0lBQUVZLE9BQU8sRUFBRSxLQUFLO0lBQUVDLEtBQUssRUFBRTtFQUFxQixDQUFDO0VBQzlFLElBQUksQ0FBQ0wsTUFBTSxJQUFJQSxNQUFNLENBQUNSLE1BQU0sS0FBSyxDQUFDLEVBQUUsT0FBTztJQUFFWSxPQUFPLEVBQUUsS0FBSztJQUFFQyxLQUFLLEVBQUU7RUFBWSxDQUFDO0VBQ2pGLE1BQU1DLE9BQU8sR0FBRztJQUNkQyxZQUFZLEVBQUU7TUFBRU4sS0FBSztNQUFFQztJQUFLLENBQUM7SUFDN0JDLElBQUksRUFBRUEsSUFBSSxJQUFJLENBQUMsQ0FBQztJQUNoQkg7RUFDRixDQUFDO0VBQ0QsSUFBSTtJQUNGLE1BQU1RLFFBQVEsR0FBRyxNQUFNcEIsS0FBSyxDQUFDcUIsU0FBUyxDQUFDLENBQUMsQ0FBQ0MsYUFBYSxDQUFDSixPQUFPLENBQUM7SUFDL0QsT0FBTztNQUFFRixPQUFPLEVBQUUsSUFBSTtNQUFFSTtJQUFTLENBQUM7RUFDcEMsQ0FBQyxDQUFDLE9BQU9ILEtBQUssRUFBRTtJQUNkLE9BQU87TUFBRUQsT0FBTyxFQUFFLEtBQUs7TUFBRUM7SUFBTSxDQUFDO0VBQ2xDO0FBQ0Y7QUFFQU0sTUFBTSxDQUFDQyxPQUFPLEdBQUc7RUFBRWI7QUFBUyxDQUFDIiwiaWdub3JlTGlzdCI6W119