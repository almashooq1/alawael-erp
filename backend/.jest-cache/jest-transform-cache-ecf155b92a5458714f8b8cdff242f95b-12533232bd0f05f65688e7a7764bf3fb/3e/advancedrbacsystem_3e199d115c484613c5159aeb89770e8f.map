{"version":3,"names":["EventEmitter","require","crypto","AdvancedRBACSystem","constructor","config","roles","Map","permissions","resourceDefinitions","userRoles","userAttributes","roleHierarchy","roleInheritance","temporalRoles","scopedAccess","customRules","permissionCache","auditLog","anomalyDetection","accessHistory","deniedAccessAttempts","enableCache","cacheTTL","enableAudit","enableAnomaly","maxAuditEntries","anomalyThreshold","_initializeDefaults","createRole","roleId","has","Error","role","id","name","description","Set","parentRole","childRoles","level","isActive","isSystem","scope","scopeData","expiresAt","maxUsers","createdAt","Date","updatedAt","createdBy","metadata","set","_setupRoleHierarchy","_logAuditEvent","emit","updateRole","updates","get","allowSystemModification","oldRole","Object","assign","_clearRoleCache","newRole","deleteRole","userCount","Array","from","values","flat","filter","ur","length","delete","getRole","getAllRoles","undefined","createPermission","permId","permission","resource","action","conditions","riskLevel","isDeprecated","getAllPermissions","getPermission","permissionId","getAllUsers","keys","assignPermissionToRole","add","removePermissionFromRole","getRolePermissions","includeInherited","cacheKey","parentPerms","forEach","p","permissionsArray","setTimeout","assignRoleToUser","userId","assignmentConfig","currentCount","assignment","assignedAt","assignedBy","_validateAssignmentConditions","push","removeRoleFromUser","initialLength","r","removed","_clearUserCache","getUserRoles","assignments","now","map","hasPermission","context","_generateCacheKey","userAssignments","hasAccess","includes","_evaluateConditions","_evaluateCustomRules","result","timestamp","_detectAnomalies","_recordAccessAttempt","hasAllPermissions","permissionIds","every","hasAnyPermission","some","getUserEffectivePermissions","effectivePermissions","setUserAttributes","attributes","getUserAttributes","userAttrs","key","expectedValue","entries","actualValue","_matchConditionValue","calculateUserScope","global","departments","teams","resources","custom","departmentId","teamId","canAccessResource","resourceId","eventType","data","auditEntry","randomUUID","severity","_calculateEventSeverity","slice","getAuditLog","filters","results","e","startDate","endDate","limit","accessResult","deniedCount","lastCheck","patterns","userAnomaly","reason","count","anomaly","getAnomalyReport","report","sort","a","b","contextStr","JSON","stringify","keysToDelete","startsWith","severityMap","ROLE_CREATED","ROLE_DELETED","PERMISSION_ASSIGNED","PERMISSION_REMOVED","ROLE_ASSIGNED","ROLE_REMOVED","ANOMALY_DETECTED","childRoleId","parentRoleId","parent","rules","rule","eval","actual","expected","isArray","history","getUserAccessHistory","getSystemStats","totalRoles","size","totalPermissions","totalUsers","auditLogEntries","cacheSize","anomaliesDetected","exportData","importData","module","exports"],"sources":["advanced-rbac.system.js"],"sourcesContent":["/**\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * üîê Advanced RBAC System - ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ÿ®ÿßŸÑŸàÿµŸàŸÑ\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * \r\n * ÿßŸÑŸÖŸÖŸäÿ≤ÿßÿ™:\r\n * ‚úÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿØŸàÿßÿ± ÿßŸÑŸáÿ±ŸÖŸäÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©\r\n * ‚úÖ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™ ÿßŸÑÿØŸäŸÜÿßŸÖŸäŸÉŸä\r\n * ‚úÖ ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÇÿßÿ¶ŸÖ ÿπŸÑŸâ ÿßŸÑÿÆÿµÿßÿ¶ÿµ (ABAC)\r\n * ‚úÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿØÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ŸÑŸÑÿ£ÿØŸàÿßÿ±\r\n * ‚úÖ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿØŸÇŸäŸÇ ÿßŸÑÿ¥ÿßŸÖŸÑ\r\n * ‚úÖ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ∞ŸÉŸä\r\n * ‚úÖ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÉÿ¥ŸÅ ÿπŸÜ ÿßŸÑÿ¥ÿ∞Ÿàÿ∞\r\n */\r\n\r\nconst { EventEmitter } = require('events');\r\nconst crypto = require('crypto');\r\n\r\nclass AdvancedRBACSystem extends EventEmitter {\r\n  constructor(config = {}) {\r\n    super();\r\n    \r\n    // Core Storage\r\n    this.roles = new Map();\r\n    this.permissions = new Map();\r\n    this.resourceDefinitions = new Map();\r\n    this.userRoles = new Map();\r\n    this.userAttributes = new Map();\r\n    \r\n    // Advanced Features\r\n    this.roleHierarchy = new Map();\r\n    this.roleInheritance = new Map();\r\n    this.temporalRoles = new Map();\r\n    this.scopedAccess = new Map();\r\n    this.customRules = new Map();\r\n    this.permissionCache = new Map();\r\n    this.auditLog = [];\r\n    this.anomalyDetection = new Map();\r\n    \r\n    // Performance & Security\r\n    this.accessHistory = new Map();\r\n    this.deniedAccessAttempts = [];\r\n    this.config = {\r\n      enableCache: config.enableCache !== false,\r\n      cacheTTL: config.cacheTTL || 3600000, // 1 hour\r\n      enableAudit: config.enableAudit !== false,\r\n      enableAnomaly: config.enableAnomaly !== false,\r\n      maxAuditEntries: config.maxAuditEntries || 50000,\r\n      anomalyThreshold: config.anomalyThreshold || 5, // ÿπÿØÿØ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿßÿ™ ÿßŸÑŸÖÿ¥ÿ®ŸàŸáÿ©\r\n      ...config\r\n    };\r\n\r\n    this._initializeDefaults();\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 1Ô∏è‚É£ ROLES MANAGEMENT - ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿØŸàÿßÿ±\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ•ŸÜÿ¥ÿßÿ° ÿØŸàÿ± ÿ¨ÿØŸäÿØ ŸÖÿπ ÿ™ŸÉŸàŸäŸÜÿßÿ™ ŸÖÿ™ŸÇÿØŸÖÿ©\r\n   */\r\n  createRole(roleId, config = {}) {\r\n    if (this.roles.has(roleId)) {\r\n      throw new Error(`Role ${roleId} already exists`);\r\n    }\r\n\r\n    const role = {\r\n      id: roleId,\r\n      name: config.name || roleId,\r\n      description: config.description || '',\r\n      \r\n      // Permissions\r\n      permissions: new Set(config.permissions || []),\r\n      \r\n      // Hierarchy\r\n      parentRole: config.parentRole || null,\r\n      childRoles: new Set(config.childRoles || []),\r\n      level: config.level || 0,\r\n      \r\n      // Status\r\n      isActive: config.isActive !== false,\r\n      isSystem: config.isSystem || false,\r\n      \r\n      // Scope Management\r\n      scope: config.scope || 'global', // global, department, team\r\n      scopeData: config.scopeData || {},\r\n      \r\n      // Temporal Settings\r\n      expiresAt: config.expiresAt || null,\r\n      maxUsers: config.maxUsers || null,\r\n      \r\n      // Metadata\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n      createdBy: config.createdBy || 'system',\r\n      metadata: config.metadata || {},\r\n    };\r\n\r\n    this.roles.set(roleId, role);\r\n\r\n    // Setup hierarchy\r\n    if (roleId.parentRole) {\r\n      this._setupRoleHierarchy(roleId, roleId.parentRole);\r\n    }\r\n\r\n    this._logAuditEvent('ROLE_CREATED', { roleId, config });\r\n    this.emit('roleCreated', role);\r\n\r\n    return role;\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≠ÿØŸäÿ´ ÿØŸàÿ± ŸÖŸàÿ¨ŸàÿØ\r\n   */\r\n  updateRole(roleId, updates) {\r\n    const role = this.roles.get(roleId);\r\n    if (!role) throw new Error(`Role ${roleId} not found`);\r\n\r\n    if (role.isSystem && !updates.allowSystemModification) {\r\n      throw new Error('Cannot modify system roles without explicit permission');\r\n    }\r\n\r\n    const oldRole = { ...role };\r\n    Object.assign(role, updates, { updatedAt: new Date() });\r\n\r\n    this._clearRoleCache(roleId);\r\n    this._logAuditEvent('ROLE_UPDATED', { roleId, oldRole, newRole: role });\r\n    this.emit('roleUpdated', role);\r\n\r\n    return role;\r\n  }\r\n\r\n  /**\r\n   * ÿ≠ÿ∞ŸÅ ÿØŸàÿ±\r\n   */\r\n  deleteRole(roleId) {\r\n    const role = this.roles.get(roleId);\r\n    if (!role) throw new Error(`Role ${roleId} not found`);\r\n    if (role.isSystem) throw new Error('Cannot delete system roles');\r\n\r\n    const userCount = Array.from(this.userRoles.values())\r\n      .flat()\r\n      .filter(ur => ur.roleId === roleId).length;\r\n\r\n    if (userCount > 0) {\r\n      throw new Error(`Cannot delete role with ${userCount} active assignments`);\r\n    }\r\n\r\n    this.roles.delete(roleId);\r\n    this.roleHierarchy.delete(roleId);\r\n    \r\n    this._logAuditEvent('ROLE_DELETED', { roleId });\r\n    this.emit('roleDeleted', roleId);\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿØŸàÿ± ŸÖÿ≠ÿØÿØ\r\n   */\r\n  getRole(roleId) {\r\n    return this.roles.get(roleId) || null;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿØŸàÿßÿ±\r\n   */\r\n  getAllRoles() {\r\n    return Array.from(this.roles.values());\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≠ÿØŸäÿ´ ÿØŸàÿ± ŸÖŸàÿ¨ŸàÿØ\r\n   */\r\n  updateRole(roleId, updates = {}) {\r\n    const role = this.roles.get(roleId);\r\n    if (!role) throw new Error(`Role ${roleId} not found`);\r\n\r\n    if (updates.name) role.name = updates.name;\r\n    if (updates.description) role.description = updates.description;\r\n    if (updates.level !== undefined) role.level = updates.level;\r\n    if (updates.isActive !== undefined) role.isActive = updates.isActive;\r\n\r\n    role.updatedAt = new Date();\r\n\r\n    this._clearRoleCache(roleId);\r\n    this._logAuditEvent('ROLE_UPDATED', { roleId, updates });\r\n    this.emit('roleUpdated', { roleId, updates });\r\n\r\n    return role;\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * PERMISSIONS MANAGEMENT - ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ•ŸÜÿ¥ÿßÿ° ÿ•ÿ∞ŸÜ ÿ¨ÿØŸäÿØ\r\n   */\r\n  createPermission(permId, config = {}) {\r\n    if (this.permissions.has(permId)) {\r\n      throw new Error(`Permission ${permId} already exists`);\r\n    }\r\n\r\n    const permission = {\r\n      id: permId,\r\n      name: config.name || permId,\r\n      description: config.description || '',\r\n      \r\n      // Resource & Action\r\n      resource: config.resource || '',\r\n      action: config.action || '', // create, read, update, delete, execute\r\n      \r\n      // Conditions\r\n      conditions: config.conditions || {}, // ABAC conditions\r\n      \r\n      // Scope\r\n      scope: config.scope || 'global',\r\n      \r\n      // Risk Level\r\n      riskLevel: config.riskLevel || 'low', // low, medium, high, critical\r\n      \r\n      // Status\r\n      isActive: config.isActive !== false,\r\n      isDeprecated: config.isDeprecated || false,\r\n      \r\n      // Metadata\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n      metadata: config.metadata || {}\r\n    };\r\n\r\n    this.permissions.set(permId, permission);\r\n    this._logAuditEvent('PERMISSION_CREATED', { permId, config });\r\n    this.emit('permissionCreated', permission);\r\n\r\n    return permission;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™\r\n   */\r\n  getAllPermissions() {\r\n    return Array.from(this.permissions.values());\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿ∞ŸÜ ŸÖÿ≠ÿØÿØ\r\n   */\r\n  getPermission(permissionId) {\r\n    return this.permissions.get(permissionId) || null;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ\r\n   */\r\n  getAllUsers() {\r\n    return Array.from(this.userRoles.keys());\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿ∞ŸÜ ÿ•ŸÑŸâ ÿØŸàÿ±\r\n   */\r\n  assignPermissionToRole(roleId, permissionId, metadata = {}) {\r\n    const role = this.roles.get(roleId);\r\n    const permission = this.permissions.get(permissionId);\r\n\r\n    if (!role) throw new Error(`Role ${roleId} not found`);\r\n    if (!permission) throw new Error(`Permission ${permissionId} not found`);\r\n\r\n    role.permissions.add(permissionId);\r\n    this._clearRoleCache(roleId);\r\n\r\n    this._logAuditEvent('PERMISSION_ASSIGNED', {\r\n      roleId,\r\n      permissionId,\r\n      metadata\r\n    });\r\n\r\n    this.emit('permissionAssigned', { roleId, permissionId });\r\n    return role;\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ≤ÿßŸÑÿ© ÿ•ÿ∞ŸÜ ŸÖŸÜ ÿØŸàÿ±\r\n   */\r\n  removePermissionFromRole(roleId, permissionId) {\r\n    const role = this.roles.get(roleId);\r\n    if (!role) throw new Error(`Role ${roleId} not found`);\r\n\r\n    role.permissions.delete(permissionId);\r\n    this._clearRoleCache(roleId);\r\n\r\n    this._logAuditEvent('PERMISSION_REMOVED', { roleId, permissionId });\r\n    this.emit('permissionRemoved', { roleId, permissionId });\r\n\r\n    return role;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™ ŸÑŸÑÿØŸàÿ± (ŸÖÿπ ÿßŸÑŸàÿ±ÿßÿ´ÿ©)\r\n   */\r\n  getRolePermissions(roleId, includeInherited = true) {\r\n    const cacheKey = `role_perms_${roleId}_${includeInherited}`;\r\n    if (this.config.enableCache && this.permissionCache.has(cacheKey)) {\r\n      return this.permissionCache.get(cacheKey);\r\n    }\r\n\r\n    const role = this.roles.get(roleId);\r\n    if (!role) return [];\r\n\r\n    const permissions = new Set(role.permissions);\r\n\r\n    if (includeInherited && role.parentRole) {\r\n      const parentPerms = this.getRolePermissions(role.parentRole, true);\r\n      if (parentPerms) {\r\n        parentPerms.forEach(p => permissions.add(p));\r\n      }\r\n    }\r\n\r\n    const permissionsArray = Array.from(permissions);\r\n    \r\n    if (this.config.enableCache) {\r\n      this.permissionCache.set(cacheKey, permissionsArray);\r\n      setTimeout(() => this.permissionCache.delete(cacheKey), this.config.cacheTTL);\r\n    }\r\n\r\n    return permissionsArray;\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 3Ô∏è‚É£ USER-ROLE ASSIGNMENT - ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ£ÿØŸàÿßÿ± ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ™ÿπŸäŸäŸÜ ÿØŸàÿ± ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿ¥ÿ±Ÿàÿ∑ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©\r\n   */\r\n  assignRoleToUser(userId, roleId, assignmentConfig = {}) {\r\n    const role = this.roles.get(roleId);\r\n    if (!role) throw new Error(`Role ${roleId} not found`);\r\n\r\n    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿØŸàÿØ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ\r\n    if (role.maxUsers) {\r\n      const currentCount = (this.userRoles.get(roleId) || []).length;\r\n      if (currentCount >= role.maxUsers) {\r\n        throw new Error(`Role ${roleId} has reached maximum user limit`);\r\n      }\r\n    }\r\n\r\n    if (!this.userRoles.has(userId)) {\r\n      this.userRoles.set(userId, []);\r\n    }\r\n\r\n    const assignment = {\r\n      roleId,\r\n      assignedAt: new Date(),\r\n      assignedBy: assignmentConfig.assignedBy || 'system',\r\n      \r\n      // Temporal\r\n      expiresAt: assignmentConfig.expiresAt || null,\r\n      \r\n      // Scope\r\n      scope: assignmentConfig.scope || role.scope || 'global',\r\n      scopeData: assignmentConfig.scopeData || {},\r\n      \r\n      // Conditions\r\n      conditions: assignmentConfig.conditions || {},\r\n      \r\n      // Status\r\n      isActive: assignmentConfig.isActive !== false,\r\n      \r\n      // Metadata\r\n      metadata: assignmentConfig.metadata || {}\r\n    };\r\n\r\n    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ¥ÿ±Ÿàÿ∑\r\n    if (!this._validateAssignmentConditions(userId, assignment)) {\r\n      throw new Error('Assignment conditions not met');\r\n    }\r\n\r\n    this.userRoles.get(userId).push(assignment);\r\n    this._logAuditEvent('ROLE_ASSIGNED', { userId, roleId, assignment });\r\n    this.emit('roleAssigned', { userId, roleId, assignment });\r\n\r\n    return assignment;\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿ≤ÿßŸÑÿ© ÿØŸàÿ± ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  removeRoleFromUser(userId, roleId) {\r\n    const userRoles = this.userRoles.get(userId) || [];\r\n    const initialLength = userRoles.length;\r\n\r\n    this.userRoles.set(\r\n      userId,\r\n      userRoles.filter(r => r.roleId !== roleId)\r\n    );\r\n\r\n    const removed = initialLength !== userRoles.length;\r\n\r\n    if (removed) {\r\n      this._clearUserCache(userId);\r\n      this._logAuditEvent('ROLE_REMOVED', { userId, roleId });\r\n      this.emit('roleRemoved', { userId, roleId });\r\n    }\r\n\r\n    return removed;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿØŸàÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (ŸÖÿπ ÿ™ÿµŸÅŸäÿ© ÿßŸÑÿ£ÿØŸàÿßÿ± ÿßŸÑŸÖŸÜÿ™ŸáŸäÿ© ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©)\r\n   */\r\n  getUserRoles(userId) {\r\n    const assignments = this.userRoles.get(userId) || [];\r\n    const now = new Date();\r\n\r\n    return assignments\r\n      .filter(assignment => {\r\n        // ÿ™ÿµŸÅŸäÿ© ÿßŸÑÿ£ÿØŸàÿßÿ± ÿßŸÑŸÖŸÜÿ™ŸáŸäÿ© ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©\r\n        if (assignment.expiresAt && assignment.expiresAt < now) {\r\n          this.removeRoleFromUser(userId, assignment.roleId);\r\n          return false;\r\n        }\r\n\r\n        // ÿ™ÿµŸÅŸäÿ© ÿßŸÑÿ£ÿØŸàÿßÿ± ÿ∫Ÿäÿ± ÿßŸÑŸÜÿ¥ÿ∑ÿ©\r\n        if (!assignment.isActive) return false;\r\n\r\n        return true;\r\n      })\r\n      .map(assignment => ({\r\n        ...assignment,\r\n        ...this.roles.get(assignment.roleId)\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 4Ô∏è‚É£ PERMISSION CHECKING - ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ•ÿ∞ŸÜ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿπ ÿØÿπŸÖ ABAC\r\n   */\r\n  hasPermission(userId, permissionId, context = {}) {\r\n    const cacheKey = this._generateCacheKey(userId, permissionId, context);\r\n    \r\n    if (this.config.enableCache && this.permissionCache.has(cacheKey)) {\r\n      return this.permissionCache.get(cacheKey);\r\n    }\r\n\r\n    const userAssignments = this.getUserRoles(userId);\r\n    let hasAccess = false;\r\n\r\n    for (const assignment of userAssignments) {\r\n      const role = this.roles.get(assignment.roleId);\r\n      if (!role || !role.isActive) continue;\r\n\r\n      const permissions = this.getRolePermissions(assignment.roleId, true);\r\n\r\n      if (permissions.includes(permissionId)) {\r\n        // ŸÅÿ≠ÿµ ÿßŸÑÿ¥ÿ±Ÿàÿ∑ ŸàÿßŸÑŸÇŸäŸàÿØ\r\n        if (this._evaluateConditions(assignment, context)) {\r\n          hasAccess = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // ŸÅÿ≠ÿµ ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑŸÖÿÆÿµÿµÿ©\r\n    if (!hasAccess) {\r\n      hasAccess = this._evaluateCustomRules(userId, permissionId, context);\r\n    }\r\n\r\n    const result = { userId, permissionId, hasAccess, context, timestamp: new Date() };\r\n\r\n    // Anomaly Detection\r\n    if (!hasAccess) {\r\n      this._detectAnomalies(userId, result);\r\n    }\r\n\r\n    if (this.config.enableCache) {\r\n      this.permissionCache.set(cacheKey, hasAccess);\r\n      setTimeout(() => this.permissionCache.delete(cacheKey), this.config.cacheTTL);\r\n    }\r\n\r\n    this._recordAccessAttempt(userId, result);\r\n    return hasAccess;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™\r\n   */\r\n  hasAllPermissions(userId, permissionIds, context = {}) {\r\n    return permissionIds.every(permId => \r\n      this.hasPermission(userId, permId, context)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ£Ÿä ŸÖŸÜ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™\r\n   */\r\n  hasAnyPermission(userId, permissionIds, context = {}) {\r\n    return permissionIds.some(permId =>\r\n      this.hasPermission(userId, permId, context)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™ ÿßŸÑŸÅÿπŸÑŸäÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  getUserEffectivePermissions(userId, context = {}) {\r\n    const userRoles = this.getUserRoles(userId);\r\n    const effectivePermissions = new Set();\r\n\r\n    for (const assignment of userRoles) {\r\n      const permissions = this.getRolePermissions(assignment.roleId, true);\r\n      \r\n      for (const permId of permissions) {\r\n        // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ¥ÿ±Ÿàÿ∑\r\n        if (this._evaluateConditions(assignment, context)) {\r\n          effectivePermissions.add(permId);\r\n        }\r\n      }\r\n    }\r\n\r\n    return Array.from(effectivePermissions);\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 5Ô∏è‚É£ ATTRIBUTE-BASED ACCESS CONTROL (ABAC)\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ™ÿπŸäŸäŸÜ ÿÆÿµÿßÿ¶ÿµ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  setUserAttributes(userId, attributes) {\r\n    this.userAttributes.set(userId, {\r\n      ...this.userAttributes.get(userId),\r\n      ...attributes,\r\n      updatedAt: new Date()\r\n    });\r\n\r\n    this._clearUserCache(userId);\r\n    this._logAuditEvent('USER_ATTRIBUTES_UPDATED', { userId, attributes });\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿÆÿµÿßÿ¶ÿµ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  getUserAttributes(userId) {\r\n    return this.userAttributes.get(userId) || {};\r\n  }\r\n\r\n  /**\r\n   * ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¥ÿ±Ÿàÿ∑ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿÆÿµÿßÿ¶ÿµ\r\n   */\r\n  _evaluateConditions(assignment, context = {}) {\r\n    const conditions = assignment.conditions || {};\r\n    const userAttrs = this.getUserAttributes(context.userId || '');\r\n\r\n    for (const [key, expectedValue] of Object.entries(conditions)) {\r\n      const actualValue = context[key] || userAttrs[key];\r\n\r\n      if (!this._matchConditionValue(actualValue, expectedValue)) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 6Ô∏è‚É£ SCOPED ACCESS - ÿßŸÑŸàÿµŸàŸÑ ÿßŸÑŸÖÿ≠ÿØÿØ ÿßŸÑŸÜÿ∑ÿßŸÇ\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ≠ÿ≥ÿßÿ® ŸÜÿ∑ÿßŸÇ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  calculateUserScope(userId) {\r\n    const userRoles = this.getUserRoles(userId);\r\n    const scope = {\r\n      global: false,\r\n      departments: new Set(),\r\n      teams: new Set(),\r\n      resources: new Set(),\r\n      custom: {}\r\n    };\r\n\r\n    for (const assignment of userRoles) {\r\n      if (assignment.scope === 'global') {\r\n        scope.global = true;\r\n      } else if (assignment.scope === 'department' && assignment.scopeData?.departmentId) {\r\n        scope.departments.add(assignment.scopeData.departmentId);\r\n      } else if (assignment.scope === 'team' && assignment.scopeData?.teamId) {\r\n        scope.teams.add(assignment.scopeData.teamId);\r\n      }\r\n\r\n      // Custom scope data\r\n      if (assignment.scopeData?.custom) {\r\n        Object.assign(scope.custom, assignment.scopeData.custom);\r\n      }\r\n    }\r\n\r\n    return scope;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸàÿµŸàŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ•ŸÑŸâ ŸÖŸàÿ±ÿØ ŸÖÿ≠ÿØÿØ\r\n   */\r\n  canAccessResource(userId, resourceId, context = {}) {\r\n    const scope = this.calculateUserScope(userId);\r\n\r\n    if (scope.global) return true;\r\n\r\n    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÜÿ∑ÿßŸÇÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ©\r\n    if (context.departmentId && scope.departments.has(context.departmentId)) {\r\n      return true;\r\n    }\r\n\r\n    if (context.teamId && scope.teams.has(context.teamId)) {\r\n      return true;\r\n    }\r\n\r\n    if (scope.resources.has(resourceId)) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 7Ô∏è‚É£ AUDIT & LOGGING - ÿßŸÑÿ™ÿØŸÇŸäŸÇ ŸàÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿØÿ´ ÿ™ÿØŸÇŸäŸÇ\r\n   */\r\n  _logAuditEvent(eventType, data) {\r\n    if (!this.config.enableAudit) return;\r\n\r\n    const auditEntry = {\r\n      id: crypto.randomUUID(),\r\n      timestamp: new Date(),\r\n      eventType,\r\n      data,\r\n      severity: this._calculateEventSeverity(eventType)\r\n    };\r\n\r\n    this.auditLog.push(auditEntry);\r\n\r\n    // ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿ≠ÿØ ÿ£ŸÇÿµŸâ ŸÑŸÑÿ≥ÿ¨ŸÑÿßÿ™\r\n    if (this.auditLog.length > this.config.maxAuditEntries) {\r\n      this.auditLog = this.auditLog.slice(-this.config.maxAuditEntries);\r\n    }\r\n\r\n    this.emit('auditEvent', auditEntry);\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿØŸÇŸäŸÇ ŸÖÿπ ÿßŸÑÿ™ÿµŸÅŸäÿ©\r\n   */\r\n  getAuditLog(filters = {}) {\r\n    let results = this.auditLog;\r\n\r\n    if (filters.eventType) {\r\n      results = results.filter(e => e.eventType === filters.eventType);\r\n    }\r\n\r\n    if (filters.startDate) {\r\n      results = results.filter(e => e.timestamp >= filters.startDate);\r\n    }\r\n\r\n    if (filters.endDate) {\r\n      results = results.filter(e => e.timestamp <= filters.endDate);\r\n    }\r\n\r\n    if (filters.severity) {\r\n      results = results.filter(e => e.severity === filters.severity);\r\n    }\r\n\r\n    if (filters.limit) {\r\n      results = results.slice(-filters.limit);\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 8Ô∏è‚É£ ANOMALY DETECTION - ŸÉÿ¥ŸÅ ÿßŸÑÿ¥ÿ∞Ÿàÿ∞\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ŸÉÿ¥ŸÅ ÿßŸÑÿ≥ŸÑŸàŸÉ ÿ∫Ÿäÿ± ÿßŸÑÿ∑ÿ®ŸäÿπŸä\r\n   */\r\n  _detectAnomalies(userId, accessResult) {\r\n    if (!this.config.enableAnomaly) return;\r\n\r\n    if (!this.anomalyDetection.has(userId)) {\r\n      this.anomalyDetection.set(userId, {\r\n        deniedCount: 0,\r\n        lastCheck: new Date(),\r\n        patterns: []\r\n      });\r\n    }\r\n\r\n    const userAnomaly = this.anomalyDetection.get(userId);\r\n    userAnomaly.deniedCount++;\r\n    userAnomaly.lastCheck = new Date();\r\n\r\n    // ÿ™ŸÜÿ®ŸäŸáÿßÿ™\r\n    if (userAnomaly.deniedCount >= this.config.anomalyThreshold) {\r\n      this._logAuditEvent('ANOMALY_DETECTED', {\r\n        userId,\r\n        deniedCount: userAnomaly.deniedCount,\r\n        accessResult\r\n      });\r\n\r\n      this.emit('anomalyDetected', {\r\n        userId,\r\n        reason: 'Multiple denied access attempts',\r\n        count: userAnomaly.deniedCount\r\n      });\r\n\r\n      // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿπÿØÿßÿØ ÿ®ÿπÿØ ÿ®ÿπÿ∂ ÿßŸÑŸàŸÇÿ™\r\n      setTimeout(() => {\r\n        const anomaly = this.anomalyDetection.get(userId);\r\n        if (anomaly) anomaly.deniedCount = 0;\r\n      }, 3600000); // ÿ≥ÿßÿπÿ© Ÿàÿßÿ≠ÿØÿ©\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿ∞Ÿàÿ∞\r\n   */\r\n  getAnomalyReport() {\r\n    const report = [];\r\n\r\n    for (const [userId, anomaly] of this.anomalyDetection.entries()) {\r\n      if (anomaly.deniedCount > 0) {\r\n        report.push({\r\n          userId,\r\n          deniedCount: anomaly.deniedCount,\r\n          lastCheck: anomaly.lastCheck,\r\n          riskLevel: anomaly.deniedCount > this.config.anomalyThreshold ? 'high' : 'medium'\r\n        });\r\n      }\r\n    }\r\n\r\n    return report.sort((a, b) => b.deniedCount - a.deniedCount);\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * 9Ô∏è‚É£ UTILITY METHODS - ÿßŸÑÿ∑ÿ±ŸÇ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n   */\r\n  _generateCacheKey(userId, permissionId, context) {\r\n    const contextStr = JSON.stringify(context);\r\n    return `${userId}:${permissionId}:${contextStr}`;\r\n  }\r\n\r\n  /**\r\n   * ŸÖÿ≥ÿ≠ ÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  _clearUserCache(userId) {\r\n    const keysToDelete = Array.from(this.permissionCache.keys())\r\n      .filter(key => key.startsWith(userId));\r\n\r\n    keysToDelete.forEach(key => this.permissionCache.delete(key));\r\n  }\r\n\r\n  /**\r\n   * ŸÖÿ≥ÿ≠ ÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑÿØŸàÿ±\r\n   */\r\n  _clearRoleCache(roleId) {\r\n    const keysToDelete = Array.from(this.permissionCache.keys())\r\n      .filter(key => key.includes(`role_perms_${roleId}`));\r\n\r\n    keysToDelete.forEach(key => this.permissionCache.delete(key));\r\n  }\r\n\r\n  /**\r\n   * ÿ≠ÿ≥ÿßÿ® ÿ¥ÿØÿ© ÿßŸÑÿ≠ÿØÿ´\r\n   */\r\n  _calculateEventSeverity(eventType) {\r\n    const severityMap = {\r\n      ROLE_CREATED: 'medium',\r\n      ROLE_DELETED: 'high',\r\n      PERMISSION_ASSIGNED: 'low',\r\n      PERMISSION_REMOVED: 'medium',\r\n      ROLE_ASSIGNED: 'low',\r\n      ROLE_REMOVED: 'medium',\r\n      ANOMALY_DETECTED: 'high'\r\n    };\r\n\r\n    return severityMap[eventType] || 'low';\r\n  }\r\n\r\n  /**\r\n   * ÿ•ÿπÿØÿßÿØ Ÿáÿ±ŸÖŸäÿ© ÿßŸÑÿ£ÿØŸàÿßÿ±\r\n   */\r\n  _setupRoleHierarchy(childRoleId, parentRoleId) {\r\n    this.roleHierarchy.set(childRoleId, parentRoleId);\r\n    const parent = this.roles.get(parentRoleId);\r\n    if (parent) {\r\n      parent.childRoles.add(childRoleId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑŸÖÿÆÿµÿµÿ©\r\n   */\r\n  _evaluateCustomRules(userId, permissionId, context) {\r\n    const rules = this.customRules.get(`${userId}:${permissionId}`) || [];\r\n    return rules.some(rule => rule.eval(context));\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿ™ÿπŸäŸäŸÜ\r\n   */\r\n  _validateAssignmentConditions(userId, assignment) {\r\n    const role = this.roles.get(assignment.roleId);\r\n    return role && role.isActive;\r\n  }\r\n\r\n  /**\r\n   * ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÇŸäŸÖÿ© ÿßŸÑÿ¥ÿ±ÿ∑\r\n   */\r\n  _matchConditionValue(actual, expected) {\r\n    if (typeof expected === 'function') {\r\n      return expected(actual);\r\n    }\r\n    if (Array.isArray(expected)) {\r\n      return expected.includes(actual);\r\n    }\r\n    return actual === expected;\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑŸàÿµŸàŸÑ\r\n   */\r\n  _recordAccessAttempt(userId, result) {\r\n    if (!this.accessHistory.has(userId)) {\r\n      this.accessHistory.set(userId, []);\r\n    }\r\n\r\n    this.accessHistory.get(userId).push(result);\r\n\r\n    // ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿ¢ÿÆÿ± 1000 ŸÖÿ≠ÿßŸàŸÑÿ© ŸÅŸÇÿ∑\r\n    const history = this.accessHistory.get(userId);\r\n    if (history.length > 1000) {\r\n      this.accessHistory.set(userId, history.slice(-1000));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ≥ÿ¨ŸÑ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ\r\n   */\r\n  getUserAccessHistory(userId, limit = 100) {\r\n    const history = this.accessHistory.get(userId) || [];\r\n    return history.slice(-limit);\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * INITIALIZATION - ÿßŸÑÿ™ŸáŸäÿ¶ÿ©\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  _initializeDefaults() {\r\n    // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ£ÿØŸàÿßÿ± ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©\r\n    this.createRole('super-admin', {\r\n      name: 'Super Administrator',\r\n      description: 'Full system access with all permissions',\r\n      level: 1000,\r\n      isSystem: true,\r\n      scope: 'global'\r\n    });\r\n\r\n    this.createRole('admin', {\r\n      name: 'Administrator',\r\n      description: 'System administrator with management rights',\r\n      level: 800,\r\n      isSystem: true,\r\n      parentRole: 'super-admin',\r\n      scope: 'global'\r\n    });\r\n\r\n    this.createRole('manager', {\r\n      name: 'Manager',\r\n      description: 'Department manager with limited administrative rights',\r\n      level: 600,\r\n      isSystem: true,\r\n      parentRole: 'admin',\r\n      scope: 'department'\r\n    });\r\n\r\n    this.createRole('user', {\r\n      name: 'User',\r\n      description: 'Standard user with basic permissions',\r\n      level: 200,\r\n      isSystem: true,\r\n      parentRole: 'manager',\r\n      scope: 'global'\r\n    });\r\n\r\n    this.createRole('guest', {\r\n      name: 'Guest',\r\n      description: 'Guest user with minimal read-only access',\r\n      level: 100,\r\n      isSystem: true,\r\n      parentRole: 'user',\r\n      scope: 'global'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ\r\n   */\r\n  getSystemStats() {\r\n    return {\r\n      totalRoles: this.roles.size,\r\n      totalPermissions: this.permissions.size,\r\n      totalUsers: this.userRoles.size,\r\n      auditLogEntries: this.auditLog.length,\r\n      cacheSize: this.permissionCache.size,\r\n      anomaliesDetected: this.anomalyDetection.size\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä\r\n   */\r\n  exportData() {\r\n    return {\r\n      roles: Array.from(this.roles.entries()),\r\n      permissions: Array.from(this.permissions.entries()),\r\n      userRoles: Array.from(this.userRoles.entries()),\r\n      userAttributes: Array.from(this.userAttributes.entries()),\r\n      auditLog: this.auditLog.slice(-1000) // ÿ¢ÿÆÿ± 1000 ÿ≠ÿØÿ´\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©\r\n   */\r\n  importData(data) {\r\n    if (data.roles) {\r\n      this.roles = new Map(data.roles);\r\n    }\r\n    if (data.permissions) {\r\n      this.permissions = new Map(data.permissions);\r\n    }\r\n    if (data.userRoles) {\r\n      this.userRoles = new Map(data.userRoles);\r\n    }\r\n    if (data.userAttributes) {\r\n      this.userAttributes = new Map(data.userAttributes);\r\n    }\r\n\r\n    this._logAuditEvent('DATA_IMPORTED', { timestamp: new Date() });\r\n  }\r\n}\r\n\r\nmodule.exports = AdvancedRBACSystem;\r\n"],"mappings":"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","ignoreList":[]}