a0813a52404ee14a2dec02ea436c2153
/**
 * خدمات المقاييس والتقييمات الشاملة
 * Comprehensive Measurement Services
 * ==================================
 */

const {
  MeasurementType,
  MeasurementMaster,
  MeasurementResult,
  IndividualRehabPlan,
  QuickAssessment
} = require('../models/MeasurementModels');
const {
  RehabilitationProgram,
  ProgramProgress,
  ProgramSession
} = require('../models/RehabilitationProgramModels');
const SmartEngine = require('./SmartMeasurementProgramEngine');
class MeasurementService {
  /**
   * إنشاء نوع مقياس جديد
   */
  async createMeasurementType(data) {
    try {
      const measurementType = new MeasurementType({
        code: data.code,
        nameAr: data.nameAr,
        nameEn: data.nameEn,
        category: data.category,
        description: data.description,
        targetDisabilities: data.targetDisabilities,
        ageRange: data.ageRange,
        estimatedTime: data.estimatedTime,
        isStandardized: data.isStandardized,
        normSource: data.normSource,
        scoringMethod: data.scoringMethod,
        scoreRange: data.scoreRange,
        interpretationLevels: data.interpretationLevels,
        domains: data.domains,
        administratedBy: data.administratedBy
      });
      return await measurementType.save();
    } catch (error) {
      throw new Error(`خطأ في إنشاء نوع المقياس: ${error.message}`);
    }
  }

  /**
   * إنشاء مقياس رئيسي
   */
  async createMeasurementMaster(data) {
    try {
      const measurementMaster = new MeasurementMaster({
        code: data.code,
        typeId: data.typeId,
        nameAr: data.nameAr,
        nameEn: data.nameEn,
        description: data.description,
        version: data.version,
        targetDisabilities: data.targetDisabilities,
        ageRange: data.ageRange,
        administrationGuide: data.administrationGuide,
        items: data.items,
        totalItems: data.totalItems,
        estimatedDuration: data.estimatedDuration,
        scoringMethod: data.scoringMethod,
        scoringGuide: data.scoringGuide,
        normTables: data.normTables,
        reliabilityCoefficients: data.reliabilityCoefficients,
        validityInfo: data.validityInfo,
        interpretationGuide: data.interpretationGuide,
        requiredCertifications: data.requiredCertifications,
        culturalAdaptations: data.culturalAdaptations
      });
      return await measurementMaster.save();
    } catch (error) {
      throw new Error(`خطأ في إنشاء المقياس الرئيسي: ${error.message}`);
    }
  }

  /**
   * تسجيل نتيجة قياس جديدة
   */
  async recordMeasurementResult(beneficiaryId, data) {
    try {
      const measurementResult = new MeasurementResult({
        beneficiaryId,
        measurementId: data.measurementId,
        typeId: data.typeId,
        administratedBy: data.administratedBy,
        dateAdministrated: data.dateAdministrated,
        rawScore: data.rawScore,
        standardScore: data.standardScore,
        percentileRank: data.percentileRank,
        ageEquivalent: data.ageEquivalent,
        gradeEquivalent: data.gradeEquivalent,
        domainScores: data.domainScores,
        overallLevel: data.overallLevel,
        interpretation: data.interpretation,
        behavioralObservations: data.behavioralObservations,
        testingLimitations: data.testingLimitations,
        recommendedFollowUp: data.recommendedFollowUp,
        status: 'PENDING_REVIEW'
      });
      const saved = await measurementResult.save();

      // تفعيل محرك الربط الذكي
      const smartEngine = new SmartEngine();
      const automatedPrograms = await smartEngine.analyzeMeasurementAndActivatePrograms(saved._id);
      return {
        measurementResult: saved,
        automatedPrograms
      };
    } catch (error) {
      throw new Error(`خطأ في تسجيل نتيجة القياس: ${error.message}`);
    }
  }

  /**
   * الحصول على آخر نتائج المستفيد
   */
  async getBeneficiaryLatestResults(beneficiaryId) {
    try {
      const results = await MeasurementResult.find({
        beneficiaryId,
        status: 'APPROVED'
      }).sort({
        dateAdministrated: -1
      }).populate('measurementId').populate('typeId').limit(10);
      return results;
    } catch (error) {
      throw new Error(`خطأ في جلب النتائج: ${error.message}`);
    }
  }

  /**
   * مقارنة نتائج القياس عبر الزمن
   */
  async compareMeasurementResults(beneficiaryId, measurementTypeId) {
    try {
      const results = await MeasurementResult.find({
        beneficiaryId,
        typeId: measurementTypeId,
        status: 'APPROVED'
      }).sort({
        dateAdministrated: 1
      }).populate('typeId');
      if (results.length < 2) {
        return {
          message: 'لا توجد نتائج كافية للمقارنة',
          results
        };
      }

      // حساب الفرق
      const trend = results.map(r => ({
        date: r.dateAdministrated,
        score: r.rawScore,
        level: r.overallLevel,
        progress: r.domainScores?.map(d => ({
          domain: d.domainName,
          score: d.standardScore
        }))
      }));
      const improvement = results[results.length - 1].rawScore - results[0].rawScore;
      const improvementPercentage = improvement / results[0].rawScore * 100;
      return {
        totalMeasurements: results.length,
        trend,
        totalImprovement: improvement,
        improvementPercentage: improvementPercentage.toFixed(2),
        direction: improvement > 0 ? 'تحسن' : improvement < 0 ? 'انخفاض' : 'مستقر'
      };
    } catch (error) {
      throw new Error(`خطأ في مقارنة النتائج: ${error.message}`);
    }
  }

  /**
   * إنشاء خطة تأهيلية فردية
   */
  async createIndividualRehabPlan(beneficiaryId, data) {
    try {
      const planCode = await this.generatePlanCode();
      const irp = new IndividualRehabPlan({
        beneficiaryId,
        planCode,
        beneficiaryInfo: data.beneficiaryInfo,
        planningTeam: data.planningTeam,
        baseMeasurements: data.baseMeasurements,
        vision: data.vision,
        mission: data.mission,
        rehabilitationAreas: data.rehabilitationAreas,
        activePrograms: data.activePrograms,
        milestones: data.milestones,
        recommendations: data.recommendations,
        familyInvolvement: data.familyInvolvement,
        externalCoordination: data.externalCoordination,
        planPeriod: data.planPeriod,
        status: 'DRAFT'
      });
      return await irp.save();
    } catch (error) {
      throw new Error(`خطأ في إنشاء خطة التأهيل: ${error.message}`);
    }
  }

  /**
   * تحديث خطة تأهيلية فردية
   */
  async updateIndividualRehabPlan(planId, updateData) {
    try {
      const updated = await IndividualRehabPlan.findByIdAndUpdate(planId, {
        ...updateData,
        updatedAt: new Date()
      }, {
        new: true
      });
      return updated;
    } catch (error) {
      throw new Error(`خطأ في تحديث خطة التأهيل: ${error.message}`);
    }
  }

  /**
   * الحصول على خطة التأهيل الفردية
   */
  async getIndividualRehabPlan(beneficiaryId) {
    try {
      const plan = await IndividualRehabPlan.findOne({
        beneficiaryId,
        status: {
          $in: ['DRAFT', 'ACTIVE', 'UNDER_REVIEW']
        }
      }).populate('planningTeam.userId').populate('baseMeasurements.resultId').populate('activePrograms.programId');
      return plan;
    } catch (error) {
      throw new Error(`خطأ في جلب خطة التأهيل: ${error.message}`);
    }
  }

  /**
   * إنشاء تقرير شامل للمستفيد
   */
  async generateComprehensiveReport(beneficiaryId) {
    try {
      const smartEngine = new SmartEngine();

      // جلب البيانات الشاملة
      const measurements = await MeasurementResult.find({
        beneficiaryId,
        status: 'APPROVED'
      }).sort({
        dateAdministrated: -1
      }).populate('typeId').populate('measurementId').limit(15);
      const programs = await ProgramProgress.find({
        beneficiaryId,
        overallStatus: {
          $in: ['ACTIVE', 'COMPLETED']
        }
      }).populate('programId');
      const irp = await IndividualRehabPlan.findOne({
        beneficiaryId,
        status: {
          $in: ['ACTIVE']
        }
      });

      // توليد التقرير
      const report = {
        beneficiaryId,
        generationDate: new Date(),
        measurements: {
          total: measurements.length,
          latest: measurements[0],
          history: measurements
        },
        programs: {
          active: programs.filter(p => p.overallStatus === 'ACTIVE'),
          completed: programs.filter(p => p.overallStatus === 'COMPLETED')
        },
        individualPlan: irp,
        summary: {
          overallStatus: this.calculateOverallStatus(measurements, programs),
          strengths: this.identifyStrengths(measurements),
          areasForImprovement: this.identifyAreasForImprovement(measurements),
          recommendations: this.generateFinalRecommendations(measurements, programs)
        }
      };
      return report;
    } catch (error) {
      throw new Error(`خطأ في إنشاء التقرير الشامل: ${error.message}`);
    }
  }

  /**
   * تسجيل جلسة برنامج
   */
  async recordProgramSession(beneficiaryId, programId, data) {
    try {
      const session = new ProgramSession({
        beneficiaryId,
        programId,
        sessionNumber: data.sessionNumber,
        scheduledDate: data.scheduledDate,
        actualDate: data.actualDate || new Date(),
        sessionDuration: data.sessionDuration,
        sessionType: data.sessionType,
        facilitators: data.facilitators,
        participants: data.participants,
        content: data.content,
        performance: data.performance,
        education: data.education,
        nextSteps: data.nextSteps,
        sessionOutcome: data.sessionOutcome,
        status: 'COMPLETED'
      });
      const saved = await session.save();

      // تحديث تقدم البرنامج
      await this.updateProgramProgress(beneficiaryId, programId, data);
      return saved;
    } catch (error) {
      throw new Error(`خطأ في تسجيل جلسة البرنامج: ${error.message}`);
    }
  }

  /**
   * تحديث تقدم البرنامج
   */
  async updateProgramProgress(beneficiaryId, programId, sessionData) {
    try {
      const progress = await ProgramProgress.findOne({
        beneficiaryId,
        programId
      });
      if (!progress) return;
      progress.completedSessions = (progress.completedSessions || 0) + 1;

      // تحديث تقدم الأهداف
      if (sessionData.performance?.taskCompletion) {
        for (let i = 0; i < progress.objectiveProgress.length; i++) {
          progress.objectiveProgress[i].progress += sessionData.performance.taskCompletion / progress.totalPlannedSessions;
        }
      }
      return await progress.save();
    } catch (error) {
      throw new Error(`خطأ في تحديث تقدم البرنامج: ${error.message}`);
    }
  }

  /**
   * دوال مساعدة
   */
  async generatePlanCode() {
    const count = await IndividualRehabPlan.countDocuments();
    const year = new Date().getFullYear();
    return `IRP-${year}-${String(count + 1).padStart(5, '0')}`;
  }
  calculateOverallStatus(measurements, programs) {
    if (!measurements.length) return 'جديد';
    return measurements[0].overallLevel;
  }
  identifyStrengths(measurements) {
    if (!measurements.length) return [];
    const latest = measurements[0];
    return latest.interpretation?.strengths || [];
  }
  identifyAreasForImprovement(measurements) {
    if (!measurements.length) return [];
    const latest = measurements[0];
    return latest.interpretation?.weaknesses || [];
  }
  generateFinalRecommendations(measurements, programs) {
    const recommendations = [];
    if (measurements.length === 0) {
      recommendations.push('تقييم شامل مطلوب');
      return recommendations;
    }
    const latest = measurements[0];
    recommendations.push(...(latest.interpretation?.recommendations || []));
    if (programs.filter(p => p.overallStatus === 'ACTIVE').length === 0) {
      recommendations.push('تفعيل برامج تدخلية');
    }
    return recommendations;
  }
}
module.exports = MeasurementService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNZWFzdXJlbWVudFR5cGUiLCJNZWFzdXJlbWVudE1hc3RlciIsIk1lYXN1cmVtZW50UmVzdWx0IiwiSW5kaXZpZHVhbFJlaGFiUGxhbiIsIlF1aWNrQXNzZXNzbWVudCIsInJlcXVpcmUiLCJSZWhhYmlsaXRhdGlvblByb2dyYW0iLCJQcm9ncmFtUHJvZ3Jlc3MiLCJQcm9ncmFtU2Vzc2lvbiIsIlNtYXJ0RW5naW5lIiwiTWVhc3VyZW1lbnRTZXJ2aWNlIiwiY3JlYXRlTWVhc3VyZW1lbnRUeXBlIiwiZGF0YSIsIm1lYXN1cmVtZW50VHlwZSIsImNvZGUiLCJuYW1lQXIiLCJuYW1lRW4iLCJjYXRlZ29yeSIsImRlc2NyaXB0aW9uIiwidGFyZ2V0RGlzYWJpbGl0aWVzIiwiYWdlUmFuZ2UiLCJlc3RpbWF0ZWRUaW1lIiwiaXNTdGFuZGFyZGl6ZWQiLCJub3JtU291cmNlIiwic2NvcmluZ01ldGhvZCIsInNjb3JlUmFuZ2UiLCJpbnRlcnByZXRhdGlvbkxldmVscyIsImRvbWFpbnMiLCJhZG1pbmlzdHJhdGVkQnkiLCJzYXZlIiwiZXJyb3IiLCJFcnJvciIsIm1lc3NhZ2UiLCJjcmVhdGVNZWFzdXJlbWVudE1hc3RlciIsIm1lYXN1cmVtZW50TWFzdGVyIiwidHlwZUlkIiwidmVyc2lvbiIsImFkbWluaXN0cmF0aW9uR3VpZGUiLCJpdGVtcyIsInRvdGFsSXRlbXMiLCJlc3RpbWF0ZWREdXJhdGlvbiIsInNjb3JpbmdHdWlkZSIsIm5vcm1UYWJsZXMiLCJyZWxpYWJpbGl0eUNvZWZmaWNpZW50cyIsInZhbGlkaXR5SW5mbyIsImludGVycHJldGF0aW9uR3VpZGUiLCJyZXF1aXJlZENlcnRpZmljYXRpb25zIiwiY3VsdHVyYWxBZGFwdGF0aW9ucyIsInJlY29yZE1lYXN1cmVtZW50UmVzdWx0IiwiYmVuZWZpY2lhcnlJZCIsIm1lYXN1cmVtZW50UmVzdWx0IiwibWVhc3VyZW1lbnRJZCIsImRhdGVBZG1pbmlzdHJhdGVkIiwicmF3U2NvcmUiLCJzdGFuZGFyZFNjb3JlIiwicGVyY2VudGlsZVJhbmsiLCJhZ2VFcXVpdmFsZW50IiwiZ3JhZGVFcXVpdmFsZW50IiwiZG9tYWluU2NvcmVzIiwib3ZlcmFsbExldmVsIiwiaW50ZXJwcmV0YXRpb24iLCJiZWhhdmlvcmFsT2JzZXJ2YXRpb25zIiwidGVzdGluZ0xpbWl0YXRpb25zIiwicmVjb21tZW5kZWRGb2xsb3dVcCIsInN0YXR1cyIsInNhdmVkIiwic21hcnRFbmdpbmUiLCJhdXRvbWF0ZWRQcm9ncmFtcyIsImFuYWx5emVNZWFzdXJlbWVudEFuZEFjdGl2YXRlUHJvZ3JhbXMiLCJfaWQiLCJnZXRCZW5lZmljaWFyeUxhdGVzdFJlc3VsdHMiLCJyZXN1bHRzIiwiZmluZCIsInNvcnQiLCJwb3B1bGF0ZSIsImxpbWl0IiwiY29tcGFyZU1lYXN1cmVtZW50UmVzdWx0cyIsIm1lYXN1cmVtZW50VHlwZUlkIiwibGVuZ3RoIiwidHJlbmQiLCJtYXAiLCJyIiwiZGF0ZSIsInNjb3JlIiwibGV2ZWwiLCJwcm9ncmVzcyIsImQiLCJkb21haW4iLCJkb21haW5OYW1lIiwiaW1wcm92ZW1lbnQiLCJpbXByb3ZlbWVudFBlcmNlbnRhZ2UiLCJ0b3RhbE1lYXN1cmVtZW50cyIsInRvdGFsSW1wcm92ZW1lbnQiLCJ0b0ZpeGVkIiwiZGlyZWN0aW9uIiwiY3JlYXRlSW5kaXZpZHVhbFJlaGFiUGxhbiIsInBsYW5Db2RlIiwiZ2VuZXJhdGVQbGFuQ29kZSIsImlycCIsImJlbmVmaWNpYXJ5SW5mbyIsInBsYW5uaW5nVGVhbSIsImJhc2VNZWFzdXJlbWVudHMiLCJ2aXNpb24iLCJtaXNzaW9uIiwicmVoYWJpbGl0YXRpb25BcmVhcyIsImFjdGl2ZVByb2dyYW1zIiwibWlsZXN0b25lcyIsInJlY29tbWVuZGF0aW9ucyIsImZhbWlseUludm9sdmVtZW50IiwiZXh0ZXJuYWxDb29yZGluYXRpb24iLCJwbGFuUGVyaW9kIiwidXBkYXRlSW5kaXZpZHVhbFJlaGFiUGxhbiIsInBsYW5JZCIsInVwZGF0ZURhdGEiLCJ1cGRhdGVkIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJ1cGRhdGVkQXQiLCJEYXRlIiwibmV3IiwiZ2V0SW5kaXZpZHVhbFJlaGFiUGxhbiIsInBsYW4iLCJmaW5kT25lIiwiJGluIiwiZ2VuZXJhdGVDb21wcmVoZW5zaXZlUmVwb3J0IiwibWVhc3VyZW1lbnRzIiwicHJvZ3JhbXMiLCJvdmVyYWxsU3RhdHVzIiwicmVwb3J0IiwiZ2VuZXJhdGlvbkRhdGUiLCJ0b3RhbCIsImxhdGVzdCIsImhpc3RvcnkiLCJhY3RpdmUiLCJmaWx0ZXIiLCJwIiwiY29tcGxldGVkIiwiaW5kaXZpZHVhbFBsYW4iLCJzdW1tYXJ5IiwiY2FsY3VsYXRlT3ZlcmFsbFN0YXR1cyIsInN0cmVuZ3RocyIsImlkZW50aWZ5U3RyZW5ndGhzIiwiYXJlYXNGb3JJbXByb3ZlbWVudCIsImlkZW50aWZ5QXJlYXNGb3JJbXByb3ZlbWVudCIsImdlbmVyYXRlRmluYWxSZWNvbW1lbmRhdGlvbnMiLCJyZWNvcmRQcm9ncmFtU2Vzc2lvbiIsInByb2dyYW1JZCIsInNlc3Npb24iLCJzZXNzaW9uTnVtYmVyIiwic2NoZWR1bGVkRGF0ZSIsImFjdHVhbERhdGUiLCJzZXNzaW9uRHVyYXRpb24iLCJzZXNzaW9uVHlwZSIsImZhY2lsaXRhdG9ycyIsInBhcnRpY2lwYW50cyIsImNvbnRlbnQiLCJwZXJmb3JtYW5jZSIsImVkdWNhdGlvbiIsIm5leHRTdGVwcyIsInNlc3Npb25PdXRjb21lIiwidXBkYXRlUHJvZ3JhbVByb2dyZXNzIiwic2Vzc2lvbkRhdGEiLCJjb21wbGV0ZWRTZXNzaW9ucyIsInRhc2tDb21wbGV0aW9uIiwiaSIsIm9iamVjdGl2ZVByb2dyZXNzIiwidG90YWxQbGFubmVkU2Vzc2lvbnMiLCJjb3VudCIsImNvdW50RG9jdW1lbnRzIiwieWVhciIsImdldEZ1bGxZZWFyIiwiU3RyaW5nIiwicGFkU3RhcnQiLCJ3ZWFrbmVzc2VzIiwicHVzaCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJNZWFzdXJlbWVudFNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqINiu2K/Zhdin2Kog2KfZhNmF2YLYp9mK2YrYsyDZiNin2YTYqtmC2YrZitmF2KfYqiDYp9mE2LTYp9mF2YTYqVxyXG4gKiBDb21wcmVoZW5zaXZlIE1lYXN1cmVtZW50IFNlcnZpY2VzXHJcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICovXHJcblxyXG5jb25zdCB7XHJcbiAgTWVhc3VyZW1lbnRUeXBlLFxyXG4gIE1lYXN1cmVtZW50TWFzdGVyLFxyXG4gIE1lYXN1cmVtZW50UmVzdWx0LFxyXG4gIEluZGl2aWR1YWxSZWhhYlBsYW4sXHJcbiAgUXVpY2tBc3Nlc3NtZW50XHJcbn0gPSByZXF1aXJlKCcuLi9tb2RlbHMvTWVhc3VyZW1lbnRNb2RlbHMnKTtcclxuXHJcbmNvbnN0IHtcclxuICBSZWhhYmlsaXRhdGlvblByb2dyYW0sXHJcbiAgUHJvZ3JhbVByb2dyZXNzLFxyXG4gIFByb2dyYW1TZXNzaW9uXHJcbn0gPSByZXF1aXJlKCcuLi9tb2RlbHMvUmVoYWJpbGl0YXRpb25Qcm9ncmFtTW9kZWxzJyk7XHJcblxyXG5jb25zdCBTbWFydEVuZ2luZSA9IHJlcXVpcmUoJy4vU21hcnRNZWFzdXJlbWVudFByb2dyYW1FbmdpbmUnKTtcclxuXHJcbmNsYXNzIE1lYXN1cmVtZW50U2VydmljZSB7XHJcbiAgLyoqXHJcbiAgICog2KXZhti02KfYoSDZhtmI2Lkg2YXZgtmK2KfYsyDYrNiv2YrYr1xyXG4gICAqL1xyXG4gIGFzeW5jIGNyZWF0ZU1lYXN1cmVtZW50VHlwZShkYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBtZWFzdXJlbWVudFR5cGUgPSBuZXcgTWVhc3VyZW1lbnRUeXBlKHtcclxuICAgICAgICBjb2RlOiBkYXRhLmNvZGUsXHJcbiAgICAgICAgbmFtZUFyOiBkYXRhLm5hbWVBcixcclxuICAgICAgICBuYW1lRW46IGRhdGEubmFtZUVuLFxyXG4gICAgICAgIGNhdGVnb3J5OiBkYXRhLmNhdGVnb3J5LFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgIHRhcmdldERpc2FiaWxpdGllczogZGF0YS50YXJnZXREaXNhYmlsaXRpZXMsXHJcbiAgICAgICAgYWdlUmFuZ2U6IGRhdGEuYWdlUmFuZ2UsXHJcbiAgICAgICAgZXN0aW1hdGVkVGltZTogZGF0YS5lc3RpbWF0ZWRUaW1lLFxyXG4gICAgICAgIGlzU3RhbmRhcmRpemVkOiBkYXRhLmlzU3RhbmRhcmRpemVkLFxyXG4gICAgICAgIG5vcm1Tb3VyY2U6IGRhdGEubm9ybVNvdXJjZSxcclxuICAgICAgICBzY29yaW5nTWV0aG9kOiBkYXRhLnNjb3JpbmdNZXRob2QsXHJcbiAgICAgICAgc2NvcmVSYW5nZTogZGF0YS5zY29yZVJhbmdlLFxyXG4gICAgICAgIGludGVycHJldGF0aW9uTGV2ZWxzOiBkYXRhLmludGVycHJldGF0aW9uTGV2ZWxzLFxyXG4gICAgICAgIGRvbWFpbnM6IGRhdGEuZG9tYWlucyxcclxuICAgICAgICBhZG1pbmlzdHJhdGVkQnk6IGRhdGEuYWRtaW5pc3RyYXRlZEJ5XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIGF3YWl0IG1lYXN1cmVtZW50VHlwZS5zYXZlKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYNiu2LfYoyDZgdmKINil2YbYtNin2KEg2YbZiNi5INin2YTZhdmC2YrYp9izOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYpdmG2LTYp9ihINmF2YLZitin2LMg2LHYptmK2LPZilxyXG4gICAqL1xyXG4gIGFzeW5jIGNyZWF0ZU1lYXN1cmVtZW50TWFzdGVyKGRhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG1lYXN1cmVtZW50TWFzdGVyID0gbmV3IE1lYXN1cmVtZW50TWFzdGVyKHtcclxuICAgICAgICBjb2RlOiBkYXRhLmNvZGUsXHJcbiAgICAgICAgdHlwZUlkOiBkYXRhLnR5cGVJZCxcclxuICAgICAgICBuYW1lQXI6IGRhdGEubmFtZUFyLFxyXG4gICAgICAgIG5hbWVFbjogZGF0YS5uYW1lRW4sXHJcbiAgICAgICAgZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgdmVyc2lvbjogZGF0YS52ZXJzaW9uLFxyXG4gICAgICAgIHRhcmdldERpc2FiaWxpdGllczogZGF0YS50YXJnZXREaXNhYmlsaXRpZXMsXHJcbiAgICAgICAgYWdlUmFuZ2U6IGRhdGEuYWdlUmFuZ2UsXHJcbiAgICAgICAgYWRtaW5pc3RyYXRpb25HdWlkZTogZGF0YS5hZG1pbmlzdHJhdGlvbkd1aWRlLFxyXG4gICAgICAgIGl0ZW1zOiBkYXRhLml0ZW1zLFxyXG4gICAgICAgIHRvdGFsSXRlbXM6IGRhdGEudG90YWxJdGVtcyxcclxuICAgICAgICBlc3RpbWF0ZWREdXJhdGlvbjogZGF0YS5lc3RpbWF0ZWREdXJhdGlvbixcclxuICAgICAgICBzY29yaW5nTWV0aG9kOiBkYXRhLnNjb3JpbmdNZXRob2QsXHJcbiAgICAgICAgc2NvcmluZ0d1aWRlOiBkYXRhLnNjb3JpbmdHdWlkZSxcclxuICAgICAgICBub3JtVGFibGVzOiBkYXRhLm5vcm1UYWJsZXMsXHJcbiAgICAgICAgcmVsaWFiaWxpdHlDb2VmZmljaWVudHM6IGRhdGEucmVsaWFiaWxpdHlDb2VmZmljaWVudHMsXHJcbiAgICAgICAgdmFsaWRpdHlJbmZvOiBkYXRhLnZhbGlkaXR5SW5mbyxcclxuICAgICAgICBpbnRlcnByZXRhdGlvbkd1aWRlOiBkYXRhLmludGVycHJldGF0aW9uR3VpZGUsXHJcbiAgICAgICAgcmVxdWlyZWRDZXJ0aWZpY2F0aW9uczogZGF0YS5yZXF1aXJlZENlcnRpZmljYXRpb25zLFxyXG4gICAgICAgIGN1bHR1cmFsQWRhcHRhdGlvbnM6IGRhdGEuY3VsdHVyYWxBZGFwdGF0aW9uc1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiBhd2FpdCBtZWFzdXJlbWVudE1hc3Rlci5zYXZlKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYNiu2LfYoyDZgdmKINil2YbYtNin2KEg2KfZhNmF2YLZitin2LMg2KfZhNix2KbZitiz2Yo6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiq2LPYrNmK2YQg2YbYqtmK2KzYqSDZgtmK2KfYsyDYrNiv2YrYr9ipXHJcbiAgICovXHJcbiAgYXN5bmMgcmVjb3JkTWVhc3VyZW1lbnRSZXN1bHQoYmVuZWZpY2lhcnlJZCwgZGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgbWVhc3VyZW1lbnRSZXN1bHQgPSBuZXcgTWVhc3VyZW1lbnRSZXN1bHQoe1xyXG4gICAgICAgIGJlbmVmaWNpYXJ5SWQsXHJcbiAgICAgICAgbWVhc3VyZW1lbnRJZDogZGF0YS5tZWFzdXJlbWVudElkLFxyXG4gICAgICAgIHR5cGVJZDogZGF0YS50eXBlSWQsXHJcbiAgICAgICAgYWRtaW5pc3RyYXRlZEJ5OiBkYXRhLmFkbWluaXN0cmF0ZWRCeSxcclxuICAgICAgICBkYXRlQWRtaW5pc3RyYXRlZDogZGF0YS5kYXRlQWRtaW5pc3RyYXRlZCxcclxuICAgICAgICByYXdTY29yZTogZGF0YS5yYXdTY29yZSxcclxuICAgICAgICBzdGFuZGFyZFNjb3JlOiBkYXRhLnN0YW5kYXJkU2NvcmUsXHJcbiAgICAgICAgcGVyY2VudGlsZVJhbms6IGRhdGEucGVyY2VudGlsZVJhbmssXHJcbiAgICAgICAgYWdlRXF1aXZhbGVudDogZGF0YS5hZ2VFcXVpdmFsZW50LFxyXG4gICAgICAgIGdyYWRlRXF1aXZhbGVudDogZGF0YS5ncmFkZUVxdWl2YWxlbnQsXHJcbiAgICAgICAgZG9tYWluU2NvcmVzOiBkYXRhLmRvbWFpblNjb3JlcyxcclxuICAgICAgICBvdmVyYWxsTGV2ZWw6IGRhdGEub3ZlcmFsbExldmVsLFxyXG4gICAgICAgIGludGVycHJldGF0aW9uOiBkYXRhLmludGVycHJldGF0aW9uLFxyXG4gICAgICAgIGJlaGF2aW9yYWxPYnNlcnZhdGlvbnM6IGRhdGEuYmVoYXZpb3JhbE9ic2VydmF0aW9ucyxcclxuICAgICAgICB0ZXN0aW5nTGltaXRhdGlvbnM6IGRhdGEudGVzdGluZ0xpbWl0YXRpb25zLFxyXG4gICAgICAgIHJlY29tbWVuZGVkRm9sbG93VXA6IGRhdGEucmVjb21tZW5kZWRGb2xsb3dVcCxcclxuICAgICAgICBzdGF0dXM6ICdQRU5ESU5HX1JFVklFVydcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBzYXZlZCA9IGF3YWl0IG1lYXN1cmVtZW50UmVzdWx0LnNhdmUoKTtcclxuXHJcbiAgICAgIC8vINiq2YHYudmK2YQg2YXYrdix2YMg2KfZhNix2KjYtyDYp9mE2LDZg9mKXHJcbiAgICAgIGNvbnN0IHNtYXJ0RW5naW5lID0gbmV3IFNtYXJ0RW5naW5lKCk7XHJcbiAgICAgIGNvbnN0IGF1dG9tYXRlZFByb2dyYW1zID0gYXdhaXQgc21hcnRFbmdpbmUuYW5hbHl6ZU1lYXN1cmVtZW50QW5kQWN0aXZhdGVQcm9ncmFtcyhcclxuICAgICAgICBzYXZlZC5faWRcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVhc3VyZW1lbnRSZXN1bHQ6IHNhdmVkLFxyXG4gICAgICAgIGF1dG9tYXRlZFByb2dyYW1zXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYNiu2LfYoyDZgdmKINiq2LPYrNmK2YQg2YbYqtmK2KzYqSDYp9mE2YLZitin2LM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2KLYrtixINmG2KrYp9im2Kwg2KfZhNmF2LPYqtmB2YrYr1xyXG4gICAqL1xyXG4gIGFzeW5jIGdldEJlbmVmaWNpYXJ5TGF0ZXN0UmVzdWx0cyhiZW5lZmljaWFyeUlkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgTWVhc3VyZW1lbnRSZXN1bHQuZmluZCh7XHJcbiAgICAgICAgYmVuZWZpY2lhcnlJZCxcclxuICAgICAgICBzdGF0dXM6ICdBUFBST1ZFRCdcclxuICAgICAgfSlcclxuICAgICAgICAuc29ydCh7IGRhdGVBZG1pbmlzdHJhdGVkOiAtMSB9KVxyXG4gICAgICAgIC5wb3B1bGF0ZSgnbWVhc3VyZW1lbnRJZCcpXHJcbiAgICAgICAgLnBvcHVsYXRlKCd0eXBlSWQnKVxyXG4gICAgICAgIC5saW1pdCgxMCk7XHJcblxyXG4gICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihg2K7Yt9ijINmB2Yog2KzZhNioINin2YTZhtiq2KfYptisOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDZhdmC2KfYsdmG2Kkg2YbYqtin2KbYrCDYp9mE2YLZitin2LMg2LnYqNixINin2YTYstmF2YZcclxuICAgKi9cclxuICBhc3luYyBjb21wYXJlTWVhc3VyZW1lbnRSZXN1bHRzKGJlbmVmaWNpYXJ5SWQsIG1lYXN1cmVtZW50VHlwZUlkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgTWVhc3VyZW1lbnRSZXN1bHQuZmluZCh7XHJcbiAgICAgICAgYmVuZWZpY2lhcnlJZCxcclxuICAgICAgICB0eXBlSWQ6IG1lYXN1cmVtZW50VHlwZUlkLFxyXG4gICAgICAgIHN0YXR1czogJ0FQUFJPVkVEJ1xyXG4gICAgICB9KVxyXG4gICAgICAgIC5zb3J0KHsgZGF0ZUFkbWluaXN0cmF0ZWQ6IDEgfSlcclxuICAgICAgICAucG9wdWxhdGUoJ3R5cGVJZCcpO1xyXG5cclxuICAgICAgaWYgKHJlc3VsdHMubGVuZ3RoIDwgMikge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBtZXNzYWdlOiAn2YTYpyDYqtmI2KzYryDZhtiq2KfYptisINmD2KfZgdmK2Kkg2YTZhNmF2YLYp9ix2YbYqScsXHJcbiAgICAgICAgICByZXN1bHRzXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g2K3Ys9in2Kgg2KfZhNmB2LHZglxyXG4gICAgICBjb25zdCB0cmVuZCA9IHJlc3VsdHMubWFwKHIgPT4gKHtcclxuICAgICAgICBkYXRlOiByLmRhdGVBZG1pbmlzdHJhdGVkLFxyXG4gICAgICAgIHNjb3JlOiByLnJhd1Njb3JlLFxyXG4gICAgICAgIGxldmVsOiByLm92ZXJhbGxMZXZlbCxcclxuICAgICAgICBwcm9ncmVzczogci5kb21haW5TY29yZXM/Lm1hcChkID0+ICh7XHJcbiAgICAgICAgICBkb21haW46IGQuZG9tYWluTmFtZSxcclxuICAgICAgICAgIHNjb3JlOiBkLnN0YW5kYXJkU2NvcmVcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgaW1wcm92ZW1lbnQgPSByZXN1bHRzW3Jlc3VsdHMubGVuZ3RoIC0gMV0ucmF3U2NvcmUgLSByZXN1bHRzWzBdLnJhd1Njb3JlO1xyXG4gICAgICBjb25zdCBpbXByb3ZlbWVudFBlcmNlbnRhZ2UgPSAoaW1wcm92ZW1lbnQgLyByZXN1bHRzWzBdLnJhd1Njb3JlKSAqIDEwMDtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdG90YWxNZWFzdXJlbWVudHM6IHJlc3VsdHMubGVuZ3RoLFxyXG4gICAgICAgIHRyZW5kLFxyXG4gICAgICAgIHRvdGFsSW1wcm92ZW1lbnQ6IGltcHJvdmVtZW50LFxyXG4gICAgICAgIGltcHJvdmVtZW50UGVyY2VudGFnZTogaW1wcm92ZW1lbnRQZXJjZW50YWdlLnRvRml4ZWQoMiksXHJcbiAgICAgICAgZGlyZWN0aW9uOiBpbXByb3ZlbWVudCA+IDAgPyAn2KrYrdiz2YYnIDogaW1wcm92ZW1lbnQgPCAwID8gJ9in2YbYrtmB2KfYticgOiAn2YXYs9iq2YLYsSdcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihg2K7Yt9ijINmB2Yog2YXZgtin2LHZhtipINin2YTZhtiq2KfYptisOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYpdmG2LTYp9ihINiu2LfYqSDYqtij2YfZitmE2YrYqSDZgdix2K/ZitipXHJcbiAgICovXHJcbiAgYXN5bmMgY3JlYXRlSW5kaXZpZHVhbFJlaGFiUGxhbihiZW5lZmljaWFyeUlkLCBkYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBwbGFuQ29kZSA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVQbGFuQ29kZSgpO1xyXG5cclxuICAgICAgY29uc3QgaXJwID0gbmV3IEluZGl2aWR1YWxSZWhhYlBsYW4oe1xyXG4gICAgICAgIGJlbmVmaWNpYXJ5SWQsXHJcbiAgICAgICAgcGxhbkNvZGUsXHJcbiAgICAgICAgYmVuZWZpY2lhcnlJbmZvOiBkYXRhLmJlbmVmaWNpYXJ5SW5mbyxcclxuICAgICAgICBwbGFubmluZ1RlYW06IGRhdGEucGxhbm5pbmdUZWFtLFxyXG4gICAgICAgIGJhc2VNZWFzdXJlbWVudHM6IGRhdGEuYmFzZU1lYXN1cmVtZW50cyxcclxuICAgICAgICB2aXNpb246IGRhdGEudmlzaW9uLFxyXG4gICAgICAgIG1pc3Npb246IGRhdGEubWlzc2lvbixcclxuICAgICAgICByZWhhYmlsaXRhdGlvbkFyZWFzOiBkYXRhLnJlaGFiaWxpdGF0aW9uQXJlYXMsXHJcbiAgICAgICAgYWN0aXZlUHJvZ3JhbXM6IGRhdGEuYWN0aXZlUHJvZ3JhbXMsXHJcbiAgICAgICAgbWlsZXN0b25lczogZGF0YS5taWxlc3RvbmVzLFxyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogZGF0YS5yZWNvbW1lbmRhdGlvbnMsXHJcbiAgICAgICAgZmFtaWx5SW52b2x2ZW1lbnQ6IGRhdGEuZmFtaWx5SW52b2x2ZW1lbnQsXHJcbiAgICAgICAgZXh0ZXJuYWxDb29yZGluYXRpb246IGRhdGEuZXh0ZXJuYWxDb29yZGluYXRpb24sXHJcbiAgICAgICAgcGxhblBlcmlvZDogZGF0YS5wbGFuUGVyaW9kLFxyXG4gICAgICAgIHN0YXR1czogJ0RSQUZUJ1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiBhd2FpdCBpcnAuc2F2ZSgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGDYrti32KMg2YHZiiDYpdmG2LTYp9ihINiu2LfYqSDYp9mE2KrYo9mH2YrZhDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KrYrdiv2YrYqyDYrti32Kkg2KrYo9mH2YrZhNmK2Kkg2YHYsdiv2YrYqVxyXG4gICAqL1xyXG4gIGFzeW5jIHVwZGF0ZUluZGl2aWR1YWxSZWhhYlBsYW4ocGxhbklkLCB1cGRhdGVEYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgSW5kaXZpZHVhbFJlaGFiUGxhbi5maW5kQnlJZEFuZFVwZGF0ZShcclxuICAgICAgICBwbGFuSWQsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4udXBkYXRlRGF0YSxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBuZXc6IHRydWUgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHVwZGF0ZWQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYNiu2LfYoyDZgdmKINiq2K3Yr9mK2Ksg2K7Yt9ipINin2YTYqtij2YfZitmEOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINiu2LfYqSDYp9mE2KrYo9mH2YrZhCDYp9mE2YHYsdiv2YrYqVxyXG4gICAqL1xyXG4gIGFzeW5jIGdldEluZGl2aWR1YWxSZWhhYlBsYW4oYmVuZWZpY2lhcnlJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcGxhbiA9IGF3YWl0IEluZGl2aWR1YWxSZWhhYlBsYW4uZmluZE9uZSh7XHJcbiAgICAgICAgYmVuZWZpY2lhcnlJZCxcclxuICAgICAgICBzdGF0dXM6IHsgJGluOiBbJ0RSQUZUJywgJ0FDVElWRScsICdVTkRFUl9SRVZJRVcnXSB9XHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnBvcHVsYXRlKCdwbGFubmluZ1RlYW0udXNlcklkJylcclxuICAgICAgICAucG9wdWxhdGUoJ2Jhc2VNZWFzdXJlbWVudHMucmVzdWx0SWQnKVxyXG4gICAgICAgIC5wb3B1bGF0ZSgnYWN0aXZlUHJvZ3JhbXMucHJvZ3JhbUlkJyk7XHJcblxyXG4gICAgICByZXR1cm4gcGxhbjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihg2K7Yt9ijINmB2Yog2KzZhNioINiu2LfYqSDYp9mE2KrYo9mH2YrZhDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KXZhti02KfYoSDYqtmC2LHZitixINi02KfZhdmEINmE2YTZhdiz2KrZgdmK2K9cclxuICAgKi9cclxuICBhc3luYyBnZW5lcmF0ZUNvbXByZWhlbnNpdmVSZXBvcnQoYmVuZWZpY2lhcnlJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc21hcnRFbmdpbmUgPSBuZXcgU21hcnRFbmdpbmUoKTtcclxuICAgICAgXHJcbiAgICAgIC8vINis2YTYqCDYp9mE2KjZitin2YbYp9iqINin2YTYtNin2YXZhNipXHJcbiAgICAgIGNvbnN0IG1lYXN1cmVtZW50cyA9IGF3YWl0IE1lYXN1cmVtZW50UmVzdWx0LmZpbmQoe1xyXG4gICAgICAgIGJlbmVmaWNpYXJ5SWQsXHJcbiAgICAgICAgc3RhdHVzOiAnQVBQUk9WRUQnXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnNvcnQoeyBkYXRlQWRtaW5pc3RyYXRlZDogLTEgfSlcclxuICAgICAgICAucG9wdWxhdGUoJ3R5cGVJZCcpXHJcbiAgICAgICAgLnBvcHVsYXRlKCdtZWFzdXJlbWVudElkJylcclxuICAgICAgICAubGltaXQoMTUpO1xyXG5cclxuICAgICAgY29uc3QgcHJvZ3JhbXMgPSBhd2FpdCBQcm9ncmFtUHJvZ3Jlc3MuZmluZCh7XHJcbiAgICAgICAgYmVuZWZpY2lhcnlJZCxcclxuICAgICAgICBvdmVyYWxsU3RhdHVzOiB7ICRpbjogWydBQ1RJVkUnLCAnQ09NUExFVEVEJ10gfVxyXG4gICAgICB9KVxyXG4gICAgICAgIC5wb3B1bGF0ZSgncHJvZ3JhbUlkJyk7XHJcblxyXG4gICAgICBjb25zdCBpcnAgPSBhd2FpdCBJbmRpdmlkdWFsUmVoYWJQbGFuLmZpbmRPbmUoe1xyXG4gICAgICAgIGJlbmVmaWNpYXJ5SWQsXHJcbiAgICAgICAgc3RhdHVzOiB7ICRpbjogWydBQ1RJVkUnXSB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8g2KrZiNmE2YrYryDYp9mE2KrZgtix2YrYsVxyXG4gICAgICBjb25zdCByZXBvcnQgPSB7XHJcbiAgICAgICAgYmVuZWZpY2lhcnlJZCxcclxuICAgICAgICBnZW5lcmF0aW9uRGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICBtZWFzdXJlbWVudHM6IHtcclxuICAgICAgICAgIHRvdGFsOiBtZWFzdXJlbWVudHMubGVuZ3RoLFxyXG4gICAgICAgICAgbGF0ZXN0OiBtZWFzdXJlbWVudHNbMF0sXHJcbiAgICAgICAgICBoaXN0b3J5OiBtZWFzdXJlbWVudHNcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByb2dyYW1zOiB7XHJcbiAgICAgICAgICBhY3RpdmU6IHByb2dyYW1zLmZpbHRlcihwID0+IHAub3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScpLFxyXG4gICAgICAgICAgY29tcGxldGVkOiBwcm9ncmFtcy5maWx0ZXIocCA9PiBwLm92ZXJhbGxTdGF0dXMgPT09ICdDT01QTEVURUQnKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaW5kaXZpZHVhbFBsYW46IGlycCxcclxuICAgICAgICBzdW1tYXJ5OiB7XHJcbiAgICAgICAgICBvdmVyYWxsU3RhdHVzOiB0aGlzLmNhbGN1bGF0ZU92ZXJhbGxTdGF0dXMobWVhc3VyZW1lbnRzLCBwcm9ncmFtcyksXHJcbiAgICAgICAgICBzdHJlbmd0aHM6IHRoaXMuaWRlbnRpZnlTdHJlbmd0aHMobWVhc3VyZW1lbnRzKSxcclxuICAgICAgICAgIGFyZWFzRm9ySW1wcm92ZW1lbnQ6IHRoaXMuaWRlbnRpZnlBcmVhc0ZvckltcHJvdmVtZW50KG1lYXN1cmVtZW50cyksXHJcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVGaW5hbFJlY29tbWVuZGF0aW9ucyhtZWFzdXJlbWVudHMsIHByb2dyYW1zKVxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiByZXBvcnQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYNiu2LfYoyDZgdmKINil2YbYtNin2KEg2KfZhNiq2YLYsdmK2LEg2KfZhNi02KfZhdmEOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtiz2KzZitmEINis2YTYs9ipINio2LHZhtin2YXYrFxyXG4gICAqL1xyXG4gIGFzeW5jIHJlY29yZFByb2dyYW1TZXNzaW9uKGJlbmVmaWNpYXJ5SWQsIHByb2dyYW1JZCwgZGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IG5ldyBQcm9ncmFtU2Vzc2lvbih7XHJcbiAgICAgICAgYmVuZWZpY2lhcnlJZCxcclxuICAgICAgICBwcm9ncmFtSWQsXHJcbiAgICAgICAgc2Vzc2lvbk51bWJlcjogZGF0YS5zZXNzaW9uTnVtYmVyLFxyXG4gICAgICAgIHNjaGVkdWxlZERhdGU6IGRhdGEuc2NoZWR1bGVkRGF0ZSxcclxuICAgICAgICBhY3R1YWxEYXRlOiBkYXRhLmFjdHVhbERhdGUgfHwgbmV3IERhdGUoKSxcclxuICAgICAgICBzZXNzaW9uRHVyYXRpb246IGRhdGEuc2Vzc2lvbkR1cmF0aW9uLFxyXG4gICAgICAgIHNlc3Npb25UeXBlOiBkYXRhLnNlc3Npb25UeXBlLFxyXG4gICAgICAgIGZhY2lsaXRhdG9yczogZGF0YS5mYWNpbGl0YXRvcnMsXHJcbiAgICAgICAgcGFydGljaXBhbnRzOiBkYXRhLnBhcnRpY2lwYW50cyxcclxuICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXHJcbiAgICAgICAgcGVyZm9ybWFuY2U6IGRhdGEucGVyZm9ybWFuY2UsXHJcbiAgICAgICAgZWR1Y2F0aW9uOiBkYXRhLmVkdWNhdGlvbixcclxuICAgICAgICBuZXh0U3RlcHM6IGRhdGEubmV4dFN0ZXBzLFxyXG4gICAgICAgIHNlc3Npb25PdXRjb21lOiBkYXRhLnNlc3Npb25PdXRjb21lLFxyXG4gICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCdcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBzYXZlZCA9IGF3YWl0IHNlc3Npb24uc2F2ZSgpO1xyXG5cclxuICAgICAgLy8g2KrYrdiv2YrYqyDYqtmC2K/ZhSDYp9mE2KjYsdmG2KfZhdisXHJcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlUHJvZ3JhbVByb2dyZXNzKGJlbmVmaWNpYXJ5SWQsIHByb2dyYW1JZCwgZGF0YSk7XHJcblxyXG4gICAgICByZXR1cm4gc2F2ZWQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYNiu2LfYoyDZgdmKINiq2LPYrNmK2YQg2KzZhNiz2Kkg2KfZhNio2LHZhtin2YXYrDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KrYrdiv2YrYqyDYqtmC2K/ZhSDYp9mE2KjYsdmG2KfZhdisXHJcbiAgICovXHJcbiAgYXN5bmMgdXBkYXRlUHJvZ3JhbVByb2dyZXNzKGJlbmVmaWNpYXJ5SWQsIHByb2dyYW1JZCwgc2Vzc2lvbkRhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHByb2dyZXNzID0gYXdhaXQgUHJvZ3JhbVByb2dyZXNzLmZpbmRPbmUoe1xyXG4gICAgICAgIGJlbmVmaWNpYXJ5SWQsXHJcbiAgICAgICAgcHJvZ3JhbUlkXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCFwcm9ncmVzcykgcmV0dXJuO1xyXG5cclxuICAgICAgcHJvZ3Jlc3MuY29tcGxldGVkU2Vzc2lvbnMgPSAocHJvZ3Jlc3MuY29tcGxldGVkU2Vzc2lvbnMgfHwgMCkgKyAxO1xyXG5cclxuICAgICAgLy8g2KrYrdiv2YrYqyDYqtmC2K/ZhSDYp9mE2KPZh9iv2KfZgVxyXG4gICAgICBpZiAoc2Vzc2lvbkRhdGEucGVyZm9ybWFuY2U/LnRhc2tDb21wbGV0aW9uKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9ncmVzcy5vYmplY3RpdmVQcm9ncmVzcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgcHJvZ3Jlc3Mub2JqZWN0aXZlUHJvZ3Jlc3NbaV0ucHJvZ3Jlc3MgKz0gXHJcbiAgICAgICAgICAgIChzZXNzaW9uRGF0YS5wZXJmb3JtYW5jZS50YXNrQ29tcGxldGlvbiAvIHByb2dyZXNzLnRvdGFsUGxhbm5lZFNlc3Npb25zKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBhd2FpdCBwcm9ncmVzcy5zYXZlKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYNiu2LfYoyDZgdmKINiq2K3Yr9mK2Ksg2KrZgtiv2YUg2KfZhNio2LHZhtin2YXYrDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2K/ZiNin2YQg2YXYs9in2LnYr9ipXHJcbiAgICovXHJcbiAgYXN5bmMgZ2VuZXJhdGVQbGFuQ29kZSgpIHtcclxuICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgSW5kaXZpZHVhbFJlaGFiUGxhbi5jb3VudERvY3VtZW50cygpO1xyXG4gICAgY29uc3QgeWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcclxuICAgIHJldHVybiBgSVJQLSR7eWVhcn0tJHtTdHJpbmcoY291bnQgKyAxKS5wYWRTdGFydCg1LCAnMCcpfWA7XHJcbiAgfVxyXG5cclxuICBjYWxjdWxhdGVPdmVyYWxsU3RhdHVzKG1lYXN1cmVtZW50cywgcHJvZ3JhbXMpIHtcclxuICAgIGlmICghbWVhc3VyZW1lbnRzLmxlbmd0aCkgcmV0dXJuICfYrNiv2YrYryc7XHJcbiAgICByZXR1cm4gbWVhc3VyZW1lbnRzWzBdLm92ZXJhbGxMZXZlbDtcclxuICB9XHJcblxyXG4gIGlkZW50aWZ5U3RyZW5ndGhzKG1lYXN1cmVtZW50cykge1xyXG4gICAgaWYgKCFtZWFzdXJlbWVudHMubGVuZ3RoKSByZXR1cm4gW107XHJcbiAgICBcclxuICAgIGNvbnN0IGxhdGVzdCA9IG1lYXN1cmVtZW50c1swXTtcclxuICAgIHJldHVybiBsYXRlc3QuaW50ZXJwcmV0YXRpb24/LnN0cmVuZ3RocyB8fCBbXTtcclxuICB9XHJcblxyXG4gIGlkZW50aWZ5QXJlYXNGb3JJbXByb3ZlbWVudChtZWFzdXJlbWVudHMpIHtcclxuICAgIGlmICghbWVhc3VyZW1lbnRzLmxlbmd0aCkgcmV0dXJuIFtdO1xyXG4gICAgXHJcbiAgICBjb25zdCBsYXRlc3QgPSBtZWFzdXJlbWVudHNbMF07XHJcbiAgICByZXR1cm4gbGF0ZXN0LmludGVycHJldGF0aW9uPy53ZWFrbmVzc2VzIHx8IFtdO1xyXG4gIH1cclxuXHJcbiAgZ2VuZXJhdGVGaW5hbFJlY29tbWVuZGF0aW9ucyhtZWFzdXJlbWVudHMsIHByb2dyYW1zKSB7XHJcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBbXTtcclxuXHJcbiAgICBpZiAobWVhc3VyZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgn2KrZgtmK2YrZhSDYtNin2YXZhCDZhdi32YTZiNioJyk7XHJcbiAgICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGF0ZXN0ID0gbWVhc3VyZW1lbnRzWzBdO1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goLi4uKGxhdGVzdC5pbnRlcnByZXRhdGlvbj8ucmVjb21tZW5kYXRpb25zIHx8IFtdKSk7XHJcblxyXG4gICAgaWYgKHByb2dyYW1zLmZpbHRlcihwID0+IHAub3ZlcmFsbFN0YXR1cyA9PT0gJ0FDVElWRScpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgn2KrZgdi52YrZhCDYqNix2KfZhdisINiq2K/YrtmE2YrYqScpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XHJcbiAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IE1lYXN1cmVtZW50U2VydmljZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU07RUFDSkEsZUFBZTtFQUNmQyxpQkFBaUI7RUFDakJDLGlCQUFpQjtFQUNqQkMsbUJBQW1CO0VBQ25CQztBQUNGLENBQUMsR0FBR0MsT0FBTyxDQUFDLDZCQUE2QixDQUFDO0FBRTFDLE1BQU07RUFDSkMscUJBQXFCO0VBQ3JCQyxlQUFlO0VBQ2ZDO0FBQ0YsQ0FBQyxHQUFHSCxPQUFPLENBQUMsdUNBQXVDLENBQUM7QUFFcEQsTUFBTUksV0FBVyxHQUFHSixPQUFPLENBQUMsaUNBQWlDLENBQUM7QUFFOUQsTUFBTUss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