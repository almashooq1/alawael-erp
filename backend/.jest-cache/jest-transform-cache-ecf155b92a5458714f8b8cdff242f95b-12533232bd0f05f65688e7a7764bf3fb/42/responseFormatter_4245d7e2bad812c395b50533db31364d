feeadb5f6b8f415a82c12c3a613f5054
/**
 * Response Formatter Service
 * Standardized API responses with consistent formatting
 * Phase 10: Advanced Features
 */

const logger = require('../utils/logger');
class ResponseFormatter {
  constructor() {
    this.statusCodes = {
      OK: 200,
      CREATED: 201,
      ACCEPTED: 202,
      BAD_REQUEST: 400,
      UNAUTHORIZED: 401,
      FORBIDDEN: 403,
      NOT_FOUND: 404,
      CONFLICT: 409,
      INTERNAL_ERROR: 500,
      SERVICE_UNAVAILABLE: 503
    };
  }

  /**
   * Success response
   */
  success(data, message = 'Success', statusCode = 200) {
    return {
      success: true,
      statusCode,
      message,
      data,
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Error response
   */
  error(message, errorCode = null, statusCode = 400, details = null) {
    return {
      success: false,
      statusCode,
      message,
      errorCode,
      details,
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Paginated response
   */
  paginated(items, total, page = 1, limit = 20, message = 'Data retrieved') {
    const totalPages = Math.ceil(total / limit);
    return {
      success: true,
      statusCode: 200,
      message,
      data: {
        items,
        pagination: {
          total,
          page,
          limit,
          totalPages,
          hasNextPage: page < totalPages,
          hasPrevPage: page > 1
        }
      },
      timestamp: new Date().toISOString()
    };
  }

  /**
   * List response
   */
  list(items, message = 'Items retrieved') {
    return {
      success: true,
      statusCode: 200,
      message,
      data: {
        items,
        count: items.length
      },
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Created response
   */
  created(data, message = 'Resource created') {
    return {
      success: true,
      statusCode: 201,
      message,
      data,
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Updated response
   */
  updated(data, message = 'Resource updated') {
    return {
      success: true,
      statusCode: 200,
      message,
      data,
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Deleted response
   */
  deleted(message = 'Resource deleted') {
    return {
      success: true,
      statusCode: 200,
      message,
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Validation error response
   */
  validationError(errors, message = 'Validation failed') {
    return {
      success: false,
      statusCode: 400,
      message,
      errorCode: 'VALIDATION_ERROR',
      errors: Array.isArray(errors) ? errors : [errors],
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Not found response
   */
  notFound(resource = 'Resource', message = null) {
    return {
      success: false,
      statusCode: 404,
      message: message || `${resource} not found`,
      errorCode: 'NOT_FOUND',
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Unauthorized response
   */
  unauthorized(message = 'Unauthorized access') {
    return {
      success: false,
      statusCode: 401,
      message,
      errorCode: 'UNAUTHORIZED',
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Forbidden response
   */
  forbidden(message = 'Access forbidden') {
    return {
      success: false,
      statusCode: 403,
      message,
      errorCode: 'FORBIDDEN',
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Conflict response
   */
  conflict(message = 'Resource conflict') {
    return {
      success: false,
      statusCode: 409,
      message,
      errorCode: 'CONFLICT',
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Server error response
   */
  serverError(message = 'Internal server error', error = null) {
    if (error) {
      logger.error('Server error:', error);
    }
    return {
      success: false,
      statusCode: 500,
      message,
      errorCode: 'INTERNAL_ERROR',
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Service unavailable response
   */
  serviceUnavailable(message = 'Service temporarily unavailable') {
    return {
      success: false,
      statusCode: 503,
      message,
      errorCode: 'SERVICE_UNAVAILABLE',
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Batch operation response
   */
  batchOperation(results, failedCount = 0, message = 'Batch operation completed') {
    return {
      success: failedCount === 0,
      statusCode: failedCount === 0 ? 200 : 207,
      message,
      data: {
        successful: results.length - failedCount,
        failed: failedCount,
        total: results.length,
        results
      },
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Search results response
   */
  searchResults(results, query, total, message = 'Search completed') {
    return {
      success: true,
      statusCode: 200,
      message,
      data: {
        query,
        results,
        count: results.length,
        total
      },
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Analytics response
   */
  analytics(data, period = 'unknown', message = 'Analytics data retrieved') {
    return {
      success: true,
      statusCode: 200,
      message,
      data: {
        period,
        ...data
      },
      timestamp: new Date().toISOString()
    };
  }

  /**
   * Stream response headers
   */
  getStreamHeaders(filename = 'export') {
    return {
      'Content-Type': 'application/octet-stream',
      'Content-Disposition': `attachment; filename="${filename}"`,
      'Cache-Control': 'no-cache, no-store, must-revalidate'
    };
  }

  /**
   * Format error for logging
   */
  formatErrorLog(error, context = {}) {
    return {
      message: error.message,
      stack: error.stack,
      code: error.code,
      context,
      timestamp: new Date().toISOString()
    };
  }
}
module.exports = new ResponseFormatter();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiUmVzcG9uc2VGb3JtYXR0ZXIiLCJjb25zdHJ1Y3RvciIsInN0YXR1c0NvZGVzIiwiT0siLCJDUkVBVEVEIiwiQUNDRVBURUQiLCJCQURfUkVRVUVTVCIsIlVOQVVUSE9SSVpFRCIsIkZPUkJJRERFTiIsIk5PVF9GT1VORCIsIkNPTkZMSUNUIiwiSU5URVJOQUxfRVJST1IiLCJTRVJWSUNFX1VOQVZBSUxBQkxFIiwic3VjY2VzcyIsImRhdGEiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImVycm9yIiwiZXJyb3JDb2RlIiwiZGV0YWlscyIsInBhZ2luYXRlZCIsIml0ZW1zIiwidG90YWwiLCJwYWdlIiwibGltaXQiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiLCJwYWdpbmF0aW9uIiwiaGFzTmV4dFBhZ2UiLCJoYXNQcmV2UGFnZSIsImxpc3QiLCJjb3VudCIsImxlbmd0aCIsImNyZWF0ZWQiLCJ1cGRhdGVkIiwiZGVsZXRlZCIsInZhbGlkYXRpb25FcnJvciIsImVycm9ycyIsIkFycmF5IiwiaXNBcnJheSIsIm5vdEZvdW5kIiwicmVzb3VyY2UiLCJ1bmF1dGhvcml6ZWQiLCJmb3JiaWRkZW4iLCJjb25mbGljdCIsInNlcnZlckVycm9yIiwic2VydmljZVVuYXZhaWxhYmxlIiwiYmF0Y2hPcGVyYXRpb24iLCJyZXN1bHRzIiwiZmFpbGVkQ291bnQiLCJzdWNjZXNzZnVsIiwiZmFpbGVkIiwic2VhcmNoUmVzdWx0cyIsInF1ZXJ5IiwiYW5hbHl0aWNzIiwicGVyaW9kIiwiZ2V0U3RyZWFtSGVhZGVycyIsImZpbGVuYW1lIiwiZm9ybWF0RXJyb3JMb2ciLCJjb250ZXh0Iiwic3RhY2siLCJjb2RlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInJlc3BvbnNlRm9ybWF0dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUmVzcG9uc2UgRm9ybWF0dGVyIFNlcnZpY2VcbiAqIFN0YW5kYXJkaXplZCBBUEkgcmVzcG9uc2VzIHdpdGggY29uc2lzdGVudCBmb3JtYXR0aW5nXG4gKiBQaGFzZSAxMDogQWR2YW5jZWQgRmVhdHVyZXNcbiAqL1xuXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuLi91dGlscy9sb2dnZXInKTtcblxuY2xhc3MgUmVzcG9uc2VGb3JtYXR0ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnN0YXR1c0NvZGVzID0ge1xuICAgICAgT0s6IDIwMCxcbiAgICAgIENSRUFURUQ6IDIwMSxcbiAgICAgIEFDQ0VQVEVEOiAyMDIsXG4gICAgICBCQURfUkVRVUVTVDogNDAwLFxuICAgICAgVU5BVVRIT1JJWkVEOiA0MDEsXG4gICAgICBGT1JCSURERU46IDQwMyxcbiAgICAgIE5PVF9GT1VORDogNDA0LFxuICAgICAgQ09ORkxJQ1Q6IDQwOSxcbiAgICAgIElOVEVSTkFMX0VSUk9SOiA1MDAsXG4gICAgICBTRVJWSUNFX1VOQVZBSUxBQkxFOiA1MDMsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdWNjZXNzIHJlc3BvbnNlXG4gICAqL1xuICBzdWNjZXNzKGRhdGEsIG1lc3NhZ2UgPSAnU3VjY2VzcycsIHN0YXR1c0NvZGUgPSAyMDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHN0YXR1c0NvZGUsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZGF0YSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRXJyb3IgcmVzcG9uc2VcbiAgICovXG4gIGVycm9yKG1lc3NhZ2UsIGVycm9yQ29kZSA9IG51bGwsIHN0YXR1c0NvZGUgPSA0MDAsIGRldGFpbHMgPSBudWxsKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgc3RhdHVzQ29kZSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBlcnJvckNvZGUsXG4gICAgICBkZXRhaWxzLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYWdpbmF0ZWQgcmVzcG9uc2VcbiAgICovXG4gIHBhZ2luYXRlZChpdGVtcywgdG90YWwsIHBhZ2UgPSAxLCBsaW1pdCA9IDIwLCBtZXNzYWdlID0gJ0RhdGEgcmV0cmlldmVkJykge1xuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWwgLyBsaW1pdCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGl0ZW1zLFxuICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgdG90YWwsXG4gICAgICAgICAgcGFnZSxcbiAgICAgICAgICBsaW1pdCxcbiAgICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICAgIGhhc05leHRQYWdlOiBwYWdlIDwgdG90YWxQYWdlcyxcbiAgICAgICAgICBoYXNQcmV2UGFnZTogcGFnZSA+IDEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0IHJlc3BvbnNlXG4gICAqL1xuICBsaXN0KGl0ZW1zLCBtZXNzYWdlID0gJ0l0ZW1zIHJldHJpZXZlZCcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGl0ZW1zLFxuICAgICAgICBjb3VudDogaXRlbXMubGVuZ3RoLFxuICAgICAgfSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlZCByZXNwb25zZVxuICAgKi9cbiAgY3JlYXRlZChkYXRhLCBtZXNzYWdlID0gJ1Jlc291cmNlIGNyZWF0ZWQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBzdGF0dXNDb2RlOiAyMDEsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZGF0YSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlZCByZXNwb25zZVxuICAgKi9cbiAgdXBkYXRlZChkYXRhLCBtZXNzYWdlID0gJ1Jlc291cmNlIHVwZGF0ZWQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZGF0YSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlZCByZXNwb25zZVxuICAgKi9cbiAgZGVsZXRlZChtZXNzYWdlID0gJ1Jlc291cmNlIGRlbGV0ZWQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICBtZXNzYWdlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0aW9uIGVycm9yIHJlc3BvbnNlXG4gICAqL1xuICB2YWxpZGF0aW9uRXJyb3IoZXJyb3JzLCBtZXNzYWdlID0gJ1ZhbGlkYXRpb24gZmFpbGVkJykge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBlcnJvckNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgIGVycm9yczogQXJyYXkuaXNBcnJheShlcnJvcnMpID8gZXJyb3JzIDogW2Vycm9yc10sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE5vdCBmb3VuZCByZXNwb25zZVxuICAgKi9cbiAgbm90Rm91bmQocmVzb3VyY2UgPSAnUmVzb3VyY2UnLCBtZXNzYWdlID0gbnVsbCkge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UgfHwgYCR7cmVzb3VyY2V9IG5vdCBmb3VuZGAsXG4gICAgICBlcnJvckNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVbmF1dGhvcml6ZWQgcmVzcG9uc2VcbiAgICovXG4gIHVuYXV0aG9yaXplZChtZXNzYWdlID0gJ1VuYXV0aG9yaXplZCBhY2Nlc3MnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgc3RhdHVzQ29kZTogNDAxLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIGVycm9yQ29kZTogJ1VOQVVUSE9SSVpFRCcsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcmJpZGRlbiByZXNwb25zZVxuICAgKi9cbiAgZm9yYmlkZGVuKG1lc3NhZ2UgPSAnQWNjZXNzIGZvcmJpZGRlbicpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBzdGF0dXNDb2RlOiA0MDMsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZXJyb3JDb2RlOiAnRk9SQklEREVOJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ29uZmxpY3QgcmVzcG9uc2VcbiAgICovXG4gIGNvbmZsaWN0KG1lc3NhZ2UgPSAnUmVzb3VyY2UgY29uZmxpY3QnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgc3RhdHVzQ29kZTogNDA5LFxuICAgICAgbWVzc2FnZSxcbiAgICAgIGVycm9yQ29kZTogJ0NPTkZMSUNUJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogU2VydmVyIGVycm9yIHJlc3BvbnNlXG4gICAqL1xuICBzZXJ2ZXJFcnJvcihtZXNzYWdlID0gJ0ludGVybmFsIHNlcnZlciBlcnJvcicsIGVycm9yID0gbnVsbCkge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdTZXJ2ZXIgZXJyb3I6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIHN0YXR1c0NvZGU6IDUwMCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBlcnJvckNvZGU6ICdJTlRFUk5BTF9FUlJPUicsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFNlcnZpY2UgdW5hdmFpbGFibGUgcmVzcG9uc2VcbiAgICovXG4gIHNlcnZpY2VVbmF2YWlsYWJsZShtZXNzYWdlID0gJ1NlcnZpY2UgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgc3RhdHVzQ29kZTogNTAzLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIGVycm9yQ29kZTogJ1NFUlZJQ0VfVU5BVkFJTEFCTEUnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCYXRjaCBvcGVyYXRpb24gcmVzcG9uc2VcbiAgICovXG4gIGJhdGNoT3BlcmF0aW9uKHJlc3VsdHMsIGZhaWxlZENvdW50ID0gMCwgbWVzc2FnZSA9ICdCYXRjaCBvcGVyYXRpb24gY29tcGxldGVkJykge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWlsZWRDb3VudCA9PT0gMCxcbiAgICAgIHN0YXR1c0NvZGU6IGZhaWxlZENvdW50ID09PSAwID8gMjAwIDogMjA3LFxuICAgICAgbWVzc2FnZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3VjY2Vzc2Z1bDogcmVzdWx0cy5sZW5ndGggLSBmYWlsZWRDb3VudCxcbiAgICAgICAgZmFpbGVkOiBmYWlsZWRDb3VudCxcbiAgICAgICAgdG90YWw6IHJlc3VsdHMubGVuZ3RoLFxuICAgICAgICByZXN1bHRzLFxuICAgICAgfSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogU2VhcmNoIHJlc3VsdHMgcmVzcG9uc2VcbiAgICovXG4gIHNlYXJjaFJlc3VsdHMocmVzdWx0cywgcXVlcnksIHRvdGFsLCBtZXNzYWdlID0gJ1NlYXJjaCBjb21wbGV0ZWQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZGF0YToge1xuICAgICAgICBxdWVyeSxcbiAgICAgICAgcmVzdWx0cyxcbiAgICAgICAgY291bnQ6IHJlc3VsdHMubGVuZ3RoLFxuICAgICAgICB0b3RhbCxcbiAgICAgIH0sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5dGljcyByZXNwb25zZVxuICAgKi9cbiAgYW5hbHl0aWNzKGRhdGEsIHBlcmlvZCA9ICd1bmtub3duJywgbWVzc2FnZSA9ICdBbmFseXRpY3MgZGF0YSByZXRyaWV2ZWQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZGF0YToge1xuICAgICAgICBwZXJpb2QsXG4gICAgICAgIC4uLmRhdGEsXG4gICAgICB9LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdHJlYW0gcmVzcG9uc2UgaGVhZGVyc1xuICAgKi9cbiAgZ2V0U3RyZWFtSGVhZGVycyhmaWxlbmFtZSA9ICdleHBvcnQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyxcbiAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uJzogYGF0dGFjaG1lbnQ7IGZpbGVuYW1lPVwiJHtmaWxlbmFtZX1cImAsXG4gICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZSwgbm8tc3RvcmUsIG11c3QtcmV2YWxpZGF0ZScsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXQgZXJyb3IgZm9yIGxvZ2dpbmdcbiAgICovXG4gIGZvcm1hdEVycm9yTG9nKGVycm9yLCBjb250ZXh0ID0ge30pIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgIGNvZGU6IGVycm9yLmNvZGUsXG4gICAgICBjb250ZXh0LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBSZXNwb25zZUZvcm1hdHRlcigpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNB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