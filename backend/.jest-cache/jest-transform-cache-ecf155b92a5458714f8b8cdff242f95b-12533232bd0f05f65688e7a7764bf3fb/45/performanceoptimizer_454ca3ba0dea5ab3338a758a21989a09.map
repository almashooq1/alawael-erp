{"version":3,"names":["compression","require","CACHE_CONFIG","durations","maxSize","compressionOptions","level","threshold","ResponseCache","constructor","maxSizeMB","cache","Map","currentSize","hits","misses","generateKey","req","method","path","originalUrl","url","get","key","has","entry","expiresAt","Date","now","delete","size","data","set","durationSeconds","JSON","stringify","length","evict","createdAt","entriesToRemove","Math","ceil","removed","sorted","Array","from","entries","sort","a","b","i","console","log","round","clear","getStats","hitRate","toFixed","compressionMiddleware","res","next","cacheControlMiddleware","cacheDuration","pattern","duration","Object","startsWith","json","originalJson","bind","send","originalSend","responseCachingMiddleware","cacheKey","cachedResponse","performanceMonitoringMiddleware","startTime","warn","clearCache","cleared","includes","getCacheStats","initializePerformanceOptimizations","app","use","module","exports","cacheControl","responseCache","performanceMonitoring"],"sources":["performance-optimizer.js"],"sourcesContent":["/**\r\n * Performance Optimizer Utility\r\n * Implements caching, compression, and response optimization strategies\r\n * \r\n * Features:\r\n * - Gzip response compression\r\n * - Cache-Control headers optimization\r\n * - Request result caching (in-memory)\r\n * - Response size optimization\r\n * - Performance metrics tracking\r\n */\r\n\r\nconst compression = require('compression');\r\n\r\n// ==================== CONFIGURATION ====================\r\nconst CACHE_CONFIG = {\r\n  // Cache duration by route pattern (in seconds)\r\n  durations: {\r\n    '/health': 5,\r\n    '/api/health': 10,\r\n    '/api/analytics': 30,\r\n    '/api/reports': 60,\r\n    '/api/dashboard': 30,\r\n    '/api/notifications': 0, // No cache - real-time data\r\n    '/api/users': 0, // No cache - user-specific data\r\n  },\r\n  \r\n  // Maximum cache size in MB\r\n  maxSize: 50,\r\n  \r\n  // Enable/disable compression\r\n  compression: true,\r\n  \r\n  // Compression options\r\n  compressionOptions: {\r\n    level: 6, // 0-9, default 6\r\n    threshold: 1024, // Only compress responses > 1KB\r\n  },\r\n};\r\n\r\n// ==================== IN-MEMORY CACHE ====================\r\nclass ResponseCache {\r\n  constructor(maxSizeMB = 50) {\r\n    this.cache = new Map();\r\n    this.maxSize = maxSizeMB * 1024 * 1024;\r\n    this.currentSize = 0;\r\n    this.hits = 0;\r\n    this.misses = 0;\r\n  }\r\n\r\n  /**\r\n   * Generate cache key from request\r\n   */\r\n  generateKey(req) {\r\n    const method = req.method || 'GET';\r\n    const path = req.originalUrl || req.url;\r\n    return `${method}:${path}`;\r\n  }\r\n\r\n  /**\r\n   * Get cached response\r\n   */\r\n  get(key) {\r\n    if (!this.cache.has(key)) {\r\n      this.misses++;\r\n      return null;\r\n    }\r\n\r\n    const entry = this.cache.get(key);\r\n    \r\n    // Check if expired\r\n    if (entry.expiresAt && Date.now() > entry.expiresAt) {\r\n      this.cache.delete(key);\r\n      this.currentSize -= entry.size;\r\n      this.misses++;\r\n      return null;\r\n    }\r\n\r\n    this.hits++;\r\n    return entry.data;\r\n  }\r\n\r\n  /**\r\n   * Set cached response\r\n   */\r\n  set(key, data, durationSeconds = 60) {\r\n    // Calculate size of data\r\n    const size = JSON.stringify(data).length;\r\n\r\n    // Evict old entries if needed\r\n    if (this.currentSize + size > this.maxSize) {\r\n      this.evict();\r\n    }\r\n\r\n    const entry = {\r\n      data: data,\r\n      size: size,\r\n      createdAt: Date.now(),\r\n      expiresAt: durationSeconds > 0 ? Date.now() + (durationSeconds * 1000) : null,\r\n    };\r\n\r\n    this.cache.set(key, entry);\r\n    this.currentSize += size;\r\n  }\r\n\r\n  /**\r\n   * Evict old entries using LRU (Least Recently Used)\r\n   */\r\n  evict() {\r\n    const entriesToRemove = Math.ceil(this.cache.size * 0.2); // Remove 20% of old entries\r\n    let removed = 0;\r\n\r\n    // Sort by creation time (oldest first)\r\n    const sorted = Array.from(this.cache.entries())\r\n      .sort((a, b) => a[1].createdAt - b[1].createdAt);\r\n\r\n    for (let i = 0; i < entriesToRemove && i < sorted.length; i++) {\r\n      const [key, entry] = sorted[i];\r\n      this.cache.delete(key);\r\n      this.currentSize -= entry.size;\r\n      removed++;\r\n    }\r\n\r\n    console.log(`ðŸ“¦ Cache evicted ${removed} old entries (freed ${Math.round(removed * 1024 / 1024)}MB)`);\r\n  }\r\n\r\n  /**\r\n   * Clear entire cache\r\n   */\r\n  clear() {\r\n    this.cache.clear();\r\n    this.currentSize = 0;\r\n  }\r\n\r\n  /**\r\n   * Get cache statistics\r\n   */\r\n  getStats() {\r\n    const hitRate = (this.hits / (this.hits + this.misses)) * 100 || 0;\r\n    \r\n    return {\r\n      entries: this.cache.size,\r\n      size: `${(this.currentSize / 1024 / 1024).toFixed(2)} MB`,\r\n      maxSize: `${CACHE_CONFIG.maxSize} MB`,\r\n      hits: this.hits,\r\n      misses: this.misses,\r\n      hitRate: `${hitRate.toFixed(2)}%`,\r\n    };\r\n  }\r\n}\r\n\r\n// ==================== CACHE INSTANCE ====================\r\nconst cache = new ResponseCache(CACHE_CONFIG.maxSize);\r\n\r\n// ==================== MIDDLEWARE ====================\r\n\r\n/**\r\n * Add compression middleware\r\n */\r\nconst compressionMiddleware = () => {\r\n  if (!CACHE_CONFIG.compression) {\r\n    return (req, res, next) => next();\r\n  }\r\n\r\n  return compression(CACHE_CONFIG.compressionOptions);\r\n};\r\n\r\n/**\r\n * Cache control headers middleware\r\n */\r\nconst cacheControlMiddleware = (req, res, next) => {\r\n  // Determine cache duration based on route\r\n  let cacheDuration = 0;\r\n  for (const [pattern, duration] of Object.entries(CACHE_CONFIG.durations)) {\r\n    if (req.path.startsWith(pattern)) {\r\n      cacheDuration = duration;\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Set cache headers\r\n  if (cacheDuration > 0) {\r\n    res.set('Cache-Control', `public, max-age=${cacheDuration}`);\r\n    res.set('X-Cache-Duration', `${cacheDuration}s`);\r\n  } else {\r\n    res.set('Cache-Control', 'no-cache, no-store, must-revalidate');\r\n    res.set('Pragma', 'no-cache');\r\n    res.set('Expires', '0');\r\n  }\r\n\r\n  // Wrap res.json if it exists\r\n  if (res.json) {\r\n    const originalJson = res.json.bind(res);\r\n    res.json = function(data) {\r\n      const size = JSON.stringify(data).length;\r\n      res.set('X-Response-Size', `${size}B`);\r\n      res.set('X-Cache-Duration', `${cacheDuration}s`);\r\n      return originalJson(data);\r\n    };\r\n  }\r\n\r\n  // Wrap res.send if it exists\r\n  if (res.send) {\r\n    const originalSend = res.send.bind(res);\r\n    res.send = function(data) {\r\n      if (typeof data === 'object') {\r\n        const size = JSON.stringify(data).length;\r\n        res.set('X-Response-Size', `${size}B`);\r\n      }\r\n      return originalSend(data);\r\n    };\r\n  }\r\n\r\n  next();\r\n};\r\n\r\n/**\r\n * Request response caching middleware\r\n */\r\nconst responseCachingMiddleware = (req, res, next) => {\r\n  // Only cache GET requests\r\n  if (req.method !== 'GET') {\r\n    return next();\r\n  }\r\n\r\n  const cacheKey = cache.generateKey(req);\r\n  \r\n  // Check if response is cached\r\n  const cachedResponse = cache.get(cacheKey);\r\n  if (cachedResponse) {\r\n    res.set('X-Cache', 'HIT');\r\n    return res.json(cachedResponse);\r\n  }\r\n\r\n  // Intercept res.json to cache response\r\n  const originalJson = res.json.bind(res);\r\n  \r\n  res.json = function(data) {\r\n    // Determine cache duration\r\n    let cacheDuration = 0;\r\n    for (const [pattern, duration] of Object.entries(CACHE_CONFIG.durations)) {\r\n      if (req.path.startsWith(pattern)) {\r\n        cacheDuration = duration;\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Cache the response\r\n    if (cacheDuration > 0 && data) {\r\n      cache.set(cacheKey, data, cacheDuration);\r\n      res.set('X-Cache', 'MISS');\r\n      res.set('X-Cache-Duration', `${cacheDuration}s`);\r\n    }\r\n\r\n    return originalJson(data);\r\n  };\r\n\r\n  next();\r\n};\r\n\r\n/**\r\n * Monitoring middleware - tracks response performance\r\n */\r\nconst performanceMonitoringMiddleware = (req, res, next) => {\r\n  const startTime = Date.now();\r\n  const originalJson = res.json.bind(res);\r\n\r\n  res.json = function(data) {\r\n    const duration = Date.now() - startTime;\r\n    \r\n    // Add performance headers\r\n    res.set('X-Response-Time', `${duration}ms`);\r\n    \r\n    // Log slow requests\r\n    if (duration > 1000) {\r\n      console.warn(`âš ï¸  Slow request: ${req.method} ${req.path} took ${duration}ms`);\r\n    }\r\n\r\n    return originalJson(data);\r\n  };\r\n\r\n  next();\r\n};\r\n\r\n// ==================== CACHE MANAGEMENT ===================\r\n\r\n/**\r\n * Clear cache for specific route or all routes\r\n */\r\nconst clearCache = (path = null) => {\r\n  if (!path) {\r\n    cache.clear();\r\n    console.log('ðŸ§¹ Cache cleared completely');\r\n    return;\r\n  }\r\n\r\n  // Clear cache entries matching path\r\n  let cleared = 0;\r\n  for (const [key, entry] of cache.cache.entries()) {\r\n    if (key.includes(path)) {\r\n      cache.cache.delete(key);\r\n      cache.currentSize -= entry.size;\r\n      cleared++;\r\n    }\r\n  }\r\n\r\n  console.log(`ðŸ§¹ Cleared ${cleared} cache entries for path: ${path}`);\r\n};\r\n\r\n/**\r\n * Get cache statistics\r\n */\r\nconst getCacheStats = () => cache.getStats();\r\n\r\n// ==================== OPTIMIZATION SETUP ====================\r\n\r\n/**\r\n * Initialize all performance optimizations\r\n */\r\nfunction initializePerformanceOptimizations(app) {\r\n  // Add compression\r\n  app.use(compressionMiddleware());\r\n\r\n  // Add cache control headers\r\n  app.use(cacheControlMiddleware);\r\n\r\n  // Add response caching\r\n  app.use(responseCachingMiddleware);\r\n\r\n  // Add performance monitoring\r\n  app.use(performanceMonitoringMiddleware);\r\n\r\n  console.log('âœ… Performance optimizations initialized');\r\n  console.log('   - Compression: Enabled');\r\n  console.log('   - Response caching: Enabled');\r\n  console.log('   - Cache-Control headers: Enabled');\r\n  console.log('   - Performance monitoring: Enabled');\r\n  console.log('   - Management endpoints: Register manually in app.js (/api/cache-stats, /api/cache/clear)');\r\n}\r\n\r\n// ==================== EXPORTS ====================\r\n\r\nmodule.exports = {\r\n  compression: compressionMiddleware,\r\n  cacheControl: cacheControlMiddleware,\r\n  responseCache: responseCachingMiddleware,\r\n  performanceMonitoring: performanceMonitoringMiddleware,\r\n  initializePerformanceOptimizations,\r\n  clearCache,\r\n  getCacheStats,\r\n  ResponseCache,\r\n  CACHE_CONFIG,\r\n};\r\n"],"mappings":"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","ignoreList":[]}