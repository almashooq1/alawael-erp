32fbe98adaa8995d45ae9653b7a23937
// RBAC (Role-Based Access Control) Routes
// نقاط التحكم بالوصول بناءً على الأدوار

const express = require('express');
const router = express.Router();
const RBACService = require('../services/rbacService');
const {
  ApiResponse,
  ApiError
} = require('../utils/apiResponse');

// الحصول على جميع الأدوار
router.get('/roles', (req, res, next) => {
  try {
    const result = RBACService.getAllRoles();
    return res.status(200).json(new ApiResponse(200, result, 'Roles fetched'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to fetch roles', [error.message]));
  }
});

// الحصول على تفاصيل الدور
router.get('/roles/:roleId', (req, res, next) => {
  try {
    const {
      roleId
    } = req.params;
    const result = RBACService.getRoleDetails(roleId);
    if (!result.success) {
      return res.status(404).json(new ApiResponse(404, {}, 'Role not found'));
    }
    return res.status(200).json(new ApiResponse(200, result, 'Role details fetched'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to fetch role details', [error.message]));
  }
});

// إنشاء دور جديد
router.post('/roles', (req, res, next) => {
  try {
    const {
      id,
      name,
      description,
      permissions
    } = req.body;
    if (!name) {
      return res.status(400).json(new ApiResponse(400, {}, 'Role name required'));
    }
    const result = RBACService.createRole({
      id,
      name,
      description,
      permissions
    });
    return res.status(201).json(new ApiResponse(201, result, 'Role created'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to create role', [error.message]));
  }
});

// تحديث الدور
router.put('/roles/:roleId', (req, res, next) => {
  try {
    const {
      roleId
    } = req.params;
    const updates = req.body;
    const result = RBACService.updateRole(roleId, updates);
    if (!result.success) {
      return res.status(404).json(new ApiResponse(404, {}, 'Role not found'));
    }
    return res.status(200).json(new ApiResponse(200, result, 'Role updated'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to update role', [error.message]));
  }
});

// حذف الدور
router.delete('/roles/:roleId', (req, res, next) => {
  try {
    const {
      roleId
    } = req.params;
    const result = RBACService.deleteRole(roleId);
    if (!result.success) {
      return next(new ApiError(400, result.message || 'Failed to delete role', [result.error]));
    }
    return res.status(200).json(new ApiResponse(200, result, 'Role deleted'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to delete role', [error.message]));
  }
});

// الحصول على الصلاحيات المتاحة
router.get('/permissions', (req, res, next) => {
  try {
    const result = RBACService.getAvailablePermissions();
    return res.status(200).json(new ApiResponse(200, result, 'Permissions fetched'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to fetch permissions', [error.message]));
  }
});

// التحقق من الصلاحية
router.post('/check-permission', (req, res, next) => {
  try {
    const {
      userRole,
      requiredPermission
    } = req.body;
    if (!userRole || !requiredPermission) {
      return next(new ApiError(400, 'User role and required permission are required'));
    }
    const hasPermission = RBACService.hasPermission(userRole, requiredPermission);
    const response = {
      userRole,
      requiredPermission,
      hasPermission,
      timestamp: new Date().toISOString()
    };
    return res.status(200).json(new ApiResponse(200, response, 'Permission check completed'));
  } catch (error) {
    return next(new ApiError(500, 'Permission check failed', [error.message]));
  }
});

// إضافة صلاحية للدور
router.post('/roles/:roleId/permissions', (req, res, next) => {
  try {
    const {
      roleId
    } = req.params;
    const {
      permission
    } = req.body;
    if (!permission) {
      return next(new ApiError(400, 'Permission required'));
    }
    const result = RBACService.addPermissionToRole(roleId, permission);
    if (!result.success) {
      return next(new ApiError(404, result.message || 'Role not found', [result.error]));
    }
    return res.status(200).json(new ApiResponse(200, result, 'Permission added'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to add permission', [error.message]));
  }
});

// إزالة صلاحية من الدور
router.delete('/roles/:roleId/permissions/:permission', (req, res, next) => {
  try {
    const {
      roleId,
      permission
    } = req.params;
    const result = RBACService.removePermissionFromRole(roleId, permission);
    if (!result.success) {
      return next(new ApiError(404, result.message || 'Role not found', [result.error]));
    }
    return res.status(200).json(new ApiResponse(200, result, 'Permission removed'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to remove permission', [error.message]));
  }
});

// فحص وصول المستخدم
router.post('/check-access', (req, res, next) => {
  try {
    const {
      userId,
      resource,
      action
    } = req.body;
    if (!userId || !resource || !action) {
      return next(new ApiError(400, 'User ID, resource, and action are required'));
    }
    const result = RBACService.checkAccess(userId, resource, action);
    return res.status(200).json(new ApiResponse(200, result, 'Access check completed'));
  } catch (error) {
    return next(new ApiError(500, 'Access check failed', [error.message]));
  }
});

// إحصائيات RBAC
router.get('/stats/overview', (req, res, next) => {
  try {
    const result = RBACService.getRBACStatistics();
    return res.status(200).json(new ApiResponse(200, result, 'RBAC statistics fetched'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to fetch RBAC statistics', [error.message]));
  }
});

// تدقيق الوصول
router.get('/audit/log', (req, res, next) => {
  try {
    const {
      userId,
      action,
      result: filterResult
    } = req.query;
    const filters = {};
    if (userId) filters.userId = userId;
    if (action) filters.action = action;
    if (filterResult) filters.result = filterResult;
    const result = RBACService.auditAccess(filters);
    return res.status(200).json(new ApiResponse(200, result, 'Audit log fetched'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to fetch audit log', [error.message]));
  }
});

// تصدير تكوين RBAC
router.get('/export/config', (req, res, next) => {
  try {
    const result = RBACService.exportRBACConfig();
    return res.status(200).json(new ApiResponse(200, result, 'RBAC configuration exported'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to export RBAC configuration', [error.message]));
  }
});

// استيراد تكوين RBAC
router.post('/import/config', (req, res, next) => {
  try {
    const {
      file
    } = req.body;
    if (!file) {
      return next(new ApiError(400, 'File required'));
    }
    const result = RBACService.importRBACConfig(file);
    return res.status(200).json(new ApiResponse(200, result, 'RBAC configuration imported'));
  } catch (error) {
    return next(new ApiError(500, 'Failed to import RBAC configuration', [error.message]));
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlJCQUNTZXJ2aWNlIiwiQXBpUmVzcG9uc2UiLCJBcGlFcnJvciIsImdldCIsInJlcSIsInJlcyIsIm5leHQiLCJyZXN1bHQiLCJnZXRBbGxSb2xlcyIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsIm1lc3NhZ2UiLCJyb2xlSWQiLCJwYXJhbXMiLCJnZXRSb2xlRGV0YWlscyIsInN1Y2Nlc3MiLCJwb3N0IiwiaWQiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwZXJtaXNzaW9ucyIsImJvZHkiLCJjcmVhdGVSb2xlIiwicHV0IiwidXBkYXRlcyIsInVwZGF0ZVJvbGUiLCJkZWxldGUiLCJkZWxldGVSb2xlIiwiZ2V0QXZhaWxhYmxlUGVybWlzc2lvbnMiLCJ1c2VyUm9sZSIsInJlcXVpcmVkUGVybWlzc2lvbiIsImhhc1Blcm1pc3Npb24iLCJyZXNwb25zZSIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInBlcm1pc3Npb24iLCJhZGRQZXJtaXNzaW9uVG9Sb2xlIiwicmVtb3ZlUGVybWlzc2lvbkZyb21Sb2xlIiwidXNlcklkIiwicmVzb3VyY2UiLCJhY3Rpb24iLCJjaGVja0FjY2VzcyIsImdldFJCQUNTdGF0aXN0aWNzIiwiZmlsdGVyUmVzdWx0IiwicXVlcnkiLCJmaWx0ZXJzIiwiYXVkaXRBY2Nlc3MiLCJleHBvcnRSQkFDQ29uZmlnIiwiZmlsZSIsImltcG9ydFJCQUNDb25maWciLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmJhYy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBSQkFDIChSb2xlLUJhc2VkIEFjY2VzcyBDb250cm9sKSBSb3V0ZXNcclxuLy8g2YbZgtin2Lcg2KfZhNiq2K3Zg9mFINio2KfZhNmI2LXZiNmEINio2YbYp9ih2Ysg2LnZhNmJINin2YTYo9iv2YjYp9ixXHJcblxyXG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCBSQkFDU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3JiYWNTZXJ2aWNlJyk7XHJcbmNvbnN0IHsgQXBpUmVzcG9uc2UsIEFwaUVycm9yIH0gPSByZXF1aXJlKCcuLi91dGlscy9hcGlSZXNwb25zZScpO1xyXG5cclxuLy8g2KfZhNit2LXZiNmEINi52YTZiSDYrNmF2YrYuSDYp9mE2KPYr9mI2KfYsVxyXG5yb3V0ZXIuZ2V0KCcvcm9sZXMnLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gUkJBQ1NlcnZpY2UuZ2V0QWxsUm9sZXMoKTtcclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUm9sZXMgZmV0Y2hlZCcpKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIG5leHQobmV3IEFwaUVycm9yKDUwMCwgJ0ZhaWxlZCB0byBmZXRjaCByb2xlcycsIFtlcnJvci5tZXNzYWdlXSkpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyDYp9mE2K3YtdmI2YQg2LnZhNmJINiq2YHYp9i12YrZhCDYp9mE2K/ZiNixXHJcbnJvdXRlci5nZXQoJy9yb2xlcy86cm9sZUlkJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcm9sZUlkIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IFJCQUNTZXJ2aWNlLmdldFJvbGVEZXRhaWxzKHJvbGVJZCk7XHJcblxyXG4gICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24obmV3IEFwaVJlc3BvbnNlKDQwNCwge30sICdSb2xlIG5vdCBmb3VuZCcpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUm9sZSBkZXRhaWxzIGZldGNoZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig1MDAsICdGYWlsZWQgdG8gZmV0Y2ggcm9sZSBkZXRhaWxzJywgW2Vycm9yLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vINil2YbYtNin2KEg2K/ZiNixINis2K/ZitivXHJcbnJvdXRlci5wb3N0KCcvcm9sZXMnLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCwgbmFtZSwgZGVzY3JpcHRpb24sIHBlcm1pc3Npb25zIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBpZiAoIW5hbWUpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKG5ldyBBcGlSZXNwb25zZSg0MDAsIHt9LCAnUm9sZSBuYW1lIHJlcXVpcmVkJykpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IFJCQUNTZXJ2aWNlLmNyZWF0ZVJvbGUoe1xyXG4gICAgICBpZCxcclxuICAgICAgbmFtZSxcclxuICAgICAgZGVzY3JpcHRpb24sXHJcbiAgICAgIHBlcm1pc3Npb25zLFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKG5ldyBBcGlSZXNwb25zZSgyMDEsIHJlc3VsdCwgJ1JvbGUgY3JlYXRlZCcpKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIG5leHQobmV3IEFwaUVycm9yKDUwMCwgJ0ZhaWxlZCB0byBjcmVhdGUgcm9sZScsIFtlcnJvci5tZXNzYWdlXSkpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyDYqtit2K/ZitirINin2YTYr9mI2LFcclxucm91dGVyLnB1dCgnL3JvbGVzLzpyb2xlSWQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyByb2xlSWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBjb25zdCB1cGRhdGVzID0gcmVxLmJvZHk7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gUkJBQ1NlcnZpY2UudXBkYXRlUm9sZShyb2xlSWQsIHVwZGF0ZXMpO1xyXG5cclxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKG5ldyBBcGlSZXNwb25zZSg0MDQsIHt9LCAnUm9sZSBub3QgZm91bmQnKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKG5ldyBBcGlSZXNwb25zZSgyMDAsIHJlc3VsdCwgJ1JvbGUgdXBkYXRlZCcpKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIG5leHQobmV3IEFwaUVycm9yKDUwMCwgJ0ZhaWxlZCB0byB1cGRhdGUgcm9sZScsIFtlcnJvci5tZXNzYWdlXSkpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyDYrdiw2YEg2KfZhNiv2YjYsVxyXG5yb3V0ZXIuZGVsZXRlKCcvcm9sZXMvOnJvbGVJZCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHJvbGVJZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBSQkFDU2VydmljZS5kZWxldGVSb2xlKHJvbGVJZCk7XHJcblxyXG4gICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNDAwLCByZXN1bHQubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGRlbGV0ZSByb2xlJywgW3Jlc3VsdC5lcnJvcl0pKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUm9sZSBkZWxldGVkJykpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNTAwLCAnRmFpbGVkIHRvIGRlbGV0ZSByb2xlJywgW2Vycm9yLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vINin2YTYrdi12YjZhCDYudmE2Ykg2KfZhNi12YTYp9it2YrYp9iqINin2YTZhdiq2KfYrdipXHJcbnJvdXRlci5nZXQoJy9wZXJtaXNzaW9ucycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBSQkFDU2VydmljZS5nZXRBdmFpbGFibGVQZXJtaXNzaW9ucygpO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihuZXcgQXBpUmVzcG9uc2UoMjAwLCByZXN1bHQsICdQZXJtaXNzaW9ucyBmZXRjaGVkJykpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNTAwLCAnRmFpbGVkIHRvIGZldGNoIHBlcm1pc3Npb25zJywgW2Vycm9yLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vINin2YTYqtit2YLZgiDZhdmGINin2YTYtdmE2KfYrdmK2Klcclxucm91dGVyLnBvc3QoJy9jaGVjay1wZXJtaXNzaW9uJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlclJvbGUsIHJlcXVpcmVkUGVybWlzc2lvbiB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgaWYgKCF1c2VyUm9sZSB8fCAhcmVxdWlyZWRQZXJtaXNzaW9uKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig0MDAsICdVc2VyIHJvbGUgYW5kIHJlcXVpcmVkIHBlcm1pc3Npb24gYXJlIHJlcXVpcmVkJykpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGhhc1Blcm1pc3Npb24gPSBSQkFDU2VydmljZS5oYXNQZXJtaXNzaW9uKHVzZXJSb2xlLCByZXF1aXJlZFBlcm1pc3Npb24pO1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgICB1c2VyUm9sZSxcclxuICAgICAgcmVxdWlyZWRQZXJtaXNzaW9uLFxyXG4gICAgICBoYXNQZXJtaXNzaW9uLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKG5ldyBBcGlSZXNwb25zZSgyMDAsIHJlc3BvbnNlLCAnUGVybWlzc2lvbiBjaGVjayBjb21wbGV0ZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig1MDAsICdQZXJtaXNzaW9uIGNoZWNrIGZhaWxlZCcsIFtlcnJvci5tZXNzYWdlXSkpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyDYpdi22KfZgdipINi12YTYp9it2YrYqSDZhNmE2K/ZiNixXHJcbnJvdXRlci5wb3N0KCcvcm9sZXMvOnJvbGVJZC9wZXJtaXNzaW9ucycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHJvbGVJZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIGNvbnN0IHsgcGVybWlzc2lvbiB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgaWYgKCFwZXJtaXNzaW9uKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig0MDAsICdQZXJtaXNzaW9uIHJlcXVpcmVkJykpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IFJCQUNTZXJ2aWNlLmFkZFBlcm1pc3Npb25Ub1JvbGUocm9sZUlkLCBwZXJtaXNzaW9uKTtcclxuXHJcbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig0MDQsIHJlc3VsdC5tZXNzYWdlIHx8ICdSb2xlIG5vdCBmb3VuZCcsIFtyZXN1bHQuZXJyb3JdKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKG5ldyBBcGlSZXNwb25zZSgyMDAsIHJlc3VsdCwgJ1Blcm1pc3Npb24gYWRkZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig1MDAsICdGYWlsZWQgdG8gYWRkIHBlcm1pc3Npb24nLCBbZXJyb3IubWVzc2FnZV0pKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8g2KXYstin2YTYqSDYtdmE2KfYrdmK2Kkg2YXZhiDYp9mE2K/ZiNixXHJcbnJvdXRlci5kZWxldGUoJy9yb2xlcy86cm9sZUlkL3Blcm1pc3Npb25zLzpwZXJtaXNzaW9uJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcm9sZUlkLCBwZXJtaXNzaW9uIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IFJCQUNTZXJ2aWNlLnJlbW92ZVBlcm1pc3Npb25Gcm9tUm9sZShyb2xlSWQsIHBlcm1pc3Npb24pO1xyXG5cclxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgcmV0dXJuIG5leHQobmV3IEFwaUVycm9yKDQwNCwgcmVzdWx0Lm1lc3NhZ2UgfHwgJ1JvbGUgbm90IGZvdW5kJywgW3Jlc3VsdC5lcnJvcl0pKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUGVybWlzc2lvbiByZW1vdmVkJykpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNTAwLCAnRmFpbGVkIHRvIHJlbW92ZSBwZXJtaXNzaW9uJywgW2Vycm9yLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vINmB2K3YtSDZiNi12YjZhCDYp9mE2YXYs9iq2K7Yr9mFXHJcbnJvdXRlci5wb3N0KCcvY2hlY2stYWNjZXNzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlcklkLCByZXNvdXJjZSwgYWN0aW9uIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBpZiAoIXVzZXJJZCB8fCAhcmVzb3VyY2UgfHwgIWFjdGlvbikge1xyXG4gICAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNDAwLCAnVXNlciBJRCwgcmVzb3VyY2UsIGFuZCBhY3Rpb24gYXJlIHJlcXVpcmVkJykpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IFJCQUNTZXJ2aWNlLmNoZWNrQWNjZXNzKHVzZXJJZCwgcmVzb3VyY2UsIGFjdGlvbik7XHJcblxyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKG5ldyBBcGlSZXNwb25zZSgyMDAsIHJlc3VsdCwgJ0FjY2VzcyBjaGVjayBjb21wbGV0ZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig1MDAsICdBY2Nlc3MgY2hlY2sgZmFpbGVkJywgW2Vycm9yLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vINil2K3Ytdin2KbZitin2KogUkJBQ1xyXG5yb3V0ZXIuZ2V0KCcvc3RhdHMvb3ZlcnZpZXcnLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gUkJBQ1NlcnZpY2UuZ2V0UkJBQ1N0YXRpc3RpY3MoKTtcclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUkJBQyBzdGF0aXN0aWNzIGZldGNoZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig1MDAsICdGYWlsZWQgdG8gZmV0Y2ggUkJBQyBzdGF0aXN0aWNzJywgW2Vycm9yLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vINiq2K/ZgtmK2YIg2KfZhNmI2LXZiNmEXHJcbnJvdXRlci5nZXQoJy9hdWRpdC9sb2cnLCAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB1c2VySWQsIGFjdGlvbiwgcmVzdWx0OiBmaWx0ZXJSZXN1bHQgfSA9IHJlcS5xdWVyeTtcclxuICAgIGNvbnN0IGZpbHRlcnMgPSB7fTtcclxuICAgIGlmICh1c2VySWQpIGZpbHRlcnMudXNlcklkID0gdXNlcklkO1xyXG4gICAgaWYgKGFjdGlvbikgZmlsdGVycy5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICBpZiAoZmlsdGVyUmVzdWx0KSBmaWx0ZXJzLnJlc3VsdCA9IGZpbHRlclJlc3VsdDtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBSQkFDU2VydmljZS5hdWRpdEFjY2VzcyhmaWx0ZXJzKTtcclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnQXVkaXQgbG9nIGZldGNoZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig1MDAsICdGYWlsZWQgdG8gZmV0Y2ggYXVkaXQgbG9nJywgW2Vycm9yLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vINiq2LXYr9mK2LEg2KrZg9mI2YrZhiBSQkFDXHJcbnJvdXRlci5nZXQoJy9leHBvcnQvY29uZmlnJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IFJCQUNTZXJ2aWNlLmV4cG9ydFJCQUNDb25maWcoKTtcclxuXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUkJBQyBjb25maWd1cmF0aW9uIGV4cG9ydGVkJykpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNTAwLCAnRmFpbGVkIHRvIGV4cG9ydCBSQkFDIGNvbmZpZ3VyYXRpb24nLCBbZXJyb3IubWVzc2FnZV0pKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8g2KfYs9iq2YrYsdin2K8g2KrZg9mI2YrZhiBSQkFDXHJcbnJvdXRlci5wb3N0KCcvaW1wb3J0L2NvbmZpZycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGZpbGUgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGlmICghZmlsZSkge1xyXG4gICAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNDAwLCAnRmlsZSByZXF1aXJlZCcpKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBSQkFDU2VydmljZS5pbXBvcnRSQkFDQ29uZmlnKGZpbGUpO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihuZXcgQXBpUmVzcG9uc2UoMjAwLCByZXN1bHQsICdSQkFDIGNvbmZpZ3VyYXRpb24gaW1wb3J0ZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig1MDAsICdGYWlsZWQgdG8gaW1wb3J0IFJCQUMgY29uZmlndXJhdGlvbicsIFtlcnJvci5tZXNzYWdlXSkpO1xyXG4gIH1cclxufSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBOztBQUVBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsV0FBVyxHQUFHSCxPQUFPLENBQUMseUJBQXlCLENBQUM7QUFDdEQsTUFBTTtFQUFFSSxXQUFXO0VBQUVDO0FBQVMsQ0FB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QyxPQUFPSSxLQUFLLEVBQUU7SUFDZCxPQUFPTCxJQUFJLENBQUMsSUFBSUosUUFBUSxDQUFDLEdBQUcsRUFBRSwyQkFBMkIsRUFBRSxDQUFDUyxLQUFLLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUM7RUFDOUU7QUFDRixDQUFDLENBQUM7O0FBRUY7QUFDQWQsTUFBTSxDQUFDSyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUMvQyxJQUFJO0lBQ0YsTUFBTUMsTUFBTSxHQUFHUCxXQUFXLENBQUNpRCxnQkFBZ0IsQ0FBQyxDQUFDO0lBRTdDLE9BQU81QyxHQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLElBQUlULFdBQVcsQ0FBQyxHQUFHLEVBQUVNLE1BQU0sRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO0VBQzFGLENBQUMsQ0FBQyxPQUFPSSxLQUFLLEVBQUU7SUFDZCxPQUFPTCxJQUFJLENBQUMsSUFBSUosUUFBUSxDQUFDLEdBQUcsRUFBRSxxQ0FBcUMsRUFBRSxDQUFDUyxLQUFLLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUM7RUFDeEY7QUFDRixDQUFDLENBQUM7O0FBRUY7QUFDQWQsTUFBTSxDQUFDbUIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUNiLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDaEQsSUFBSTtJQUNGLE1BQU07TUFBRTRDO0lBQUssQ0FBQyxHQUFHOUMsR0FBRyxDQUFDa0IsSUFBSTtJQUV6QixJQUFJLENBQUM0QixJQUFJLEVBQUU7TUFDVCxPQUFPNUMsSUFBSSxDQUFDLElBQUlKLFFBQVEsQ0FBQyxHQUFHLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFDakQ7SUFFQSxNQUFNSyxNQUFNLEdBQUdQLFdBQVcsQ0FBQ21ELGdCQUFnQixDQUFDRCxJQUFJLENBQUM7SUFFakQsT0FBTzdDLEdBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsSUFBSVQsV0FBVyxDQUFDLEdBQUcsRUFBRU0sTUFBTSxFQUFFLDZCQUE2QixDQUFDLENBQUM7RUFDMUYsQ0FBQyxDQUFDLE9BQU9JLEtBQUssRUFBRTtJQUNkLE9BQU9MLElBQUksQ0FBQyxJQUFJSixRQUFRLENBQUMsR0FBRyxFQUFFLHFDQUFxQyxFQUFFLENBQUNTLEtBQUssQ0FBQ0MsT0FBTyxDQUFDLENBQUMsQ0FBQztFQUN4RjtBQUNGLENBQUMsQ0FBQztBQUVGd0MsTUFBTSxDQUFDQyxPQUFPLEdBQUd2RCxNQUFNIiwiaWdub3JlTGlzdCI6W119