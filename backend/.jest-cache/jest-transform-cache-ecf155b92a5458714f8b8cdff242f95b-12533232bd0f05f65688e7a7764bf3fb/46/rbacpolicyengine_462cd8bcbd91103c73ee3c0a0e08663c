599167b631c858000d60352f9a358f2c
/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ðŸŽ¯ RBAC Policy Engine - Ù…Ø­Ø±Ùƒ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * ÙŠÙˆÙØ± Ù†Ø¸Ø§Ù… Ù‚ÙˆØ§Ø¹Ø¯ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹:
 * âœ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
 * âœ… Ø¯Ø¹Ù… Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
 * âœ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª
 * âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª
 */

const {
  EventEmitter
} = require('events');
class RBACPolicyEngine extends EventEmitter {
  constructor(rbacSystem) {
    super();
    this.rbac = rbacSystem;
    this.policies = new Map();
    this.policyHistory = [];
    this.policyTemplates = new Map();
    this.conditionalRules = new Map();
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 1ï¸âƒ£ POLICY MANAGEMENT - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
   */
  createPolicy(policyId, policyConfig = {}) {
    if (this.policies.has(policyId)) {
      throw new Error(`Policy ${policyId} already exists`);
    }
    const policy = {
      id: policyId,
      name: policyConfig.name || policyId,
      description: policyConfig.description || '',
      // Policy Definition
      principal: policyConfig.principal || {},
      // Ù…Ù† Ù„Ù‡ Ø§Ù„Ø¥Ø°Ù†
      action: policyConfig.action || [],
      // Ù…Ø§Ø°Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙØ¹Ù„
      resource: policyConfig.resource || [],
      // Ø¹Ù„Ù‰ Ù…Ø§Ø°Ø§

      // Conditions
      conditions: policyConfig.conditions || {},
      // Effect
      effect: policyConfig.effect || 'Allow',
      // Allow or Deny
      priority: policyConfig.priority || 100,
      // Ø£Ø¹Ù„Ù‰ Ø±Ù‚Ù… = Ø£ÙˆÙ„ÙˆÙŠØ© Ø£Ø¹Ù„Ù‰

      // Status
      isActive: policyConfig.isActive !== false,
      // Version Control
      version: 1,
      createdAt: new Date(),
      updatedAt: new Date(),
      createdBy: policyConfig.createdBy || 'system',
      // Metadata
      metadata: policyConfig.metadata || {}
    };
    this.policies.set(policyId, policy);
    this.policyHistory.push({
      policyId,
      action: 'CREATED',
      timestamp: new Date(),
      data: {
        ...policy
      }
    });
    if (this.rbac && this.rbac.emit) {
      this.rbac.emit('policyCreated', policy);
    }
    this.emit('policyCreated', policy);
    return policy;
  }

  /**
   * ØªØ­Ø¯ÙŠØ« Ø³ÙŠØ§Ø³Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
   */
  updatePolicy(policyId, updates) {
    const policy = this.policies.get(policyId);
    if (!policy) throw new Error(`Policy ${policyId} not found`);
    const oldPolicy = {
      ...policy
    };
    Object.assign(policy, updates, {
      version: policy.version + 1,
      updatedAt: new Date()
    });
    this.policyHistory.push({
      policyId,
      action: 'UPDATED',
      timestamp: new Date(),
      oldData: oldPolicy,
      newData: {
        ...policy
      }
    });
    if (this.rbac && this.rbac.emit) {
      this.rbac.emit('policyUpdated', policy);
    }
    this.emit('policyUpdated', policy);
    return policy;
  }

  /**
   * Ø­Ø°Ù Ø³ÙŠØ§Ø³Ø©
   */
  deletePolicy(policyId) {
    const policy = this.policies.get(policyId);
    if (!policy) throw new Error(`Policy ${policyId} not found`);
    this.policies.delete(policyId);
    this.policyHistory.push({
      policyId,
      action: 'DELETED',
      timestamp: new Date(),
      data: policy
    });
    if (this.rbac && this.rbac.emit) {
      this.rbac.emit('policyDeleted', policyId);
    }
    this.emit('policyDeleted', policyId);
  }

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³ÙŠØ§Ø³Ø©
   */
  getPolicy(policyId) {
    return this.policies.get(policyId) || null;
  }

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ù…Ø¹ Ø§Ù„ØªØµÙÙŠØ©
   */
  getAllPolicies(filter = {}) {
    let policies = Array.from(this.policies.values());
    if (filter.active !== undefined) {
      policies = policies.filter(p => p.isActive === filter.active);
    }
    if (filter.effect) {
      policies = policies.filter(p => p.effect === filter.effect);
    }
    if (filter.principal) {
      policies = policies.filter(p => this._matchPrincipal(p.principal, filter.principal));
    }
    return policies.sort((a, b) => b.priority - a.priority);
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 2ï¸âƒ£ POLICY EVALUATION - ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
   */
  evaluatePolicies(userId, context = {}) {
    const evaluationResult = {
      userId,
      timestamp: new Date(),
      policiesApplied: [],
      deniedPolicies: [],
      finalDecision: 'Deny',
      // Default to deny
      evaluationDetails: []
    };

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø¬Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
    const applicablePolicies = this._getApplicablePolicies(userId, context);
    for (const policy of applicablePolicies) {
      if (!policy.isActive) continue;
      const evaluationDetail = {
        policyId: policy.id,
        effect: policy.effect,
        conditionsMet: true,
        reason: ''
      };

      // ØªÙ‚ÙŠÙŠÙ… Ø´Ø±ÙˆØ· Ø§Ù„Ø³ÙŠØ§Ø³Ø©
      if (!this._evaluatePolicyConditions(userId, policy, context)) {
        evaluationDetail.conditionsMet = false;
        evaluationDetail.reason = 'Conditions not satisfied';
        evaluationResult.evaluationDetails.push(evaluationDetail);
        continue;
      }

      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø³ÙŠØ§Ø³Ø© ØªØ³Ù…Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ ÙˆÙ„Ù… Ù†Ø±Ù‰ Ø±ÙØ¶ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
      if (policy.effect === 'Allow') {
        evaluationResult.policiesApplied.push(policy.id);
        evaluationResult.finalDecision = 'Allow';
        evaluationDetail.reason = 'Access granted by policy';
      }

      // Ø§Ù„Ø±ÙØ¶ ÙŠØ³Ø¨Ù‚ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
      if (policy.effect === 'Deny') {
        evaluationResult.deniedPolicies.push(policy.id);
        evaluationResult.finalDecision = 'Deny';
        evaluationDetail.reason = 'Access denied by policy';
        evaluationResult.evaluationDetails.push(evaluationDetail);
        break; // Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø±ÙØ¶
      }
      evaluationResult.evaluationDetails.push(evaluationDetail);
    }
    return evaluationResult;
  }

  /**
   * ØªÙ‚ÙŠÙŠÙ… Ø³ÙŠØ§Ø³Ø© ÙˆØ§Ø­Ø¯Ø©
   */
  evaluatePolicy(policyId, userId, context = {}) {
    const policy = this.policies.get(policyId);
    if (!policy) return {
      policyId,
      result: 'Unknown',
      reason: 'Policy not found'
    };
    const matches = this._evaluatePolicyConditions(userId, policy, context);
    return {
      policyId,
      result: matches ? policy.effect : 'NotApplicable',
      reason: matches ? `Policy effect: ${policy.effect}` : 'Policy conditions not met'
    };
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 3ï¸âƒ£ CONDITIONAL RULES - Ø§Ù„Ù‚ÙˆØ§Ø¹Ø³ Ø§Ù„Ø´Ø±Ø·ÙŠØ©
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø´Ø±Ø·ÙŠØ©
   */
  createConditionalRule(ruleId, ruleConfig = {}) {
    const rule = {
      id: ruleId,
      name: ruleConfig.name || ruleId,
      description: ruleConfig.description || '',
      // Condition Operator
      operator: ruleConfig.operator || 'AND',
      // AND, OR, NOT
      conditions: ruleConfig.conditions || [],
      // Array of conditions

      // Action
      action: ruleConfig.action || 'Allow',
      // Priority
      priority: ruleConfig.priority || 50,
      // Status
      isActive: ruleConfig.isActive !== false,
      // Metadata
      metadata: ruleConfig.metadata || {}
    };
    this.conditionalRules.set(ruleId, rule);
    return rule;
  }

  /**
   * ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø´Ø±Ø·ÙŠØ©
   */
  evaluateRule(ruleId, context = {}) {
    const rule = this.conditionalRules.get(ruleId);
    if (!rule) return false;
    if (!rule.isActive) return false;
    const conditionResults = rule.conditions.map(condition => this._evaluateCondition(condition, context));
    switch (rule.operator) {
      case 'AND':
        return conditionResults.every(r => r === true);
      case 'OR':
        return conditionResults.some(r => r === true);
      case 'NOT':
        return conditionResults.every(r => r === false);
      default:
        return false;
    }
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 4ï¸âƒ£ POLICY TEMPLATES - Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Ø³ÙŠØ§Ø³Ø©
   */
  createPolicyTemplate(templateId, template = {}) {
    const policyTemplate = {
      id: templateId,
      name: template.name || templateId,
      description: template.description || '',
      template: template.template || {},
      variables: template.variables || {},
      // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨

      category: template.category || 'general',
      createdAt: new Date(),
      updatedAt: new Date()
    };
    this.policyTemplates.set(templateId, policyTemplate);
    return policyTemplate;
  }

  /**
   * Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ø³Ø© Ù…Ù† Ù‚Ø§Ù„Ø¨
   */
  createPolicyFromTemplate(policyId, templateId, variables = {}) {
    const template = this.policyTemplates.get(templateId);
    if (!template) throw new Error(`Template ${templateId} not found`);

    // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ù„Ø¨
    const policyConfig = this._substituteVariables(template.template, variables);
    return this.createPolicy(policyId, policyConfig);
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 5ï¸âƒ£ ACCESS DECISION - Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
   */
  makeAccessDecision(userId, action, resource, context = {}) {
    const decision = {
      userId,
      action,
      resource,
      timestamp: new Date(),
      allowed: false,
      reason: '',
      policyEvaluations: []
    };

    // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
    const policyResult = this.evaluatePolicies(userId, {
      action,
      resource,
      ...context
    });
    decision.allowed = policyResult.finalDecision === 'Allow';
    decision.reason = this._generateDecisionReason(policyResult);
    decision.policyEvaluations = policyResult.evaluationDetails;

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
    if (!decision.allowed) {
      const hasPermission = this.rbac.hasPermission(userId, `${action}:${resource}`, context);
      if (hasPermission) {
        decision.allowed = true;
        decision.reason = 'Permission granted via role-based access';
      }
    }
    return decision;
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 6ï¸âƒ£ EXCEPTION MANAGEMENT - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø¥Ø¶Ø§ÙØ© Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù…Ø¤Ù‚Øª
   */
  addTemporaryException(exceptionId, exceptionConfig = {}) {
    const exception = {
      id: exceptionId,
      userId: exceptionConfig.userId,
      action: exceptionConfig.action,
      resource: exceptionConfig.resource,
      effect: exceptionConfig.effect || 'Allow',
      expiresAt: exceptionConfig.expiresAt || new Date(Date.now() + 86400000),
      // 24 hours

      reason: exceptionConfig.reason,
      createdBy: exceptionConfig.createdBy || 'admin',
      createdAt: new Date()
    };
    if (!this.temporaryExceptions) {
      this.temporaryExceptions = new Map();
    }
    this.temporaryExceptions.set(exceptionId, exception);

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
    setTimeout(() => {
      this.temporaryExceptions.delete(exceptionId);
    }, exceptionConfig.expiresAt - Date.now());
    return exception;
  }

  /**
   * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª
   */
  _checkTemporaryExceptions(userId, action, resource) {
    if (!this.temporaryExceptions) return null;
    for (const exception of this.temporaryExceptions.values()) {
      if (exception.expiresAt < new Date()) continue;
      if (exception.userId === userId && exception.action === action && exception.resource === resource) {
        return exception;
      }
    }
    return null;
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * PRIVATE METHODS - Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ø®Ø§ØµØ©
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ù†Ø·Ø¨Ù‚Ø©
   */
  _getApplicablePolicies(userId, context) {
    return this.getAllPolicies({
      active: true
    }).filter(policy => {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†Ø·Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø¨Ø¯Ø£
      if (!this._matchPrincipal(policy.principal, userId, context)) {
        return false;
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯
      if (context.action && !this._matchAction(policy.action, context.action)) {
        return false;
      }
      if (context.resource && !this._matchResource(policy.resource, context.resource)) {
        return false;
      }
      return true;
    });
  }

  /**
   * ØªÙ‚ÙŠÙŠÙ… Ø´Ø±ÙˆØ· Ø§Ù„Ø³ÙŠØ§Ø³Ø©
   */
  _evaluatePolicyConditions(userId, policy, context) {
    if (!policy.conditions || Object.keys(policy.conditions).length === 0) {
      return true; // Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±ÙˆØ· = Ù…ÙˆØ§ÙÙ‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
    }
    for (const [key, value] of Object.entries(policy.conditions)) {
      const contextValue = context[key];
      if (!this._matchConditionValue(contextValue, value)) {
        return false;
      }
    }
    return true;
  }

  /**
   * ØªÙ‚ÙŠÙŠÙ… Ø´Ø±Ø· ÙˆØ§Ø­Ø¯
   */
  _evaluateCondition(condition, context) {
    if (typeof condition === 'function') {
      return condition(context);
    }
    if (typeof condition === 'object' && condition !== null) {
      const {
        field,
        operator,
        value
      } = condition;
      const contextValue = context[field];
      switch (operator) {
        case 'equals':
          return contextValue === value;
        case 'not_equals':
          return contextValue !== value;
        case 'greater_than':
          return contextValue > value;
        case 'less_than':
          return contextValue < value;
        case 'in':
          return Array.isArray(value) && value.includes(contextValue);
        case 'contains':
          return String(contextValue).includes(String(value));
        case 'starts_with':
          return String(contextValue).startsWith(String(value));
        case 'ends_with':
          return String(contextValue).endsWith(String(value));
        default:
          return false;
      }
    }
    return false;
  }

  /**
   * Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…Ø¨Ø¯Ø£
   */
  _matchPrincipal(policiaPrincipal, userId, context = {}) {
    if (!policiaPrincipal) return true;
    if (policiaPrincipal.userId && policiaPrincipal.userId !== userId) {
      return false;
    }
    if (policiaPrincipal.role) {
      const userRoles = this.rbac.getUserRoles(userId);
      const hasRole = userRoles.some(r => r.roleId === policiaPrincipal.role);
      if (!hasRole) return false;
    }
    if (policiaPrincipal.department && context.department !== policiaPrincipal.department) {
      return false;
    }
    return true;
  }

  /**
   * Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
   */
  _matchAction(policyActions, contextAction) {
    if (!Array.isArray(policyActions)) return false;
    if (policyActions.includes('*')) return true;
    return policyActions.includes(contextAction);
  }

  /**
   * Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…ÙˆØ±Ø¯
   */
  _matchResource(policyResources, contextResource) {
    if (!Array.isArray(policyResources)) return false;
    if (policyResources.includes('*')) return true;
    return policyResources.some(res => {
      if (res === contextResource) return true;

      // Ø¯Ø¹Ù… wildcards: "users/*" ØªØ·Ø§Ø¨Ù‚ "users/123"
      if (res.endsWith('/*')) {
        const prefix = res.slice(0, -2);
        return contextResource.startsWith(prefix);
      }
      return false;
    });
  }

  /**
   * Ù…Ø·Ø§Ø¨Ù‚Ø© Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ø±Ø·
   */
  _matchConditionValue(actual, expected) {
    if (typeof expected === 'function') {
      return expected(actual);
    }
    if (Array.isArray(expected)) {
      return expected.includes(actual);
    }
    return actual === expected;
  }

  /**
   * Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ù„Ø¨
   */
  _substituteVariables(template, variables) {
    const substituted = JSON.parse(JSON.stringify(template));
    const substitute = obj => {
      for (const key in obj) {
        if (typeof obj[key] === 'string' && obj[key].startsWith('{{') && obj[key].endsWith('}}')) {
          const varName = obj[key].slice(2, -2);
          obj[key] = variables[varName] || obj[key];
        } else if (typeof obj[key] === 'object' && obj[key] !== null) {
          substitute(obj[key]);
        }
      }
    };
    substitute(substituted);
    return substituted;
  }

  /**
   * ØªÙˆÙ„ÙŠØ¯ Ø³Ø¨Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø±
   */
  _generateDecisionReason(policyResult) {
    if (policyResult.finalDecision === 'Allow') {
      return `Access allowed by policies: ${policyResult.policiesApplied.join(', ')}`;
    } else {
      if (policyResult.deniedPolicies.length > 0) {
        return `Access denied by policies: ${policyResult.deniedPolicies.join(', ')}`;
      }
      return 'No matching policies to allow access';
    }
  }

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
   */
  getPolicyHistory(filters = {}) {
    let history = this.policyHistory;
    if (filters.policyId) {
      history = history.filter(h => h.policyId === filters.policyId);
    }
    if (filters.action) {
      history = history.filter(h => h.action === filters.action);
    }
    if (filters.limit) {
      history = history.slice(-filters.limit);
    }
    return history;
  }

  /**
   * ØªØµØ¯ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
   */
  exportPolicies() {
    return {
      policies: Array.from(this.policies.values()),
      templates: Array.from(this.policyTemplates.values()),
      rules: Array.from(this.conditionalRules.values()),
      timestamp: new Date()
    };
  }

  /**
   * Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª
   */
  importPolicies(data) {
    if (data.policies) {
      data.policies.forEach(policy => {
        this.createPolicy(policy.id, policy);
      });
    }
    if (data.templates) {
      data.templates.forEach(template => {
        this.createPolicyTemplate(template.id, template);
      });
    }
    if (data.rules) {
      data.rules.forEach(rule => {
        this.createConditionalRule(rule.id, rule);
      });
    }
  }
}
module.exports = RBACPolicyEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJyZXF1aXJlIiwiUkJBQ1BvbGljeUVuZ2luZSIsImNvbnN0cnVjdG9yIiwicmJhY1N5c3RlbSIsInJiYWMiLCJwb2xpY2llcyIsIk1hcCIsInBvbGljeUhpc3RvcnkiLCJwb2xpY3lUZW1wbGF0ZXMiLCJjb25kaXRpb25hbFJ1bGVzIiwiY3JlYXRlUG9saWN5IiwicG9saWN5SWQiLCJwb2xpY3lDb25maWciLCJoYXMiLCJFcnJvciIsInBvbGljeSIsImlkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwicHJpbmNpcGFsIiwiYWN0aW9uIiwicmVzb3VyY2UiLCJjb25kaXRpb25zIiwiZWZmZWN0IiwicHJpb3JpdHkiLCJpc0FjdGl2ZSIsInZlcnNpb24iLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlZEF0IiwiY3JlYXRlZEJ5IiwibWV0YWRhdGEiLCJzZXQiLCJwdXNoIiwidGltZXN0YW1wIiwiZGF0YSIsImVtaXQiLCJ1cGRhdGVQb2xpY3kiLCJ1cGRhdGVzIiwiZ2V0Iiwib2xkUG9saWN5IiwiT2JqZWN0IiwiYXNzaWduIiwib2xkRGF0YSIsIm5ld0RhdGEiLCJkZWxldGVQb2xpY3kiLCJkZWxldGUiLCJnZXRQb2xpY3kiLCJnZXRBbGxQb2xpY2llcyIsImZpbHRlciIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsImFjdGl2ZSIsInVuZGVmaW5lZCIsInAiLCJfbWF0Y2hQcmluY2lwYWwiLCJzb3J0IiwiYSIsImIiLCJldmFsdWF0ZVBvbGljaWVzIiwidXNlcklkIiwiY29udGV4dCIsImV2YWx1YXRpb25SZXN1bHQiLCJwb2xpY2llc0FwcGxpZWQiLCJkZW5pZWRQb2xpY2llcyIsImZpbmFsRGVjaXNpb24iLCJldmFsdWF0aW9uRGV0YWlscyIsImFwcGxpY2FibGVQb2xpY2llcyIsIl9nZXRBcHBsaWNhYmxlUG9saWNpZXMiLCJldmFsdWF0aW9uRGV0YWlsIiwiY29uZGl0aW9uc01ldCIsInJlYXNvbiIsIl9ldmFsdWF0ZVBvbGljeUNvbmRpdGlvbnMiLCJldmFsdWF0ZVBvbGljeSIsInJlc3VsdCIsIm1hdGNoZXMiLCJjcmVhdGVDb25kaXRpb25hbFJ1bGUiLCJydWxlSWQiLCJydWxlQ29uZmlnIiwicnVsZSIsIm9wZXJhdG9yIiwiZXZhbHVhdGVSdWxlIiwiY29uZGl0aW9uUmVzdWx0cyIsIm1hcCIsImNvbmRpdGlvbiIsIl9ldmFsdWF0ZUNvbmRpdGlvbiIsImV2ZXJ5IiwiciIsInNvbWUiLCJjcmVhdGVQb2xpY3lUZW1wbGF0ZSIsInRlbXBsYXRlSWQiLCJ0ZW1wbGF0ZSIsInBvbGljeVRlbXBsYXRlIiwidmFyaWFibGVzIiwiY2F0ZWdvcnkiLCJjcmVhdGVQb2xpY3lGcm9tVGVtcGxhdGUiLCJfc3Vic3RpdHV0ZVZhcmlhYmxlcyIsIm1ha2VBY2Nlc3NEZWNpc2lvbiIsImRlY2lzaW9uIiwiYWxsb3dlZCIsInBvbGljeUV2YWx1YXRpb25zIiwicG9saWN5UmVzdWx0IiwiX2dlbmVyYXRlRGVjaXNpb25SZWFzb24iLCJoYXNQZXJtaXNzaW9uIiwiYWRkVGVtcG9yYXJ5RXhjZXB0aW9uIiwiZXhjZXB0aW9uSWQiLCJleGNlcHRpb25Db25maWciLCJleGNlcHRpb24iLCJleHBpcmVzQXQiLCJub3ciLCJ0ZW1wb3JhcnlFeGNlcHRpb25zIiwic2V0VGltZW91dCIsIl9jaGVja1RlbXBvcmFyeUV4Y2VwdGlvbnMiLCJfbWF0Y2hBY3Rpb24iLCJfbWF0Y2hSZXNvdXJjZSIsImtleXMiLCJsZW5ndGgiLCJrZXkiLCJ2YWx1ZSIsImVudHJpZXMiLCJjb250ZXh0VmFsdWUiLCJfbWF0Y2hDb25kaXRpb25WYWx1ZSIsImZpZWxkIiwiaXNBcnJheSIsImluY2x1ZGVzIiwiU3RyaW5nIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwicG9saWNpYVByaW5jaXBhbCIsInJvbGUiLCJ1c2VyUm9sZXMiLCJnZXRVc2VyUm9sZXMiLCJoYXNSb2xlIiwicm9sZUlkIiwiZGVwYXJ0bWVudCIsInBvbGljeUFjdGlvbnMiLCJjb250ZXh0QWN0aW9uIiwicG9saWN5UmVzb3VyY2VzIiwiY29udGV4dFJlc291cmNlIiwicmVzIiwicHJlZml4Iiwic2xpY2UiLCJhY3R1YWwiLCJleHBlY3RlZCIsInN1YnN0aXR1dGVkIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5Iiwic3Vic3RpdHV0ZSIsIm9iaiIsInZhck5hbWUiLCJqb2luIiwiZ2V0UG9saWN5SGlzdG9yeSIsImZpbHRlcnMiLCJoaXN0b3J5IiwiaCIsImxpbWl0IiwiZXhwb3J0UG9saWNpZXMiLCJ0ZW1wbGF0ZXMiLCJydWxlcyIsImltcG9ydFBvbGljaWVzIiwiZm9yRWFjaCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyYmFjLXBvbGljeS1lbmdpbmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gKiDwn46vIFJCQUMgUG9saWN5IEVuZ2luZSAtINmF2K3YsdmDINin2YTYs9mK2KfYs9in2Kog2KfZhNmF2KrZgtiv2YXYqVxyXG4gKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICogXHJcbiAqINmK2YjZgdixINmG2LjYp9mFINmC2YjYp9i52K8g2K/ZitmG2KfZhdmK2YPZiiDZhdiq2YLYr9mFINmF2Lk6XHJcbiAqIOKchSDYqtmC2YrZitmFINin2YTYs9mK2KfYs9in2Kog2KfZhNmF2LnZgtiv2KlcclxuICog4pyFINiv2LnZhSDYp9mE2LTYsdmI2Lcg2KfZhNmF2KrYudiv2K/YqVxyXG4gKiDinIUg2KXYr9in2LHYqSDYp9mE2KfYs9iq2KvZhtin2KHYp9iqXHJcbiAqIOKchSDZhti42KfZhSDYp9mE2KPZiNmE2YjZitin2KpcclxuICovXHJcblxyXG5jb25zdCB7IEV2ZW50RW1pdHRlciB9ID0gcmVxdWlyZSgnZXZlbnRzJyk7XHJcblxyXG5jbGFzcyBSQkFDUG9saWN5RW5naW5lIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcclxuICBjb25zdHJ1Y3RvcihyYmFjU3lzdGVtKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5yYmFjID0gcmJhY1N5c3RlbTtcclxuICAgIHRoaXMucG9saWNpZXMgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLnBvbGljeUhpc3RvcnkgPSBbXTtcclxuICAgIHRoaXMucG9saWN5VGVtcGxhdGVzID0gbmV3IE1hcCgpO1xyXG4gICAgdGhpcy5jb25kaXRpb25hbFJ1bGVzID0gbmV3IE1hcCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgICogMe+4j+KDoyBQT0xJQ1kgTUFOQUdFTUVOVCAtINil2K/Yp9ix2Kkg2KfZhNiz2YrYp9iz2KfYqlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYpdmG2LTYp9ihINiz2YrYp9iz2Kkg2KzYr9mK2K/YqVxyXG4gICAqL1xyXG4gIGNyZWF0ZVBvbGljeShwb2xpY3lJZCwgcG9saWN5Q29uZmlnID0ge30pIHtcclxuICAgIGlmICh0aGlzLnBvbGljaWVzLmhhcyhwb2xpY3lJZCkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQb2xpY3kgJHtwb2xpY3lJZH0gYWxyZWFkeSBleGlzdHNgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwb2xpY3kgPSB7XHJcbiAgICAgIGlkOiBwb2xpY3lJZCxcclxuICAgICAgbmFtZTogcG9saWN5Q29uZmlnLm5hbWUgfHwgcG9saWN5SWQsXHJcbiAgICAgIGRlc2NyaXB0aW9uOiBwb2xpY3lDb25maWcuZGVzY3JpcHRpb24gfHwgJycsXHJcbiAgICAgIFxyXG4gICAgICAvLyBQb2xpY3kgRGVmaW5pdGlvblxyXG4gICAgICBwcmluY2lwYWw6IHBvbGljeUNvbmZpZy5wcmluY2lwYWwgfHwge30sIC8vINmF2YYg2YTZhyDYp9mE2KXYsNmGXHJcbiAgICAgIGFjdGlvbjogcG9saWN5Q29uZmlnLmFjdGlvbiB8fCBbXSwgLy8g2YXYp9iw2Kcg2YrZhdmD2YYg2KPZhiDZitmB2LnZhFxyXG4gICAgICByZXNvdXJjZTogcG9saWN5Q29uZmlnLnJlc291cmNlIHx8IFtdLCAvLyDYudmE2Ykg2YXYp9iw2KdcclxuICAgICAgXHJcbiAgICAgIC8vIENvbmRpdGlvbnNcclxuICAgICAgY29uZGl0aW9uczogcG9saWN5Q29uZmlnLmNvbmRpdGlvbnMgfHwge30sXHJcbiAgICAgIFxyXG4gICAgICAvLyBFZmZlY3RcclxuICAgICAgZWZmZWN0OiBwb2xpY3lDb25maWcuZWZmZWN0IHx8ICdBbGxvdycsIC8vIEFsbG93IG9yIERlbnlcclxuICAgICAgcHJpb3JpdHk6IHBvbGljeUNvbmZpZy5wcmlvcml0eSB8fCAxMDAsIC8vINij2LnZhNmJINix2YLZhSA9INij2YjZhNmI2YrYqSDYo9i52YTZiVxyXG4gICAgICBcclxuICAgICAgLy8gU3RhdHVzXHJcbiAgICAgIGlzQWN0aXZlOiBwb2xpY3lDb25maWcuaXNBY3RpdmUgIT09IGZhbHNlLFxyXG4gICAgICBcclxuICAgICAgLy8gVmVyc2lvbiBDb250cm9sXHJcbiAgICAgIHZlcnNpb246IDEsXHJcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICBjcmVhdGVkQnk6IHBvbGljeUNvbmZpZy5jcmVhdGVkQnkgfHwgJ3N5c3RlbScsXHJcbiAgICAgIFxyXG4gICAgICAvLyBNZXRhZGF0YVxyXG4gICAgICBtZXRhZGF0YTogcG9saWN5Q29uZmlnLm1ldGFkYXRhIHx8IHt9XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9saWNpZXMuc2V0KHBvbGljeUlkLCBwb2xpY3kpO1xyXG4gICAgdGhpcy5wb2xpY3lIaXN0b3J5LnB1c2goe1xyXG4gICAgICBwb2xpY3lJZCxcclxuICAgICAgYWN0aW9uOiAnQ1JFQVRFRCcsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgZGF0YTogeyAuLi5wb2xpY3kgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHRoaXMucmJhYyAmJiB0aGlzLnJiYWMuZW1pdCkge1xyXG4gICAgICB0aGlzLnJiYWMuZW1pdCgncG9saWN5Q3JlYXRlZCcsIHBvbGljeSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmVtaXQoJ3BvbGljeUNyZWF0ZWQnLCBwb2xpY3kpO1xyXG4gICAgcmV0dXJuIHBvbGljeTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiq2K3Yr9mK2Ksg2LPZitin2LPYqSDZhdmI2KzZiNiv2KlcclxuICAgKi9cclxuICB1cGRhdGVQb2xpY3kocG9saWN5SWQsIHVwZGF0ZXMpIHtcclxuICAgIGNvbnN0IHBvbGljeSA9IHRoaXMucG9saWNpZXMuZ2V0KHBvbGljeUlkKTtcclxuICAgIGlmICghcG9saWN5KSB0aHJvdyBuZXcgRXJyb3IoYFBvbGljeSAke3BvbGljeUlkfSBub3QgZm91bmRgKTtcclxuXHJcbiAgICBjb25zdCBvbGRQb2xpY3kgPSB7IC4uLnBvbGljeSB9O1xyXG4gICAgXHJcbiAgICBPYmplY3QuYXNzaWduKHBvbGljeSwgdXBkYXRlcywge1xyXG4gICAgICB2ZXJzaW9uOiBwb2xpY3kudmVyc2lvbiArIDEsXHJcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5wb2xpY3lIaXN0b3J5LnB1c2goe1xyXG4gICAgICBwb2xpY3lJZCxcclxuICAgICAgYWN0aW9uOiAnVVBEQVRFRCcsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgb2xkRGF0YTogb2xkUG9saWN5LFxyXG4gICAgICBuZXdEYXRhOiB7IC4uLnBvbGljeSB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAodGhpcy5yYmFjICYmIHRoaXMucmJhYy5lbWl0KSB7XHJcbiAgICAgIHRoaXMucmJhYy5lbWl0KCdwb2xpY3lVcGRhdGVkJywgcG9saWN5KTtcclxuICAgIH1cclxuICAgIHRoaXMuZW1pdCgncG9saWN5VXBkYXRlZCcsIHBvbGljeSk7XHJcbiAgICByZXR1cm4gcG9saWN5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2K3YsNmBINiz2YrYp9iz2KlcclxuICAgKi9cclxuICBkZWxldGVQb2xpY3kocG9saWN5SWQpIHtcclxuICAgIGNvbnN0IHBvbGljeSA9IHRoaXMucG9saWNpZXMuZ2V0KHBvbGljeUlkKTtcclxuICAgIGlmICghcG9saWN5KSB0aHJvdyBuZXcgRXJyb3IoYFBvbGljeSAke3BvbGljeUlkfSBub3QgZm91bmRgKTtcclxuXHJcbiAgICB0aGlzLnBvbGljaWVzLmRlbGV0ZShwb2xpY3lJZCk7XHJcbiAgICBcclxuICAgIHRoaXMucG9saWN5SGlzdG9yeS5wdXNoKHtcclxuICAgICAgcG9saWN5SWQsXHJcbiAgICAgIGFjdGlvbjogJ0RFTEVURUQnLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIGRhdGE6IHBvbGljeVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHRoaXMucmJhYyAmJiB0aGlzLnJiYWMuZW1pdCkge1xyXG4gICAgICB0aGlzLnJiYWMuZW1pdCgncG9saWN5RGVsZXRlZCcsIHBvbGljeUlkKTtcclxuICAgIH1cclxuICAgIHRoaXMuZW1pdCgncG9saWN5RGVsZXRlZCcsIHBvbGljeUlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2LPZitin2LPYqVxyXG4gICAqL1xyXG4gIGdldFBvbGljeShwb2xpY3lJZCkge1xyXG4gICAgcmV0dXJuIHRoaXMucG9saWNpZXMuZ2V0KHBvbGljeUlkKSB8fCBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYrNmF2YrYuSDYp9mE2LPZitin2LPYp9iqINmF2Lkg2KfZhNiq2LXZgdmK2KlcclxuICAgKi9cclxuICBnZXRBbGxQb2xpY2llcyhmaWx0ZXIgPSB7fSkge1xyXG4gICAgbGV0IHBvbGljaWVzID0gQXJyYXkuZnJvbSh0aGlzLnBvbGljaWVzLnZhbHVlcygpKTtcclxuXHJcbiAgICBpZiAoZmlsdGVyLmFjdGl2ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHBvbGljaWVzID0gcG9saWNpZXMuZmlsdGVyKHAgPT4gcC5pc0FjdGl2ZSA9PT0gZmlsdGVyLmFjdGl2ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlci5lZmZlY3QpIHtcclxuICAgICAgcG9saWNpZXMgPSBwb2xpY2llcy5maWx0ZXIocCA9PiBwLmVmZmVjdCA9PT0gZmlsdGVyLmVmZmVjdCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlci5wcmluY2lwYWwpIHtcclxuICAgICAgcG9saWNpZXMgPSBwb2xpY2llcy5maWx0ZXIocCA9PiBcclxuICAgICAgICB0aGlzLl9tYXRjaFByaW5jaXBhbChwLnByaW5jaXBhbCwgZmlsdGVyLnByaW5jaXBhbClcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcG9saWNpZXMuc29ydCgoYSwgYikgPT4gYi5wcmlvcml0eSAtIGEucHJpb3JpdHkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgICogMu+4j+KDoyBQT0xJQ1kgRVZBTFVBVElPTiAtINiq2YLZitmK2YUg2KfZhNiz2YrYp9iz2KfYqlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYqtmC2YrZitmFINin2YTYs9mK2KfYs9in2Kog2YTZhNmF2LPYqtiu2K/ZhVxyXG4gICAqL1xyXG4gIGV2YWx1YXRlUG9saWNpZXModXNlcklkLCBjb250ZXh0ID0ge30pIHtcclxuICAgIGNvbnN0IGV2YWx1YXRpb25SZXN1bHQgPSB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICBwb2xpY2llc0FwcGxpZWQ6IFtdLFxyXG4gICAgICBkZW5pZWRQb2xpY2llczogW10sXHJcbiAgICAgIGZpbmFsRGVjaXNpb246ICdEZW55JywgLy8gRGVmYXVsdCB0byBkZW55XHJcbiAgICAgIGV2YWx1YXRpb25EZXRhaWxzOiBbXVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDYp9mE2K3YtdmI2YQg2LnZhNmJINin2YTYs9mK2KfYs9in2Kog2KfZhNmF2K/Ysdis2Kkg2K3Ys9ioINin2YTYo9mI2YTZiNmK2KlcclxuICAgIGNvbnN0IGFwcGxpY2FibGVQb2xpY2llcyA9IHRoaXMuX2dldEFwcGxpY2FibGVQb2xpY2llcyh1c2VySWQsIGNvbnRleHQpO1xyXG5cclxuICAgIGZvciAoY29uc3QgcG9saWN5IG9mIGFwcGxpY2FibGVQb2xpY2llcykge1xyXG4gICAgICBpZiAoIXBvbGljeS5pc0FjdGl2ZSkgY29udGludWU7XHJcblxyXG4gICAgICBjb25zdCBldmFsdWF0aW9uRGV0YWlsID0ge1xyXG4gICAgICAgIHBvbGljeUlkOiBwb2xpY3kuaWQsXHJcbiAgICAgICAgZWZmZWN0OiBwb2xpY3kuZWZmZWN0LFxyXG4gICAgICAgIGNvbmRpdGlvbnNNZXQ6IHRydWUsXHJcbiAgICAgICAgcmVhc29uOiAnJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8g2KrZgtmK2YrZhSDYtNix2YjYtyDYp9mE2LPZitin2LPYqVxyXG4gICAgICBpZiAoIXRoaXMuX2V2YWx1YXRlUG9saWN5Q29uZGl0aW9ucyh1c2VySWQsIHBvbGljeSwgY29udGV4dCkpIHtcclxuICAgICAgICBldmFsdWF0aW9uRGV0YWlsLmNvbmRpdGlvbnNNZXQgPSBmYWxzZTtcclxuICAgICAgICBldmFsdWF0aW9uRGV0YWlsLnJlYXNvbiA9ICdDb25kaXRpb25zIG5vdCBzYXRpc2ZpZWQnO1xyXG4gICAgICAgIGV2YWx1YXRpb25SZXN1bHQuZXZhbHVhdGlvbkRldGFpbHMucHVzaChldmFsdWF0aW9uRGV0YWlsKTtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g2KXYsNinINmD2KfZhtiqINin2YTYs9mK2KfYs9ipINiq2LPZhditINio2KfZhNmI2LXZiNmEINmI2YTZhSDZhtix2Ykg2LHZgdi2INit2KrZiSDYp9mE2KLZhlxyXG4gICAgICBpZiAocG9saWN5LmVmZmVjdCA9PT0gJ0FsbG93Jykge1xyXG4gICAgICAgIGV2YWx1YXRpb25SZXN1bHQucG9saWNpZXNBcHBsaWVkLnB1c2gocG9saWN5LmlkKTtcclxuICAgICAgICBldmFsdWF0aW9uUmVzdWx0LmZpbmFsRGVjaXNpb24gPSAnQWxsb3cnO1xyXG4gICAgICAgIGV2YWx1YXRpb25EZXRhaWwucmVhc29uID0gJ0FjY2VzcyBncmFudGVkIGJ5IHBvbGljeSc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINin2YTYsdmB2LYg2YrYs9io2YIg2KfZhNmF2YjYp9mB2YLYqVxyXG4gICAgICBpZiAocG9saWN5LmVmZmVjdCA9PT0gJ0RlbnknKSB7XHJcbiAgICAgICAgZXZhbHVhdGlvblJlc3VsdC5kZW5pZWRQb2xpY2llcy5wdXNoKHBvbGljeS5pZCk7XHJcbiAgICAgICAgZXZhbHVhdGlvblJlc3VsdC5maW5hbERlY2lzaW9uID0gJ0RlbnknO1xyXG4gICAgICAgIGV2YWx1YXRpb25EZXRhaWwucmVhc29uID0gJ0FjY2VzcyBkZW5pZWQgYnkgcG9saWN5JztcclxuICAgICAgICBldmFsdWF0aW9uUmVzdWx0LmV2YWx1YXRpb25EZXRhaWxzLnB1c2goZXZhbHVhdGlvbkRldGFpbCk7XHJcbiAgICAgICAgYnJlYWs7IC8vINin2YTYqtmI2YLZgSDYp9mE2YHZiNix2Yog2LnZhtivINix2YHYtlxyXG4gICAgICB9XHJcblxyXG4gICAgICBldmFsdWF0aW9uUmVzdWx0LmV2YWx1YXRpb25EZXRhaWxzLnB1c2goZXZhbHVhdGlvbkRldGFpbCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGV2YWx1YXRpb25SZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtmC2YrZitmFINiz2YrYp9iz2Kkg2YjYp9it2K/YqVxyXG4gICAqL1xyXG4gIGV2YWx1YXRlUG9saWN5KHBvbGljeUlkLCB1c2VySWQsIGNvbnRleHQgPSB7fSkge1xyXG4gICAgY29uc3QgcG9saWN5ID0gdGhpcy5wb2xpY2llcy5nZXQocG9saWN5SWQpO1xyXG4gICAgaWYgKCFwb2xpY3kpIHJldHVybiB7IHBvbGljeUlkLCByZXN1bHQ6ICdVbmtub3duJywgcmVhc29uOiAnUG9saWN5IG5vdCBmb3VuZCcgfTtcclxuXHJcbiAgICBjb25zdCBtYXRjaGVzID0gdGhpcy5fZXZhbHVhdGVQb2xpY3lDb25kaXRpb25zKHVzZXJJZCwgcG9saWN5LCBjb250ZXh0KTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcG9saWN5SWQsXHJcbiAgICAgIHJlc3VsdDogbWF0Y2hlcyA/IHBvbGljeS5lZmZlY3QgOiAnTm90QXBwbGljYWJsZScsXHJcbiAgICAgIHJlYXNvbjogbWF0Y2hlcyA/IGBQb2xpY3kgZWZmZWN0OiAke3BvbGljeS5lZmZlY3R9YCA6ICdQb2xpY3kgY29uZGl0aW9ucyBub3QgbWV0J1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqIDPvuI/ig6MgQ09ORElUSU9OQUwgUlVMRVMgLSDYp9mE2YLZiNin2LnYsyDYp9mE2LTYsdi32YrYqVxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYpdmG2LTYp9ihINmC2KfYudiv2Kkg2LTYsdi32YrYqVxyXG4gICAqL1xyXG4gIGNyZWF0ZUNvbmRpdGlvbmFsUnVsZShydWxlSWQsIHJ1bGVDb25maWcgPSB7fSkge1xyXG4gICAgY29uc3QgcnVsZSA9IHtcclxuICAgICAgaWQ6IHJ1bGVJZCxcclxuICAgICAgbmFtZTogcnVsZUNvbmZpZy5uYW1lIHx8IHJ1bGVJZCxcclxuICAgICAgZGVzY3JpcHRpb246IHJ1bGVDb25maWcuZGVzY3JpcHRpb24gfHwgJycsXHJcbiAgICAgIFxyXG4gICAgICAvLyBDb25kaXRpb24gT3BlcmF0b3JcclxuICAgICAgb3BlcmF0b3I6IHJ1bGVDb25maWcub3BlcmF0b3IgfHwgJ0FORCcsIC8vIEFORCwgT1IsIE5PVFxyXG4gICAgICBjb25kaXRpb25zOiBydWxlQ29uZmlnLmNvbmRpdGlvbnMgfHwgW10sIC8vIEFycmF5IG9mIGNvbmRpdGlvbnNcclxuICAgICAgXHJcbiAgICAgIC8vIEFjdGlvblxyXG4gICAgICBhY3Rpb246IHJ1bGVDb25maWcuYWN0aW9uIHx8ICdBbGxvdycsXHJcbiAgICAgIFxyXG4gICAgICAvLyBQcmlvcml0eVxyXG4gICAgICBwcmlvcml0eTogcnVsZUNvbmZpZy5wcmlvcml0eSB8fCA1MCxcclxuICAgICAgXHJcbiAgICAgIC8vIFN0YXR1c1xyXG4gICAgICBpc0FjdGl2ZTogcnVsZUNvbmZpZy5pc0FjdGl2ZSAhPT0gZmFsc2UsXHJcbiAgICAgIFxyXG4gICAgICAvLyBNZXRhZGF0YVxyXG4gICAgICBtZXRhZGF0YTogcnVsZUNvbmZpZy5tZXRhZGF0YSB8fCB7fVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmNvbmRpdGlvbmFsUnVsZXMuc2V0KHJ1bGVJZCwgcnVsZSk7XHJcbiAgICByZXR1cm4gcnVsZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiq2YLZitmK2YUg2KfZhNmC2KfYudiv2Kkg2KfZhNi02LHYt9mK2KlcclxuICAgKi9cclxuICBldmFsdWF0ZVJ1bGUocnVsZUlkLCBjb250ZXh0ID0ge30pIHtcclxuICAgIGNvbnN0IHJ1bGUgPSB0aGlzLmNvbmRpdGlvbmFsUnVsZXMuZ2V0KHJ1bGVJZCk7XHJcbiAgICBpZiAoIXJ1bGUpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICBpZiAoIXJ1bGUuaXNBY3RpdmUpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICBjb25zdCBjb25kaXRpb25SZXN1bHRzID0gcnVsZS5jb25kaXRpb25zLm1hcChjb25kaXRpb24gPT5cclxuICAgICAgdGhpcy5fZXZhbHVhdGVDb25kaXRpb24oY29uZGl0aW9uLCBjb250ZXh0KVxyXG4gICAgKTtcclxuXHJcbiAgICBzd2l0Y2ggKHJ1bGUub3BlcmF0b3IpIHtcclxuICAgICAgY2FzZSAnQU5EJzpcclxuICAgICAgICByZXR1cm4gY29uZGl0aW9uUmVzdWx0cy5ldmVyeShyID0+IHIgPT09IHRydWUpO1xyXG4gICAgICBjYXNlICdPUic6XHJcbiAgICAgICAgcmV0dXJuIGNvbmRpdGlvblJlc3VsdHMuc29tZShyID0+IHIgPT09IHRydWUpO1xyXG4gICAgICBjYXNlICdOT1QnOlxyXG4gICAgICAgIHJldHVybiBjb25kaXRpb25SZXN1bHRzLmV2ZXJ5KHIgPT4gciA9PT0gZmFsc2UpO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqIDTvuI/ig6MgUE9MSUNZIFRFTVBMQVRFUyAtINmC2YjYp9mE2Kgg2KfZhNiz2YrYp9iz2KfYqlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYpdmG2LTYp9ihINmC2KfZhNioINiz2YrYp9iz2KlcclxuICAgKi9cclxuICBjcmVhdGVQb2xpY3lUZW1wbGF0ZSh0ZW1wbGF0ZUlkLCB0ZW1wbGF0ZSA9IHt9KSB7XHJcbiAgICBjb25zdCBwb2xpY3lUZW1wbGF0ZSA9IHtcclxuICAgICAgaWQ6IHRlbXBsYXRlSWQsXHJcbiAgICAgIG5hbWU6IHRlbXBsYXRlLm5hbWUgfHwgdGVtcGxhdGVJZCxcclxuICAgICAgZGVzY3JpcHRpb246IHRlbXBsYXRlLmRlc2NyaXB0aW9uIHx8ICcnLFxyXG4gICAgICBcclxuICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlLnRlbXBsYXRlIHx8IHt9LFxyXG4gICAgICB2YXJpYWJsZXM6IHRlbXBsYXRlLnZhcmlhYmxlcyB8fCB7fSwgLy8g2YXYqti62YrYsdin2Kog2KfZhNmC2KfZhNioXHJcbiAgICAgIFxyXG4gICAgICBjYXRlZ29yeTogdGVtcGxhdGUuY2F0ZWdvcnkgfHwgJ2dlbmVyYWwnLFxyXG4gICAgICBcclxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5wb2xpY3lUZW1wbGF0ZXMuc2V0KHRlbXBsYXRlSWQsIHBvbGljeVRlbXBsYXRlKTtcclxuICAgIHJldHVybiBwb2xpY3lUZW1wbGF0ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINil2YbYtNin2KEg2LPZitin2LPYqSDZhdmGINmC2KfZhNioXHJcbiAgICovXHJcbiAgY3JlYXRlUG9saWN5RnJvbVRlbXBsYXRlKHBvbGljeUlkLCB0ZW1wbGF0ZUlkLCB2YXJpYWJsZXMgPSB7fSkge1xyXG4gICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLnBvbGljeVRlbXBsYXRlcy5nZXQodGVtcGxhdGVJZCk7XHJcbiAgICBpZiAoIXRlbXBsYXRlKSB0aHJvdyBuZXcgRXJyb3IoYFRlbXBsYXRlICR7dGVtcGxhdGVJZH0gbm90IGZvdW5kYCk7XHJcblxyXG4gICAgLy8g2KfYs9iq2KjYr9in2YQg2KfZhNmF2KrYutmK2LHYp9iqINmB2Yog2KfZhNmC2KfZhNioXHJcbiAgICBjb25zdCBwb2xpY3lDb25maWcgPSB0aGlzLl9zdWJzdGl0dXRlVmFyaWFibGVzKHRlbXBsYXRlLnRlbXBsYXRlLCB2YXJpYWJsZXMpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVBvbGljeShwb2xpY3lJZCwgcG9saWN5Q29uZmlnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqIDXvuI/ig6MgQUNDRVNTIERFQ0lTSU9OIC0g2KfYqtiu2KfYsCDZgtix2KfYsSDYp9mE2YjYtdmI2YRcclxuICAgKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICAgKi9cclxuXHJcbiAgLyoqXHJcbiAgICog2KfYqtiu2KfYsCDZgtix2KfYsSDYp9mE2YjYtdmI2YQg2KfZhNmG2YfYp9im2YpcclxuICAgKi9cclxuICBtYWtlQWNjZXNzRGVjaXNpb24odXNlcklkLCBhY3Rpb24sIHJlc291cmNlLCBjb250ZXh0ID0ge30pIHtcclxuICAgIGNvbnN0IGRlY2lzaW9uID0ge1xyXG4gICAgICB1c2VySWQsXHJcbiAgICAgIGFjdGlvbixcclxuICAgICAgcmVzb3VyY2UsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgYWxsb3dlZDogZmFsc2UsXHJcbiAgICAgIHJlYXNvbjogJycsXHJcbiAgICAgIHBvbGljeUV2YWx1YXRpb25zOiBbXVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDYqtmC2YrZitmFINin2YTYs9mK2KfYs9in2KpcclxuICAgIGNvbnN0IHBvbGljeVJlc3VsdCA9IHRoaXMuZXZhbHVhdGVQb2xpY2llcyh1c2VySWQsIHtcclxuICAgICAgYWN0aW9uLFxyXG4gICAgICByZXNvdXJjZSxcclxuICAgICAgLi4uY29udGV4dFxyXG4gICAgfSk7XHJcblxyXG4gICAgZGVjaXNpb24uYWxsb3dlZCA9IHBvbGljeVJlc3VsdC5maW5hbERlY2lzaW9uID09PSAnQWxsb3cnO1xyXG4gICAgZGVjaXNpb24ucmVhc29uID0gdGhpcy5fZ2VuZXJhdGVEZWNpc2lvblJlYXNvbihwb2xpY3lSZXN1bHQpO1xyXG4gICAgZGVjaXNpb24ucG9saWN5RXZhbHVhdGlvbnMgPSBwb2xpY3lSZXN1bHQuZXZhbHVhdGlvbkRldGFpbHM7XHJcblxyXG4gICAgLy8g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNij2LDZiNmG2KfYqiDYp9mE2YLYp9im2YXYqSDYudmE2Ykg2KfZhNij2K/ZiNin2LFcclxuICAgIGlmICghZGVjaXNpb24uYWxsb3dlZCkge1xyXG4gICAgICBjb25zdCBoYXNQZXJtaXNzaW9uID0gdGhpcy5yYmFjLmhhc1Blcm1pc3Npb24oXHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIGAke2FjdGlvbn06JHtyZXNvdXJjZX1gLFxyXG4gICAgICAgIGNvbnRleHRcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGlmIChoYXNQZXJtaXNzaW9uKSB7XHJcbiAgICAgICAgZGVjaXNpb24uYWxsb3dlZCA9IHRydWU7XHJcbiAgICAgICAgZGVjaXNpb24ucmVhc29uID0gJ1Blcm1pc3Npb24gZ3JhbnRlZCB2aWEgcm9sZS1iYXNlZCBhY2Nlc3MnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGRlY2lzaW9uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgICogNu+4j+KDoyBFWENFUFRJT04gTUFOQUdFTUVOVCAtINil2K/Yp9ix2Kkg2KfZhNin2LPYqtir2YbYp9ih2KfYqlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYpdi22KfZgdipINin2LPYqtir2YbYp9ihINmF2KTZgtiqXHJcbiAgICovXHJcbiAgYWRkVGVtcG9yYXJ5RXhjZXB0aW9uKGV4Y2VwdGlvbklkLCBleGNlcHRpb25Db25maWcgPSB7fSkge1xyXG4gICAgY29uc3QgZXhjZXB0aW9uID0ge1xyXG4gICAgICBpZDogZXhjZXB0aW9uSWQsXHJcbiAgICAgIHVzZXJJZDogZXhjZXB0aW9uQ29uZmlnLnVzZXJJZCxcclxuICAgICAgYWN0aW9uOiBleGNlcHRpb25Db25maWcuYWN0aW9uLFxyXG4gICAgICByZXNvdXJjZTogZXhjZXB0aW9uQ29uZmlnLnJlc291cmNlLFxyXG4gICAgICBcclxuICAgICAgZWZmZWN0OiBleGNlcHRpb25Db25maWcuZWZmZWN0IHx8ICdBbGxvdycsXHJcbiAgICAgIGV4cGlyZXNBdDogZXhjZXB0aW9uQ29uZmlnLmV4cGlyZXNBdCB8fCBuZXcgRGF0ZShEYXRlLm5vdygpICsgODY0MDAwMDApLCAvLyAyNCBob3Vyc1xyXG4gICAgICBcclxuICAgICAgcmVhc29uOiBleGNlcHRpb25Db25maWcucmVhc29uLFxyXG4gICAgICBjcmVhdGVkQnk6IGV4Y2VwdGlvbkNvbmZpZy5jcmVhdGVkQnkgfHwgJ2FkbWluJyxcclxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghdGhpcy50ZW1wb3JhcnlFeGNlcHRpb25zKSB7XHJcbiAgICAgIHRoaXMudGVtcG9yYXJ5RXhjZXB0aW9ucyA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnRlbXBvcmFyeUV4Y2VwdGlvbnMuc2V0KGV4Y2VwdGlvbklkLCBleGNlcHRpb24pO1xyXG4gICAgXHJcbiAgICAvLyDYpdi52KfYr9ipINiq2LnZitmK2YYg2KfZhNin2LPYqtir2YbYp9ihINin2YTZhdmG2KrZh9mKINin2YTYtdmE2KfYrdmK2KlcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRlbXBvcmFyeUV4Y2VwdGlvbnMuZGVsZXRlKGV4Y2VwdGlvbklkKTtcclxuICAgIH0sIGV4Y2VwdGlvbkNvbmZpZy5leHBpcmVzQXQgLSBEYXRlLm5vdygpKTtcclxuXHJcbiAgICByZXR1cm4gZXhjZXB0aW9uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNin2LPYqtir2YbYp9ih2KfYqlxyXG4gICAqL1xyXG4gIF9jaGVja1RlbXBvcmFyeUV4Y2VwdGlvbnModXNlcklkLCBhY3Rpb24sIHJlc291cmNlKSB7XHJcbiAgICBpZiAoIXRoaXMudGVtcG9yYXJ5RXhjZXB0aW9ucykgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgZm9yIChjb25zdCBleGNlcHRpb24gb2YgdGhpcy50ZW1wb3JhcnlFeGNlcHRpb25zLnZhbHVlcygpKSB7XHJcbiAgICAgIGlmIChleGNlcHRpb24uZXhwaXJlc0F0IDwgbmV3IERhdGUoKSkgY29udGludWU7XHJcblxyXG4gICAgICBpZiAoZXhjZXB0aW9uLnVzZXJJZCA9PT0gdXNlcklkICYmXHJcbiAgICAgICAgICBleGNlcHRpb24uYWN0aW9uID09PSBhY3Rpb24gJiZcclxuICAgICAgICAgIGV4Y2VwdGlvbi5yZXNvdXJjZSA9PT0gcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gZXhjZXB0aW9uO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICAgKiBQUklWQVRFIE1FVEhPRFMgLSDYp9mE2LfYsdmCINin2YTYrtin2LXYqVxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINin2YTYs9mK2KfYs9in2Kog2KfZhNmF2YbYt9io2YLYqVxyXG4gICAqL1xyXG4gIF9nZXRBcHBsaWNhYmxlUG9saWNpZXModXNlcklkLCBjb250ZXh0KSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBbGxQb2xpY2llcyh7IGFjdGl2ZTogdHJ1ZSB9KVxyXG4gICAgICAuZmlsdGVyKHBvbGljeSA9PiB7XHJcbiAgICAgICAgLy8g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhti32KjYp9mCINin2YTZhdio2K/Yo1xyXG4gICAgICAgIGlmICghdGhpcy5fbWF0Y2hQcmluY2lwYWwocG9saWN5LnByaW5jaXBhbCwgdXNlcklkLCBjb250ZXh0KSkge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNil2KzYsdin2KEg2YjYp9mE2YXZiNix2K9cclxuICAgICAgICBpZiAoY29udGV4dC5hY3Rpb24gJiYgIXRoaXMuX21hdGNoQWN0aW9uKHBvbGljeS5hY3Rpb24sIGNvbnRleHQuYWN0aW9uKSkge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNvbnRleHQucmVzb3VyY2UgJiYgIXRoaXMuX21hdGNoUmVzb3VyY2UocG9saWN5LnJlc291cmNlLCBjb250ZXh0LnJlc291cmNlKSkge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KrZgtmK2YrZhSDYtNix2YjYtyDYp9mE2LPZitin2LPYqVxyXG4gICAqL1xyXG4gIF9ldmFsdWF0ZVBvbGljeUNvbmRpdGlvbnModXNlcklkLCBwb2xpY3ksIGNvbnRleHQpIHtcclxuICAgIGlmICghcG9saWN5LmNvbmRpdGlvbnMgfHwgT2JqZWN0LmtleXMocG9saWN5LmNvbmRpdGlvbnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTsgLy8g2YTYpyDYqtmI2KzYryDYtNix2YjYtyA9INmF2YjYp9mB2YLYqSDYqtmE2YLYp9im2YrYqVxyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHBvbGljeS5jb25kaXRpb25zKSkge1xyXG4gICAgICBjb25zdCBjb250ZXh0VmFsdWUgPSBjb250ZXh0W2tleV07XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIXRoaXMuX21hdGNoQ29uZGl0aW9uVmFsdWUoY29udGV4dFZhbHVlLCB2YWx1ZSkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiq2YLZitmK2YUg2LTYsdi3INmI2KfYrdivXHJcbiAgICovXHJcbiAgX2V2YWx1YXRlQ29uZGl0aW9uKGNvbmRpdGlvbiwgY29udGV4dCkge1xyXG4gICAgaWYgKHR5cGVvZiBjb25kaXRpb24gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgcmV0dXJuIGNvbmRpdGlvbihjb250ZXh0KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gJ29iamVjdCcgJiYgY29uZGl0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IHsgZmllbGQsIG9wZXJhdG9yLCB2YWx1ZSB9ID0gY29uZGl0aW9uO1xyXG4gICAgICBjb25zdCBjb250ZXh0VmFsdWUgPSBjb250ZXh0W2ZpZWxkXTtcclxuXHJcbiAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHtcclxuICAgICAgICBjYXNlICdlcXVhbHMnOlxyXG4gICAgICAgICAgcmV0dXJuIGNvbnRleHRWYWx1ZSA9PT0gdmFsdWU7XHJcbiAgICAgICAgY2FzZSAnbm90X2VxdWFscyc6XHJcbiAgICAgICAgICByZXR1cm4gY29udGV4dFZhbHVlICE9PSB2YWx1ZTtcclxuICAgICAgICBjYXNlICdncmVhdGVyX3RoYW4nOlxyXG4gICAgICAgICAgcmV0dXJuIGNvbnRleHRWYWx1ZSA+IHZhbHVlO1xyXG4gICAgICAgIGNhc2UgJ2xlc3NfdGhhbic6XHJcbiAgICAgICAgICByZXR1cm4gY29udGV4dFZhbHVlIDwgdmFsdWU7XHJcbiAgICAgICAgY2FzZSAnaW4nOlxyXG4gICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmluY2x1ZGVzKGNvbnRleHRWYWx1ZSk7XHJcbiAgICAgICAgY2FzZSAnY29udGFpbnMnOlxyXG4gICAgICAgICAgcmV0dXJuIFN0cmluZyhjb250ZXh0VmFsdWUpLmluY2x1ZGVzKFN0cmluZyh2YWx1ZSkpO1xyXG4gICAgICAgIGNhc2UgJ3N0YXJ0c193aXRoJzpcclxuICAgICAgICAgIHJldHVybiBTdHJpbmcoY29udGV4dFZhbHVlKS5zdGFydHNXaXRoKFN0cmluZyh2YWx1ZSkpO1xyXG4gICAgICAgIGNhc2UgJ2VuZHNfd2l0aCc6XHJcbiAgICAgICAgICByZXR1cm4gU3RyaW5nKGNvbnRleHRWYWx1ZSkuZW5kc1dpdGgoU3RyaW5nKHZhbHVlKSk7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINmF2LfYp9io2YLYqSDYp9mE2YXYqNiv2KNcclxuICAgKi9cclxuICBfbWF0Y2hQcmluY2lwYWwocG9saWNpYVByaW5jaXBhbCwgdXNlcklkLCBjb250ZXh0ID0ge30pIHtcclxuICAgIGlmICghcG9saWNpYVByaW5jaXBhbCkgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgaWYgKHBvbGljaWFQcmluY2lwYWwudXNlcklkICYmIHBvbGljaWFQcmluY2lwYWwudXNlcklkICE9PSB1c2VySWQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwb2xpY2lhUHJpbmNpcGFsLnJvbGUpIHtcclxuICAgICAgY29uc3QgdXNlclJvbGVzID0gdGhpcy5yYmFjLmdldFVzZXJSb2xlcyh1c2VySWQpO1xyXG4gICAgICBjb25zdCBoYXNSb2xlID0gdXNlclJvbGVzLnNvbWUociA9PiByLnJvbGVJZCA9PT0gcG9saWNpYVByaW5jaXBhbC5yb2xlKTtcclxuICAgICAgaWYgKCFoYXNSb2xlKSByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHBvbGljaWFQcmluY2lwYWwuZGVwYXJ0bWVudCAmJiBjb250ZXh0LmRlcGFydG1lbnQgIT09IHBvbGljaWFQcmluY2lwYWwuZGVwYXJ0bWVudCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDZhdi32KfYqNmC2Kkg2KfZhNil2KzYsdin2KFcclxuICAgKi9cclxuICBfbWF0Y2hBY3Rpb24ocG9saWN5QWN0aW9ucywgY29udGV4dEFjdGlvbikge1xyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHBvbGljeUFjdGlvbnMpKSByZXR1cm4gZmFsc2U7XHJcbiAgICBpZiAocG9saWN5QWN0aW9ucy5pbmNsdWRlcygnKicpKSByZXR1cm4gdHJ1ZTtcclxuICAgIHJldHVybiBwb2xpY3lBY3Rpb25zLmluY2x1ZGVzKGNvbnRleHRBY3Rpb24pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2YXYt9in2KjZgtipINin2YTZhdmI2LHYr1xyXG4gICAqL1xyXG4gIF9tYXRjaFJlc291cmNlKHBvbGljeVJlc291cmNlcywgY29udGV4dFJlc291cmNlKSB7XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkocG9saWN5UmVzb3VyY2VzKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgaWYgKHBvbGljeVJlc291cmNlcy5pbmNsdWRlcygnKicpKSByZXR1cm4gdHJ1ZTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHBvbGljeVJlc291cmNlcy5zb21lKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMgPT09IGNvbnRleHRSZXNvdXJjZSkgcmV0dXJuIHRydWU7XHJcbiAgICAgIFxyXG4gICAgICAvLyDYr9i52YUgd2lsZGNhcmRzOiBcInVzZXJzLypcIiDYqti32KfYqNmCIFwidXNlcnMvMTIzXCJcclxuICAgICAgaWYgKHJlcy5lbmRzV2l0aCgnLyonKSkge1xyXG4gICAgICAgIGNvbnN0IHByZWZpeCA9IHJlcy5zbGljZSgwLCAtMik7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRleHRSZXNvdXJjZS5zdGFydHNXaXRoKHByZWZpeCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2YXYt9in2KjZgtipINmC2YrZhdipINin2YTYtNix2LdcclxuICAgKi9cclxuICBfbWF0Y2hDb25kaXRpb25WYWx1ZShhY3R1YWwsIGV4cGVjdGVkKSB7XHJcbiAgICBpZiAodHlwZW9mIGV4cGVjdGVkID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHJldHVybiBleHBlY3RlZChhY3R1YWwpO1xyXG4gICAgfVxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZXhwZWN0ZWQpKSB7XHJcbiAgICAgIHJldHVybiBleHBlY3RlZC5pbmNsdWRlcyhhY3R1YWwpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFjdHVhbCA9PT0gZXhwZWN0ZWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9iz2KrYqNiv2KfZhCDYp9mE2YXYqti62YrYsdin2Kog2YHZiiDYp9mE2YLYp9mE2KhcclxuICAgKi9cclxuICBfc3Vic3RpdHV0ZVZhcmlhYmxlcyh0ZW1wbGF0ZSwgdmFyaWFibGVzKSB7XHJcbiAgICBjb25zdCBzdWJzdGl0dXRlZCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGVtcGxhdGUpKTtcclxuXHJcbiAgICBjb25zdCBzdWJzdGl0dXRlID0gKG9iaikgPT4ge1xyXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcclxuICAgICAgICBpZiAodHlwZW9mIG9ialtrZXldID09PSAnc3RyaW5nJyAmJiBvYmpba2V5XS5zdGFydHNXaXRoKCd7eycpICYmIG9ialtrZXldLmVuZHNXaXRoKCd9fScpKSB7XHJcbiAgICAgICAgICBjb25zdCB2YXJOYW1lID0gb2JqW2tleV0uc2xpY2UoMiwgLTIpO1xyXG4gICAgICAgICAgb2JqW2tleV0gPSB2YXJpYWJsZXNbdmFyTmFtZV0gfHwgb2JqW2tleV07XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW2tleV0gPT09ICdvYmplY3QnICYmIG9ialtrZXldICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBzdWJzdGl0dXRlKG9ialtrZXldKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgc3Vic3RpdHV0ZShzdWJzdGl0dXRlZCk7XHJcbiAgICByZXR1cm4gc3Vic3RpdHV0ZWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtmI2YTZitivINiz2KjYqCDYp9mE2YLYsdin2LFcclxuICAgKi9cclxuICBfZ2VuZXJhdGVEZWNpc2lvblJlYXNvbihwb2xpY3lSZXN1bHQpIHtcclxuICAgIGlmIChwb2xpY3lSZXN1bHQuZmluYWxEZWNpc2lvbiA9PT0gJ0FsbG93Jykge1xyXG4gICAgICByZXR1cm4gYEFjY2VzcyBhbGxvd2VkIGJ5IHBvbGljaWVzOiAke3BvbGljeVJlc3VsdC5wb2xpY2llc0FwcGxpZWQuam9pbignLCAnKX1gO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHBvbGljeVJlc3VsdC5kZW5pZWRQb2xpY2llcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcmV0dXJuIGBBY2Nlc3MgZGVuaWVkIGJ5IHBvbGljaWVzOiAke3BvbGljeVJlc3VsdC5kZW5pZWRQb2xpY2llcy5qb2luKCcsICcpfWA7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuICdObyBtYXRjaGluZyBwb2xpY2llcyB0byBhbGxvdyBhY2Nlc3MnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYs9is2YQg2KfZhNiz2YrYp9iz2KfYqlxyXG4gICAqL1xyXG4gIGdldFBvbGljeUhpc3RvcnkoZmlsdGVycyA9IHt9KSB7XHJcbiAgICBsZXQgaGlzdG9yeSA9IHRoaXMucG9saWN5SGlzdG9yeTtcclxuXHJcbiAgICBpZiAoZmlsdGVycy5wb2xpY3lJZCkge1xyXG4gICAgICBoaXN0b3J5ID0gaGlzdG9yeS5maWx0ZXIoaCA9PiBoLnBvbGljeUlkID09PSBmaWx0ZXJzLnBvbGljeUlkKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZmlsdGVycy5hY3Rpb24pIHtcclxuICAgICAgaGlzdG9yeSA9IGhpc3RvcnkuZmlsdGVyKGggPT4gaC5hY3Rpb24gPT09IGZpbHRlcnMuYWN0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZmlsdGVycy5saW1pdCkge1xyXG4gICAgICBoaXN0b3J5ID0gaGlzdG9yeS5zbGljZSgtZmlsdGVycy5saW1pdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGhpc3Rvcnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqti12K/ZitixINin2YTYs9mK2KfYs9in2KpcclxuICAgKi9cclxuICBleHBvcnRQb2xpY2llcygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHBvbGljaWVzOiBBcnJheS5mcm9tKHRoaXMucG9saWNpZXMudmFsdWVzKCkpLFxyXG4gICAgICB0ZW1wbGF0ZXM6IEFycmF5LmZyb20odGhpcy5wb2xpY3lUZW1wbGF0ZXMudmFsdWVzKCkpLFxyXG4gICAgICBydWxlczogQXJyYXkuZnJvbSh0aGlzLmNvbmRpdGlvbmFsUnVsZXMudmFsdWVzKCkpLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9iz2KrZitix2KfYryDYp9mE2LPZitin2LPYp9iqXHJcbiAgICovXHJcbiAgaW1wb3J0UG9saWNpZXMoZGF0YSkge1xyXG4gICAgaWYgKGRhdGEucG9saWNpZXMpIHtcclxuICAgICAgZGF0YS5wb2xpY2llcy5mb3JFYWNoKHBvbGljeSA9PiB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVQb2xpY3kocG9saWN5LmlkLCBwb2xpY3kpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGF0YS50ZW1wbGF0ZXMpIHtcclxuICAgICAgZGF0YS50ZW1wbGF0ZXMuZm9yRWFjaCh0ZW1wbGF0ZSA9PiB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVQb2xpY3lUZW1wbGF0ZSh0ZW1wbGF0ZS5pZCwgdGVtcGxhdGUpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGF0YS5ydWxlcykge1xyXG4gICAgICBkYXRhLnJ1bGVzLmZvckVhY2gocnVsZSA9PiB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVDb25kaXRpb25hbFJ1bGUocnVsZS5pZCwgcnVsZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBSQkFDUG9saWN5RW5naW5lO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTTtFQUFFQTtBQUFhLENBQUMsR0FBR0MsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQUUxQyxNQUFNQyxnQkFBZ0IsU0FBU0YsWUFBWSxDQUFDO0VBQzFDRyxXQUFXQSxDQUFDQyxVQUFVLEVBQUU7SUFDdEIsS0FBSyxDQUFDLENBQUM7SUFDUCxJQUFJLENBQUNDLElBQUksR0FBR0QsVUFBVTtJQUN0QixJQUFJLENBQUNFLFFBQVEsR0FBRyxJQUFJQyxHQUFHLENBQUMsQ0FBQztJQUN6QixJQUFJLENBQUNDLGFBQWEsR0FBRyxFQUFFO0lBQ3ZCLElBQUksQ0FBQ0MsZUFBZSxHQUFHLElBQUlGLEdBQUcsQ0FBQyxDQUFDO0lBQ2hDLElBQUksQ0FBQ0csZ0JBQWdCLEdBQUcsSUFBSUgsR0FBRyxDQUFDLENBQUM7RUFDbkM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7RUFFRTtBQUNGO0FBQ0E7RUFDRUksWUFBWUEsQ0FBQ0MsUUFBUSxFQUFFQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDeEMsSUFBSSxJQUFJLENBQUNQLFFBQVEsQ0FBQ1EsR0FBRyxDQUFDRixRQUFRLENBQUMsRUFBRTtNQUMvQixNQUFNLElBQUlHLEtBQUssQ0FBQyxVQUFVSCxRQUFRLGlCQUFpQixDQUFDO0lBQ3REO0lBRUEsTUFBTUksTUFBTSxHQUFHO01BQ2JDLEVBQUUsRUFBRUwsUUFBUTtNQUNaTSxJQUFJLEVBQUVMLFlBQVksQ0FBQ0ssSUFBSSxJQUFJTixRQUFRO01BQ25DTyxXQUFXLEVBQUVOLFlBQVksQ0FBQ00sV0FBVyxJQUFJLEVBQUU7TUFFM0M7TUFDQUMsU0FBUyxFQUFFUCxZQUFZLENBQUNPLFNB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QUM7SUFDNUQ7SUFFQSxJQUFJc0ksT0FBTyxDQUFDRyxLQUFLLEVBQUU7TUFDakJGLE9BQU8sR0FBR0EsT0FBTyxDQUFDYixLQUFLLENBQUMsQ0FBQ1ksT0FBTyxDQUFDRyxLQUFLLENBQUM7SUFDekM7SUFFQSxPQUFPRixPQUFPO0VBQ2hCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFRyxjQUFjQSxDQUFBLEVBQUc7SUFDZixPQUFPO01BQ0x6SixRQUFRLEVBQUU2QyxLQUFLLENBQUNDLElBQUksQ0FBQyxJQUFJLENBQUM5QyxRQUFRLENBQUMrQyxNQUFNLENBQUMsQ0FBQyxDQUFDO01BQzVDMkcsU0FBUyxFQUFFN0csS0FBSyxDQUFDQyxJQUFJLENBQUMsSUFBSSxDQUFDM0MsZUFBZSxDQUFDNEMsTUFBTSxDQUFDLENBQUMsQ0FBQztNQUNwRDRHLEtBQUssRUFBRTlHLEtBQUssQ0FBQ0MsSUFBSSxDQUFDLElBQUksQ0FBQzFDLGdCQUFnQixDQUFDMkMsTUFBTSxDQUFDLENBQUMsQ0FBQztNQUNqRGxCLFNBQVMsRUFBRSxJQUFJTixJQUFJLENBQUM7SUFDdEIsQ0FBQztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtFQUNFcUksY0FBY0EsQ0FBQzlILElBQUksRUFBRTtJQUNuQixJQUFJQSxJQUFJLENBQUM5QixRQUFRLEVBQUU7TUFDakI4QixJQUFJLENBQUM5QixRQUFRLENBQUM2SixPQUFPLENBQUNuSixNQUFNLElBQUk7UUFDOUIsSUFBSSxDQUFDTCxZQUFZLENBQUNLLE1BQU0sQ0FBQ0MsRUFBRSxFQUFFRCxNQUFNLENBQUM7TUFDdEMsQ0FBQyxDQUFDO0lBQ0o7SUFFQSxJQUFJb0IsSUFBSSxDQUFDNEgsU0FBUyxFQUFFO01BQ2xCNUgsSUFBSSxDQUFDNEgsU0FBUyxDQUFDRyxPQUFPLENBQUN0RSxRQUFRLElBQUk7UUFDakMsSUFBSSxDQUFDRixvQkFBb0IsQ0FBQ0UsUUFBUSxDQUFDNUUsRUFBRSxFQUFFNEUsUUFBUSxDQUFDO01BQ2xELENBQUMsQ0FBQztJQUNKO0lBRUEsSUFBSXpELElBQUksQ0FBQzZILEtBQUssRUFBRTtNQUNkN0gsSUFBSSxDQUFDNkgsS0FBSyxDQUFDRSxPQUFPLENBQUNsRixJQUFJLElBQUk7UUFDekIsSUFBSSxDQUFDSCxxQkFBcUIsQ0FBQ0csSUFBSSxDQUFDaEUsRUFBRSxFQUFFZ0UsSUFBSSxDQUFDO01BQzNDLENBQUMsQ0FBQztJQUNKO0VBQ0Y7QUFDRjtBQUVBbUYsTUFBTSxDQUFDQyxPQUFPLEdBQUduSyxnQkFBZ0IiLCJpZ25vcmVMaXN0IjpbXX0=