{"version":3,"names":["axios","require","EventEmitter","Logger","crypto","MOIPassportService","constructor","config","apiBaseUrl","process","env","JAWAZAT_API_BASE_URL","apiKey","JAWAZAT_API_KEY","apiSecret","JAWAZAT_API_SECRET","webhookUrl","JAWAZAT_WEBHOOK_URL","timeout","parseInt","JAWAZAT_TIMEOUT","retryAttempts","JAWAZAT_RETRY_ATTEMPTS","retryDelay","JAWAZAT_RETRY_DELAY","maxCacheSize","PASSPORT_CACHE_SIZE","cacheTTL","PASSPORT_CACHE_TTL","enableEncryption","PASSPORT_ENABLE_ENCRYPTION","cache","Map","requestQueue","metrics","totalRequests","successfulRequests","failedRequests","totalCacheHits","averageResponseTime","requestTimes","errorLog","auditLog","rateLimiter","requestMetrics","validationRules","passport","minLength","maxLength","pattern","nationalId","iqama","visaNumber","_initializeMetrics","info","metricsInterval","setInterval","length","sum","reduce","a","b","Math","round","slice","_checkRateLimit","userId","key","now","Date","windowStart","has","set","requests","get","recentRequests","filter","time","Error","push","_validateInput","data","type","rules","stringData","String","trim","test","_generateCacheKey","endpoint","params","paramsStr","JSON","stringify","createHash","update","digest","_getFromCache","cached","expiresAt","emit","delete","_setCache","ttl","size","firstKey","keys","next","value","createdAt","clearCache","clear","success","message","cleared","includes","_encryptData","iv","randomBytes","cipher","createCipheriv","Buffer","from","encrypted","final","toString","error","_decryptData","encryptedData","decipher","createDecipheriv","decrypted","parse","_makeRequest","method","options","startTime","lastError","attempt","url","headers","randomUUID","response","responsetime","statusCode","status","responseTime","delay","pow","_sleep","errorInfo","timestamp","retries","ms","Promise","resolve","setTimeout","verifyPassport","passportNumber","validatedPassport","cacheKey","cachedResult","source","result","fullNameArabic","fullNameAr","fullNameEnglish","fullNameEn","nationality","dateOfBirth","gender","issueDate","expiryDate","issuingAuthority","verificationDate","_addAuditLog","verifyNationalId","validatedId","birthDate","verifyIqama","iqamaNumber","validatedIqama","sponsorName","sponsorNumber","sponsorNationality","occupationCode","occupationName","requestExitReentryVisa","visaType","duration","requestDate","requestId","createdDate","estimatedCollectionDate","getTravelerProfile","profile","personalInfo","documentInfo","passportExpiry","iqamaExpiry","travelHistory","currentVisa","exitBans","flaggedStatus","flagged","getMetrics","successRate","toFixed","cacheSize","cacheUtilization","errorLogSize","auditLogSize","action","details","entry","id","ipAddress","getAuditLog","filters","logs","l","startDate","endDate","max","limit","healthCheck","apiResponse","destroy","clearInterval","removeAllListeners","module","exports"],"sources":["moi-passport.service.js"],"sourcesContent":["/**\r\n * MOI Passport Integration Service - ÿÆÿØŸÖÿ© ÿ™ŸÉÿßŸÖŸÑ ÿßŸÑÿ¨Ÿàÿßÿ≤ÿßÿ™\r\n * Advanced, Professional & Comprehensive Passport Integration System\r\n * Version: 3.0.0\r\n * Last Updated: February 2026\r\n * Status: Production Ready\r\n */\r\n\r\nconst axios = require('axios');\r\nconst EventEmitter = require('events');\r\nconst Logger = require('../utils/logger');\r\nconst crypto = require('crypto');\r\n\r\nclass MOIPassportService extends EventEmitter {\r\n  constructor(config = {}) {\r\n    super();\r\n    \r\n    // Configuration\r\n    this.config = {\r\n      apiBaseUrl: process.env.JAWAZAT_API_BASE_URL || 'https://api.gdp.gov.sa/v1',\r\n      apiKey: process.env.JAWAZAT_API_KEY,\r\n      apiSecret: process.env.JAWAZAT_API_SECRET,\r\n      webhookUrl: process.env.JAWAZAT_WEBHOOK_URL,\r\n      timeout: parseInt(process.env.JAWAZAT_TIMEOUT || '30000'),\r\n      retryAttempts: parseInt(process.env.JAWAZAT_RETRY_ATTEMPTS || '3'),\r\n      retryDelay: parseInt(process.env.JAWAZAT_RETRY_DELAY || '1000'),\r\n      maxCacheSize: parseInt(process.env.PASSPORT_CACHE_SIZE || '10000'),\r\n      cacheTTL: parseInt(process.env.PASSPORT_CACHE_TTL || '3600000'), // 1 hour\r\n      enableEncryption: process.env.PASSPORT_ENABLE_ENCRYPTION === 'true',\r\n      ...config,\r\n    };\r\n\r\n    // Data storage\r\n    this.cache = new Map();\r\n    this.requestQueue = [];\r\n    this.metrics = {\r\n      totalRequests: 0,\r\n      successfulRequests: 0,\r\n      failedRequests: 0,\r\n      totalCacheHits: 0,\r\n      averageResponseTime: 0,\r\n      requestTimes: [],\r\n    };\r\n    this.errorLog = [];\r\n    this.auditLog = [];\r\n    \r\n    // Rate limiting\r\n    this.rateLimiter = new Map();\r\n    this.requestMetrics = new Map();\r\n\r\n    // Validation rules\r\n    this.validationRules = {\r\n      passport: {\r\n        minLength: 6,\r\n        maxLength: 10,\r\n        pattern: /^[A-Z0-9]+$/,\r\n      },\r\n      nationalId: {\r\n        minLength: 10,\r\n        maxLength: 10,\r\n        pattern: /^[0-9]{10}$/,\r\n      },\r\n      iqama: {\r\n        minLength: 10,\r\n        maxLength: 10,\r\n        pattern: /^[0-9]{10}$/,\r\n      },\r\n      visaNumber: {\r\n        minLength: 10,\r\n        maxLength: 15,\r\n        pattern: /^[0-9]+$/,\r\n      },\r\n    };\r\n\r\n    this._initializeMetrics();\r\n    Logger.info('‚úÖ MOI Passport Service initialized successfully');\r\n  }\r\n\r\n  /**\r\n   * Initialize metrics\r\n   */\r\n  _initializeMetrics() {\r\n    this.metricsInterval = setInterval(() => {\r\n      if (this.metrics.requestTimes.length > 0) {\r\n        const sum = this.metrics.requestTimes.reduce((a, b) => a + b, 0);\r\n        this.metrics.averageResponseTime = Math.round(sum / this.metrics.requestTimes.length);\r\n        // Keep only last 1000 measurements\r\n        if (this.metrics.requestTimes.length > 1000) {\r\n          this.metrics.requestTimes = this.metrics.requestTimes.slice(-1000);\r\n        }\r\n      }\r\n    }, 60000); // Update every minute\r\n  }\r\n\r\n  /**\r\n   * Apply rate limiting\r\n   */\r\n  _checkRateLimit(userId) {\r\n    const key = `ratelimit:${userId}`;\r\n    const now = Date.now();\r\n    const windowStart = now - 3600000; // 1 hour window\r\n\r\n    if (!this.rateLimiter.has(key)) {\r\n      this.rateLimiter.set(key, []);\r\n    }\r\n\r\n    const requests = this.rateLimiter.get(key);\r\n    const recentRequests = requests.filter((time) => time > windowStart);\r\n\r\n    // 100 requests per hour per user\r\n    if (recentRequests.length >= 100) {\r\n      throw new Error('Rate limit exceeded: Maximum 100 requests per hour');\r\n    }\r\n\r\n    recentRequests.push(now);\r\n    this.rateLimiter.set(key, recentRequests);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Validate input data\r\n   */\r\n  _validateInput(data, type) {\r\n    if (!data) {\r\n      throw new Error(`${type} is required`);\r\n    }\r\n\r\n    const rules = this.validationRules[type];\r\n    if (!rules) {\r\n      throw new Error(`Unknown validation type: ${type}`);\r\n    }\r\n\r\n    const stringData = String(data).trim();\r\n\r\n    if (stringData.length < rules.minLength || stringData.length > rules.maxLength) {\r\n      throw new Error(\r\n        `${type} must be between ${rules.minLength} and ${rules.maxLength} characters`\r\n      );\r\n    }\r\n\r\n    if (!rules.pattern.test(stringData)) {\r\n      throw new Error(`${type} format is invalid`);\r\n    }\r\n\r\n    return stringData;\r\n  }\r\n\r\n  /**\r\n   * Generate cache key\r\n   */\r\n  _generateCacheKey(endpoint, params) {\r\n    const paramsStr = JSON.stringify(params);\r\n    return crypto\r\n      .createHash('md5')\r\n      .update(`${endpoint}:${paramsStr}`)\r\n      .digest('hex');\r\n  }\r\n\r\n  /**\r\n   * Get from cache\r\n   */\r\n  _getFromCache(key) {\r\n    const cached = this.cache.get(key);\r\n    if (cached && cached.expiresAt > Date.now()) {\r\n      this.metrics.totalCacheHits++;\r\n      this.emit('cache:hit', { key });\r\n      return cached.data;\r\n    }\r\n\r\n    if (cached && cached.expiresAt <= Date.now()) {\r\n      this.cache.delete(key);\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Set cache with expiration\r\n   */\r\n  _setCache(key, data, ttl = null) {\r\n    if (this.cache.size >= this.config.maxCacheSize) {\r\n      // Remove oldest item\r\n      const firstKey = this.cache.keys().next().value;\r\n      this.cache.delete(firstKey);\r\n    }\r\n\r\n    const expiresAt = Date.now() + (ttl || this.config.cacheTTL);\r\n    this.cache.set(key, { data, expiresAt, createdAt: Date.now() });\r\n    this.emit('cache:set', { key, ttl });\r\n  }\r\n\r\n  /**\r\n   * Clear cache\r\n   */\r\n  clearCache(pattern = null) {\r\n    if (!pattern) {\r\n      this.cache.clear();\r\n      Logger.info('Cache cleared completely');\r\n      return { success: true, message: 'Cache cleared' };\r\n    }\r\n\r\n    let cleared = 0;\r\n    for (const [key] of this.cache) {\r\n      if (key.includes(pattern)) {\r\n        this.cache.delete(key);\r\n        cleared++;\r\n      }\r\n    }\r\n\r\n    Logger.info(`Cache cleared: ${cleared} items removed`);\r\n    return { success: true, cleared };\r\n  }\r\n\r\n  /**\r\n   * Encrypt sensitive data\r\n   */\r\n  _encryptData(data) {\r\n    if (!this.config.enableEncryption) return data;\r\n\r\n    try {\r\n      const iv = crypto.randomBytes(16);\r\n      const cipher = crypto.createCipheriv(\r\n        'aes-256-cbc',\r\n        Buffer.from(this.config.apiSecret || 'default-secret', 'utf-8').slice(0, 32),\r\n        iv\r\n      );\r\n\r\n      let encrypted = cipher.update(JSON.stringify(data), 'utf-8', 'hex');\r\n      encrypted += cipher.final('hex');\r\n\r\n      return {\r\n        encrypted: true,\r\n        data: encrypted,\r\n        iv: iv.toString('hex'),\r\n      };\r\n    } catch (error) {\r\n      Logger.error('Data encryption failed:', error);\r\n      return data;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Decrypt sensitive data\r\n   */\r\n  _decryptData(encryptedData) {\r\n    if (!this.config.enableEncryption || !encryptedData.encrypted) {\r\n      return encryptedData;\r\n    }\r\n\r\n    try {\r\n      const decipher = crypto.createDecipheriv(\r\n        'aes-256-cbc',\r\n        Buffer.from(this.config.apiSecret || 'default-secret', 'utf-8').slice(0, 32),\r\n        Buffer.from(encryptedData.iv, 'hex')\r\n      );\r\n\r\n      let decrypted = decipher.update(encryptedData.data, 'hex', 'utf-8');\r\n      decrypted += decipher.final('utf-8');\r\n\r\n      return JSON.parse(decrypted);\r\n    } catch (error) {\r\n      Logger.error('Data decryption failed:', error);\r\n      return encryptedData;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Make API request with retry logic\r\n   */\r\n  async _makeRequest(endpoint, method = 'GET', data = null, options = {}) {\r\n    const startTime = Date.now();\r\n    let lastError = null;\r\n\r\n    for (let attempt = 0; attempt < this.config.retryAttempts; attempt++) {\r\n      try {\r\n        const url = `${this.config.apiBaseUrl}${endpoint}`;\r\n        const headers = {\r\n          'Content-Type': 'application/json',\r\n          'X-API-Key': this.config.apiKey,\r\n          'X-Request-ID': crypto.randomUUID(),\r\n          'User-Agent': 'MOI-Passport-Service/3.0.0',\r\n          ...options.headers,\r\n        };\r\n\r\n        const config = {\r\n          method,\r\n          url,\r\n          headers,\r\n          timeout: this.config.timeout,\r\n        };\r\n\r\n        if (data) {\r\n          config.data = data;\r\n        }\r\n\r\n        const response = await axios(config);\r\n        const responsetime = Date.now() - startTime;\r\n\r\n        // Log metrics\r\n        this.metrics.requestTimes.push(responsetime);\r\n        this.metrics.totalRequests++;\r\n        this.metrics.successfulRequests++;\r\n\r\n        this.emit('request:success', {\r\n          endpoint,\r\n          statusCode: response.status,\r\n          responseTime: responsetime,\r\n        });\r\n\r\n        return response.data;\r\n      } catch (error) {\r\n        lastError = error;\r\n\r\n        if (attempt < this.config.retryAttempts - 1) {\r\n          // Exponential backoff\r\n          const delay = this.config.retryDelay * Math.pow(2, attempt);\r\n          await this._sleep(delay);\r\n        }\r\n      }\r\n    }\r\n\r\n    // All retries failed\r\n    this.metrics.failedRequests++;\r\n    this.metrics.totalRequests++;\r\n\r\n    const errorInfo = {\r\n      endpoint,\r\n      error: lastError?.message,\r\n      timestamp: new Date(),\r\n      retries: this.config.retryAttempts,\r\n    };\r\n\r\n    this.errorLog.push(errorInfo);\r\n    this.emit('request:failure', errorInfo);\r\n\r\n    throw lastError;\r\n  }\r\n\r\n  /**\r\n   * Sleep utility\r\n   */\r\n  _sleep(ms) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  /**\r\n   * üîç Verify Passport Number\r\n   */\r\n  async verifyPassport(passportNumber, userId) {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      // Validate input\r\n      const validatedPassport = this._validateInput(passportNumber, 'passport');\r\n      this._checkRateLimit(userId);\r\n\r\n      // Check cache\r\n      const cacheKey = this._generateCacheKey('verify-passport', { passportNumber });\r\n      const cachedResult = this._getFromCache(cacheKey);\r\n\r\n      if (cachedResult) {\r\n        return {\r\n          success: true,\r\n          data: cachedResult,\r\n          source: 'cache',\r\n          responseTime: Date.now() - startTime,\r\n        };\r\n      }\r\n\r\n      // Make API request\r\n      const response = await this._makeRequest('/passports/verify', 'POST', {\r\n        passportNumber: validatedPassport,\r\n      });\r\n\r\n      // Validate response\r\n      if (!response || !response.data) {\r\n        throw new Error('Invalid API response format');\r\n      }\r\n\r\n      const result = {\r\n        passportNumber: response.data.passportNumber,\r\n        fullNameArabic: response.data.fullNameAr,\r\n        fullNameEnglish: response.data.fullNameEn,\r\n        nationality: response.data.nationality,\r\n        dateOfBirth: response.data.dateOfBirth,\r\n        gender: response.data.gender,\r\n        issueDate: response.data.issueDate,\r\n        expiryDate: response.data.expiryDate,\r\n        status: response.data.status, // valid, expired, lost, cancelled\r\n        issuingAuthority: 'General Directorate of Passports',\r\n        verificationDate: new Date(),\r\n      };\r\n\r\n      // Cache the result\r\n      this._setCache(cacheKey, result);\r\n\r\n      // Log audit trail\r\n      this._addAuditLog('PASSPORT_VERIFY', userId, {\r\n        passportNumber: validatedPassport,\r\n        status: 'success',\r\n      });\r\n\r\n      this.emit('passport:verified', result);\r\n\r\n      return {\r\n        success: true,\r\n        data: result,\r\n        source: 'api',\r\n        responseTime: Date.now() - startTime,\r\n      };\r\n    } catch (error) {\r\n      this._addAuditLog('PASSPORT_VERIFY', userId, {\r\n        passportNumber,\r\n        status: 'failed',\r\n        error: error.message,\r\n      });\r\n\r\n      Logger.error('Passport verification failed:', error);\r\n      throw {\r\n        success: false,\r\n        error: error.message,\r\n        type: 'PASSPORT_VERIFICATION_ERROR',\r\n        timestamp: new Date(),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üÜî Verify National ID\r\n   */\r\n  async verifyNationalId(nationalId, userId) {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const validatedId = this._validateInput(nationalId, 'nationalId');\r\n      this._checkRateLimit(userId);\r\n\r\n      const cacheKey = this._generateCacheKey('verify-national-id', { nationalId });\r\n      const cachedResult = this._getFromCache(cacheKey);\r\n\r\n      if (cachedResult) {\r\n        return {\r\n          success: true,\r\n          data: cachedResult,\r\n          source: 'cache',\r\n          responseTime: Date.now() - startTime,\r\n        };\r\n      }\r\n\r\n      const response = await this._makeRequest('/national-ids/verify', 'POST', {\r\n        nationalId: validatedId,\r\n      });\r\n\r\n      const result = {\r\n        nationalId: response.data.nationalId,\r\n        fullNameArabic: response.data.fullNameAr,\r\n        fullNameEnglish: response.data.fullNameEn,\r\n        birthDate: response.data.birthDate,\r\n        gender: response.data.gender,\r\n        nationality: 'Saudi Arabia',\r\n        issueDate: response.data.issueDate,\r\n        expiryDate: response.data.expiryDate,\r\n        status: response.data.status,\r\n        verificationDate: new Date(),\r\n      };\r\n\r\n      this._setCache(cacheKey, result);\r\n\r\n      this._addAuditLog('NATIONAL_ID_VERIFY', userId, {\r\n        nationalId: validatedId,\r\n        status: 'success',\r\n      });\r\n\r\n      this.emit('national-id:verified', result);\r\n\r\n      return {\r\n        success: true,\r\n        data: result,\r\n        source: 'api',\r\n        responseTime: Date.now() - startTime,\r\n      };\r\n    } catch (error) {\r\n      this._addAuditLog('NATIONAL_ID_VERIFY', userId, {\r\n        nationalId,\r\n        status: 'failed',\r\n        error: error.message,\r\n      });\r\n\r\n      Logger.error('National ID verification failed:', error);\r\n      throw {\r\n        success: false,\r\n        error: error.message,\r\n        type: 'NATIONAL_ID_VERIFICATION_ERROR',\r\n        timestamp: new Date(),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üè† Verify Iqama (Residency)\r\n   */\r\n  async verifyIqama(iqamaNumber, userId) {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const validatedIqama = this._validateInput(iqamaNumber, 'iqama');\r\n      this._checkRateLimit(userId);\r\n\r\n      const cacheKey = this._generateCacheKey('verify-iqama', { iqamaNumber });\r\n      const cachedResult = this._getFromCache(cacheKey);\r\n\r\n      if (cachedResult) {\r\n        return {\r\n          success: true,\r\n          data: cachedResult,\r\n          source: 'cache',\r\n          responseTime: Date.now() - startTime,\r\n        };\r\n      }\r\n\r\n      const response = await this._makeRequest('/iqamas/verify', 'POST', {\r\n        iqamaNumber: validatedIqama,\r\n      });\r\n\r\n      const result = {\r\n        iqamaNumber: response.data.iqamaNumber,\r\n        fullNameArabic: response.data.fullNameAr,\r\n        fullNameEnglish: response.data.fullNameEn,\r\n        nationality: response.data.nationality,\r\n        dateOfBirth: response.data.birthDate,\r\n        sponsorName: response.data.sponsorName,\r\n        sponsorNumber: response.data.sponsorNumber,\r\n        sponsorNationality: response.data.sponsorNationality,\r\n        issueDate: response.data.issueDate,\r\n        expiryDate: response.data.expiryDate,\r\n        status: response.data.status, // valid, expired, cancelled, revoked\r\n        occupationCode: response.data.occupationCode,\r\n        occupationName: response.data.occupationName,\r\n        verificationDate: new Date(),\r\n      };\r\n\r\n      this._setCache(cacheKey, result);\r\n\r\n      this._addAuditLog('IQAMA_VERIFY', userId, {\r\n        iqamaNumber: validatedIqama,\r\n        status: 'success',\r\n      });\r\n\r\n      this.emit('iqama:verified', result);\r\n\r\n      return {\r\n        success: true,\r\n        data: result,\r\n        source: 'api',\r\n        responseTime: Date.now() - startTime,\r\n      };\r\n    } catch (error) {\r\n      this._addAuditLog('IQAMA_VERIFY', userId, {\r\n        iqamaNumber,\r\n        status: 'failed',\r\n        error: error.message,\r\n      });\r\n\r\n      Logger.error('Iqama verification failed:', error);\r\n      throw {\r\n        success: false,\r\n        error: error.message,\r\n        type: 'IQAMA_VERIFICATION_ERROR',\r\n        timestamp: new Date(),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üìã Request Exit/Re-entry Visa\r\n   */\r\n  async requestExitReentryVisa(iqamaNumber, visaType = 'multiple', duration = 90, userId) {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const validatedIqama = this._validateInput(iqamaNumber, 'iqama');\r\n      this._checkRateLimit(userId);\r\n\r\n      if (!['single', 'multiple'].includes(visaType)) {\r\n        throw new Error('Visa type must be \"single\" or \"multiple\"');\r\n      }\r\n\r\n      if (duration < 1 || duration > 365) {\r\n        throw new Error('Duration must be between 1 and 365 days');\r\n      }\r\n\r\n      const response = await this._makeRequest('/exit-reentry/request', 'POST', {\r\n        iqamaNumber: validatedIqama,\r\n        visaType,\r\n        duration,\r\n        requestDate: new Date(),\r\n      });\r\n\r\n      const result = {\r\n        requestId: response.data.requestId,\r\n        iqamaNumber: validatedIqama,\r\n        visaType,\r\n        duration,\r\n        status: 'pending', // pending, approved, rejected, collected\r\n        expiryDate: new Date(Date.now() + duration * 86400000),\r\n        createdDate: new Date(),\r\n        estimatedCollectionDate: new Date(Date.now() + 2 * 86400000),\r\n      };\r\n\r\n      this._addAuditLog('EXIT_REENTRY_REQUEST', userId, {\r\n        iqamaNumber: validatedIqama,\r\n        requestId: result.requestId,\r\n        status: 'success',\r\n      });\r\n\r\n      this.emit('exit-reentry:requested', result);\r\n\r\n      return {\r\n        success: true,\r\n        data: result,\r\n        responseTime: Date.now() - startTime,\r\n      };\r\n    } catch (error) {\r\n      this._addAuditLog('EXIT_REENTRY_REQUEST', userId, {\r\n        iqamaNumber,\r\n        status: 'failed',\r\n        error: error.message,\r\n      });\r\n\r\n      Logger.error('Exit/Re-entry request failed:', error);\r\n      throw {\r\n        success: false,\r\n        error: error.message,\r\n        type: 'EXIT_REENTRY_REQUEST_ERROR',\r\n        timestamp: new Date(),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üë§ Get Complete Traveler Profile\r\n   */\r\n  async getTravelerProfile(iqamaNumber, userId) {\r\n    try {\r\n      const validatedIqama = this._validateInput(iqamaNumber, 'iqama');\r\n      this._checkRateLimit(userId);\r\n\r\n      const cacheKey = this._generateCacheKey('traveler-profile', { iqamaNumber });\r\n      const cachedResult = this._getFromCache(cacheKey);\r\n\r\n      if (cachedResult) {\r\n        return {\r\n          success: true,\r\n          data: cachedResult,\r\n          source: 'cache',\r\n        };\r\n      }\r\n\r\n      const response = await this._makeRequest(`/travelers/${validatedIqama}`, 'GET');\r\n\r\n      const profile = {\r\n        iqamaNumber: response.data.iqamaNumber,\r\n        personalInfo: {\r\n          fullNameAr: response.data.fullNameAr,\r\n          fullNameEn: response.data.fullNameEn,\r\n          dateOfBirth: response.data.dateOfBirth,\r\n          gender: response.data.gender,\r\n          nationality: response.data.nationality,\r\n        },\r\n        documentInfo: {\r\n          passport: response.data.passportNumber,\r\n          passportExpiry: response.data.passportExpiry,\r\n          iqama: response.data.iqamaNumber,\r\n          iqamaExpiry: response.data.iqamaExpiry,\r\n          nationalId: response.data.nationalId,\r\n        },\r\n        travelHistory: response.data.travelHistory || [],\r\n        currentVisa: response.data.currentVisa || null,\r\n        exitBans: response.data.exitBans || [],\r\n        flaggedStatus: response.data.flagged || false,\r\n      };\r\n\r\n      this._setCache(cacheKey, profile, this.config.cacheTTL * 2);\r\n      this._addAuditLog('GET_TRAVELER_PROFILE', userId, { iqamaNumber: validatedIqama });\r\n\r\n      return {\r\n        success: true,\r\n        data: profile,\r\n      };\r\n    } catch (error) {\r\n      Logger.error('Failed to get traveler profile:', error);\r\n      throw {\r\n        success: false,\r\n        error: error.message,\r\n        type: 'TRAVELER_PROFILE_ERROR',\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üìä Get Service Metrics\r\n   */\r\n  getMetrics() {\r\n    return {\r\n      totalRequests: this.metrics.totalRequests,\r\n      successfulRequests: this.metrics.successfulRequests,\r\n      failedRequests: this.metrics.failedRequests,\r\n      successRate: this.metrics.totalRequests > 0 \r\n        ? ((this.metrics.successfulRequests / this.metrics.totalRequests) * 100).toFixed(2) + '%'\r\n        : '0%',\r\n      totalCacheHits: this.metrics.totalCacheHits,\r\n      cacheSize: this.cache.size,\r\n      maxCacheSize: this.config.maxCacheSize,\r\n      cacheUtilization: ((this.cache.size / this.config.maxCacheSize) * 100).toFixed(2) + '%',\r\n      averageResponseTime: this.metrics.averageResponseTime + 'ms',\r\n      errorLogSize: this.errorLog.length,\r\n      auditLogSize: this.auditLog.length,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * üìù Add audit log entry\r\n   */\r\n  _addAuditLog(action, userId, details) {\r\n    const entry = {\r\n      id: crypto.randomUUID(),\r\n      action,\r\n      userId,\r\n      details,\r\n      timestamp: new Date(),\r\n      ipAddress: details.ipAddress || 'unknown',\r\n    };\r\n\r\n    this.auditLog.push(entry);\r\n\r\n    // Keep only last 10000 logs\r\n    if (this.auditLog.length > 10000) {\r\n      this.auditLog = this.auditLog.slice(-10000);\r\n    }\r\n\r\n    this.emit('audit:logged', entry);\r\n  }\r\n\r\n  /**\r\n   * üìú Get audit log\r\n   */\r\n  getAuditLog(filters = {}) {\r\n    let logs = this.auditLog;\r\n\r\n    if (filters.action) {\r\n      logs = logs.filter((l) => l.action === filters.action);\r\n    }\r\n\r\n    if (filters.userId) {\r\n      logs = logs.filter((l) => l.userId === filters.userId);\r\n    }\r\n\r\n    if (filters.startDate && filters.endDate) {\r\n      logs = logs.filter((l) => l.timestamp >= filters.startDate && l.timestamp <= filters.endDate);\r\n    }\r\n\r\n    return logs.slice(Math.max(0, logs.length - (filters.limit || 100)));\r\n  }\r\n\r\n  /**\r\n   * Health check\r\n   */\r\n  async healthCheck() {\r\n    try {\r\n      const startTime = Date.now();\r\n      const response = await axios.get(`${this.config.apiBaseUrl}/health`, {\r\n        timeout: 5000,\r\n        headers: {\r\n          'X-API-Key': this.config.apiKey,\r\n        },\r\n      });\r\n\r\n      return {\r\n        status: 'healthy',\r\n        apiResponse: response.status === 200,\r\n        responseTime: Date.now() - startTime,\r\n        timestamp: new Date(),\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        status: 'unhealthy',\r\n        error: error.message,\r\n        timestamp: new Date(),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy\r\n   */\r\n  destroy() {\r\n    clearInterval(this.metricsInterval);\r\n    this.cache.clear();\r\n    this.requestQueue = [];\r\n    this.rateLimiter.clear();\r\n    this.removeAllListeners();\r\n    Logger.info('MOI Passport Service destroyed');\r\n  }\r\n}\r\n\r\nmodule.exports = MOIPassportService;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;AAC9B,MAAMC,YAAY,GAAGD,OAAO,CAAC,QAAQ,CAAC;AACtC,MAAME,MAAM,GAAGF,OAAO,CAAC,iBAAiB,CAAC;AACzC,MAAMG,MAAM,GAAGH,OAAO,CAAC,QAAQ,CAAC;AAEhC,MAAMI,kBAAkB,SAASH,YAAY,CAAC;EAC5CI,WAAWA,CAACC,MAAM,GAAG,CAAC,CAAC,EAAE;IACvB,KAAK,CAAC,CAAC;;IAEP;IACA,IAAI,CAACA,MAAM,GAAG;MACZC,UAAU,EAAEC,OAAO,CAACC,GAAG,CAACC,oBAAoB,IAAI,2BAA2B;MAC3EC,MAAM,EAAEH,OAAO,CAACC,GAAG,CAACG,eAAe;MACnCC,SAAS,EAAEL,OAAO,CAACC,GAAG,CAACK,kBAAkB;MACzCC,UAAU,EAAEP,OAAO,CAACC,GAAG,CAACO,mBAAmB;MAC3CC,OAAO,EAAEC,QAAQ,CAACV,OAAO,CAACC,GAAG,CAACU,eAAe,IAAI,OAAO,CAAC;MACzDC,aAAa,EAAEF,QAAQ,CAACV,OAAO,CAACC,GAAG,CAACY,sBAAsB,IAAI,GAAG,CAAC;MAClEC,UAAU,EAAEJ,QAAQ,CAACV,OAAO,CAACC,GAAG,CAACc,mBAAmB,IAAI,MAAM,CAAC;MAC/DC,YAAY,EAAEN,QAAQ,CAACV,OAAO,CAACC,GAAG,CAACgB,mBAAmB,IAAI,OAAO,CAAC;MAClEC,QAAQ,EAAER,QAAQ,CAACV,OAAO,CAACC,GAAG,CAACkB,kBAAkB,IAAI,SAAS,CAAC;MAAE;MACjEC,gBAAgB,EAAEpB,OAAO,CAACC,GAAG,CAACoB,0BAA0B,KAAK,MAAM;MACnE,GAAGvB;IACL,CAAC;;IAED;IACA,IAAI,CAACwB,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC;IACtB,IAAI,CAACC,YAAY,GAAG,EAAE;IACtB,IAAI,CAACC,OAAO,GAAG;MACbC,aAAa,EAAE,CAAC;MAChBC,kBAAkB,EAAE,CAAC;MACrBC,cAAc,EAAE,CAAC;MACjBC,cAAc,EAAE,CAAC;MACjBC,mBAAmB,EAAE,CAAC;MACtBC,YAAY,EAAE;IAChB,CAAC;IACD,IAAI,CAACC,QAAQ,GAAG,EAAE;IAClB,IAAI,CAACC,QAAQ,GAAG,EAAE;;IAElB;IACA,IAAI,CAACC,WAAW,GAAG,IAAIX,GAAG,CAAC,CAAC;IAC5B,IAAI,CAACY,cAAc,GAAG,IAAIZ,GAAG,CAAC,CAAC;;IAE/B;IACA,IAAI,CAACa,eAAe,GAAG;MACrBC,QAAQ,EAAE;QACRC,SAAS,EAAE,CAAC;QACZC,SAAS,EAAE,EAAE;QACbC,OAAO,EAAE;MACX,CAAC;MACDC,UAAU,EAAE;QACVH,SAAS,EAAE,EAAE;QACbC,SAAS,EAAE,EAAE;QACbC,OAAO,EAAE;MACX,CAAC;MACDE,KAAK,EAAE;QACLJ,SAAS,EAAE,EAAE;QACbC,SAAS,EAAE,EAAE;QACbC,OAAO,EAAE;MACX,CAAC;MACDG,UAAU,EAAE;QACVL,SAAS,EAAE,EAAE;QACbC,SAAS,EAAE,EAAE;QACbC,OAAO,EAAE;MACX;IACF,CAAC;IAED,IAAI,CAACI,kBAAkB,CAAC,CAAC;IACzBlD,MAAM,CAACmD,IAAI,CAAC,iDAAiD,CAAC;EAChE;;EAEA;AACF;AACA;EACED,kBAAkBA,CAAA,EAAG;IACnB,IAAI,CAACE,eAAe,GAAGC,WAAW,CAAC,MAAM;MACvC,IAAI,IAAI,CAACtB,OAAO,CAACM,YAAY,CAACiB,MAAM,GAAG,CAAC,EAAE;QACxC,MAAMC,GAAG,GAAG,IAAI,CAACxB,OAAO,CAACM,YAAY,CAACmB,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,EAAE,CAAC,CAAC;QAChE,IAAI,CAAC3B,OAAO,CAACK,mBAAmB,GAAGuB,IAAI,CAACC,KAAK,CAACL,GAAG,GAAG,IAAI,CAACxB,OAAO,CAACM,YAAY,CAACiB,MAAM,CAAC;QACrF;QACA,IAAI,IAAI,CAACvB,OAAO,CAACM,YAAY,CAACiB,MAAM,GAAG,IAAI,EAAE;UAC3C,IAAI,CAACvB,OAAO,CAACM,YAAY,GAAG,IAAI,CAACN,OAAO,CAACM,YAAY,CAACwB,KAAK,CAAC,CAAC,IAAI,CAAC;QACpE;MACF;IACF,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;EACb;;EAEA;AACF;AACA;EACEC,eAAeA,CAACC,MAAM,EAAE;IACtB,MAAMC,GAAG,GAAG,aAAaD,MAAM,EAAE;IACjC,MAAME,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAME,WAAW,GAAGF,GAAG,GAAG,OAAO,CAAC,CAAC;;IAEnC,IAAI,CAAC,IAAI,CAACzB,WAAW,CAAC4B,GAAG,CAACJ,GAAG,CAAC,EAAE;MAC9B,IAAI,CAACxB,WAAW,CAAC6B,GAAG,CAACL,GAAG,EAAE,EAAE,CAAC;IAC/B;IAEA,MAAMM,QAAQ,GAAG,IAAI,CAAC9B,WAAW,CAAC+B,GAAG,CAACP,GAAG,CAAC;IAC1C,MAAMQ,cAAc,GAAGF,QAAQ,CAACG,MAAM,CAAEC,IAAI,IAAKA,IAAI,GAAGP,WAAW,CAAC;;IAEpE;IACA,IAAIK,cAAc,CAAClB,MAAM,IAAI,GAAG,EAAE;MAChC,MAAM,IAAIqB,KAAK,CAAC,oDAAoD,CAAC;IACvE;IAEAH,cAAc,CAACI,IAAI,CAACX,GAAG,CAAC;IACxB,IAAI,CAACzB,WAAW,CAAC6B,GAAG,CAACL,GAAG,EAAEQ,cAAc,CAAC;IACzC,OAAO,IAAI;EACb;;EAEA;AACF;AACA;EACEK,cAAcA,CAACC,IAAI,EAAEC,IAAI,EAAE;IACzB,IAAI,CAACD,IAAI,EAAE;MACT,MAAM,IAAIH,KAAK,CAAC,GAAGI,IAAI,cAAc,CAAC;IACxC;IAEA,MAAMC,KAAK,GAAG,IAAI,CAACtC,eAAe,CAACqC,IAAI,CAAC;IACxC,IAAI,CAACC,KAAK,EAAE;MACV,MAAM,IAAIL,KAAK,CAAC,4BAA4BI,IAAI,EAAE,CAAC;IACrD;IAEA,MAAME,UAAU,GAAGC,MAAM,CAACJ,IAAI,CAAC,CAACK,IAAI,CAAC,CAAC;IAEtC,IAAIF,UAAU,CAAC3B,MAAM,GAAG0B,KAAK,CAACpC,SAAS,IAAIqC,UAAU,CAAC3B,MAAM,GAAG0B,KAAK,CAACnC,SAAS,EAAE;MAC9E,MAAM,IAAI8B,KAAK,CACb,GAAGI,IAAI,oBAAoBC,KAAK,CAACpC,SAAS,QAAQoC,KAAK,CAACnC,SAAS,aACnE,CAAC;IACH;IAEA,IAAI,CAACmC,KAAK,CAAClC,OAAO,CAACsC,IAAI,CAACH,UAAU,CAAC,EAAE;MACnC,MAAM,IAAIN,KAAK,CAAC,GAAGI,IAAI,oBAAoB,CAAC;IAC9C;IAEA,OAAOE,UAAU;EACnB;;EAEA;AACF;AACA;EACEI,iBAAiBA,CAACC,QAAQ,EAAEC,MAAM,EAAE;IAClC,MAAMC,SAAS,GAAGC,IAAI,CAACC,SAAS,CAACH,MAAM,CAAC;IACxC,OAAOtF,MAAM,CACV0F,UAAU,CAAC,KAAK,CAAC,CACjBC,MAAM,CAAC,GAAGN,QAAQ,IAAIE,SAAS,EAAE,CAAC,CAClCK,MAAM,CAAC,KAAK,CAAC;EAClB;;EAEA;AACF;AACA;EACEC,aAAaA,CAAC9B,GAAG,EAAE;IACjB,MAAM+B,MAAM,GAAG,IAAI,CAACnE,KAAK,CAAC2C,GAAG,CAACP,GAAG,CAAC;IAClC,IAAI+B,MAAM,IAAIA,MAAM,CAACC,SAAS,GAAG9B,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;MAC3C,IAAI,CAAClC,OAAO,CAACI,cAAc,EAAE;MAC7B,IAAI,CAAC8D,IAAI,CAAC,WAAW,EAAE;QAAEjC;MAAI,CAAC,CAAC;MAC/B,OAAO+B,MAAM,CAACjB,IAAI;IACpB;IAEA,IAAIiB,MAAM,IAAIA,MAAM,CAACC,SAAS,IAAI9B,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;MAC5C,IAAI,CAACrC,KAAK,CAACsE,MAAM,CAAClC,GAAG,CAAC;IACxB;IAEA,OAAO,IAAI;EACb;;EAEA;AACF;AACA;EACEmC,SAASA,CAACnC,GAAG,EAAEc,IAAI,EAAEsB,GAAG,GAAG,IAAI,EAAE;IAC/B,IAAI,IAAI,CAACxE,KAAK,CAACyE,IAAI,IAAI,IAAI,CAACjG,MAAM,CAACkB,YAAY,EAAE;MAC/C;MACA,MAAMgF,QAAQ,GAAG,IAAI,CAAC1E,KAAK,CAAC2E,IAAI,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,CAACC,KAAK;MAC/C,IAAI,CAAC7E,KAAK,CAACsE,MAAM,CAACI,QAAQ,CAAC;IAC7B;IAEA,MAAMN,SAAS,GAAG9B,IAAI,CAACD,GAAG,CAAC,CAAC,IAAImC,GAAG,IAAI,IAAI,CAAChG,MAAM,CAACoB,QAAQ,CAAC;IAC5D,IAAI,CAACI,KAAK,CAACyC,GAAG,CAACL,GAAG,EAAE;MAAEc,IAAI;MAAEkB,SAAS;MAAEU,SAAS,EAAExC,IAAI,CAACD,GAAG,CAAC;IAAE,CAAC,CAAC;IAC/D,IAAI,CAACgC,IAAI,CAAC,WAAW,EAAE;MAAEjC,GAAG;MAAEoC;IAAI,CAAC,CAAC;EACtC;;EAEA;AACF;AACA;EACEO,UAAUA,CAAC7D,OAAO,GAAG,IAAI,EAAE;IACzB,IAAI,CAACA,OAAO,EAAE;MACZ,IAAI,CAAClB,KAAK,CAACgF,KAAK,CAAC,CAAC;MAClB5G,MAAM,CAACmD,IAAI,CAAC,0BAA0B,CAAC;MACvC,OAAO;QAAE0D,OAAO,EAAE,IAAI;QAAEC,OAAO,EAAE;MAAgB,CAAC;IACpD;IAEA,IAAIC,OAAO,GAAG,CAAC;IACf,KAAK,MAAM,CAAC/C,GAAG,CAAC,IAAI,IAAI,CAACpC,KAAK,EAAE;MAC9B,IAAIoC,GAAG,CAACgD,QAAQ,CAAClE,OAAO,CAAC,EAAE;QACzB,IAAI,CAAClB,KAAK,CAACsE,MAAM,CAAClC,GAAG,CAAC;QACtB+C,OAAO,EAAE;MACX;IACF;IAEA/G,MAAM,CAACmD,IAAI,CAAC,kBAAkB4D,OAAO,gBAAgB,CAAC;IACtD,OAAO;MAAEF,OAAO,EAAE,IAAI;MAAEE;IAAQ,CAAC;EACnC;;EAEA;AACF;AACA;EACEE,YAAYA,CAACnC,IAAI,EAAE;IACjB,IAAI,CAAC,IAAI,CAAC1E,MAAM,CAACsB,gBAAgB,EAAE,OAAOoD,IAAI;IAE9C,IAAI;MACF,MAAMoC,EAAE,GAAGjH,MAAM,CAACkH,WAAW,CAAC,EAAE,CAAC;MACjC,MAAMC,MAAM,GAAGnH,MAAM,CAACoH,cAAc,CAClC,aAAa,EACbC,MAAM,CAACC,IAAI,CAAC,IAAI,CAACnH,MAAM,CAACO,SAAS,IAAI,gBAAgB,EAAE,OAAO,CAAC,CAACkD,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,EAC5EqD,EACF,CAAC;MAED,IAAIM,SAAS,GAAGJ,MAAM,CAACxB,MAAM,CAACH,IAAI,CAACC,SAAS,CAACZ,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC;MACnE0C,SAAS,IAAIJ,MAAM,CAACK,KAAK,CAAC,KAAK,CAAC;MAEhC,OAAO;QACLD,SAAS,EAAE,IAAI;QACf1C,IAAI,EAAE0C,SAAS;QACfN,EAAE,EAAEA,EAAE,CAACQ,QAAQ,CAAC,KAAK;MACvB,CAAC;IACH,CAAC,CAAC,OAAOC,KAAK,EAAE;MACd3H,MAAM,CAAC2H,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC9C,OAAO7C,IAAI;IACb;EACF;;EAEA;AACF;AACA;EACE8C,YAAYA,CAACC,aAAa,EAAE;IAC1B,IAAI,CAAC,IAAI,CAACzH,MAAM,CAACsB,gBAAgB,IAAI,CAACmG,aAAa,CAACL,SAAS,EAAE;MAC7D,OAAOK,aAAa;IACtB;IAEA,IAAI;MACF,MAAMC,QAAQ,GAAG7H,MAAM,CAAC8H,gBAAgB,CACtC,aAAa,EACbT,MAAM,CAACC,IAAI,CAAC,IAAI,CAACnH,MAAM,CAACO,SAAS,IAAI,gBAAgB,EAAE,OAAO,CAAC,CAACkD,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,EAC5EyD,MAAM,CAACC,IAAI,CAACM,aAAa,CAACX,EAAE,EAAE,KAAK,CACrC,CAAC;MAED,IAAIc,SAAS,GAAGF,QAAQ,CAAClC,MAAM,CAACiC,aAAa,CAAC/C,IAAI,EAAE,KAAK,EAAE,OAAO,CAAC;MACnEkD,SAAS,IAAIF,QAAQ,CAACL,KAAK,CAAC,OAAO,CAAC;MAEpC,OAAOhC,IAAI,CAACwC,KAAK,CAACD,SAAS,CAAC;IAC9B,CAAC,CAAC,OAAOL,KAAK,EAAE;MACd3H,MAAM,CAAC2H,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC9C,OAAOE,aAAa;IACtB;EACF;;EAEA;AACF;AACA;EACE,MAAMK,YAAYA,CAAC5C,QAAQ,EAAE6C,MAAM,GAAG,KAAK,EAAErD,IAAI,GAAG,IAAI,EAAEsD,OAAO,GAAG,CAAC,CAAC,EAAE;IACtE,MAAMC,SAAS,GAAGnE,IAAI,CAACD,GAAG,CAAC,CAAC;IAC5B,IAAIqE,SAAS,GAAG,IAAI;IAEpB,KAAK,IAAIC,OAAO,GAAG,CAAC,EAAEA,OAAO,GAAG,IAAI,CAACnI,MAAM,CAACc,aAAa,EAAEqH,OAAO,EAAE,EAAE;MACpE,IAAI;QACF,MAAMC,GAAG,GAAG,GAAG,IAAI,CAACpI,MAAM,CAACC,UAAU,GAAGiF,QAAQ,EAAE;QAClD,MAAMmD,OAAO,GAAG;UACd,cAAc,EAAE,kBAAkB;UAClC,WAAW,EAAE,IAAI,CAACrI,MAAM,CAACK,MAAM;UAC/B,cAAc,EAAER,MAAM,CAACyI,UAAU,CAAC,CAAC;UACnC,YAAY,EAAE,4BAA4B;UAC1C,GAAGN,OAAO,CAACK;QACb,CAAC;QAED,MAAMrI,MAAM,GAAG;UACb+H,MAAM;UACNK,GAAG;UACHC,OAAO;UACP1H,OAAO,EAAE,IAAI,CAACX,MAAM,CAACW;QACvB,CAAC;QAED,IAAI+D,IAAI,EAAE;UACR1E,MAAM,CAAC0E,IAAI,GAAGA,IAAI;QACpB;QAEA,MAAM6D,QAAQ,GAAG,MAAM9I,KAAK,CAACO,MAAM,CAAC;QACpC,MAAMwI,YAAY,GAAG1E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE,SAAS;;QAE3C;QACA,IAAI,CAACtG,OAAO,CAACM,YAAY,CAACuC,IAAI,CAACgE,YAAY,CAAC;QAC5C,IAAI,CAAC7G,OAAO,CAACC,aAAa,EAAE;QAC5B,IAAI,CAACD,OAAO,CAACE,kBAAkB,EAAE;QAEjC,IAAI,CAACgE,IAAI,CAAC,iBAAiB,EAAE;UAC3BX,QAAQ;UACRuD,UAAU,EAAEF,QAAQ,CAACG,MAAM;UAC3BC,YAAY,EAAEH;QAChB,CAAC,CAAC;QAEF,OAAOD,QAAQ,CAAC7D,IAAI;MACtB,CAAC,CAAC,OAAO6C,KAAK,EAAE;QACdW,SAAS,GAAGX,KAAK;QAEjB,IAAIY,OAAO,GAAG,IAAI,CAACnI,MAAM,CAACc,aAAa,GAAG,CAAC,EAAE;UAC3C;UACA,MAAM8H,KAAK,GAAG,IAAI,CAAC5I,MAAM,CAACgB,UAAU,GAAGuC,IAAI,CAACsF,GAAG,CAAC,CAAC,EAAEV,OAAO,CAAC;UAC3D,MAAM,IAAI,CAACW,MAAM,CAACF,KAAK,CAAC;QAC1B;MACF;IACF;;IAEA;IACA,IAAI,CAACjH,OAAO,CAACG,cAAc,EAAE;IAC7B,IAAI,CAACH,OAAO,CAACC,aAAa,EAAE;IAE5B,MAAMmH,SAAS,GAAG;MAChB7D,QAAQ;MACRqC,KAAK,EAAEW,SAAS,EAAExB,OAAO;MACzBsC,SAAS,EAAE,IAAIlF,IAAI,CAAC,CAAC;MACrBmF,OAAO,EAAE,IAAI,CAACjJ,MAAM,CAACc;IACvB,CAAC;IAED,IAAI,CAACoB,QAAQ,CAACsC,IAAI,CAACuE,SAAS,CAAC;IAC7B,IAAI,CAAClD,IAAI,CAAC,iBAAiB,EAAEkD,SAAS,CAAC;IAEvC,MAAMb,SAAS;EACjB;;EAEA;AACF;AACA;EACEY,MAAMA,CAACI,EAAE,EAAE;IACT,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAKC,UAAU,CAACD,OAAO,EAAEF,EAAE,CAAC,CAAC;EAC1D;;EAEA;AACF;AACA;EACE,MAAMI,cAAcA,CAACC,cAAc,EAAE5F,MAAM,EAAE;IAC3C,MAAMsE,SAAS,GAAGnE,IAAI,CAACD,GAAG,CAAC,CAAC;IAE5B,IAAI;MACF;MACA,MAAM2F,iBAAiB,GAAG,IAAI,CAAC/E,cAAc,CAAC8E,cAAc,EAAE,UAAU,CAAC;MACzE,IAAI,CAAC7F,eAAe,CAACC,MAAM,CAAC;;MAE5B;MACA,MAAM8F,QAAQ,GAAG,IAAI,CAACxE,iBAAiB,CAAC,iBAAiB,EAAE;QAAEsE;MAAe,CAAC,CAAC;MAC9E,MAAMG,YAAY,GAAG,IAAI,CAAChE,aAAa,CAAC+D,QAAQ,CAAC;MAEjD,IAAIC,YAAY,EAAE;QAChB,OAAO;UACLjD,OAAO,EAAE,IAAI;UACb/B,IAAI,EAAEgF,YAAY;UAClBC,MAAM,EAAE,OAAO;UACfhB,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE;QAC7B,CAAC;MACH;;MAEA;MACA,MAAMM,QAAQ,GAAG,MAAM,IAAI,CAACT,YAAY,CAAC,mBAAmB,EAAE,MAAM,EAAE;QACpEyB,cAAc,EAAEC;MAClB,CAAC,CAAC;;MAEF;MACA,IAAI,CAACjB,QAAQ,IAAI,CAACA,QAAQ,CAAC7D,IAAI,EAAE;QAC/B,MAAM,IAAIH,KAAK,CAAC,6BAA6B,CAAC;MAChD;MAEA,MAAMqF,MAAM,GAAG;QACbL,cAAc,EAAEhB,QAAQ,CAAC7D,IAAI,CAAC6E,cAAc;QAC5CM,cAAc,EAAEtB,QAAQ,CAAC7D,IAAI,CAACoF,UAAU;QACxCC,eAAe,EAAExB,QAAQ,CAAC7D,IAAI,CAACsF,UAAU;QACzCC,WAAW,EAAE1B,QAAQ,CAAC7D,IAAI,CAACuF,WAAW;QACtCC,WAAW,EAAE3B,QAAQ,CAAC7D,IAAI,CAACwF,WAAW;QACtCC,MAAM,EAAE5B,QAAQ,CAAC7D,IAAI,CAACyF,MAAM;QAC5BC,SAAS,EAAE7B,QAAQ,CAAC7D,IAAI,CAAC0F,SAAS;QAClCC,UAAU,EAAE9B,QAAQ,CAAC7D,IAAI,CAAC2F,UAAU;QACpC3B,MAAM,EAAEH,QAAQ,CAAC7D,IAAI,CAACgE,MAAM;QAAE;QAC9B4B,gBAAgB,EAAE,kCAAkC;QACpDC,gBAAgB,EAAE,IAAIzG,IAAI,CAAC;MAC7B,CAAC;;MAED;MACA,IAAI,CAACiC,SAAS,CAAC0D,QAAQ,EAAEG,MAAM,CAAC;;MAEhC;MACA,IAAI,CAACY,YAAY,CAAC,iBAAiB,EAAE7G,MAAM,EAAE;QAC3C4F,cAAc,EAAEC,iBAAiB;QACjCd,MAAM,EAAE;MACV,CAAC,CAAC;MAEF,IAAI,CAAC7C,IAAI,CAAC,mBAAmB,EAAE+D,MAAM,CAAC;MAEtC,OAAO;QACLnD,OAAO,EAAE,IAAI;QACb/B,IAAI,EAAEkF,MAAM;QACZD,MAAM,EAAE,KAAK;QACbhB,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE;MAC7B,CAAC;IACH,CAAC,CAAC,OAAOV,KAAK,EAAE;MACd,IAAI,CAACiD,YAAY,CAAC,iBAAiB,EAAE7G,MAAM,EAAE;QAC3C4F,cAAc;QACdb,MAAM,EAAE,QAAQ;QAChBnB,KAAK,EAAEA,KAAK,CAACb;MACf,CAAC,CAAC;MAEF9G,MAAM,CAAC2H,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACpD,MAAM;QACJd,OAAO,EAAE,KAAK;QACdc,KAAK,EAAEA,KAAK,CAACb,OAAO;QACpB/B,IAAI,EAAE,6BAA6B;QACnCqE,SAAS,EAAE,IAAIlF,IAAI,CAAC;MACtB,CAAC;IACH;EACF;;EAEA;AACF;AACA;EACE,MAAM2G,gBAAgBA,CAAC9H,UAAU,EAAEgB,MAAM,EAAE;IACzC,MAAMsE,SAAS,GAAGnE,IAAI,CAACD,GAAG,CAAC,CAAC;IAE5B,IAAI;MACF,MAAM6G,WAAW,GAAG,IAAI,CAACjG,cAAc,CAAC9B,UAAU,EAAE,YAAY,CAAC;MACjE,IAAI,CAACe,eAAe,CAACC,MAAM,CAAC;MAE5B,MAAM8F,QAAQ,GAAG,IAAI,CAACxE,iBAAiB,CAAC,oBAAoB,EAAE;QAAEtC;MAAW,CAAC,CAAC;MAC7E,MAAM+G,YAAY,GAAG,IAAI,CAAChE,aAAa,CAAC+D,QAAQ,CAAC;MAEjD,IAAIC,YAAY,EAAE;QAChB,OAAO;UACLjD,OAAO,EAAE,IAAI;UACb/B,IAAI,EAAEgF,YAAY;UAClBC,MAAM,EAAE,OAAO;UACfhB,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE;QAC7B,CAAC;MACH;MAEA,MAAMM,QAAQ,GAAG,MAAM,IAAI,CAACT,YAAY,CAAC,sBAAsB,EAAE,MAAM,EAAE;QACvEnF,UAAU,EAAE+H;MACd,CAAC,CAAC;MAEF,MAAMd,MAAM,GAAG;QACbjH,UAAU,EAAE4F,QAAQ,CAAC7D,IAAI,CAAC/B,UAAU;QACpCkH,cAAc,EAAEtB,QAAQ,CAAC7D,IAAI,CAACoF,UAAU;QACxCC,eAAe,EAAExB,QAAQ,CAAC7D,IAAI,CAACsF,UAAU;QACzCW,SAAS,EAAEpC,QAAQ,CAAC7D,IAAI,CAACiG,SAAS;QAClCR,MAAM,EAAE5B,QAAQ,CAAC7D,IAAI,CAACyF,MAAM;QAC5BF,WAAW,EAAE,cAAc;QAC3BG,SAAS,EAAE7B,QAAQ,CAAC7D,IAAI,CAAC0F,SAAS;QAClCC,UAAU,EAAE9B,QAAQ,CAAC7D,IAAI,CAAC2F,UAAU;QACpC3B,MAAM,EAAEH,QAAQ,CAAC7D,IAAI,CAACgE,MAAM;QAC5B6B,gBAAgB,EAAE,IAAIzG,IAAI,CAAC;MAC7B,CAAC;MAED,IAAI,CAACiC,SAAS,CAAC0D,QAAQ,EAAEG,MAAM,CAAC;MAEhC,IAAI,CAACY,YAAY,CAAC,oBAAoB,EAAE7G,MAAM,EAAE;QAC9ChB,UAAU,EAAE+H,WAAW;QACvBhC,MAAM,EAAE;MACV,CAAC,CAAC;MAEF,IAAI,CAAC7C,IAAI,CAAC,sBAAsB,EAAE+D,MAAM,CAAC;MAEzC,OAAO;QACLnD,OAAO,EAAE,IAAI;QACb/B,IAAI,EAAEkF,MAAM;QACZD,MAAM,EAAE,KAAK;QACbhB,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE;MAC7B,CAAC;IACH,CAAC,CAAC,OAAOV,KAAK,EAAE;MACd,IAAI,CAACiD,YAAY,CAAC,oBAAoB,EAAE7G,MAAM,EAAE;QAC9ChB,UAAU;QACV+F,MAAM,EAAE,QAAQ;QAChBnB,KAAK,EAAEA,KAAK,CAACb;MACf,CAAC,CAAC;MAEF9G,MAAM,CAAC2H,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;MACvD,MAAM;QACJd,OAAO,EAAE,KAAK;QACdc,KAAK,EAAEA,KAAK,CAACb,OAAO;QACpB/B,IAAI,EAAE,gCAAgC;QACtCqE,SAAS,EAAE,IAAIlF,IAAI,CAAC;MACtB,CAAC;IACH;EACF;;EAEA;AACF;AACA;EACE,MAAM8G,WAAWA,CAACC,WAAW,EAAElH,MAAM,EAAE;IACrC,MAAMsE,SAAS,GAAGnE,IAAI,CAACD,GAAG,CAAC,CAAC;IAE5B,IAAI;MACF,MAAMiH,cAAc,GAAG,IAAI,CAACrG,cAAc,CAACoG,WAAW,EAAE,OAAO,CAAC;MAChE,IAAI,CAACnH,eAAe,CAACC,MAAM,CAAC;MAE5B,MAAM8F,QAAQ,GAAG,IAAI,CAACxE,iBAAiB,CAAC,cAAc,EAAE;QAAE4F;MAAY,CAAC,CAAC;MACxE,MAAMnB,YAAY,GAAG,IAAI,CAAChE,aAAa,CAAC+D,QAAQ,CAAC;MAEjD,IAAIC,YAAY,EAAE;QAChB,OAAO;UACLjD,OAAO,EAAE,IAAI;UACb/B,IAAI,EAAEgF,YAAY;UAClBC,MAAM,EAAE,OAAO;UACfhB,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE;QAC7B,CAAC;MACH;MAEA,MAAMM,QAAQ,GAAG,MAAM,IAAI,CAACT,YAAY,CAAC,gBAAgB,EAAE,MAAM,EAAE;QACjE+C,WAAW,EAAEC;MACf,CAAC,CAAC;MAEF,MAAMlB,MAAM,GAAG;QACbiB,WAAW,EAAEtC,QAAQ,CAAC7D,IAAI,CAACmG,WAAW;QACtChB,cAAc,EAAEtB,QAAQ,CAAC7D,IAAI,CAACoF,UAAU;QACxCC,eAAe,EAAExB,QAAQ,CAAC7D,IAAI,CAACsF,UAAU;QACzCC,WAAW,EAAE1B,QAAQ,CAAC7D,IAAI,CAACuF,WAAW;QACtCC,WAAW,EAAE3B,QAAQ,CAAC7D,IAAI,CAACiG,SAAS;QACpCI,WAAW,EAAExC,QAAQ,CAAC7D,IAAI,CAACqG,WAAW;QACtCC,aAAa,EAAEzC,QAAQ,CAAC7D,IAAI,CAACsG,aAAa;QAC1CC,kBAAkB,EAAE1C,QAAQ,CAAC7D,IAAI,CAACuG,kBAAkB;QACpDb,SAAS,EAAE7B,QAAQ,CAAC7D,IAAI,CAAC0F,SAAS;QAClCC,UAAU,EAAE9B,QAAQ,CAAC7D,IAAI,CAAC2F,UAAU;QACpC3B,MAAM,EAAEH,QAAQ,CAAC7D,IAAI,CAACgE,MAAM;QAAE;QAC9BwC,cAAc,EAAE3C,QAAQ,CAAC7D,IAAI,CAACwG,cAAc;QAC5CC,cAAc,EAAE5C,QAAQ,CAAC7D,IAAI,CAACyG,cAAc;QAC5CZ,gBAAgB,EAAE,IAAIzG,IAAI,CAAC;MAC7B,CAAC;MAED,IAAI,CAACiC,SAAS,CAAC0D,QAAQ,EAAEG,MAAM,CAAC;MAEhC,IAAI,CAACY,YAAY,CAAC,cAAc,EAAE7G,MAAM,EAAE;QACxCkH,WAAW,EAAEC,cAAc;QAC3BpC,MAAM,EAAE;MACV,CAAC,CAAC;MAEF,IAAI,CAAC7C,IAAI,CAAC,gBAAgB,EAAE+D,MAAM,CAAC;MAEnC,OAAO;QACLnD,OAAO,EAAE,IAAI;QACb/B,IAAI,EAAEkF,MAAM;QACZD,MAAM,EAAE,KAAK;QACbhB,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE;MAC7B,CAAC;IACH,CAAC,CAAC,OAAOV,KAAK,EAAE;MACd,IAAI,CAACiD,YAAY,CAAC,cAAc,EAAE7G,MAAM,EAAE;QACxCkH,WAAW;QACXnC,MAAM,EAAE,QAAQ;QAChBnB,KAAK,EAAEA,KAAK,CAACb;MACf,CAAC,CAAC;MAEF9G,MAAM,CAAC2H,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MACjD,MAAM;QACJd,OAAO,EAAE,KAAK;QACdc,KAAK,EAAEA,KAAK,CAACb,OAAO;QACpB/B,IAAI,EAAE,0BAA0B;QAChCqE,SAAS,EAAE,IAAIlF,IAAI,CAAC;MACtB,CAAC;IACH;EACF;;EAEA;AACF;AACA;EACE,MAAMsH,sBAAsBA,CAACP,WAAW,EAAEQ,QAAQ,GAAG,UAAU,EAAEC,QAAQ,GAAG,EAAE,EAAE3H,MAAM,EAAE;IACtF,MAAMsE,SAAS,GAAGnE,IAAI,CAACD,GAAG,CAAC,CAAC;IAE5B,IAAI;MACF,MAAMiH,cAAc,GAAG,IAAI,CAACrG,cAAc,CAACoG,WAAW,EAAE,OAAO,CAAC;MAChE,IAAI,CAACnH,eAAe,CAACC,MAAM,CAAC;MAE5B,IAAI,CAAC,CAAC,QAAQ,EAAE,UAAU,CAAC,CAACiD,QAAQ,CAACyE,QAAQ,CAAC,EAAE;QAC9C,MAAM,IAAI9G,KAAK,CAAC,0CAA0C,CAAC;MAC7D;MAEA,IAAI+G,QAAQ,GAAG,CAAC,IAAIA,QAAQ,GAAG,GAAG,EAAE;QAClC,MAAM,IAAI/G,KAAK,CAAC,yCAAyC,CAAC;MAC5D;MAEA,MAAMgE,QAAQ,GAAG,MAAM,IAAI,CAACT,YAAY,CAAC,uBAAuB,EAAE,MAAM,EAAE;QACxE+C,WAAW,EAAEC,cAAc;QAC3BO,QAAQ;QACRC,QAAQ;QACRC,WAAW,EAAE,IAAIzH,IAAI,CAAC;MACxB,CAAC,CAAC;MAEF,MAAM8F,MAAM,GAAG;QACb4B,SAAS,EAAEjD,QAAQ,CAAC7D,IAAI,CAAC8G,SAAS;QAClCX,WAAW,EAAEC,cAAc;QAC3BO,QAAQ;QACRC,QAAQ;QACR5C,MAAM,EAAE,SAAS;QAAE;QACnB2B,UAAU,EAAE,IAAIvG,IAAI,CAACA,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGyH,QAAQ,GAAG,QAAQ,CAAC;QACtDG,WAAW,EAAE,IAAI3H,IAAI,CAAC,CAAC;QACvB4H,uBAAuB,EAAE,IAAI5H,IAAI,CAACA,IAAI,CAACD,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,QAAQ;MAC7D,CAAC;MAED,IAAI,CAAC2G,YAAY,CAAC,sBAAsB,EAAE7G,MAAM,EAAE;QAChDkH,WAAW,EAAEC,cAAc;QAC3BU,SAAS,EAAE5B,MAAM,CAAC4B,SAAS;QAC3B9C,MAAM,EAAE;MACV,CAAC,CAAC;MAEF,IAAI,CAAC7C,IAAI,CAAC,wBAAwB,EAAE+D,MAAM,CAAC;MAE3C,OAAO;QACLnD,OAAO,EAAE,IAAI;QACb/B,IAAI,EAAEkF,MAAM;QACZjB,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE;MAC7B,CAAC;IACH,CAAC,CAAC,OAAOV,KAAK,EAAE;MACd,IAAI,CAACiD,YAAY,CAAC,sBAAsB,EAAE7G,MAAM,EAAE;QAChDkH,WAAW;QACXnC,MAAM,EAAE,QAAQ;QAChBnB,KAAK,EAAEA,KAAK,CAACb;MACf,CAAC,CAAC;MAEF9G,MAAM,CAAC2H,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACpD,MAAM;QACJd,OAAO,EAAE,KAAK;QACdc,KAAK,EAAEA,KAAK,CAACb,OAAO;QACpB/B,IAAI,EAAE,4BAA4B;QAClCqE,SAAS,EAAE,IAAIlF,IAAI,CAAC;MACtB,CAAC;IACH;EACF;;EAEA;AACF;AACA;EACE,MAAM6H,kBAAkBA,CAACd,WAAW,EAAElH,MAAM,EAAE;IAC5C,IAAI;MACF,MAAMmH,cAAc,GAAG,IAAI,CAACrG,cAAc,CAACoG,WAAW,EAAE,OAAO,CAAC;MAChE,IAAI,CAACnH,eAAe,CAACC,MAAM,CAAC;MAE5B,MAAM8F,QAAQ,GAAG,IAAI,CAACxE,iBAAiB,CAAC,kBAAkB,EAAE;QAAE4F;MAAY,CAAC,CAAC;MAC5E,MAAMnB,YAAY,GAAG,IAAI,CAAChE,aAAa,CAAC+D,QAAQ,CAAC;MAEjD,IAAIC,YAAY,EAAE;QAChB,OAAO;UACLjD,OAAO,EAAE,IAAI;UACb/B,IAAI,EAAEgF,YAAY;UAClBC,MAAM,EAAE;QACV,CAAC;MACH;MAEA,MAAMpB,QAAQ,GAAG,MAAM,IAAI,CAACT,YAAY,CAAC,cAAcgD,cAAc,EAAE,EAAE,KAAK,CAAC;MAE/E,MAAMc,OAAO,GAAG;QACdf,WAAW,EAAEtC,QAAQ,CAAC7D,IAAI,CAACmG,WAAW;QACtCgB,YAAY,EAAE;UACZ/B,UAAU,EAAEvB,QAAQ,CAAC7D,IAAI,CAACoF,UAAU;UACpCE,UAAU,EAAEzB,QAAQ,CAAC7D,IAAI,CAACsF,UAAU;UACpCE,WAAW,EAAE3B,QAAQ,CAAC7D,IAAI,CAACwF,WAAW;UACtCC,MAAM,EAAE5B,QAAQ,CAAC7D,IAAI,CAACyF,MAAM;UAC5BF,WAAW,EAAE1B,QAAQ,CAAC7D,IAAI,CAACuF;QAC7B,CAAC;QACD6B,YAAY,EAAE;UACZvJ,QAAQ,EAAEgG,QAAQ,CAAC7D,IAAI,CAAC6E,cAAc;UACtCwC,cAAc,EAAExD,QAAQ,CAAC7D,IAAI,CAACqH,cAAc;UAC5CnJ,KAAK,EAAE2F,QAAQ,CAAC7D,IAAI,CAACmG,WAAW;UAChCmB,WAAW,EAAEzD,QAAQ,CAAC7D,IAAI,CAACsH,WAAW;UACtCrJ,UAAU,EAAE4F,QAAQ,CAAC7D,IAAI,CAAC/B;QAC5B,CAAC;QACDsJ,aAAa,EAAE1D,QAAQ,CAAC7D,IAAI,CAACuH,aAAa,IAAI,EAAE;QAChDC,WAAW,EAAE3D,QAAQ,CAAC7D,IAAI,CAACwH,WAAW,IAAI,IAAI;QAC9CC,QAAQ,EAAE5D,QAAQ,CAAC7D,IAAI,CAACyH,QAAQ,IAAI,EAAE;QACtCC,aAAa,EAAE7D,QAAQ,CAAC7D,IAAI,CAAC2H,OAAO,IAAI;MAC1C,CAAC;MAED,IAAI,CAACtG,SAAS,CAAC0D,QAAQ,EAAEmC,OAAO,EAAE,IAAI,CAAC5L,MAAM,CAACoB,QAAQ,GAAG,CAAC,CAAC;MAC3D,IAAI,CAACoJ,YAAY,CAAC,sBAAsB,EAAE7G,MAAM,EAAE;QAAEkH,WAAW,EAAEC;MAAe,CAAC,CAAC;MAElF,OAAO;QACLrE,OAAO,EAAE,IAAI;QACb/B,IAAI,EAAEkH;MACR,CAAC;IACH,CAAC,CAAC,OAAOrE,KAAK,EAAE;MACd3H,MAAM,CAAC2H,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACtD,MAAM;QACJd,OAAO,EAAE,KAAK;QACdc,KAAK,EAAEA,KAAK,CAACb,OAAO;QACpB/B,IAAI,EAAE;MACR,CAAC;IACH;EACF;;EAEA;AACF;AACA;EACE2H,UAAUA,CAAA,EAAG;IACX,OAAO;MACL1K,aAAa,EAAE,IAAI,CAACD,OAAO,CAACC,aAAa;MACzCC,kBAAkB,EAAE,IAAI,CAACF,OAAO,CAACE,kBAAkB;MACnDC,cAAc,EAAE,IAAI,CAACH,OAAO,CAACG,cAAc;MAC3CyK,WAAW,EAAE,IAAI,CAAC5K,OAAO,CAACC,aAAa,GAAG,CAAC,GACvC,CAAE,IAAI,CAACD,OAAO,CAACE,kBAAkB,GAAG,IAAI,CAACF,OAAO,CAACC,aAAa,GAAI,GAAG,EAAE4K,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,GACvF,IAAI;MACRzK,cAAc,EAAE,IAAI,CAACJ,OAAO,CAACI,cAAc;MAC3C0K,SAAS,EAAE,IAAI,CAACjL,KAAK,CAACyE,IAAI;MAC1B/E,YAAY,EAAE,IAAI,CAAClB,MAAM,CAACkB,YAAY;MACtCwL,gBAAgB,EAAE,CAAE,IAAI,CAAClL,KAAK,CAACyE,IAAI,GAAG,IAAI,CAACjG,MAAM,CAACkB,YAAY,GAAI,GAAG,EAAEsL,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG;MACvFxK,mBAAmB,EAAE,IAAI,CAACL,OAAO,CAACK,mBAAmB,GAAG,IAAI;MAC5D2K,YAAY,EAAE,IAAI,CAACzK,QAAQ,CAACgB,MAAM;MAClC0J,YAAY,EAAE,IAAI,CAACzK,QAAQ,CAACe;IAC9B,CAAC;EACH;;EAEA;AACF;AACA;EACEsH,YAAYA,CAACqC,MAAM,EAAElJ,MAAM,EAAEmJ,OAAO,EAAE;IACpC,MAAMC,KAAK,GAAG;MACZC,EAAE,EAAEnN,MAAM,CAACyI,UAAU,CAAC,CAAC;MACvBuE,MAAM;MACNlJ,MAAM;MACNmJ,OAAO;MACP9D,SAAS,EAAE,IAAIlF,IAAI,CAAC,CAAC;MACrBmJ,SAAS,EAAEH,OAAO,CAACG,SAAS,IAAI;IAClC,CAAC;IAED,IAAI,CAAC9K,QAAQ,CAACqC,IAAI,CAACuI,KAAK,CAAC;;IAEzB;IACA,IAAI,IAAI,CAAC5K,QAAQ,CAACe,MAAM,GAAG,KAAK,EAAE;MAChC,IAAI,CAACf,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACsB,KAAK,CAAC,CAAC,KAAK,CAAC;IAC7C;IAEA,IAAI,CAACoC,IAAI,CAAC,cAAc,EAAEkH,KAAK,CAAC;EAClC;;EAEA;AACF;AACA;EACEG,WAAWA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;IACxB,IAAIC,IAAI,GAAG,IAAI,CAACjL,QAAQ;IAExB,IAAIgL,OAAO,CAACN,MAAM,EAAE;MAClBO,IAAI,GAAGA,IAAI,CAAC/I,MAAM,CAAEgJ,CAAC,IAAKA,CAAC,CAACR,MAAM,KAAKM,OAAO,CAACN,MAAM,CAAC;IACxD;IAEA,IAAIM,OAAO,CAACxJ,MAAM,EAAE;MAClByJ,IAAI,GAAGA,IAAI,CAAC/I,MAAM,CAAEgJ,CAAC,IAAKA,CAAC,CAAC1J,MAAM,KAAKwJ,OAAO,CAACxJ,MAAM,CAAC;IACxD;IAEA,IAAIwJ,OAAO,CAACG,SAAS,IAAIH,OAAO,CAACI,OAAO,EAAE;MACxCH,IAAI,GAAGA,IAAI,CAAC/I,MAAM,CAAEgJ,CAAC,IAAKA,CAAC,CAACrE,SAAS,IAAImE,OAAO,CAACG,SAAS,IAAID,CAAC,CAACrE,SAAS,IAAImE,OAAO,CAACI,OAAO,CAAC;IAC/F;IAEA,OAAOH,IAAI,CAAC3J,KAAK,CAACF,IAAI,CAACiK,GAAG,CAAC,CAAC,EAAEJ,IAAI,CAAClK,MAAM,IAAIiK,OAAO,CAACM,KAAK,IAAI,GAAG,CAAC,CAAC,CAAC;EACtE;;EAEA;AACF;AACA;EACE,MAAMC,WAAWA,CAAA,EAAG;IAClB,IAAI;MACF,MAAMzF,SAAS,GAAGnE,IAAI,CAACD,GAAG,CAAC,CAAC;MAC5B,MAAM0E,QAAQ,GAAG,MAAM9I,KAAK,CAAC0E,GAAG,CAAC,GAAG,IAAI,CAACnE,MAAM,CAACC,UAAU,SAAS,EAAE;QACnEU,OAAO,EAAE,IAAI;QACb0H,OAAO,EAAE;UACP,WAAW,EAAE,IAAI,CAACrI,MAAM,CAACK;QAC3B;MACF,CAAC,CAAC;MAEF,OAAO;QACLqI,MAAM,EAAE,SAAS;QACjBiF,WAAW,EAAEpF,QAAQ,CAACG,MAAM,KAAK,GAAG;QACpCC,YAAY,EAAE7E,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGoE,SAAS;QACpCe,SAAS,EAAE,IAAIlF,IAAI,CAAC;MACtB,CAAC;IACH,CAAC,CAAC,OAAOyD,KAAK,EAAE;MACd,OAAO;QACLmB,MAAM,EAAE,WAAW;QACnBnB,KAAK,EAAEA,KAAK,CAACb,OAAO;QACpBsC,SAAS,EAAE,IAAIlF,IAAI,CAAC;MACtB,CAAC;IACH;EACF;;EAEA;AACF;AACA;EACE8J,OAAOA,CAAA,EAAG;IACRC,aAAa,CAAC,IAAI,CAAC7K,eAAe,CAAC;IACnC,IAAI,CAACxB,KAAK,CAACgF,KAAK,CAAC,CAAC;IAClB,IAAI,CAAC9E,YAAY,GAAG,EAAE;IACtB,IAAI,CAACU,WAAW,CAACoE,KAAK,CAAC,CAAC;IACxB,IAAI,CAACsH,kBAAkB,CAAC,CAAC;IACzBlO,MAAM,CAACmD,IAAI,CAAC,gCAAgC,CAAC;EAC/C;AACF;AAEAgL,MAAM,CAACC,OAAO,GAAGlO,kBAAkB","ignoreList":[]}