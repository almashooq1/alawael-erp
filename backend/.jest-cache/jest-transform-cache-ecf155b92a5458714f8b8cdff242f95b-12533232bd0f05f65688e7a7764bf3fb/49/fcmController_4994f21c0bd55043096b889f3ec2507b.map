{"version":3,"names":["User","require","fcmController","registerToken","req","res","userId","user","_id","token","body","status","json","success","message","findById","fcmTokens","includes","push","save","error","unregisterToken","filter","t","module","exports"],"sources":["fcmController.js"],"sourcesContent":["// backend/controllers/fcmController.js\r\n// إدارة تسجيل توكنات FCM للمستخدمين\r\nconst User = require('../models/User');\r\n\r\nconst fcmController = {\r\n  /**\r\n   * إضافة أو تحديث توكن FCM للمستخدم الحالي\r\n   * POST /api/fcm/register\r\n   * body: { token: string }\r\n   */\r\n  registerToken: async (req, res) => {\r\n    try {\r\n      const userId = req.user._id;\r\n      const { token } = req.body;\r\n      if (!token) {\r\n        return res.status(400).json({ success: false, message: 'FCM token is required' });\r\n      }\r\n      const user = await User.findById(userId);\r\n      if (!user) {\r\n        return res.status(404).json({ success: false, message: 'User not found' });\r\n      }\r\n      if (!user.fcmTokens.includes(token)) {\r\n        user.fcmTokens.push(token);\r\n        await user.save();\r\n      }\r\n      res.status(200).json({ success: true, message: 'FCM token registered' });\r\n    } catch (error) {\r\n      res\r\n        .status(500)\r\n        .json({ success: false, message: 'Error registering FCM token', error: error.message });\r\n    }\r\n  },\r\n  /**\r\n   * حذف توكن FCM عند تسجيل الخروج\r\n   * POST /api/fcm/unregister\r\n   * body: { token: string }\r\n   */\r\n  unregisterToken: async (req, res) => {\r\n    try {\r\n      const userId = req.user._id;\r\n      const { token } = req.body;\r\n      if (!token) {\r\n        return res.status(400).json({ success: false, message: 'FCM token is required' });\r\n      }\r\n      const user = await User.findById(userId);\r\n      if (!user) {\r\n        return res.status(404).json({ success: false, message: 'User not found' });\r\n      }\r\n      user.fcmTokens = user.fcmTokens.filter(t => t !== token);\r\n      await user.save();\r\n      res.status(200).json({ success: true, message: 'FCM token unregistered' });\r\n    } catch (error) {\r\n      res\r\n        .status(500)\r\n        .json({ success: false, message: 'Error unregistering FCM token', error: error.message });\r\n    }\r\n  },\r\n};\r\n\r\nmodule.exports = fcmController;\r\n"],"mappings":"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","ignoreList":[]}