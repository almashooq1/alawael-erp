6ebdcaf3651f2efa25ab086f7d65e674
// Database Configuration
// ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™

const mongoose = require('mongoose');

// MongoDB Connection Configuration
const dbConfig = {
  development: {
    url: process.env.MONGODB_URL || 'mongodb://localhost:27017/erp_new',
    options: {
      retryWrites: false,
      serverSelectionTimeoutMS: 5000
    }
  },
  production: {
    url: process.env.MONGODB_PROD_URL || 'mongodb+srv://user:password@cluster.mongodb.net/erp_prod',
    options: {
      retryWrites: true,
      w: 'majority'
    }
  },
  test: {
    url: process.env.MONGODB_TEST_URL || 'mongodb://localhost:27017/erp_test',
    options: {
      retryWrites: false
    }
  }
};

// Get current environment config
const env = process.env.NODE_ENV || 'development';
const config = dbConfig[env];

// Connection function
const connectDB = async () => {
  // Check if using Mock DB
  if (process.env.USE_MOCK_DB === 'true') {
    console.log(`\nüì¶ Using Mock Database (Development Mode)`);
    console.log(`   Environment: ${env}`);
    console.log(`   ‚úÖ Mock DB ready - No MongoDB required\n`);
    return {
      connection: {
        host: 'mock',
        name: 'mock-db'
      }
    };
  }
  try {
    console.log(`\nüì° Connecting to MongoDB (${env})...`);
    console.log(`   URL: ${config.url}`);
    const conn = await mongoose.connect(config.url, config.options);
    console.log(`‚úÖ MongoDB connected successfully`);
    console.log(`   Host: ${conn.connection.host}`);
    console.log(`   Database: ${conn.connection.name}`);
    console.log(`   Collections: ${Object.keys(conn.connection.collections).length}\n`);
    return conn;
  } catch (error) {
    console.error(`\n‚ùå MongoDB connection failed:`);
    console.error(`   Error: ${error.message}`);
    console.error(`\nüí° TIP: Set USE_MOCK_DB=true in .env to use Mock DB\n`);
    process.exit(1);
  }
};

// Disconnect function
const disconnectDB = async () => {
  try {
    await mongoose.disconnect();
    console.log('‚úÖ MongoDB disconnected');
  } catch (error) {
    console.error('‚ùå Error disconnecting MongoDB:', error.message);
  }
};

// Connection event listeners
mongoose.connection.on('connected', () => {
  console.log('üîó Mongoose connected');
});
mongoose.connection.on('disconnected', () => {
  console.log('üîå Mongoose disconnected');
});
mongoose.connection.on('error', error => {
  console.error('‚ùå Mongoose connection error:', error.message);
});
module.exports = {
  connectDB,
  disconnectDB,
  mongoose
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJkYkNvbmZpZyIsImRldmVsb3BtZW50IiwidXJsIiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfVVJMIiwib3B0aW9ucyIsInJldHJ5V3JpdGVzIiwic2VydmVyU2VsZWN0aW9uVGltZW91dE1TIiwicHJvZHVjdGlvbiIsIk1PTkdPREJfUFJPRF9VUkwiLCJ3IiwidGVzdCIsIk1PTkdPREJfVEVTVF9VUkwiLCJOT0RFX0VOViIsImNvbmZpZyIsImNvbm5lY3REQiIsIlVTRV9NT0NLX0RCIiwiY29uc29sZSIsImxvZyIsImNvbm5lY3Rpb24iLCJob3N0IiwibmFtZSIsImNvbm4iLCJjb25uZWN0IiwiT2JqZWN0Iiwia2V5cyIsImNvbGxlY3Rpb25zIiwibGVuZ3RoIiwiZXJyb3IiLCJtZXNzYWdlIiwiZXhpdCIsImRpc2Nvbm5lY3REQiIsImRpc2Nvbm5lY3QiLCJvbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJkYXRhYmFzZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBEYXRhYmFzZSBDb25maWd1cmF0aW9uXHJcbi8vINil2LnYr9in2K/Yp9iqINmC2KfYudiv2Kkg2KfZhNio2YrYp9mG2KfYqlxyXG5cclxuY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5cclxuLy8gTW9uZ29EQiBDb25uZWN0aW9uIENvbmZpZ3VyYXRpb25cclxuY29uc3QgZGJDb25maWcgPSB7XHJcbiAgZGV2ZWxvcG1lbnQ6IHtcclxuICAgIHVybDogcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkwgfHwgJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvZXJwX25ldycsXHJcbiAgICBvcHRpb25zOiB7XHJcbiAgICAgIHJldHJ5V3JpdGVzOiBmYWxzZSxcclxuICAgICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiA1MDAwLFxyXG4gICAgfSxcclxuICB9LFxyXG4gIHByb2R1Y3Rpb246IHtcclxuICAgIHVybDogcHJvY2Vzcy5lbnYuTU9OR09EQl9QUk9EX1VSTCB8fCAnbW9uZ29kYitzcnY6Ly91c2VyOnBhc3N3b3JkQGNsdXN0ZXIubW9uZ29kYi5uZXQvZXJwX3Byb2QnLFxyXG4gICAgb3B0aW9uczoge1xyXG4gICAgICByZXRyeVdyaXRlczogdHJ1ZSxcclxuICAgICAgdzogJ21ham9yaXR5JyxcclxuICAgIH0sXHJcbiAgfSxcclxuICB0ZXN0OiB7XHJcbiAgICB1cmw6IHByb2Nlc3MuZW52Lk1PTkdPREJfVEVTVF9VUkwgfHwgJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvZXJwX3Rlc3QnLFxyXG4gICAgb3B0aW9uczoge1xyXG4gICAgICByZXRyeVdyaXRlczogZmFsc2UsXHJcbiAgICB9LFxyXG4gIH0sXHJcbn07XHJcblxyXG4vLyBHZXQgY3VycmVudCBlbnZpcm9ubWVudCBjb25maWdcclxuY29uc3QgZW52ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgJ2RldmVsb3BtZW50JztcclxuY29uc3QgY29uZmlnID0gZGJDb25maWdbZW52XTtcclxuXHJcbi8vIENvbm5lY3Rpb24gZnVuY3Rpb25cclxuY29uc3QgY29ubmVjdERCID0gYXN5bmMgKCkgPT4ge1xyXG4gIC8vIENoZWNrIGlmIHVzaW5nIE1vY2sgREJcclxuICBpZiAocHJvY2Vzcy5lbnYuVVNFX01PQ0tfREIgPT09ICd0cnVlJykge1xyXG4gICAgY29uc29sZS5sb2coYFxcbvCfk6YgVXNpbmcgTW9jayBEYXRhYmFzZSAoRGV2ZWxvcG1lbnQgTW9kZSlgKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICBFbnZpcm9ubWVudDogJHtlbnZ9YCk7XHJcbiAgICBjb25zb2xlLmxvZyhgICAg4pyFIE1vY2sgREIgcmVhZHkgLSBObyBNb25nb0RCIHJlcXVpcmVkXFxuYCk7XHJcbiAgICByZXR1cm4geyBjb25uZWN0aW9uOiB7IGhvc3Q6ICdtb2NrJywgbmFtZTogJ21vY2stZGInIH0gfTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZyhgXFxu8J+ToSBDb25uZWN0aW5nIHRvIE1vbmdvREIgKCR7ZW52fSkuLi5gKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICBVUkw6ICR7Y29uZmlnLnVybH1gKTtcclxuXHJcbiAgICBjb25zdCBjb25uID0gYXdhaXQgbW9uZ29vc2UuY29ubmVjdChjb25maWcudXJsLCBjb25maWcub3B0aW9ucyk7XHJcblxyXG4gICAgY29uc29sZS5sb2coYOKchSBNb25nb0RCIGNvbm5lY3RlZCBzdWNjZXNzZnVsbHlgKTtcclxuICAgIGNvbnNvbGUubG9nKGAgICBIb3N0OiAke2Nvbm4uY29ubmVjdGlvbi5ob3N0fWApO1xyXG4gICAgY29uc29sZS5sb2coYCAgIERhdGFiYXNlOiAke2Nvbm4uY29ubmVjdGlvbi5uYW1lfWApO1xyXG4gICAgY29uc29sZS5sb2coYCAgIENvbGxlY3Rpb25zOiAke09iamVjdC5rZXlzKGNvbm4uY29ubmVjdGlvbi5jb2xsZWN0aW9ucykubGVuZ3RofVxcbmApO1xyXG5cclxuICAgIHJldHVybiBjb25uO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBcXG7inYwgTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZDpgKTtcclxuICAgIGNvbnNvbGUuZXJyb3IoYCAgIEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICBjb25zb2xlLmVycm9yKGBcXG7wn5KhIFRJUDogU2V0IFVTRV9NT0NLX0RCPXRydWUgaW4gLmVudiB0byB1c2UgTW9jayBEQlxcbmApO1xyXG5cclxuICAgIHByb2Nlc3MuZXhpdCgxKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBEaXNjb25uZWN0IGZ1bmN0aW9uXHJcbmNvbnN0IGRpc2Nvbm5lY3REQiA9IGFzeW5jICgpID0+IHtcclxuICB0cnkge1xyXG4gICAgYXdhaXQgbW9uZ29vc2UuZGlzY29ubmVjdCgpO1xyXG4gICAgY29uc29sZS5sb2coJ+KchSBNb25nb0RCIGRpc2Nvbm5lY3RlZCcpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGlzY29ubmVjdGluZyBNb25nb0RCOicsIGVycm9yLm1lc3NhZ2UpO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIENvbm5lY3Rpb24gZXZlbnQgbGlzdGVuZXJzXHJcbm1vbmdvb3NlLmNvbm5lY3Rpb24ub24oJ2Nvbm5lY3RlZCcsICgpID0+IHtcclxuICBjb25zb2xlLmxvZygn8J+UlyBNb25nb29zZSBjb25uZWN0ZWQnKTtcclxufSk7XHJcblxyXG5tb25nb29zZS5jb25uZWN0aW9uLm9uKCdkaXNjb25uZWN0ZWQnLCAoKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ/CflIwgTW9uZ29vc2UgZGlzY29ubmVjdGVkJyk7XHJcbn0pO1xyXG5cclxubW9uZ29vc2UuY29ubmVjdGlvbi5vbignZXJyb3InLCBlcnJvciA9PiB7XHJcbiAgY29uc29sZS5lcnJvcign4p2MIE1vbmdvb3NlIGNvbm5lY3Rpb24gZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XHJcbn0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgY29ubmVjdERCLFxyXG4gIGRpc2Nvbm5lY3REQixcclxuICBtb25nb29zZSxcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBOztBQUVBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQzs7QUFFcEM7QUFDQSxNQUFNQyxRQUFRLEdBQUc7RUFDZkMsV0FBVyxFQUFFO0lBQ1hDLEdBQUcsRUFBRUMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFdBQVcsSUFBSSxtQ0FBbUM7SUFDbkVDLE9BQU8sRUFBRTtNQUNQQyxXQUFXLEVBQUUsS0FBSztNQUNsQkMsd0JBQXdCLEVBQUU7SUFDNUI7RUFDRixDQUFDO0VBQ0RDLFVBQVUsRUFBRTtJQUNWUCxHQUFHLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDTSxnQkFBZ0IsSUFBSSwwREFBMEQ7SUFDL0ZKLE9BQU8sRUFBRTtNQUNQQyxX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