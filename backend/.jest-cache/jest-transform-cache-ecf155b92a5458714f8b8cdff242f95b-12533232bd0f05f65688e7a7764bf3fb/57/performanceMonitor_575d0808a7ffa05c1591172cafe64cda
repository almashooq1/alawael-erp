cbce5b9d348c9cc86b1cb8866ebaf861
/**
 * Performance Monitoring Middleware
 * Track and analyze system performance
 * Phase 11: System Integration
 */

const logger = require('../utils/logger');
const systemDashboard = require('../services/systemDashboard');
class PerformanceMonitor {
  constructor() {
    this.metrics = {
      requests: {},
      slowQueries: [],
      errors: [],
      throughput: 0,
      startTime: Date.now()
    };
    this.slowThreshold = parseInt(process.env.SLOW_QUERY_MS || '100');
  }

  /**
   * Performance monitoring middleware
   */
  middleware() {
    return (req, res, next) => {
      const startTime = Date.now();
      const routeKey = `${req.method} ${req.path}`;

      // Track original send method
      const originalSend = res.send;
      res.send = function (data) {
        res.send = originalSend;
        const duration = Date.now() - startTime;
        const success = res.statusCode < 400;

        // Record metrics
        this.recordMetric(routeKey, duration, success, res.statusCode);
        systemDashboard.recordMetric(duration, success);

        // Log slow requests
        if (duration > this.slowThreshold) {
          this.recordSlowQuery(routeKey, duration, req.query);
        }
        return res.send(data);
      }.bind(this);
      next();
    };
  }

  /**
   * Record request metric
   */
  recordMetric(route, duration, success, statusCode) {
    if (!this.metrics.requests[route]) {
      this.metrics.requests[route] = {
        count: 0,
        totalTime: 0,
        minTime: Infinity,
        maxTime: 0,
        errors: 0,
        statusCodes: {}
      };
    }
    const metric = this.metrics.requests[route];
    metric.count++;
    metric.totalTime += duration;
    metric.minTime = Math.min(metric.minTime, duration);
    metric.maxTime = Math.max(metric.maxTime, duration);
    metric.statusCodes[statusCode] = (metric.statusCodes[statusCode] || 0) + 1;
    if (!success) {
      metric.errors++;
    }
    this.metrics.throughput++;
  }

  /**
   * Record slow query
   */
  recordSlowQuery(route, duration, params) {
    this.metrics.slowQueries.push({
      timestamp: new Date().toISOString(),
      route,
      duration,
      params: Object.keys(params).length > 0 ? params : null
    });

    // Keep only last 100 slow queries
    if (this.metrics.slowQueries.length > 100) {
      this.metrics.slowQueries.shift();
    }
    logger.warn(`⚠️  Slow query detected: ${route} (${duration}ms)`);
  }

  /**
   * Get performance summary
   */
  getSummary() {
    const routes = Object.entries(this.metrics.requests).map(([route, data]) => ({
      route,
      requests: data.count,
      avgTime: Math.round(data.totalTime / data.count),
      minTime: data.minTime,
      maxTime: data.maxTime,
      errorRate: `${(data.errors / data.count * 100).toFixed(2)}%`,
      statusCodes: data.statusCodes
    }));
    const uptime = (Date.now() - this.metrics.startTime) / 1000;
    return {
      summary: {
        totalRequests: this.metrics.throughput,
        throughput: `${(this.metrics.throughput / uptime).toFixed(2)} req/s`,
        slowQueries: this.metrics.slowQueries.length,
        uptime: `${Math.floor(uptime)}s`
      },
      topRoutes: routes.sort((a, b) => b.requests - a.requests).slice(0, 10),
      slowestRoutes: routes.sort((a, b) => b.avgTime - a.avgTime).slice(0, 10),
      recentSlowQueries: this.metrics.slowQueries.slice(-5)
    };
  }

  /**
   * Reset metrics
   */
  reset() {
    this.metrics = {
      requests: {},
      slowQueries: [],
      errors: [],
      throughput: 0,
      startTime: Date.now()
    };
  }
}
module.exports = new PerformanceMonitor();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwic3lzdGVtRGFzaGJvYXJkIiwiUGVyZm9ybWFuY2VNb25pdG9yIiwiY29uc3RydWN0b3IiLCJtZXRyaWNzIiwicmVxdWVzdHMiLCJzbG93UXVlcmllcyIsImVycm9ycyIsInRocm91Z2hwdXQiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93Iiwic2xvd1RocmVzaG9sZCIsInBhcnNlSW50IiwicHJvY2VzcyIsImVudiIsIlNMT1dfUVVFUllfTVMiLCJtaWRkbGV3YXJlIiwicmVxIiwicmVzIiwibmV4dCIsInJvdXRlS2V5IiwibWV0aG9kIiwicGF0aCIsIm9yaWdpbmFsU2VuZCIsInNlbmQiLCJkYXRhIiwiZHVyYXRpb24iLCJzdWNjZXNzIiwic3RhdHVzQ29kZSIsInJlY29yZE1ldHJpYyIsInJlY29yZFNsb3dRdWVyeSIsInF1ZXJ5IiwiYmluZCIsInJvdXRlIiwiY291bnQiLCJ0b3RhbFRpbWUiLCJtaW5UaW1lIiwiSW5maW5pdHkiLCJtYXhUaW1lIiwic3RhdHVzQ29kZXMiLCJtZXRyaWMiLCJNYXRoIiwibWluIiwibWF4IiwicGFyYW1zIiwicHVzaCIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInNoaWZ0Iiwid2FybiIsImdldFN1bW1hcnkiLCJyb3V0ZXMiLCJlbnRyaWVzIiwibWFwIiwiYXZnVGltZSIsInJvdW5kIiwiZXJyb3JSYXRlIiwidG9GaXhlZCIsInVwdGltZSIsInN1bW1hcnkiLCJ0b3RhbFJlcXVlc3RzIiwiZmxvb3IiLCJ0b3BSb3V0ZXMiLCJzb3J0IiwiYSIsImIiLCJzbGljZSIsInNsb3dlc3RSb3V0ZXMiLCJyZWNlbnRTbG93UXVlcmllcyIsInJlc2V0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInBlcmZvcm1hbmNlTW9uaXRvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBlcmZvcm1hbmNlIE1vbml0b3JpbmcgTWlkZGxld2FyZVxuICogVHJhY2sgYW5kIGFuYWx5emUgc3lzdGVtIHBlcmZvcm1hbmNlXG4gKiBQaGFzZSAxMTogU3lzdGVtIEludGVncmF0aW9uXG4gKi9cblxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XG5jb25zdCBzeXN0ZW1EYXNoYm9hcmQgPSByZXF1aXJlKCcuLi9zZXJ2aWNlcy9zeXN0ZW1EYXNoYm9hcmQnKTtcblxuY2xhc3MgUGVyZm9ybWFuY2VNb25pdG9yIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5tZXRyaWNzID0ge1xuICAgICAgcmVxdWVzdHM6IHt9LFxuICAgICAgc2xvd1F1ZXJpZXM6IFtdLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHRocm91Z2hwdXQ6IDAsXG4gICAgICBzdGFydFRpbWU6IERhdGUubm93KCksXG4gICAgfTtcbiAgICB0aGlzLnNsb3dUaHJlc2hvbGQgPSBwYXJzZUludChwcm9jZXNzLmVudi5TTE9XX1FVRVJZX01TIHx8ICcxMDAnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtYW5jZSBtb25pdG9yaW5nIG1pZGRsZXdhcmVcbiAgICovXG4gIG1pZGRsZXdhcmUoKSB7XG4gICAgcmV0dXJuIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHJvdXRlS2V5ID0gYCR7cmVxLm1ldGhvZH0gJHtyZXEucGF0aH1gO1xuXG4gICAgICAvLyBUcmFjayBvcmlnaW5hbCBzZW5kIG1ldGhvZFxuICAgICAgY29uc3Qgb3JpZ2luYWxTZW5kID0gcmVzLnNlbmQ7XG4gICAgICByZXMuc2VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJlcy5zZW5kID0gb3JpZ2luYWxTZW5kO1xuXG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IHJlcy5zdGF0dXNDb2RlIDwgNDAwO1xuXG4gICAgICAgIC8vIFJlY29yZCBtZXRyaWNzXG4gICAgICAgIHRoaXMucmVjb3JkTWV0cmljKHJvdXRlS2V5LCBkdXJhdGlvbiwgc3VjY2VzcywgcmVzLnN0YXR1c0NvZGUpO1xuICAgICAgICBzeXN0ZW1EYXNoYm9hcmQucmVjb3JkTWV0cmljKGR1cmF0aW9uLCBzdWNjZXNzKTtcblxuICAgICAgICAvLyBMb2cgc2xvdyByZXF1ZXN0c1xuICAgICAgICBpZiAoZHVyYXRpb24gPiB0aGlzLnNsb3dUaHJlc2hvbGQpIHtcbiAgICAgICAgICB0aGlzLnJlY29yZFNsb3dRdWVyeShyb3V0ZUtleSwgZHVyYXRpb24sIHJlcS5xdWVyeSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzLnNlbmQoZGF0YSk7XG4gICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgIG5leHQoKTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCByZXF1ZXN0IG1ldHJpY1xuICAgKi9cbiAgcmVjb3JkTWV0cmljKHJvdXRlLCBkdXJhdGlvbiwgc3VjY2Vzcywgc3RhdHVzQ29kZSkge1xuICAgIGlmICghdGhpcy5tZXRyaWNzLnJlcXVlc3RzW3JvdXRlXSkge1xuICAgICAgdGhpcy5tZXRyaWNzLnJlcXVlc3RzW3JvdXRlXSA9IHtcbiAgICAgICAgY291bnQ6IDAsXG4gICAgICAgIHRvdGFsVGltZTogMCxcbiAgICAgICAgbWluVGltZTogSW5maW5pdHksXG4gICAgICAgIG1heFRpbWU6IDAsXG4gICAgICAgIGVycm9yczogMCxcbiAgICAgICAgc3RhdHVzQ29kZXM6IHt9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBtZXRyaWMgPSB0aGlzLm1ldHJpY3MucmVxdWVzdHNbcm91dGVdO1xuICAgIG1ldHJpYy5jb3VudCsrO1xuICAgIG1ldHJpYy50b3RhbFRpbWUgKz0gZHVyYXRpb247XG4gICAgbWV0cmljLm1pblRpbWUgPSBNYXRoLm1pbihtZXRyaWMubWluVGltZSwgZHVyYXRpb24pO1xuICAgIG1ldHJpYy5tYXhUaW1lID0gTWF0aC5tYXgobWV0cmljLm1heFRpbWUsIGR1cmF0aW9uKTtcbiAgICBtZXRyaWMuc3RhdHVzQ29kZXNbc3RhdHVzQ29kZV0gPSAobWV0cmljLnN0YXR1c0NvZGVzW3N0YXR1c0NvZGVdIHx8IDApICsgMTtcblxuICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgbWV0cmljLmVycm9ycysrO1xuICAgIH1cblxuICAgIHRoaXMubWV0cmljcy50aHJvdWdocHV0Kys7XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIHNsb3cgcXVlcnlcbiAgICovXG4gIHJlY29yZFNsb3dRdWVyeShyb3V0ZSwgZHVyYXRpb24sIHBhcmFtcykge1xuICAgIHRoaXMubWV0cmljcy5zbG93UXVlcmllcy5wdXNoKHtcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgcm91dGUsXG4gICAgICBkdXJhdGlvbixcbiAgICAgIHBhcmFtczogT2JqZWN0LmtleXMocGFyYW1zKS5sZW5ndGggPiAwID8gcGFyYW1zIDogbnVsbCxcbiAgICB9KTtcblxuICAgIC8vIEtlZXAgb25seSBsYXN0IDEwMCBzbG93IHF1ZXJpZXNcbiAgICBpZiAodGhpcy5tZXRyaWNzLnNsb3dRdWVyaWVzLmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5tZXRyaWNzLnNsb3dRdWVyaWVzLnNoaWZ0KCk7XG4gICAgfVxuXG4gICAgbG9nZ2VyLndhcm4oYOKaoO+4jyAgU2xvdyBxdWVyeSBkZXRlY3RlZDogJHtyb3V0ZX0gKCR7ZHVyYXRpb259bXMpYCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHBlcmZvcm1hbmNlIHN1bW1hcnlcbiAgICovXG4gIGdldFN1bW1hcnkoKSB7XG4gICAgY29uc3Qgcm91dGVzID0gT2JqZWN0LmVudHJpZXModGhpcy5tZXRyaWNzLnJlcXVlc3RzKS5tYXAoKFtyb3V0ZSwgZGF0YV0pID0+ICh7XG4gICAgICByb3V0ZSxcbiAgICAgIHJlcXVlc3RzOiBkYXRhLmNvdW50LFxuICAgICAgYXZnVGltZTogTWF0aC5yb3VuZChkYXRhLnRvdGFsVGltZSAvIGRhdGEuY291bnQpLFxuICAgICAgbWluVGltZTogZGF0YS5taW5UaW1lLFxuICAgICAgbWF4VGltZTogZGF0YS5tYXhUaW1lLFxuICAgICAgZXJyb3JSYXRlOiBgJHsoKGRhdGEuZXJyb3JzIC8gZGF0YS5jb3VudCkgKiAxMDApLnRvRml4ZWQoMil9JWAsXG4gICAgICBzdGF0dXNDb2RlczogZGF0YS5zdGF0dXNDb2RlcyxcbiAgICB9KSk7XG5cbiAgICBjb25zdCB1cHRpbWUgPSAoRGF0ZS5ub3coKSAtIHRoaXMubWV0cmljcy5zdGFydFRpbWUpIC8gMTAwMDtcblxuICAgIHJldHVybiB7XG4gICAgICBzdW1tYXJ5OiB7XG4gICAgICAgIHRvdGFsUmVxdWVzdHM6IHRoaXMubWV0cmljcy50aHJvdWdocHV0LFxuICAgICAgICB0aHJvdWdocHV0OiBgJHsodGhpcy5tZXRyaWNzLnRocm91Z2hwdXQgLyB1cHRpbWUpLnRvRml4ZWQoMil9IHJlcS9zYCxcbiAgICAgICAgc2xvd1F1ZXJpZXM6IHRoaXMubWV0cmljcy5zbG93UXVlcmllcy5sZW5ndGgsXG4gICAgICAgIHVwdGltZTogYCR7TWF0aC5mbG9vcih1cHRpbWUpfXNgLFxuICAgICAgfSxcbiAgICAgIHRvcFJvdXRlczogcm91dGVzLnNvcnQoKGEsIGIpID0+IGIucmVxdWVzdHMgLSBhLnJlcXVlc3RzKS5zbGljZSgwLCAxMCksXG4gICAgICBzbG93ZXN0Um91dGVzOiByb3V0ZXMuc29ydCgoYSwgYikgPT4gYi5hdmdUaW1lIC0gYS5hdmdUaW1lKS5zbGljZSgwLCAxMCksXG4gICAgICByZWNlbnRTbG93UXVlcmllczogdGhpcy5tZXRyaWNzLnNsb3dRdWVyaWVzLnNsaWNlKC01KSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IG1ldHJpY3NcbiAgICovXG4gIHJlc2V0KCkge1xuICAgIHRoaXMubWV0cmljcyA9IHtcbiAgICAgIHJlcXVlc3RzOiB7fSxcbiAgICAgIHNsb3dRdWVyaWVzOiBbXSxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB0aHJvdWdocHV0OiAwLFxuICAgICAgc3RhcnRUaW1lOiBEYXRlLm5vdygpLFxuICAgIH07XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgUGVyZm9ybWFuY2VNb25pdG9yKCk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDekMsTUFBTUMsZUFBZSxHQUFHRCxPQUFPLENBQUMsNkJBQTZCLENBQUM7QUFFOUQsTUFBTUUsa0JBQWtCLENBQUM7RUFDdkJDLFdBQVdBLENBQUEsRUFBRztJQUNaLElBQUksQ0FBQ0MsT0FBTyxHQUFHO01BQ2JDLFFBQVEsRUFBRSxDQUFDLENBQUM7TUFDWkMsV0FBVyxFQUFFLEVBQUU7TUFDZkMsTUFBTSxFQUFFLEVBQUU7TUFDVkMsVUFBVSxFQUFFLENBQUM7TUFDYkMsU0FBUyxFQUFFQyxJQUFJLENBQUNDLEdBQUcsQ0FBQztJQUN0QixDQUFDO0lBQ0QsSUFBSSxDQUFDQyxhQUFhLEdBQUdDLFFBQVEsQ0FBQ0MsT0FBTyxDQUFDQyxHQUFHLENBQUNDLGFBQWEsSUFBSSxLQUFLLENBQUM7RUFDbkU7O0VBRUE7QUFDRjtBQUNBO0VBQ0VDLFVBQVVBLENBQUEsRUFBRztJQUNYLE9BQU8sQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztNQUN6QixNQUFNWCxTQUFTLEdBQUdDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUM7TUFDNUIsTUFBTVUsUUFBUSxHQUFHLEdBQUdILEdBQUcsQ0FBQ0ksTUFBTSxJQUFJSixHQUFHLENBQUNLLElBQUksRUFBRTs7TUFFNUM7TUFDQSxNQUFNQyxZQUFZLEdBQUdMLEdBQUcsQ0FBQ00sSUFBSTtNQUM3Qk4sR0FBRyxDQUFDTSxJQUFJLEdBQUcsVUFBVUMsSUFB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