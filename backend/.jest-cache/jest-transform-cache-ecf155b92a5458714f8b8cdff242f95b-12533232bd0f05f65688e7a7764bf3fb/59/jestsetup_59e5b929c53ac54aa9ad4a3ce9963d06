2bad9915f80a7363fcff1ed295dd9695
const {
  MongoMemoryServer
} = require('mongodb-memory-server');
const mongoose = require('mongoose');
let mongo;
beforeAll(async () => {
  // Ensure test-friendly env
  process.env.NODE_ENV = process.env.NODE_ENV || 'test';
  process.env.JWT_SECRET = process.env.JWT_SECRET || 'test_secret_key';
  // Disable mock DB so Mongoose connects to memory server
  process.env.USE_MOCK_DB = 'false';
  // Keep cache mocked to avoid external dependencies
  process.env.USE_MOCK_CACHE = process.env.USE_MOCK_CACHE || 'true';
  try {
    mongo = await MongoMemoryServer.create();
    const uri = mongo.getUri();
    await mongoose.connect(uri, {
      dbName: 'beneficiary_portal_test'
    });
  } catch (error) {
    console.error('MongoDB setup failed:', error);
    throw error;
  }
});
afterEach(async () => {
  // Clear all collections after each test
  try {
    if (mongoose.connection && mongoose.connection.db) {
      const collections = await mongoose.connection.db.listCollections().toArray();
      for (const {
        name
      } of collections) {
        const collection = mongoose.connection.db.collection(name);
        await collection.deleteMany({});
      }
    }
  } catch (error) {
    console.warn('Error clearing collections:', error);
  }
});
afterAll(async () => {
  // Disconnect and stop MongoDB memory server
  try {
    await mongoose.disconnect();
  } catch (error) {
    console.warn('Error disconnecting mongoose:', error);
  }
  if (mongo) {
    try {
      await mongo.stop();
    } catch (error) {
      console.warn('Error stopping MongoMemoryServer:', error);
    }
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNb25nb01lbW9yeVNlcnZlciIsInJlcXVpcmUiLCJtb25nb29zZSIsIm1vbmdvIiwiYmVmb3JlQWxsIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiSldUX1NFQ1JFVCIsIlVTRV9NT0NLX0RCIiwiVVNFX01PQ0tfQ0FDSEUiLCJjcmVhdGUiLCJ1cmkiLCJnZXRVcmkiLCJjb25uZWN0IiwiZGJOYW1lIiwiZXJyb3IiLCJjb25zb2xlIiwiYWZ0ZXJFYWNoIiwiY29ubmVjdGlvbiIsImRiIiwiY29sbGVjdGlvbnMiLCJsaXN0Q29sbGVjdGlvbnMiLCJ0b0FycmF5IiwibmFtZSIsImNvbGxlY3Rpb24iLCJkZWxldGVNYW55Iiwid2FybiIsImFmdGVyQWxsIiwiZGlzY29ubmVjdCIsInN0b3AiXSwic291cmNlcyI6WyJqZXN0LnNldHVwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgTW9uZ29NZW1vcnlTZXJ2ZXIgfSA9IHJlcXVpcmUoJ21vbmdvZGItbWVtb3J5LXNlcnZlcicpO1xyXG5jb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG5sZXQgbW9uZ287XHJcblxyXG5iZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xyXG4gIC8vIEVuc3VyZSB0ZXN0LWZyaWVuZGx5IGVudlxyXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgJ3Rlc3QnO1xyXG4gIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd0ZXN0X3NlY3JldF9rZXknO1xyXG4gIC8vIERpc2FibGUgbW9jayBEQiBzbyBNb25nb29zZSBjb25uZWN0cyB0byBtZW1vcnkgc2VydmVyXHJcbiAgcHJvY2Vzcy5lbnYuVVNFX01PQ0tfREIgPSAnZmFsc2UnO1xyXG4gIC8vIEtlZXAgY2FjaGUgbW9ja2VkIHRvIGF2b2lkIGV4dGVybmFsIGRlcGVuZGVuY2llc1xyXG4gIHByb2Nlc3MuZW52LlVTRV9NT0NLX0NBQ0hFID0gcHJvY2Vzcy5lbnYuVVNFX01PQ0tfQ0FDSEUgfHwgJ3RydWUnO1xyXG5cclxuICB0cnkge1xyXG4gICAgbW9uZ28gPSBhd2FpdCBNb25nb01lbW9yeVNlcnZlci5jcmVhdGUoKTtcclxuICAgIGNvbnN0IHVyaSA9IG1vbmdvLmdldFVyaSgpO1xyXG5cclxuICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QodXJpLCB7XHJcbiAgICAgIGRiTmFtZTogJ2JlbmVmaWNpYXJ5X3BvcnRhbF90ZXN0JyxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIHNldHVwIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn0pO1xyXG5cclxuYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcclxuICAvLyBDbGVhciBhbGwgY29sbGVjdGlvbnMgYWZ0ZXIgZWFjaCB0ZXN0XHJcbiAgdHJ5IHtcclxuICAgIGlmIChtb25nb29zZS5jb25uZWN0aW9uICYmIG1vbmdvb3NlLmNvbm5lY3Rpb24uZGIpIHtcclxuICAgICAgY29uc3QgY29sbGVjdGlvbnMgPSBhd2FpdCBtb25nb29zZS5jb25uZWN0aW9uLmRiLmxpc3RDb2xsZWN0aW9ucygpLnRvQXJyYXkoKTtcclxuICAgICAgZm9yIChjb25zdCB7IG5hbWUgfSBvZiBjb2xsZWN0aW9ucykge1xyXG4gICAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSBtb25nb29zZS5jb25uZWN0aW9uLmRiLmNvbGxlY3Rpb24obmFtZSk7XHJcbiAgICAgICAgYXdhaXQgY29sbGVjdGlvbi5kZWxldGVNYW55KHt9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGNsZWFyaW5nIGNvbGxlY3Rpb25zOicsIGVycm9yKTtcclxuICB9XHJcbn0pO1xyXG5cclxuYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xyXG4gIC8vIERpc2Nvbm5lY3QgYW5kIHN0b3AgTW9uZ29EQiBtZW1vcnkgc2VydmVyXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IG1vbmdvb3NlLmRpc2Nvbm5lY3QoKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS53YXJuKCdFcnJvciBkaXNjb25uZWN0aW5nIG1vbmdvb3NlOicsIGVycm9yKTtcclxuICB9XHJcblxyXG4gIGlmIChtb25nbykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgbW9uZ28uc3RvcCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBzdG9wcGluZyBNb25nb01lbW9yeVNlcnZlcjonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG59KTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNO0VBQUVBO0FBQWtCLENBQUMsR0FBR0MsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQzlELE1BQU1DLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUVwQyxJQUFJRSxLQUFLO0FBRVRDLFNBQVMsQ0FBQyxZQUFZO0VBQ3BCO0VBQ0FDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLEdBQUdGLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLElBQUksTUFBTTtFQUNyREYsT0FBTyxDQUFDQyxHQUFHLENBQUNFLFVBQVUsR0FBR0gsT0FBTyxDQUFDQyxHQUFHLENBQUNFLFVBQVUsSUFBSSxpQkFBaUI7RUFDcEU7RUFDQUgsT0FBTyxDQUFDQyxHQUFHLENBQUNHLFdBQVcsR0FBRyxPQUFPO0VBQ2pDO0VBQ0FKLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDSSxjQUFjLEdBQUdMLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDSSxjQUFjLElBQUksTUFBTTtFQUVqRSxJQUFJO0lBQ0ZQLEtBQUssR0FBRyxNQUFNSCxpQkFBaUIsQ0FBQ1csTUFBTSxDQUFDLENBQUM7SUFDeEMsTUFBTUMsR0FBRyxHQUFHVCxLQUFLLENBQUNVLE1BQU0sQ0FBQyxDQUFDO0lBRTFCLE1BQU1YLFFBQVEsQ0FBQ1ksT0FBTyxDQUFDRixHQUFHLEVBQUU7TUFDMUJHLE1BQU0sRUFBRTtJQUNWLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQyxPQUFPQyxLQUFLLEVBQUU7SUFDZEMsT0FBTyxDQUFDRCxLQUFLLENBQUMsdUJBQXVCLEVBQUVBLEtBQUssQ0FBQztJQUM3QyxNQUFNQSxLQUFLO0VBQ2I7QUFDRixDQUFDLENBQUM7QUFFRkUsU0FBUyxDQUFDLFlBQVk7RUFDcEI7RUFDQSxJQUFJO0lBQ0YsSUFBSWhCLFFBQVEsQ0FBQ2lCLFVBQVUsSUFBSWpCLFFBQVEsQ0FBQ2lCLFVBQVUsQ0FBQ0MsRUFBRSxFQUFFO01BQ2pELE1BQU1DLFdBQVcsR0FBRyxNQUFNbkIsUUFBUSxDQUFDaUIsVUFBVSxDQUFDQyxFQUFFLENBQUNFLGVBQWUsQ0FBQyxDQUFDLENBQUNDLE9BQU8sQ0FBQyxDQUFDO01BQzVFLEtBQUssTUFBTTtRQUFFQztNQUFLLENBQUMsSUFBSUgsV0FBVyxFQUFFO1FBQ2xDLE1BQU1JLFVBQVUsR0FBR3ZCLFFBQVEsQ0FBQ2lCLFVBQVUsQ0FBQ0MsRUFBRSxDQUFDSyxVQUFVLENBQUNELElBQUksQ0FBQztRQUMxRCxNQUFNQyxVQUFVLENBQUNDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztNQUNqQztJQUNGO0VBQ0YsQ0FBQyxDQUFDLE9BQU9WLEtBQUssRUFBRTtJQUNkQyxPQUFPLENBQUNVLElBQUksQ0FBQyw2QkFBNkIsRUFBRVgsS0FBSyxDQUFDO0VBQ3BEO0FBQ0YsQ0FBQyxDQUFDO0FBRUZZLFFBQVEsQ0FBQyxZQUFZO0VBQ25CO0VBQ0EsSUFBSTtJQUNGLE1BQU0xQixRQUFRLENBQUMyQixVQUFVLENBQUMsQ0FBQztFQUM3QixDQUFDLENBQUMsT0FBT2IsS0FBSyxFQUFFO0lBQ2RDLE9BQU8sQ0FBQ1UsSUFBSSxDQUFDLCtCQUErQixFQUFFWCxLQUFLLENBQUM7RUFDdEQ7RUFFQSxJQUFJYixLQUFLLEVBQUU7SUFDVCxJQUFJO01BQ0YsTUFBTUEsS0FBSyxDQUFDMkIsSUFBSSxDQUFDLENBQUM7SUFDcEIsQ0FBQyxDQUFDLE9BQU9kLEtBQUssRUFBRTtNQUNkQyxPQUFPLENBQUNVLElBQUksQ0FBQyxtQ0FBbUMsRUFBRVgsS0FBSyxDQUFDO0lBQzFEO0VBQ0Y7QUFDRixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=