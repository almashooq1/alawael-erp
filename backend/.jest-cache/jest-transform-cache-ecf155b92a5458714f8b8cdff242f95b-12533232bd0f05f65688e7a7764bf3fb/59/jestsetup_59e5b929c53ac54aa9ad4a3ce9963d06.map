{"version":3,"names":["MongoMemoryServer","require","mongoose","mongo","beforeAll","process","env","NODE_ENV","JWT_SECRET","USE_MOCK_DB","USE_MOCK_CACHE","create","uri","getUri","connect","dbName","error","console","afterEach","connection","db","collections","listCollections","toArray","name","collection","deleteMany","warn","afterAll","disconnect","stop"],"sources":["jest.setup.js"],"sourcesContent":["const { MongoMemoryServer } = require('mongodb-memory-server');\r\nconst mongoose = require('mongoose');\r\n\r\nlet mongo;\r\n\r\nbeforeAll(async () => {\r\n  // Ensure test-friendly env\r\n  process.env.NODE_ENV = process.env.NODE_ENV || 'test';\r\n  process.env.JWT_SECRET = process.env.JWT_SECRET || 'test_secret_key';\r\n  // Disable mock DB so Mongoose connects to memory server\r\n  process.env.USE_MOCK_DB = 'false';\r\n  // Keep cache mocked to avoid external dependencies\r\n  process.env.USE_MOCK_CACHE = process.env.USE_MOCK_CACHE || 'true';\r\n\r\n  try {\r\n    mongo = await MongoMemoryServer.create();\r\n    const uri = mongo.getUri();\r\n\r\n    await mongoose.connect(uri, {\r\n      dbName: 'beneficiary_portal_test',\r\n    });\r\n  } catch (error) {\r\n    console.error('MongoDB setup failed:', error);\r\n    throw error;\r\n  }\r\n});\r\n\r\nafterEach(async () => {\r\n  // Clear all collections after each test\r\n  try {\r\n    if (mongoose.connection && mongoose.connection.db) {\r\n      const collections = await mongoose.connection.db.listCollections().toArray();\r\n      for (const { name } of collections) {\r\n        const collection = mongoose.connection.db.collection(name);\r\n        await collection.deleteMany({});\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.warn('Error clearing collections:', error);\r\n  }\r\n});\r\n\r\nafterAll(async () => {\r\n  // Disconnect and stop MongoDB memory server\r\n  try {\r\n    await mongoose.disconnect();\r\n  } catch (error) {\r\n    console.warn('Error disconnecting mongoose:', error);\r\n  }\r\n\r\n  if (mongo) {\r\n    try {\r\n      await mongo.stop();\r\n    } catch (error) {\r\n      console.warn('Error stopping MongoMemoryServer:', error);\r\n    }\r\n  }\r\n});\r\n"],"mappings":"AAAA,MAAM;EAAEA;AAAkB,CAAC,GAAGC,OAAO,CAAC,uBAAuB,CAAC;AAC9D,MAAMC,QAAQ,GAAGD,OAAO,CAAC,UAAU,CAAC;AAEpC,IAAIE,KAAK;AAETC,SAAS,CAAC,YAAY;EACpB;EACAC,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAGF,OAAO,CAACC,GAAG,CAACC,QAAQ,IAAI,MAAM;EACrDF,OAAO,CAACC,GAAG,CAACE,UAAU,GAAGH,OAAO,CAACC,GAAG,CAACE,UAAU,IAAI,iBAAiB;EACpE;EACAH,OAAO,CAACC,GAAG,CAACG,WAAW,GAAG,OAAO;EACjC;EACAJ,OAAO,CAACC,GAAG,CAACI,cAAc,GAAGL,OAAO,CAACC,GAAG,CAACI,cAAc,IAAI,MAAM;EAEjE,IAAI;IACFP,KAAK,GAAG,MAAMH,iBAAiB,CAACW,MAAM,CAAC,CAAC;IACxC,MAAMC,GAAG,GAAGT,KAAK,CAACU,MAAM,CAAC,CAAC;IAE1B,MAAMX,QAAQ,CAACY,OAAO,CAACF,GAAG,EAAE;MAC1BG,MAAM,EAAE;IACV,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;IAC7C,MAAMA,KAAK;EACb;AACF,CAAC,CAAC;AAEFE,SAAS,CAAC,YAAY;EACpB;EACA,IAAI;IACF,IAAIhB,QAAQ,CAACiB,UAAU,IAAIjB,QAAQ,CAACiB,UAAU,CAACC,EAAE,EAAE;MACjD,MAAMC,WAAW,GAAG,MAAMnB,QAAQ,CAACiB,UAAU,CAACC,EAAE,CAACE,eAAe,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;MAC5E,KAAK,MAAM;QAAEC;MAAK,CAAC,IAAIH,WAAW,EAAE;QAClC,MAAMI,UAAU,GAAGvB,QAAQ,CAACiB,UAAU,CAACC,EAAE,CAACK,UAAU,CAACD,IAAI,CAAC;QAC1D,MAAMC,UAAU,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC;MACjC;IACF;EACF,CAAC,CAAC,OAAOV,KAAK,EAAE;IACdC,OAAO,CAACU,IAAI,CAAC,6BAA6B,EAAEX,KAAK,CAAC;EACpD;AACF,CAAC,CAAC;AAEFY,QAAQ,CAAC,YAAY;EACnB;EACA,IAAI;IACF,MAAM1B,QAAQ,CAAC2B,UAAU,CAAC,CAAC;EAC7B,CAAC,CAAC,OAAOb,KAAK,EAAE;IACdC,OAAO,CAACU,IAAI,CAAC,+BAA+B,EAAEX,KAAK,CAAC;EACtD;EAEA,IAAIb,KAAK,EAAE;IACT,IAAI;MACF,MAAMA,KAAK,CAAC2B,IAAI,CAAC,CAAC;IACpB,CAAC,CAAC,OAAOd,KAAK,EAAE;MACdC,OAAO,CAACU,IAAI,CAAC,mCAAmC,EAAEX,KAAK,CAAC;IAC1D;EACF;AACF,CAAC,CAAC","ignoreList":[]}