d6d837f716797d1f7a26af9295f1e807
const express = require('express');
const router = express.Router();
const ReportService = require('../services/reportService');
const {
  ApiResponse,
  ApiError
} = require('../utils/apiResponse');

// Generate Report
router.post('/generate', async (req, res, next) => {
  try {
    const report = await ReportService.generateReport(req.body);
    return res.json(new ApiResponse(200, report, 'Report generated'));
  } catch (err) {
    return next(new ApiError(400, 'Failed to generate report', [err.message]));
  }
});

// Get All Reports
router.get('/all', async (req, res, next) => {
  try {
    const limit = req.query.limit || 50;
    const reports = await ReportService.getAllReports(parseInt(limit));
    return res.json(new ApiResponse(200, reports, 'Reports fetched'));
  } catch (err) {
    return next(new ApiError(400, 'Failed to fetch reports', [err.message]));
  }
});

// Export to CSV
router.post('/export/csv', async (req, res, next) => {
  try {
    const result = ReportService.exportToCSV(req.body.report);
    res.setHeader('Content-Type', result.mimeType);
    res.setHeader('Content-Disposition', `attachment; filename="${result.fileName}"`);
    res.send(result.content);
  } catch (err) {
    return next(new ApiError(400, 'Failed to export to CSV', [err.message]));
  }
});

// Export to JSON
router.post('/export/json', async (req, res, next) => {
  try {
    const result = ReportService.exportToJSON(req.body.report);
    return res.json(new ApiResponse(200, result, 'Report exported to JSON'));
  } catch (err) {
    return next(new ApiError(400, 'Failed to export to JSON', [err.message]));
  }
});

// Export to Excel
router.post('/export/excel', async (req, res, next) => {
  try {
    const result = ReportService.exportToExcel(req.body.report);
    return res.json(new ApiResponse(200, result, 'Report exported to Excel'));
  } catch (err) {
    return next(new ApiError(400, 'Failed to export to Excel', [err.message]));
  }
});

// Delete Report
router.delete('/:id', async (req, res, next) => {
  try {
    const result = await ReportService.deleteReport(req.params.id);
    return res.json(new ApiResponse(200, result, 'Report deleted'));
  } catch (err) {
    return next(new ApiError(400, 'Failed to delete report', [err.message]));
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlJlcG9ydFNlcnZpY2UiLCJBcGlSZXNwb25zZSIsIkFwaUVycm9yIiwicG9zdCIsInJlcSIsInJlcyIsIm5leHQiLCJyZXBvcnQiLCJnZW5lcmF0ZVJlcG9ydCIsImJvZHkiLCJqc29uIiwiZXJyIiwibWVzc2FnZSIsImdldCIsImxpbWl0IiwicXVlcnkiLCJyZXBvcnRzIiwiZ2V0QWxsUmVwb3J0cyIsInBhcnNlSW50IiwicmVzdWx0IiwiZXhwb3J0VG9DU1YiLCJzZXRIZWFkZXIiLCJtaW1lVHlwZSIsImZpbGVOYW1lIiwic2VuZCIsImNvbnRlbnQiLCJleHBvcnRUb0pTT04iLCJleHBvcnRUb0V4Y2VsIiwiZGVsZXRlIiwiZGVsZXRlUmVwb3J0IiwicGFyYW1zIiwiaWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmVwb3J0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCBSZXBvcnRTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvcmVwb3J0U2VydmljZScpO1xyXG5jb25zdCB7IEFwaVJlc3BvbnNlLCBBcGlFcnJvciB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvYXBpUmVzcG9uc2UnKTtcclxuXHJcbi8vIEdlbmVyYXRlIFJlcG9ydFxyXG5yb3V0ZXIucG9zdCgnL2dlbmVyYXRlJywgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IFJlcG9ydFNlcnZpY2UuZ2VuZXJhdGVSZXBvcnQocmVxLmJvZHkpO1xyXG4gICAgcmV0dXJuIHJlcy5qc29uKG5ldyBBcGlSZXNwb25zZSgyMDAsIHJlcG9ydCwgJ1JlcG9ydCBnZW5lcmF0ZWQnKSk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNDAwLCAnRmFpbGVkIHRvIGdlbmVyYXRlIHJlcG9ydCcsIFtlcnIubWVzc2FnZV0pKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gR2V0IEFsbCBSZXBvcnRzXHJcbnJvdXRlci5nZXQoJy9hbGwnLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgbGltaXQgPSByZXEucXVlcnkubGltaXQgfHwgNTA7XHJcbiAgICBjb25zdCByZXBvcnRzID0gYXdhaXQgUmVwb3J0U2VydmljZS5nZXRBbGxSZXBvcnRzKHBhcnNlSW50KGxpbWl0KSk7XHJcbiAgICByZXR1cm4gcmVzLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVwb3J0cywgJ1JlcG9ydHMgZmV0Y2hlZCcpKTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig0MDAsICdGYWlsZWQgdG8gZmV0Y2ggcmVwb3J0cycsIFtlcnIubWVzc2FnZV0pKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gRXhwb3J0IHRvIENTVlxyXG5yb3V0ZXIucG9zdCgnL2V4cG9ydC9jc3YnLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gUmVwb3J0U2VydmljZS5leHBvcnRUb0NTVihyZXEuYm9keS5yZXBvcnQpO1xyXG4gICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgcmVzdWx0Lm1pbWVUeXBlKTtcclxuICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtRGlzcG9zaXRpb24nLCBgYXR0YWNobWVudDsgZmlsZW5hbWU9XCIke3Jlc3VsdC5maWxlTmFtZX1cImApO1xyXG4gICAgcmVzLnNlbmQocmVzdWx0LmNvbnRlbnQpO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgcmV0dXJuIG5leHQobmV3IEFwaUVycm9yKDQwMCwgJ0ZhaWxlZCB0byBleHBvcnQgdG8gQ1NWJywgW2Vyci5tZXNzYWdlXSkpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBFeHBvcnQgdG8gSlNPTlxyXG5yb3V0ZXIucG9zdCgnL2V4cG9ydC9qc29uJywgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IFJlcG9ydFNlcnZpY2UuZXhwb3J0VG9KU09OKHJlcS5ib2R5LnJlcG9ydCk7XHJcbiAgICByZXR1cm4gcmVzLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUmVwb3J0IGV4cG9ydGVkIHRvIEpTT04nKSk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICByZXR1cm4gbmV4dChuZXcgQXBpRXJyb3IoNDAwLCAnRmFpbGVkIHRvIGV4cG9ydCB0byBKU09OJywgW2Vyci5tZXNzYWdlXSkpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBFeHBvcnQgdG8gRXhjZWxcclxucm91dGVyLnBvc3QoJy9leHBvcnQvZXhjZWwnLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gUmVwb3J0U2VydmljZS5leHBvcnRUb0V4Y2VsKHJlcS5ib2R5LnJlcG9ydCk7XHJcbiAgICByZXR1cm4gcmVzLmpzb24obmV3IEFwaVJlc3BvbnNlKDIwMCwgcmVzdWx0LCAnUmVwb3J0IGV4cG9ydGVkIHRvIEV4Y2VsJykpO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgcmV0dXJuIG5leHQobmV3IEFwaUVycm9yKDQwMCwgJ0ZhaWxlZCB0byBleHBvcnQgdG8gRXhjZWwnLCBbZXJyLm1lc3NhZ2VdKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIERlbGV0ZSBSZXBvcnRcclxucm91dGVyLmRlbGV0ZSgnLzppZCcsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBSZXBvcnRTZXJ2aWNlLmRlbGV0ZVJlcG9ydChyZXEucGFyYW1zLmlkKTtcclxuICAgIHJldHVybiByZXMuanNvbihuZXcgQXBpUmVzcG9uc2UoMjAwLCByZXN1bHQsICdSZXBvcnQgZGVsZXRlZCcpKTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHJldHVybiBuZXh0KG5ldyBBcGlFcnJvcig0MDAsICdGYWlsZWQgdG8gZGVsZXRlIHJlcG9ydCcsIFtlcnIubWVzc2FnZV0pKTtcclxuICB9XHJcbn0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNQyxhQUFhLEdBQUdILE9BQU8sQ0FBQywyQkFBMkIsQ0FBQztBQUMxRCxNQUFNO0VBQUVJLFdBQVc7RUFBRUM7QUFBUyxDQUFDLEdBQUdMLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQzs7QUFFakU7QUFDQUMsTUFBTSxDQUFDSyxJQUFJLENBQUMsV0FBVyxFQUFFLE9BQU9DLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDakQsSUFBSTtJQUNGLE1BQU1DLE1BQU0sR0FBRyxNQUFNUCxhQUFhLENBQUNRLGNBQWMsQ0FBQ0osR0FBRyxDQUFDSyxJQUFJLENBQUM7SUFDM0QsT0FBT0osR0FBRyxDQUFDSyxJQUFJLENBQUMsSUFBSVQsV0FBVyxDQUFDLEdBQUcsRUFBRU0sTUFBTSxFQUFFLGtCQUFrQixDQUFDLENBQUM7RUFDbkUsQ0FBQyxDQUFDLE9BQU9JLEdBQUcsRUFBRTtJQUNaLE9BQU9MLElBQUksQ0FBQyxJQUFJSixRQUFRLENBQUMsR0FBRyxFQUFFLDJCQUEyQixFQUFFLENBQUNTLEdBQUcsQ0FBQ0MsT0FBTyxDQUFDLENBQUMsQ0FBQztFQUM1RTtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBZCxNQUFNLENBQUNlLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBT1QsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUMzQyxJQUFJO0lBQ0YsTUFBTVEsS0FBSyxHQUFHVixHQUFHLENBQUNXLEtBQUssQ0FBQ0QsS0FBSyxJQUFJLEVBQUU7SUFDbkMsTUFBTUUsT0FBTyxHQUFHLE1BQU1oQixhQUFhLENBQUNpQixhQUFhLENBQUNDLFFBQVEsQ0FBQ0osS0FBSyxDQUFDLENBQUM7SUFDbEUsT0FBT1QsR0FBRyxDQUFDSyxJQUFJLENBQUMsSUFBSVQsV0FBVyxDQUFDLEdBQUcsRUFBRWUsT0FBTyxFQUFFLGlCQUFpQixDQUFDLENBQUM7RUFDbkUsQ0FBQyxDQUFDLE9BQU9MLEdBQUcsRUFBRTtJQUNaLE9BQU9MLElBQUksQ0FBQyxJQUFJSixRQUFRLENBQUMsR0FBRyxFQUFFLHlCQUF5QixFQUFFLENBQUNTLEdBQUcsQ0FBQ0MsT0FBTyxDQUFDLENBQUMsQ0FBQztFQUMxRTtBQUNGLENBQUMsQ0FBQzs7QUFFRjtBQUNBZCxNQUFNLENBQUNLLElBQUksQ0FBQyxhQUFhLEVBQUUsT0FBT0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUNuRCxJQUFJO0lBQ0YsTUFBTWEsTUFBTSxHQUFHbkIsYUFBYSxDQUFDb0IsV0FBVyxDQUFDaEIsR0FBRyxDQUFDSyxJQUFJLENBQUNGLE1BQU0sQ0FBQztJQUN6REYsR0FBRyxDQUFDZ0IsU0FBUyxDQUFDLGNBQWMsRUFBRUYsTUFBTSxDQUFDRyxRQUFRLENBQUM7SUFDOUNqQixHQUFHLENBQUNnQixTQUFTLENBQUMscUJBQXFCLEVBQUUseUJBQXlCRixNQUFNLENBQUNJLFFBQVEsR0FBRyxDQUFDO0lBQ2pGbEIsR0FBRyxDQUFDbUIsSUFBSSxDQUFDTCxNQUFNLENBQUNNLE9BQU8sQ0FBQztFQUMxQixDQUFDLENBQUMsT0FBT2QsR0FBRyxFQUFFO0lBQ1osT0FBT0wsSUFBSSxDQUFDLElBQUlKLFFBQVEsQ0FBQyxHQUFHLEVBQUUseUJBQXlCLEVBQUUsQ0FBQ1MsR0FBRyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0VBQzFFO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0FkLE1BQU0sQ0FBQ0ssSUFBSSxDQUFDLGNBQWMsRUFBRSxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ3BELElBQUk7SUFDRixNQUFNYSxNQUFNLEdBQUduQixhQUFhLENBQUMwQixZQUFZLENBQUN0QixHQUFHLENBQUNLLElBQUksQ0FBQ0YsTUFBTSxDQUFDO0lBQzFELE9BQU9GLEdBQUcsQ0FBQ0ssSUFBSSxDQUFDLElBQUlULFdBQVcsQ0FBQyxHQUFHLEVBQUVrQixNQUFNLEVBQUUseUJBQXlCLENBQUMsQ0FBQztFQUMxRSxDQUFDLENBQUMsT0FBT1IsR0FBRyxFQUFFO0lBQ1osT0FBT0wsSUFBSSxDQUFDLElBQUlKLFFBQVEsQ0FBQyxHQUFHLEVBQUUsMEJBQTBCLEVBQUUsQ0FBQ1MsR0FBRyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0VBQzNFO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0FkLE1BQU0sQ0FBQ0ssSUFBSSxDQUFDLGVBQWUsRUFBRSxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ3JELElBQUk7SUFDRixNQUFNYSxNQUFNLEdBQUduQixhQUFhLENBQUMyQixhQUFhLENBQUN2QixHQUFHLENBQUNLLElBQUksQ0FBQ0YsTUFBTSxDQUFDO0lBQzNELE9BQU9GLEdBQUcsQ0FBQ0ssSUFBSSxDQUFDLElBQUlULFdBQVcsQ0FBQyxHQUFHLEVBQUVrQixNQUFNLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztFQUMzRSxDQUFDLENBQUMsT0FBT1IsR0FBRyxFQUFFO0lBQ1osT0FBT0wsSUFBSSxDQUFDLElBQUlKLFFBQVEsQ0FBQyxHQUFHLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQ1MsR0FBRyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0VBQzVFO0FBQ0YsQ0FBQyxDQUFDOztBQUVGO0FBQ0FkLE1BQU0sQ0FBQzhCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsT0FBT3hCLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDOUMsSUFBSTtJQUNGLE1BQU1hLE1BQU0sR0FBRyxNQUFNbkIsYUFBYSxDQUFDNkIsWUFBWSxDQUFDekIsR0FBRyxDQUFDMEIsTUFBTSxDQUFDQyxFQUFFLENBQUM7SUFDOUQsT0FBTzFCLEdBQUcsQ0FBQ0ssSUFBSSxDQUFDLElBQUlULFdBQVcsQ0FBQyxHQUFHLEVBQUVrQixNQUFNLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztFQUNqRSxDQUFDLENBQUMsT0FBT1IsR0FBRyxFQUFFO0lBQ1osT0FBT0wsSUFBSSxDQUFDLElBQUlKLFFBQVEsQ0FBQyxHQUFHLEVBQUUseUJBQXlCLEVBQUUsQ0FBQ1MsR0FBRyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0VBQzFFO0FBQ0YsQ0FBQyxDQUFDO0FBRUZvQixNQUFNLENBQUNDLE9BQU8sR0FBR25DLE1BQU0iLCJpZ25vcmVMaXN0IjpbXX0=