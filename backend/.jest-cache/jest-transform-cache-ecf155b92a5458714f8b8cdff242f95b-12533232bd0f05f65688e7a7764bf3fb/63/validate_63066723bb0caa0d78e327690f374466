d192c40abdf9710da5e72f4d256ec299
/**
 * Validation Routes
 * Data validation endpoints and schema management
 * Phase 10: Advanced Features
 */

const express = require('express');
const router = express.Router();
const validator = require('../services/validator');
const responseFormatter = require('../services/responseFormatter');
const {
  optionalAuth
} = require('../middleware/auth');

// Register default schemas
validator.registerSchema('user', {
  name: {
    required: true,
    type: 'string',
    minLength: 2,
    maxLength: 100
  },
  email: {
    required: true,
    type: 'email'
  },
  phone: {
    required: false,
    type: 'phone'
  },
  age: {
    required: false,
    type: 'number',
    min: 0,
    max: 150
  },
  password: {
    required: true,
    type: 'string',
    minLength: 8
  }
});
validator.registerSchema('product', {
  name: {
    required: true,
    type: 'string',
    minLength: 3,
    maxLength: 200
  },
  price: {
    required: true,
    type: 'number',
    min: 0
  },
  category: {
    required: true,
    type: 'string',
    enum: ['electronics', 'clothing', 'food', 'other']
  },
  sku: {
    required: true,
    type: 'string',
    pattern: '^[A-Z0-9]{5,10}$'
  },
  description: {
    required: false,
    type: 'string',
    maxLength: 1000
  }
});
validator.registerSchema('order', {
  customerId: {
    required: true,
    type: 'string'
  },
  items: {
    required: true,
    type: 'array'
  },
  totalAmount: {
    required: true,
    type: 'number',
    min: 0
  },
  status: {
    required: true,
    type: 'string',
    enum: ['pending', 'confirmed', 'shipped', 'delivered']
  }
});

/**
 * POST /api/validate/schema
 * Validate data against registered schema
 */
router.post('/schema', optionalAuth, (req, res) => {
  try {
    const {
      schemaName,
      data
    } = req.body;
    if (!schemaName || !data) {
      return res.status(400).json(responseFormatter.validationError(['schemaName and data are required'], 'Validation failed'));
    }
    const result = validator.validate(data, schemaName);
    if (!result.valid) {
      return res.status(400).json(responseFormatter.validationError(result.errors, 'Data validation failed'));
    }
    res.json(responseFormatter.success({
      valid: true
    }, 'Data validation successful'));
  } catch (error) {
    res.status(500).json(responseFormatter.serverError('Validation failed', error));
  }
});

/**
 * POST /api/validate/custom
 * Validate with custom rules
 */
router.post('/custom', optionalAuth, (req, res) => {
  try {
    const {
      field,
      value,
      rules
    } = req.body;
    if (!field || value === undefined || !rules) {
      return res.status(400).json(responseFormatter.validationError('field, value, and rules are required'));
    }
    const errors = [];
    if (rules.email && !validator.isValidEmail(value)) {
      errors.push('Invalid email format');
    }
    if (rules.phone && !validator.isValidPhone(value)) {
      errors.push('Invalid phone format');
    }
    if (rules.url && !validator.isValidUrl(value)) {
      errors.push('Invalid URL format');
    }
    if (rules.minLength && value.length < rules.minLength) {
      errors.push(`Minimum length is ${rules.minLength}`);
    }
    if (rules.maxLength && value.length > rules.maxLength) {
      errors.push(`Maximum length is ${rules.maxLength}`);
    }
    if (errors.length > 0) {
      return res.status(400).json(responseFormatter.validationError(errors));
    }
    res.json(responseFormatter.success(null, 'Validation passed'));
  } catch (error) {
    res.status(500).json(responseFormatter.serverError('Custom validation failed', error));
  }
});

/**
 * POST /api/validate/sanitize
 * Sanitize input data
 */
router.post('/sanitize', optionalAuth, (req, res) => {
  try {
    const {
      data
    } = req.body;
    if (!data) {
      return res.status(400).json(responseFormatter.validationError('data is required'));
    }
    const sanitized = validator.sanitize(data);
    res.json(responseFormatter.success({
      data: sanitized
    }, 'Data sanitized'));
  } catch (error) {
    res.status(500).json(responseFormatter.serverError('Sanitization failed', error));
  }
});

/**
 * GET /api/validate/schemas
 * List registered schemas
 */
router.get('/schemas', optionalAuth, (req, res) => {
  try {
    const stats = validator.getStats();
    res.json(responseFormatter.success(stats, 'Registered schemas'));
  } catch (error) {
    res.status(500).json(responseFormatter.serverError('Failed to retrieve schemas', error));
  }
});

/**
 * POST /api/validate/email
 * Validate email
 */
router.post('/email', optionalAuth, (req, res) => {
  try {
    const {
      email
    } = req.body;
    if (!email) {
      return res.status(400).json(responseFormatter.validationError('email is required'));
    }
    const valid = validator.isValidEmail(email);
    res.json(responseFormatter.success({
      email,
      valid
    }, valid ? 'Email is valid' : 'Email is invalid'));
  } catch (error) {
    res.status(500).json(responseFormatter.serverError('Email validation failed', error));
  }
});

/**
 * POST /api/validate/phone
 * Validate phone number
 */
router.post('/phone', optionalAuth, (req, res) => {
  try {
    const {
      phone
    } = req.body;
    if (!phone) {
      return res.status(400).json(responseFormatter.validationError('phone is required'));
    }
    const valid = validator.isValidPhone(phone);
    res.json(responseFormatter.success({
      phone,
      valid
    }, valid ? 'Phone is valid' : 'Phone is invalid'));
  } catch (error) {
    res.status(500).json(responseFormatter.serverError('Phone validation failed', error));
  }
});

/**
 * POST /api/validate/url
 * Validate URL
 */
router.post('/url', optionalAuth, (req, res) => {
  try {
    const {
      url
    } = req.body;
    if (!url) {
      return res.status(400).json(responseFormatter.validationError('url is required'));
    }
    const valid = validator.isValidUrl(url);
    res.json(responseFormatter.success({
      url,
      valid
    }, valid ? 'URL is valid' : 'URL is invalid'));
  } catch (error) {
    res.status(500).json(responseFormatter.serverError('URL validation failed', error));
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInZhbGlkYXRvciIsInJlc3BvbnNlRm9ybWF0dGVyIiwib3B0aW9uYWxBdXRoIiwicmVnaXN0ZXJTY2hlbWEiLCJuYW1lIiwicmVxdWlyZWQiLCJ0eXBlIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwiZW1haWwiLCJwaG9uZSIsImFnZSIsIm1pbiIsIm1heCIsInBhc3N3b3JkIiwicHJpY2UiLCJjYXRlZ29yeSIsImVudW0iLCJza3UiLCJwYXR0ZXJuIiwiZGVzY3JpcHRpb24iLCJjdXN0b21lcklkIiwiaXRlbXMiLCJ0b3RhbEFtb3VudCIsInN0YXR1cyIsInBvc3QiLCJyZXEiLCJyZXMiLCJzY2hlbWFOYW1lIiwiZGF0YSIsImJvZHkiLCJqc29uIiwidmFsaWRhdGlvbkVycm9yIiwicmVzdWx0IiwidmFsaWRhdGUiLCJ2YWxpZCIsImVycm9ycyIsInN1Y2Nlc3MiLCJlcnJvciIsInNlcnZlckVycm9yIiwiZmllbGQiLCJ2YWx1ZSIsInJ1bGVzIiwidW5kZWZpbmVkIiwiaXNWYWxpZEVtYWlsIiwicHVzaCIsImlzVmFsaWRQaG9uZSIsInVybCIsImlzVmFsaWRVcmwiLCJsZW5ndGgiLCJzYW5pdGl6ZWQiLCJzYW5pdGl6ZSIsImdldCIsInN0YXRzIiwiZ2V0U3RhdHMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsidmFsaWRhdGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBWYWxpZGF0aW9uIFJvdXRlc1xuICogRGF0YSB2YWxpZGF0aW9uIGVuZHBvaW50cyBhbmQgc2NoZW1hIG1hbmFnZW1lbnRcbiAqIFBoYXNlIDEwOiBBZHZhbmNlZCBGZWF0dXJlc1xuICovXG5cbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuY29uc3QgdmFsaWRhdG9yID0gcmVxdWlyZSgnLi4vc2VydmljZXMvdmFsaWRhdG9yJyk7XG5jb25zdCByZXNwb25zZUZvcm1hdHRlciA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3Jlc3BvbnNlRm9ybWF0dGVyJyk7XG5jb25zdCB7IG9wdGlvbmFsQXV0aCB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZS9hdXRoJyk7XG5cbi8vIFJlZ2lzdGVyIGRlZmF1bHQgc2NoZW1hc1xudmFsaWRhdG9yLnJlZ2lzdGVyU2NoZW1hKCd1c2VyJywge1xuICBuYW1lOiB7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiAnc3RyaW5nJywgbWluTGVuZ3RoOiAyLCBtYXhMZW5ndGg6IDEwMCB9LFxuICBlbWFpbDogeyByZXF1aXJlZDogdHJ1ZSwgdHlwZTogJ2VtYWlsJyB9LFxuICBwaG9uZTogeyByZXF1aXJlZDogZmFsc2UsIHR5cGU6ICdwaG9uZScgfSxcbiAgYWdlOiB7IHJlcXVpcmVkOiBmYWxzZSwgdHlwZTogJ251bWJlcicsIG1pbjogMCwgbWF4OiAxNTAgfSxcbiAgcGFzc3dvcmQ6IHsgcmVxdWlyZWQ6IHRydWUsIHR5cGU6ICdzdHJpbmcnLCBtaW5MZW5ndGg6IDggfSxcbn0pO1xuXG52YWxpZGF0b3IucmVnaXN0ZXJTY2hlbWEoJ3Byb2R1Y3QnLCB7XG4gIG5hbWU6IHsgcmVxdWlyZWQ6IHRydWUsIHR5cGU6ICdzdHJpbmcnLCBtaW5MZW5ndGg6IDMsIG1heExlbmd0aDogMjAwIH0sXG4gIHByaWNlOiB7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiAnbnVtYmVyJywgbWluOiAwIH0sXG4gIGNhdGVnb3J5OiB7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiAnc3RyaW5nJywgZW51bTogWydlbGVjdHJvbmljcycsICdjbG90aGluZycsICdmb29kJywgJ290aGVyJ10gfSxcbiAgc2t1OiB7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiAnc3RyaW5nJywgcGF0dGVybjogJ15bQS1aMC05XXs1LDEwfSQnIH0sXG4gIGRlc2NyaXB0aW9uOiB7IHJlcXVpcmVkOiBmYWxzZSwgdHlwZTogJ3N0cmluZycsIG1heExlbmd0aDogMTAwMCB9LFxufSk7XG5cbnZhbGlkYXRvci5yZWdpc3RlclNjaGVtYSgnb3JkZXInLCB7XG4gIGN1c3RvbWVySWQ6IHsgcmVxdWlyZWQ6IHRydWUsIHR5cGU6ICdzdHJpbmcnIH0sXG4gIGl0ZW1zOiB7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiAnYXJyYXknIH0sXG4gIHRvdGFsQW1vdW50OiB7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiAnbnVtYmVyJywgbWluOiAwIH0sXG4gIHN0YXR1czoge1xuICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgIGVudW06IFsncGVuZGluZycsICdjb25maXJtZWQnLCAnc2hpcHBlZCcsICdkZWxpdmVyZWQnXSxcbiAgfSxcbn0pO1xuXG4vKipcbiAqIFBPU1QgL2FwaS92YWxpZGF0ZS9zY2hlbWFcbiAqIFZhbGlkYXRlIGRhdGEgYWdhaW5zdCByZWdpc3RlcmVkIHNjaGVtYVxuICovXG5yb3V0ZXIucG9zdCgnL3NjaGVtYScsIG9wdGlvbmFsQXV0aCwgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBzY2hlbWFOYW1lLCBkYXRhIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghc2NoZW1hTmFtZSB8fCAhZGF0YSkge1xuICAgICAgcmV0dXJuIHJlc1xuICAgICAgICAuc3RhdHVzKDQwMClcbiAgICAgICAgLmpzb24oXG4gICAgICAgICAgcmVzcG9uc2VGb3JtYXR0ZXIudmFsaWRhdGlvbkVycm9yKFxuICAgICAgICAgICAgWydzY2hlbWFOYW1lIGFuZCBkYXRhIGFyZSByZXF1aXJlZCddLFxuICAgICAgICAgICAgJ1ZhbGlkYXRpb24gZmFpbGVkJ1xuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3IudmFsaWRhdGUoZGF0YSwgc2NoZW1hTmFtZSk7XG5cbiAgICBpZiAoIXJlc3VsdC52YWxpZCkge1xuICAgICAgcmV0dXJuIHJlc1xuICAgICAgICAuc3RhdHVzKDQwMClcbiAgICAgICAgLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIudmFsaWRhdGlvbkVycm9yKHJlc3VsdC5lcnJvcnMsICdEYXRhIHZhbGlkYXRpb24gZmFpbGVkJykpO1xuICAgIH1cblxuICAgIHJlcy5qc29uKHJlc3BvbnNlRm9ybWF0dGVyLnN1Y2Nlc3MoeyB2YWxpZDogdHJ1ZSB9LCAnRGF0YSB2YWxpZGF0aW9uIHN1Y2Nlc3NmdWwnKSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIuc2VydmVyRXJyb3IoJ1ZhbGlkYXRpb24gZmFpbGVkJywgZXJyb3IpKTtcbiAgfVxufSk7XG5cbi8qKlxuICogUE9TVCAvYXBpL3ZhbGlkYXRlL2N1c3RvbVxuICogVmFsaWRhdGUgd2l0aCBjdXN0b20gcnVsZXNcbiAqL1xucm91dGVyLnBvc3QoJy9jdXN0b20nLCBvcHRpb25hbEF1dGgsIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZmllbGQsIHZhbHVlLCBydWxlcyB9ID0gcmVxLmJvZHk7XG5cbiAgICBpZiAoIWZpZWxkIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgIXJ1bGVzKSB7XG4gICAgICByZXR1cm4gcmVzXG4gICAgICAgIC5zdGF0dXMoNDAwKVxuICAgICAgICAuanNvbihyZXNwb25zZUZvcm1hdHRlci52YWxpZGF0aW9uRXJyb3IoJ2ZpZWxkLCB2YWx1ZSwgYW5kIHJ1bGVzIGFyZSByZXF1aXJlZCcpKTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvcnMgPSBbXTtcblxuICAgIGlmIChydWxlcy5lbWFpbCAmJiAhdmFsaWRhdG9yLmlzVmFsaWRFbWFpbCh2YWx1ZSkpIHtcbiAgICAgIGVycm9ycy5wdXNoKCdJbnZhbGlkIGVtYWlsIGZvcm1hdCcpO1xuICAgIH1cblxuICAgIGlmIChydWxlcy5waG9uZSAmJiAhdmFsaWRhdG9yLmlzVmFsaWRQaG9uZSh2YWx1ZSkpIHtcbiAgICAgIGVycm9ycy5wdXNoKCdJbnZhbGlkIHBob25lIGZvcm1hdCcpO1xuICAgIH1cblxuICAgIGlmIChydWxlcy51cmwgJiYgIXZhbGlkYXRvci5pc1ZhbGlkVXJsKHZhbHVlKSkge1xuICAgICAgZXJyb3JzLnB1c2goJ0ludmFsaWQgVVJMIGZvcm1hdCcpO1xuICAgIH1cblxuICAgIGlmIChydWxlcy5taW5MZW5ndGggJiYgdmFsdWUubGVuZ3RoIDwgcnVsZXMubWluTGVuZ3RoKSB7XG4gICAgICBlcnJvcnMucHVzaChgTWluaW11bSBsZW5ndGggaXMgJHtydWxlcy5taW5MZW5ndGh9YCk7XG4gICAgfVxuXG4gICAgaWYgKHJ1bGVzLm1heExlbmd0aCAmJiB2YWx1ZS5sZW5ndGggPiBydWxlcy5tYXhMZW5ndGgpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBNYXhpbXVtIGxlbmd0aCBpcyAke3J1bGVzLm1heExlbmd0aH1gKTtcbiAgICB9XG5cbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbihyZXNwb25zZUZvcm1hdHRlci52YWxpZGF0aW9uRXJyb3IoZXJyb3JzKSk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIuc3VjY2VzcyhudWxsLCAnVmFsaWRhdGlvbiBwYXNzZWQnKSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIuc2VydmVyRXJyb3IoJ0N1c3RvbSB2YWxpZGF0aW9uIGZhaWxlZCcsIGVycm9yKSk7XG4gIH1cbn0pO1xuXG4vKipcbiAqIFBPU1QgL2FwaS92YWxpZGF0ZS9zYW5pdGl6ZVxuICogU2FuaXRpemUgaW5wdXQgZGF0YVxuICovXG5yb3V0ZXIucG9zdCgnL3Nhbml0aXplJywgb3B0aW9uYWxBdXRoLCAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEgfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIudmFsaWRhdGlvbkVycm9yKCdkYXRhIGlzIHJlcXVpcmVkJykpO1xuICAgIH1cblxuICAgIGNvbnN0IHNhbml0aXplZCA9IHZhbGlkYXRvci5zYW5pdGl6ZShkYXRhKTtcblxuICAgIHJlcy5qc29uKHJlc3BvbnNlRm9ybWF0dGVyLnN1Y2Nlc3MoeyBkYXRhOiBzYW5pdGl6ZWQgfSwgJ0RhdGEgc2FuaXRpemVkJykpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHJlc3BvbnNlRm9ybWF0dGVyLnNlcnZlckVycm9yKCdTYW5pdGl6YXRpb24gZmFpbGVkJywgZXJyb3IpKTtcbiAgfVxufSk7XG5cbi8qKlxuICogR0VUIC9hcGkvdmFsaWRhdGUvc2NoZW1hc1xuICogTGlzdCByZWdpc3RlcmVkIHNjaGVtYXNcbiAqL1xucm91dGVyLmdldCgnL3NjaGVtYXMnLCBvcHRpb25hbEF1dGgsIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN0YXRzID0gdmFsaWRhdG9yLmdldFN0YXRzKCk7XG5cbiAgICByZXMuanNvbihyZXNwb25zZUZvcm1hdHRlci5zdWNjZXNzKHN0YXRzLCAnUmVnaXN0ZXJlZCBzY2hlbWFzJykpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHJlc3BvbnNlRm9ybWF0dGVyLnNlcnZlckVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgc2NoZW1hcycsIGVycm9yKSk7XG4gIH1cbn0pO1xuXG4vKipcbiAqIFBPU1QgL2FwaS92YWxpZGF0ZS9lbWFpbFxuICogVmFsaWRhdGUgZW1haWxcbiAqL1xucm91dGVyLnBvc3QoJy9lbWFpbCcsIG9wdGlvbmFsQXV0aCwgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBlbWFpbCB9ID0gcmVxLmJvZHk7XG5cbiAgICBpZiAoIWVtYWlsKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIudmFsaWRhdGlvbkVycm9yKCdlbWFpbCBpcyByZXF1aXJlZCcpKTtcbiAgICB9XG5cbiAgICBjb25zdCB2YWxpZCA9IHZhbGlkYXRvci5pc1ZhbGlkRW1haWwoZW1haWwpO1xuXG4gICAgcmVzLmpzb24oXG4gICAgICByZXNwb25zZUZvcm1hdHRlci5zdWNjZXNzKHsgZW1haWwsIHZhbGlkIH0sIHZhbGlkID8gJ0VtYWlsIGlzIHZhbGlkJyA6ICdFbWFpbCBpcyBpbnZhbGlkJylcbiAgICApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHJlc3BvbnNlRm9ybWF0dGVyLnNlcnZlckVycm9yKCdFbWFpbCB2YWxpZGF0aW9uIGZhaWxlZCcsIGVycm9yKSk7XG4gIH1cbn0pO1xuXG4vKipcbiAqIFBPU1QgL2FwaS92YWxpZGF0ZS9waG9uZVxuICogVmFsaWRhdGUgcGhvbmUgbnVtYmVyXG4gKi9cbnJvdXRlci5wb3N0KCcvcGhvbmUnLCBvcHRpb25hbEF1dGgsIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgcGhvbmUgfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFwaG9uZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHJlc3BvbnNlRm9ybWF0dGVyLnZhbGlkYXRpb25FcnJvcigncGhvbmUgaXMgcmVxdWlyZWQnKSk7XG4gICAgfVxuXG4gICAgY29uc3QgdmFsaWQgPSB2YWxpZGF0b3IuaXNWYWxpZFBob25lKHBob25lKTtcblxuICAgIHJlcy5qc29uKFxuICAgICAgcmVzcG9uc2VGb3JtYXR0ZXIuc3VjY2Vzcyh7IHBob25lLCB2YWxpZCB9LCB2YWxpZCA/ICdQaG9uZSBpcyB2YWxpZCcgOiAnUGhvbmUgaXMgaW52YWxpZCcpXG4gICAgKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbihyZXNwb25zZUZvcm1hdHRlci5zZXJ2ZXJFcnJvcignUGhvbmUgdmFsaWRhdGlvbiBmYWlsZWQnLCBlcnJvcikpO1xuICB9XG59KTtcblxuLyoqXG4gKiBQT1NUIC9hcGkvdmFsaWRhdGUvdXJsXG4gKiBWYWxpZGF0ZSBVUkxcbiAqL1xucm91dGVyLnBvc3QoJy91cmwnLCBvcHRpb25hbEF1dGgsIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgdXJsIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghdXJsKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIudmFsaWRhdGlvbkVycm9yKCd1cmwgaXMgcmVxdWlyZWQnKSk7XG4gICAgfVxuXG4gICAgY29uc3QgdmFsaWQgPSB2YWxpZGF0b3IuaXNWYWxpZFVybCh1cmwpO1xuXG4gICAgcmVzLmpzb24ocmVzcG9uc2VGb3JtYXR0ZXIuc3VjY2Vzcyh7IHVybCwgdmFsaWQgfSwgdmFsaWQgPyAnVVJMIGlzIHZhbGlkJyA6ICdVUkwgaXMgaW52YWxpZCcpKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbihyZXNwb25zZUZvcm1hdHRlci5zZXJ2ZXJFcnJvcignVVJMIHZhbGlkYXRpb24gZmFpbGVkJywgZXJyb3IpKTtcbiAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTUMsU0FBUyxHQUFHSCxPQUFPLENBQUMsdUJBQXVCLENBQUM7QUFDbEQsTUFBTUksaUJBQWlCLEdBQUdKLE9BQU8sQ0FBQywrQkFBK0IsQ0FBQztBQUNsRSxNQUFNO0VBQUVLO0FBQWEs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