3a6cf88331b80c62bd9a4b827e0b0607
/**
 * Advanced Search Engine Service
 * Full-text search, fuzzy matching, and complex filters
 * Phase 10: Advanced Features
 */

const logger = require('../utils/logger');
class SearchEngine {
  constructor() {
    this.indexes = {};
    this.cache = new Map();
    this.cacheSize = 1000;
  }

  /**
   * Build search index for a collection
   */
  buildIndex(collectionName, documents, searchFields = ['name', 'description']) {
    try {
      const index = new Map();
      documents.forEach(doc => {
        searchFields.forEach(field => {
          const fieldValue = doc[field];
          if (!fieldValue) return;
          const tokens = this.tokenize(fieldValue.toString());
          tokens.forEach(token => {
            if (!index.has(token)) {
              index.set(token, []);
            }
            const docIds = index.get(token);
            if (!docIds.includes(doc._id)) {
              docIds.push(doc._id);
            }
          });
        });
      });
      this.indexes[collectionName] = {
        index,
        documents: new Map(documents.map(d => [d._id, d])),
        searchFields,
        createdAt: new Date()
      };
      logger.info(`Search index built for ${collectionName}: ${documents.length} documents`);
      return true;
    } catch (error) {
      logger.error('Error building search index:', error);
      return false;
    }
  }

  /**
   * Tokenize text
   */
  tokenize(text) {
    return text.toLowerCase().replace(/[^\w\s]/g, '').split(/\s+/).filter(token => token.length > 0);
  }

  /**
   * Calculate Levenshtein distance (fuzzy matching)
   */
  levenshteinDistance(a, b) {
    const matrix = [];
    for (let i = 0; i <= b.length; i++) {
      matrix[i] = [i];
    }
    for (let j = 0; j <= a.length; j++) {
      matrix[0][j] = j;
    }
    for (let i = 1; i <= b.length; i++) {
      for (let j = 1; j <= a.length; j++) {
        if (b.charAt(i - 1) === a.charAt(j - 1)) {
          matrix[i][j] = matrix[i - 1][j - 1];
        } else {
          matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j] + 1);
        }
      }
    }
    return matrix[b.length][a.length];
  }

  /**
   * Fuzzy search
   */
  fuzzySearch(query, collection, maxDistance = 2) {
    try {
      const indexData = this.indexes[collection];
      if (!indexData) return [];
      const queryTokens = this.tokenize(query);
      const results = new Map();
      indexData.index.forEach((docIds, token) => {
        queryTokens.forEach(queryToken => {
          const distance = this.levenshteinDistance(queryToken, token);
          if (distance <= maxDistance) {
            docIds.forEach(docId => {
              const score = results.get(docId) || 0;
              results.set(docId, score + (maxDistance - distance));
            });
          }
        });
      });
      return Array.from(results.entries()).sort((a, b) => b[1] - a[1]).map(([docId, score]) => ({
        ...indexData.documents.get(docId),
        score
      }));
    } catch (error) {
      logger.error('Fuzzy search error:', error);
      return [];
    }
  }

  /**
   * Full-text search
   */
  fullTextSearch(query, collection, limit = 20) {
    try {
      // Check cache
      const cacheKey = `${collection}:${query}:${limit}`;
      if (this.cache.has(cacheKey)) {
        return this.cache.get(cacheKey);
      }
      const indexData = this.indexes[collection];
      if (!indexData) return [];
      const queryTokens = this.tokenize(query);
      const results = new Map();
      const totalTokens = queryTokens.length;
      queryTokens.forEach(token => {
        const matchedIds = indexData.index.get(token) || [];
        matchedIds.forEach(docId => {
          const score = results.get(docId) || 0;
          results.set(docId, score + 1);
        });
      });
      let searchResults = Array.from(results.entries()).map(([docId, matches]) => ({
        ...indexData.documents.get(docId),
        relevance: matches / totalTokens * 100
      })).sort((a, b) => b.relevance - a.relevance).slice(0, limit);

      // Cache result
      if (this.cache.size >= this.cacheSize) {
        const firstKey = this.cache.keys().next().value;
        this.cache.delete(firstKey);
      }
      this.cache.set(cacheKey, searchResults);
      return searchResults;
    } catch (error) {
      logger.error('Full-text search error:', error);
      return [];
    }
  }

  /**
   * Advanced filter search
   */
  advancedSearch(query, collection, filters = {}, options = {}) {
    try {
      const {
        limit = 20,
        offset = 0,
        sortBy = 'relevance',
        sortOrder = 'desc'
      } = options;
      const indexData = this.indexes[collection];
      if (!indexData) return {
        results: [],
        total: 0
      };

      // Full-text search results
      let results = this.fullTextSearch(query, collection, 1000);

      // Apply filters
      Object.entries(filters).forEach(([field, value]) => {
        if (Array.isArray(value)) {
          results = results.filter(doc => value.includes(doc[field]));
        } else if (typeof value === 'object' && value.$gte !== undefined) {
          results = results.filter(doc => doc[field] >= value.$gte);
        } else if (typeof value === 'object' && value.$lte !== undefined) {
          results = results.filter(doc => doc[field] <= value.$lte);
        } else {
          results = results.filter(doc => doc[field] === value);
        }
      });
      const total = results.length;

      // Sort
      if (sortBy && sortBy !== 'relevance') {
        results.sort((a, b) => {
          const aVal = a[sortBy];
          const bVal = b[sortBy];
          const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
          return sortOrder === 'asc' ? comparison : -comparison;
        });
      }

      // Paginate
      results = results.slice(offset, offset + limit);
      return {
        results,
        total,
        limit,
        offset
      };
    } catch (error) {
      logger.error('Advanced search error:', error);
      return {
        results: [],
        total: 0
      };
    }
  }

  /**
   * Get search suggestions
   */
  getSuggestions(query, collection, limit = 10) {
    try {
      const indexData = this.indexes[collection];
      if (!indexData) return [];
      const queryTokens = this.tokenize(query);
      const suggestions = new Map();
      queryTokens.forEach(token => {
        indexData.index.forEach((docIds, indexToken) => {
          if (indexToken.startsWith(token)) {
            suggestions.set(indexToken, (suggestions.get(indexToken) || 0) + 1);
          }
        });
      });
      return Array.from(suggestions.entries()).sort((a, b) => b[1] - a[1]).slice(0, limit).map(([suggestion, count]) => ({
        suggestion,
        count
      }));
    } catch (error) {
      logger.error('Suggestions error:', error);
      return [];
    }
  }

  /**
   * Clear cache
   */
  clearCache() {
    this.cache.clear();
  }

  /**
   * Get statistics
   */
  getStats() {
    return {
      indexes: Object.keys(this.indexes).length,
      cacheSize: this.cache.size,
      indexDetails: Object.entries(this.indexes).map(([name, data]) => ({
        name,
        documents: data.documents.size,
        tokens: data.index.size,
        createdAt: data.createdAt
      }))
    };
  }
}
module.exports = new SearchEngine();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiU2VhcmNoRW5naW5lIiwiY29uc3RydWN0b3IiLCJpbmRleGVzIiwiY2FjaGUiLCJNYXAiLCJjYWNoZVNpemUiLCJidWlsZEluZGV4IiwiY29sbGVjdGlvbk5hbWUiLCJkb2N1bWVudHMiLCJzZWFyY2hGaWVsZHMiLCJpbmRleCIsImZvckVhY2giLCJkb2MiLCJmaWVsZCIsImZpZWxkVmFsdWUiLCJ0b2tlbnMiLCJ0b2tlbml6ZSIsInRvU3RyaW5nIiwidG9rZW4iLCJoYXMiLCJzZXQiLCJkb2NJZHMiLCJnZXQiLCJpbmNsdWRlcyIsIl9pZCIsInB1c2giLCJtYXAiLCJkIiwiY3JlYXRlZEF0IiwiRGF0ZSIsImluZm8iLCJsZW5ndGgiLCJlcnJvciIsInRleHQiLCJ0b0xvd2VyQ2FzZSIsInJlcGxhY2UiLCJzcGxpdCIsImZpbHRlciIsImxldmVuc2h0ZWluRGlzdGFuY2UiLCJhIiwiYiIsIm1hdHJpeCIsImkiLCJqIiwiY2hhckF0IiwiTWF0aCIsIm1pbiIsImZ1enp5U2VhcmNoIiwicXVlcnkiLCJjb2xsZWN0aW9uIiwibWF4RGlzdGFuY2UiLCJpbmRleERhdGEiLCJxdWVyeVRva2VucyIsInJlc3VsdHMiLCJxdWVyeVRva2VuIiwiZGlzdGFuY2UiLCJkb2NJZCIsInNjb3JlIiwiQXJyYXkiLCJmcm9tIiwiZW50cmllcyIsInNvcnQiLCJmdWxsVGV4dFNlYXJjaCIsImxpbWl0IiwiY2FjaGVLZXkiLCJ0b3RhbFRva2VucyIsIm1hdGNoZWRJZHMiLCJzZWFyY2hSZXN1bHRzIiwibWF0Y2hlcyIsInJlbGV2YW5jZSIsInNsaWNlIiwic2l6ZSIsImZpcnN0S2V5Iiwia2V5cyIsIm5leHQiLCJ2YWx1ZSIsImRlbGV0ZSIsImFkdmFuY2VkU2VhcmNoIiwiZmlsdGVycyIsIm9wdGlvbnMiLCJvZmZzZXQiLCJzb3J0QnkiLCJzb3J0T3JkZXIiLCJ0b3RhbCIsIk9iamVjdCIsImlzQXJyYXkiLCIkZ3RlIiwidW5kZWZpbmVkIiwiJGx0ZSIsImFWYWwiLCJiVmFsIiwiY29tcGFyaXNvbiIsImdldFN1Z2dlc3Rpb25zIiwic3VnZ2VzdGlvbnMiLCJpbmRleFRva2VuIiwic3RhcnRzV2l0aCIsInN1Z2dlc3Rpb24iLCJjb3VudCIsImNsZWFyQ2FjaGUiLCJjbGVhciIsImdldFN0YXRzIiwiaW5kZXhEZXRhaWxzIiwibmFtZSIsImRhdGEiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic2VhcmNoRW5naW5lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWR2YW5jZWQgU2VhcmNoIEVuZ2luZSBTZXJ2aWNlXG4gKiBGdWxsLXRleHQgc2VhcmNoLCBmdXp6eSBtYXRjaGluZywgYW5kIGNvbXBsZXggZmlsdGVyc1xuICogUGhhc2UgMTA6IEFkdmFuY2VkIEZlYXR1cmVzXG4gKi9cblxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XG5cbmNsYXNzIFNlYXJjaEVuZ2luZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaW5kZXhlcyA9IHt9O1xuICAgIHRoaXMuY2FjaGUgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5jYWNoZVNpemUgPSAxMDAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkIHNlYXJjaCBpbmRleCBmb3IgYSBjb2xsZWN0aW9uXG4gICAqL1xuICBidWlsZEluZGV4KGNvbGxlY3Rpb25OYW1lLCBkb2N1bWVudHMsIHNlYXJjaEZpZWxkcyA9IFsnbmFtZScsICdkZXNjcmlwdGlvbiddKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGluZGV4ID0gbmV3IE1hcCgpO1xuXG4gICAgICBkb2N1bWVudHMuZm9yRWFjaChkb2MgPT4ge1xuICAgICAgICBzZWFyY2hGaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICAgICAgY29uc3QgZmllbGRWYWx1ZSA9IGRvY1tmaWVsZF07XG4gICAgICAgICAgaWYgKCFmaWVsZFZhbHVlKSByZXR1cm47XG5cbiAgICAgICAgICBjb25zdCB0b2tlbnMgPSB0aGlzLnRva2VuaXplKGZpZWxkVmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgdG9rZW5zLmZvckVhY2godG9rZW4gPT4ge1xuICAgICAgICAgICAgaWYgKCFpbmRleC5oYXModG9rZW4pKSB7XG4gICAgICAgICAgICAgIGluZGV4LnNldCh0b2tlbiwgW10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZG9jSWRzID0gaW5kZXguZ2V0KHRva2VuKTtcbiAgICAgICAgICAgIGlmICghZG9jSWRzLmluY2x1ZGVzKGRvYy5faWQpKSB7XG4gICAgICAgICAgICAgIGRvY0lkcy5wdXNoKGRvYy5faWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmluZGV4ZXNbY29sbGVjdGlvbk5hbWVdID0ge1xuICAgICAgICBpbmRleCxcbiAgICAgICAgZG9jdW1lbnRzOiBuZXcgTWFwKGRvY3VtZW50cy5tYXAoZCA9PiBbZC5faWQsIGRdKSksXG4gICAgICAgIHNlYXJjaEZpZWxkcyxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbG9nZ2VyLmluZm8oYFNlYXJjaCBpbmRleCBidWlsdCBmb3IgJHtjb2xsZWN0aW9uTmFtZX06ICR7ZG9jdW1lbnRzLmxlbmd0aH0gZG9jdW1lbnRzYCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBidWlsZGluZyBzZWFyY2ggaW5kZXg6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUb2tlbml6ZSB0ZXh0XG4gICAqL1xuICB0b2tlbml6ZSh0ZXh0KSB7XG4gICAgcmV0dXJuIHRleHRcbiAgICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgICAucmVwbGFjZSgvW15cXHdcXHNdL2csICcnKVxuICAgICAgLnNwbGl0KC9cXHMrLylcbiAgICAgIC5maWx0ZXIodG9rZW4gPT4gdG9rZW4ubGVuZ3RoID4gMCk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIExldmVuc2h0ZWluIGRpc3RhbmNlIChmdXp6eSBtYXRjaGluZylcbiAgICovXG4gIGxldmVuc2h0ZWluRGlzdGFuY2UoYSwgYikge1xuICAgIGNvbnN0IG1hdHJpeCA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gYi5sZW5ndGg7IGkrKykge1xuICAgICAgbWF0cml4W2ldID0gW2ldO1xuICAgIH1cblxuICAgIGZvciAobGV0IGogPSAwOyBqIDw9IGEubGVuZ3RoOyBqKyspIHtcbiAgICAgIG1hdHJpeFswXVtqXSA9IGo7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gYi5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gYS5sZW5ndGg7IGorKykge1xuICAgICAgICBpZiAoYi5jaGFyQXQoaSAtIDEpID09PSBhLmNoYXJBdChqIC0gMSkpIHtcbiAgICAgICAgICBtYXRyaXhbaV1bal0gPSBtYXRyaXhbaSAtIDFdW2ogLSAxXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtYXRyaXhbaV1bal0gPSBNYXRoLm1pbihcbiAgICAgICAgICAgIG1hdHJpeFtpIC0gMV1baiAtIDFdICsgMSxcbiAgICAgICAgICAgIG1hdHJpeFtpXVtqIC0gMV0gKyAxLFxuICAgICAgICAgICAgbWF0cml4W2kgLSAxXVtqXSArIDFcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG1hdHJpeFtiLmxlbmd0aF1bYS5sZW5ndGhdO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1enp5IHNlYXJjaFxuICAgKi9cbiAgZnV6enlTZWFyY2gocXVlcnksIGNvbGxlY3Rpb24sIG1heERpc3RhbmNlID0gMikge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBpbmRleERhdGEgPSB0aGlzLmluZGV4ZXNbY29sbGVjdGlvbl07XG4gICAgICBpZiAoIWluZGV4RGF0YSkgcmV0dXJuIFtdO1xuXG4gICAgICBjb25zdCBxdWVyeVRva2VucyA9IHRoaXMudG9rZW5pemUocXVlcnkpO1xuICAgICAgY29uc3QgcmVzdWx0cyA9IG5ldyBNYXAoKTtcblxuICAgICAgaW5kZXhEYXRhLmluZGV4LmZvckVhY2goKGRvY0lkcywgdG9rZW4pID0+IHtcbiAgICAgICAgcXVlcnlUb2tlbnMuZm9yRWFjaChxdWVyeVRva2VuID0+IHtcbiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IHRoaXMubGV2ZW5zaHRlaW5EaXN0YW5jZShxdWVyeVRva2VuLCB0b2tlbik7XG4gICAgICAgICAgaWYgKGRpc3RhbmNlIDw9IG1heERpc3RhbmNlKSB7XG4gICAgICAgICAgICBkb2NJZHMuZm9yRWFjaChkb2NJZCA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHNjb3JlID0gcmVzdWx0cy5nZXQoZG9jSWQpIHx8IDA7XG4gICAgICAgICAgICAgIHJlc3VsdHMuc2V0KGRvY0lkLCBzY29yZSArIChtYXhEaXN0YW5jZSAtIGRpc3RhbmNlKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBBcnJheS5mcm9tKHJlc3VsdHMuZW50cmllcygpKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pXG4gICAgICAgIC5tYXAoKFtkb2NJZCwgc2NvcmVdKSA9PiAoe1xuICAgICAgICAgIC4uLmluZGV4RGF0YS5kb2N1bWVudHMuZ2V0KGRvY0lkKSxcbiAgICAgICAgICBzY29yZSxcbiAgICAgICAgfSkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Z1enp5IHNlYXJjaCBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZ1bGwtdGV4dCBzZWFyY2hcbiAgICovXG4gIGZ1bGxUZXh0U2VhcmNoKHF1ZXJ5LCBjb2xsZWN0aW9uLCBsaW1pdCA9IDIwKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGNhY2hlXG4gICAgICBjb25zdCBjYWNoZUtleSA9IGAke2NvbGxlY3Rpb259OiR7cXVlcnl9OiR7bGltaXR9YDtcbiAgICAgIGlmICh0aGlzLmNhY2hlLmhhcyhjYWNoZUtleSkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KGNhY2hlS2V5KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaW5kZXhEYXRhID0gdGhpcy5pbmRleGVzW2NvbGxlY3Rpb25dO1xuICAgICAgaWYgKCFpbmRleERhdGEpIHJldHVybiBbXTtcblxuICAgICAgY29uc3QgcXVlcnlUb2tlbnMgPSB0aGlzLnRva2VuaXplKHF1ZXJ5KTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBuZXcgTWFwKCk7XG4gICAgICBjb25zdCB0b3RhbFRva2VucyA9IHF1ZXJ5VG9rZW5zLmxlbmd0aDtcblxuICAgICAgcXVlcnlUb2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGNoZWRJZHMgPSBpbmRleERhdGEuaW5kZXguZ2V0KHRva2VuKSB8fCBbXTtcbiAgICAgICAgbWF0Y2hlZElkcy5mb3JFYWNoKGRvY0lkID0+IHtcbiAgICAgICAgICBjb25zdCBzY29yZSA9IHJlc3VsdHMuZ2V0KGRvY0lkKSB8fCAwO1xuICAgICAgICAgIHJlc3VsdHMuc2V0KGRvY0lkLCBzY29yZSArIDEpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBsZXQgc2VhcmNoUmVzdWx0cyA9IEFycmF5LmZyb20ocmVzdWx0cy5lbnRyaWVzKCkpXG4gICAgICAgIC5tYXAoKFtkb2NJZCwgbWF0Y2hlc10pID0+ICh7XG4gICAgICAgICAgLi4uaW5kZXhEYXRhLmRvY3VtZW50cy5nZXQoZG9jSWQpLFxuICAgICAgICAgIHJlbGV2YW5jZTogKG1hdGNoZXMgLyB0b3RhbFRva2VucykgKiAxMDAsXG4gICAgICAgIH0pKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi5yZWxldmFuY2UgLSBhLnJlbGV2YW5jZSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KTtcblxuICAgICAgLy8gQ2FjaGUgcmVzdWx0XG4gICAgICBpZiAodGhpcy5jYWNoZS5zaXplID49IHRoaXMuY2FjaGVTaXplKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0S2V5ID0gdGhpcy5jYWNoZS5rZXlzKCkubmV4dCgpLnZhbHVlO1xuICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShmaXJzdEtleSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNhY2hlLnNldChjYWNoZUtleSwgc2VhcmNoUmVzdWx0cyk7XG5cbiAgICAgIHJldHVybiBzZWFyY2hSZXN1bHRzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Z1bGwtdGV4dCBzZWFyY2ggZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZHZhbmNlZCBmaWx0ZXIgc2VhcmNoXG4gICAqL1xuICBhZHZhbmNlZFNlYXJjaChxdWVyeSwgY29sbGVjdGlvbiwgZmlsdGVycyA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBsaW1pdCA9IDIwLCBvZmZzZXQgPSAwLCBzb3J0QnkgPSAncmVsZXZhbmNlJywgc29ydE9yZGVyID0gJ2Rlc2MnIH0gPSBvcHRpb25zO1xuXG4gICAgICBjb25zdCBpbmRleERhdGEgPSB0aGlzLmluZGV4ZXNbY29sbGVjdGlvbl07XG4gICAgICBpZiAoIWluZGV4RGF0YSkgcmV0dXJuIHsgcmVzdWx0czogW10sIHRvdGFsOiAwIH07XG5cbiAgICAgIC8vIEZ1bGwtdGV4dCBzZWFyY2ggcmVzdWx0c1xuICAgICAgbGV0IHJlc3VsdHMgPSB0aGlzLmZ1bGxUZXh0U2VhcmNoKHF1ZXJ5LCBjb2xsZWN0aW9uLCAxMDAwKTtcblxuICAgICAgLy8gQXBwbHkgZmlsdGVyc1xuICAgICAgT2JqZWN0LmVudHJpZXMoZmlsdGVycykuZm9yRWFjaCgoW2ZpZWxkLCB2YWx1ZV0pID0+IHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGRvYyA9PiB2YWx1ZS5pbmNsdWRlcyhkb2NbZmllbGRdKSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZS4kZ3RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZG9jID0+IGRvY1tmaWVsZF0gPj0gdmFsdWUuJGd0ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZS4kbHRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZG9jID0+IGRvY1tmaWVsZF0gPD0gdmFsdWUuJGx0ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGRvYyA9PiBkb2NbZmllbGRdID09PSB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0b3RhbCA9IHJlc3VsdHMubGVuZ3RoO1xuXG4gICAgICAvLyBTb3J0XG4gICAgICBpZiAoc29ydEJ5ICYmIHNvcnRCeSAhPT0gJ3JlbGV2YW5jZScpIHtcbiAgICAgICAgcmVzdWx0cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgY29uc3QgYVZhbCA9IGFbc29ydEJ5XTtcbiAgICAgICAgICBjb25zdCBiVmFsID0gYltzb3J0QnldO1xuICAgICAgICAgIGNvbnN0IGNvbXBhcmlzb24gPSBhVmFsID4gYlZhbCA/IDEgOiBhVmFsIDwgYlZhbCA/IC0xIDogMDtcbiAgICAgICAgICByZXR1cm4gc29ydE9yZGVyID09PSAnYXNjJyA/IGNvbXBhcmlzb24gOiAtY29tcGFyaXNvbjtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFBhZ2luYXRlXG4gICAgICByZXN1bHRzID0gcmVzdWx0cy5zbGljZShvZmZzZXQsIG9mZnNldCArIGxpbWl0KTtcblxuICAgICAgcmV0dXJuIHsgcmVzdWx0cywgdG90YWwsIGxpbWl0LCBvZmZzZXQgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdBZHZhbmNlZCBzZWFyY2ggZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgcmVzdWx0czogW10sIHRvdGFsOiAwIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZWFyY2ggc3VnZ2VzdGlvbnNcbiAgICovXG4gIGdldFN1Z2dlc3Rpb25zKHF1ZXJ5LCBjb2xsZWN0aW9uLCBsaW1pdCA9IDEwKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGluZGV4RGF0YSA9IHRoaXMuaW5kZXhlc1tjb2xsZWN0aW9uXTtcbiAgICAgIGlmICghaW5kZXhEYXRhKSByZXR1cm4gW107XG5cbiAgICAgIGNvbnN0IHF1ZXJ5VG9rZW5zID0gdGhpcy50b2tlbml6ZShxdWVyeSk7XG4gICAgICBjb25zdCBzdWdnZXN0aW9ucyA9IG5ldyBNYXAoKTtcblxuICAgICAgcXVlcnlUb2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7XG4gICAgICAgIGluZGV4RGF0YS5pbmRleC5mb3JFYWNoKChkb2NJZHMsIGluZGV4VG9rZW4pID0+IHtcbiAgICAgICAgICBpZiAoaW5kZXhUb2tlbi5zdGFydHNXaXRoKHRva2VuKSkge1xuICAgICAgICAgICAgc3VnZ2VzdGlvbnMuc2V0KGluZGV4VG9rZW4sIChzdWdnZXN0aW9ucy5nZXQoaW5kZXhUb2tlbikgfHwgMCkgKyAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBBcnJheS5mcm9tKHN1Z2dlc3Rpb25zLmVudHJpZXMoKSlcbiAgICAgICAgLnNvcnQoKGEsIGIpID0+IGJbMV0gLSBhWzFdKVxuICAgICAgICAuc2xpY2UoMCwgbGltaXQpXG4gICAgICAgIC5tYXAoKFtzdWdnZXN0aW9uLCBjb3VudF0pID0+ICh7IHN1Z2dlc3Rpb24sIGNvdW50IH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdTdWdnZXN0aW9ucyBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGNhY2hlXG4gICAqL1xuICBjbGVhckNhY2hlKCkge1xuICAgIHRoaXMuY2FjaGUuY2xlYXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc3RhdGlzdGljc1xuICAgKi9cbiAgZ2V0U3RhdHMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGluZGV4ZXM6IE9iamVjdC5rZXlzKHRoaXMuaW5kZXhlcykubGVuZ3RoLFxuICAgICAgY2FjaGVTaXplOiB0aGlzLmNhY2hlLnNpemUsXG4gICAgICBpbmRleERldGFpbHM6IE9iamVjdC5lbnRyaWVzKHRoaXMuaW5kZXhlcykubWFwKChbbmFtZSwgZGF0YV0pID0+ICh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGRvY3VtZW50czogZGF0YS5kb2N1bWVudHMuc2l6ZSxcbiAgICAgICAgdG9rZW5zOiBkYXRhLmluZGV4LnNpemUsXG4gICAgICAgIGNyZWF0ZWRBdDogZGF0YS5jcmVhdGVkQXQsXG4gICAgICB9KSksXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBTZWFyY2hFbmdpbmUoKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUV6QyxNQUFNQyxZQUFZLENBQUM7RUFDakJDLFdBQVdB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