{"version":3,"names":["logger","require","SearchEngine","constructor","indexes","cache","Map","cacheSize","buildIndex","collectionName","documents","searchFields","index","forEach","doc","field","fieldValue","tokens","tokenize","toString","token","has","set","docIds","get","includes","_id","push","map","d","createdAt","Date","info","length","error","text","toLowerCase","replace","split","filter","levenshteinDistance","a","b","matrix","i","j","charAt","Math","min","fuzzySearch","query","collection","maxDistance","indexData","queryTokens","results","queryToken","distance","docId","score","Array","from","entries","sort","fullTextSearch","limit","cacheKey","totalTokens","matchedIds","searchResults","matches","relevance","slice","size","firstKey","keys","next","value","delete","advancedSearch","filters","options","offset","sortBy","sortOrder","total","Object","isArray","$gte","undefined","$lte","aVal","bVal","comparison","getSuggestions","suggestions","indexToken","startsWith","suggestion","count","clearCache","clear","getStats","indexDetails","name","data","module","exports"],"sources":["searchEngine.js"],"sourcesContent":["/**\n * Advanced Search Engine Service\n * Full-text search, fuzzy matching, and complex filters\n * Phase 10: Advanced Features\n */\n\nconst logger = require('../utils/logger');\n\nclass SearchEngine {\n  constructor() {\n    this.indexes = {};\n    this.cache = new Map();\n    this.cacheSize = 1000;\n  }\n\n  /**\n   * Build search index for a collection\n   */\n  buildIndex(collectionName, documents, searchFields = ['name', 'description']) {\n    try {\n      const index = new Map();\n\n      documents.forEach(doc => {\n        searchFields.forEach(field => {\n          const fieldValue = doc[field];\n          if (!fieldValue) return;\n\n          const tokens = this.tokenize(fieldValue.toString());\n          tokens.forEach(token => {\n            if (!index.has(token)) {\n              index.set(token, []);\n            }\n            const docIds = index.get(token);\n            if (!docIds.includes(doc._id)) {\n              docIds.push(doc._id);\n            }\n          });\n        });\n      });\n\n      this.indexes[collectionName] = {\n        index,\n        documents: new Map(documents.map(d => [d._id, d])),\n        searchFields,\n        createdAt: new Date(),\n      };\n\n      logger.info(`Search index built for ${collectionName}: ${documents.length} documents`);\n      return true;\n    } catch (error) {\n      logger.error('Error building search index:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Tokenize text\n   */\n  tokenize(text) {\n    return text\n      .toLowerCase()\n      .replace(/[^\\w\\s]/g, '')\n      .split(/\\s+/)\n      .filter(token => token.length > 0);\n  }\n\n  /**\n   * Calculate Levenshtein distance (fuzzy matching)\n   */\n  levenshteinDistance(a, b) {\n    const matrix = [];\n\n    for (let i = 0; i <= b.length; i++) {\n      matrix[i] = [i];\n    }\n\n    for (let j = 0; j <= a.length; j++) {\n      matrix[0][j] = j;\n    }\n\n    for (let i = 1; i <= b.length; i++) {\n      for (let j = 1; j <= a.length; j++) {\n        if (b.charAt(i - 1) === a.charAt(j - 1)) {\n          matrix[i][j] = matrix[i - 1][j - 1];\n        } else {\n          matrix[i][j] = Math.min(\n            matrix[i - 1][j - 1] + 1,\n            matrix[i][j - 1] + 1,\n            matrix[i - 1][j] + 1\n          );\n        }\n      }\n    }\n\n    return matrix[b.length][a.length];\n  }\n\n  /**\n   * Fuzzy search\n   */\n  fuzzySearch(query, collection, maxDistance = 2) {\n    try {\n      const indexData = this.indexes[collection];\n      if (!indexData) return [];\n\n      const queryTokens = this.tokenize(query);\n      const results = new Map();\n\n      indexData.index.forEach((docIds, token) => {\n        queryTokens.forEach(queryToken => {\n          const distance = this.levenshteinDistance(queryToken, token);\n          if (distance <= maxDistance) {\n            docIds.forEach(docId => {\n              const score = results.get(docId) || 0;\n              results.set(docId, score + (maxDistance - distance));\n            });\n          }\n        });\n      });\n\n      return Array.from(results.entries())\n        .sort((a, b) => b[1] - a[1])\n        .map(([docId, score]) => ({\n          ...indexData.documents.get(docId),\n          score,\n        }));\n    } catch (error) {\n      logger.error('Fuzzy search error:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Full-text search\n   */\n  fullTextSearch(query, collection, limit = 20) {\n    try {\n      // Check cache\n      const cacheKey = `${collection}:${query}:${limit}`;\n      if (this.cache.has(cacheKey)) {\n        return this.cache.get(cacheKey);\n      }\n\n      const indexData = this.indexes[collection];\n      if (!indexData) return [];\n\n      const queryTokens = this.tokenize(query);\n      const results = new Map();\n      const totalTokens = queryTokens.length;\n\n      queryTokens.forEach(token => {\n        const matchedIds = indexData.index.get(token) || [];\n        matchedIds.forEach(docId => {\n          const score = results.get(docId) || 0;\n          results.set(docId, score + 1);\n        });\n      });\n\n      let searchResults = Array.from(results.entries())\n        .map(([docId, matches]) => ({\n          ...indexData.documents.get(docId),\n          relevance: (matches / totalTokens) * 100,\n        }))\n        .sort((a, b) => b.relevance - a.relevance)\n        .slice(0, limit);\n\n      // Cache result\n      if (this.cache.size >= this.cacheSize) {\n        const firstKey = this.cache.keys().next().value;\n        this.cache.delete(firstKey);\n      }\n      this.cache.set(cacheKey, searchResults);\n\n      return searchResults;\n    } catch (error) {\n      logger.error('Full-text search error:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Advanced filter search\n   */\n  advancedSearch(query, collection, filters = {}, options = {}) {\n    try {\n      const { limit = 20, offset = 0, sortBy = 'relevance', sortOrder = 'desc' } = options;\n\n      const indexData = this.indexes[collection];\n      if (!indexData) return { results: [], total: 0 };\n\n      // Full-text search results\n      let results = this.fullTextSearch(query, collection, 1000);\n\n      // Apply filters\n      Object.entries(filters).forEach(([field, value]) => {\n        if (Array.isArray(value)) {\n          results = results.filter(doc => value.includes(doc[field]));\n        } else if (typeof value === 'object' && value.$gte !== undefined) {\n          results = results.filter(doc => doc[field] >= value.$gte);\n        } else if (typeof value === 'object' && value.$lte !== undefined) {\n          results = results.filter(doc => doc[field] <= value.$lte);\n        } else {\n          results = results.filter(doc => doc[field] === value);\n        }\n      });\n\n      const total = results.length;\n\n      // Sort\n      if (sortBy && sortBy !== 'relevance') {\n        results.sort((a, b) => {\n          const aVal = a[sortBy];\n          const bVal = b[sortBy];\n          const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;\n          return sortOrder === 'asc' ? comparison : -comparison;\n        });\n      }\n\n      // Paginate\n      results = results.slice(offset, offset + limit);\n\n      return { results, total, limit, offset };\n    } catch (error) {\n      logger.error('Advanced search error:', error);\n      return { results: [], total: 0 };\n    }\n  }\n\n  /**\n   * Get search suggestions\n   */\n  getSuggestions(query, collection, limit = 10) {\n    try {\n      const indexData = this.indexes[collection];\n      if (!indexData) return [];\n\n      const queryTokens = this.tokenize(query);\n      const suggestions = new Map();\n\n      queryTokens.forEach(token => {\n        indexData.index.forEach((docIds, indexToken) => {\n          if (indexToken.startsWith(token)) {\n            suggestions.set(indexToken, (suggestions.get(indexToken) || 0) + 1);\n          }\n        });\n      });\n\n      return Array.from(suggestions.entries())\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, limit)\n        .map(([suggestion, count]) => ({ suggestion, count }));\n    } catch (error) {\n      logger.error('Suggestions error:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Clear cache\n   */\n  clearCache() {\n    this.cache.clear();\n  }\n\n  /**\n   * Get statistics\n   */\n  getStats() {\n    return {\n      indexes: Object.keys(this.indexes).length,\n      cacheSize: this.cache.size,\n      indexDetails: Object.entries(this.indexes).map(([name, data]) => ({\n        name,\n        documents: data.documents.size,\n        tokens: data.index.size,\n        createdAt: data.createdAt,\n      })),\n    };\n  }\n}\n\nmodule.exports = new SearchEngine();\n"],"mappings":"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","ignoreList":[]}