42ee8de6fa9280cdacc53c7ac967f924
/**
 * Authentication Middleware
 * Basic auth middleware for protected routes
 */

const jwt = require('jwt-simple');
const logger = require('../utils/logger');
const SECRET = process.env.JWT_SECRET || 'your-secret-key';

/**
 * Verify JWT token
 */
const verifyToken = (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    if (!token) {
      return res.status(401).json({
        success: false,
        error: 'No token provided'
      });
    }

    // Decode base64 token (as generated by AuthService)
    let decoded;
    try {
      decoded = JSON.parse(Buffer.from(token, 'base64').toString());
    } catch (_e) {
      // If base64 decoding fails, try JWT
      try {
        decoded = jwt.decode(token, SECRET);
      } catch (_jwtError) {
        // If both fail, return invalid token error
        return res.status(401).json({
          success: false,
          error: 'Invalid token'
        });
      }
    }
    if (decoded.exp && decoded.exp < Date.now()) {
      return res.status(401).json({
        success: false,
        error: 'Token expired'
      });
    }
    req.user = decoded;
    next();
  } catch (error) {
    logger.error('Token verification failed:', error);
    res.status(401).json({
      success: false,
      error: 'Invalid token'
    });
  }
};

/**
 * Optional authentication - doesn't fail if no token
 */
const optionalAuth = (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    if (token) {
      // Decode base64 token (as generated by AuthService)
      let decoded;
      try {
        decoded = JSON.parse(Buffer.from(token, 'base64').toString());
      } catch (_e) {
        // Try JWT decoding as fallback
        try {
          decoded = jwt.decode(token, SECRET);
        } catch (jwtError) {
          // If both fail, just continue without user
          return next();
        }
      }
      if (!decoded.exp || decoded.exp >= Date.now()) {
        req.user = decoded;
      }
    }
    next();
  } catch (_error) {
    logger.debug('Optional auth failed:', _error.message);
    next();
  }
};

/**
 * Admin authorization
 */

// RBAC متقدم: تحقق من الدور والصلاحيات والسياق المؤسسي/الفرعي
const requireAdmin = (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  // تحقق من الدور الأساسي أو الأدوار الإضافية
  const isAdmin = req.user.role === 'admin' || Array.isArray(req.user.roles) && req.user.roles.includes('admin');
  if (!isAdmin) {
    return res.status(403).json({
      error: 'Admin access required'
    });
  }
  // تحقق من المؤسسة/الفرع إذا تم تمرير orgId/branchId في الطلب
  if (req.params.orgId && req.user.organizationId && req.params.orgId !== req.user.organizationId) {
    return res.status(403).json({
      error: 'Access denied for this organization'
    });
  }
  if (req.params.branchId && req.user.branchId && req.params.branchId !== req.user.branchId) {
    return res.status(403).json({
      error: 'Access denied for this branch'
    });
  }
  next();
};

// ميدل وير لصلاحيات granular (permission string)
const requirePermission = permission => (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  // تحقق من الصلاحيات
  const hasPermission = Array.isArray(req.user.permissions) && req.user.permissions.includes(permission);
  if (!hasPermission) {
    return res.status(403).json({
      error: 'Permission denied'
    });
  }
  // تحقق من المؤسسة/الفرع إذا لزم
  if (req.params.orgId && req.user.organizationId && req.params.orgId !== req.user.organizationId) {
    return res.status(403).json({
      error: 'Access denied for this organization'
    });
  }
  if (req.params.branchId && req.user.branchId && req.params.branchId !== req.user.branchId) {
    return res.status(403).json({
      error: 'Access denied for this branch'
    });
  }
  next();
};

/**
 * Authenticate middleware (alias for verifyToken)
 */
const authenticate = verifyToken;

/**
 * Authorization middleware - checks multiple roles
 */
const authorize = (...allowedRoles) => (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  if (allowedRoles.length > 0 && !allowedRoles.includes(req.user.role)) {
    return res.status(403).json({
      error: 'Insufficient permissions'
    });
  }
  next();
};
module.exports = {
  verifyToken,
  optionalAuth,
  requireAdmin,
  requirePermission,
  authenticate,
  authorize,
  protect: verifyToken // Alias for backward compatibility
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwibG9nZ2VyIiwiU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ2ZXJpZnlUb2tlbiIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3BsaXQiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiZGVjb2RlZCIsIkpTT04iLCJwYXJzZSIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsIl9lIiwiZGVjb2RlIiwiX2p3dEVycm9yIiwiZXhwIiwiRGF0ZSIsIm5vdyIsInVzZXIiLCJvcHRpb25hbEF1dGgiLCJqd3RFcnJvciIsIl9lcnJvciIsImRlYnVnIiwibWVzc2FnZSIsInJlcXVpcmVBZG1pbiIsImlzQWRtaW4iLCJyb2xlIiwiQXJyYXkiLCJpc0FycmF5Iiwicm9sZXMiLCJpbmNsdWRlcyIsInBhcmFtcyIsIm9yZ0lkIiwib3JnYW5pemF0aW9uSWQiLCJicmFuY2hJZCIsInJlcXVpcmVQZXJtaXNzaW9uIiwicGVybWlzc2lvbiIsImhhc1Blcm1pc3Npb24iLCJwZXJtaXNzaW9ucyIsImF1dGhlbnRpY2F0ZSIsImF1dGhvcml6ZSIsImFsbG93ZWRSb2xlcyIsImxlbmd0aCIsIm1vZHVsZSIsImV4cG9ydHMiLCJwcm90ZWN0Il0sInNvdXJjZXMiOlsiYXV0aC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQXV0aGVudGljYXRpb24gTWlkZGxld2FyZVxyXG4gKiBCYXNpYyBhdXRoIG1pZGRsZXdhcmUgZm9yIHByb3RlY3RlZCByb3V0ZXNcclxuICovXHJcblxyXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqd3Qtc2ltcGxlJyk7XHJcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJy4uL3V0aWxzL2xvZ2dlcicpO1xyXG5cclxuY29uc3QgU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAneW91ci1zZWNyZXQta2V5JztcclxuXHJcbi8qKlxyXG4gKiBWZXJpZnkgSldUIHRva2VuXHJcbiAqL1xyXG5jb25zdCB2ZXJpZnlUb2tlbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24/LnNwbGl0KCcgJylbMV07XHJcblxyXG4gICAgaWYgKCF0b2tlbikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyB0b2tlbiBwcm92aWRlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRGVjb2RlIGJhc2U2NCB0b2tlbiAoYXMgZ2VuZXJhdGVkIGJ5IEF1dGhTZXJ2aWNlKVxyXG4gICAgbGV0IGRlY29kZWQ7XHJcbiAgICB0cnkge1xyXG4gICAgICBkZWNvZGVkID0gSlNPTi5wYXJzZShCdWZmZXIuZnJvbSh0b2tlbiwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkpO1xyXG4gICAgfSBjYXRjaCAoX2UpIHtcclxuICAgICAgLy8gSWYgYmFzZTY0IGRlY29kaW5nIGZhaWxzLCB0cnkgSldUXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgZGVjb2RlZCA9IGp3dC5kZWNvZGUodG9rZW4sIFNFQ1JFVCk7XHJcbiAgICAgIH0gY2F0Y2ggKF9qd3RFcnJvcikge1xyXG4gICAgICAgIC8vIElmIGJvdGggZmFpbCwgcmV0dXJuIGludmFsaWQgdG9rZW4gZXJyb3JcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHRva2VuJyB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChkZWNvZGVkLmV4cCAmJiBkZWNvZGVkLmV4cCA8IERhdGUubm93KCkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVG9rZW4gZXhwaXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVxLnVzZXIgPSBkZWNvZGVkO1xyXG4gICAgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ1Rva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHRva2VuJyB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogT3B0aW9uYWwgYXV0aGVudGljYXRpb24gLSBkb2Vzbid0IGZhaWwgaWYgbm8gdG9rZW5cclxuICovXHJcbmNvbnN0IG9wdGlvbmFsQXV0aCA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24/LnNwbGl0KCcgJylbMV07XHJcblxyXG4gICAgaWYgKHRva2VuKSB7XHJcbiAgICAgIC8vIERlY29kZSBiYXNlNjQgdG9rZW4gKGFzIGdlbmVyYXRlZCBieSBBdXRoU2VydmljZSlcclxuICAgICAgbGV0IGRlY29kZWQ7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgZGVjb2RlZCA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20odG9rZW4sICdiYXNlNjQnKS50b1N0cmluZygpKTtcclxuICAgICAgfSBjYXRjaCAoX2UpIHtcclxuICAgICAgICAvLyBUcnkgSldUIGRlY29kaW5nIGFzIGZhbGxiYWNrXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGRlY29kZWQgPSBqd3QuZGVjb2RlKHRva2VuLCBTRUNSRVQpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGp3dEVycm9yKSB7XHJcbiAgICAgICAgICAvLyBJZiBib3RoIGZhaWwsIGp1c3QgY29udGludWUgd2l0aG91dCB1c2VyXHJcbiAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFkZWNvZGVkLmV4cCB8fCBkZWNvZGVkLmV4cCA+PSBEYXRlLm5vdygpKSB7XHJcbiAgICAgICAgcmVxLnVzZXIgPSBkZWNvZGVkO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggKF9lcnJvcikge1xyXG4gICAgbG9nZ2VyLmRlYnVnKCdPcHRpb25hbCBhdXRoIGZhaWxlZDonLCBfZXJyb3IubWVzc2FnZSk7XHJcbiAgICBuZXh0KCk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkbWluIGF1dGhvcml6YXRpb25cclxuICovXHJcblxyXG4vLyBSQkFDINmF2KrZgtiv2YU6INiq2K3ZgtmCINmF2YYg2KfZhNiv2YjYsSDZiNin2YTYtdmE2KfYrdmK2KfYqiDZiNin2YTYs9mK2KfZgiDYp9mE2YXYpNiz2LPZii/Yp9mE2YHYsdi52YpcclxuY29uc3QgcmVxdWlyZUFkbWluID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgaWYgKCFyZXEudXNlcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNiv2YjYsSDYp9mE2KPYs9in2LPZiiDYo9mIINin2YTYo9iv2YjYp9ixINin2YTYpdi22KfZgdmK2KlcclxuICBjb25zdCBpc0FkbWluID1cclxuICAgIHJlcS51c2VyLnJvbGUgPT09ICdhZG1pbicgfHxcclxuICAgIChBcnJheS5pc0FycmF5KHJlcS51c2VyLnJvbGVzKSAmJiByZXEudXNlci5yb2xlcy5pbmNsdWRlcygnYWRtaW4nKSk7XHJcbiAgaWYgKCFpc0FkbWluKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNmF2KTYs9iz2Kkv2KfZhNmB2LHYuSDYpdiw2Kcg2KrZhSDYqtmF2LHZitixIG9yZ0lkL2JyYW5jaElkINmB2Yog2KfZhNi32YTYqFxyXG4gIGlmIChyZXEucGFyYW1zLm9yZ0lkICYmIHJlcS51c2VyLm9yZ2FuaXphdGlvbklkICYmIHJlcS5wYXJhbXMub3JnSWQgIT09IHJlcS51c2VyLm9yZ2FuaXphdGlvbklkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ0FjY2VzcyBkZW5pZWQgZm9yIHRoaXMgb3JnYW5pemF0aW9uJyB9KTtcclxuICB9XHJcbiAgaWYgKHJlcS5wYXJhbXMuYnJhbmNoSWQgJiYgcmVxLnVzZXIuYnJhbmNoSWQgJiYgcmVxLnBhcmFtcy5icmFuY2hJZCAhPT0gcmVxLnVzZXIuYnJhbmNoSWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnQWNjZXNzIGRlbmllZCBmb3IgdGhpcyBicmFuY2gnIH0pO1xyXG4gIH1cclxuICBuZXh0KCk7XHJcbn07XHJcblxyXG4vLyDZhdmK2K/ZhCDZiNmK2LEg2YTYtdmE2KfYrdmK2KfYqiBncmFudWxhciAocGVybWlzc2lvbiBzdHJpbmcpXHJcbmNvbnN0IHJlcXVpcmVQZXJtaXNzaW9uID0gcGVybWlzc2lvbiA9PiAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICBpZiAoIXJlcS51c2VyKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9KTtcclxuICB9XHJcbiAgLy8g2KrYrdmC2YIg2YXZhiDYp9mE2LXZhNin2K3Zitin2KpcclxuICBjb25zdCBoYXNQZXJtaXNzaW9uID1cclxuICAgIEFycmF5LmlzQXJyYXkocmVxLnVzZXIucGVybWlzc2lvbnMpICYmIHJlcS51c2VyLnBlcm1pc3Npb25zLmluY2x1ZGVzKHBlcm1pc3Npb24pO1xyXG4gIGlmICghaGFzUGVybWlzc2lvbikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdQZXJtaXNzaW9uIGRlbmllZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNmF2KTYs9iz2Kkv2KfZhNmB2LHYuSDYpdiw2Kcg2YTYstmFXHJcbiAgaWYgKHJlcS5wYXJhbXMub3JnSWQgJiYgcmVxLnVzZXIub3JnYW5pemF0aW9uSWQgJiYgcmVxLnBhcmFtcy5vcmdJZCAhPT0gcmVxLnVzZXIub3JnYW5pemF0aW9uSWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnQWNjZXNzIGRlbmllZCBmb3IgdGhpcyBvcmdhbml6YXRpb24nIH0pO1xyXG4gIH1cclxuICBpZiAocmVxLnBhcmFtcy5icmFuY2hJZCAmJiByZXEudXNlci5icmFuY2hJZCAmJiByZXEucGFyYW1zLmJyYW5jaElkICE9PSByZXEudXNlci5icmFuY2hJZCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkIGZvciB0aGlzIGJyYW5jaCcgfSk7XHJcbiAgfVxyXG4gIG5leHQoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBdXRoZW50aWNhdGUgbWlkZGxld2FyZSAoYWxpYXMgZm9yIHZlcmlmeVRva2VuKVxyXG4gKi9cclxuY29uc3QgYXV0aGVudGljYXRlID0gdmVyaWZ5VG9rZW47XHJcblxyXG4vKipcclxuICogQXV0aG9yaXphdGlvbiBtaWRkbGV3YXJlIC0gY2hlY2tzIG11bHRpcGxlIHJvbGVzXHJcbiAqL1xyXG5jb25zdCBhdXRob3JpemUgPVxyXG4gICguLi5hbGxvd2VkUm9sZXMpID0+XHJcbiAgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICBpZiAoIXJlcS51c2VyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhbGxvd2VkUm9sZXMubGVuZ3RoID4gMCAmJiAhYWxsb3dlZFJvbGVzLmluY2x1ZGVzKHJlcS51c2VyLnJvbGUpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZXh0KCk7XHJcbiAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHZlcmlmeVRva2VuLFxyXG4gIG9wdGlvbmFsQXV0aCxcclxuICByZXF1aXJlQWRtaW4sXHJcbiAgcmVxdWlyZVBlcm1pc3Npb24sXHJcbiAgYXV0aGVudGljYXRlLFxyXG4gIGF1dGhvcml6ZSxcclxuICBwcm90ZWN0OiB2ZXJpZnlUb2tlbiwgLy8gQWxpYXMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxZQUFZLENBQUM7QUFDakMsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFFekMsTUFBTUUsTUFBTSxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJLGlCQUFpQjs7QUFFMUQ7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsV0FBVyxHQUFHQSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ3RDLElBQUk7SUFDRixNQUFNQyxLQUFLLEdBQUdILEdBQUcsQ0FBQ0ksT0FBTyxDQUFDQyxhQUFhLEVBQUVDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFdEQsSUFBSSxDQUFDSCxLQUFLLEVBQUU7TUFDVixPQUFPRixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQUVDLE9BQU8sRUFBRSxLQUFLO1FBQUVDLEtBQUssRUFBRTtNQUFvQixDQUFDLENBQUM7SUFDN0U7O0lB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