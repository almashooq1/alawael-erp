95895d95b5ecabdc228fc78a936dd591
/**
 * Supply Chain Management Service
 * نظام إدارة سلسلة التوريد
 * 
 * Features:
 * - Supplier management
 * - Inventory tracking
 * - Purchase orders
 * - Shipments
 * - Analytics
 */

const logger = require('../utils/logger');
const SupplyChainRepository = require('../repositories/supplyChainRepository');
class SupplyChainService {
  constructor() {
    this.repository = SupplyChainRepository;
    logger.info('SupplyChainService initialized with MongoDB repository');
  }

  // ============================================
  // SUPPLIER MANAGEMENT
  // ============================================

  async createSupplier(supplierData) {
    try {
      const supplier = await this.repository.createSupplier(supplierData);
      return supplier;
    } catch (error) {
      logger.error('Failed to create supplier:', error);
      throw error;
    }
  }
  async getSupplier(supplierId) {
    try {
      const supplier = await this.repository.getSupplier(supplierId);
      if (!supplier) {
        const err = new Error('Supplier not found');
        err.statusCode = 404;
        throw err;
      }
      return supplier;
    } catch (error) {
      logger.error('Failed to get supplier:', error);
      throw error;
    }
  }
  async listSuppliers(filters = {}) {
    try {
      const result = await this.repository.listSuppliers(filters);
      return {
        total: result.total,
        suppliers: result.suppliers
      };
    } catch (error) {
      logger.error('Failed to list suppliers:', error);
      throw error;
    }
  }
  async updateSupplier(supplierId, updateData) {
    try {
      const supplier = await this.repository.updateSupplier(supplierId, updateData);
      if (!supplier) {
        const err = new Error('Supplier not found');
        err.statusCode = 404;
        throw err;
      }
      return supplier;
    } catch (error) {
      logger.error('Failed to update supplier:', error);
      throw error;
    }
  }
  async deleteSupplier(supplierId) {
    try {
      const supplier = await this.repository.deleteSupplier(supplierId);
      if (!supplier) {
        const err = new Error('Supplier not found');
        err.statusCode = 404;
        throw err;
      }
      return supplier;
    } catch (error) {
      logger.error('Failed to delete supplier:', error);
      throw error;
    }
  }

  // ============================================
  // INVENTORY MANAGEMENT
  // ============================================

  async addToInventory(productData) {
    try {
      const product = await this.repository.addProduct(productData);
      return product;
    } catch (error) {
      logger.error('Failed to add to inventory:', error);
      throw error;
    }
  }
  async updateInventory(productId, quantityChange, reason = 'manual') {
    try {
      const result = await this.repository.updateProductQuantity(productId, quantityChange, reason);
      return {
        product: result.product,
        oldQuantity: result.oldQuantity,
        newQuantity: result.newQuantity,
        change: quantityChange,
        reason
      };
    } catch (error) {
      logger.error('Failed to update inventory:', error);
      throw error;
    }
  }
  async listInventory(filters = {}) {
    try {
      const result = await this.repository.listProducts(filters);
      return Array.isArray(result) ? result : result.products || [];
    } catch (error) {
      logger.error('Failed to list inventory:', error);
      throw error;
    }
  }
  async getInventoryStatus() {
    try {
      const status = await this.repository.getInventoryStatus();
      return status;
    } catch (error) {
      logger.error('Failed to get inventory status:', error);
      throw error;
    }
  }

  // ============================================
  // PURCHASE ORDERS
  // ============================================

  async createPurchaseOrder(orderData) {
    try {
      const order = await this.repository.createPurchaseOrder(orderData);
      return order;
    } catch (error) {
      logger.error('Failed to create purchase order:', error);
      throw error;
    }
  }
  async updateOrderStatus(orderId, status, note = '') {
    try {
      const order = await this.repository.updateOrderStatus(orderId, status, note);
      if (!order) {
        const err = new Error('Order not found');
        err.statusCode = 404;
        throw err;
      }
      return order;
    } catch (error) {
      logger.error('Failed to update order status:', error);
      throw error;
    }
  }
  async getPurchaseOrder(orderId) {
    try {
      const order = await this.repository.getPurchaseOrder(orderId);
      if (!order) {
        const err = new Error('Order not found');
        err.statusCode = 404;
        throw err;
      }
      return order;
    } catch (error) {
      logger.error('Failed to get purchase order:', error);
      throw error;
    }
  }
  async listPurchaseOrders(filters = {}) {
    try {
      const result = await this.repository.listPurchaseOrders(filters);
      return {
        total: result.total,
        orders: result.orders
      };
    } catch (error) {
      logger.error('Failed to list purchase orders:', error);
      throw error;
    }
  }

  // ============================================
  // SHIPMENT TRACKING
  // ============================================

  async createShipment(shipmentData) {
    try {
      const shipment = await this.repository.createShipment(shipmentData);
      return shipment;
    } catch (error) {
      logger.error('Failed to create shipment:', error);
      throw error;
    }
  }
  async updateShipmentStatus(shipmentId, status, location = '', coordinates = null) {
    try {
      const shipment = await this.repository.updateShipmentStatus(shipmentId, status, location, coordinates);
      if (!shipment) {
        const err = new Error('Shipment not found');
        err.statusCode = 404;
        throw err;
      }
      return shipment;
    } catch (error) {
      logger.error('Failed to update shipment status:', error);
      throw error;
    }
  }
  async trackShipment(trackingNumber) {
    try {
      const shipment = await this.repository.getShipmentByTracking(trackingNumber);
      return shipment;
    } catch (error) {
      logger.error('Failed to track shipment:', error);
      throw error;
    }
  }
  async listShipments(filters = {}) {
    try {
      const result = await this.repository.listShipments(filters);
      return Array.isArray(result) ? result : result.shipments || [];
    } catch (error) {
      logger.error('Failed to list shipments:', error);
      throw error;
    }
  }
  async deleteShipment(shipmentId) {
    try {
      const shipment = await this.repository.deleteShipment(shipmentId);
      if (!shipment) {
        const err = new Error('Shipment not found');
        err.statusCode = 404;
        throw err;
      }
      return shipment;
    } catch (error) {
      logger.error('Failed to delete shipment:', error);
      throw error;
    }
  }

  // ============================================
  // PURCHASE ORDER DELETION
  // ============================================

  async deletePurchaseOrder(orderId) {
    try {
      const order = await this.repository.deletePurchaseOrder(orderId);
      if (!order) {
        const err = new Error('Order not found');
        err.statusCode = 404;
        throw err;
      }
      return order;
    } catch (error) {
      logger.error('Failed to delete purchase order:', error);
      throw error;
    }
  }
  async getSupplyChainAnalytics() {
    try {
      const analytics = await this.repository.getAnalytics();
      return analytics;
    } catch (error) {
      logger.error('Failed to get supply chain analytics:', error);
      throw error;
    }
  }
}
module.exports = new SupplyChainService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiU3VwcGx5Q2hhaW5SZXBvc2l0b3J5IiwiU3VwcGx5Q2hhaW5TZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJyZXBvc2l0b3J5IiwiaW5mbyIsImNyZWF0ZVN1cHBsaWVyIiwic3VwcGxpZXJEYXRhIiwic3VwcGxpZXIiLCJlcnJvciIsImdldFN1cHBsaWVyIiwic3VwcGxpZXJJZCIsImVyciIsIkVycm9yIiwic3RhdHVzQ29kZSIsImxpc3RTdXBwbGllcnMiLCJmaWx0ZXJzIiwicmVzdWx0IiwidG90YWwiLCJzdXBwbGllcnMiLCJ1cGRhdGVTdXBwbGllciIsInVwZGF0ZURhdGEiLCJkZWxldGVTdXBwbGllciIsImFkZFRvSW52ZW50b3J5IiwicHJvZHVjdERhdGEiLCJwcm9kdWN0IiwiYWRkUHJvZHVjdCIsInVwZGF0ZUludmVudG9yeSIsInByb2R1Y3RJZCIsInF1YW50aXR5Q2hhbmdlIiwicmVhc29uIiwidXBkYXRlUHJvZHVjdFF1YW50aXR5Iiwib2xkUXVhbnRpdHkiLCJuZXdRdWFudGl0eSIsImNoYW5nZSIsImxpc3RJbnZlbnRvcnkiLCJsaXN0UHJvZHVjdHMiLCJBcnJheSIsImlzQXJyYXkiLCJwcm9kdWN0cyIsImdldEludmVudG9yeVN0YXR1cyIsInN0YXR1cyIsImNyZWF0ZVB1cmNoYXNlT3JkZXIiLCJvcmRlckRhdGEiLCJvcmRlciIsInVwZGF0ZU9yZGVyU3RhdHVzIiwib3JkZXJJZCIsIm5vdGUiLCJnZXRQdXJjaGFzZU9yZGVyIiwibGlzdFB1cmNoYXNlT3JkZXJzIiwib3JkZXJzIiwiY3JlYXRlU2hpcG1lbnQiLCJzaGlwbWVudERhdGEiLCJzaGlwbWVudCIsInVwZGF0ZVNoaXBtZW50U3RhdHVzIiwic2hpcG1lbnRJZCIsImxvY2F0aW9uIiwiY29vcmRpbmF0ZXMiLCJ0cmFja1NoaXBtZW50IiwidHJhY2tpbmdOdW1iZXIiLCJnZXRTaGlwbWVudEJ5VHJhY2tpbmciLCJsaXN0U2hpcG1lbnRzIiwic2hpcG1lbnRzIiwiZGVsZXRlU2hpcG1lbnQiLCJkZWxldGVQdXJjaGFzZU9yZGVyIiwiZ2V0U3VwcGx5Q2hhaW5BbmFseXRpY3MiLCJhbmFseXRpY3MiLCJnZXRBbmFseXRpY3MiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic3VwcGx5Q2hhaW4uc2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogU3VwcGx5IENoYWluIE1hbmFnZW1lbnQgU2VydmljZVxyXG4gKiDZhti42KfZhSDYpdiv2KfYsdipINiz2YTYs9mE2Kkg2KfZhNiq2YjYsdmK2K9cclxuICogXHJcbiAqIEZlYXR1cmVzOlxyXG4gKiAtIFN1cHBsaWVyIG1hbmFnZW1lbnRcclxuICogLSBJbnZlbnRvcnkgdHJhY2tpbmdcclxuICogLSBQdXJjaGFzZSBvcmRlcnNcclxuICogLSBTaGlwbWVudHNcclxuICogLSBBbmFseXRpY3NcclxuICovXHJcblxyXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuLi91dGlscy9sb2dnZXInKTtcclxuY29uc3QgU3VwcGx5Q2hhaW5SZXBvc2l0b3J5ID0gcmVxdWlyZSgnLi4vcmVwb3NpdG9yaWVzL3N1cHBseUNoYWluUmVwb3NpdG9yeScpO1xyXG5cclxuY2xhc3MgU3VwcGx5Q2hhaW5TZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMucmVwb3NpdG9yeSA9IFN1cHBseUNoYWluUmVwb3NpdG9yeTtcclxuICAgIGxvZ2dlci5pbmZvKCdTdXBwbHlDaGFpblNlcnZpY2UgaW5pdGlhbGl6ZWQgd2l0aCBNb25nb0RCIHJlcG9zaXRvcnknKTtcclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8gU1VQUExJRVIgTUFOQUdFTUVOVFxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIGFzeW5jIGNyZWF0ZVN1cHBsaWVyKHN1cHBsaWVyRGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc3VwcGxpZXIgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuY3JlYXRlU3VwcGxpZXIoc3VwcGxpZXJEYXRhKTtcclxuICAgICAgcmV0dXJuIHN1cHBsaWVyO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHN1cHBsaWVyOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRTdXBwbGllcihzdXBwbGllcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzdXBwbGllciA9IGF3YWl0IHRoaXMucmVwb3NpdG9yeS5nZXRTdXBwbGllcihzdXBwbGllcklkKTtcclxuICAgICAgaWYgKCFzdXBwbGllcikge1xyXG4gICAgICAgIGNvbnN0IGVyciA9IG5ldyBFcnJvcignU3VwcGxpZXIgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgZXJyLnN0YXR1c0NvZGUgPSA0MDQ7XHJcbiAgICAgICAgdGhyb3cgZXJyO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdXBwbGllcjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBzdXBwbGllcjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgbGlzdFN1cHBsaWVycyhmaWx0ZXJzID0ge30pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucmVwb3NpdG9yeS5saXN0U3VwcGxpZXJzKGZpbHRlcnMpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHRvdGFsOiByZXN1bHQudG90YWwsXHJcbiAgICAgICAgc3VwcGxpZXJzOiByZXN1bHQuc3VwcGxpZXJzXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsaXN0IHN1cHBsaWVyczonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBkYXRlU3VwcGxpZXIoc3VwcGxpZXJJZCwgdXBkYXRlRGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc3VwcGxpZXIgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkudXBkYXRlU3VwcGxpZXIoc3VwcGxpZXJJZCwgdXBkYXRlRGF0YSk7XHJcbiAgICAgIGlmICghc3VwcGxpZXIpIHtcclxuICAgICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoJ1N1cHBsaWVyIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIGVyci5zdGF0dXNDb2RlID0gNDA0O1xyXG4gICAgICAgIHRocm93IGVycjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gc3VwcGxpZXI7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgc3VwcGxpZXI6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGRlbGV0ZVN1cHBsaWVyKHN1cHBsaWVySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN1cHBsaWVyID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5LmRlbGV0ZVN1cHBsaWVyKHN1cHBsaWVySWQpO1xyXG4gICAgICBpZiAoIXN1cHBsaWVyKSB7XHJcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKCdTdXBwbGllciBub3QgZm91bmQnKTtcclxuICAgICAgICBlcnIuc3RhdHVzQ29kZSA9IDQwNDtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHN1cHBsaWVyO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIHN1cHBsaWVyOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gIC8vIElOVkVOVE9SWSBNQU5BR0VNRU5UXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgYXN5bmMgYWRkVG9JbnZlbnRvcnkocHJvZHVjdERhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuYWRkUHJvZHVjdChwcm9kdWN0RGF0YSk7XHJcbiAgICAgIHJldHVybiBwcm9kdWN0O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gYWRkIHRvIGludmVudG9yeTonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBkYXRlSW52ZW50b3J5KHByb2R1Y3RJZCwgcXVhbnRpdHlDaGFuZ2UsIHJlYXNvbiA9ICdtYW51YWwnKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkudXBkYXRlUHJvZHVjdFF1YW50aXR5KHByb2R1Y3RJZCwgcXVhbnRpdHlDaGFuZ2UsIHJlYXNvbik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgcHJvZHVjdDogcmVzdWx0LnByb2R1Y3QsXHJcbiAgICAgICAgb2xkUXVhbnRpdHk6IHJlc3VsdC5vbGRRdWFudGl0eSxcclxuICAgICAgICBuZXdRdWFudGl0eTogcmVzdWx0Lm5ld1F1YW50aXR5LFxyXG4gICAgICAgIGNoYW5nZTogcXVhbnRpdHlDaGFuZ2UsXHJcbiAgICAgICAgcmVhc29uXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgaW52ZW50b3J5OicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBsaXN0SW52ZW50b3J5KGZpbHRlcnMgPSB7fSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5Lmxpc3RQcm9kdWN0cyhmaWx0ZXJzKTtcclxuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocmVzdWx0KSA/IHJlc3VsdCA6IHJlc3VsdC5wcm9kdWN0cyB8fCBbXTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGxpc3QgaW52ZW50b3J5OicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRJbnZlbnRvcnlTdGF0dXMoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuZ2V0SW52ZW50b3J5U3RhdHVzKCk7XHJcbiAgICAgIHJldHVybiBzdGF0dXM7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgaW52ZW50b3J5IHN0YXR1czonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBQVVJDSEFTRSBPUkRFUlNcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICBhc3luYyBjcmVhdGVQdXJjaGFzZU9yZGVyKG9yZGVyRGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgb3JkZXIgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuY3JlYXRlUHVyY2hhc2VPcmRlcihvcmRlckRhdGEpO1xyXG4gICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgcHVyY2hhc2Ugb3JkZXI6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHVwZGF0ZU9yZGVyU3RhdHVzKG9yZGVySWQsIHN0YXR1cywgbm90ZSA9ICcnKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBvcmRlciA9IGF3YWl0IHRoaXMucmVwb3NpdG9yeS51cGRhdGVPcmRlclN0YXR1cyhvcmRlcklkLCBzdGF0dXMsIG5vdGUpO1xyXG4gICAgICBpZiAoIW9yZGVyKSB7XHJcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKCdPcmRlciBub3QgZm91bmQnKTtcclxuICAgICAgICBlcnIuc3RhdHVzQ29kZSA9IDQwNDtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIG9yZGVyIHN0YXR1czonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0UHVyY2hhc2VPcmRlcihvcmRlcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBvcmRlciA9IGF3YWl0IHRoaXMucmVwb3NpdG9yeS5nZXRQdXJjaGFzZU9yZGVyKG9yZGVySWQpO1xyXG4gICAgICBpZiAoIW9yZGVyKSB7XHJcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKCdPcmRlciBub3QgZm91bmQnKTtcclxuICAgICAgICBlcnIuc3RhdHVzQ29kZSA9IDQwNDtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG9yZGVyO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHB1cmNoYXNlIG9yZGVyOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBsaXN0UHVyY2hhc2VPcmRlcnMoZmlsdGVycyA9IHt9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkubGlzdFB1cmNoYXNlT3JkZXJzKGZpbHRlcnMpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHRvdGFsOiByZXN1bHQudG90YWwsXHJcbiAgICAgICAgb3JkZXJzOiByZXN1bHQub3JkZXJzXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsaXN0IHB1cmNoYXNlIG9yZGVyczonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBTSElQTUVOVCBUUkFDS0lOR1xyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIGFzeW5jIGNyZWF0ZVNoaXBtZW50KHNoaXBtZW50RGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2hpcG1lbnQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuY3JlYXRlU2hpcG1lbnQoc2hpcG1lbnREYXRhKTtcclxuICAgICAgcmV0dXJuIHNoaXBtZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHNoaXBtZW50OicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyB1cGRhdGVTaGlwbWVudFN0YXR1cyhzaGlwbWVudElkLCBzdGF0dXMsIGxvY2F0aW9uID0gJycsIGNvb3JkaW5hdGVzID0gbnVsbCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2hpcG1lbnQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkudXBkYXRlU2hpcG1lbnRTdGF0dXMoc2hpcG1lbnRJZCwgc3RhdHVzLCBsb2NhdGlvbiwgY29vcmRpbmF0ZXMpO1xyXG4gICAgICBpZiAoIXNoaXBtZW50KSB7XHJcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKCdTaGlwbWVudCBub3QgZm91bmQnKTtcclxuICAgICAgICBlcnIuc3RhdHVzQ29kZSA9IDQwNDtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHNoaXBtZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIHNoaXBtZW50IHN0YXR1czonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgdHJhY2tTaGlwbWVudCh0cmFja2luZ051bWJlcikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2hpcG1lbnQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuZ2V0U2hpcG1lbnRCeVRyYWNraW5nKHRyYWNraW5nTnVtYmVyKTtcclxuICAgICAgcmV0dXJuIHNoaXBtZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gdHJhY2sgc2hpcG1lbnQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGxpc3RTaGlwbWVudHMoZmlsdGVycyA9IHt9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkubGlzdFNoaXBtZW50cyhmaWx0ZXJzKTtcclxuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocmVzdWx0KSA/IHJlc3VsdCA6IHJlc3VsdC5zaGlwbWVudHMgfHwgW107XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBsaXN0IHNoaXBtZW50czonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGVsZXRlU2hpcG1lbnQoc2hpcG1lbnRJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2hpcG1lbnQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuZGVsZXRlU2hpcG1lbnQoc2hpcG1lbnRJZCk7XHJcbiAgICAgIGlmICghc2hpcG1lbnQpIHtcclxuICAgICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoJ1NoaXBtZW50IG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIGVyci5zdGF0dXNDb2RlID0gNDA0O1xyXG4gICAgICAgIHRocm93IGVycjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gc2hpcG1lbnQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBkZWxldGUgc2hpcG1lbnQ6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8gUFVSQ0hBU0UgT1JERVIgREVMRVRJT05cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICBhc3luYyBkZWxldGVQdXJjaGFzZU9yZGVyKG9yZGVySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5LmRlbGV0ZVB1cmNoYXNlT3JkZXIob3JkZXJJZCk7XHJcbiAgICAgIGlmICghb3JkZXIpIHtcclxuICAgICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoJ09yZGVyIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIGVyci5zdGF0dXNDb2RlID0gNDA0O1xyXG4gICAgICAgIHRocm93IGVycjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gb3JkZXI7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBkZWxldGUgcHVyY2hhc2Ugb3JkZXI6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFN1cHBseUNoYWluQW5hbHl0aWNzKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgYW5hbHl0aWNzID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5LmdldEFuYWx5dGljcygpO1xyXG4gICAgICByZXR1cm4gYW5hbHl0aWNzO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHN1cHBseSBjaGFpbiBhbmFseXRpY3M6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbmV3IFN1cHBseUNoYWluU2VydmljZSgpO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsTUFBTSxH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