401a7294ff8e43ecc2ea4981260e9d1e
const mongoose = require('mongoose');
const digitalLibrarySchema = new mongoose.Schema({
  title: {
    type: String,
    required: [true, 'عنوان المورد مطلوب'],
    trim: true
  },
  description: {
    type: String,
    required: [true, 'وصف المورد مطلوب']
  },
  resourceType: {
    type: String,
    enum: ['book', 'guide', 'article', 'research_paper', 'case_study', 'toolkit', 'template', 'tool', 'research_statistics'],
    required: true
  },
  disabilityCategories: {
    type: [String],
    enum: ['visual', 'hearing', 'mobility', 'intellectual', 'psychosocial', 'multiple'],
    default: []
  },
  author: {
    name: String,
    organization: String,
    email: String
  },
  uploader: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  fileUrl: {
    type: String,
    required: [true, 'رابط الملف مطلوب']
  },
  fileType: {
    type: String,
    enum: ['pdf', 'doc', 'xlsx', 'video', 'audio', 'image', 'link', 'other'],
    required: true
  },
  fileSize: {
    type: Number,
    description: 'حجم الملف بالبايتات'
  },
  language: {
    type: String,
    enum: ['ar', 'en', 'fr', 'multilingual'],
    default: 'ar'
  },
  publicationDate: Date,
  publisher: String,
  categories: [String],
  tags: [String],
  keywords: [String],
  accessibilityFormat: {
    hasBraille: Boolean,
    hasLargeText: Boolean,
    hasArabicSignLanguageInterpretation: Boolean,
    hasAudioVersion: Boolean,
    hasSimpleLanguageVersion: Boolean,
    isScreenReaderFriendly: Boolean
  },
  isPublic: {
    type: Boolean,
    default: true
  },
  views: {
    type: Number,
    default: 0
  },
  downloads: {
    type: Number,
    default: 0
  },
  rating: {
    average: {
      type: Number,
      default: 0,
      min: 0,
      max: 5
    },
    count: {
      type: Number,
      default: 0
    }
  },
  reviews: [{
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User'
    },
    rating: {
      type: Number,
      min: 1,
      max: 5
    },
    comment: String,
    date: {
      type: Date,
      default: Date.now
    }
  }],
  relatedResources: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'DigitalLibrary'
  }],
  status: {
    type: String,
    enum: ['draft', 'pending_review', 'approved', 'archived'],
    default: 'draft'
  },
  metadata: {
    isbn: String,
    doi: String,
    issn: String,
    edition: String,
    pages: Number,
    language_level: String
  },
  contributors: [{
    name: String,
    role: String,
    email: String
  }],
  license: {
    type: String,
    enum: ['cc_by', 'cc_by_sa', 'cc_by_nc', 'cc0', 'proprietary'],
    default: 'cc_by'
  }
}, {
  timestamps: true,
  toJSON: {
    virtuals: true
  },
  toObject: {
    virtuals: true
  }
});

// Indexes
digitalLibrarySchema.index({
  resourceType: 1,
  isPublic: 1
});
digitalLibrarySchema.index({
  disabilityCategories: 1
});
digitalLibrarySchema.index({
  uploader: 1
});
digitalLibrarySchema.index({
  categories: 1
});
digitalLibrarySchema.index({
  tags: 1
});
digitalLibrarySchema.index({
  createdAt: -1
});
digitalLibrarySchema.index({
  fileType: 1
});

// Static method to search resources
digitalLibrarySchema.statics.searchResources = function (query, filters = {}) {
  const searchQuery = {
    isPublic: true,
    status: 'approved',
    $or: [{
      title: {
        $regex: query,
        $options: 'i'
      }
    }, {
      description: {
        $regex: query,
        $options: 'i'
      }
    }, {
      tags: {
        $in: [new RegExp(query, 'i')]
      }
    }, {
      keywords: {
        $in: [new RegExp(query, 'i')]
      }
    }]
  };
  if (filters.resourceType) searchQuery.resourceType = filters.resourceType;
  if (filters.disabilityCategories) searchQuery.disabilityCategories = {
    $in: [filters.disabilityCategories]
  };
  if (filters.language) searchQuery.language = filters.language;
  return this.find(searchQuery).sort({
    'rating.average': -1,
    views: -1
  }).populate('uploader', 'name email').limit(filters.limit || 20);
};

// Static method to get resources by category
digitalLibrarySchema.statics.getByCategory = function (category, limit = 15) {
  return this.find({
    disabilityCategories: category,
    isPublic: true,
    status: 'approved'
  }).sort({
    createdAt: -1
  }).limit(limit).populate('uploader', 'name email');
};

// Instance method to increment downloads
digitalLibrarySchema.methods.incrementDownloads = function () {
  this.downloads += 1;
  return this.save();
};

// Instance method to add review
digitalLibrarySchema.methods.addReview = function (userId, rating, comment) {
  this.reviews.push({
    userId,
    rating,
    comment
  });

  // Calculate average rating
  const ratings = this.reviews.map(r => r.rating);
  this.rating.average = ratings.reduce((a, b) => a + b, 0) / ratings.length;
  this.rating.count = ratings.length;
  return this.save();
};
module.exports = mongoose.model('DigitalLibrary', digitalLibrarySchema);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJkaWdpdGFsTGlicmFyeVNjaGVtYSIsIlNjaGVtYSIsInRpdGxlIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidHJpbSIsImRlc2NyaXB0aW9uIiwicmVzb3VyY2VUeXBlIiwiZW51bSIsImRpc2FiaWxpdHlDYXRlZ29yaWVzIiwiZGVmYXVsdCIsImF1dGhvciIsIm5hbWUiLCJvcmdhbml6YXRpb24iLCJlbWFpbCIsInVwbG9hZGVyIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsImZpbGVVcmwiLCJmaWxlVHlwZSIsImZpbGVTaXplIiwiTnVtYmVyIiwibGFuZ3VhZ2UiLCJwdWJsaWNhdGlvbkRhdGUiLCJEYXRlIiwicHVibGlzaGVyIiwiY2F0ZWdvcmllcyIsInRhZ3MiLCJrZXl3b3JkcyIsImFjY2Vzc2liaWxpdHlGb3JtYXQiLCJoYXNCcmFpbGxlIiwiQm9vbGVhbiIsImhhc0xhcmdlVGV4dCIsImhhc0FyYWJpY1NpZ25MYW5ndWFnZUludGVycHJldGF0aW9uIiwiaGFzQXVkaW9WZXJzaW9uIiwiaGFzU2ltcGxlTGFuZ3VhZ2VWZXJzaW9uIiwiaXNTY3JlZW5SZWFkZXJGcmllbmRseSIsImlzUHVibGljIiwidmlld3MiLCJkb3dubG9hZHMiLCJyYXRpbmciLCJhdmVyYWdlIiwibWluIiwibWF4IiwiY291bnQiLCJyZXZpZXdzIiwidXNlcklkIiwiY29tbWVudCIsImRhdGUiLCJub3ciLCJyZWxhdGVkUmVzb3VyY2VzIiwic3RhdHVzIiwibWV0YWRhdGEiLCJpc2JuIiwiZG9pIiwiaXNzbiIsImVkaXRpb24iLCJwYWdlcyIsImxhbmd1YWdlX2xldmVsIiwiY29udHJpYnV0b3JzIiwicm9sZSIsImxpY2Vuc2UiLCJ0aW1lc3RhbXBzIiwidG9KU09OIiwidmlydHVhbHMiLCJ0b09iamVjdCIsImluZGV4IiwiY3JlYXRlZEF0Iiwic3RhdGljcyIsInNlYXJjaFJlc291cmNlcyIsInF1ZXJ5IiwiZmlsdGVycyIsInNlYXJjaFF1ZXJ5IiwiJG9yIiwiJHJlZ2V4IiwiJG9wdGlvbnMiLCIkaW4iLCJSZWdFeHAiLCJmaW5kIiwic29ydCIsInBvcHVsYXRlIiwibGltaXQiLCJnZXRCeUNhdGVnb3J5IiwiY2F0ZWdvcnkiLCJtZXRob2RzIiwiaW5jcmVtZW50RG93bmxvYWRzIiwic2F2ZSIsImFkZFJldmlldyIsInB1c2giLCJyYXRpbmdzIiwibWFwIiwiciIsInJlZHVjZSIsImEiLCJiIiwibGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIl0sInNvdXJjZXMiOlsiRGlnaXRhbExpYnJhcnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5cclxuY29uc3QgZGlnaXRhbExpYnJhcnlTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKFxyXG4gIHtcclxuICAgIHRpdGxlOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgcmVxdWlyZWQ6IFt0cnVlLCAn2LnZhtmI2KfZhiDYp9mE2YXZiNix2K8g2YXYt9mE2YjYqCddLFxyXG4gICAgICB0cmltOiB0cnVlLFxyXG4gICAgfSxcclxuICAgIGRlc2NyaXB0aW9uOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgcmVxdWlyZWQ6IFt0cnVlLCAn2YjYtdmBINin2YTZhdmI2LHYryDZhdi32YTZiNioJ10sXHJcbiAgICB9LFxyXG4gICAgcmVzb3VyY2VUeXBlOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgZW51bTogW1xyXG4gICAgICAgICdib29rJyxcclxuICAgICAgICAnZ3VpZGUnLFxyXG4gICAgICAgICdhcnRpY2xlJyxcclxuICAgICAgICAncmVzZWFyY2hfcGFwZXInLFxyXG4gICAgICAgICdjYXNlX3N0dWR5JyxcclxuICAgICAgICAndG9vbGtpdCcsXHJcbiAgICAgICAgJ3RlbXBsYXRlJyxcclxuICAgICAgICAndG9vbCcsXHJcbiAgICAgICAgJ3Jlc2VhcmNoX3N0YXRpc3RpY3MnLFxyXG4gICAgICBdLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgIH0sXHJcbiAgICBkaXNhYmlsaXR5Q2F0ZWdvcmllczoge1xyXG4gICAgICB0eXBlOiBbU3RyaW5nXSxcclxuICAgICAgZW51bTogWyd2aXN1YWwnLCAnaGVhcmluZycsICdtb2JpbGl0eScsICdpbnRlbGxlY3R1YWwnLCAncHN5Y2hvc29jaWFsJywgJ211bHRpcGxlJ10sXHJcbiAgICAgIGRlZmF1bHQ6IFtdLFxyXG4gICAgfSxcclxuICAgIGF1dGhvcjoge1xyXG4gICAgICBuYW1lOiBTdHJpbmcsXHJcbiAgICAgIG9yZ2FuaXphdGlvbjogU3RyaW5nLFxyXG4gICAgICBlbWFpbDogU3RyaW5nLFxyXG4gICAgfSxcclxuICAgIHVwbG9hZGVyOiB7XHJcbiAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgcmVmOiAnVXNlcicsXHJcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgfSxcclxuICAgIGZpbGVVcmw6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICByZXF1aXJlZDogW3RydWUsICfYsdin2KjYtyDYp9mE2YXZhNmBINmF2LfZhNmI2KgnXSxcclxuICAgIH0sXHJcbiAgICBmaWxlVHlwZToge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIGVudW06IFsncGRmJywgJ2RvYycsICd4bHN4JywgJ3ZpZGVvJywgJ2F1ZGlvJywgJ2ltYWdlJywgJ2xpbmsnLCAnb3RoZXInXSxcclxuICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICB9LFxyXG4gICAgZmlsZVNpemU6IHtcclxuICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICBkZXNjcmlwdGlvbjogJ9it2KzZhSDYp9mE2YXZhNmBINio2KfZhNio2KfZitiq2KfYqicsXHJcbiAgICB9LFxyXG4gICAgbGFuZ3VhZ2U6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBlbnVtOiBbJ2FyJywgJ2VuJywgJ2ZyJywgJ211bHRpbGluZ3VhbCddLFxyXG4gICAgICBkZWZhdWx0OiAnYXInLFxyXG4gICAgfSxcclxuICAgIHB1YmxpY2F0aW9uRGF0ZTogRGF0ZSxcclxuICAgIHB1Ymxpc2hlcjogU3RyaW5nLFxyXG4gICAgY2F0ZWdvcmllczogW1N0cmluZ10sXHJcbiAgICB0YWdzOiBbU3RyaW5nXSxcclxuICAgIGtleXdvcmRzOiBbU3RyaW5nXSxcclxuICAgIGFjY2Vzc2liaWxpdHlGb3JtYXQ6IHtcclxuICAgICAgaGFzQnJhaWxsZTogQm9vbGVhbixcclxuICAgICAgaGFzTGFyZ2VUZXh0OiBCb29sZWFuLFxyXG4gICAgICBoYXNBcmFiaWNTaWduTGFuZ3VhZ2VJbnRlcnByZXRhdGlvbjogQm9vbGVhbixcclxuICAgICAgaGFzQXVkaW9WZXJzaW9uOiBCb29sZWFuLFxyXG4gICAgICBoYXNTaW1wbGVMYW5ndWFnZVZlcnNpb246IEJvb2xlYW4sXHJcbiAgICAgIGlzU2NyZWVuUmVhZGVyRnJpZW5kbHk6IEJvb2xlYW4sXHJcbiAgICB9LFxyXG4gICAgaXNQdWJsaWM6IHtcclxuICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgZGVmYXVsdDogdHJ1ZSxcclxuICAgIH0sXHJcbiAgICB2aWV3czoge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIGRlZmF1bHQ6IDAsXHJcbiAgICB9LFxyXG4gICAgZG93bmxvYWRzOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgZGVmYXVsdDogMCxcclxuICAgIH0sXHJcbiAgICByYXRpbmc6IHtcclxuICAgICAgYXZlcmFnZToge1xyXG4gICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICBkZWZhdWx0OiAwLFxyXG4gICAgICAgIG1pbjogMCxcclxuICAgICAgICBtYXg6IDUsXHJcbiAgICAgIH0sXHJcbiAgICAgIGNvdW50OiB7XHJcbiAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgIGRlZmF1bHQ6IDAsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgcmV2aWV3czogW1xyXG4gICAgICB7XHJcbiAgICAgICAgdXNlcklkOiB7XHJcbiAgICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJhdGluZzoge1xyXG4gICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgbWluOiAxLFxyXG4gICAgICAgICAgbWF4OiA1LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tbWVudDogU3RyaW5nLFxyXG4gICAgICAgIGRhdGU6IHtcclxuICAgICAgICAgIHR5cGU6IERhdGUsXHJcbiAgICAgICAgICBkZWZhdWx0OiBEYXRlLm5vdyxcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgXSxcclxuICAgIHJlbGF0ZWRSZXNvdXJjZXM6IFtcclxuICAgICAge1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdEaWdpdGFsTGlicmFyeScsXHJcbiAgICAgIH0sXHJcbiAgICBdLFxyXG4gICAgc3RhdHVzOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgZW51bTogWydkcmFmdCcsICdwZW5kaW5nX3JldmlldycsICdhcHByb3ZlZCcsICdhcmNoaXZlZCddLFxyXG4gICAgICBkZWZhdWx0OiAnZHJhZnQnLFxyXG4gICAgfSxcclxuICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgIGlzYm46IFN0cmluZyxcclxuICAgICAgZG9pOiBTdHJpbmcsXHJcbiAgICAgIGlzc246IFN0cmluZyxcclxuICAgICAgZWRpdGlvbjogU3RyaW5nLFxyXG4gICAgICBwYWdlczogTnVtYmVyLFxyXG4gICAgICBsYW5ndWFnZV9sZXZlbDogU3RyaW5nLFxyXG4gICAgfSxcclxuICAgIGNvbnRyaWJ1dG9yczogW1xyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogU3RyaW5nLFxyXG4gICAgICAgIHJvbGU6IFN0cmluZyxcclxuICAgICAgICBlbWFpbDogU3RyaW5nLFxyXG4gICAgICB9LFxyXG4gICAgXSxcclxuICAgIGxpY2Vuc2U6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBlbnVtOiBbJ2NjX2J5JywgJ2NjX2J5X3NhJywgJ2NjX2J5X25jJywgJ2NjMCcsICdwcm9wcmlldGFyeSddLFxyXG4gICAgICBkZWZhdWx0OiAnY2NfYnknLFxyXG4gICAgfSxcclxuICB9LFxyXG4gIHtcclxuICAgIHRpbWVzdGFtcHM6IHRydWUsXHJcbiAgICB0b0pTT046IHsgdmlydHVhbHM6IHRydWUgfSxcclxuICAgIHRvT2JqZWN0OiB7IHZpcnR1YWxzOiB0cnVlIH0sXHJcbiAgfVxyXG4pO1xyXG5cclxuLy8gSW5kZXhlc1xyXG5kaWdpdGFsTGlicmFyeVNjaGVtYS5pbmRleCh7IHJlc291cmNlVHlwZTogMSwgaXNQdWJsaWM6IDEgfSk7XHJcbmRpZ2l0YWxMaWJyYXJ5U2NoZW1hLmluZGV4KHsgZGlzYWJpbGl0eUNhdGVnb3JpZXM6IDEgfSk7XHJcbmRpZ2l0YWxMaWJyYXJ5U2NoZW1hLmluZGV4KHsgdXBsb2FkZXI6IDEgfSk7XHJcbmRpZ2l0YWxMaWJyYXJ5U2NoZW1hLmluZGV4KHsgY2F0ZWdvcmllczogMSB9KTtcclxuZGlnaXRhbExpYnJhcnlTY2hlbWEuaW5kZXgoeyB0YWdzOiAxIH0pO1xyXG5kaWdpdGFsTGlicmFyeVNjaGVtYS5pbmRleCh7IGNyZWF0ZWRBdDogLTEgfSk7XHJcbmRpZ2l0YWxMaWJyYXJ5U2NoZW1hLmluZGV4KHsgZmlsZVR5cGU6IDEgfSk7XHJcblxyXG4vLyBTdGF0aWMgbWV0aG9kIHRvIHNlYXJjaCByZXNvdXJjZXNcclxuZGlnaXRhbExpYnJhcnlTY2hlbWEuc3RhdGljcy5zZWFyY2hSZXNvdXJjZXMgPSBmdW5jdGlvbiAocXVlcnksIGZpbHRlcnMgPSB7fSkge1xyXG4gIGNvbnN0IHNlYXJjaFF1ZXJ5ID0ge1xyXG4gICAgaXNQdWJsaWM6IHRydWUsXHJcbiAgICBzdGF0dXM6ICdhcHByb3ZlZCcsXHJcbiAgICAkb3I6IFtcclxuICAgICAgeyB0aXRsZTogeyAkcmVnZXg6IHF1ZXJ5LCAkb3B0aW9uczogJ2knIH0gfSxcclxuICAgICAgeyBkZXNjcmlwdGlvbjogeyAkcmVnZXg6IHF1ZXJ5LCAkb3B0aW9uczogJ2knIH0gfSxcclxuICAgICAgeyB0YWdzOiB7ICRpbjogW25ldyBSZWdFeHAocXVlcnksICdpJyldIH0gfSxcclxuICAgICAgeyBrZXl3b3JkczogeyAkaW46IFtuZXcgUmVnRXhwKHF1ZXJ5LCAnaScpXSB9IH0sXHJcbiAgICBdLFxyXG4gIH07XHJcblxyXG4gIGlmIChmaWx0ZXJzLnJlc291cmNlVHlwZSkgc2VhcmNoUXVlcnkucmVzb3VyY2VUeXBlID0gZmlsdGVycy5yZXNvdXJjZVR5cGU7XHJcbiAgaWYgKGZpbHRlcnMuZGlzYWJpbGl0eUNhdGVnb3JpZXMpXHJcbiAgICBzZWFyY2hRdWVyeS5kaXNhYmlsaXR5Q2F0ZWdvcmllcyA9IHsgJGluOiBbZmlsdGVycy5kaXNhYmlsaXR5Q2F0ZWdvcmllc10gfTtcclxuICBpZiAoZmlsdGVycy5sYW5ndWFnZSkgc2VhcmNoUXVlcnkubGFuZ3VhZ2UgPSBmaWx0ZXJzLmxhbmd1YWdlO1xyXG5cclxuICByZXR1cm4gdGhpcy5maW5kKHNlYXJjaFF1ZXJ5KVxyXG4gICAgLnNvcnQoeyAncmF0aW5nLmF2ZXJhZ2UnOiAtMSwgdmlld3M6IC0xIH0pXHJcbiAgICAucG9wdWxhdGUoJ3VwbG9hZGVyJywgJ25hbWUgZW1haWwnKVxyXG4gICAgLmxpbWl0KGZpbHRlcnMubGltaXQgfHwgMjApO1xyXG59O1xyXG5cclxuLy8gU3RhdGljIG1ldGhvZCB0byBnZXQgcmVzb3VyY2VzIGJ5IGNhdGVnb3J5XHJcbmRpZ2l0YWxMaWJyYXJ5U2NoZW1hLnN0YXRpY3MuZ2V0QnlDYXRlZ29yeSA9IGZ1bmN0aW9uIChjYXRlZ29yeSwgbGltaXQgPSAxNSkge1xyXG4gIHJldHVybiB0aGlzLmZpbmQoe1xyXG4gICAgZGlzYWJpbGl0eUNhdGVnb3JpZXM6IGNhdGVnb3J5LFxyXG4gICAgaXNQdWJsaWM6IHRydWUsXHJcbiAgICBzdGF0dXM6ICdhcHByb3ZlZCcsXHJcbiAgfSlcclxuICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxyXG4gICAgLmxpbWl0KGxpbWl0KVxyXG4gICAgLnBvcHVsYXRlKCd1cGxvYWRlcicsICduYW1lIGVtYWlsJyk7XHJcbn07XHJcblxyXG4vLyBJbnN0YW5jZSBtZXRob2QgdG8gaW5jcmVtZW50IGRvd25sb2Fkc1xyXG5kaWdpdGFsTGlicmFyeVNjaGVtYS5tZXRob2RzLmluY3JlbWVudERvd25sb2FkcyA9IGZ1bmN0aW9uICgpIHtcclxuICB0aGlzLmRvd25sb2FkcyArPSAxO1xyXG4gIHJldHVybiB0aGlzLnNhdmUoKTtcclxufTtcclxuXHJcbi8vIEluc3RhbmNlIG1ldGhvZCB0byBhZGQgcmV2aWV3XHJcbmRpZ2l0YWxMaWJyYXJ5U2NoZW1hLm1ldGhvZHMuYWRkUmV2aWV3ID0gZnVuY3Rpb24gKHVzZXJJZCwgcmF0aW5nLCBjb21tZW50KSB7XHJcbiAgdGhpcy5yZXZpZXdzLnB1c2goeyB1c2VySWQsIHJhdGluZywgY29tbWVudCB9KTtcclxuXHJcbiAgLy8gQ2FsY3VsYXRlIGF2ZXJhZ2UgcmF0aW5nXHJcbiAgY29uc3QgcmF0aW5ncyA9IHRoaXMucmV2aWV3cy5tYXAociA9PiByLnJhdGluZyk7XHJcbiAgdGhpcy5yYXRpbmcuYXZlcmFnZSA9IHJhdGluZ3MucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyByYXRpbmdzLmxlbmd0aDtcclxuICB0aGlzLnJhdGluZy5jb3VudCA9IHJhdGluZ3MubGVuZ3RoO1xyXG5cclxuICByZXR1cm4gdGhpcy5zYXZlKCk7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdEaWdp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