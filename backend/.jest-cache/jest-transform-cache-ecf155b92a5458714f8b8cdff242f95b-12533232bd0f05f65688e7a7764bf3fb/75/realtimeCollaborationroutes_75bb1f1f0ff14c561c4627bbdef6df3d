42b3250810639fc71480556625a16a46
/**
 * مسارات التعاون في الوقت الفعلي
 * Real-Time Collaboration Routes
 */

const express = require('express');
const router = express.Router();
const RealtimeCollaborationController = require('../controllers/realtimeCollaboration.controller');
const {
  protect,
  authorize
} = require('../middleware/auth');

// جميع المسارات تتطلب المصادقة
router.use(protect);

// ========== إدارة جلسات التعاون ==========

/**
 * @route   POST /api/collaboration/sessions
 * @desc    إنشاء جلسة تعاون جديدة
 * @access  Private
 */
router.post('/sessions', RealtimeCollaborationController.createSession);

/**
 * @route   POST /api/collaboration/sessions/:sessionId/join
 * @desc    الانضمام إلى جلسة تعاون
 * @access  Private
 */
router.post('/sessions/:sessionId/join', RealtimeCollaborationController.joinSession);

/**
 * @route   POST /api/collaboration/sessions/:sessionId/leave
 * @desc    مغادرة جلسة التعاون
 * @access  Private
 */
router.post('/sessions/:sessionId/leave', RealtimeCollaborationController.leaveSession);

// ========== إدارة التغييرات ==========

/**
 * @route   POST /api/collaboration/sessions/:sessionId/changes
 * @desc    تطبيق تغيير على المستند
 * @access  Private
 */
router.post('/sessions/:sessionId/changes', RealtimeCollaborationController.applyChange);

/**
 * @route   POST /api/collaboration/sessions/:sessionId/undo
 * @desc    التراجع عن التغيير الأخير
 * @access  Private
 */
router.post('/sessions/:sessionId/undo', RealtimeCollaborationController.undo);

/**
 * @route   POST /api/collaboration/sessions/:sessionId/redo
 * @desc    إعادة التغيير المتراجع عنه
 * @access  Private
 */
router.post('/sessions/:sessionId/redo', RealtimeCollaborationController.redo);

// ========== إدارة الموضع والحضور ==========

/**
 * @route   PATCH /api/collaboration/sessions/:sessionId/presence
 * @desc    تحديث موضع المؤشر والتحديد
 * @access  Private
 */
router.patch('/sessions/:sessionId/presence', RealtimeCollaborationController.updatePresence);

/**
 * @route   PATCH /api/collaboration/sessions/:sessionId/typing
 * @desc    تحديث حالة الكتابة
 * @access  Private
 */
router.patch('/sessions/:sessionId/typing', RealtimeCollaborationController.updateTypingStatus);

/**
 * @route   GET /api/collaboration/sessions/:sessionId/users
 * @desc    الحصول على جميع المستخدمين النشطين
 * @access  Private
 */
router.get('/sessions/:sessionId/users', RealtimeCollaborationController.getActiveUsers);

// ========== إدارة التعليقات ==========

/**
 * @route   POST /api/collaboration/sessions/:sessionId/comments
 * @desc    إضافة تعليق على المستند
 * @access  Private
 */
router.post('/sessions/:sessionId/comments', RealtimeCollaborationController.addComment);

/**
 * @route   POST /api/collaboration/comments/:commentId/replies
 * @desc    الرد على تعليق
 * @access  Private
 */
router.post('/comments/:commentId/replies', RealtimeCollaborationController.replyToComment);

// ========== الإحصائيات والتصدير ==========

/**
 * @route   GET /api/collaboration/sessions/:sessionId/snapshot
 * @desc    الحصول على نسخة المستند عند نقطة زمنية معينة
 * @access  Private
 */
router.get('/sessions/:sessionId/snapshot', RealtimeCollaborationController.getDocumentSnapshot);

/**
 * @route   GET /api/collaboration/sessions/:sessionId/stats
 * @desc    الحصول على إحصائيات الجلسة
 * @access  Private
 */
router.get('/sessions/:sessionId/stats', RealtimeCollaborationController.getSessionStats);

/**
 * @route   GET /api/collaboration/sessions/:sessionId/export
 * @desc    تصدير سجل التغييرات
 * @access  Private
 */
router.get('/sessions/:sessionId/export', RealtimeCollaborationController.exportChangeHistory);
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIiLCJwcm90ZWN0IiwiYXV0aG9yaXplIiwidXNlIiwicG9zdCIsImNyZWF0ZVNlc3Npb24iLCJqb2luU2Vzc2lvbiIsImxlYXZlU2Vzc2lvbiIsImFwcGx5Q2hhbmdlIiwidW5kbyIsInJlZG8iLCJwYXRjaCIsInVwZGF0ZVByZXNlbmNlIiwidXBkYXRlVHlwaW5nU3RhdHVzIiwiZ2V0IiwiZ2V0QWN0aXZlVXNlcnMiLCJhZGRDb21tZW50IiwicmVwbHlUb0NvbW1lbnQiLCJnZXREb2N1bWVudFNuYXBzaG90IiwiZ2V0U2Vzc2lvblN0YXRzIiwiZXhwb3J0Q2hhbmdlSGlzdG9yeSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyZWFsdGltZUNvbGxhYm9yYXRpb24ucm91dGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDZhdiz2KfYsdin2Kog2KfZhNiq2LnYp9mI2YYg2YHZiiDYp9mE2YjZgtiqINin2YTZgdi52YTZilxyXG4gKiBSZWFsLVRpbWUgQ29sbGFib3JhdGlvbiBSb3V0ZXNcclxuICovXHJcblxyXG5jb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCBSZWFsdGltZUNvbGxhYm9yYXRpb25Db250cm9sbGVyID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvcmVhbHRpbWVDb2xsYWJvcmF0aW9uLmNvbnRyb2xsZXInKTtcclxuY29uc3QgeyBwcm90ZWN0LCBhdXRob3JpemUgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmUvYXV0aCcpO1xyXG5cclxuLy8g2KzZhdmK2Lkg2KfZhNmF2LPYp9ix2KfYqiDYqtiq2LfZhNioINin2YTZhdi12KfYr9mC2Klcclxucm91dGVyLnVzZShwcm90ZWN0KTtcclxuXHJcbi8vID09PT09PT09PT0g2KXYr9in2LHYqSDYrNmE2LPYp9iqINin2YTYqti52KfZiNmGID09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBAcm91dGUgICBQT1NUIC9hcGkvY29sbGFib3JhdGlvbi9zZXNzaW9uc1xyXG4gKiBAZGVzYyAgICDYpdmG2LTYp9ihINis2YTYs9ipINiq2LnYp9mI2YYg2KzYr9mK2K/YqVxyXG4gKiBAYWNjZXNzICBQcml2YXRlXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL3Nlc3Npb25zJywgUmVhbHRpbWVDb2xsYWJvcmF0aW9uQ29udHJvbGxlci5jcmVhdGVTZXNzaW9uKTtcclxuXHJcbi8qKlxyXG4gKiBAcm91dGUgICBQT1NUIC9hcGkvY29sbGFib3JhdGlvbi9zZXNzaW9ucy86c2Vzc2lvbklkL2pvaW5cclxuICogQGRlc2MgICAg2KfZhNin2YbYttmF2KfZhSDYpdmE2Ykg2KzZhNiz2Kkg2KrYudin2YjZhlxyXG4gKiBAYWNjZXNzICBQcml2YXRlXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL3Nlc3Npb25zLzpzZXNzaW9uSWQvam9pbicsIFJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIuam9pblNlc3Npb24pO1xyXG5cclxuLyoqXHJcbiAqIEByb3V0ZSAgIFBPU1QgL2FwaS9jb2xsYWJvcmF0aW9uL3Nlc3Npb25zLzpzZXNzaW9uSWQvbGVhdmVcclxuICogQGRlc2MgICAg2YXYutin2K/YsdipINis2YTYs9ipINin2YTYqti52KfZiNmGXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5wb3N0KCcvc2Vzc2lvbnMvOnNlc3Npb25JZC9sZWF2ZScsIFJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIubGVhdmVTZXNzaW9uKTtcclxuXHJcbi8vID09PT09PT09PT0g2KXYr9in2LHYqSDYp9mE2KrYutmK2YrYsdin2KogPT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIEByb3V0ZSAgIFBPU1QgL2FwaS9jb2xsYWJvcmF0aW9uL3Nlc3Npb25zLzpzZXNzaW9uSWQvY2hhbmdlc1xyXG4gKiBAZGVzYyAgICDYqti32KjZitmCINiq2LrZitmK2LEg2LnZhNmJINin2YTZhdiz2KrZhtivXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5wb3N0KCcvc2Vzc2lvbnMvOnNlc3Npb25JZC9jaGFuZ2VzJywgUmVhbHRpbWVDb2xsYWJvcmF0aW9uQ29udHJvbGxlci5hcHBseUNoYW5nZSk7XHJcblxyXG4vKipcclxuICogQHJvdXRlICAgUE9TVCAvYXBpL2NvbGxhYm9yYXRpb24vc2Vzc2lvbnMvOnNlc3Npb25JZC91bmRvXHJcbiAqIEBkZXNjICAgINin2YTYqtix2KfYrNi5INi52YYg2KfZhNiq2LrZitmK2LEg2KfZhNij2K7ZitixXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5wb3N0KCcvc2Vzc2lvbnMvOnNlc3Npb25JZC91bmRvJywgUmVhbHRpbWVDb2xsYWJvcmF0aW9uQ29udHJvbGxlci51bmRvKTtcclxuXHJcbi8qKlxyXG4gKiBAcm91dGUgICBQT1NUIC9hcGkvY29sbGFib3JhdGlvbi9zZXNzaW9ucy86c2Vzc2lvbklkL3JlZG9cclxuICogQGRlc2MgICAg2KXYudin2K/YqSDYp9mE2KrYutmK2YrYsSDYp9mE2YXYqtix2KfYrNi5INi52YbZh1xyXG4gKiBAYWNjZXNzICBQcml2YXRlXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL3Nlc3Npb25zLzpzZXNzaW9uSWQvcmVkbycsIFJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIucmVkbyk7XHJcblxyXG4vLyA9PT09PT09PT09INil2K/Yp9ix2Kkg2KfZhNmF2YjYtti5INmI2KfZhNit2LbZiNixID09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBAcm91dGUgICBQQVRDSCAvYXBpL2NvbGxhYm9yYXRpb24vc2Vzc2lvbnMvOnNlc3Npb25JZC9wcmVzZW5jZVxyXG4gKiBAZGVzYyAgICDYqtit2K/ZitirINmF2YjYtti5INin2YTZhdik2LTYsSDZiNin2YTYqtit2K/ZitivXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5wYXRjaCgnL3Nlc3Npb25zLzpzZXNzaW9uSWQvcHJlc2VuY2UnLCBSZWFsdGltZUNvbGxhYm9yYXRpb25Db250cm9sbGVyLnVwZGF0ZVByZXNlbmNlKTtcclxuXHJcbi8qKlxyXG4gKiBAcm91dGUgICBQQVRDSCAvYXBpL2NvbGxhYm9yYXRpb24vc2Vzc2lvbnMvOnNlc3Npb25JZC90eXBpbmdcclxuICogQGRlc2MgICAg2KrYrdiv2YrYqyDYrdin2YTYqSDYp9mE2YPYqtin2KjYqVxyXG4gKiBAYWNjZXNzICBQcml2YXRlXHJcbiAqL1xyXG5yb3V0ZXIucGF0Y2goJy9zZXNzaW9ucy86c2Vzc2lvbklkL3R5cGluZycsIFJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIudXBkYXRlVHlwaW5nU3RhdHVzKTtcclxuXHJcbi8qKlxyXG4gKiBAcm91dGUgICBHRVQgL2FwaS9jb2xsYWJvcmF0aW9uL3Nlc3Npb25zLzpzZXNzaW9uSWQvdXNlcnNcclxuICogQGRlc2MgICAg2KfZhNit2LXZiNmEINi52YTZiSDYrNmF2YrYuSDYp9mE2YXYs9iq2K7Yr9mF2YrZhiDYp9mE2YbYtNi32YrZhlxyXG4gKiBAYWNjZXNzICBQcml2YXRlXHJcbiAqL1xyXG5yb3V0ZXIuZ2V0KCcvc2Vzc2lvbnMvOnNlc3Npb25JZC91c2VycycsIFJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIuZ2V0QWN0aXZlVXNlcnMpO1xyXG5cclxuLy8gPT09PT09PT09PSDYpdiv2KfYsdipINin2YTYqti52YTZitmC2KfYqiA9PT09PT09PT09XHJcblxyXG4vKipcclxuICogQHJvdXRlICAgUE9TVCAvYXBpL2NvbGxhYm9yYXRpb24vc2Vzc2lvbnMvOnNlc3Npb25JZC9jb21tZW50c1xyXG4gKiBAZGVzYyAgICDYpdi22KfZgdipINiq2LnZhNmK2YIg2LnZhNmJINin2YTZhdiz2KrZhtivXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5wb3N0KCcvc2Vzc2lvbnMvOnNlc3Npb25JZC9jb21tZW50cycsIFJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIuYWRkQ29tbWVudCk7XHJcblxyXG4vKipcclxuICogQHJvdXRlICAgUE9TVCAvYXBpL2NvbGxhYm9yYXRpb24vY29tbWVudHMvOmNvbW1lbnRJZC9yZXBsaWVzXHJcbiAqIEBkZXNjICAgINin2YTYsdivINi52YTZiSDYqti52YTZitmCXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5wb3N0KCcvY29tbWVudHMvOmNvbW1lbnRJZC9yZXBsaWVzJywgUmVhbHRpbWVDb2xsYWJvcmF0aW9uQ29udHJvbGxlci5yZXBseVRvQ29tbWVudCk7XHJcblxyXG4vLyA9PT09PT09PT09INin2YTYpdit2LXYp9im2YrYp9iqINmI2KfZhNiq2LXYr9mK2LEgPT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIEByb3V0ZSAgIEdFVCAvYXBpL2NvbGxhYm9yYXRpb24vc2Vzc2lvbnMvOnNlc3Npb25JZC9zbmFwc2hvdFxyXG4gKiBAZGVzYyAgICDYp9mE2K3YtdmI2YQg2LnZhNmJINmG2LPYrtipINin2YTZhdiz2KrZhtivINi52YbYryDZhtmC2LfYqSDYstmF2YbZitipINmF2LnZitmG2KlcclxuICogQGFjY2VzcyAgUHJpdmF0ZVxyXG4gKi9cclxucm91dGVyLmdldCgnL3Nlc3Npb25zLzpzZXNzaW9uSWQvc25hcHNob3QnLCBSZWFsdGltZUNvbGxhYm9yYXRpb25Db250cm9sbGVyLmdldERvY3VtZW50U25hcHNob3QpO1xyXG5cclxuLyoqXHJcbiAqIEByb3V0ZSAgIEdFVCAvYXBpL2NvbGxhYm9yYXRpb24vc2Vzc2lvbnMvOnNlc3Npb25JZC9zdGF0c1xyXG4gKiBAZGVzYyAgICDYp9mE2K3YtdmI2YQg2LnZhNmJINil2K3Ytdin2KbZitin2Kog2KfZhNis2YTYs9ipXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5nZXQoJy9zZXNzaW9ucy86c2Vzc2lvbklkL3N0YXRzJywgUmVhbHRpbWVDb2xsYWJvcmF0aW9uQ29udHJvbGxlci5nZXRTZXNzaW9uU3RhdHMpO1xyXG5cclxuLyoqXHJcbiAqIEByb3V0ZSAgIEdFVCAvYXBpL2NvbGxhYm9yYXRpb24vc2Vzc2lvbnMvOnNlc3Npb25JZC9leHBvcnRcclxuICogQGRlc2MgICAg2KrYtdiv2YrYsSDYs9is2YQg2KfZhNiq2LrZitmK2LHYp9iqXHJcbiAqIEBhY2Nlc3MgIFByaXZhdGVcclxuICovXHJcbnJvdXRlci5nZXQoJy9zZXNzaW9ucy86c2Vzc2lvbklkL2V4cG9ydCcsIFJlYWx0aW1lQ29sbGFib3JhdGlvbkNvbnRyb2xsZXIuZXhwb3J0Q2hhbmdlSGlzdG9yeSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU1DLCtCQUErQixHQUFHSCxPQUFPLENBQUMsaURBQWlELENBQUM7QUFDbEcsTUFBTTtFQUFFSSxPQUFPO0VBQUVDO0FBQVUsQ0FBQyxHQUFHTCxPQUFPLENBQUMsb0JBQW9CLENBQUM7O0FBRTVEO0FBQ0FDLE1BQU0sQ0FBQ0ssR0FBRyxDQUFDRixPQUFPLENBQUM7O0FBRW5COztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQUgsTUFBTSxDQUFDTSxJQUFJLENBQUMsV0FBVyxFQUFFSiwrQkFBK0IsQ0FBQ0ssYUFBYSxDQUFDOztBQUV2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FQLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLDJCQUEyQixFQUFFSiwrQkFBK0IsQ0FBQ00sV0FBVyxDQUFDOztBQUVyRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FSLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLDRCQUE0QixFQUFFSiwrQkFBK0IsQ0FBQ08sWUFBWSxDQUFDOztBQUV2Rjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FULE1BQU0sQ0FBQ00sSUFBSSxDQUFDLDhCQUE4QixFQUFFSiwrQkFBK0IsQ0FBQ1EsV0FBVyxDQUFDOztBQUV4RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FWLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLDJCQUEyQixFQUFFSiwrQkFBK0IsQ0FBQ1MsSUFBSSxDQUFDOztBQUU5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FYLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLDJCQUEyQixFQUFFSiwrQkFBK0IsQ0FBQ1UsSUFBSSxDQUFDOztBQUU5RTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FaLE1BQU0sQ0FBQ2EsS0FBSyxDQUFDLCtCQUErQixFQUFFWCwrQkFBK0IsQ0FBQ1ksY0FBYyxDQUFDOztBQUU3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FkLE1BQU0sQ0FBQ2EsS0FBSyxDQUFDLDZCQUE2QixFQUFFWCwrQkFBK0IsQ0FBQ2Esa0JBQWtCLENBQUM7O0FBRS9GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQWYsTUFBTSxDQUFDZ0IsR0FBRyxDQUFDLDRCQUE0QixFQUFFZCwrQkFBK0IsQ0FBQ2UsY0FBYyxDQUFDOztBQUV4Rjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FqQixNQUFNLENBQUNNLElBQUksQ0FBQywrQkFBK0IsRUFBRUosK0JBQStCLENBQUNnQixVQUFVLENBQUM7O0FBRXhGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQWxCLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLDhCQUE4QixFQUFFSiwrQkFBK0IsQ0FBQ2lCLGNBQWMsQ0FBQzs7QUFFM0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBbkIsTUFBTSxDQUFDZ0IsR0FBRyxDQUFDLCtCQUErQixFQUFFZCwrQkFBK0IsQ0FBQ2tCLG1CQUFtQixDQUFDOztBQUVoRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FwQixNQUFNLENBQUNnQixHQUFHLENBQUMsNEJBQTRCLEVBQUVkLCtCQUErQixDQUFDbUIsZUFBZSxDQUFDOztBQUV6RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FyQixNQUFNLENBQUNnQixHQUFHLENBQUMsNkJBQTZCLEVBQUVkLCtCQUErQixDQUFDb0IsbUJBQW1CLENBQUM7QUFFOUZDLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHeEIsTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==