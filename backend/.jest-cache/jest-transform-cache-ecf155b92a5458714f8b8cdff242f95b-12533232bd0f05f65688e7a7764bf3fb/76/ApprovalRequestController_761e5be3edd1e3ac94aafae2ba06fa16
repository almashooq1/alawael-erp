647e2d25daf07dd7475c81719a3c7ec9
// ApprovalRequestController.js
const ApprovalRequest = require('../models/ApprovalRequest');
const NotificationService = require('../services/notificationService');
// ...existing code...

const ApprovalRequestController = {
  // إنشاء طلب موافقة جديد
  createApprovalRequest: async (req, res) => {
    try {
      const {
        requestType,
        requestRefId,
        approvers,
        comment
      } = req.body;
      if (!approvers || !Array.isArray(approvers) || approvers.length === 0) {
        return res.status(400).json({
          success: false,
          message: 'يجب تحديد سلسلة الموافقات'
        });
      }
      const steps = approvers.map(userId => ({
        approver: userId,
        action: 'pending'
      }));
      const approval = await ApprovalRequest.create({
        requestType,
        requestRefId,
        requester: req.user._id,
        steps,
        comments: comment ? [{
          user: req.user._id,
          text: comment
        }] : []
      });
      // إشعار أول مسؤول
      const firstApprover = approvers[0];
      await NotificationService.sendNotification(firstApprover, {
        title: `طلب موافقة جديد (${requestType})`,
        message: `لديك طلب موافقة جديد من ${req.user.name || 'مستخدم'}`,
        channels: ['in-app', 'push']
      });
      res.json({
        success: true,
        approval
      });
    } catch (err) {
      res.status(500).json({
        success: false,
        error: err.message
      });
    }
  },
  // جلب طلبات الموافقة الخاصة بالمستخدم
  getMyApprovalRequests: async (req, res) => {
    try {
      const approvals = await ApprovalRequest.find({
        requester: req.user._id
      }).sort({
        createdAt: -1
      });
      res.json({
        success: true,
        approvals
      });
    } catch (err) {
      res.status(500).json({
        success: false,
        error: err.message
      });
    }
  },
  // جلب الطلبات المعلقة للمسؤول الحالي
  getPendingApprovals: async (req, res) => {
    try {
      const approvals = await ApprovalRequest.find({
        'steps.approver': req.user._id,
        'steps.action': 'pending',
        status: 'pending'
      });
      res.json({
        success: true,
        approvals
      });
    } catch (err) {
      res.status(500).json({
        success: false,
        error: err.message
      });
    }
  },
  // اتخاذ إجراء (موافقة/رفض) على خطوة الموافقة
  takeApprovalAction: async (req, res) => {
    try {
      const {
        approvalId
      } = req.params;
      const {
        action,
        comment
      } = req.body; // action: approved/rejected
      const approval = await ApprovalRequest.findById(approvalId);
      if (!approval) return res.status(404).json({
        success: false,
        message: 'الطلب غير موجود'
      });
      const step = approval.steps[approval.currentStep];
      if (!step || String(step.approver) !== String(req.user._id) || step.action !== 'pending') {
        return res.status(403).json({
          success: false,
          message: 'غير مصرح'
        });
      }
      step.action = action;
      step.actedAt = new Date();
      step.comment = comment;
      approval.comments.push({
        user: req.user._id,
        text: comment
      });
      // تحديث الحالة العامة
      if (action === 'rejected') {
        approval.status = 'rejected';
      } else if (action === 'approved') {
        if (approval.currentStep < approval.steps.length - 1) {
          approval.currentStep += 1;
        } else {
          approval.status = 'approved';
        }
      }
      await approval.save();
      // إشعار صاحب الطلب
      await NotificationService.sendNotification(approval.requester, {
        title: `تحديث طلب الموافقة (${approval.requestType})`,
        message: `تم اتخاذ إجراء: ${action === 'approved' ? 'موافقة' : 'رفض'} على طلبك.`,
        channels: ['in-app', 'push']
      });
      // إشعار المسؤول التالي إذا لم تنتهِ السلسلة
      if (approval.status === 'pending') {
        const nextStep = approval.steps[approval.currentStep];
        if (nextStep && nextStep.approver) {
          await NotificationService.sendNotification(nextStep.approver, {
            title: `طلب موافقة جديد بانتظارك (${approval.requestType})`,
            message: `يرجى مراجعة طلب الموافقة من ${req.user.name || 'مستخدم'}`,
            channels: ['in-app', 'push']
          });
        }
      }
      res.json({
        success: true,
        approval
      });
    } catch (err) {
      res.status(500).json({
        success: false,
        error: err.message
      });
    }
  }
};
module.exports = ApprovalRequestController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBcHByb3ZhbFJlcXVlc3QiLCJyZXF1aXJlIiwiTm90aWZpY2F0aW9uU2VydmljZSIsIkFwcHJvdmFsUmVxdWVzdENvbnRyb2xsZXIiLCJjcmVhdGVBcHByb3ZhbFJlcXVlc3QiLCJyZXEiLCJyZXMiLCJyZXF1ZXN0VHlwZSIsInJlcXVlc3RSZWZJZCIsImFwcHJvdmVycyIsImNvbW1lbnQiLCJib2R5IiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwic3RlcHMiLCJtYXAiLCJ1c2VySWQiLCJhcHByb3ZlciIsImFjdGlvbiIsImFwcHJvdmFsIiwiY3JlYXRlIiwicmVxdWVzdGVyIiwidXNlciIsIl9pZCIsImNvbW1lbnRzIiwidGV4dCIsImZpcnN0QXBwcm92ZXIiLCJzZW5kTm90aWZpY2F0aW9uIiwidGl0bGUiLCJuYW1lIiwiY2hhbm5lbHMiLCJlcnIiLCJlcnJvciIsImdldE15QXBwcm92YWxSZXF1ZXN0cyIsImFwcHJvdmFscyIsImZpbmQiLCJzb3J0IiwiY3JlYXRlZEF0IiwiZ2V0UGVuZGluZ0FwcHJvdmFscyIsInRha2VBcHByb3ZhbEFjdGlvbiIsImFwcHJvdmFsSWQiLCJwYXJhbXMiLCJmaW5kQnlJZCIsInN0ZXAiLCJjdXJyZW50U3RlcCIsIlN0cmluZyIsImFjdGVkQXQiLCJEYXRlIiwicHVzaCIsInNhdmUiLCJuZXh0U3RlcCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJBcHByb3ZhbFJlcXVlc3RDb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEFwcHJvdmFsUmVxdWVzdENvbnRyb2xsZXIuanNcclxuY29uc3QgQXBwcm92YWxSZXF1ZXN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0FwcHJvdmFsUmVxdWVzdCcpO1xyXG5jb25zdCBOb3RpZmljYXRpb25TZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvbm90aWZpY2F0aW9uU2VydmljZScpO1xyXG4vLyAuLi5leGlzdGluZyBjb2RlLi4uXHJcblxyXG5jb25zdCBBcHByb3ZhbFJlcXVlc3RDb250cm9sbGVyID0ge1xyXG4gIC8vINil2YbYtNin2KEg2LfZhNioINmF2YjYp9mB2YLYqSDYrNiv2YrYr1xyXG4gIGNyZWF0ZUFwcHJvdmFsUmVxdWVzdDogYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IHJlcXVlc3RUeXBlLCByZXF1ZXN0UmVmSWQsIGFwcHJvdmVycywgY29tbWVudCB9ID0gcmVxLmJvZHk7XHJcbiAgICAgIGlmICghYXBwcm92ZXJzIHx8ICFBcnJheS5pc0FycmF5KGFwcHJvdmVycykgfHwgYXBwcm92ZXJzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAn2YrYrNioINiq2K3Yr9mK2K8g2LPZhNiz2YTYqSDYp9mE2YXZiNin2YHZgtin2KonIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHN0ZXBzID0gYXBwcm92ZXJzLm1hcCh1c2VySWQgPT4gKHsgYXBwcm92ZXI6IHVzZXJJZCwgYWN0aW9uOiAncGVuZGluZycgfSkpO1xyXG4gICAgICBjb25zdCBhcHByb3ZhbCA9IGF3YWl0IEFwcHJvdmFsUmVxdWVzdC5jcmVhdGUoe1xyXG4gICAgICAgIHJlcXVlc3RUeXBlLFxyXG4gICAgICAgIHJlcXVlc3RSZWZJZCxcclxuICAgICAgICByZXF1ZXN0ZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICBzdGVwcyxcclxuICAgICAgICBjb21tZW50czogY29tbWVudCA/IFt7IHVzZXI6IHJlcS51c2VyLl9pZCwgdGV4dDogY29tbWVudCB9XSA6IFtdLFxyXG4gICAgICB9KTtcclxuICAgICAgLy8g2KXYtNi52KfYsSDYo9mI2YQg2YXYs9ik2YjZhFxyXG4gICAgICBjb25zdCBmaXJzdEFwcHJvdmVyID0gYXBwcm92ZXJzWzBdO1xyXG4gICAgICBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmROb3RpZmljYXRpb24oZmlyc3RBcHByb3Zlciwge1xyXG4gICAgICAgIHRpdGxlOiBg2LfZhNioINmF2YjYp9mB2YLYqSDYrNiv2YrYryAoJHtyZXF1ZXN0VHlwZX0pYCxcclxuICAgICAgICBtZXNzYWdlOiBg2YTYr9mK2YMg2LfZhNioINmF2YjYp9mB2YLYqSDYrNiv2YrYryDZhdmGICR7cmVxLnVzZXIubmFtZSB8fCAn2YXYs9iq2K7Yr9mFJ31gLFxyXG4gICAgICAgIGNoYW5uZWxzOiBbJ2luLWFwcCcsICdwdXNoJ10sXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGFwcHJvdmFsIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9KTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyDYrNmE2Kgg2LfZhNio2KfYqiDYp9mE2YXZiNin2YHZgtipINin2YTYrtin2LXYqSDYqNin2YTZhdiz2KrYrtiv2YVcclxuICBnZXRNeUFwcHJvdmFsUmVxdWVzdHM6IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgYXBwcm92YWxzID0gYXdhaXQgQXBwcm92YWxSZXF1ZXN0LmZpbmQoeyByZXF1ZXN0ZXI6IHJlcS51c2VyLl9pZCB9KS5zb3J0KHtcclxuICAgICAgICBjcmVhdGVkQXQ6IC0xLFxyXG4gICAgICB9KTtcclxuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBhcHByb3ZhbHMgfSk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVyci5tZXNzYWdlIH0pO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vINis2YTYqCDYp9mE2LfZhNio2KfYqiDYp9mE2YXYudmE2YLYqSDZhNmE2YXYs9ik2YjZhCDYp9mE2K3Yp9mE2YpcclxuICBnZXRQZW5kaW5nQXBwcm92YWxzOiBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGFwcHJvdmFscyA9IGF3YWl0IEFwcHJvdmFsUmVxdWVzdC5maW5kKHtcclxuICAgICAgICAnc3RlcHMuYXBwcm92ZXInOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgJ3N0ZXBzLmFjdGlvbic6ICdwZW5kaW5nJyxcclxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgfSk7XHJcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgYXBwcm92YWxzIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9KTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyDYp9iq2K7Yp9iwINil2KzYsdin2KEgKNmF2YjYp9mB2YLYqS/YsdmB2LYpINi52YTZiSDYrti32YjYqSDYp9mE2YXZiNin2YHZgtipXHJcbiAgdGFrZUFwcHJvdmFsQWN0aW9uOiBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgYXBwcm92YWxJZCB9ID0gcmVxLnBhcmFtcztcclxuICAgICAgY29uc3QgeyBhY3Rpb24sIGNvbW1lbnQgfSA9IHJlcS5ib2R5OyAvLyBhY3Rpb246IGFwcHJvdmVkL3JlamVjdGVkXHJcbiAgICAgIGNvbnN0IGFwcHJvdmFsID0gYXdhaXQgQXBwcm92YWxSZXF1ZXN0LmZpbmRCeUlkKGFwcHJvdmFsSWQpO1xyXG4gICAgICBpZiAoIWFwcHJvdmFsKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ9in2YTYt9mE2Kgg2LrZitixINmF2YjYrNmI2K8nIH0pO1xyXG4gICAgICBjb25zdCBzdGVwID0gYXBwcm92YWwuc3RlcHNbYXBwcm92YWwuY3VycmVudFN0ZXBdO1xyXG4gICAgICBpZiAoIXN0ZXAgfHwgU3RyaW5nKHN0ZXAuYXBwcm92ZXIpICE9PSBTdHJpbmcocmVxLnVzZXIuX2lkKSB8fCBzdGVwLmFjdGlvbiAhPT0gJ3BlbmRpbmcnKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICfYutmK2LEg2YXYtdix2K0nIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIHN0ZXAuYWN0aW9uID0gYWN0aW9uO1xyXG4gICAgICBzdGVwLmFjdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICBzdGVwLmNvbW1lbnQgPSBjb21tZW50O1xyXG4gICAgICBhcHByb3ZhbC5jb21tZW50cy5wdXNoKHsgdXNlcjogcmVxLnVzZXIuX2lkLCB0ZXh0OiBjb21tZW50IH0pO1xyXG4gICAgICAvLyDYqtit2K/ZitirINin2YTYrdin2YTYqSDYp9mE2LnYp9mF2KlcclxuICAgICAgaWYgKGFjdGlvbiA9PT0gJ3JlamVjdGVkJykge1xyXG4gICAgICAgIGFwcHJvdmFsLnN0YXR1cyA9ICdyZWplY3RlZCc7XHJcbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnYXBwcm92ZWQnKSB7XHJcbiAgICAgICAgaWYgKGFwcHJvdmFsLmN1cnJlbnRTdGVwIDwgYXBwcm92YWwuc3RlcHMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgYXBwcm92YWwuY3VycmVudFN0ZXAgKz0gMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYXBwcm92YWwuc3RhdHVzID0gJ2FwcHJvdmVkJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgYXdhaXQgYXBwcm92YWwuc2F2ZSgpO1xyXG4gICAgICAvLyDYpdi02LnYp9ixINi12KfYrdioINin2YTYt9mE2KhcclxuICAgICAgYXdhaXQgTm90aWZpY2F0aW9uU2VydmljZS5zZW5kTm90aWZpY2F0aW9uKGFwcHJvdmFsLnJlcXVlc3Rlciwge1xyXG4gICAgICAgIHRpdGxlOiBg2KrYrdiv2YrYqyDYt9mE2Kgg2KfZhNmF2YjYp9mB2YLYqSAoJHthcHByb3ZhbC5yZXF1ZXN0VHlwZX0pYCxcclxuICAgICAgICBtZXNzYWdlOiBg2KrZhSDYp9iq2K7Yp9iwINil2KzYsdin2KE6ICR7YWN0aW9uID09PSAnYXBwcm92ZWQnID8gJ9mF2YjYp9mB2YLYqScgOiAn2LHZgdi2J30g2LnZhNmJINi32YTYqNmDLmAsXHJcbiAgICAgICAgY2hhbm5lbHM6IFsnaW4tYXBwJywgJ3B1c2gnXSxcclxuICAgICAgfSk7XHJcbiAgICAgIC8vINil2LTYudin2LEg2KfZhNmF2LPYpNmI2YQg2KfZhNiq2KfZhNmKINil2LDYpyDZhNmFINiq2YbYqtmH2ZAg2KfZhNiz2YTYs9mE2KlcclxuICAgICAgaWYgKGFwcHJvdmFsLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSB7XHJcbiAgICAgICAgY29uc3QgbmV4dFN0ZXAgPSBhcHByb3ZhbC5zdGVwc1thcHByb3ZhbC5jdXJyZW50U3RlcF07XHJcbiAgICAgICAgaWYgKG5leHRTdGVwICYmIG5leHRTdGVwLmFwcHJvdmVyKSB7XHJcbiAgICAgICAgICBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmROb3RpZmljYXRpb24obmV4dFN0ZXAuYXBwcm92ZXIsIHtcclxuICAgICAgICAgICAgdGl0bGU6IGDYt9mE2Kgg2YXZiNin2YHZgtipINis2K/ZitivINio2KfZhtiq2LjYp9ix2YMgKCR7YXBwcm92YWwucmVxdWVzdFR5cGV9KWAsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGDZitix2KzZiSDZhdix2KfYrNi52Kkg2LfZhNioINin2YTZhdmI2KfZgdmC2Kkg2YXZhiAke3JlcS51c2VyLm5hbWUgfHwgJ9mF2LPYqtiu2K/ZhSd9YCxcclxuICAgICAgICAgICAgY2hhbm5lbHM6IFsnaW4tYXBwJywgJ3B1c2gnXSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGFwcHJvdmFsIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9KTtcclxuICAgIH1cclxuICB9LFxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBBcHByb3ZhbFJlcXVlc3RDb250cm9sbGVyO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EsTUFBTUEsZUFBZSxHQUFHQyxPQUFPLENBQUMsMkJBQTJCLENBQUM7QUFDNUQsTUFBTUMsbUJBQW1CLEdBQUdELE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQztBQUN0RTs7QUFFQSxNQUFNRSx5QkFBeUIsR0FBRztFQUNoQztFQUNBQyxxQkFBcUIsRUFBRSxNQUFBQSxDQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztJQUN6QyxJQUFJO01BQ0YsTUFBTTtRQUFFQyxXQUFXO1FBQUVDLFlBQVk7UUFBRUMsU0FBUztRQUFFQztNQUFRLENBQUMsR0FBR0wsR0FBRyxDQUFDTSxJQUFJO01BQ2xFLElBQUksQ0FBQ0YsU0FBUyxJQUFJLENBQUNHLEtBQUssQ0FBQ0MsT0FBTyxDQUFDSixTQUFTLENBQUMsSUFBSUEsU0FBUyxDQUFDSyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQ3JFLE9BQU9SLEdBQUcsQ0FBQ1MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7VUFBRUMsT0FBTyxFQUFFLEtBQUs7VUFBRUMsT0FBTyxFQUFFO1FBQTRCLENBQUMsQ0FBQztNQUN2RjtNQUNBLE1BQU1DLEtBQUssR0FBR1YsU0FBUyxDQUFDVyxHQUFHLENBQUNDLE1BQU0sS0FBSztRQUFFQyxRQUFRLEVBQUVELE1BQU07UUFBRUUsTUFBTSxFQUFFO01BQVUsQ0FBQyxDQUFDLENBQUM7TUFDaEYsTUFBTUMsUUFBUSxHQUFH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