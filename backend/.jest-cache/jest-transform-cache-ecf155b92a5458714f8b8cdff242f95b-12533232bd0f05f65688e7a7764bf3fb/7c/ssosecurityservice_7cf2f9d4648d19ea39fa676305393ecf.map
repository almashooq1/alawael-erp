{"version":3,"names":["redis","require","crypto","logger","SSOSecurityService","constructor","useMockCache","process","env","USE_MOCK_CACHE","mockStore","Map","redisClient","createClient","host","REDIS_HOST","port","REDIS_PORT","password","REDIS_PASSWORD","connect","catch","err","error","MAX_LOGIN_ATTEMPTS","parseInt","LOGIN_ATTEMPT_WINDOW","SUSPICIOUS_ACTIVITY_THRESHOLD","SESSION_FINGERPRINT_ALGORITHM","_store","key","value","ttl","set","setTimeout","delete","setEx","JSON","stringify","_get","get","data","parse","_incr","current","newVal","incr","_expire","undefined","expire","trackLoginAttempt","email","success","metadata","now","Date","count","Math","floor","lockAccount","warn","blocked","attemptsRemaining","message","logAuditEvent","attempt","timestamp","del","reason","durationMinutes","lockKey","lockData","lockedAt","unlocksAt","duration","isAccountLocked","locked","lock","remainingTime","ceil","detectSuspiciousActivity","userId","activitiesData","activities","filter","a","push","suspicionScore","calculateSuspicionScore","score","slice","suspicious","action","length","recentActivities","uniqueIPs","Set","map","ipAddress","Boolean","size","hour","getHours","failedAttempts","type","newLocations","forEach","country","includes","add","timeDiffs","i","avgTimeDiff","reduce","b","min","generateSessionFingerprint","fingerprintData","userAgent","acceptLanguage","screenResolution","timezone","plugins","fingerprintString","fingerprint","createHash","update","digest","verifySessionFingerprint","sessionId","currentFingerprint","storedFingerprint","valid","eventType","auditEntry","toISOString","severity","getEventSeverity","info","severitMap","getAuditLog","filters","startDate","endDate","limit","pattern","keys","logs","logData","log","getTime","sort","validateGeolocation","previousLocations","geoData","city","coordinates","lat","lng","lastLocation","distance","calculateDistance","coord1","coord2","R","dLat","PI","dLng","sin","cos","c","atan2","sqrt","whitelistIP","deviceName","whitelistData","whitelist","whitelistedAt","isIPWhitelisted","some","w","disconnect","module","exports"],"sources":["sso-security.service.js"],"sourcesContent":["/**\r\n * SSO Security & Audit Service\r\n * خدمة الأمان والتدقيق لـ SSO\r\n */\r\n\r\nconst redis = require('redis');\r\nconst crypto = require('crypto');\r\nconst logger = require('../utils/logger');\r\n\r\nclass SSOSecurityService {\r\n  constructor() {\r\n    this.useMockCache = process.env.USE_MOCK_CACHE === 'true';\r\n    this.mockStore = new Map();\r\n    \r\n    // Try to connect to Redis if not using mock\r\n    if (!this.useMockCache) {\r\n      this.redisClient = redis.createClient({\r\n        host: process.env.REDIS_HOST || 'localhost',\r\n        port: process.env.REDIS_PORT || 6379,\r\n        password: process.env.REDIS_PASSWORD\r\n      });\r\n\r\n      this.redisClient.connect().catch(err => {\r\n        logger.error('Redis connection error:', err);\r\n        // Fallback to mock cache\r\n        this.useMockCache = true;\r\n      });\r\n    }\r\n\r\n    // Security constants\r\n    this.MAX_LOGIN_ATTEMPTS = parseInt(process.env.MAX_LOGIN_ATTEMPTS || 5);\r\n    this.LOGIN_ATTEMPT_WINDOW = parseInt(process.env.LOGIN_ATTEMPT_WINDOW || 900000); // 15 min\r\n    this.SUSPICIOUS_ACTIVITY_THRESHOLD = parseInt(process.env.SUSPICIOUS_ACTIVITY_THRESHOLD || 10);\r\n    this.SESSION_FINGERPRINT_ALGORITHM = 'sha256';\r\n  }\r\n\r\n  // ===== Mock Cache Helper Methods =====\r\n  async _store(key, value, ttl = null) {\r\n    if (this.useMockCache) {\r\n      this.mockStore.set(key, value);\r\n      if (ttl) {\r\n        setTimeout(() => this.mockStore.delete(key), ttl * 1000);\r\n      }\r\n      return true;\r\n    }\r\n    try {\r\n      if (ttl) {\r\n        await this.redisClient.setEx(key, ttl, JSON.stringify(value));\r\n      } else {\r\n        await this.redisClient.set(key, JSON.stringify(value));\r\n      }\r\n      return true;\r\n    } catch (err) {\r\n      logger.error('Error storing cache:', err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async _get(key) {\r\n    if (this.useMockCache) {\r\n      return this.mockStore.get(key);\r\n    }\r\n    try {\r\n      const data = await this.redisClient.get(key);\r\n      return data ? JSON.parse(data) : null;\r\n    } catch (err) {\r\n      logger.error('Error retrieving cache:', err);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  async _incr(key) {\r\n    if (this.useMockCache) {\r\n      const current = this.mockStore.get(key) || 0;\r\n      const newVal = current + 1;\r\n      this.mockStore.set(key, newVal);\r\n      return newVal;\r\n    }\r\n    try {\r\n      return await this.redisClient.incr(key);\r\n    } catch (err) {\r\n      logger.error('Error incrementing counter:', err);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  async _expire(key, ttl) {\r\n    if (this.useMockCache) {\r\n      const current = this.mockStore.get(key);\r\n      if (current !== undefined && ttl) {\r\n        setTimeout(() => this.mockStore.delete(key), ttl * 1000);\r\n      }\r\n      return true;\r\n    }\r\n    try {\r\n      await this.redisClient.expire(key, ttl);\r\n      return true;\r\n    } catch (err) {\r\n      logger.error('Error setting expiration:', err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تتبع محاولات تسجيل الدخول الفاشلة\r\n   * Track login attempts\r\n   */\r\n  async trackLoginAttempt(email, success = false, metadata = {}) {\r\n    try {\r\n      const key = `login:attempts:${email}`;\r\n      const now = Date.now();\r\n\r\n      if (!success) {\r\n        // Increment failed attempts\r\n        const count = await this._incr(key);\r\n\r\n        if (count === 1) {\r\n          // Set expiration on first attempt\r\n          await this._expire(key, Math.floor(this.LOGIN_ATTEMPT_WINDOW / 1000));\r\n        }\r\n\r\n        // Check if account should be locked\r\n        if (count >= this.MAX_LOGIN_ATTEMPTS) {\r\n          await this.lockAccount(email, 'too_many_failed_attempts');\r\n          logger.warn(`Account locked due to failed login attempts: ${email}`);\r\n\r\n          return {\r\n            blocked: true,\r\n            attemptsRemaining: 0,\r\n            message: 'Too many failed login attempts. Account temporarily locked.'\r\n          };\r\n        }\r\n\r\n        // Log failed attempt\r\n        this.logAuditEvent('LOGIN_FAILED', {\r\n          email,\r\n          attempt: count,\r\n          timestamp: now,\r\n          ...metadata\r\n        });\r\n\r\n        return {\r\n          blocked: false,\r\n          attemptsRemaining: this.MAX_LOGIN_ATTEMPTS - count\r\n        };\r\n      } else {\r\n        // Clear failed attempts on successful login\r\n        await this.redisClient.del(key);\r\n\r\n        // Clear account lock if exists\r\n        await this.redisClient.del(`account:locked:${email}`);\r\n\r\n        // Log successful login\r\n        this.logAuditEvent('LOGIN_SUCCESS', {\r\n          email,\r\n          timestamp: now,\r\n          ...metadata\r\n        });\r\n\r\n        return { blocked: false };\r\n      }\r\n    } catch (error) {\r\n      logger.error('Failed to track login attempt:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * قفل الحساب مؤقتاً\r\n   * Lock account temporarily\r\n   */\r\n  async lockAccount(email, reason, durationMinutes = 30) {\r\n    try {\r\n      const lockKey = `account:locked:${email}`;\r\n      const lockData = {\r\n        email,\r\n        reason,\r\n        lockedAt: Date.now(),\r\n        unlocksAt: Date.now() + (durationMinutes * 60 * 1000)\r\n      };\r\n\r\n      await this.redisClient.setEx(\r\n        lockKey,\r\n        durationMinutes * 60,\r\n        JSON.stringify(lockData)\r\n      );\r\n\r\n      this.logAuditEvent('ACCOUNT_LOCKED', {\r\n        email,\r\n        reason,\r\n        duration: durationMinutes\r\n      });\r\n\r\n      return lockData;\r\n    } catch (error) {\r\n      logger.error('Failed to lock account:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من حالة قفل الحساب\r\n   * Check if account is locked\r\n   */\r\n  async isAccountLocked(email) {\r\n    try {\r\n      const lockKey = `account:locked:${email}`;\r\n      const lockData = await this._get(lockKey);\r\n\r\n      if (!lockData) {\r\n        return { locked: false };\r\n      }\r\n\r\n      const lock = JSON.parse(lockData);\r\n      return {\r\n        locked: true,\r\n        reason: lock.reason,\r\n        unlocksAt: lock.unlocksAt,\r\n        remainingTime: Math.ceil((lock.unlocksAt - Date.now()) / 1000)\r\n      };\r\n    } catch (error) {\r\n      logger.error('Failed to check account lock:', error);\r\n      return { locked: false };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * كشف النشاط المريب\r\n   * Detect suspicious activity\r\n   */\r\n  async detectSuspiciousActivity(userId, metadata = {}) {\r\n    try {\r\n      const key = `activity:${userId}`;\r\n      const now = Date.now();\r\n\r\n      // Get user's recent activities\r\n      const activitiesData = await this.redisClient.get(key);\r\n      let activities = activitiesData ? JSON.parse(activitiesData) : [];\r\n\r\n      // Remove old activities (older than 1 hour)\r\n      activities = activities.filter(a => a.timestamp > now - 3600000);\r\n\r\n      // Add new activity\r\n      activities.push({\r\n        ...metadata,\r\n        timestamp: now\r\n      });\r\n\r\n      // Save back to Redis\r\n      await this.redisClient.setEx(\r\n        key,\r\n        3600, // 1 hour\r\n        JSON.stringify(activities)\r\n      );\r\n\r\n      // Check for suspicious patterns\r\n      const suspicionScore = this.calculateSuspicionScore(userId, activities);\r\n\r\n      if (suspicionScore > this.SUSPICIOUS_ACTIVITY_THRESHOLD) {\r\n        logger.warn(`Suspicious activity detected for user: ${userId}, score: ${suspicionScore}`);\r\n\r\n        this.logAuditEvent('SUSPICIOUS_ACTIVITY', {\r\n          userId,\r\n          score: suspicionScore,\r\n          activities: activities.slice(-5) // Last 5 activities\r\n        });\r\n\r\n        return {\r\n          suspicious: true,\r\n          score: suspicionScore,\r\n          action: 'require_verification'\r\n        };\r\n      }\r\n\r\n      return {\r\n        suspicious: false,\r\n        score: suspicionScore\r\n      };\r\n    } catch (error) {\r\n      logger.error('Failed to detect suspicious activity:', error);\r\n      return { suspicious: false, score: 0 };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب درجة الريبة\r\n   * Calculate suspicion score\r\n   */\r\n  calculateSuspicionScore(userId, activities) {\r\n    let score = 0;\r\n\r\n    if (!activities || activities.length === 0) return score;\r\n\r\n    const now = Date.now();\r\n    const recentActivities = activities.slice(-10); // Last 10 activities\r\n\r\n    // Multiple login attempts from different IPs\r\n    const uniqueIPs = new Set(activities.map(a => a.ipAddress).filter(Boolean));\r\n    if (uniqueIPs.size > 3) score += 5;\r\n\r\n    // Unusual time of access\r\n    const hour = new Date().getHours();\r\n    if (hour < 5 || hour > 23) score += 3;\r\n\r\n    // Multiple failed attempts\r\n    const failedAttempts = activities.filter(a => a.type === 'failed').length;\r\n    if (failedAttempts > 3) score += 10;\r\n\r\n    // Access from unusual geographic location\r\n    const newLocations = new Set();\r\n    activities.forEach(a => {\r\n      if (a.country && !activities[0]?.country?.includes(a.country)) {\r\n        newLocations.add(a.country);\r\n      }\r\n    });\r\n    if (newLocations.size > 2) score += 5;\r\n\r\n    // Rapid sequential requests\r\n    if (recentActivities.length > 1) {\r\n      const timeDiffs = [];\r\n      for (let i = 1; i < recentActivities.length; i++) {\r\n        timeDiffs.push(recentActivities[i].timestamp - recentActivities[i - 1].timestamp);\r\n      }\r\n      const avgTimeDiff = timeDiffs.reduce((a, b) => a + b) / timeDiffs.length;\r\n      if (avgTimeDiff < 5000) score += 5; // Quick requests\r\n    }\r\n\r\n    return Math.min(score, 100); // Cap at 100\r\n  }\r\n\r\n  /**\r\n   * توليد بصمة الجلسة\r\n   * Generate session fingerprint for anomaly detection\r\n   */\r\n  generateSessionFingerprint(metadata = {}) {\r\n    try {\r\n      const fingerprintData = {\r\n        userAgent: metadata.userAgent || '',\r\n        acceptLanguage: metadata.acceptLanguage || '',\r\n        screenResolution: metadata.screenResolution || '',\r\n        timezone: metadata.timezone || '',\r\n        plugins: metadata.plugins || [],\r\n        timestamp: Date.now()\r\n      };\r\n\r\n      const fingerprintString = JSON.stringify(fingerprintData);\r\n      const fingerprint = crypto\r\n        .createHash(this.SESSION_FINGERPRINT_ALGORITHM)\r\n        .update(fingerprintString)\r\n        .digest('hex');\r\n\r\n      return {\r\n        fingerprint,\r\n        fingerprintData\r\n      };\r\n    } catch (error) {\r\n      logger.error('Failed to generate session fingerprint:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من بصمة الجلسة\r\n   * Verify session fingerprint\r\n   */\r\n  async verifySessionFingerprint(sessionId, currentFingerprint) {\r\n    try {\r\n      const key = `session:fingerprint:${sessionId}`;\r\n      const storedFingerprint = await this.redisClient.get(key);\r\n\r\n      if (!storedFingerprint) {\r\n        return { valid: false, reason: 'No fingerprint stored' };\r\n      }\r\n\r\n      if (storedFingerprint === currentFingerprint) {\r\n        return { valid: true };\r\n      }\r\n\r\n      logger.warn(`Session fingerprint mismatch for session: ${sessionId}`);\r\n      return { valid: false, reason: 'Fingerprint mismatch' };\r\n    } catch (error) {\r\n      logger.error('Failed to verify session fingerprint:', error);\r\n      return { valid: false, reason: 'Verification failed' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تسجيل أحداث التدقيق\r\n   * Log audit events\r\n   */\r\n  async logAuditEvent(eventType, data) {\r\n    try {\r\n      const auditEntry = {\r\n        eventType,\r\n        timestamp: new Date().toISOString(),\r\n        data,\r\n        severity: this.getEventSeverity(eventType)\r\n      };\r\n\r\n      // Store in Redis for quick access\r\n      const key = `audit:${eventType}:${Date.now()}`;\r\n      await this.redisClient.setEx(\r\n        key,\r\n        86400, // 24 hours\r\n        JSON.stringify(auditEntry)\r\n      );\r\n\r\n      // Also log to main audit log\r\n      logger.info(`AUDIT[${eventType}]`, auditEntry);\r\n\r\n      return auditEntry;\r\n    } catch (error) {\r\n      logger.error('Failed to log audit event:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الحصول على درجة خطورة الحدث\r\n   * Get event severity level\r\n   */\r\n  getEventSeverity(eventType) {\r\n    const severitMap = {\r\n      'LOGIN_SUCCESS': 'INFO',\r\n      'LOGIN_FAILED': 'WARNING',\r\n      'ACCOUNT_LOCKED': 'WARNING',\r\n      'SUSPICIOUS_ACTIVITY': 'CRITICAL',\r\n      'TOKEN_EXPIRED': 'INFO',\r\n      'UNAUTHORIZED_ACCESS': 'CRITICAL',\r\n      'PERMISSION_DENIED': 'WARNING',\r\n      'LOGOUT': 'INFO',\r\n      'SESSION_CREATED': 'INFO',\r\n      'SESSION_ENDED': 'INFO'\r\n    };\r\n\r\n    return severitMap[eventType] || 'INFO';\r\n  }\r\n\r\n  /**\r\n   * الحصول على سجل التدقيق\r\n   * Get audit log\r\n   */\r\n  async getAuditLog(filters = {}) {\r\n    try {\r\n      const {\r\n        eventType = '*',\r\n        startDate = Date.now() - 86400000,\r\n        endDate = Date.now(),\r\n        limit = 100\r\n      } = filters;\r\n\r\n      const pattern = `audit:${eventType}:*`;\r\n      const keys = await this.redisClient.keys(pattern);\r\n\r\n      const logs = [];\r\n      for (const key of keys.slice(0, limit)) {\r\n        const logData = await this.redisClient.get(key);\r\n        if (logData) {\r\n          const log = JSON.parse(logData);\r\n          const timestamp = new Date(log.timestamp).getTime();\r\n\r\n          if (timestamp >= startDate && timestamp <= endDate) {\r\n            logs.push(log);\r\n          }\r\n        }\r\n      }\r\n\r\n      // Sort by timestamp descending\r\n      logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\r\n\r\n      return logs;\r\n    } catch (error) {\r\n      logger.error('Failed to retrieve audit log:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من التوافق الجغرافي\r\n   * Perform geolocation validation\r\n   */\r\n  async validateGeolocation(userId, ipAddress, previousLocations = []) {\r\n    try {\r\n      // This would integrate with a geolocation service\r\n      // For now, returning a mock response\r\n\r\n      const geoData = {\r\n        ipAddress,\r\n        country: 'SA', // Mock\r\n        city: 'Riyadh',\r\n        coordinates: { lat: 24.7136, lng: 46.6753 }\r\n      };\r\n\r\n      // Check if location is significantly different\r\n      if (previousLocations.length > 0) {\r\n        const lastLocation = previousLocations[previousLocations.length - 1];\r\n        const distance = this.calculateDistance(\r\n          { lat: geoData.coordinates.lat, lng: geoData.coordinates.lng },\r\n          { lat: lastLocation.coordinates?.lat, lng: lastLocation.coordinates?.lng }\r\n        );\r\n\r\n        // If more than 1000km in less than 1 hour, flag as suspicious\r\n        if (distance > 1000) {\r\n          logger.warn(`Suspicious geolocation change for user: ${userId}`);\r\n          return {\r\n            valid: false,\r\n            reason: 'Impossible travel detected',\r\n            distance\r\n          };\r\n        }\r\n      }\r\n\r\n      return { valid: true, geoData };\r\n    } catch (error) {\r\n      logger.error('Geolocation validation failed:', error);\r\n      return { valid: false, reason: 'Validation failed' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب المسافة بين نقطتين\r\n   * Calculate distance between two coordinates\r\n   */\r\n  calculateDistance(coord1, coord2) {\r\n    const R = 6371; // Earth's radius in km\r\n    const dLat = (coord2.lat - coord1.lat) * Math.PI / 180;\r\n    const dLng = (coord2.lng - coord1.lng) * Math.PI / 180;\r\n\r\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(coord1.lat * Math.PI / 180) * Math.cos(coord2.lat * Math.PI / 180) *\r\n      Math.sin(dLng / 2) * Math.sin(dLng / 2);\r\n\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n  }\r\n\r\n  /**\r\n   * إنشاء قائمة بيضاء للعناوين IP\r\n   * Whitelist IP addresses\r\n   */\r\n  async whitelistIP(userId, ipAddress, deviceName = '') {\r\n    try {\r\n      const key = `whitelist:${userId}`;\r\n      const whitelistData = await this.redisClient.get(key);\r\n      let whitelist = whitelistData ? JSON.parse(whitelistData) : [];\r\n\r\n      whitelist.push({\r\n        ipAddress,\r\n        deviceName,\r\n        whitelistedAt: Date.now()\r\n      });\r\n\r\n      // Keep only last 10 whitelisted IPs\r\n      whitelist = whitelist.slice(-10);\r\n\r\n      await this.redisClient.setEx(\r\n        key,\r\n        31536000, // 1 year\r\n        JSON.stringify(whitelist)\r\n      );\r\n\r\n      logger.info(`IP whitelisted for user: ${userId}, IP: ${ipAddress}`);\r\n      return whitelist;\r\n    } catch (error) {\r\n      logger.error('Failed to whitelist IP:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من قائمة بيضاء العناوين IP\r\n   * Check IP whitelist\r\n   */\r\n  async isIPWhitelisted(userId, ipAddress) {\r\n    try {\r\n      const key = `whitelist:${userId}`;\r\n      const whitelistData = await this.redisClient.get(key);\r\n\r\n      if (!whitelistData) {\r\n        return false;\r\n      }\r\n\r\n      const whitelist = JSON.parse(whitelistData);\r\n      return whitelist.some(w => w.ipAddress === ipAddress);\r\n    } catch (error) {\r\n      logger.error('Failed to check IP whitelist:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إغلاق الاتصال مع Redis\r\n   * Disconnect Redis\r\n   */\r\n  async disconnect() {\r\n    try {\r\n      await this.redisClient.disconnect();\r\n      logger.info('Redis connection closed');\r\n    } catch (error) {\r\n      logger.error('Error closing Redis connection:', error);\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = SSOSecurityService;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;AAC9B,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAME,MAAM,GAAGF,OAAO,CAAC,iBAAiB,CAAC;AAEzC,MAAMG,kBAAkB,CAAC;EACvBC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,YAAY,GAAGC,OAAO,CAACC,GAAG,CAACC,cAAc,KAAK,MAAM;IACzD,IAAI,CAACC,SAAS,GAAG,IAAIC,GAAG,CAAC,CAAC;;IAE1B;IACA,IAAI,CAAC,IAAI,CAACL,YAAY,EAAE;MACtB,IAAI,CAACM,WAAW,GAAGZ,KAAK,CAACa,YAAY,CAAC;QACpCC,IAAI,EAAEP,OAAO,CAACC,GAAG,CAACO,UAAU,IAAI,WAAW;QAC3CC,IAAI,EAAET,OAAO,CAACC,GAAG,CAACS,UAAU,IAAI,IAAI;QACpCC,QAAQ,EAAEX,OAAO,CAACC,GAAG,CAACW;MACxB,CAAC,CAAC;MAEF,IAAI,CAACP,WAAW,CAACQ,OAAO,CAAC,CAAC,CAACC,KAAK,CAACC,GAAG,IAAI;QACtCnB,MAAM,CAACoB,KAAK,CAAC,yBAAyB,EAAED,GAAG,CAAC;QAC5C;QACA,IAAI,CAAChB,YAAY,GAAG,IAAI;MAC1B,CAAC,CAAC;IACJ;;IAEA;IACA,IAAI,CAACkB,kBAAkB,GAAGC,QAAQ,CAAClB,OAAO,CAACC,GAAG,CAACgB,kBAAkB,IAAI,CAAC,CAAC;IACvE,IAAI,CAACE,oBAAoB,GAAGD,QAAQ,CAAClB,OAAO,CAACC,GAAG,CAACkB,oBAAoB,IAAI,MAAM,CAAC,CAAC,CAAC;IAClF,IAAI,CAACC,6BAA6B,GAAGF,QAAQ,CAAClB,OAAO,CAACC,GAAG,CAACmB,6BAA6B,IAAI,EAAE,CAAC;IAC9F,IAAI,CAACC,6BAA6B,GAAG,QAAQ;EAC/C;;EAEA;EACA,MAAMC,MAAMA,CAACC,GAAG,EAAEC,KAAK,EAAEC,GAAG,GAAG,IAAI,EAAE;IACnC,IAAI,IAAI,CAAC1B,YAAY,EAAE;MACrB,IAAI,CAACI,SAAS,CAACuB,GAAG,CAACH,GAAG,EAAEC,KAAK,CAAC;MAC9B,IAAIC,GAAG,EAAE;QACPE,UAAU,CAAC,MAAM,IAAI,CAACxB,SAAS,CAACyB,MAAM,CAACL,GAAG,CAAC,EAAEE,GAAG,GAAG,IAAI,CAAC;MAC1D;MACA,OAAO,IAAI;IACb;IACA,IAAI;MACF,IAAIA,GAAG,EAAE;QACP,MAAM,IAAI,CAACpB,WAAW,CAACwB,KAAK,CAACN,GAAG,EAAEE,GAAG,EAAEK,IAAI,CAACC,SAAS,CAACP,KAAK,CAAC,CAAC;MAC/D,CAAC,MAAM;QACL,MAAM,IAAI,CAACnB,WAAW,CAACqB,GAAG,CAACH,GAAG,EAAEO,IAAI,CAACC,SAAS,CAACP,KAAK,CAAC,CAAC;MACxD;MACA,OAAO,IAAI;IACb,CAAC,CAAC,OAAOT,GAAG,EAAE;MACZnB,MAAM,CAACoB,KAAK,CAAC,sBAAsB,EAAED,GAAG,CAAC;MACzC,OAAO,KAAK;IACd;EACF;EAEA,MAAMiB,IAAIA,CAACT,GAAG,EAAE;IACd,IAAI,IAAI,CAACxB,YAAY,EAAE;MACrB,OAAO,IAAI,CAACI,SAAS,CAAC8B,GAAG,CAACV,GAAG,CAAC;IAChC;IACA,IAAI;MACF,MAAMW,IAAI,GAAG,MAAM,IAAI,CAAC7B,WAAW,CAAC4B,GAAG,CAACV,GAAG,CAAC;MAC5C,OAAOW,IAAI,GAAGJ,IAAI,CAACK,KAAK,CAACD,IAAI,CAAC,GAAG,IAAI;IACvC,CAAC,CAAC,OAAOnB,GAAG,EAAE;MACZnB,MAAM,CAACoB,KAAK,CAAC,yBAAyB,EAAED,GAAG,CAAC;MAC5C,OAAO,IAAI;IACb;EACF;EAEA,MAAMqB,KAAKA,CAACb,GAAG,EAAE;IACf,IAAI,IAAI,CAACxB,YAAY,EAAE;MACrB,MAAMsC,OAAO,GAAG,IAAI,CAAClC,SAAS,CAAC8B,GAAG,CAACV,GAAG,CAAC,IAAI,CAAC;MAC5C,MAAMe,MAAM,GAAGD,OAAO,GAAG,CAAC;MAC1B,IAAI,CAAClC,SAAS,CAACuB,GAAG,CAACH,GAAG,EAAEe,MAAM,CAAC;MAC/B,OAAOA,MAAM;IACf;IACA,IAAI;MACF,OAAO,MAAM,IAAI,CAACjC,WAAW,CAACkC,IAAI,CAAChB,GAAG,CAAC;IACzC,CAAC,CAAC,OAAOR,GAAG,EAAE;MACZnB,MAAM,CAACoB,KAAK,CAAC,6BAA6B,EAAED,GAAG,CAAC;MAChD,OAAO,CAAC;IACV;EACF;EAEA,MAAMyB,OAAOA,CAACjB,GAAG,EAAEE,GAAG,EAAE;IACtB,IAAI,IAAI,CAAC1B,YAAY,EAAE;MACrB,MAAMsC,OAAO,GAAG,IAAI,CAAClC,SAAS,CAAC8B,GAAG,CAACV,GAAG,CAAC;MACvC,IAAIc,OAAO,KAAKI,SAAS,IAAIhB,GAAG,EAAE;QAChCE,UAAU,CAAC,MAAM,IAAI,CAACxB,SAAS,CAACyB,MAAM,CAACL,GAAG,CAAC,EAAEE,GAAG,GAAG,IAAI,CAAC;MAC1D;MACA,OAAO,IAAI;IACb;IACA,IAAI;MACF,MAAM,IAAI,CAACpB,WAAW,CAACqC,MAAM,CAACnB,GAAG,EAAEE,GAAG,CAAC;MACvC,OAAO,IAAI;IACb,CAAC,CAAC,OAAOV,GAAG,EAAE;MACZnB,MAAM,CAACoB,KAAK,CAAC,2BAA2B,EAAED,GAAG,CAAC;MAC9C,OAAO,KAAK;IACd;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAM4B,iBAAiBA,CAACC,KAAK,EAAEC,OAAO,GAAG,KAAK,EAAEC,QAAQ,GAAG,CAAC,CAAC,EAAE;IAC7D,IAAI;MACF,MAAMvB,GAAG,GAAG,kBAAkBqB,KAAK,EAAE;MACrC,MAAMG,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;MAEtB,IAAI,CAACF,OAAO,EAAE;QACZ;QACA,MAAMI,KAAK,GAAG,MAAM,IAAI,CAACb,KAAK,CAACb,GAAG,CAAC;QAEnC,IAAI0B,KAAK,KAAK,CAAC,EAAE;UACf;UACA,MAAM,IAAI,CAACT,OAAO,CAACjB,GAAG,EAAE2B,IAAI,CAACC,KAAK,CAAC,IAAI,CAAChC,oBAAoB,GAAG,IAAI,CAAC,CAAC;QACvE;;QAEA;QACA,IAAI8B,KAAK,IAAI,IAAI,CAAChC,kBAAkB,EAAE;UACpC,MAAM,IAAI,CAACmC,WAAW,CAACR,KAAK,EAAE,0BAA0B,CAAC;UACzDhD,MAAM,CAACyD,IAAI,CAAC,gDAAgDT,KAAK,EAAE,CAAC;UAEpE,OAAO;YACLU,OAAO,EAAE,IAAI;YACbC,iBAAiB,EAAE,CAAC;YACpBC,OAAO,EAAE;UACX,CAAC;QACH;;QAEA;QACA,IAAI,CAACC,aAAa,CAAC,cAAc,EAAE;UACjCb,KAAK;UACLc,OAAO,EAAET,KAAK;UACdU,SAAS,EAAEZ,GAAG;UACd,GAAGD;QACL,CAAC,CAAC;QAEF,OAAO;UACLQ,OAAO,EAAE,KAAK;UACdC,iBAAiB,EAAE,IAAI,CAACtC,kBAAkB,GAAGgC;QAC/C,CAAC;MACH,CAAC,MAAM;QACL;QACA,MAAM,IAAI,CAAC5C,WAAW,CAACuD,GAAG,CAACrC,GAAG,CAAC;;QAE/B;QACA,MAAM,IAAI,CAAClB,WAAW,CAACuD,GAAG,CAAC,kBAAkBhB,KAAK,EAAE,CAAC;;QAErD;QACA,IAAI,CAACa,aAAa,CAAC,eAAe,EAAE;UAClCb,KAAK;UACLe,SAAS,EAAEZ,GAAG;UACd,GAAGD;QACL,CAAC,CAAC;QAEF,OAAO;UAAEQ,OAAO,EAAE;QAAM,CAAC;MAC3B;IACF,CAAC,CAAC,OAAOtC,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACrD,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAMoC,WAAWA,CAACR,KAAK,EAAEiB,MAAM,EAAEC,eAAe,GAAG,EAAE,EAAE;IACrD,IAAI;MACF,MAAMC,OAAO,GAAG,kBAAkBnB,KAAK,EAAE;MACzC,MAAMoB,QAAQ,GAAG;QACfpB,KAAK;QACLiB,MAAM;QACNI,QAAQ,EAAEjB,IAAI,CAACD,GAAG,CAAC,CAAC;QACpBmB,SAAS,EAAElB,IAAI,CAACD,GAAG,CAAC,CAAC,GAAIe,eAAe,GAAG,EAAE,GAAG;MAClD,CAAC;MAED,MAAM,IAAI,CAACzD,WAAW,CAACwB,KAAK,CAC1BkC,OAAO,EACPD,eAAe,GAAG,EAAE,EACpBhC,IAAI,CAACC,SAAS,CAACiC,QAAQ,CACzB,CAAC;MAED,IAAI,CAACP,aAAa,CAAC,gBAAgB,EAAE;QACnCb,KAAK;QACLiB,MAAM;QACNM,QAAQ,EAAEL;MACZ,CAAC,CAAC;MAEF,OAAOE,QAAQ;IACjB,CAAC,CAAC,OAAOhD,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC9C,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAMoD,eAAeA,CAACxB,KAAK,EAAE;IAC3B,IAAI;MACF,MAAMmB,OAAO,GAAG,kBAAkBnB,KAAK,EAAE;MACzC,MAAMoB,QAAQ,GAAG,MAAM,IAAI,CAAChC,IAAI,CAAC+B,OAAO,CAAC;MAEzC,IAAI,CAACC,QAAQ,EAAE;QACb,OAAO;UAAEK,MAAM,EAAE;QAAM,CAAC;MAC1B;MAEA,MAAMC,IAAI,GAAGxC,IAAI,CAACK,KAAK,CAAC6B,QAAQ,CAAC;MACjC,OAAO;QACLK,MAAM,EAAE,IAAI;QACZR,MAAM,EAAES,IAAI,CAACT,MAAM;QACnBK,SAAS,EAAEI,IAAI,CAACJ,SAAS;QACzBK,aAAa,EAAErB,IAAI,CAACsB,IAAI,CAAC,CAACF,IAAI,CAACJ,SAAS,GAAGlB,IAAI,CAACD,GAAG,CAAC,CAAC,IAAI,IAAI;MAC/D,CAAC;IACH,CAAC,CAAC,OAAO/B,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACpD,OAAO;QAAEqD,MAAM,EAAE;MAAM,CAAC;IAC1B;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAMI,wBAAwBA,CAACC,MAAM,EAAE5B,QAAQ,GAAG,CAAC,CAAC,EAAE;IACpD,IAAI;MACF,MAAMvB,GAAG,GAAG,YAAYmD,MAAM,EAAE;MAChC,MAAM3B,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;;MAEtB;MACA,MAAM4B,cAAc,GAAG,MAAM,IAAI,CAACtE,WAAW,CAAC4B,GAAG,CAACV,GAAG,CAAC;MACtD,IAAIqD,UAAU,GAAGD,cAAc,GAAG7C,IAAI,CAACK,KAAK,CAACwC,cAAc,CAAC,GAAG,EAAE;;MAEjE;MACAC,UAAU,GAAGA,UAAU,CAACC,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACnB,SAAS,GAAGZ,GAAG,GAAG,OAAO,CAAC;;MAEhE;MACA6B,UAAU,CAACG,IAAI,CAAC;QACd,GAAGjC,QAAQ;QACXa,SAAS,EAAEZ;MACb,CAAC,CAAC;;MAEF;MACA,MAAM,IAAI,CAAC1C,WAAW,CAACwB,KAAK,CAC1BN,GAAG,EACH,IAAI;MAAE;MACNO,IAAI,CAACC,SAAS,CAAC6C,UAAU,CAC3B,CAAC;;MAED;MACA,MAAMI,cAAc,GAAG,IAAI,CAACC,uBAAuB,CAACP,MAAM,EAAEE,UAAU,CAAC;MAEvE,IAAII,cAAc,GAAG,IAAI,CAAC5D,6BAA6B,EAAE;QACvDxB,MAAM,CAACyD,IAAI,CAAC,0CAA0CqB,MAAM,YAAYM,cAAc,EAAE,CAAC;QAEzF,IAAI,CAACvB,aAAa,CAAC,qBAAqB,EAAE;UACxCiB,MAAM;UACNQ,KAAK,EAAEF,cAAc;UACrBJ,UAAU,EAAEA,UAAU,CAACO,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;QACnC,CAAC,CAAC;QAEF,OAAO;UACLC,UAAU,EAAE,IAAI;UAChBF,KAAK,EAAEF,cAAc;UACrBK,MAAM,EAAE;QACV,CAAC;MACH;MAEA,OAAO;QACLD,UAAU,EAAE,KAAK;QACjBF,KAAK,EAAEF;MACT,CAAC;IACH,CAAC,CAAC,OAAOhE,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;MAC5D,OAAO;QAAEoE,UAAU,EAAE,KAAK;QAAEF,KAAK,EAAE;MAAE,CAAC;IACxC;EACF;;EAEA;AACF;AACA;AACA;EACED,uBAAuBA,CAACP,MAAM,EAAEE,UAAU,EAAE;IAC1C,IAAIM,KAAK,GAAG,CAAC;IAEb,IAAI,CAACN,UAAU,IAAIA,UAAU,CAACU,MAAM,KAAK,CAAC,EAAE,OAAOJ,KAAK;IAExD,MAAMnC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAMwC,gBAAgB,GAAGX,UAAU,CAACO,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;;IAEhD;IACA,MAAMK,SAAS,GAAG,IAAIC,GAAG,CAACb,UAAU,CAACc,GAAG,CAACZ,CAAC,IAAIA,CAAC,CAACa,SAAS,CAAC,CAACd,MAAM,CAACe,OAAO,CAAC,CAAC;IAC3E,IAAIJ,SAAS,CAACK,IAAI,GAAG,CAAC,EAAEX,KAAK,IAAI,CAAC;;IAElC;IACA,MAAMY,IAAI,GAAG,IAAI9C,IAAI,CAAC,CAAC,CAAC+C,QAAQ,CAAC,CAAC;IAClC,IAAID,IAAI,GAAG,CAAC,IAAIA,IAAI,GAAG,EAAE,EAAEZ,KAAK,IAAI,CAAC;;IAErC;IACA,MAAMc,cAAc,GAAGpB,UAAU,CAACC,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACmB,IAAI,KAAK,QAAQ,CAAC,CAACX,MAAM;IACzE,IAAIU,cAAc,GAAG,CAAC,EAAEd,KAAK,IAAI,EAAE;;IAEnC;IACA,MAAMgB,YAAY,GAAG,IAAIT,GAAG,CAAC,CAAC;IAC9Bb,UAAU,CAACuB,OAAO,CAACrB,CAAC,IAAI;MACtB,IAAIA,CAAC,CAACsB,OAAO,IAAI,CAACxB,UAAU,CAAC,CAAC,CAAC,EAAEwB,OAAO,EAAEC,QAAQ,CAACvB,CAAC,CAACsB,OAAO,CAAC,EAAE;QAC7DF,YAAY,CAACI,GAAG,CAACxB,CAAC,CAACsB,OAAO,CAAC;MAC7B;IACF,CAAC,CAAC;IACF,IAAIF,YAAY,CAACL,IAAI,GAAG,CAAC,EAAEX,KAAK,IAAI,CAAC;;IAErC;IACA,IAAIK,gBAAgB,CAACD,MAAM,GAAG,CAAC,EAAE;MAC/B,MAAMiB,SAAS,GAAG,EAAE;MACpB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGjB,gBAAgB,CAACD,MAAM,EAAEkB,CAAC,EAAE,EAAE;QAChDD,SAAS,CAACxB,IAAI,CAACQ,gBAAgB,CAACiB,CAAC,CAAC,CAAC7C,SAAS,GAAG4B,gBAAgB,CAACiB,CAAC,GAAG,CAAC,CAAC,CAAC7C,SAAS,CAAC;MACnF;MACA,MAAM8C,WAAW,GAAGF,SAAS,CAACG,MAAM,CAAC,CAAC5B,CAAC,EAAE6B,CAAC,KAAK7B,CAAC,GAAG6B,CAAC,CAAC,GAAGJ,SAAS,CAACjB,MAAM;MACxE,IAAImB,WAAW,GAAG,IAAI,EAAEvB,KAAK,IAAI,CAAC,CAAC,CAAC;IACtC;IAEA,OAAOhC,IAAI,CAAC0D,GAAG,CAAC1B,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;EAC/B;;EAEA;AACF;AACA;AACA;EACE2B,0BAA0BA,CAAC/D,QAAQ,GAAG,CAAC,CAAC,EAAE;IACxC,IAAI;MACF,MAAMgE,eAAe,GAAG;QACtBC,SAAS,EAAEjE,QAAQ,CAACiE,SAAS,IAAI,EAAE;QACnCC,cAAc,EAAElE,QAAQ,CAACkE,cAAc,IAAI,EAAE;QAC7CC,gBAAgB,EAAEnE,QAAQ,CAACmE,gBAAgB,IAAI,EAAE;QACjDC,QAAQ,EAAEpE,QAAQ,CAACoE,QAAQ,IAAI,EAAE;QACjCC,OAAO,EAAErE,QAAQ,CAACqE,OAAO,IAAI,EAAE;QAC/BxD,SAAS,EAAEX,IAAI,CAACD,GAAG,CAAC;MACtB,CAAC;MAED,MAAMqE,iBAAiB,GAAGtF,IAAI,CAACC,SAAS,CAAC+E,eAAe,CAAC;MACzD,MAAMO,WAAW,GAAG1H,MAAM,CACvB2H,UAAU,CAAC,IAAI,CAACjG,6BAA6B,CAAC,CAC9CkG,MAAM,CAACH,iBAAiB,CAAC,CACzBI,MAAM,CAAC,KAAK,CAAC;MAEhB,OAAO;QACLH,WAAW;QACXP;MACF,CAAC;IACH,CAAC,CAAC,OAAO9F,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;MAC9D,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAMyG,wBAAwBA,CAACC,SAAS,EAAEC,kBAAkB,EAAE;IAC5D,IAAI;MACF,MAAMpG,GAAG,GAAG,uBAAuBmG,SAAS,EAAE;MAC9C,MAAME,iBAAiB,GAAG,MAAM,IAAI,CAACvH,WAAW,CAAC4B,GAAG,CAACV,GAAG,CAAC;MAEzD,IAAI,CAACqG,iBAAiB,EAAE;QACtB,OAAO;UAAEC,KAAK,EAAE,KAAK;UAAEhE,MAAM,EAAE;QAAwB,CAAC;MAC1D;MAEA,IAAI+D,iBAAiB,KAAKD,kBAAkB,EAAE;QAC5C,OAAO;UAAEE,KAAK,EAAE;QAAK,CAAC;MACxB;MAEAjI,MAAM,CAACyD,IAAI,CAAC,6CAA6CqE,SAAS,EAAE,CAAC;MACrE,OAAO;QAAEG,KAAK,EAAE,KAAK;QAAEhE,MAAM,EAAE;MAAuB,CAAC;IACzD,CAAC,CAAC,OAAO7C,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;MAC5D,OAAO;QAAE6G,KAAK,EAAE,KAAK;QAAEhE,MAAM,EAAE;MAAsB,CAAC;IACxD;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAMJ,aAAaA,CAACqE,SAAS,EAAE5F,IAAI,EAAE;IACnC,IAAI;MACF,MAAM6F,UAAU,GAAG;QACjBD,SAAS;QACTnE,SAAS,EAAE,IAAIX,IAAI,CAAC,CAAC,CAACgF,WAAW,CAAC,CAAC;QACnC9F,IAAI;QACJ+F,QAAQ,EAAE,IAAI,CAACC,gBAAgB,CAACJ,SAAS;MAC3C,CAAC;;MAED;MACA,MAAMvG,GAAG,GAAG,SAASuG,SAAS,IAAI9E,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;MAC9C,MAAM,IAAI,CAAC1C,WAAW,CAACwB,KAAK,CAC1BN,GAAG,EACH,KAAK;MAAE;MACPO,IAAI,CAACC,SAAS,CAACgG,UAAU,CAC3B,CAAC;;MAED;MACAnI,MAAM,CAACuI,IAAI,CAAC,SAASL,SAAS,GAAG,EAAEC,UAAU,CAAC;MAE9C,OAAOA,UAAU;IACnB,CAAC,CAAC,OAAO/G,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IACnD;EACF;;EAEA;AACF;AACA;AACA;EACEkH,gBAAgBA,CAACJ,SAAS,EAAE;IAC1B,MAAMM,UAAU,GAAG;MACjB,eAAe,EAAE,MAAM;MACvB,cAAc,EAAE,SAAS;MACzB,gBAAgB,EAAE,SAAS;MAC3B,qBAAqB,EAAE,UAAU;MACjC,eAAe,EAAE,MAAM;MACvB,qBAAqB,EAAE,UAAU;MACjC,mBAAmB,EAAE,SAAS;MAC9B,QAAQ,EAAE,MAAM;MAChB,iBAAiB,EAAE,MAAM;MACzB,eAAe,EAAE;IACnB,CAAC;IAED,OAAOA,UAAU,CAACN,SAAS,CAAC,IAAI,MAAM;EACxC;;EAEA;AACF;AACA;AACA;EACE,MAAMO,WAAWA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;IAC9B,IAAI;MACF,MAAM;QACJR,SAAS,GAAG,GAAG;QACfS,SAAS,GAAGvF,IAAI,CAACD,GAAG,CAAC,CAAC,GAAG,QAAQ;QACjCyF,OAAO,GAAGxF,IAAI,CAACD,GAAG,CAAC,CAAC;QACpB0F,KAAK,GAAG;MACV,CAAC,GAAGH,OAAO;MAEX,MAAMI,OAAO,GAAG,SAASZ,SAAS,IAAI;MACtC,MAAMa,IAAI,GAAG,MAAM,IAAI,CAACtI,WAAW,CAACsI,IAAI,CAACD,OAAO,CAAC;MAEjD,MAAME,IAAI,GAAG,EAAE;MACf,KAAK,MAAMrH,GAAG,IAAIoH,IAAI,CAACxD,KAAK,CAAC,CAAC,EAAEsD,KAAK,CAAC,EAAE;QACtC,MAAMI,OAAO,GAAG,MAAM,IAAI,CAACxI,WAAW,CAAC4B,GAAG,CAACV,GAAG,CAAC;QAC/C,IAAIsH,OAAO,EAAE;UACX,MAAMC,GAAG,GAAGhH,IAAI,CAACK,KAAK,CAAC0G,OAAO,CAAC;UAC/B,MAAMlF,SAAS,GAAG,IAAIX,IAAI,CAAC8F,GAAG,CAACnF,SAAS,CAAC,CAACoF,OAAO,CAAC,CAAC;UAEnD,IAAIpF,SAAS,IAAI4E,SAAS,IAAI5E,SAAS,IAAI6E,OAAO,EAAE;YAClDI,IAAI,CAAC7D,IAAI,CAAC+D,GAAG,CAAC;UAChB;QACF;MACF;;MAEA;MACAF,IAAI,CAACI,IAAI,CAAC,CAAClE,CAAC,EAAE6B,CAAC,KAAK,IAAI3D,IAAI,CAAC2D,CAAC,CAAChD,SAAS,CAAC,GAAG,IAAIX,IAAI,CAAC8B,CAAC,CAACnB,SAAS,CAAC,CAAC;MAElE,OAAOiF,IAAI;IACb,CAAC,CAAC,OAAO5H,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACpD,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAMiI,mBAAmBA,CAACvE,MAAM,EAAEiB,SAAS,EAAEuD,iBAAiB,GAAG,EAAE,EAAE;IACnE,IAAI;MACF;MACA;;MAEA,MAAMC,OAAO,GAAG;QACdxD,SAAS;QACTS,OAAO,EAAE,IAAI;QAAE;QACfgD,IAAI,EAAE,QAAQ;QACdC,WAAW,EAAE;UAAEC,GAAG,EAAE,OAAO;UAAEC,GAAG,EAAE;QAAQ;MAC5C,CAAC;;MAED;MACA,IAAIL,iBAAiB,CAAC5D,MAAM,GAAG,CAAC,EAAE;QAChC,MAAMkE,YAAY,GAAGN,iBAAiB,CAACA,iBAAiB,CAAC5D,MAAM,GAAG,CAAC,CAAC;QACpE,MAAMmE,QAAQ,GAAG,IAAI,CAACC,iBAAiB,CACrC;UAAEJ,GAAG,EAAEH,OAAO,CAACE,WAAW,CAACC,GAAG;UAAEC,GAAG,EAAEJ,OAAO,CAACE,WAAW,CAACE;QAAI,CAAC,EAC9D;UAAED,GAAG,EAAEE,YAAY,CAACH,WAAW,EAAEC,GAAG;UAAEC,GAAG,EAAEC,YAAY,CAACH,WAAW,EAAEE;QAAI,CAC3E,CAAC;;QAED;QACA,IAAIE,QAAQ,GAAG,IAAI,EAAE;UACnB7J,MAAM,CAACyD,IAAI,CAAC,2CAA2CqB,MAAM,EAAE,CAAC;UAChE,OAAO;YACLmD,KAAK,EAAE,KAAK;YACZhE,MAAM,EAAE,4BAA4B;YACpC4F;UACF,CAAC;QACH;MACF;MAEA,OAAO;QAAE5B,KAAK,EAAE,IAAI;QAAEsB;MAAQ,CAAC;IACjC,CAAC,CAAC,OAAOnI,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACrD,OAAO;QAAE6G,KAAK,EAAE,KAAK;QAAEhE,MAAM,EAAE;MAAoB,CAAC;IACtD;EACF;;EAEA;AACF;AACA;AACA;EACE6F,iBAAiBA,CAACC,MAAM,EAAEC,MAAM,EAAE;IAChC,MAAMC,CAAC,GAAG,IAAI,CAAC,CAAC;IAChB,MAAMC,IAAI,GAAG,CAACF,MAAM,CAACN,GAAG,GAAGK,MAAM,CAACL,GAAG,IAAIpG,IAAI,CAAC6G,EAAE,GAAG,GAAG;IACtD,MAAMC,IAAI,GAAG,CAACJ,MAAM,CAACL,GAAG,GAAGI,MAAM,CAACJ,GAAG,IAAIrG,IAAI,CAAC6G,EAAE,GAAG,GAAG;IAEtD,MAAMjF,CAAC,GAAG5B,IAAI,CAAC+G,GAAG,CAACH,IAAI,GAAG,CAAC,CAAC,GAAG5G,IAAI,CAAC+G,GAAG,CAACH,IAAI,GAAG,CAAC,CAAC,GAC/C5G,IAAI,CAACgH,GAAG,CAACP,MAAM,CAACL,GAAG,GAAGpG,IAAI,CAAC6G,EAAE,GAAG,GAAG,CAAC,GAAG7G,IAAI,CAACgH,GAAG,CAACN,MAAM,CAACN,GAAG,GAAGpG,IAAI,CAAC6G,EAAE,GAAG,GAAG,CAAC,GAC3E7G,IAAI,CAAC+G,GAAG,CAACD,IAAI,GAAG,CAAC,CAAC,GAAG9G,IAAI,CAAC+G,GAAG,CAACD,IAAI,GAAG,CAAC,CAAC;IAEzC,MAAMG,CAAC,GAAG,CAAC,GAAGjH,IAAI,CAACkH,KAAK,CAAClH,IAAI,CAACmH,IAAI,CAACvF,CAAC,CAAC,EAAE5B,IAAI,CAACmH,IAAI,CAAC,CAAC,GAAGvF,CAAC,CAAC,CAAC;IACxD,OAAO+E,CAAC,GAAGM,CAAC;EACd;;EAEA;AACF;AACA;AACA;EACE,MAAMG,WAAWA,CAAC5F,MAAM,EAAEiB,SAAS,EAAE4E,UAAU,GAAG,EAAE,EAAE;IACpD,IAAI;MACF,MAAMhJ,GAAG,GAAG,aAAamD,MAAM,EAAE;MACjC,MAAM8F,aAAa,GAAG,MAAM,IAAI,CAACnK,WAAW,CAAC4B,GAAG,CAACV,GAAG,CAAC;MACrD,IAAIkJ,SAAS,GAAGD,aAAa,GAAG1I,IAAI,CAACK,KAAK,CAACqI,aAAa,CAAC,GAAG,EAAE;MAE9DC,SAAS,CAAC1F,IAAI,CAAC;QACbY,SAAS;QACT4E,UAAU;QACVG,aAAa,EAAE1H,IAAI,CAACD,GAAG,CAAC;MAC1B,CAAC,CAAC;;MAEF;MACA0H,SAAS,GAAGA,SAAS,CAACtF,KAAK,CAAC,CAAC,EAAE,CAAC;MAEhC,MAAM,IAAI,CAAC9E,WAAW,CAACwB,KAAK,CAC1BN,GAAG,EACH,QAAQ;MAAE;MACVO,IAAI,CAACC,SAAS,CAAC0I,SAAS,CAC1B,CAAC;MAED7K,MAAM,CAACuI,IAAI,CAAC,4BAA4BzD,MAAM,SAASiB,SAAS,EAAE,CAAC;MACnE,OAAO8E,SAAS;IAClB,CAAC,CAAC,OAAOzJ,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC9C,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAM2J,eAAeA,CAACjG,MAAM,EAAEiB,SAAS,EAAE;IACvC,IAAI;MACF,MAAMpE,GAAG,GAAG,aAAamD,MAAM,EAAE;MACjC,MAAM8F,aAAa,GAAG,MAAM,IAAI,CAACnK,WAAW,CAAC4B,GAAG,CAACV,GAAG,CAAC;MAErD,IAAI,CAACiJ,aAAa,EAAE;QAClB,OAAO,KAAK;MACd;MAEA,MAAMC,SAAS,GAAG3I,IAAI,CAACK,KAAK,CAACqI,aAAa,CAAC;MAC3C,OAAOC,SAAS,CAACG,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAClF,SAAS,KAAKA,SAAS,CAAC;IACvD,CAAC,CAAC,OAAO3E,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACpD,OAAO,KAAK;IACd;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAM8J,UAAUA,CAAA,EAAG;IACjB,IAAI;MACF,MAAM,IAAI,CAACzK,WAAW,CAACyK,UAAU,CAAC,CAAC;MACnClL,MAAM,CAACuI,IAAI,CAAC,yBAAyB,CAAC;IACxC,CAAC,CAAC,OAAOnH,KAAK,EAAE;MACdpB,MAAM,CAACoB,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;IACxD;EACF;AACF;AAEA+J,MAAM,CAACC,OAAO,GAAGnL,kBAAkB","ignoreList":[]}