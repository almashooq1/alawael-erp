07cf8285e2a77b1e4d9d0035d2e8c8a4
const mongoose = require('mongoose');
const notificationSchema = new mongoose.Schema({
  // المستخدم المستلم للإشعار
  userId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true,
    index: true
  },
  // نوع الإشعار
  type: {
    type: String,
    enum: ['info', 'success', 'warning', 'error', 'system', 'message', 'task', 'reminder'],
    default: 'info'
  },
  // عنوان الإشعار
  title: {
    type: String,
    required: true,
    trim: true
  },
  // محتوى الإشعار
  message: {
    type: String,
    required: true,
    trim: true
  },
  // أيقونة الإشعار (اختياري)
  icon: {
    type: String,
    default: 'NotificationsIcon'
  },
  // لون الإشعار (اختياري)
  color: {
    type: String,
    default: '#1976d2'
  },
  // رابط للإشعار (اختياري)
  link: {
    type: String,
    trim: true
  },
  // بيانات إضافية (JSON)
  metadata: {
    type: mongoose.Schema.Types.Mixed,
    default: {}
  },
  // حالة الأرشفة
  archiveStatus: {
    type: String,
    enum: ['pending', 'archived', 'failed'],
    default: 'pending'
  },
  archiveId: {
    type: String
  },
  // حالة التوقيع الإلكتروني
  signatureStatus: {
    type: String,
    enum: ['none', 'pending', 'signed', 'failed'],
    default: 'none'
  },
  signatureId: {
    type: String
  },
  // حالة الختم الإلكتروني
  stampStatus: {
    type: String,
    enum: ['none', 'pending', 'stamped', 'failed'],
    default: 'none'
  },
  stampId: {
    type: String
  },
  // حالة القراءة
  isRead: {
    type: Boolean,
    default: false,
    index: true
  },
  // تاريخ القراءة
  readAt: {
    type: Date
  },
  // الأولوية
  priority: {
    type: String,
    enum: ['low', 'normal', 'high', 'urgent'],
    default: 'normal'
  },
  // تاريخ الانتهاء (للإشعارات المؤقتة)
  expiresAt: {
    type: Date
  },
  // هل تم إرساله عبر WebSocket
  sentViaWebSocket: {
    type: Boolean,
    default: false
  },
  // المرسل (اختياري)
  senderId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User'
  },
  // الفئة
  category: {
    type: String,
    default: 'general'
  },
  // رقم تسلسلي مميز لكل خطاب/إشعار
  serialNumber: {
    type: String,
    unique: true,
    sparse: true,
    index: true
  },
  // باركود (Base64 أو نص)
  barcode: {
    type: String
  }
}, {
  timestamps: true
});

// Indexes للأداء
notificationSchema.index({
  userId: 1,
  isRead: 1
});
notificationSchema.index({
  userId: 1,
  createdAt: -1
});
notificationSchema.index({
  expiresAt: 1
}, {
  expireAfterSeconds: 0
});

// Virtual لعرض الوقت المنقضي
notificationSchema.virtual('timeAgo').get(function () {
  const now = new Date();
  const diff = now - this.createdAt;
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  if (days > 0) return `منذ ${days} يوم`;
  if (hours > 0) return `منذ ${hours} ساعة`;
  if (minutes > 0) return `منذ ${minutes} دقيقة`;
  return 'الآن';
});

// Method لتحديد الإشعار كمقروء
notificationSchema.methods.markAsRead = async function () {
  this.isRead = true;
  this.readAt = new Date();
  return await this.save();
};

// Method لتحديد الإشعار كغير مقروء
notificationSchema.methods.markAsUnread = async function () {
  this.isRead = false;
  this.readAt = null;
  return await this.save();
};

// Static method لإنشاء إشعار جديد
notificationSchema.statics.createNotification = async function (data) {
  const notification = new this(data);
  return await notification.save();
};

// Static method لإنشاء إشعار لعدة مستخدمين
notificationSchema.statics.createBulkNotifications = async function (userIds, notificationData) {
  const notifications = userIds.map(userId => ({
    ...notificationData,
    userId
  }));
  return await this.insertMany(notifications);
};

// Static method لحذف الإشعارات القديمة
notificationSchema.statics.deleteOldNotifications = async function (days = 30) {
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);
  return await this.deleteMany({
    createdAt: {
      $lt: cutoffDate
    },
    isRead: true
  });
};

// Middleware قبل الحفظ
notificationSchema.pre('save', function (next) {
  // تعيين لون افتراضي حسب النوع
  if (!this.color) {
    const colorMap = {
      info: '#1976d2',
      success: '#2e7d32',
      warning: '#ed6c02',
      error: '#d32f2f',
      system: '#9c27b0',
      message: '#0288d1',
      task: '#f57c00',
      reminder: '#7b1fa2'
    };
    this.color = colorMap[this.type] || '#1976d2';
  }
  next();
});

// Prevent model recompilation in tests
const Notification = mongoose.models.Notification || mongoose.model('Notification', notificationSchema);
module.exports = Notification;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJub3RpZmljYXRpb25TY2hlbWEiLCJTY2hlbWEiLCJ1c2VySWQiLCJ0eXBlIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsInJlcXVpcmVkIiwiaW5kZXgiLCJTdHJpbmciLCJlbnVtIiwiZGVmYXVsdCIsInRpdGxlIiwidHJpbSIsIm1lc3NhZ2UiLCJpY29uIiwiY29sb3IiLCJsaW5rIiwibWV0YWRhdGEiLCJNaXhlZCIsImFyY2hpdmVTdGF0dXMiLCJhcmNoaXZlSWQiLCJzaWduYXR1cmVTdGF0dXMiLCJzaWduYXR1cmVJZCIsInN0YW1wU3RhdHVzIiwic3RhbXBJZCIsImlzUmVhZCIsIkJvb2xlYW4iLCJyZWFkQXQiLCJEYXRlIiwicHJpb3JpdHkiLCJleHBpcmVzQXQiLCJzZW50VmlhV2ViU29ja2V0Iiwic2VuZGVySWQiLCJjYXRlZ29yeSIsInNlcmlhbE51bWJlciIsInVuaXF1ZSIsInNwYXJzZSIsImJhcmNvZGUiLCJ0aW1lc3RhbXBzIiwiY3JlYXRlZEF0IiwiZXhwaXJlQWZ0ZXJTZWNvbmRzIiwidmlydHVhbCIsImdldCIsIm5vdyIsImRpZmYiLCJzZWNvbmRzIiwiTWF0aCIsImZsb29yIiwibWludXRlcyIsImhvdXJzIiwiZGF5cyIsIm1ldGhvZHMiLCJtYXJrQXNSZWFkIiwic2F2ZSIsIm1hcmtBc1VucmVhZCIsInN0YXRpY3MiLCJjcmVhdGVOb3RpZmljYXRpb24iLCJkYXRhIiwibm90aWZpY2F0aW9uIiwiY3JlYXRlQnVsa05vdGlmaWNhdGlvbnMiLCJ1c2VySWRzIiwibm90aWZpY2F0aW9uRGF0YSIsIm5vdGlmaWNhdGlvbnMiLCJtYXAiLCJpbnNlcnRNYW55IiwiZGVsZXRlT2xkTm90aWZpY2F0aW9ucyIsImN1dG9mZkRhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImRlbGV0ZU1hbnkiLCIkbHQiLCJwcmUiLCJuZXh0IiwiY29sb3JNYXAiLCJpbmZvIiwic3VjY2VzcyIsIndhcm5pbmciLCJlcnJvciIsInN5c3RlbSIsInRhc2siLCJyZW1pbmRlciIsIk5vdGlmaWNhdGlvbiIsIm1vZGVscyIsIm1vZGVsIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIk5vdGlmaWNhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG5jb25zdCBub3RpZmljYXRpb25TY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKFxyXG4gIHtcclxuICAgIC8vINin2YTZhdiz2KrYrtiv2YUg2KfZhNmF2LPYqtmE2YUg2YTZhNil2LTYudin2LFcclxuICAgIHVzZXJJZDoge1xyXG4gICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgIHJlZjogJ1VzZXInLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgaW5kZXg6IHRydWUsXHJcbiAgICB9LFxyXG5cclxuICAgIC8vINmG2YjYuSDYp9mE2KXYtNi52KfYsVxyXG4gICAgdHlwZToge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIGVudW06IFsnaW5mbycsICdzdWNjZXNzJywgJ3dhcm5pbmcnLCAnZXJyb3InLCAnc3lzdGVtJywgJ21lc3NhZ2UnLCAndGFzaycsICdyZW1pbmRlciddLFxyXG4gICAgICBkZWZhdWx0OiAnaW5mbycsXHJcbiAgICB9LFxyXG5cclxuICAgIC8vINi52YbZiNin2YYg2KfZhNil2LTYudin2LFcclxuICAgIHRpdGxlOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgIHRyaW06IHRydWUsXHJcbiAgICB9LFxyXG5cclxuICAgIC8vINmF2K3YqtmI2Ykg2KfZhNil2LTYudin2LFcclxuICAgIG1lc3NhZ2U6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgdHJpbTogdHJ1ZSxcclxuICAgIH0sXHJcblxyXG4gICAgLy8g2KPZitmC2YjZhtipINin2YTYpdi02LnYp9ixICjYp9iu2KrZitin2LHZiilcclxuICAgIGljb246IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBkZWZhdWx0OiAnTm90aWZpY2F0aW9uc0ljb24nLFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyDZhNmI2YYg2KfZhNil2LTYudin2LEgKNin2K7YqtmK2KfYsdmKKVxyXG4gICAgY29sb3I6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBkZWZhdWx0OiAnIzE5NzZkMicsXHJcbiAgICB9LFxyXG5cclxuICAgIC8vINix2KfYqNi3INmE2YTYpdi02LnYp9ixICjYp9iu2KrZitin2LHZiilcclxuICAgIGxpbms6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICB0cmltOiB0cnVlLFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyDYqNmK2KfZhtin2Kog2KXYttin2YHZitipIChKU09OKVxyXG4gICAgbWV0YWRhdGE6IHtcclxuICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk1peGVkLFxyXG4gICAgICBkZWZhdWx0OiB7fSxcclxuICAgIH0sXHJcblxyXG4gICAgLy8g2K3Yp9mE2Kkg2KfZhNij2LHYtNmB2KlcclxuICAgIGFyY2hpdmVTdGF0dXM6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBlbnVtOiBbJ3BlbmRpbmcnLCAnYXJjaGl2ZWQnLCAnZmFpbGVkJ10sXHJcbiAgICAgIGRlZmF1bHQ6ICdwZW5kaW5nJyxcclxuICAgIH0sXHJcbiAgICBhcmNoaXZlSWQ6IHsgdHlwZTogU3RyaW5nIH0sXHJcblxyXG4gICAgLy8g2K3Yp9mE2Kkg2KfZhNiq2YjZgtmK2Lkg2KfZhNil2YTZg9iq2LHZiNmG2YpcclxuICAgIHNpZ25hdHVyZVN0YXR1czoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIGVudW06IFsnbm9uZScsICdwZW5kaW5nJywgJ3NpZ25lZCcsICdmYWlsZWQnXSxcclxuICAgICAgZGVmYXVsdDogJ25vbmUnLFxyXG4gICAgfSxcclxuICAgIHNpZ25hdHVyZUlkOiB7IHR5cGU6IFN0cmluZyB9LFxyXG5cclxuICAgIC8vINit2KfZhNipINin2YTYrtiq2YUg2KfZhNil2YTZg9iq2LHZiNmG2YpcclxuICAgIHN0YW1wU3RhdHVzOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgZW51bTogWydub25lJywgJ3BlbmRpbmcnLCAnc3RhbXBlZCcsICdmYWlsZWQnXSxcclxuICAgICAgZGVmYXVsdDogJ25vbmUnLFxyXG4gICAgfSxcclxuICAgIHN0YW1wSWQ6IHsgdHlwZTogU3RyaW5nIH0sXHJcblxyXG4gICAgLy8g2K3Yp9mE2Kkg2KfZhNmC2LHYp9ih2KlcclxuICAgIGlzUmVhZDoge1xyXG4gICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgaW5kZXg6IHRydWUsXHJcbiAgICB9LFxyXG5cclxuICAgIC8vINiq2KfYsdmK2K4g2KfZhNmC2LHYp9ih2KlcclxuICAgIHJlYWRBdDoge1xyXG4gICAgICB0eXBlOiBEYXRlLFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyDYp9mE2KPZiNmE2YjZitipXHJcbiAgICBwcmlvcml0eToge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIGVudW06IFsnbG93JywgJ25vcm1hbCcsICdoaWdoJywgJ3VyZ2VudCddLFxyXG4gICAgICBkZWZhdWx0OiAnbm9ybWFsJyxcclxuICAgIH0sXHJcblxyXG4gICAgLy8g2KrYp9ix2YrYriDYp9mE2KfZhtiq2YfYp9ihICjZhNmE2KXYtNi52KfYsdin2Kog2KfZhNmF2KTZgtiq2KkpXHJcbiAgICBleHBpcmVzQXQ6IHtcclxuICAgICAgdHlwZTogRGF0ZSxcclxuICAgIH0sXHJcblxyXG4gICAgLy8g2YfZhCDYqtmFINil2LHYs9in2YTZhyDYudio2LEgV2ViU29ja2V0XHJcbiAgICBzZW50VmlhV2ViU29ja2V0OiB7XHJcbiAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgIGRlZmF1bHQ6IGZhbHNlLFxyXG4gICAgfSxcclxuXHJcbiAgICAvLyDYp9mE2YXYsdiz2YQgKNin2K7YqtmK2KfYsdmKKVxyXG4gICAgc2VuZGVySWQ6IHtcclxuICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICByZWY6ICdVc2VyJyxcclxuICAgIH0sXHJcblxyXG4gICAgLy8g2KfZhNmB2KbYqVxyXG4gICAgY2F0ZWdvcnk6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBkZWZhdWx0OiAnZ2VuZXJhbCcsXHJcbiAgICB9LFxyXG5cclxuICAgIC8vINix2YLZhSDYqtiz2YTYs9mE2Yog2YXZhdmK2LIg2YTZg9mEINiu2LfYp9ioL9il2LTYudin2LFcclxuICAgIHNlcmlhbE51bWJlcjoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIHVuaXF1ZTogdHJ1ZSxcclxuICAgICAgc3BhcnNlOiB0cnVlLFxyXG4gICAgICBpbmRleDogdHJ1ZSxcclxuICAgIH0sXHJcblxyXG4gICAgLy8g2KjYp9ix2YPZiNivIChCYXNlNjQg2KPZiCDZhti1KVxyXG4gICAgYmFyY29kZToge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICB9LFxyXG4gIH0sXHJcbiAge1xyXG4gICAgdGltZXN0YW1wczogdHJ1ZSxcclxuICB9XHJcbik7XHJcblxyXG4vLyBJbmRleGVzINmE2YTYo9iv2KfYoVxyXG5ub3RpZmljYXRpb25TY2hlbWEuaW5kZXgoeyB1c2VySWQ6IDEsIGlzUmVhZDogMSB9KTtcclxubm90aWZpY2F0aW9uU2NoZW1hLmluZGV4KHsgdXNlcklkOiAxLCBjcmVhdGVkQXQ6IC0xIH0pO1xyXG5ub3RpZmljYXRpb25TY2hlbWEuaW5kZXgoeyBleHBpcmVzQXQ6IDEgfSwgeyBleHBpcmVBZnRlclNlY29uZHM6IDAgfSk7XHJcblxyXG4vLyBWaXJ0dWFsINmE2LnYsdi2INin2YTZiNmC2Kog2KfZhNmF2YbZgti22Ypcclxubm90aWZpY2F0aW9uU2NoZW1hLnZpcnR1YWwoJ3RpbWVBZ28nKS5nZXQoZnVuY3Rpb24gKCkge1xyXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgY29uc3QgZGlmZiA9IG5vdyAtIHRoaXMuY3JlYXRlZEF0O1xyXG4gIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKGRpZmYgLyAxMDAwKTtcclxuICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApO1xyXG4gIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihtaW51dGVzIC8gNjApO1xyXG4gIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKGhvdXJzIC8gMjQpO1xyXG5cclxuICBpZiAoZGF5cyA+IDApIHJldHVybiBg2YXZhtiwICR7ZGF5c30g2YrZiNmFYDtcclxuICBpZiAoaG91cnMgPiAwKSByZXR1cm4gYNmF2YbYsCAke2hvdXJzfSDYs9in2LnYqWA7XHJcbiAgaWYgKG1pbnV0ZXMgPiAwKSByZXR1cm4gYNmF2YbYsCAke21pbnV0ZXN9INiv2YLZitmC2KlgO1xyXG4gIHJldHVybiAn2KfZhNii2YYnO1xyXG59KTtcclxuXHJcbi8vIE1ldGhvZCDZhNiq2K3Yr9mK2K8g2KfZhNil2LTYudin2LEg2YPZhdmC2LHZiNihXHJcbm5vdGlmaWNhdGlvblNjaGVtYS5tZXRob2RzLm1hcmtBc1JlYWQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XHJcbiAgdGhpcy5pc1JlYWQgPSB0cnVlO1xyXG4gIHRoaXMucmVhZEF0ID0gbmV3IERhdGUoKTtcclxuICByZXR1cm4gYXdhaXQgdGhpcy5zYXZlKCk7XHJcbn07XHJcblxyXG4vLyBNZXRob2Qg2YTYqtit2K/ZitivINin2YTYpdi02LnYp9ixINmD2LrZitixINmF2YLYsdmI2KFcclxubm90aWZpY2F0aW9uU2NoZW1hLm1ldGhvZHMubWFya0FzVW5yZWFkID0gYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gIHRoaXMuaXNSZWFkID0gZmFsc2U7XHJcbiAgdGhpcy5yZWFkQXQgPSBudWxsO1xyXG4gIHJldHVybiBhd2FpdCB0aGlzLnNhdmUoKTtcclxufTtcclxuXHJcbi8vIFN0YXRpYyBtZXRob2Qg2YTYpdmG2LTYp9ihINil2LTYudin2LEg2KzYr9mK2K9cclxubm90aWZpY2F0aW9uU2NoZW1hLnN0YXRpY3MuY3JlYXRlTm90aWZpY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGRhdGEpIHtcclxuICBjb25zdCBub3RpZmljYXRpb24gPSBuZXcgdGhpcyhkYXRhKTtcclxuICByZXR1cm4gYXdhaXQgbm90aWZpY2F0aW9uLnNhdmUoKTtcclxufTtcclxuXHJcbi8vIFN0YXRpYyBtZXRob2Qg2YTYpdmG2LTYp9ihINil2LTYudin2LEg2YTYudiv2Kkg2YXYs9iq2K7Yr9mF2YrZhlxyXG5ub3RpZmljYXRpb25TY2hlbWEuc3RhdGljcy5jcmVhdGVCdWxrTm90aWZpY2F0aW9ucyA9IGFzeW5jIGZ1bmN0aW9uICh1c2VySWRzLCBub3RpZmljYXRpb25EYXRhKSB7XHJcbiAgY29uc3Qgbm90aWZpY2F0aW9ucyA9IHVzZXJJZHMubWFwKHVzZXJJZCA9PiAoe1xyXG4gICAgLi4ubm90aWZpY2F0aW9uRGF0YSxcclxuICAgIHVzZXJJZCxcclxuICB9KSk7XHJcbiAgcmV0dXJuIGF3YWl0IHRoaXMuaW5zZXJ0TWFueShub3RpZmljYXRpb25zKTtcclxufTtcclxuXHJcbi8vIFN0YXRpYyBtZXRob2Qg2YTYrdiw2YEg2KfZhNil2LTYudin2LHYp9iqINin2YTZgtiv2YrZhdipXHJcbm5vdGlmaWNhdGlvblNjaGVtYS5zdGF0aWNzLmRlbGV0ZU9sZE5vdGlmaWNhdGlvbnMgPSBhc3luYyBmdW5jdGlvbiAoZGF5cyA9IDMwKSB7XHJcbiAgY29uc3QgY3V0b2ZmRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgY3V0b2ZmRGF0ZS5zZXREYXRlKGN1dG9mZkRhdGUuZ2V0RGF0ZSgpIC0gZGF5cyk7XHJcblxyXG4gIHJldHVybiBhd2FpdCB0aGlzLmRlbGV0ZU1hbnkoe1xyXG4gICAgY3JlYXRlZEF0OiB7ICRsdDogY3V0b2ZmRGF0ZSB9LFxyXG4gICAgaXNSZWFkOiB0cnVlLFxyXG4gIH0pO1xyXG59O1xyXG5cclxuLy8gTWlkZGxld2FyZSDZgtio2YQg2KfZhNit2YHYuFxyXG5ub3RpZmljYXRpb25TY2hlbWEucHJlKCdzYXZlJywgZnVuY3Rpb24gKG5leHQpIHtcclxuICAvLyDYqti52YrZitmGINmE2YjZhiDYp9mB2KrYsdin2LbZiiDYrdiz2Kgg2KfZhNmG2YjYuVxyXG4gIGlmICghdGhpcy5jb2xvcikge1xyXG4gICAgY29uc3QgY29sb3JNYXAgPSB7XHJcbiAgICAgIGluZm86ICcjMTk3NmQyJyxcclxuICAgICAgc3VjY2VzczogJyMyZTdkMzInLFxyXG4gICAgICB3YXJuaW5nOiAnI2VkNmMwMicsXHJcbiAgICAgIGVycm9yOiAnI2QzMmYyZicsXHJcbiAgICAgIHN5c3RlbTogJyM5YzI3YjAnLFxyXG4gICAgICBtZXNzYWdlOiAnIzAyODhkMScsXHJcbiAgICAgIHRhc2s6ICcjZjU3YzAwJyxcclxuICAgICAgcmVtaW5kZXI6ICcjN2IxZmEyJyxcclxuICAgIH07XHJcbiAgICB0aGlzLmNvbG9yID0gY29sb3JNYXBbdGhpcy50eXBlXSB8fCAnIzE5NzZkMic7XHJcbiAgfVxyXG4gIG5leHQoKTtcclxufSk7XHJcblxyXG4vLyBQcmV2ZW50IG1vZGVsIHJlY29tcGlsYXRpb24gaW4gdGVzdHNcclxuY29uc3QgTm90aWZpY2F0aW9uID0gbW9uZ29vc2UubW9kZWxzLk5vdGlmaWNhdGlvbiB8fCBtb25nb29zZS5tb2RlbCgnTm90aWZpY2F0aW9uJywgbm90aWZpY2F0aW9uU2NoZW1hKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTm90aWZpY2F0aW9uO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUVwQyxNQUFNQyxrQkFBa0IsR0FBRyxJQUFJRixRQUFR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LEdBQUcsZ0JBQWdCQyxPQUFPLEVBQUVDLGdCQUFnQixFQUFFO0VBQzlGLE1BQU1DLGFBQWEsR0FBR0YsT0FBTyxDQUFDRyxHQUFHLENBQUM5RCxNQUFNLEtBQUs7SUFDM0MsR0FBRzRELGdCQUFnQjtJQUNuQjVEO0VBQ0YsQ0FBQyxDQUFDLENBQUM7RUFDSCxPQUFPLE1BQU0sSUFBSSxDQUFDK0QsVUFBVSxDQUFDRixhQUFhLENBQUM7QUFDN0MsQ0FBQzs7QUFFRDtBQUNBL0Qsa0JBQWtCLENBQUN3RCxPQUFPLENBQUNVLHNCQUFzQixHQUFHLGdCQUFnQmYsSUFBSSxHQUFHLEVBQUUsRUFBRTtFQUM3RSxNQUFNZ0IsVUFBVSxHQUFHLElBQUl0QyxJQUFJLENBQUMsQ0FBQztFQUM3QnNDLFVBQVUsQ0FBQ0MsT0FBTyxDQUFDRCxVQUFVLENBQUNFLE9BQU8sQ0FBQyxDQUFDLEdBQUdsQixJQUFJLENBQUM7RUFFL0MsT0FBTyxNQUFNLElBQUksQ0FBQ21CLFVBQVUsQ0FBQztJQUMzQjlCLFNBQVMsRUFBRTtNQUFFK0IsR0FBRyxFQUFFSjtJQUFXLENBQUM7SUFDOUJ6QyxNQUFNLEVBQUU7RUFDVixDQUFDLENBQUM7QUFDSixDQUFDOztBQUVEO0FBQ0ExQixrQkFBa0IsQ0FBQ3dFLEdBQUcsQ0FBQyxNQUFNLEVBQUUsVUFBVUMsSUFBSSxFQUFFO0VBQzdDO0VBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQ3pELEtBQUssRUFBRTtJQUNmLE1BQU0wRCxRQUFRLEdBQUc7TUFDZkMsSUFBSSxFQUFFLFNBQVM7TUFDZkMsT0FBTyxFQUFFLFNBQVM7TUFDbEJDLE9BQU8sRUFBRSxTQUFTO01BQ2xCQyxLQUFLLEVBQUUsU0FBUztNQUNoQkMsTUFBTSxFQUFFLFNBQVM7TUFDakJqRSxPQUFPLEVBQUUsU0FBUztNQUNsQmtFLElBQUksRUFBRSxTQUFTO01BQ2ZDLFFBQVEsRUFBRTtJQUNaLENBQUM7SUFDRCxJQUFJLENBQUNqRSxLQUFLLEdBQUcwRCxRQUFRLENBQUMsSUFBSSxDQUFDdkUsSUFBSSxDQUFDLElBQUksU0FBUztFQUMvQztFQUNBc0UsSUFBSSxDQUFDLENBQUM7QUFDUixDQUFDLENBQUM7O0FBRUY7QUFDQSxNQUFNUyxZQUFZLEdBQUdwRixRQUFRLENBQUNxRixNQUFNLENBQUNELFlBQVksSUFBSXBGLFFBQVEsQ0FBQ3NGLEtBQUssQ0FBQyxjQUFjLEVBQUVwRixrQkFBa0IsQ0FBQztBQUV2R3FGLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHSixZQUFZIiwiaWdub3JlTGlzdCI6W119