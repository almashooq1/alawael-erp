{"version":3,"names":["express","require","router","Router","SSOService","OAuthService","verifySSOToken","_requireRole","_requirePermission","_verifyOptionalSSO","_auditLog","logger","console","log","ssoService","oAuthService","get","req","res","json","success","status","message","features","sessions","oauth2","openid_connect","mfa","audit_logging","endpoints","login","logout","userinfo","error","post","next","body","email","password","deviceId","userAgent","userPayload","userId","role","permissions","organizationId","session","createSession","ipAddress","ip","info","data","sessionId","accessToken","refreshToken","idToken","expiresIn","user","endSession","result","endAllUserSessions","sessionsEnded","getUserActiveSessions","delete","params","sessionExists","find","s","refreshAccessToken","token","verification","verifySession","valid","headers","authorization","split","introspection","introspectToken","client_id","redirect_uri","scope","state","response_type","nonce","query","_result","initiateAuthorizationCodeFlow","authUrl","baseUrl","URLSearchParams","toString","grant_type","code","client_secret","refresh_token","username","tokens","getTokens","clientId","clientSecret","redirectUri","userInfo","getUserInfo","config","getOpenIDConfiguration","token_type_hint","revokeToken","client_name","redirect_uris","response_types","grant_types","scopes","client","registerClient","clientName","redirectUris","responseTypes","grantTypes","registration_access_token","registration_client_uri","put","metadata","updatedSession","updateSessionMetadata","module","exports"],"sources":["sso.routes.js"],"sourcesContent":["/**\r\n * SSO Routes - Single Sign-On Endpoints\r\n * نقاط نهاية تسجيل الدخول الموحد\r\n */\r\n\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst SSOService = require('../services/sso.service');\r\nconst OAuthService = require('../services/oauth.service');\r\nconst {\r\n  verifySSOToken,\r\n  _requireRole,\r\n  _requirePermission,\r\n  _verifyOptionalSSO,\r\n  _auditLog\r\n} = require('../middleware/sso-auth.middleware');\r\nconst logger = require('../utils/logger');\r\n\r\nconsole.log('[SSO] Loading SSO Routes Module...');\r\n\r\nconst ssoService = new SSOService();\r\nconst oAuthService = new OAuthService();\r\n\r\nconsole.log('[SSO] Creating /status route handler...');\r\n\r\n// ============================================\r\n// SSO Health & Status Endpoint\r\n// ============================================\r\n\r\n/**\r\n * GET /api/sso/status\r\n * Get SSO system status\r\n */\r\nrouter.get('/status', async (req, res) => {\r\n  console.log('[SSO-HANDLER] /status endpoint hit!');\r\n  try {\r\n    res.json({\r\n      success: true,\r\n      status: 'operational',\r\n      message: 'SSO system is operational',\r\n      features: {\r\n        sessions: true,\r\n        oauth2: true,\r\n        openid_connect: true,\r\n        mfa: true,\r\n        audit_logging: true\r\n      },\r\n      endpoints: {\r\n        login: '/api/sso/login',\r\n        logout: '/api/sso/logout',\r\n        oauth2: '/api/sso/oauth2',\r\n        userinfo: '/api/sso/oauth2/userinfo'\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error('SSO status check failed:', error);\r\n    res.status(503).json({\r\n      success: false,\r\n      status: 'error',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// SSO Session Management Endpoints\r\n// ============================================\r\n\r\n/**\r\n * POST /api/sso/login\r\n * تسجيل دخول المستخدم وإنشاء جلسة SSO\r\n */\r\nrouter.post('/login', async (req, res, next) => {\r\n  console.log('[SSO-HANDLER] /login endpoint hit!');\r\n  console.log('[SSO-HANDLER] Body:', req.body);\r\n  \r\n  try {\r\n    const { email, password, deviceId, userAgent } = req.body;\r\n\r\n    // Validate credentials (implementation depends on your auth system)\r\n    if (!email || !password) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'validation_error',\r\n        message: 'Email and password are required'\r\n      });\r\n    }\r\n\r\n    // Authenticate user (this would call your actual auth service)\r\n    // For now, returning mock response\r\n    const userPayload = {\r\n      userId: 'user_123',\r\n      email,\r\n      role: 'user',\r\n      permissions: ['read'],\r\n      organizationId: 'org_1'\r\n    };\r\n\r\n    // Create SSO session\r\n    const session = await ssoService.createSession(userPayload.userId, userPayload, {\r\n      deviceId: deviceId || 'default',\r\n      userAgent: userAgent || req.get('user-agent'),\r\n      ipAddress: req.ip\r\n    });\r\n\r\n    // Log activity\r\n    logger.info(`User logged in via SSO: ${userPayload.userId}`);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        sessionId: session.sessionId,\r\n        accessToken: session.accessToken,\r\n        refreshToken: session.refreshToken,\r\n        idToken: session.idToken,\r\n        expiresIn: session.expiresIn,\r\n        user: userPayload\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error('SSO login failed:', error);\r\n    res.status(500).json({\r\n      success: false,\r\n      error: 'internal_error',\r\n      message: 'Login failed'\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/sso/logout\r\n * تسجيل الخروج وإنهاء الجلسة\r\n */\r\nrouter.post('/logout', verifySSOToken(), async (req, res, next) => {\r\n  try {\r\n    const sessionId = req.sessionId;\r\n\r\n    await ssoService.endSession(sessionId);\r\n\r\n    logger.info(`User logged out: ${req.user.userId}`);\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'Logged out successfully'\r\n    });\r\n  } catch (error) {\r\n    logger.error('SSO logout failed:', error);\r\n    res.status(500).json({\r\n      success: false,\r\n      error: 'internal_error',\r\n      message: 'Logout failed'\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/sso/logout-all\r\n * تسجيل الخروج من جميع الأجهزة\r\n */\r\nrouter.post('/logout-all', verifySSOToken(), async (req, res, next) => {\r\n  try {\r\n    const userId = req.user.userId;\r\n\r\n    const result = await ssoService.endAllUserSessions(userId);\r\n\r\n    logger.info(`User logged out from all devices: ${userId}`);\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'Logged out from all devices',\r\n      sessionsEnded: result.sessionsEnded\r\n    });\r\n  } catch (error) {\r\n    logger.error('Logout all failed:', error);\r\n    res.status(500).json({\r\n      success: false,\r\n      error: 'internal_error',\r\n      message: 'Logout failed'\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/sso/sessions\r\n * الحصول على جميع جلسات المستخدم النشطة\r\n */\r\nrouter.get('/sessions', verifySSOToken(), async (req, res, next) => {\r\n  try {\r\n    const userId = req.user.userId;\r\n    const sessions = await ssoService.getUserActiveSessions(userId);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: sessions\r\n    });\r\n  } catch (error) {\r\n    logger.error('Failed to fetch sessions:', error);\r\n    res.status(500).json({\r\n      success: false,\r\n      error: 'internal_error',\r\n      message: 'Failed to fetch sessions'\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * DELETE /api/sso/sessions/:sessionId\r\n * إنهاء جلسة محددة\r\n */\r\nrouter.delete('/sessions/:sessionId', verifySSOToken(), async (req, res, next) => {\r\n  try {\r\n    const { sessionId } = req.params;\r\n    const userId = req.user.userId;\r\n\r\n    // Verify user owns this session\r\n    const sessions = await ssoService.getUserActiveSessions(userId);\r\n    const sessionExists = sessions.find(s => s.sessionId === sessionId);\r\n\r\n    if (!sessionExists) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        error: 'not_found',\r\n        message: 'Session not found'\r\n      });\r\n    }\r\n\r\n    await ssoService.endSession(sessionId);\r\n\r\n    logger.info(`Session ended: ${sessionId}`);\r\n\r\n    res.json({\r\n      success: true,\r\n      message: 'Session ended'\r\n    });\r\n  } catch (error) {\r\n    logger.error('Failed to end session:', error);\r\n    res.status(500).json({\r\n      success: false,\r\n      error: 'internal_error',\r\n      message: 'Failed to end session'\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// Token Management Endpoints\r\n// ============================================\r\n\r\n/**\r\n * POST /api/sso/refresh-token\r\n * تحديث Access Token\r\n */\r\nrouter.post('/refresh-token', async (req, res, next) => {\r\n  try {\r\n    const { sessionId, refreshToken } = req.body;\r\n\r\n    if (!sessionId || !refreshToken) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'validation_error',\r\n        message: 'Session ID and refresh token are required'\r\n      });\r\n    }\r\n\r\n    const result = await ssoService.refreshAccessToken(sessionId, refreshToken);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: result\r\n    });\r\n  } catch (error) {\r\n    logger.error('Token refresh failed:', error);\r\n    res.status(401).json({\r\n      success: false,\r\n      error: 'unauthorized',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/sso/verify-token\r\n * التحقق من صحة التوكن\r\n */\r\nrouter.post('/verify-token', async (req, res, next) => {\r\n  try {\r\n    const { token, sessionId } = req.body;\r\n\r\n    if (!token || !sessionId) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'validation_error',\r\n        message: 'Token and session ID are required'\r\n      });\r\n    }\r\n\r\n    const verification = await ssoService.verifySession(sessionId, token);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        valid: verification.valid,\r\n        user: verification.valid ? verification.user : null,\r\n        error: verification.error\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error('Token verification failed:', error);\r\n    res.status(400).json({\r\n      success: false,\r\n      error: 'verification_failed',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/sso/introspect\r\n * فحص التوكن (Token Introspection)\r\n */\r\nrouter.get('/introspect', verifySSOToken(), async (req, res, next) => {\r\n  try {\r\n    const token = req.headers.authorization?.split(' ')[1];\r\n    const introspection = await ssoService.introspectToken(token);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: introspection\r\n    });\r\n  } catch (error) {\r\n    logger.error('Token introspection failed:', error);\r\n    res.status(400).json({\r\n      success: false,\r\n      error: 'introspection_failed',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// OAuth 2.0 Endpoints\r\n// ============================================\r\n\r\n/**\r\n * GET /api/sso/oauth2/authorize\r\n * OAuth 2.0 Authorization endpoint\r\n */\r\nrouter.get('/oauth2/authorize', async (req, res, next) => {\r\n  try {\r\n    const { client_id, redirect_uri, scope, state, response_type, nonce } = req.query;\r\n\r\n    if (!client_id || !redirect_uri || !response_type) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'invalid_request',\r\n        message: 'Missing required OAuth parameters'\r\n      });\r\n    }\r\n\r\n    // For demonstration, redirect to login with oauth params\r\n    const _result = await oAuthService.initiateAuthorizationCodeFlow(\r\n      client_id,\r\n      redirect_uri,\r\n      scope || 'openid profile email',\r\n      state,\r\n      nonce\r\n    );\r\n\r\n    // In production, would redirect to login page\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        authUrl: `${req.baseUrl}/oauth2/login?${new URLSearchParams({\r\n          client_id,\r\n          redirect_uri,\r\n          scope,\r\n          state,\r\n          nonce\r\n        }).toString()}`\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error('OAuth authorization failed:', error);\r\n    res.status(400).json({\r\n      success: false,\r\n      error: 'invalid_request',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/sso/oauth2/token\r\n * OAuth 2.0 Token endpoint\r\n */\r\nrouter.post('/oauth2/token', async (req, res, next) => {\r\n  try {\r\n    const {\r\n      grant_type,\r\n      code,\r\n      client_id,\r\n      client_secret,\r\n      redirect_uri,\r\n      refresh_token,\r\n      username,\r\n      password,\r\n      scope\r\n    } = req.body;\r\n\r\n    if (!grant_type) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'invalid_request',\r\n        message: 'Grant type is required'\r\n      });\r\n    }\r\n\r\n    const tokens = await oAuthService.getTokens(grant_type, {\r\n      code,\r\n      clientId: client_id,\r\n      clientSecret: client_secret,\r\n      redirectUri: redirect_uri,\r\n      refreshToken: refresh_token,\r\n      username,\r\n      password,\r\n      scope\r\n    });\r\n\r\n    res.json({\r\n      success: true,\r\n      data: tokens\r\n    });\r\n  } catch (error) {\r\n    logger.error('OAuth token request failed:', error);\r\n    res.status(400).json({\r\n      success: false,\r\n      error: 'invalid_grant',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/sso/oauth2/userinfo\r\n * OpenID Connect UserInfo endpoint\r\n */\r\nrouter.get('/oauth2/userinfo', verifySSOToken(), async (req, res, next) => {\r\n  try {\r\n    const accessToken = req.headers.authorization?.split(' ')[1];\r\n    const userInfo = await oAuthService.getUserInfo(accessToken);\r\n\r\n    res.json(userInfo);\r\n  } catch (error) {\r\n    logger.error('UserInfo request failed:', error);\r\n    res.status(401).json({\r\n      success: false,\r\n      error: 'invalid_token',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/sso/.well-known/openid-configuration\r\n * OpenID Connect Configuration\r\n */\r\nrouter.get('/.well-known/openid-configuration', (req, res) => {\r\n  const config = oAuthService.getOpenIDConfiguration();\r\n  res.json(config);\r\n});\r\n\r\n/**\r\n * POST /api/sso/oauth2/revoke\r\n * Token revocation endpoint\r\n */\r\nrouter.post('/oauth2/revoke', async (req, res, next) => {\r\n  try {\r\n    const { token, token_type_hint } = req.body;\r\n\r\n    if (!token) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'invalid_request',\r\n        message: 'Token is required'\r\n      });\r\n    }\r\n\r\n    await oAuthService.revokeToken(token, token_type_hint);\r\n\r\n    res.json({ success: true });\r\n  } catch (error) {\r\n    logger.error('Token revocation failed:', error);\r\n    res.status(400).json({\r\n      success: false,\r\n      error: 'invalid_request',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// OpenID Connect Endpoints\r\n// ============================================\r\n\r\n/**\r\n * POST /api/sso/oauth2/register\r\n * Dynamic Client Registration\r\n */\r\nrouter.post('/oauth2/register', async (req, res, next) => {\r\n  try {\r\n    const { client_name, redirect_uris, response_types, grant_types, scopes } = req.body;\r\n\r\n    const { client, clientSecret } = await oAuthService.registerClient({\r\n      clientName: client_name,\r\n      redirectUris: redirect_uris,\r\n      responseTypes: response_types,\r\n      grantTypes: grant_types,\r\n      scopes\r\n    });\r\n\r\n    res.status(201).json({\r\n      success: true,\r\n      data: {\r\n        client_id: client.clientId,\r\n        client_secret: clientSecret,\r\n        client_name: client.clientName,\r\n        redirect_uris: client.redirectUris,\r\n        response_types: client.responseTypes,\r\n        grant_types: client.grantTypes,\r\n        registration_access_token: 'registration_token', // Would be generated\r\n        registration_client_uri: `${req.baseUrl}/oauth2/register/${client.clientId}`\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error('Client registration failed:', error);\r\n    res.status(400).json({\r\n      success: false,\r\n      error: 'invalid_request',\r\n      message: error.message\r\n    });\r\n  }\r\n});\r\n\r\n// ============================================\r\n// Session Management Endpoints\r\n// ============================================\r\n\r\n/**\r\n * GET /api/sso/me\r\n * الحصول على معلومات المستخدم الحالي\r\n */\r\nrouter.get('/me', verifySSOToken(), (req, res) => {\r\n  res.json({\r\n    success: true,\r\n    data: req.user\r\n  });\r\n});\r\n\r\n/**\r\n * PUT /api/sso/me\r\n * تحديث معلومات المستخدم\r\n */\r\nrouter.put('/me', verifySSOToken(), async (req, res, next) => {\r\n  try {\r\n    const { metadata } = req.body;\r\n    const sessionId = req.sessionId;\r\n\r\n    const updatedSession = await ssoService.updateSessionMetadata(sessionId, metadata);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: updatedSession\r\n    });\r\n  } catch (error) {\r\n    logger.error('Failed to update user:', error);\r\n    res.status(500).json({\r\n      success: false,\r\n      error: 'internal_error',\r\n      message: 'Failed to update user'\r\n    });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAMC,UAAU,GAAGH,OAAO,CAAC,yBAAyB,CAAC;AACrD,MAAMI,YAAY,GAAGJ,OAAO,CAAC,2BAA2B,CAAC;AACzD,MAAM;EACJK,cAAc;EACdC,YAAY;EACZC,kBAAkB;EAClBC,kBAAkB;EAClBC;AACF,CAAC,GAAGT,OAAO,CAAC,mCAAmC,CAAC;AAChD,MAAMU,MAAM,GAAGV,OAAO,CAAC,iBAAiB,CAAC;AAEzCW,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;AAEjD,MAAMC,UAAU,GAAG,IAAIV,UAAU,CAAC,CAAC;AACnC,MAAMW,YAAY,GAAG,IAAIV,YAAY,CAAC,CAAC;AAEvCO,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC;;AAEtD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACAX,MAAM,CAACc,GAAG,CAAC,SAAS,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EACxCN,OAAO,CAACC,GAAG,CAAC,qCAAqC,CAAC;EAClD,IAAI;IACFK,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACbC,MAAM,EAAE,aAAa;MACrBC,OAAO,EAAE,2BAA2B;MACpCC,QAAQ,EAAE;QACRC,QAAQ,EAAE,IAAI;QACdC,MAAM,EAAE,IAAI;QACZC,cAAc,EAAE,IAAI;QACpBC,GAAG,EAAE,IAAI;QACTC,aAAa,EAAE;MACjB,CAAC;MACDC,SAAS,EAAE;QACTC,KAAK,EAAE,gBAAgB;QACvBC,MAAM,EAAE,iBAAiB;QACzBN,MAAM,EAAE,iBAAiB;QACzBO,QAAQ,EAAE;MACZ;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAC/Cf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACdC,MAAM,EAAE,OAAO;MACfC,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACApB,MAAM,CAACgC,IAAI,CAAC,QAAQ,EAAE,OAAOjB,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EAC9CvB,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;EACjDD,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEI,GAAG,CAACmB,IAAI,CAAC;EAE5C,IAAI;IACF,MAAM;MAAEC,KAAK;MAAEC,QAAQ;MAAEC,QAAQ;MAAEC;IAAU,CAAC,GAAGvB,GAAG,CAACmB,IAAI;;IAEzD;IACA,IAAI,CAACC,KAAK,IAAI,CAACC,QAAQ,EAAE;MACvB,OAAOpB,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACda,KAAK,EAAE,kBAAkB;QACzBX,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;;IAEA;IACA;IACA,MAAMmB,WAAW,GAAG;MAClBC,MAAM,EAAE,UAAU;MAClBL,KAAK;MACLM,IAAI,EAAE,MAAM;MACZC,WAAW,EAAE,CAAC,MAAM,CAAC;MACrBC,cAAc,EAAE;IAClB,CAAC;;IAED;IACA,MAAMC,OAAO,GAAG,MAAMhC,UAAU,CAACiC,aAAa,CAACN,WAAW,CAACC,MAAM,EAAED,WAAW,EAAE;MAC9EF,QAAQ,EAAEA,QAAQ,IAAI,SAAS;MAC/BC,SAAS,EAAEA,SAAS,IAAIvB,GAAG,CAACD,GAAG,CAAC,YAAY,CAAC;MAC7CgC,SAAS,EAAE/B,GAAG,CAACgC;IACjB,CAAC,CAAC;;IAEF;IACAtC,MAAM,CAACuC,IAAI,CAAC,2BAA2BT,WAAW,CAACC,MAAM,EAAE,CAAC;IAE5DxB,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAE;QACJC,SAAS,EAAEN,OAAO,CAACM,SAAS;QAC5BC,WAAW,EAAEP,OAAO,CAACO,WAAW;QAChCC,YAAY,EAAER,OAAO,CAACQ,YAAY;QAClCC,OAAO,EAAET,OAAO,CAACS,OAAO;QACxBC,SAAS,EAAEV,OAAO,CAACU,SAAS;QAC5BC,IAAI,EAAEhB;MACR;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOR,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,mBAAmB,EAAEA,KAAK,CAAC;IACxCf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,gBAAgB;MACvBX,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACgC,IAAI,CAAC,SAAS,EAAE5B,cAAc,CAAC,CAAC,EAAE,OAAOW,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACjE,IAAI;IACF,MAAMiB,SAAS,GAAGnC,GAAG,CAACmC,SAAS;IAE/B,MAAMtC,UAAU,CAAC4C,UAAU,CAACN,SAAS,CAAC;IAEtCzC,MAAM,CAACuC,IAAI,CAAC,oBAAoBjC,GAAG,CAACwC,IAAI,CAACf,MAAM,EAAE,CAAC;IAElDxB,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACbE,OAAO,EAAE;IACX,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOW,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;IACzCf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,gBAAgB;MACvBX,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACgC,IAAI,CAAC,aAAa,EAAE5B,cAAc,CAAC,CAAC,EAAE,OAAOW,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACrE,IAAI;IACF,MAAMO,MAAM,GAAGzB,GAAG,CAACwC,IAAI,CAACf,MAAM;IAE9B,MAAMiB,MAAM,GAAG,MAAM7C,UAAU,CAAC8C,kBAAkB,CAAClB,MAAM,CAAC;IAE1D/B,MAAM,CAACuC,IAAI,CAAC,qCAAqCR,MAAM,EAAE,CAAC;IAE1DxB,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACbE,OAAO,EAAE,6BAA6B;MACtCuC,aAAa,EAAEF,MAAM,CAACE;IACxB,CAAC,CAAC;EACJ,CAAC,CAAC,OAAO5B,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,oBAAoB,EAAEA,KAAK,CAAC;IACzCf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,gBAAgB;MACvBX,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACc,GAAG,CAAC,WAAW,EAAEV,cAAc,CAAC,CAAC,EAAE,OAAOW,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EAClE,IAAI;IACF,MAAMO,MAAM,GAAGzB,GAAG,CAACwC,IAAI,CAACf,MAAM;IAC9B,MAAMlB,QAAQ,GAAG,MAAMV,UAAU,CAACgD,qBAAqB,CAACpB,MAAM,CAAC;IAE/DxB,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAE3B;IACR,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOS,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;IAChDf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,gBAAgB;MACvBX,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAAC6D,MAAM,CAAC,sBAAsB,EAAEzD,cAAc,CAAC,CAAC,EAAE,OAAOW,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EAChF,IAAI;IACF,MAAM;MAAEiB;IAAU,CAAC,GAAGnC,GAAG,CAAC+C,MAAM;IAChC,MAAMtB,MAAM,GAAGzB,GAAG,CAACwC,IAAI,CAACf,MAAM;;IAE9B;IACA,MAAMlB,QAAQ,GAAG,MAAMV,UAAU,CAACgD,qBAAqB,CAACpB,MAAM,CAAC;IAC/D,MAAMuB,aAAa,GAAGzC,QAAQ,CAAC0C,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACf,SAAS,KAAKA,SAAS,CAAC;IAEnE,IAAI,CAACa,aAAa,EAAE;MAClB,OAAO/C,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACda,KAAK,EAAE,WAAW;QAClBX,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IAEA,MAAMR,UAAU,CAAC4C,UAAU,CAACN,SAAS,CAAC;IAEtCzC,MAAM,CAACuC,IAAI,CAAC,kBAAkBE,SAAS,EAAE,CAAC;IAE1ClC,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACbE,OAAO,EAAE;IACX,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOW,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;IAC7Cf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,gBAAgB;MACvBX,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACApB,MAAM,CAACgC,IAAI,CAAC,gBAAgB,EAAE,OAAOjB,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACtD,IAAI;IACF,MAAM;MAAEiB,SAAS;MAAEE;IAAa,CAAC,GAAGrC,GAAG,CAACmB,IAAI;IAE5C,IAAI,CAACgB,SAAS,IAAI,CAACE,YAAY,EAAE;MAC/B,OAAOpC,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACda,KAAK,EAAE,kBAAkB;QACzBX,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IAEA,MAAMqC,MAAM,GAAG,MAAM7C,UAAU,CAACsD,kBAAkB,CAAChB,SAAS,EAAEE,YAAY,CAAC;IAE3EpC,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAEQ;IACR,CAAC,CAAC;EACJ,CAAC,CAAC,OAAO1B,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;IAC5Cf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,cAAc;MACrBX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACgC,IAAI,CAAC,eAAe,EAAE,OAAOjB,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACrD,IAAI;IACF,MAAM;MAAEkC,KAAK;MAAEjB;IAAU,CAAC,GAAGnC,GAAG,CAACmB,IAAI;IAErC,IAAI,CAACiC,KAAK,IAAI,CAACjB,SAAS,EAAE;MACxB,OAAOlC,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACda,KAAK,EAAE,kBAAkB;QACzBX,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IAEA,MAAMgD,YAAY,GAAG,MAAMxD,UAAU,CAACyD,aAAa,CAACnB,SAAS,EAAEiB,KAAK,CAAC;IAErEnD,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAE;QACJqB,KAAK,EAAEF,YAAY,CAACE,KAAK;QACzBf,IAAI,EAAEa,YAAY,CAACE,KAAK,GAAGF,YAAY,CAACb,IAAI,GAAG,IAAI;QACnDxB,KAAK,EAAEqC,YAAY,CAACrC;MACtB;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOA,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;IACjDf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,qBAAqB;MAC5BX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACc,GAAG,CAAC,aAAa,EAAEV,cAAc,CAAC,CAAC,EAAE,OAAOW,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACpE,IAAI;IACF,MAAMkC,KAAK,GAAGpD,GAAG,CAACwD,OAAO,CAACC,aAAa,EAAEC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACtD,MAAMC,aAAa,GAAG,MAAM9D,UAAU,CAAC+D,eAAe,CAACR,KAAK,CAAC;IAE7DnD,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAEyB;IACR,CAAC,CAAC;EACJ,CAAC,CAAC,OAAO3C,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IAClDf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,sBAAsB;MAC7BX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACApB,MAAM,CAACc,GAAG,CAAC,mBAAmB,EAAE,OAAOC,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACxD,IAAI;IACF,MAAM;MAAE2C,SAAS;MAAEC,YAAY;MAAEC,KAAK;MAAEC,KAAK;MAAEC,aAAa;MAAEC;IAAM,CAAC,GAAGlE,GAAG,CAACmE,KAAK;IAEjF,IAAI,CAACN,SAAS,IAAI,CAACC,YAAY,IAAI,CAACG,aAAa,EAAE;MACjD,OAAOhE,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACda,KAAK,EAAE,iBAAiB;QACxBX,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;;IAEA;IACA,MAAM+D,OAAO,GAAG,MAAMtE,YAAY,CAACuE,6BAA6B,CAC9DR,SAAS,EACTC,YAAY,EACZC,KAAK,IAAI,sBAAsB,EAC/BC,KAAK,EACLE,KACF,CAAC;;IAED;IACAjE,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAE;QACJoC,OAAO,EAAE,GAAGtE,GAAG,CAACuE,OAAO,iBAAiB,IAAIC,eAAe,CAAC;UAC1DX,SAAS;UACTC,YAAY;UACZC,KAAK;UACLC,KAAK;UACLE;QACF,CAAC,CAAC,CAACO,QAAQ,CAAC,CAAC;MACf;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOzD,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IAClDf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,iBAAiB;MACxBX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACgC,IAAI,CAAC,eAAe,EAAE,OAAOjB,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACrD,IAAI;IACF,MAAM;MACJwD,UAAU;MACVC,IAAI;MACJd,SAAS;MACTe,aAAa;MACbd,YAAY;MACZe,aAAa;MACbC,QAAQ;MACRzD,QAAQ;MACR0C;IACF,CAAC,GAAG/D,GAAG,CAACmB,IAAI;IAEZ,IAAI,CAACuD,UAAU,EAAE;MACf,OAAOzE,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACda,KAAK,EAAE,iBAAiB;QACxBX,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IAEA,MAAM0E,MAAM,GAAG,MAAMjF,YAAY,CAACkF,SAAS,CAACN,UAAU,EAAE;MACtDC,IAAI;MACJM,QAAQ,EAAEpB,SAAS;MACnBqB,YAAY,EAAEN,aAAa;MAC3BO,WAAW,EAAErB,YAAY;MACzBzB,YAAY,EAAEwC,aAAa;MAC3BC,QAAQ;MACRzD,QAAQ;MACR0C;IACF,CAAC,CAAC;IAEF9D,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAE6C;IACR,CAAC,CAAC;EACJ,CAAC,CAAC,OAAO/D,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IAClDf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,eAAe;MACtBX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACc,GAAG,CAAC,kBAAkB,EAAEV,cAAc,CAAC,CAAC,EAAE,OAAOW,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACzE,IAAI;IACF,MAAMkB,WAAW,GAAGpC,GAAG,CAACwD,OAAO,CAACC,aAAa,EAAEC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IAC5D,MAAM0B,QAAQ,GAAG,MAAMtF,YAAY,CAACuF,WAAW,CAACjD,WAAW,CAAC;IAE5DnC,GAAG,CAACC,IAAI,CAACkF,QAAQ,CAAC;EACpB,CAAC,CAAC,OAAOpE,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAC/Cf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,eAAe;MACtBX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACApB,MAAM,CAACc,GAAG,CAAC,mCAAmC,EAAE,CAACC,GAAG,EAAEC,GAAG,KAAK;EAC5D,MAAMqF,MAAM,GAAGxF,YAAY,CAACyF,sBAAsB,CAAC,CAAC;EACpDtF,GAAG,CAACC,IAAI,CAACoF,MAAM,CAAC;AAClB,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACArG,MAAM,CAACgC,IAAI,CAAC,gBAAgB,EAAE,OAAOjB,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACtD,IAAI;IACF,MAAM;MAAEkC,KAAK;MAAEoC;IAAgB,CAAC,GAAGxF,GAAG,CAACmB,IAAI;IAE3C,IAAI,CAACiC,KAAK,EAAE;MACV,OAAOnD,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACda,KAAK,EAAE,iBAAiB;QACxBX,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IAEA,MAAMP,YAAY,CAAC2F,WAAW,CAACrC,KAAK,EAAEoC,eAAe,CAAC;IAEtDvF,GAAG,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE;IAAK,CAAC,CAAC;EAC7B,CAAC,CAAC,OAAOa,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAC/Cf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,iBAAiB;MACxBX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACApB,MAAM,CAACgC,IAAI,CAAC,kBAAkB,EAAE,OAAOjB,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EACxD,IAAI;IACF,MAAM;MAAEwE,WAAW;MAAEC,aAAa;MAAEC,cAAc;MAAEC,WAAW;MAAEC;IAAO,CAAC,GAAG9F,GAAG,CAACmB,IAAI;IAEpF,MAAM;MAAE4E,MAAM;MAAEb;IAAa,CAAC,GAAG,MAAMpF,YAAY,CAACkG,cAAc,CAAC;MACjEC,UAAU,EAAEP,WAAW;MACvBQ,YAAY,EAAEP,aAAa;MAC3BQ,aAAa,EAAEP,cAAc;MAC7BQ,UAAU,EAAEP,WAAW;MACvBC;IACF,CAAC,CAAC;IAEF7F,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAE;QACJ2B,SAAS,EAAEkC,MAAM,CAACd,QAAQ;QAC1BL,aAAa,EAAEM,YAAY;QAC3BQ,WAAW,EAAEK,MAAM,CAACE,UAAU;QAC9BN,aAAa,EAAEI,MAAM,CAACG,YAAY;QAClCN,cAAc,EAAEG,MAAM,CAACI,aAAa;QACpCN,WAAW,EAAEE,MAAM,CAACK,UAAU;QAC9BC,yBAAyB,EAAE,oBAAoB;QAAE;QACjDC,uBAAuB,EAAE,GAAGtG,GAAG,CAACuE,OAAO,oBAAoBwB,MAAM,CAACd,QAAQ;MAC5E;IACF,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOjE,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IAClDf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,iBAAiB;MACxBX,OAAO,EAAEW,KAAK,CAACX;IACjB,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACApB,MAAM,CAACc,GAAG,CAAC,KAAK,EAAEV,cAAc,CAAC,CAAC,EAAE,CAACW,GAAG,EAAEC,GAAG,KAAK;EAChDA,GAAG,CAACC,IAAI,CAAC;IACPC,OAAO,EAAE,IAAI;IACb+B,IAAI,EAAElC,GAAG,CAACwC;EACZ,CAAC,CAAC;AACJ,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACAvD,MAAM,CAACsH,GAAG,CAAC,KAAK,EAAElH,cAAc,CAAC,CAAC,EAAE,OAAOW,GAAG,EAAEC,GAAG,EAAEiB,IAAI,KAAK;EAC5D,IAAI;IACF,MAAM;MAAEsF;IAAS,CAAC,GAAGxG,GAAG,CAACmB,IAAI;IAC7B,MAAMgB,SAAS,GAAGnC,GAAG,CAACmC,SAAS;IAE/B,MAAMsE,cAAc,GAAG,MAAM5G,UAAU,CAAC6G,qBAAqB,CAACvE,SAAS,EAAEqE,QAAQ,CAAC;IAElFvG,GAAG,CAACC,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+B,IAAI,EAAEuE;IACR,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOzF,KAAK,EAAE;IACdtB,MAAM,CAACsB,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;IAC7Cf,GAAG,CAACG,MAAM,CAAC,GAAG,CAAC,CAACF,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACda,KAAK,EAAE,gBAAgB;MACvBX,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;AAEFsG,MAAM,CAACC,OAAO,GAAG3H,MAAM","ignoreList":[]}