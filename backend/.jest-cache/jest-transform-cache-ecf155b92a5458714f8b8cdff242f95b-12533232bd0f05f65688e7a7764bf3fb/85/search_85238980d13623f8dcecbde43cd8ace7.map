{"version":3,"names":["express","require","router","Router","searchEngine","responseFormatter","optionalAuth","sampleData","_id","name","description","category","rating","indexInitialized","initializeIndex","buildIndex","get","req","res","query","collection","limit","status","json","validationError","results","fullTextSearch","parseInt","searchResults","length","error","serverError","maxDistance","fuzzySearch","post","filters","offset","sortBy","sortOrder","body","result","advancedSearch","paginated","total","Math","floor","suggestions","getSuggestions","success","stats","getStats","analytics","clearCache","module","exports"],"sources":["search.js"],"sourcesContent":["/**\n * Search Routes\n * Full-text search, fuzzy search, and advanced search operations\n * Phase 10: Advanced Features\n */\n\nconst express = require('express');\nconst router = express.Router();\nconst searchEngine = require('../services/searchEngine');\nconst responseFormatter = require('../services/responseFormatter');\nconst { optionalAuth } = require('../middleware/auth');\n\n// Sample data for search\nconst sampleData = [\n  {\n    _id: '1',\n    name: 'Accounting System',\n    description: 'Complete accounting and financial management system with reports',\n    category: 'finance',\n    rating: 4.5,\n  },\n  {\n    _id: '2',\n    name: 'HR Management',\n    description: 'Human resources and employee management solution',\n    category: 'hr',\n    rating: 4.8,\n  },\n  {\n    _id: '3',\n    name: 'Inventory Control',\n    description: 'Inventory tracking and warehouse management system',\n    category: 'supply',\n    rating: 4.2,\n  },\n  {\n    _id: '4',\n    name: 'Customer Relationship',\n    description: 'CRM system for managing customer relationships and sales',\n    category: 'sales',\n    rating: 4.6,\n  },\n  {\n    _id: '5',\n    name: 'Project Management',\n    description: 'Project planning and team collaboration platform',\n    category: 'operations',\n    rating: 4.7,\n  },\n];\n\n// Initialize search index\nlet indexInitialized = false;\n\nconst initializeIndex = () => {\n  if (!indexInitialized) {\n    searchEngine.buildIndex('systems', sampleData, ['name', 'description']);\n    indexInitialized = true;\n  }\n};\n\n/**\n * GET /api/search/full-text\n * Full-text search\n */\nrouter.get('/full-text', optionalAuth, (req, res) => {\n  try {\n    const { query, collection = 'systems', limit = 20 } = req.query;\n\n    if (!query) {\n      return res.status(400).json(responseFormatter.validationError('Query parameter is required'));\n    }\n\n    initializeIndex();\n\n    const results = searchEngine.fullTextSearch(query, collection, parseInt(limit));\n\n    res.json(\n      responseFormatter.searchResults(results, query, results.length, 'Full-text search completed')\n    );\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Search failed', error));\n  }\n});\n\n/**\n * GET /api/search/fuzzy\n * Fuzzy search with tolerance\n */\nrouter.get('/fuzzy', optionalAuth, (req, res) => {\n  try {\n    const { query, collection = 'systems', maxDistance = 2 } = req.query;\n\n    if (!query) {\n      return res.status(400).json(responseFormatter.validationError('Query parameter is required'));\n    }\n\n    initializeIndex();\n\n    const results = searchEngine.fuzzySearch(query, collection, parseInt(maxDistance));\n\n    res.json(\n      responseFormatter.searchResults(results, query, results.length, 'Fuzzy search completed')\n    );\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Fuzzy search failed', error));\n  }\n});\n\n/**\n * POST /api/search/advanced\n * Advanced search with filters\n */\nrouter.post('/advanced', optionalAuth, (req, res) => {\n  try {\n    const {\n      query,\n      collection = 'systems',\n      filters = {},\n      limit = 20,\n      offset = 0,\n      sortBy = 'relevance',\n      sortOrder = 'desc',\n    } = req.body;\n\n    if (!query) {\n      return res.status(400).json(responseFormatter.validationError('Query is required'));\n    }\n\n    initializeIndex();\n\n    const result = searchEngine.advancedSearch(query, collection, filters, {\n      limit,\n      offset,\n      sortBy,\n      sortOrder,\n    });\n\n    res.json(\n      responseFormatter.paginated(\n        result.results,\n        result.total,\n        Math.floor(offset / limit) + 1,\n        limit,\n        'Advanced search completed'\n      )\n    );\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Advanced search failed', error));\n  }\n});\n\n/**\n * GET /api/search/suggestions\n * Get search suggestions\n */\nrouter.get('/suggestions', optionalAuth, (req, res) => {\n  try {\n    const { query, collection = 'systems', limit = 10 } = req.query;\n\n    if (!query) {\n      return res.status(400).json(responseFormatter.validationError('Query parameter is required'));\n    }\n\n    initializeIndex();\n\n    const suggestions = searchEngine.getSuggestions(query, collection, parseInt(limit));\n\n    res.json(responseFormatter.success(suggestions, 'Suggestions retrieved'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Suggestions failed', error));\n  }\n});\n\n/**\n * GET /api/search/stats\n * Get search engine statistics\n */\nrouter.get('/stats', optionalAuth, (req, res) => {\n  try {\n    initializeIndex();\n    const stats = searchEngine.getStats();\n\n    res.json(responseFormatter.analytics(stats, 'current', 'Search engine statistics'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Stats retrieval failed', error));\n  }\n});\n\n/**\n * POST /api/search/cache/clear\n * Clear search cache\n */\nrouter.post('/cache/clear', optionalAuth, (req, res) => {\n  try {\n    searchEngine.clearCache();\n\n    res.json(responseFormatter.success(null, 'Search cache cleared'));\n  } catch (error) {\n    res.status(500).json(responseFormatter.serverError('Cache clear failed', error));\n  }\n});\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]}