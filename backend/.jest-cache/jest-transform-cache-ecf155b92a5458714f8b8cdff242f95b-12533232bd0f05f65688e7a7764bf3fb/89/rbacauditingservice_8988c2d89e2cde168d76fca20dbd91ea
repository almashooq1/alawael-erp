cfece338d56857324c4048e11bcb86dc
/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ðŸ“‹ RBAC Auditing Service - Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * ÙŠÙˆÙØ± Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ Ù…Ø¹:
 * âœ… ØªØªØ¨Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
 * âœ… ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø©
 * âœ… ÙƒØ´Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©
 * âœ… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠØ§Øª
 */

class RBACAuditingService {
  constructor(config = {}) {
    this.auditLog = [];
    this.securityIncidents = [];
    this.complianceReports = [];
    this.accessPatterns = new Map();
    this.config = {
      maxLogSize: config.maxLogSize || 100000,
      retentionDays: config.retentionDays || 90,
      encryptLogs: config.encryptLogs || false,
      alertingEnabled: config.alertingEnabled || true,
      ...config
    };
    this.startCleanupTimer();
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 1ï¸âƒ£ AUDIT LOG MANAGEMENT - Ø¥Ø¯Ø§Ø±Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« ØªØ¯Ù‚ÙŠÙ‚
   */
  logAuditEvent(eventData) {
    const auditEntry = {
      id: this._generateId(),
      timestamp: new Date(),
      eventType: eventData.eventType,
      userId: eventData.userId,
      actor: eventData.actor || 'system',
      // Action Details
      action: eventData.action,
      resource: eventData.resource,
      resourceId: eventData.resourceId,
      // Status
      status: eventData.status || 'success',
      // success, failure, partial
      statusCode: eventData.statusCode || 200,
      // Change Details
      before: eventData.before || {},
      after: eventData.after || {},
      changes: eventData.changes || [],
      // Context
      ipAddress: eventData.ipAddress,
      userAgent: eventData.userAgent,
      sessionId: eventData.sessionId,
      correlationId: eventData.correlationId,
      // Metadata
      metadata: eventData.metadata || {},
      severity: eventData.severity || this._calculateSeverity(eventData.eventType),
      tags: eventData.tags || []
    };
    this.auditLog.push(auditEntry);

    // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø­Ø¯ Ø£Ù‚ØµÙ‰
    if (this.auditLog.length > this.config.maxLogSize) {
      this.auditLog = this.auditLog.slice(-this.config.maxLogSize);
    }

    // ÙØ­Øµ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©
    this._analyzeForIncidents(auditEntry);
    return auditEntry;
  }

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ù…Ø¹ Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø«
   */
  queryAuditLog(query = {}) {
    let results = this.auditLog;

    // Handle filters object if provided
    const filters = query.filters || query;

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    if (filters.eventType) {
      results = results.filter(e => Array.isArray(filters.eventType) ? filters.eventType.includes(e.eventType) : e.eventType === filters.eventType);
    }

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if (filters.userId) {
      results = results.filter(e => e.userId === filters.userId);
    }

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
    if (filters.action) {
      results = results.filter(e => e.action === filters.action);
    }

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯
    if (filters.resource) {
      results = results.filter(e => e.resource === filters.resource);
    }

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
    if (filters.status) {
      results = results.filter(e => e.status === filters.status);
    }

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø´Ø¯Ø© Ø§Ù„Ø­Ø¯Ø«
    if (filters.severity) {
      results = results.filter(e => e.severity === filters.severity);
    }

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ
    if (filters.startDate) {
      results = results.filter(e => e.timestamp >= filters.startDate);
    }
    if (filters.endDate) {
      results = results.filter(e => e.timestamp <= filters.endDate);
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ
    if (filters.search) {
      const searchLower = filters.search.toLowerCase();
      results = results.filter(e => e.action?.toLowerCase().includes(searchLower) || e.resource?.toLowerCase().includes(searchLower) || e.userId?.toLowerCase().includes(searchLower));
    }

    // Ø§Ù„ØªØ±ØªÙŠØ¨
    const sort = (a, b) => {
      if (filters.sortBy === 'timestamp') {
        return filters.sortOrder === 'asc' ? a.timestamp - b.timestamp : b.timestamp - a.timestamp;
      }
      return 0;
    };
    results = results.sort(sort);

    // Ø§Ù„Ø­Ø¯ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    if (filters.limit || query.limit) {
      results = results.slice(0, filters.limit || query.limit);
    }
    if (filters.offset || query.offset) {
      results = results.slice(filters.offset || query.offset);
    }
    return {
      total: this.auditLog.length,
      returned: results.length,
      results
    };
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 2ï¸âƒ£ INCIDENT DETECTION - ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„ÙƒØ´Ù Ø§Ù„Ø­ÙˆØ§Ø¯Ø«
   */
  _analyzeForIncidents(auditEntry) {
    const incidents = [];

    // ÙƒØ´Ù Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© Ø§Ù„ÙØ§Ø´Ù„Ø©
    if (auditEntry.status === 'failure') {
      const failedAttempts = this.auditLog.filter(e => e.userId === auditEntry.userId && e.action === auditEntry.action && e.status === 'failure' && e.timestamp > new Date(Date.now() - 3600000) // Ø¢Ø®Ø± Ø³Ø§Ø¹Ø©
      );
      if (failedAttempts.length >= 5) {
        incidents.push({
          type: 'BRUTE_FORCE_ATTEMPT',
          severity: 'high',
          userId: auditEntry.userId,
          action: auditEntry.action,
          attemptCount: failedAttempts.length,
          timestamp: new Date()
        });
      }
    }

    // ÙƒØ´Ù Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…Ø¹ØªØ§Ø¯
    if (!this._isNormalAccessPattern(auditEntry)) {
      incidents.push({
        type: 'ABNORMAL_ACCESS_PATTERN',
        severity: 'medium',
        userId: auditEntry.userId,
        timestamp: new Date(),
        details: {
          action: auditEntry.action,
          resource: auditEntry.resource,
          time: auditEntry.timestamp
        }
      });
    }

    // ÙƒØ´Ù Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…
    if (auditEntry.eventType === 'ROLE_DELETED' || auditEntry.eventType === 'PERMISSION_REVOKED') {
      incidents.push({
        type: 'SENSITIVE_OPERATION',
        severity: 'high',
        userId: auditEntry.userId,
        actor: auditEntry.actor,
        action: auditEntry.action,
        timestamp: new Date()
      });
    }

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…ÙƒØªØ´ÙØ©
    for (const incident of incidents) {
      this.reportSecurityIncident(incident);
    }
  }

  /**
   * ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ø¯Ø«Ø© Ø£Ù…Ù†ÙŠØ©
   */
  reportSecurityIncident(incident) {
    const report = {
      id: this._generateId(),
      ...incident,
      reportedAt: new Date(),
      status: 'open',
      // open, investigating, resolved, closed
      notes: []
    };
    this.securityIncidents.push(report);

    // ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
    if (this.config.alertingEnabled) {
      this._triggerAlert(report);
    }
    return report;
  }

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©
   */
  getSecurityIncidents(filters = {}) {
    let incidents = this.securityIncidents;
    if (filters.status) {
      incidents = incidents.filter(i => i.status === filters.status);
    }
    if (filters.severity) {
      incidents = incidents.filter(i => i.severity === filters.severity);
    }
    if (filters.type) {
      incidents = incidents.filter(i => i.type === filters.type);
    }
    return incidents.sort((a, b) => b.reportedAt - a.reportedAt);
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 3ï¸âƒ£ REPORTING - Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
   */
  generateAuditReport(reportConfig = {}) {
    const startDate = reportConfig.startDate || new Date(Date.now() - 2592000000); // 30 days
    const endDate = reportConfig.endDate || new Date();
    const relevantLogs = this.auditLog.filter(e => e.timestamp >= startDate && e.timestamp <= endDate);
    const report = {
      id: this._generateId(),
      generatedAt: new Date(),
      period: {
        startDate,
        endDate
      },
      // Summary Statistics
      summary: {
        totalEvents: relevantLogs.length,
        successfulActions: relevantLogs.filter(e => e.status === 'success').length,
        failedActions: relevantLogs.filter(e => e.status === 'failure').length,
        uniqueUsers: new Set(relevantLogs.map(e => e.userId)).size,
        avgEventsPerDay: Math.round(relevantLogs.length / 30)
      },
      // Event Distribution
      eventDistribution: this._calculateEventDistribution(relevantLogs),
      userActivity: this._calculateUserActivity(relevantLogs),
      resourceActivity: this._calculateResourceActivity(relevantLogs),
      // Changes Summary
      changesSummary: {
        rolesCreated: relevantLogs.filter(e => e.eventType === 'ROLE_CREATED').length,
        rolesModified: relevantLogs.filter(e => e.eventType === 'ROLE_UPDATED').length,
        rolesDeleted: relevantLogs.filter(e => e.eventType === 'ROLE_DELETED').length,
        permissionsChanged: relevantLogs.filter(e => e.eventType === 'PERMISSION_CHANGED').length
      },
      // Security Summary
      securitySummary: {
        totalIncidents: this.securityIncidents.filter(i => i.reportedAt >= startDate && i.reportedAt <= endDate).length,
        highSeverityIncidents: this.securityIncidents.filter(i => i.severity === 'high' && i.reportedAt >= startDate && i.reportedAt <= endDate).length
      },
      // Recommendations
      recommendations: this._generateRecommendations(relevantLogs)
    };
    this.complianceReports.push(report);
    return report;
  }

  /**
   * ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„
   */
  generateComplianceReport() {
    const report = {
      id: this._generateId(),
      generatedAt: new Date(),
      timestamp: new Date(),
      // Compliance Checks
      checks: {
        auditLoggingEnabled: true,
        accessControlImplemented: true,
        roleHierarchyDefined: true,
        permissionAssignmentDocumented: true,
        incidentResponseProcedureInPlace: true
      },
      // Risk Assessment
      riskAssessment: {
        overallRisk: 'medium',
        highRiskAreas: [],
        recommendations: []
      },
      // Certifications
      certifications: {
        SOC2: 'compliant',
        HIPAA: 'partial',
        GDPR: 'compliant'
      }
    };
    return report;
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * 4ï¸âƒ£ PATTERN ANALYSIS - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø·
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * ØªØ³Ø¬ÙŠÙ„ Ù†Ù…Ø· Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
   */
  recordNormalPattern(userId, action, context = {}) {
    const key = `${userId}:${action}`;
    if (!this.accessPatterns.has(key)) {
      this.accessPatterns.set(key, {
        occurrences: 0,
        times: [],
        locations: [],
        devices: []
      });
    }
    const pattern = this.accessPatterns.get(key);
    pattern.occurrences++;
    pattern.times.push(new Date().getHours());
    if (context.location) pattern.locations.push(context.location);
    if (context.device) pattern.devices.push(context.device);

    // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ 100 Ø­Ø¯Ø« ÙÙ‚Ø·
    if (pattern.times.length > 100) {
      pattern.times.shift();
      pattern.locations.shift();
      pattern.devices.shift();
    }
  }

  /**
   * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù…Ø· Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
   */
  _isNormalAccessPattern(auditEntry) {
    const key = `${auditEntry.userId}:${auditEntry.action}`;
    const pattern = this.accessPatterns.get(key);
    if (!pattern || pattern.occurrences < 5) {
      return true; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø©
    const currentHour = new Date().getHours();
    const avgHour = Math.round(pattern.times.reduce((a, b) => a + b, 0) / pattern.times.length);

    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆØµÙˆÙ„ ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø¬Ø¯Ø§Ù‹ØŒ Ù‚Ø¯ ÙŠÙƒÙˆÙ† ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ
    if (Math.abs(currentHour - avgHour) > 6) {
      return false;
    }
    return true;
  }

  /**
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   * PRIVATE METHODS - Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ø®Ø§ØµØ©
   * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   */

  /**
   * Ø­Ø³Ø§Ø¨ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
   */
  _calculateEventDistribution(logs) {
    const distribution = {};
    logs.forEach(log => {
      distribution[log.eventType] = (distribution[log.eventType] || 0) + 1;
    });
    return distribution;
  }

  /**
   * Ø­Ø³Ø§Ø¨ Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
   */
  _calculateUserActivity(logs) {
    const activity = {};
    logs.forEach(log => {
      if (!activity[log.userId]) {
        activity[log.userId] = {
          totalActions: 0,
          successfulActions: 0,
          failedActions: 0,
          actions: []
        };
      }
      activity[log.userId].totalActions++;
      if (log.status === 'success') activity[log.userId].successfulActions++;
      if (log.status === 'failure') activity[log.userId].failedActions++;
      if (!activity[log.userId].actions.includes(log.action)) {
        activity[log.userId].actions.push(log.action);
      }
    });
    return activity;
  }

  /**
   * Ø­Ø³Ø§Ø¨ Ù†Ø´Ø§Ø· Ø§Ù„Ù…ÙˆØ±Ø¯
   */
  _calculateResourceActivity(logs) {
    const activity = {};
    logs.forEach(log => {
      if (!activity[log.resource]) {
        activity[log.resource] = {
          accesses: 0,
          modifications: 0,
          deletions: 0,
          users: new Set()
        };
      }
      activity[log.resource].accesses++;
      if (log.action === 'DELETE') activity[log.resource].deletions++;
      if (log.action === 'UPDATE') activity[log.resource].modifications++;
      activity[log.resource].users.add(log.userId);
    });

    // ØªØ­ÙˆÙŠÙ„ Sets Ø¥Ù„Ù‰ Arrays
    Object.keys(activity).forEach(resource => {
      activity[resource].users = Array.from(activity[resource].users);
    });
    return activity;
  }

  /**
   * ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª
   */
  _generateRecommendations(logs) {
    const recommendations = [];

    // ÙØ­Øµ Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„ÙØ´Ù„ Ø§Ù„Ù…Ø±ØªÙØ¹Ø©
    const failureRate = logs.filter(e => e.status === 'failure').length / logs.length;
    if (failureRate > 0.1) {
      recommendations.push({
        priority: 'high',
        title: 'Ù…Ø¹Ø¯Ù„ ÙØ´Ù„ Ù…Ø±ØªÙØ¹ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„',
        description: `Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ´Ù„ ${(failureRate * 100).toFixed(2)}% Ù‚Ø¯ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„ØªÙƒÙˆÙŠÙ†`,
        action: 'ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø£Ø°ÙˆÙ†Ø§Øª'
      });
    }

    // ÙØ­Øµ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ØºÙŠØ± Ø§Ù„ÙƒØ§ÙÙŠØ©
    const rolesCount = new Set(logs.flatMap(e => e.metadata.roles || [])).size;
    if (rolesCount < 5) {
      recommendations.push({
        priority: 'medium',
        title: 'Ø¹Ø¯Ø¯ Ù…Ø­Ø¯ÙˆØ¯ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±',
        description: 'Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…ØªØ®ØµØµØ©',
        action: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„Ø£Ø°ÙˆÙ†Ø§Øª'
      });
    }
    return recommendations;
  }

  /**
   * Ø­Ø³Ø§Ø¨ Ø´Ø¯Ø© Ø§Ù„Ø­Ø¯Ø«
   */
  _calculateSeverity(eventType) {
    const severityMap = {
      'ROLE_DELETED': 'critical',
      'PERMISSION_REVOKED': 'high',
      'UNAUTHORIZED_ACCESS': 'high',
      'ROLE_CREATED': 'medium',
      'PERMISSION_ASSIGNED': 'low'
    };
    return severityMap[eventType] || 'low';
  }

  /**
   * ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
   */
  _triggerAlert(incident) {
    // ÙŠÙ…ÙƒÙ† Ø¯Ù…Ø¬ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù‡Ù†Ø§
    console.warn(`ðŸš¨ Security Alert: ${incident.type}`, incident);
  }

  /**
   * ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù‘Ù ÙØ±ÙŠØ¯
   */
  _generateId() {
    return `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }

  /**
   * Ø¨Ø¯Ø¡ Ù…Ø¤Ù‚Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ
   */
  startCleanupTimer() {
    setInterval(() => {
      const cutoffDate = new Date(Date.now() - this.config.retentionDays * 86400000);

      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      const originalLength = this.auditLog.length;
      this.auditLog = this.auditLog.filter(e => e.timestamp > cutoffDate);
      if (this.auditLog.length < originalLength) {
        console.log(`ðŸ§¹ Cleaned up ${originalLength - this.auditLog.length} old audit entries`);
      }

      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      const oldIncidentsLength = this.securityIncidents.length;
      this.securityIncidents = this.securityIncidents.filter(i => i.reportedAt > cutoffDate);
      if (this.securityIncidents.length < oldIncidentsLength) {
        console.log(`ðŸ§¹ Cleaned up ${oldIncidentsLength - this.securityIncidents.length} old incidents`);
      }
    }, 86400000); // ØªØ´ØºÙŠÙ„ ÙŠÙˆÙ…ÙŠØ§Ù‹
  }

  /**
   * ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
   */
  exportAuditLogs(format = 'json') {
    if (format === 'csv') {
      return this._exportAsCSV();
    }
    return {
      exportDate: new Date(),
      totalRecords: this.auditLog.length,
      data: this.auditLog
    };
  }

  /**
   * ØªØµØ¯ÙŠØ± Ø¨ØµÙŠØºØ© CSV
   */
  _exportAsCSV() {
    const headers = ['Timestamp', 'EventType', 'UserId', 'Action', 'Resource', 'Status', 'Severity'];
    const rows = this.auditLog.map(e => [e.timestamp.toISOString(), e.eventType, e.userId, e.action, e.resource, e.status, e.severity]);
    let csv = headers.join(',') + '\n';
    rows.forEach(row => {
      csv += row.map(cell => `"${cell}"`).join(',') + '\n';
    });
    return csv;
  }

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ù…Ø§Ù†
   */
  getSecuritySummary() {
    const last7Days = this.auditLog.filter(e => e.timestamp > new Date(Date.now() - 604800000));
    const last30Days = this.auditLog.filter(e => e.timestamp > new Date(Date.now() - 2592000000));
    return {
      last7Days: {
        totalEvents: last7Days.length,
        failures: last7Days.filter(e => e.status === 'failure').length,
        criticalEvents: last7Days.filter(e => e.severity === 'critical').length
      },
      last30Days: {
        totalEvents: last30Days.length,
        failures: last30Days.filter(e => e.status === 'failure').length,
        criticalEvents: last30Days.filter(e => e.severity === 'critical').length
      },
      activeIncidents: this.getSecurityIncidents({
        status: 'open'
      }).length,
      highRiskIncidents: this.getSecurityIncidents({
        severity: 'high'
      }).length
    };
  }

  /**
   * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
   */
  getUserAccessHistory(userId, limit = 50) {
    const userLogs = this.auditLog.filter(e => e.userId === userId).sort((a, b) => b.timestamp - a.timestamp).slice(0, limit);
    return userLogs.map(log => ({
      id: log.id,
      timestamp: log.timestamp,
      action: log.action,
      resource: log.resource,
      resourceId: log.resourceId,
      status: log.status,
      ipAddress: log.ipAddress,
      userAgent: log.userAgent,
      severity: log.severity
    }));
  }
}
module.exports = RBACAuditingService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSQkFDQXVkaXRpbmdTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJhdWRpdExvZyIsInNlY3VyaXR5SW5jaWRlbnRzIiwiY29tcGxpYW5jZVJlcG9ydHMiLCJhY2Nlc3NQYXR0ZXJucyIsIk1hcCIsIm1heExvZ1NpemUiLCJyZXRlbnRpb25EYXlzIiwiZW5jcnlwdExvZ3MiLCJhbGVydGluZ0VuYWJsZWQiLCJzdGFydENsZWFudXBUaW1lciIsImxvZ0F1ZGl0RXZlbnQiLCJldmVudERhdGEiLCJhdWRpdEVudHJ5IiwiaWQiLCJfZ2VuZXJhdGVJZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJldmVudFR5cGUiLCJ1c2VySWQiLCJhY3RvciIsImFjdGlvbiIsInJlc291cmNlIiwicmVzb3VyY2VJZCIsInN0YXR1cyIsInN0YXR1c0NvZGUiLCJiZWZvcmUiLCJhZnRlciIsImNoYW5nZXMiLCJpcEFkZHJlc3MiLCJ1c2VyQWdlbnQiLCJzZXNzaW9uSWQiLCJjb3JyZWxhdGlvbklkIiwibWV0YWRhdGEiLCJzZXZlcml0eSIsIl9jYWxjdWxhdGVTZXZlcml0eSIsInRhZ3MiLCJwdXNoIiwibGVuZ3RoIiwic2xpY2UiLCJfYW5hbHl6ZUZvckluY2lkZW50cyIsInF1ZXJ5QXVkaXRMb2ciLCJxdWVyeSIsInJlc3VsdHMiLCJmaWx0ZXJzIiwiZmlsdGVyIiwiZSIsIkFycmF5IiwiaXNBcnJheSIsImluY2x1ZGVzIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsInNlYXJjaCIsInNlYXJjaExvd2VyIiwidG9Mb3dlckNhc2UiLCJzb3J0IiwiYSIsImIiLCJzb3J0QnkiLCJzb3J0T3JkZXIiLCJsaW1pdCIsIm9mZnNldCIsInRvdGFsIiwicmV0dXJuZWQiLCJpbmNpZGVudHMiLCJmYWlsZWRBdHRlbXB0cyIsIm5vdyIsInR5cGUiLCJhdHRlbXB0Q291bnQiLCJfaXNOb3JtYWxBY2Nlc3NQYXR0ZXJuIiwiZGV0YWlscyIsInRpbWUiLCJpbmNpZGVudCIsInJlcG9ydFNlY3VyaXR5SW5jaWRlbnQiLCJyZXBvcnQiLCJyZXBvcnRlZEF0Iiwibm90ZXMiLCJfdHJpZ2dlckFsZXJ0IiwiZ2V0U2VjdXJpdHlJbmNpZGVudHMiLCJpIiwiZ2VuZXJhdGVBdWRpdFJlcG9ydCIsInJlcG9ydENvbmZpZyIsInJlbGV2YW50TG9ncyIsImdlbmVyYXRlZEF0IiwicGVyaW9kIiwic3VtbWFyeSIsInRvdGFsRXZlbnRzIiwic3VjY2Vzc2Z1bEFjdGlvbnMiLCJmYWlsZWRBY3Rpb25zIiwidW5pcXVlVXNlcnMiLCJTZXQiLCJtYXAiLCJzaXplIiwiYXZnRXZlbnRzUGVyRGF5IiwiTWF0aCIsInJvdW5kIiwiZXZlbnREaXN0cmlidXRpb24iLCJfY2FsY3VsYXRlRXZlbnREaXN0cmlidXRpb24iLCJ1c2VyQWN0aXZpdHkiLCJfY2FsY3VsYXRlVXNlckFjdGl2aXR5IiwicmVzb3VyY2VBY3Rpdml0eSIsIl9jYWxjdWxhdGVSZXNvdXJjZUFjdGl2aXR5IiwiY2hhbmdlc1N1bW1hcnkiLCJyb2xlc0NyZWF0ZWQiLCJyb2xlc01vZGlmaWVkIiwicm9sZXNEZWxldGVkIiwicGVybWlzc2lvbnNDaGFuZ2VkIiwic2VjdXJpdHlTdW1tYXJ5IiwidG90YWxJbmNpZGVudHMiLCJoaWdoU2V2ZXJpdHlJbmNpZGVudHMiLCJyZWNvbW1lbmRhdGlvbnMiLCJfZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMiLCJnZW5lcmF0ZUNvbXBsaWFuY2VSZXBvcnQiLCJjaGVja3MiLCJhdWRpdExvZ2dpbmdFbmFibGVkIiwiYWNjZXNzQ29udHJvbEltcGxlbWVudGVkIiwicm9sZUhpZXJhcmNoeURlZmluZWQiLCJwZXJtaXNzaW9uQXNzaWdubWVudERvY3VtZW50ZWQiLCJpbmNpZGVudFJlc3BvbnNlUHJvY2VkdXJlSW5QbGFjZSIsInJpc2tBc3Nlc3NtZW50Iiwib3ZlcmFsbFJpc2siLCJoaWdoUmlza0FyZWFzIiwiY2VydGlmaWNhdGlvbnMiLCJTT0MyIiwiSElQQUEiLCJHRFBSIiwicmVjb3JkTm9ybWFsUGF0dGVybiIsImNvbnRleHQiLCJrZXkiLCJoYXMiLCJzZXQiLCJvY2N1cnJlbmNlcyIsInRpbWVzIiwibG9jYXRpb25zIiwiZGV2aWNlcyIsInBhdHRlcm4iLCJnZXQiLCJnZXRIb3VycyIsImxvY2F0aW9uIiwiZGV2aWNlIiwic2hpZnQiLCJjdXJyZW50SG91ciIsImF2Z0hvdXIiLCJyZWR1Y2UiLCJhYnMiLCJsb2dzIiwiZGlzdHJpYnV0aW9uIiwiZm9yRWFjaCIsImxvZyIsImFjdGl2aXR5IiwidG90YWxBY3Rpb25zIiwiYWN0aW9ucyIsImFjY2Vzc2VzIiwibW9kaWZpY2F0aW9ucyIsImRlbGV0aW9ucyIsInVzZXJzIiwiYWRkIiwiT2JqZWN0Iiwia2V5cyIsImZyb20iLCJmYWlsdXJlUmF0ZSIsInByaW9yaXR5IiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInRvRml4ZWQiLCJyb2xlc0NvdW50IiwiZmxhdE1hcCIsInJvbGVzIiwic2V2ZXJpdHlNYXAiLCJjb25zb2xlIiwid2FybiIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwic2V0SW50ZXJ2YWwiLCJjdXRvZmZEYXRlIiwib3JpZ2luYWxMZW5ndGgiLCJvbGRJbmNpZGVudHNMZW5ndGgiLCJleHBvcnRBdWRpdExvZ3MiLCJmb3JtYXQiLCJfZXhwb3J0QXNDU1YiLCJleHBvcnREYXRlIiwidG90YWxSZWNvcmRzIiwiZGF0YSIsImhlYWRlcnMiLCJyb3dzIiwidG9JU09TdHJpbmciLCJjc3YiLCJqb2luIiwicm93IiwiY2VsbCIsImdldFNlY3VyaXR5U3VtbWFyeSIsImxhc3Q3RGF5cyIsImxhc3QzMERheXMiLCJmYWlsdXJlcyIsImNyaXRpY2FsRXZlbnRzIiwiYWN0aXZlSW5jaWRlbnRzIiwiaGlnaFJpc2tJbmNpZGVudHMiLCJnZXRVc2VyQWNjZXNzSGlzdG9yeSIsInVzZXJMb2dzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInJiYWMtYXVkaXRpbmcuc2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAqIPCfk4sgUkJBQyBBdWRpdGluZyBTZXJ2aWNlIC0g2K7Yr9mF2Kkg2KfZhNiq2K/ZgtmK2YIg2YjYp9mE2YXYsdin2KzYudipXHJcbiAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gKiBcclxuICog2YrZiNmB2LEg2YbYuNin2YUg2KfZhNiq2K/ZgtmK2YIg2KfZhNi02KfZhdmEINmF2Lk6XHJcbiAqIOKchSDYqtiq2KjYuSDYrNmF2YrYuSDYp9mE2KrYutmK2YrYsdin2KpcclxuICog4pyFINiq2YLYp9ix2YrYsSDZhdmB2LXZhNipXHJcbiAqIOKchSDZg9i02YEg2KfZhNij2YbZhdin2Lcg2KfZhNmF2LTYqNmI2YfYqVxyXG4gKiDinIUg2KfZhNin2YTYqtiy2KfZhSDYqNin2YTYqtmI2KfZgdmC2YrYp9iqXHJcbiAqL1xyXG5cclxuY2xhc3MgUkJBQ0F1ZGl0aW5nU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IoY29uZmlnID0ge30pIHtcclxuICAgIHRoaXMuYXVkaXRMb2cgPSBbXTtcclxuICAgIHRoaXMuc2VjdXJpdHlJbmNpZGVudHMgPSBbXTtcclxuICAgIHRoaXMuY29tcGxpYW5jZVJlcG9ydHMgPSBbXTtcclxuICAgIHRoaXMuYWNjZXNzUGF0dGVybnMgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLmNvbmZpZyA9IHtcclxuICAgICAgbWF4TG9nU2l6ZTogY29uZmlnLm1heExvZ1NpemUgfHwgMTAwMDAwLFxyXG4gICAgICByZXRlbnRpb25EYXlzOiBjb25maWcucmV0ZW50aW9uRGF5cyB8fCA5MCxcclxuICAgICAgZW5jcnlwdExvZ3M6IGNvbmZpZy5lbmNyeXB0TG9ncyB8fCBmYWxzZSxcclxuICAgICAgYWxlcnRpbmdFbmFibGVkOiBjb25maWcuYWxlcnRpbmdFbmFibGVkIHx8IHRydWUsXHJcbiAgICAgIC4uLmNvbmZpZ1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgdGhpcy5zdGFydENsZWFudXBUaW1lcigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgICogMe+4j+KDoyBBVURJVCBMT0cgTUFOQUdFTUVOVCAtINil2K/Yp9ix2Kkg2LPYrNmE2KfYqiDYp9mE2KrYr9mC2YrZglxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYpdi22KfZgdipINit2K/YqyDYqtiv2YLZitmCXHJcbiAgICovXHJcbiAgbG9nQXVkaXRFdmVudChldmVudERhdGEpIHtcclxuICAgIGNvbnN0IGF1ZGl0RW50cnkgPSB7XHJcbiAgICAgIGlkOiB0aGlzLl9nZW5lcmF0ZUlkKCksXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgZXZlbnRUeXBlOiBldmVudERhdGEuZXZlbnRUeXBlLFxyXG4gICAgICB1c2VySWQ6IGV2ZW50RGF0YS51c2VySWQsXHJcbiAgICAgIGFjdG9yOiBldmVudERhdGEuYWN0b3IgfHwgJ3N5c3RlbScsXHJcbiAgICAgIFxyXG4gICAgICAvLyBBY3Rpb24gRGV0YWlsc1xyXG4gICAgICBhY3Rpb246IGV2ZW50RGF0YS5hY3Rpb24sXHJcbiAgICAgIHJlc291cmNlOiBldmVudERhdGEucmVzb3VyY2UsXHJcbiAgICAgIHJlc291cmNlSWQ6IGV2ZW50RGF0YS5yZXNvdXJjZUlkLFxyXG4gICAgICBcclxuICAgICAgLy8gU3RhdHVzXHJcbiAgICAgIHN0YXR1czogZXZlbnREYXRhLnN0YXR1cyB8fCAnc3VjY2VzcycsIC8vIHN1Y2Nlc3MsIGZhaWx1cmUsIHBhcnRpYWxcclxuICAgICAgc3RhdHVzQ29kZTogZXZlbnREYXRhLnN0YXR1c0NvZGUgfHwgMjAwLFxyXG4gICAgICBcclxuICAgICAgLy8gQ2hhbmdlIERldGFpbHNcclxuICAgICAgYmVmb3JlOiBldmVudERhdGEuYmVmb3JlIHx8IHt9LFxyXG4gICAgICBhZnRlcjogZXZlbnREYXRhLmFmdGVyIHx8IHt9LFxyXG4gICAgICBjaGFuZ2VzOiBldmVudERhdGEuY2hhbmdlcyB8fCBbXSxcclxuICAgICAgXHJcbiAgICAgIC8vIENvbnRleHRcclxuICAgICAgaXBBZGRyZXNzOiBldmVudERhdGEuaXBBZGRyZXNzLFxyXG4gICAgICB1c2VyQWdlbnQ6IGV2ZW50RGF0YS51c2VyQWdlbnQsXHJcbiAgICAgIHNlc3Npb25JZDogZXZlbnREYXRhLnNlc3Npb25JZCxcclxuICAgICAgY29ycmVsYXRpb25JZDogZXZlbnREYXRhLmNvcnJlbGF0aW9uSWQsXHJcbiAgICAgIFxyXG4gICAgICAvLyBNZXRhZGF0YVxyXG4gICAgICBtZXRhZGF0YTogZXZlbnREYXRhLm1ldGFkYXRhIHx8IHt9LFxyXG4gICAgICBzZXZlcml0eTogZXZlbnREYXRhLnNldmVyaXR5IHx8IHRoaXMuX2NhbGN1bGF0ZVNldmVyaXR5KGV2ZW50RGF0YS5ldmVudFR5cGUpLFxyXG4gICAgICB0YWdzOiBldmVudERhdGEudGFncyB8fCBbXVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmF1ZGl0TG9nLnB1c2goYXVkaXRFbnRyeSk7XHJcblxyXG4gICAgLy8g2KfZhNit2YHYp9i4INi52YTZiSDYrdivINij2YLYtdmJXHJcbiAgICBpZiAodGhpcy5hdWRpdExvZy5sZW5ndGggPiB0aGlzLmNvbmZpZy5tYXhMb2dTaXplKSB7XHJcbiAgICAgIHRoaXMuYXVkaXRMb2cgPSB0aGlzLmF1ZGl0TG9nLnNsaWNlKC10aGlzLmNvbmZpZy5tYXhMb2dTaXplKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDZgdit2LUg2KfZhNij2YbZhdin2Lcg2KfZhNmF2LTYqNmI2YfYqVxyXG4gICAgdGhpcy5fYW5hbHl6ZUZvckluY2lkZW50cyhhdWRpdEVudHJ5KTtcclxuXHJcbiAgICByZXR1cm4gYXVkaXRFbnRyeTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2LPYrNmE2KfYqiDYp9mE2KrYr9mC2YrZgiDZhdi5INin2YTYqti12YHZitipINmI2KfZhNio2K3Yq1xyXG4gICAqL1xyXG4gIHF1ZXJ5QXVkaXRMb2cocXVlcnkgPSB7fSkge1xyXG4gICAgbGV0IHJlc3VsdHMgPSB0aGlzLmF1ZGl0TG9nO1xyXG5cclxuICAgIC8vIEhhbmRsZSBmaWx0ZXJzIG9iamVjdCBpZiBwcm92aWRlZFxyXG4gICAgY29uc3QgZmlsdGVycyA9IHF1ZXJ5LmZpbHRlcnMgfHwgcXVlcnk7XHJcblxyXG4gICAgLy8g2KfZhNiq2LXZgdmK2Kkg2K3Ys9ioINin2YTZhtmI2LlcclxuICAgIGlmIChmaWx0ZXJzLmV2ZW50VHlwZSkge1xyXG4gICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZSA9PlxyXG4gICAgICAgIEFycmF5LmlzQXJyYXkoZmlsdGVycy5ldmVudFR5cGUpXHJcbiAgICAgICAgICA/IGZpbHRlcnMuZXZlbnRUeXBlLmluY2x1ZGVzKGUuZXZlbnRUeXBlKVxyXG4gICAgICAgICAgOiBlLmV2ZW50VHlwZSA9PT0gZmlsdGVycy5ldmVudFR5cGVcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYp9mE2KrYtdmB2YrYqSDYrdiz2Kgg2KfZhNmF2LPYqtiu2K/ZhVxyXG4gICAgaWYgKGZpbHRlcnMudXNlcklkKSB7XHJcbiAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihlID0+IGUudXNlcklkID09PSBmaWx0ZXJzLnVzZXJJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g2KfZhNiq2LXZgdmK2Kkg2K3Ys9ioINin2YTYpdis2LHYp9ihXHJcbiAgICBpZiAoZmlsdGVycy5hY3Rpb24pIHtcclxuICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGUgPT4gZS5hY3Rpb24gPT09IGZpbHRlcnMuYWN0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYp9mE2KrYtdmB2YrYqSDYrdiz2Kgg2KfZhNmF2YjYsdivXHJcbiAgICBpZiAoZmlsdGVycy5yZXNvdXJjZSkge1xyXG4gICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZSA9PiBlLnJlc291cmNlID09PSBmaWx0ZXJzLnJlc291cmNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYp9mE2KrYtdmB2YrYqSDYrdiz2Kgg2KfZhNit2KfZhNipXHJcbiAgICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcclxuICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGUgPT4gZS5zdGF0dXMgPT09IGZpbHRlcnMuc3RhdHVzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYp9mE2KrYtdmB2YrYqSDYrdiz2Kgg2LTYr9ipINin2YTYrdiv2KtcclxuICAgIGlmIChmaWx0ZXJzLnNldmVyaXR5KSB7XHJcbiAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihlID0+IGUuc2V2ZXJpdHkgPT09IGZpbHRlcnMuc2V2ZXJpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINin2YTYqti12YHZitipINit2LPYqCDYp9mE2YbYt9in2YIg2KfZhNiy2YXZhtmKXHJcbiAgICBpZiAoZmlsdGVycy5zdGFydERhdGUpIHtcclxuICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGUgPT4gZS50aW1lc3RhbXAgPj0gZmlsdGVycy5zdGFydERhdGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLmVuZERhdGUpIHtcclxuICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGUgPT4gZS50aW1lc3RhbXAgPD0gZmlsdGVycy5lbmREYXRlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYp9mE2KjYrdirINin2YTZhti12YpcclxuICAgIGlmIChmaWx0ZXJzLnNlYXJjaCkge1xyXG4gICAgICBjb25zdCBzZWFyY2hMb3dlciA9IGZpbHRlcnMuc2VhcmNoLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihlID0+XHJcbiAgICAgICAgZS5hY3Rpb24/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoTG93ZXIpIHx8XHJcbiAgICAgICAgZS5yZXNvdXJjZT8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hMb3dlcikgfHxcclxuICAgICAgICBlLnVzZXJJZD8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hMb3dlcilcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYp9mE2KrYsdiq2YrYqFxyXG4gICAgY29uc3Qgc29ydCA9IChhLCBiKSA9PiB7XHJcbiAgICAgIGlmIChmaWx0ZXJzLnNvcnRCeSA9PT0gJ3RpbWVzdGFtcCcpIHtcclxuICAgICAgICByZXR1cm4gZmlsdGVycy5zb3J0T3JkZXIgPT09ICdhc2MnXHJcbiAgICAgICAgICA/IGEudGltZXN0YW1wIC0gYi50aW1lc3RhbXBcclxuICAgICAgICAgIDogYi50aW1lc3RhbXAgLSBhLnRpbWVzdGFtcDtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gMDtcclxuICAgIH07XHJcblxyXG4gICAgcmVzdWx0cyA9IHJlc3VsdHMuc29ydChzb3J0KTtcclxuXHJcbiAgICAvLyDYp9mE2K3YryDZhdmGINin2YTZhtiq2KfYptisXHJcbiAgICBpZiAoZmlsdGVycy5saW1pdCB8fCBxdWVyeS5saW1pdCkge1xyXG4gICAgICByZXN1bHRzID0gcmVzdWx0cy5zbGljZSgwLCBmaWx0ZXJzLmxpbWl0IHx8IHF1ZXJ5LmxpbWl0KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZmlsdGVycy5vZmZzZXQgfHwgcXVlcnkub2Zmc2V0KSB7XHJcbiAgICAgIHJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKGZpbHRlcnMub2Zmc2V0IHx8IHF1ZXJ5Lm9mZnNldCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG90YWw6IHRoaXMuYXVkaXRMb2cubGVuZ3RoLFxyXG4gICAgICByZXR1cm5lZDogcmVzdWx0cy5sZW5ndGgsXHJcbiAgICAgIHJlc3VsdHNcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuICAgKiAy77iP4oOjIElOQ0lERU5UIERFVEVDVElPTiAtINmD2LTZgSDYp9mE2K3ZiNin2K/YqyDYp9mE2KPZhdmG2YrYqVxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYqtit2YTZitmEINin2YTYo9it2K/Yp9irINmE2YPYtNmBINin2YTYrdmI2KfYr9irXHJcbiAgICovXHJcbiAgX2FuYWx5emVGb3JJbmNpZGVudHMoYXVkaXRFbnRyeSkge1xyXG4gICAgY29uc3QgaW5jaWRlbnRzID0gW107XHJcblxyXG4gICAgLy8g2YPYtNmBINmF2K3Yp9mI2YTYp9iqINin2YTZiNi12YjZhCDYp9mE2YXYqtmD2LHYsdipINin2YTZgdin2LTZhNipXHJcbiAgICBpZiAoYXVkaXRFbnRyeS5zdGF0dXMgPT09ICdmYWlsdXJlJykge1xyXG4gICAgICBjb25zdCBmYWlsZWRBdHRlbXB0cyA9IHRoaXMuYXVkaXRMb2dcclxuICAgICAgICAuZmlsdGVyKGUgPT5cclxuICAgICAgICAgIGUudXNlcklkID09PSBhdWRpdEVudHJ5LnVzZXJJZCAmJlxyXG4gICAgICAgICAgZS5hY3Rpb24gPT09IGF1ZGl0RW50cnkuYWN0aW9uICYmXHJcbiAgICAgICAgICBlLnN0YXR1cyA9PT0gJ2ZhaWx1cmUnICYmXHJcbiAgICAgICAgICBlLnRpbWVzdGFtcCA+IG5ldyBEYXRlKERhdGUubm93KCkgLSAzNjAwMDAwKSAvLyDYotiu2LEg2LPYp9i52KlcclxuICAgICAgICApO1xyXG5cclxuICAgICAgaWYgKGZhaWxlZEF0dGVtcHRzLmxlbmd0aCA+PSA1KSB7XHJcbiAgICAgICAgaW5jaWRlbnRzLnB1c2goe1xyXG4gICAgICAgICAgdHlwZTogJ0JSVVRFX0ZPUkNFX0FUVEVNUFQnLFxyXG4gICAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcclxuICAgICAgICAgIHVzZXJJZDogYXVkaXRFbnRyeS51c2VySWQsXHJcbiAgICAgICAgICBhY3Rpb246IGF1ZGl0RW50cnkuYWN0aW9uLFxyXG4gICAgICAgICAgYXR0ZW1wdENvdW50OiBmYWlsZWRBdHRlbXB0cy5sZW5ndGgsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vINmD2LTZgSDYp9mE2YjYtdmI2YQg2LrZitixINin2YTZhdi52KrYp9ivXHJcbiAgICBpZiAoIXRoaXMuX2lzTm9ybWFsQWNjZXNzUGF0dGVybihhdWRpdEVudHJ5KSkge1xyXG4gICAgICBpbmNpZGVudHMucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ0FCTk9STUFMX0FDQ0VTU19QQVRURVJOJyxcclxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXHJcbiAgICAgICAgdXNlcklkOiBhdWRpdEVudHJ5LnVzZXJJZCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgZGV0YWlsczoge1xyXG4gICAgICAgICAgYWN0aW9uOiBhdWRpdEVudHJ5LmFjdGlvbixcclxuICAgICAgICAgIHJlc291cmNlOiBhdWRpdEVudHJ5LnJlc291cmNlLFxyXG4gICAgICAgICAgdGltZTogYXVkaXRFbnRyeS50aW1lc3RhbXBcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINmD2LTZgSDYp9mE2YjYtdmI2YQg2KfZhNmF2LPYqtmC2YrZhVxyXG4gICAgaWYgKGF1ZGl0RW50cnkuZXZlbnRUeXBlID09PSAnUk9MRV9ERUxFVEVEJyB8fCBcclxuICAgICAgICBhdWRpdEVudHJ5LmV2ZW50VHlwZSA9PT0gJ1BFUk1JU1NJT05fUkVWT0tFRCcpIHtcclxuICAgICAgaW5jaWRlbnRzLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICdTRU5TSVRJVkVfT1BFUkFUSU9OJyxcclxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnLFxyXG4gICAgICAgIHVzZXJJZDogYXVkaXRFbnRyeS51c2VySWQsXHJcbiAgICAgICAgYWN0b3I6IGF1ZGl0RW50cnkuYWN0b3IsXHJcbiAgICAgICAgYWN0aW9uOiBhdWRpdEVudHJ5LmFjdGlvbixcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g2KXYttin2YHYqSDYp9mE2K3ZiNin2K/YqyDYp9mE2YXZg9iq2LTZgdipXHJcbiAgICBmb3IgKGNvbnN0IGluY2lkZW50IG9mIGluY2lkZW50cykge1xyXG4gICAgICB0aGlzLnJlcG9ydFNlY3VyaXR5SW5jaWRlbnQoaW5jaWRlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KrZgtix2YrYsSDYrdin2K/Yq9ipINij2YXZhtmK2KlcclxuICAgKi9cclxuICByZXBvcnRTZWN1cml0eUluY2lkZW50KGluY2lkZW50KSB7XHJcbiAgICBjb25zdCByZXBvcnQgPSB7XHJcbiAgICAgIGlkOiB0aGlzLl9nZW5lcmF0ZUlkKCksXHJcbiAgICAgIC4uLmluY2lkZW50LFxyXG4gICAgICByZXBvcnRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICBzdGF0dXM6ICdvcGVuJywgLy8gb3BlbiwgaW52ZXN0aWdhdGluZywgcmVzb2x2ZWQsIGNsb3NlZFxyXG4gICAgICBub3RlczogW11cclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5zZWN1cml0eUluY2lkZW50cy5wdXNoKHJlcG9ydCk7XHJcblxyXG4gICAgLy8g2KrZhtio2YrZh9in2KpcclxuICAgIGlmICh0aGlzLmNvbmZpZy5hbGVydGluZ0VuYWJsZWQpIHtcclxuICAgICAgdGhpcy5fdHJpZ2dlckFsZXJ0KHJlcG9ydCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlcG9ydDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2KfZhNit2YjYp9iv2Ksg2KfZhNij2YXZhtmK2KlcclxuICAgKi9cclxuICBnZXRTZWN1cml0eUluY2lkZW50cyhmaWx0ZXJzID0ge30pIHtcclxuICAgIGxldCBpbmNpZGVudHMgPSB0aGlzLnNlY3VyaXR5SW5jaWRlbnRzO1xyXG5cclxuICAgIGlmIChmaWx0ZXJzLnN0YXR1cykge1xyXG4gICAgICBpbmNpZGVudHMgPSBpbmNpZGVudHMuZmlsdGVyKGkgPT4gaS5zdGF0dXMgPT09IGZpbHRlcnMuc3RhdHVzKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZmlsdGVycy5zZXZlcml0eSkge1xyXG4gICAgICBpbmNpZGVudHMgPSBpbmNpZGVudHMuZmlsdGVyKGkgPT4gaS5zZXZlcml0eSA9PT0gZmlsdGVycy5zZXZlcml0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlcnMudHlwZSkge1xyXG4gICAgICBpbmNpZGVudHMgPSBpbmNpZGVudHMuZmlsdGVyKGkgPT4gaS50eXBlID09PSBmaWx0ZXJzLnR5cGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpbmNpZGVudHMuc29ydCgoYSwgYikgPT4gYi5yZXBvcnRlZEF0IC0gYS5yZXBvcnRlZEF0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqIDPvuI/ig6MgUkVQT1JUSU5HIC0g2KfZhNiq2YLYp9ix2YrYsVxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYqtmI2YTZitivINiq2YLYsdmK2LEg2KfZhNiq2K/ZgtmK2YJcclxuICAgKi9cclxuICBnZW5lcmF0ZUF1ZGl0UmVwb3J0KHJlcG9ydENvbmZpZyA9IHt9KSB7XHJcbiAgICBjb25zdCBzdGFydERhdGUgPSByZXBvcnRDb25maWcuc3RhcnREYXRlIHx8IG5ldyBEYXRlKERhdGUubm93KCkgLSAyNTkyMDAwMDAwKTsgLy8gMzAgZGF5c1xyXG4gICAgY29uc3QgZW5kRGF0ZSA9IHJlcG9ydENvbmZpZy5lbmREYXRlIHx8IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgY29uc3QgcmVsZXZhbnRMb2dzID0gdGhpcy5hdWRpdExvZy5maWx0ZXIoZSA9PlxyXG4gICAgICBlLnRpbWVzdGFtcCA+PSBzdGFydERhdGUgJiYgZS50aW1lc3RhbXAgPD0gZW5kRGF0ZVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCByZXBvcnQgPSB7XHJcbiAgICAgIGlkOiB0aGlzLl9nZW5lcmF0ZUlkKCksXHJcbiAgICAgIGdlbmVyYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICBwZXJpb2Q6IHsgc3RhcnREYXRlLCBlbmREYXRlIH0sXHJcbiAgICAgIFxyXG4gICAgICAvLyBTdW1tYXJ5IFN0YXRpc3RpY3NcclxuICAgICAgc3VtbWFyeToge1xyXG4gICAgICAgIHRvdGFsRXZlbnRzOiByZWxldmFudExvZ3MubGVuZ3RoLFxyXG4gICAgICAgIHN1Y2Nlc3NmdWxBY3Rpb25zOiByZWxldmFudExvZ3MuZmlsdGVyKGUgPT4gZS5zdGF0dXMgPT09ICdzdWNjZXNzJykubGVuZ3RoLFxyXG4gICAgICAgIGZhaWxlZEFjdGlvbnM6IHJlbGV2YW50TG9ncy5maWx0ZXIoZSA9PiBlLnN0YXR1cyA9PT0gJ2ZhaWx1cmUnKS5sZW5ndGgsXHJcbiAgICAgICAgdW5pcXVlVXNlcnM6IG5ldyBTZXQocmVsZXZhbnRMb2dzLm1hcChlID0+IGUudXNlcklkKSkuc2l6ZSxcclxuICAgICAgICBhdmdFdmVudHNQZXJEYXk6IE1hdGgucm91bmQocmVsZXZhbnRMb2dzLmxlbmd0aCAvIDMwKVxyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gRXZlbnQgRGlzdHJpYnV0aW9uXHJcbiAgICAgIGV2ZW50RGlzdHJpYnV0aW9uOiB0aGlzLl9jYWxjdWxhdGVFdmVudERpc3RyaWJ1dGlvbihyZWxldmFudExvZ3MpLFxyXG4gICAgICB1c2VyQWN0aXZpdHk6IHRoaXMuX2NhbGN1bGF0ZVVzZXJBY3Rpdml0eShyZWxldmFudExvZ3MpLFxyXG4gICAgICByZXNvdXJjZUFjdGl2aXR5OiB0aGlzLl9jYWxjdWxhdGVSZXNvdXJjZUFjdGl2aXR5KHJlbGV2YW50TG9ncyksXHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGFuZ2VzIFN1bW1hcnlcclxuICAgICAgY2hhbmdlc1N1bW1hcnk6IHtcclxuICAgICAgICByb2xlc0NyZWF0ZWQ6IHJlbGV2YW50TG9ncy5maWx0ZXIoZSA9PiBlLmV2ZW50VHlwZSA9PT0gJ1JPTEVfQ1JFQVRFRCcpLmxlbmd0aCxcclxuICAgICAgICByb2xlc01vZGlmaWVkOiByZWxldmFudExvZ3MuZmlsdGVyKGUgPT4gZS5ldmVudFR5cGUgPT09ICdST0xFX1VQREFURUQnKS5sZW5ndGgsXHJcbiAgICAgICAgcm9sZXNEZWxldGVkOiByZWxldmFudExvZ3MuZmlsdGVyKGUgPT4gZS5ldmVudFR5cGUgPT09ICdST0xFX0RFTEVURUQnKS5sZW5ndGgsXHJcbiAgICAgICAgcGVybWlzc2lvbnNDaGFuZ2VkOiByZWxldmFudExvZ3MuZmlsdGVyKGUgPT4gZS5ldmVudFR5cGUgPT09ICdQRVJNSVNTSU9OX0NIQU5HRUQnKS5sZW5ndGhcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFNlY3VyaXR5IFN1bW1hcnlcclxuICAgICAgc2VjdXJpdHlTdW1tYXJ5OiB7XHJcbiAgICAgICAgdG90YWxJbmNpZGVudHM6IHRoaXMuc2VjdXJpdHlJbmNpZGVudHMuZmlsdGVyKGkgPT5cclxuICAgICAgICAgIGkucmVwb3J0ZWRBdCA+PSBzdGFydERhdGUgJiYgaS5yZXBvcnRlZEF0IDw9IGVuZERhdGVcclxuICAgICAgICApLmxlbmd0aCxcclxuICAgICAgICBoaWdoU2V2ZXJpdHlJbmNpZGVudHM6IHRoaXMuc2VjdXJpdHlJbmNpZGVudHMuZmlsdGVyKGkgPT5cclxuICAgICAgICAgIGkuc2V2ZXJpdHkgPT09ICdoaWdoJyAmJiBpLnJlcG9ydGVkQXQgPj0gc3RhcnREYXRlICYmIGkucmVwb3J0ZWRBdCA8PSBlbmREYXRlXHJcbiAgICAgICAgKS5sZW5ndGhcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFJlY29tbWVuZGF0aW9uc1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuX2dlbmVyYXRlUmVjb21tZW5kYXRpb25zKHJlbGV2YW50TG9ncylcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5jb21wbGlhbmNlUmVwb3J0cy5wdXNoKHJlcG9ydCk7XHJcbiAgICByZXR1cm4gcmVwb3J0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KrZiNmE2YrYryDYqtmC2LHZitixINin2YTYp9mF2KrYq9in2YRcclxuICAgKi9cclxuICBnZW5lcmF0ZUNvbXBsaWFuY2VSZXBvcnQoKSB7XHJcbiAgICBjb25zdCByZXBvcnQgPSB7XHJcbiAgICAgIGlkOiB0aGlzLl9nZW5lcmF0ZUlkKCksXHJcbiAgICAgIGdlbmVyYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIFxyXG4gICAgICAvLyBDb21wbGlhbmNlIENoZWNrc1xyXG4gICAgICBjaGVja3M6IHtcclxuICAgICAgICBhdWRpdExvZ2dpbmdFbmFibGVkOiB0cnVlLFxyXG4gICAgICAgIGFjY2Vzc0NvbnRyb2xJbXBsZW1lbnRlZDogdHJ1ZSxcclxuICAgICAgICByb2xlSGllcmFyY2h5RGVmaW5lZDogdHJ1ZSxcclxuICAgICAgICBwZXJtaXNzaW9uQXNzaWdubWVudERvY3VtZW50ZWQ6IHRydWUsXHJcbiAgICAgICAgaW5jaWRlbnRSZXNwb25zZVByb2NlZHVyZUluUGxhY2U6IHRydWVcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFJpc2sgQXNzZXNzbWVudFxyXG4gICAgICByaXNrQXNzZXNzbWVudDoge1xyXG4gICAgICAgIG92ZXJhbGxSaXNrOiAnbWVkaXVtJyxcclxuICAgICAgICBoaWdoUmlza0FyZWFzOiBbXSxcclxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFtdXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBDZXJ0aWZpY2F0aW9uc1xyXG4gICAgICBjZXJ0aWZpY2F0aW9uczoge1xyXG4gICAgICAgIFNPQzI6ICdjb21wbGlhbnQnLFxyXG4gICAgICAgIEhJUEFBOiAncGFydGlhbCcsXHJcbiAgICAgICAgR0RQUjogJ2NvbXBsaWFudCdcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gcmVwb3J0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgICogNO+4j+KDoyBQQVRURVJOIEFOQUxZU0lTIC0g2KrYrdmE2YrZhCDYp9mE2KPZhtmF2KfYt1xyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqL1xyXG5cclxuICAvKipcclxuICAgKiDYqtiz2KzZitmEINmG2YXYtyDYp9mE2YjYtdmI2YQg2KfZhNi32KjZiti52YpcclxuICAgKi9cclxuICByZWNvcmROb3JtYWxQYXR0ZXJuKHVzZXJJZCwgYWN0aW9uLCBjb250ZXh0ID0ge30pIHtcclxuICAgIGNvbnN0IGtleSA9IGAke3VzZXJJZH06JHthY3Rpb259YDtcclxuXHJcbiAgICBpZiAoIXRoaXMuYWNjZXNzUGF0dGVybnMuaGFzKGtleSkpIHtcclxuICAgICAgdGhpcy5hY2Nlc3NQYXR0ZXJucy5zZXQoa2V5LCB7XHJcbiAgICAgICAgb2NjdXJyZW5jZXM6IDAsXHJcbiAgICAgICAgdGltZXM6IFtdLFxyXG4gICAgICAgIGxvY2F0aW9uczogW10sXHJcbiAgICAgICAgZGV2aWNlczogW11cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGF0dGVybiA9IHRoaXMuYWNjZXNzUGF0dGVybnMuZ2V0KGtleSk7XHJcbiAgICBwYXR0ZXJuLm9jY3VycmVuY2VzKys7XHJcbiAgICBwYXR0ZXJuLnRpbWVzLnB1c2gobmV3IERhdGUoKS5nZXRIb3VycygpKTtcclxuICAgIGlmIChjb250ZXh0LmxvY2F0aW9uKSBwYXR0ZXJuLmxvY2F0aW9ucy5wdXNoKGNvbnRleHQubG9jYXRpb24pO1xyXG4gICAgaWYgKGNvbnRleHQuZGV2aWNlKSBwYXR0ZXJuLmRldmljZXMucHVzaChjb250ZXh0LmRldmljZSk7XHJcblxyXG4gICAgLy8g2KfZhNit2YHYp9i4INi52YTZiSAxMDAg2K3Yr9irINmB2YLYt1xyXG4gICAgaWYgKHBhdHRlcm4udGltZXMubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgIHBhdHRlcm4udGltZXMuc2hpZnQoKTtcclxuICAgICAgcGF0dGVybi5sb2NhdGlvbnMuc2hpZnQoKTtcclxuICAgICAgcGF0dGVybi5kZXZpY2VzLnNoaWZ0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9mE2KrYrdmC2YIg2YXZhiDZhtmF2Lcg2KfZhNmI2LXZiNmEINin2YTYt9io2YrYudmKXHJcbiAgICovXHJcbiAgX2lzTm9ybWFsQWNjZXNzUGF0dGVybihhdWRpdEVudHJ5KSB7XHJcbiAgICBjb25zdCBrZXkgPSBgJHthdWRpdEVudHJ5LnVzZXJJZH06JHthdWRpdEVudHJ5LmFjdGlvbn1gO1xyXG4gICAgY29uc3QgcGF0dGVybiA9IHRoaXMuYWNjZXNzUGF0dGVybnMuZ2V0KGtleSk7XHJcblxyXG4gICAgaWYgKCFwYXR0ZXJuIHx8IHBhdHRlcm4ub2NjdXJyZW5jZXMgPCA1KSB7XHJcbiAgICAgIHJldHVybiB0cnVlOyAvLyDZhNinINmK2YjYrNivINio2YrYp9mG2KfYqiDZg9in2YHZitipINmE2KrYrdiv2YrYryDZhdinINil2LDYpyDZg9in2YYg2LrZitixINi32KjZiti52YpcclxuICAgIH1cclxuXHJcbiAgICAvLyDYp9mE2KrYrdmC2YIg2YXZhiDYp9mE2LPYp9i52KlcclxuICAgIGNvbnN0IGN1cnJlbnRIb3VyID0gbmV3IERhdGUoKS5nZXRIb3VycygpO1xyXG4gICAgY29uc3QgYXZnSG91ciA9IE1hdGgucm91bmQoXHJcbiAgICAgIHBhdHRlcm4udGltZXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBwYXR0ZXJuLnRpbWVzLmxlbmd0aFxyXG4gICAgKTtcclxuXHJcbiAgICAvLyDYpdiw2Kcg2YPYp9mGINin2YTZiNi12YjZhCDZgdmKINij2YjZgtin2Kog2YXYrtiq2YTZgdipINis2K/Yp9mL2Iwg2YLYryDZitmD2YjZhiDYutmK2LEg2LfYqNmK2LnZilxyXG4gICAgaWYgKE1hdGguYWJzKGN1cnJlbnRIb3VyIC0gYXZnSG91cikgPiA2KSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4gICAqIFBSSVZBVEUgTUVUSE9EUyAtINin2YTYt9ix2YIg2KfZhNiu2KfYtdipXHJcbiAgICog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXHJcbiAgICovXHJcblxyXG4gIC8qKlxyXG4gICAqINit2LPYp9ioINiq2YjYstmK2Lkg2KfZhNij2K3Yr9in2KtcclxuICAgKi9cclxuICBfY2FsY3VsYXRlRXZlbnREaXN0cmlidXRpb24obG9ncykge1xyXG4gICAgY29uc3QgZGlzdHJpYnV0aW9uID0ge307XHJcblxyXG4gICAgbG9ncy5mb3JFYWNoKGxvZyA9PiB7XHJcbiAgICAgIGRpc3RyaWJ1dGlvbltsb2cuZXZlbnRUeXBlXSA9IChkaXN0cmlidXRpb25bbG9nLmV2ZW50VHlwZV0gfHwgMCkgKyAxO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGRpc3RyaWJ1dGlvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINit2LPYp9ioINmG2LTYp9i3INin2YTZhdiz2KrYrtiv2YVcclxuICAgKi9cclxuICBfY2FsY3VsYXRlVXNlckFjdGl2aXR5KGxvZ3MpIHtcclxuICAgIGNvbnN0IGFjdGl2aXR5ID0ge307XHJcblxyXG4gICAgbG9ncy5mb3JFYWNoKGxvZyA9PiB7XHJcbiAgICAgIGlmICghYWN0aXZpdHlbbG9nLnVzZXJJZF0pIHtcclxuICAgICAgICBhY3Rpdml0eVtsb2cudXNlcklkXSA9IHtcclxuICAgICAgICAgIHRvdGFsQWN0aW9uczogMCxcclxuICAgICAgICAgIHN1Y2Nlc3NmdWxBY3Rpb25zOiAwLFxyXG4gICAgICAgICAgZmFpbGVkQWN0aW9uczogMCxcclxuICAgICAgICAgIGFjdGlvbnM6IFtdXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYWN0aXZpdHlbbG9nLnVzZXJJZF0udG90YWxBY3Rpb25zKys7XHJcbiAgICAgIGlmIChsb2cuc3RhdHVzID09PSAnc3VjY2VzcycpIGFjdGl2aXR5W2xvZy51c2VySWRdLnN1Y2Nlc3NmdWxBY3Rpb25zKys7XHJcbiAgICAgIGlmIChsb2cuc3RhdHVzID09PSAnZmFpbHVyZScpIGFjdGl2aXR5W2xvZy51c2VySWRdLmZhaWxlZEFjdGlvbnMrKztcclxuXHJcbiAgICAgIGlmICghYWN0aXZpdHlbbG9nLnVzZXJJZF0uYWN0aW9ucy5pbmNsdWRlcyhsb2cuYWN0aW9uKSkge1xyXG4gICAgICAgIGFjdGl2aXR5W2xvZy51c2VySWRdLmFjdGlvbnMucHVzaChsb2cuYWN0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGFjdGl2aXR5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2K3Ys9in2Kgg2YbYtNin2Lcg2KfZhNmF2YjYsdivXHJcbiAgICovXHJcbiAgX2NhbGN1bGF0ZVJlc291cmNlQWN0aXZpdHkobG9ncykge1xyXG4gICAgY29uc3QgYWN0aXZpdHkgPSB7fTtcclxuXHJcbiAgICBsb2dzLmZvckVhY2gobG9nID0+IHtcclxuICAgICAgaWYgKCFhY3Rpdml0eVtsb2cucmVzb3VyY2VdKSB7XHJcbiAgICAgICAgYWN0aXZpdHlbbG9nLnJlc291cmNlXSA9IHtcclxuICAgICAgICAgIGFjY2Vzc2VzOiAwLFxyXG4gICAgICAgICAgbW9kaWZpY2F0aW9uczogMCxcclxuICAgICAgICAgIGRlbGV0aW9uczogMCxcclxuICAgICAgICAgIHVzZXJzOiBuZXcgU2V0KClcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhY3Rpdml0eVtsb2cucmVzb3VyY2VdLmFjY2Vzc2VzKys7XHJcbiAgICAgIGlmIChsb2cuYWN0aW9uID09PSAnREVMRVRFJykgYWN0aXZpdHlbbG9nLnJlc291cmNlXS5kZWxldGlvbnMrKztcclxuICAgICAgaWYgKGxvZy5hY3Rpb24gPT09ICdVUERBVEUnKSBhY3Rpdml0eVtsb2cucmVzb3VyY2VdLm1vZGlmaWNhdGlvbnMrKztcclxuICAgICAgYWN0aXZpdHlbbG9nLnJlc291cmNlXS51c2Vycy5hZGQobG9nLnVzZXJJZCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDYqtit2YjZitmEIFNldHMg2KXZhNmJIEFycmF5c1xyXG4gICAgT2JqZWN0LmtleXMoYWN0aXZpdHkpLmZvckVhY2gocmVzb3VyY2UgPT4ge1xyXG4gICAgICBhY3Rpdml0eVtyZXNvdXJjZV0udXNlcnMgPSBBcnJheS5mcm9tKGFjdGl2aXR5W3Jlc291cmNlXS51c2Vycyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gYWN0aXZpdHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtmI2YTZitivINin2YTYqtmI2LXZitin2KpcclxuICAgKi9cclxuICBfZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMobG9ncykge1xyXG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zID0gW107XHJcblxyXG4gICAgLy8g2YHYrdi1INmF2LnYr9mE2KfYqiDYp9mE2YHYtNmEINin2YTZhdix2KrZgdi52KlcclxuICAgIGNvbnN0IGZhaWx1cmVSYXRlID0gbG9ncy5maWx0ZXIoZSA9PiBlLnN0YXR1cyA9PT0gJ2ZhaWx1cmUnKS5sZW5ndGggLyBsb2dzLmxlbmd0aDtcclxuICAgIGlmIChmYWlsdXJlUmF0ZSA+IDAuMSkge1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XHJcbiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJyxcclxuICAgICAgICB0aXRsZTogJ9mF2LnYr9mEINmB2LTZhCDZhdix2KrZgdi5INmB2Yog2KfZhNmI2LXZiNmEJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogYNmF2LnYr9mEINin2YTZgdi02YQgJHsoZmFpbHVyZVJhdGUgKiAxMDApLnRvRml4ZWQoMil9JSDZgtivINmK2LTZitixINil2YTZiSDZhdi02KfZg9mEINmB2Yog2KfZhNiq2YPZiNmK2YZgLFxyXG4gICAgICAgIGFjdGlvbjogJ9mB2K3YtSDYp9mE2LPZitin2LPYp9iqINmI2KfZhNij2LDZiNmG2KfYqidcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g2YHYrdi1INin2YTYo9iv2YjYp9ixINin2YTZhdiz2KrYrtiv2YXYqSDYutmK2LEg2KfZhNmD2KfZgdmK2KlcclxuICAgIGNvbnN0IHJvbGVzQ291bnQgPSBuZXcgU2V0KGxvZ3MuZmxhdE1hcChlID0+IGUubWV0YWRhdGEucm9sZXMgfHwgW10pKS5zaXplO1xyXG4gICAgaWYgKHJvbGVzQ291bnQgPCA1KSB7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcclxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXHJcbiAgICAgICAgdGl0bGU6ICfYudiv2K8g2YXYrdiv2YjYryDZhdmGINin2YTYo9iv2YjYp9ixJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ9mC2K8g2KrYrdiq2KfYrCDYpdmE2Ykg2YXYstmK2K8g2YXZhiDYp9mE2KPYr9mI2KfYsSDYp9mE2YXYqtiu2LXYtdipJyxcclxuICAgICAgICBhY3Rpb246ICfZhdix2KfYrNi52Kkg2YfZitmD2YQg2KfZhNij2K/ZiNin2LEg2YjYp9mE2KPYsNmI2YbYp9iqJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2K3Ys9in2Kgg2LTYr9ipINin2YTYrdiv2KtcclxuICAgKi9cclxuICBfY2FsY3VsYXRlU2V2ZXJpdHkoZXZlbnRUeXBlKSB7XHJcbiAgICBjb25zdCBzZXZlcml0eU1hcCA9IHtcclxuICAgICAgJ1JPTEVfREVMRVRFRCc6ICdjcml0aWNhbCcsXHJcbiAgICAgICdQRVJNSVNTSU9OX1JFVk9LRUQnOiAnaGlnaCcsXHJcbiAgICAgICdVTkFVVEhPUklaRURfQUNDRVNTJzogJ2hpZ2gnLFxyXG4gICAgICAnUk9MRV9DUkVBVEVEJzogJ21lZGl1bScsXHJcbiAgICAgICdQRVJNSVNTSU9OX0FTU0lHTkVEJzogJ2xvdydcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHNldmVyaXR5TWFwW2V2ZW50VHlwZV0gfHwgJ2xvdyc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqti02LrZitmEINin2YTYqtmG2KjZitmH2KfYqlxyXG4gICAqL1xyXG4gIF90cmlnZ2VyQWxlcnQoaW5jaWRlbnQpIHtcclxuICAgIC8vINmK2YXZg9mGINiv2YXYrCDZhti42KfZhSDYp9mE2KrZhtio2YrZh9in2Kog2KfZhNiu2KfYsdis2Yog2YfZhtinXHJcbiAgICBjb25zb2xlLndhcm4oYPCfmqggU2VjdXJpdHkgQWxlcnQ6ICR7aW5jaWRlbnQudHlwZX1gLCBpbmNpZGVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtmI2YTZitivINmF2LnYsdmR2YEg2YHYsdmK2K9cclxuICAgKi9cclxuICBfZ2VuZXJhdGVJZCgpIHtcclxuICAgIHJldHVybiBgYXVkaXRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KjYr9ihINmF2KTZgtiqINin2YTYqtmG2LjZitmBXHJcbiAgICovXHJcbiAgc3RhcnRDbGVhbnVwVGltZXIoKSB7XHJcbiAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gdGhpcy5jb25maWcucmV0ZW50aW9uRGF5cyAqIDg2NDAwMDAwKTtcclxuXHJcbiAgICAgIC8vINiq2YbYuNmK2YEg2KfZhNiz2KzZhNin2Kog2KfZhNmC2K/ZitmF2KlcclxuICAgICAgY29uc3Qgb3JpZ2luYWxMZW5ndGggPSB0aGlzLmF1ZGl0TG9nLmxlbmd0aDtcclxuICAgICAgdGhpcy5hdWRpdExvZyA9IHRoaXMuYXVkaXRMb2cuZmlsdGVyKGUgPT4gZS50aW1lc3RhbXAgPiBjdXRvZmZEYXRlKTtcclxuXHJcbiAgICAgIGlmICh0aGlzLmF1ZGl0TG9nLmxlbmd0aCA8IG9yaWdpbmFsTGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYPCfp7kgQ2xlYW5lZCB1cCAke29yaWdpbmFsTGVuZ3RoIC0gdGhpcy5hdWRpdExvZy5sZW5ndGh9IG9sZCBhdWRpdCBlbnRyaWVzYCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINiq2YbYuNmK2YEg2KfZhNit2YjYp9iv2Ksg2KfZhNmC2K/ZitmF2KlcclxuICAgICAgY29uc3Qgb2xkSW5jaWRlbnRzTGVuZ3RoID0gdGhpcy5zZWN1cml0eUluY2lkZW50cy5sZW5ndGg7XHJcbiAgICAgIHRoaXMuc2VjdXJpdHlJbmNpZGVudHMgPSB0aGlzLnNlY3VyaXR5SW5jaWRlbnRzLmZpbHRlcihpID0+IGkucmVwb3J0ZWRBdCA+IGN1dG9mZkRhdGUpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuc2VjdXJpdHlJbmNpZGVudHMubGVuZ3RoIDwgb2xkSW5jaWRlbnRzTGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYPCfp7kgQ2xlYW5lZCB1cCAke29sZEluY2lkZW50c0xlbmd0aCAtIHRoaXMuc2VjdXJpdHlJbmNpZGVudHMubGVuZ3RofSBvbGQgaW5jaWRlbnRzYCk7XHJcbiAgICAgIH1cclxuICAgIH0sIDg2NDAwMDAwKTsgLy8g2KrYtNi62YrZhCDZitmI2YXZitin2YtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiq2LXYr9mK2LEg2LPYrNmE2KfYqiDYp9mE2KrYr9mC2YrZglxyXG4gICAqL1xyXG4gIGV4cG9ydEF1ZGl0TG9ncyhmb3JtYXQgPSAnanNvbicpIHtcclxuICAgIGlmIChmb3JtYXQgPT09ICdjc3YnKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9leHBvcnRBc0NTVigpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGV4cG9ydERhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgIHRvdGFsUmVjb3JkczogdGhpcy5hdWRpdExvZy5sZW5ndGgsXHJcbiAgICAgIGRhdGE6IHRoaXMuYXVkaXRMb2dcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqti12K/ZitixINio2LXZiti62KkgQ1NWXHJcbiAgICovXHJcbiAgX2V4cG9ydEFzQ1NWKCkge1xyXG4gICAgY29uc3QgaGVhZGVycyA9IFsnVGltZXN0YW1wJywgJ0V2ZW50VHlwZScsICdVc2VySWQnLCAnQWN0aW9uJywgJ1Jlc291cmNlJywgJ1N0YXR1cycsICdTZXZlcml0eSddO1xyXG4gICAgY29uc3Qgcm93cyA9IHRoaXMuYXVkaXRMb2cubWFwKGUgPT4gW1xyXG4gICAgICBlLnRpbWVzdGFtcC50b0lTT1N0cmluZygpLFxyXG4gICAgICBlLmV2ZW50VHlwZSxcclxuICAgICAgZS51c2VySWQsXHJcbiAgICAgIGUuYWN0aW9uLFxyXG4gICAgICBlLnJlc291cmNlLFxyXG4gICAgICBlLnN0YXR1cyxcclxuICAgICAgZS5zZXZlcml0eVxyXG4gICAgXSk7XHJcblxyXG4gICAgbGV0IGNzdiA9IGhlYWRlcnMuam9pbignLCcpICsgJ1xcbic7XHJcbiAgICByb3dzLmZvckVhY2gocm93ID0+IHtcclxuICAgICAgY3N2ICs9IHJvdy5tYXAoY2VsbCA9PiBgXCIke2NlbGx9XCJgKS5qb2luKCcsJykgKyAnXFxuJztcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBjc3Y7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YTYrti1INin2YTYo9mF2KfZhlxyXG4gICAqL1xyXG4gIGdldFNlY3VyaXR5U3VtbWFyeSgpIHtcclxuICAgIGNvbnN0IGxhc3Q3RGF5cyA9IHRoaXMuYXVkaXRMb2cuZmlsdGVyKGUgPT5cclxuICAgICAgZS50aW1lc3RhbXAgPiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNjA0ODAwMDAwKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBsYXN0MzBEYXlzID0gdGhpcy5hdWRpdExvZy5maWx0ZXIoZSA9PlxyXG4gICAgICBlLnRpbWVzdGFtcCA+IG5ldyBEYXRlKERhdGUubm93KCkgLSAyNTkyMDAwMDAwKVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsYXN0N0RheXM6IHtcclxuICAgICAgICB0b3RhbEV2ZW50czogbGFzdDdEYXlzLmxlbmd0aCxcclxuICAgICAgICBmYWlsdXJlczogbGFzdDdEYXlzLmZpbHRlcihlID0+IGUuc3RhdHVzID09PSAnZmFpbHVyZScpLmxlbmd0aCxcclxuICAgICAgICBjcml0aWNhbEV2ZW50czogbGFzdDdEYXlzLmZpbHRlcihlID0+IGUuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpLmxlbmd0aFxyXG4gICAgICB9LFxyXG4gICAgICBsYXN0MzBEYXlzOiB7XHJcbiAgICAgICAgdG90YWxFdmVudHM6IGxhc3QzMERheXMubGVuZ3RoLFxyXG4gICAgICAgIGZhaWx1cmVzOiBsYXN0MzBEYXlzLmZpbHRlcihlID0+IGUuc3RhdHVzID09PSAnZmFpbHVyZScpLmxlbmd0aCxcclxuICAgICAgICBjcml0aWNhbEV2ZW50czogbGFzdDMwRGF5cy5maWx0ZXIoZSA9PiBlLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKS5sZW5ndGhcclxuICAgICAgfSxcclxuICAgICAgYWN0aXZlSW5jaWRlbnRzOiB0aGlzLmdldFNlY3VyaXR5SW5jaWRlbnRzKHsgc3RhdHVzOiAnb3BlbicgfSkubGVuZ3RoLFxyXG4gICAgICBoaWdoUmlza0luY2lkZW50czogdGhpcy5nZXRTZWN1cml0eUluY2lkZW50cyh7IHNldmVyaXR5OiAnaGlnaCcgfSkubGVuZ3RoXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYs9is2YQg2KfZhNmI2LXZiNmEINmE2YTZhdiz2KrYrtiv2YVcclxuICAgKi9cclxuICBnZXRVc2VyQWNjZXNzSGlzdG9yeSh1c2VySWQsIGxpbWl0ID0gNTApIHtcclxuICAgIGNvbnN0IHVzZXJMb2dzID0gdGhpcy5hdWRpdExvZ1xyXG4gICAgICAuZmlsdGVyKGUgPT4gZS51c2VySWQgPT09IHVzZXJJZClcclxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wIC0gYS50aW1lc3RhbXApXHJcbiAgICAgIC5zbGljZSgwLCBsaW1pdCk7XHJcblxyXG4gICAgcmV0dXJuIHVzZXJMb2dzLm1hcChsb2cgPT4gKHtcclxuICAgICAgaWQ6IGxvZy5pZCxcclxuICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLFxyXG4gICAgICBhY3Rpb246IGxvZy5hY3Rpb24sXHJcbiAgICAgIHJlc291cmNlOiBsb2cucmVzb3VyY2UsXHJcbiAgICAgIHJlc291cmNlSWQ6IGxvZy5yZXNvdXJjZUlkLFxyXG4gICAgICBzdGF0dXM6IGxvZy5zdGF0dXMsXHJcbiAgICAgIGlwQWRkcmVzczogbG9nLmlwQWRkcmVzcyxcclxuICAgICAgdXNlckFnZW50OiBsb2cudXNlckFnZW50LFxyXG4gICAgICBzZXZlcml0eTogbG9nLnNldmVyaXR5XHJcbiAgICB9KSk7XHJcbiAgfVxyXG59XHJcblxy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