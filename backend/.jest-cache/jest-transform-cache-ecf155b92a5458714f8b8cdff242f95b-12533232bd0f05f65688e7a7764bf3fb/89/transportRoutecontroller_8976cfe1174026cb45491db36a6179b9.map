{"version":3,"names":["TransportRoute","require","RouteOptimizationService","TransportRouteController","createRoute","req","res","body","stops","Array","isArray","stop","location","coordinates","lon","lat","status","json","success","message","stopNumber","route","length","totalDistance","i","coords1","coords2","distance","calculateHaversineDistance","Math","round","save","data","error","code","field","Object","keys","keyPattern","coord1","coord2","R","lat1","PI","lat2","deltaLat","deltaLon","a","sin","cos","c","atan2","sqrt","getAllRoutes","type","search","page","limit","sortBy","sortOrder","query","$or","routeName","$regex","$options","routeCode","sortObj","sortDirection","routes","find","populate","skip","sort","count","countDocuments","totalPages","ceil","total","currentPage","parseInt","getRouteById","findById","params","id","getNearbyPoints","latitude","longitude","radius","undefined","parseFloat","isNaN","nearbyPoints","filter","stopLon","stopLat","dLat","dLon","totalStops","foundCount","updateRoute","findByIdAndUpdate","new","runValidators","deleteRoute","findByIdAndDelete","updateRouteStatus","validStatuses","includes","optimizeRoute","options","optimization","lastOptimized","Date","optimizationScore","score","suggestedChanges","suggestions","map","s","description","estimatedImprovement","console","addPassenger","userId","pickupStop","dropoffStop","preferences","result","removePassenger","updateTripStatus","delayMinutes","statistics","addRating","rating","comment","averageRating","totalRatings","findNearbyRoutes","maxDistance","findAvailableRoutes","date","findAvailable","getAllRoutesStatistics","active","r","inactive","byType","morning","afternoon","evening","special","reduce","sum","averageDistance","suggestAlternatives","passengerNeeds","alternatives","suggestAlternativeRoutes","getRouteStatistics","stats","basic","capacity","current","available","calculateAvailableCapacity","utilizationRate","toFixed","performance","totalTrips","completedTrips","cancelledTrips","completionRate","onTimePercentage","averageDelay","averageDelayMinutes","pendingSuggestions","passengers","totalServed","totalPassengersServed","passengerCount","stopCount","average","assignVehicle","vehicleId","assignedVehicle","module","exports"],"sources":["transportRoute.controller.js"],"sourcesContent":["/**\r\n * Transport Route Controller - إدارة مسارات النقل\r\n */\r\n\r\nconst TransportRoute = require('../models/TransportRoute');\r\nconst RouteOptimizationService = require('../services/routeOptimization.service');\r\n\r\nclass TransportRouteController {\r\n  /**\r\n   * إنشاء مسار جديد\r\n   * POST /api/transport-routes\r\n   */\r\n  static async createRoute(req, res) {\r\n    try {\r\n      // Validate coordinates in stops\r\n      if (req.body.stops && Array.isArray(req.body.stops)) {\r\n        for (const stop of req.body.stops) {\r\n          if (stop.location && stop.location.coordinates) {\r\n            const [lon, lat] = stop.location.coordinates;\r\n            // Validate latitude (-90 to 90) and longitude (-180 to 180)\r\n            if (lat < -90 || lat > 90 || lon < -180 || lon > 180) {\r\n              return res.status(400).json({\r\n                success: false,\r\n                message: `Invalid coordinates for stop ${stop.stopNumber}: latitude must be between -90 and 90, longitude between -180 and 180`,\r\n              });\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      const route = new TransportRoute(req.body);\r\n\r\n      // Auto-calculate total distance if stops exist\r\n      if (route.stops && route.stops.length > 1) {\r\n        let totalDistance = 0;\r\n        for (let i = 0; i < route.stops.length - 1; i++) {\r\n          const coords1 = route.stops[i].location.coordinates;\r\n          const coords2 = route.stops[i + 1].location.coordinates;\r\n          const distance = TransportRouteController.calculateHaversineDistance(coords1, coords2);\r\n          totalDistance += distance;\r\n        }\r\n        route.totalDistance = Math.round(totalDistance * 10) / 10; // Round to 1 decimal place\r\n      } else if (route.stops && route.stops.length === 1) {\r\n        // Single stop or no distance\r\n        route.totalDistance = route.totalDistance || 0;\r\n      }\r\n\r\n      await route.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'تم إنشاء المسار بنجاح',\r\n        data: route,\r\n      });\r\n    } catch (error) {\r\n      // Handle duplicate key errors\r\n      if (error.code === 11000) {\r\n        const field = Object.keys(error.keyPattern)[0];\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: `${field} already exists`,\r\n          error: error.message,\r\n        });\r\n      }\r\n\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إنشاء المسار',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Haversine formula to calculate distance between two coordinates\r\n   */\r\n  static calculateHaversineDistance(coord1, coord2) {\r\n    const R = 6371; // Earth's radius in km\r\n    const lat1 = (coord1[1] * Math.PI) / 180;\r\n    const lat2 = (coord2[1] * Math.PI) / 180;\r\n    const deltaLat = ((coord2[1] - coord1[1]) * Math.PI) / 180;\r\n    const deltaLon = ((coord2[0] - coord1[0]) * Math.PI) / 180;\r\n\r\n    const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\r\n              Math.cos(lat1) * Math.cos(lat2) *\r\n              Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    const distance = R * c;\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * جلب جميع المسارات\r\n   * GET /api/transport-routes\r\n   */\r\n  static async getAllRoutes(req, res) {\r\n    try {\r\n      const { status, type, search, page = 1, limit = 20, sortBy = 'createdAt', sortOrder = 'desc' } = req.query;\r\n      const query = {};\r\n\r\n      if (status) query.status = status;\r\n      if (type) query.type = type;\r\n      \r\n      // Search by route name or code\r\n      if (search) {\r\n        query.$or = [\r\n          { routeName: { $regex: search, $options: 'i' } },\r\n          { routeCode: { $regex: search, $options: 'i' } }\r\n        ];\r\n      }\r\n\r\n      // Build sort object\r\n      const sortObj = {};\r\n      const sortDirection = sortOrder === 'asc' ? 1 : -1;\r\n      sortObj[sortBy] = sortDirection;\r\n\r\n      const routes = await TransportRoute.find(query)\r\n        .populate('assignedVehicle', 'vehicleNumber plateNumber type')\r\n        .populate('assignedDriver', 'name email phone')\r\n        .limit(limit * 1)\r\n        .skip((page - 1) * limit)\r\n        .sort(sortObj);\r\n\r\n      const count = await TransportRoute.countDocuments(query);\r\n      const totalPages = Math.ceil(count / limit);\r\n\r\n      res.json({\r\n        success: true,\r\n        data: {\r\n          routes,\r\n          total: count,\r\n          currentPage: parseInt(page),\r\n          totalPages: totalPages,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب المسارات',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب مسار بواسطة ID\r\n   * GET /api/transport-routes/:id\r\n   */\r\n  static async getRouteById(req, res) {\r\n    try {\r\n      const route = await TransportRoute.findById(req.params.id)\r\n        .populate('assignedVehicle')\r\n        .populate('assignedDriver', 'name email phone')\r\n        .populate('passengers.user', 'name email phone');\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        data: route,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب المسار',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب نقاط قريبة من المسار\r\n   * GET /api/transport-routes/:id/nearby\r\n   */\r\n  static async getNearbyPoints(req, res) {\r\n    try {\r\n      const { latitude, longitude, radius = 5000 } = req.query;\r\n\r\n      // Validate coordinates\r\n      if (latitude === undefined || longitude === undefined) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'latitude و longitude مطلوبان',\r\n        });\r\n      }\r\n\r\n      const lat = parseFloat(latitude);\r\n      const lon = parseFloat(longitude);\r\n\r\n      if (isNaN(lat) || isNaN(lon) || lat < -90 || lat > 90 || lon < -180 || lon > 180) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'إحداثيات غير صحيحة',\r\n        });\r\n      }\r\n\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      // Find stops near the given coordinates\r\n      const nearbyPoints = route.stops.filter(stop => {\r\n        if (!stop.location || !stop.location.coordinates) return false;\r\n        const [stopLon, stopLat] = stop.location.coordinates;\r\n        \r\n        // Simple distance calculation (Haversine formula)\r\n        const R = 6371000; // Earth radius in meters\r\n        const dLat = (stopLat - lat) * Math.PI / 180;\r\n        const dLon = (stopLon - lon) * Math.PI / 180;\r\n        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n          Math.cos(lat * Math.PI / 180) * Math.cos(stopLat * Math.PI / 180) *\r\n          Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n        const distance = R * c;\r\n\r\n        return distance <= radius;\r\n      });\r\n\r\n      res.json({\r\n        success: true,\r\n        data: {\r\n          nearbyPoints,\r\n          totalStops: route.stops.length,\r\n          foundCount: nearbyPoints.length,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب النقاط القريبة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث مسار\r\n   * PUT /api/transport-routes/:id\r\n   */\r\n  static async updateRoute(req, res) {\r\n    try {\r\n      const route = await TransportRoute.findByIdAndUpdate(req.params.id, req.body, {\r\n        new: true,\r\n        runValidators: true,\r\n      });\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث المسار بنجاح',\r\n        data: route,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تحديث المسار',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حذف مسار\r\n   * DELETE /api/transport-routes/:id\r\n   */\r\n  static async deleteRoute(req, res) {\r\n    try {\r\n      const route = await TransportRoute.findByIdAndDelete(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم حذف المسار بنجاح',\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل حذف المسار',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث حالة المسار\r\n   * PATCH /api/transport-routes/:id/status\r\n   */\r\n  static async updateRouteStatus(req, res) {\r\n    try {\r\n      const { status } = req.body;\r\n      const validStatuses = ['active', 'inactive', 'maintenance', 'archived'];\r\n\r\n      if (!status || !validStatuses.includes(status)) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'حالة المسار غير صحيحة',\r\n        });\r\n      }\r\n\r\n      const route = await TransportRoute.findByIdAndUpdate(\r\n        req.params.id,\r\n        { status },\r\n        { new: true }\r\n      );\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث حالة المسار بنجاح',\r\n        data: route,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل تحديث حالة المسار',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحسين المسار\r\n   * POST /api/transport-routes/:id/optimize\r\n   */\r\n  static async optimizeRoute(req, res) {\r\n    try {\r\n      const route = await TransportRoute.findById(req.params.id).populate('assignedVehicle');\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      const options = req.body.options || {};\r\n      const optimization = await RouteOptimizationService.optimizeRoute(route, options);\r\n\r\n      if (!optimization) {\r\n        return res.status(500).json({\r\n          success: false,\r\n          message: 'فشل حساب تحسين المسار',\r\n        });\r\n      }\r\n\r\n      // تحديث بيانات التحسين\r\n      if (!route.optimization) {\r\n        route.optimization = {};\r\n      }\r\n      \r\n      route.optimization.lastOptimized = new Date();\r\n      route.optimization.optimizationScore = optimization.score || 0;\r\n      route.optimization.suggestedChanges = (optimization.suggestions || []).map(s => ({\r\n        type: s.type || 'unknown',\r\n        description: s.description || '',\r\n        estimatedImprovement: s.estimatedImprovement || 0,\r\n        status: 'pending',\r\n      }));\r\n\r\n      await route.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحسين المسار بنجاح',\r\n        data: {\r\n          score: optimization.score,\r\n          suggestions: optimization.suggestions,\r\n          route: route,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error('Optimize error:', error.message);\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تحسين المسار',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إضافة راكب للمسار\r\n   * POST /api/transport-routes/:id/passengers\r\n   */\r\n  static async addPassenger(req, res) {\r\n    try {\r\n      const { userId, pickupStop, dropoffStop, preferences } = req.body;\r\n\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      const result = route.addPassenger(userId, pickupStop, dropoffStop, preferences);\r\n\r\n      if (!result.success) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: result.message,\r\n        });\r\n      }\r\n\r\n      await route.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'تم إضافة الراكب بنجاح',\r\n        data: route,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إضافة الراكب',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إزالة راكب من المسار\r\n   * DELETE /api/transport-routes/:id/passengers/:userId\r\n   */\r\n  static async removePassenger(req, res) {\r\n    try {\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      route.removePassenger(req.params.userId);\r\n      await route.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم إزالة الراكب بنجاح',\r\n        data: route,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إزالة الراكب',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث حالة الرحلة\r\n   * POST /api/transport-routes/:id/trip-status\r\n   */\r\n  static async updateTripStatus(req, res) {\r\n    try {\r\n      const { status, delayMinutes } = req.body;\r\n\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      route.updateTripStatus(status, delayMinutes);\r\n      await route.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث حالة الرحلة بنجاح',\r\n        data: {\r\n          statistics: route.statistics,\r\n          status: route.status,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تحديث حالة الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إضافة تقييم للمسار\r\n   * POST /api/transport-routes/:id/rating\r\n   */\r\n  static async addRating(req, res) {\r\n    try {\r\n      const { userId, rating, comment } = req.body;\r\n\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      route.addRating(userId, rating, comment);\r\n      await route.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'تم إضافة التقييم بنجاح',\r\n        data: {\r\n          averageRating: route.averageRating,\r\n          totalRatings: route.totalRatings,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إضافة التقييم',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * البحث عن مسارات قريبة\r\n   * GET /api/transport-routes/nearby\r\n   */\r\n  static async findNearbyRoutes(req, res) {\r\n    try {\r\n      const { longitude, latitude, maxDistance = 1000 } = req.query;\r\n\r\n      if (!longitude || !latitude) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'الإحداثيات مطلوبة',\r\n        });\r\n      }\r\n\r\n      const routes = await TransportRoute.findNearbyRoutes(\r\n        parseFloat(longitude),\r\n        parseFloat(latitude),\r\n        parseInt(maxDistance)\r\n      );\r\n\r\n      res.json({\r\n        success: true,\r\n        data: routes,\r\n        count: routes.length,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل البحث عن المسارات',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * البحث عن مسارات متاحة\r\n   * GET /api/transport-routes/available\r\n   */\r\n  static async findAvailableRoutes(req, res) {\r\n    try {\r\n      const { date, type } = req.query;\r\n\r\n      const routes = await TransportRoute.findAvailable(date ? new Date(date) : new Date(), type);\r\n\r\n      res.json({\r\n        success: true,\r\n        data: routes,\r\n        count: routes.length,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل البحث عن المسارات المتاحة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب إحصائيات جميع المسارات\r\n   * GET /api/transport-routes/statistics\r\n   */\r\n  static async getAllRoutesStatistics(req, res) {\r\n    try {\r\n      const routes = await TransportRoute.find();\r\n\r\n      const statistics = {\r\n        total: routes.length,\r\n        active: routes.filter(r => r.status === 'active').length,\r\n        inactive: routes.filter(r => r.status === 'inactive').length,\r\n        byType: {\r\n          morning: routes.filter(r => r.type === 'morning').length,\r\n          afternoon: routes.filter(r => r.type === 'afternoon').length,\r\n          evening: routes.filter(r => r.type === 'evening').length,\r\n          special: routes.filter(r => r.type === 'special').length,\r\n        },\r\n        totalDistance: routes.reduce((sum, r) => sum + (r.totalDistance || 0), 0),\r\n        averageDistance: routes.length > 0 \r\n          ? routes.reduce((sum, r) => sum + (r.totalDistance || 0), 0) / routes.length\r\n          : 0,\r\n      };\r\n\r\n      res.json({\r\n        success: true,\r\n        data: statistics,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب إحصائيات المسارات',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * اقتراح مسارات بديلة\r\n   * POST /api/transport-routes/:id/alternatives\r\n   */\r\n  static async suggestAlternatives(req, res) {\r\n    try {\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      const { passengerNeeds } = req.body;\r\n      const alternatives = await RouteOptimizationService.suggestAlternativeRoutes(\r\n        route,\r\n        passengerNeeds\r\n      );\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم إنشاء المسارات البديلة بنجاح',\r\n        data: alternatives,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل إنشاء المسارات البديلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إحصائيات المسار\r\n   * GET /api/transport-routes/:id/statistics\r\n   */\r\n  static async getRouteStatistics(req, res) {\r\n    try {\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      const stats = {\r\n        basic: {\r\n          routeName: route.routeName,\r\n          routeCode: route.routeCode,\r\n          type: route.type,\r\n          status: route.status,\r\n        },\r\n        capacity: {\r\n          total: route.capacity.total,\r\n          current: route.capacity.current,\r\n          available: route.calculateAvailableCapacity(),\r\n          utilizationRate: ((route.capacity.current / route.capacity.total) * 100).toFixed(2),\r\n        },\r\n        performance: {\r\n          totalTrips: route.statistics.totalTrips,\r\n          completedTrips: route.statistics.completedTrips,\r\n          cancelledTrips: route.statistics.cancelledTrips,\r\n          completionRate: (\r\n            (route.statistics.completedTrips / (route.statistics.totalTrips || 1)) *\r\n            100\r\n          ).toFixed(2),\r\n          onTimePercentage: route.statistics.onTimePercentage,\r\n          averageDelay: route.statistics.averageDelayMinutes,\r\n        },\r\n        optimization: {\r\n          score: route.optimization.optimizationScore,\r\n          lastOptimized: route.optimization.lastOptimized,\r\n          pendingSuggestions: route.optimization.suggestedChanges.filter(\r\n            s => s.status === 'pending'\r\n          ).length,\r\n        },\r\n        passengers: {\r\n          totalServed: route.statistics.totalPassengersServed,\r\n          current: route.passengerCount,\r\n          stops: route.stopCount,\r\n        },\r\n        rating: {\r\n          average: route.averageRating,\r\n          total: route.totalRatings,\r\n        },\r\n      };\r\n\r\n      res.json({\r\n        success: true,\r\n        data: stats,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب إحصائيات المسار',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تعيين مركبة للمسار\r\n   * POST /api/transport-routes/:id/assign-vehicle\r\n   */\r\n  static async assignVehicle(req, res) {\r\n    try {\r\n      const { vehicleId } = req.body;\r\n\r\n      const route = await TransportRoute.findById(req.params.id);\r\n\r\n      if (!route) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'المسار غير موجود',\r\n        });\r\n      }\r\n\r\n      route.assignedVehicle = vehicleId;\r\n      await route.save();\r\n\r\n      await route.populate('assignedVehicle', 'vehicleNumber plateNumber type capacity');\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تعيين المركبة بنجاح',\r\n        data: route,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تعيين المركبة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = TransportRouteController;\r\n"],"mappings":"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","ignoreList":[]}