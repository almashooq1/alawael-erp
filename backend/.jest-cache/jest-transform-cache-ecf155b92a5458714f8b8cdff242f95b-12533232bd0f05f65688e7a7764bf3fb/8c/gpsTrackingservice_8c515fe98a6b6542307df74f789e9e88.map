{"version":3,"names":["GPSTrackingService","updateVehicleLocation","vehicle","location","speed","heading","update","timestamp","Date","alerts","speedAlert","checkSpeeding","push","currentRoute","deviationAlert","checkRouteDeviation","updateGPSLocation","speedLimits","highway","city","residential","school_zone","zoneType","detectZoneType","limit","type","severity","message","currentLocation","route","path","maxDeviation","distanceFromRoute","calculateDistanceFromPath","coordinates","Math","round","analyzeDrivingBehavior","trip","gpsData","analysis","speedingIncidents","harshBraking","harshAcceleration","smoothDriving","idleTime","score","i","length","prev","curr","timeDiff","speedChange","acceleration","abs","smoothDrivingPercentage","max","min","identifyDangerousZones","trips","zones","forEach","incidents","incident","key","getGridKey","incidentCount","types","Object","values","filter","zone","sort","a","b","calculateETA","destination","gpsDevice","Error","distance","calculateDistance","averageSpeed","statistics","trafficFactor","getTrafficFactor","estimatedTime","eta","now","confidence","monitorSafety","action","fuelLevel","fuelConsumption","currentFuelLevel","maintenanceStatus","dangerousZones","checkDangerousZone","generateDriverReport","driver","startDate","endDate","Trip","require","find","_id","actualStartTime","$gte","$lte","report","id","name","email","period","totalTrips","completedTrips","t","status","totalDistance","totalDuration","averageScore","speeding","accidents","breakdowns","fuelEfficiency","safetyRating","driverBehavior","harshBrakingCount","harshAccelerationCount","fuelData","efficiency","calculateSafetyRating","rating","completionRate","point1","point2","lon1","lat1","lon2","lat2","R","dLat","toRad","dLon","sin","cos","c","atan2","sqrt","degrees","PI","point","pathCoordinates","minDistance","Infinity","distanceToSegment","segmentStart","segmentEnd","x","y","x1","y1","x2","y2","A","B","C","D","dot","lenSq","param","xx","yy","dx","dy","lon","lat","floor","start","end","hour","getHours","isPeakHour","module","exports"],"sources":["gpsTracking.service.js"],"sourcesContent":["/**\r\n * خدمة تتبع GPS وتحليل سلوك السائق\r\n * GPS Tracking & Driver Behavior Analysis Service\r\n */\r\n\r\nclass GPSTrackingService {\r\n  /**\r\n   * تحديث موقع المركبة في الوقت الفعلي\r\n   * @param {Object} vehicle - المركبة\r\n   * @param {Object} location - الموقع الجديد\r\n   * @param {Number} speed - السرعة الحالية\r\n   * @param {Number} heading - الاتجاه\r\n   * @returns {Object} - نتيجة التحديث\r\n   */\r\n  static async updateVehicleLocation(vehicle, location, speed, heading) {\r\n    const update = {\r\n      timestamp: new Date(),\r\n      location,\r\n      speed,\r\n      heading,\r\n      alerts: []\r\n    };\r\n\r\n    // 1. فحص السرعة الزائدة\r\n    const speedAlert = this.checkSpeeding(speed, location);\r\n    if (speedAlert) {\r\n      update.alerts.push(speedAlert);\r\n    }\r\n\r\n    // 2. فحص الانحراف عن المسار\r\n    if (vehicle.currentRoute) {\r\n      const deviationAlert = await this.checkRouteDeviation(vehicle, location);\r\n      if (deviationAlert) {\r\n        update.alerts.push(deviationAlert);\r\n      }\r\n    }\r\n\r\n    // 3. تحديث موقع المركبة\r\n    await vehicle.updateGPSLocation(location, speed, heading);\r\n\r\n    return update;\r\n  }\r\n\r\n  /**\r\n   * فحص السرعة الزائدة\r\n   */\r\n  static checkSpeeding(speed, location) {\r\n    const speedLimits = {\r\n      highway: 120,\r\n      city: 80,\r\n      residential: 60,\r\n      school_zone: 40\r\n    };\r\n\r\n    // تحديد نوع المنطقة (محاكاة - يمكن دمج مع API)\r\n    const zoneType = this.detectZoneType(location);\r\n    const limit = speedLimits[zoneType] || 100;\r\n\r\n    if (speed > limit) {\r\n      return {\r\n        type: 'speeding',\r\n        severity: speed > limit + 20 ? 'critical' : 'medium',\r\n        message: `تجاوز السرعة المسموحة (${speed} كم/س - الحد المسموح ${limit} كم/س)`,\r\n        location,\r\n        timestamp: new Date()\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * فحص الانحراف عن المسار\r\n   */\r\n  static async checkRouteDeviation(vehicle, currentLocation) {\r\n    const route = vehicle.currentRoute;\r\n    if (!route || !route.path) return null;\r\n\r\n    const maxDeviation = 500; // 500 متر\r\n    const distanceFromRoute = this.calculateDistanceFromPath(\r\n      currentLocation,\r\n      route.path.coordinates\r\n    );\r\n\r\n    if (distanceFromRoute > maxDeviation) {\r\n      return {\r\n        type: 'route_deviation',\r\n        severity: 'high',\r\n        message: `انحراف عن المسار المحدد (${Math.round(distanceFromRoute)} متر)`,\r\n        location: currentLocation,\r\n        timestamp: new Date()\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * تحليل سلوك السائق\r\n   * @param {Object} trip - الرحلة\r\n   * @param {Array} gpsData - بيانات GPS\r\n   * @returns {Object} - تحليل السلوك\r\n   */\r\n  static analyzeDrivingBehavior(trip, gpsData) {\r\n    const analysis = {\r\n      speedingIncidents: 0,\r\n      harshBraking: 0,\r\n      harshAcceleration: 0,\r\n      smoothDriving: 0,\r\n      idleTime: 0,\r\n      score: 100\r\n    };\r\n\r\n    // تحليل التسارع والفرملة\r\n    for (let i = 1; i < gpsData.length; i++) {\r\n      const prev = gpsData[i - 1];\r\n      const curr = gpsData[i];\r\n      \r\n      const timeDiff = (curr.timestamp - prev.timestamp) / 1000; // بالثواني\r\n      const speedChange = curr.speed - prev.speed;\r\n      const acceleration = speedChange / timeDiff;\r\n\r\n      // فحص الفرملة المفاجئة\r\n      if (acceleration < -8) {\r\n        analysis.harshBraking++;\r\n        analysis.score -= 5;\r\n      }\r\n\r\n      // فحص التسارع المفاجئ\r\n      if (acceleration > 8) {\r\n        analysis.harshAcceleration++;\r\n        analysis.score -= 5;\r\n      }\r\n\r\n      // فحص السرعة الزائدة\r\n      if (curr.speed > 100) {\r\n        analysis.speedingIncidents++;\r\n        analysis.score -= 10;\r\n      }\r\n\r\n      // فحص التوقف (السرعة = 0)\r\n      if (curr.speed === 0 && timeDiff > 60) {\r\n        analysis.idleTime += timeDiff;\r\n      }\r\n\r\n      // القيادة السلسة\r\n      if (Math.abs(acceleration) < 2) {\r\n        analysis.smoothDriving++;\r\n      }\r\n    }\r\n\r\n    // حساب النسبة المئوية للقيادة السلسة\r\n    analysis.smoothDrivingPercentage = \r\n      (analysis.smoothDriving / gpsData.length) * 100;\r\n\r\n    // تعديل النتيجة بناءً على القيادة السلسة\r\n    if (analysis.smoothDrivingPercentage > 80) {\r\n      analysis.score += 10;\r\n    }\r\n\r\n    // التأكد من عدم تجاوز الحدود\r\n    analysis.score = Math.max(0, Math.min(100, analysis.score));\r\n\r\n    return analysis;\r\n  }\r\n\r\n  /**\r\n   * تحديد المناطق الخطرة\r\n   * @param {Array} trips - الرحلات\r\n   * @returns {Array} - المناطق الخطرة\r\n   */\r\n  static identifyDangerousZones(trips) {\r\n    const zones = {};\r\n\r\n    trips.forEach(trip => {\r\n      trip.incidents?.forEach(incident => {\r\n        if (!incident.location) return;\r\n\r\n        const key = this.getGridKey(incident.location.coordinates);\r\n        \r\n        if (!zones[key]) {\r\n          zones[key] = {\r\n            location: incident.location,\r\n            incidentCount: 0,\r\n            types: {}\r\n          };\r\n        }\r\n\r\n        zones[key].incidentCount++;\r\n        zones[key].types[incident.type] = \r\n          (zones[key].types[incident.type] || 0) + 1;\r\n      });\r\n    });\r\n\r\n    // تحويل إلى مصفوفة وترتيب حسب عدد الحوادث\r\n    return Object.values(zones)\r\n      .filter(zone => zone.incidentCount >= 3)\r\n      .sort((a, b) => b.incidentCount - a.incidentCount);\r\n  }\r\n\r\n  /**\r\n   * التنبؤ بوقت الوصول (ETA)\r\n   * @param {Object} vehicle - المركبة\r\n   * @param {Object} destination - الوجهة\r\n   * @returns {Object} - وقت الوصول المتوقع\r\n   */\r\n  static async calculateETA(vehicle, destination) {\r\n    const currentLocation = vehicle.gpsDevice?.currentLocation?.coordinates;\r\n    if (!currentLocation) {\r\n      throw new Error('موقع المركبة الحالي غير متاح');\r\n    }\r\n\r\n    const distance = this.calculateDistance(currentLocation, destination.coordinates);\r\n    const averageSpeed = vehicle.statistics?.averageSpeed || 50;\r\n    const trafficFactor = await this.getTrafficFactor(currentLocation, destination.coordinates);\r\n\r\n    const estimatedTime = (distance / (averageSpeed * trafficFactor)) * 60; // بالدقائق\r\n    const eta = new Date(Date.now() + estimatedTime * 60000);\r\n\r\n    return {\r\n      distance: Math.round(distance * 10) / 10,\r\n      estimatedTime: Math.round(estimatedTime),\r\n      eta,\r\n      confidence: trafficFactor > 0.8 ? 'high' : 'medium'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * مراقبة السلامة في الوقت الفعلي\r\n   */\r\n  static async monitorSafety(vehicle, trip) {\r\n    const alerts = [];\r\n    const currentLocation = vehicle.gpsDevice?.currentLocation;\r\n\r\n    if (!currentLocation) return alerts;\r\n\r\n    // 1. فحص سرعة المركبة\r\n    const speed = currentLocation.speed || 0;\r\n    if (speed > 120) {\r\n      alerts.push({\r\n        type: 'critical_speed',\r\n        severity: 'critical',\r\n        message: 'سرعة خطيرة جداً',\r\n        action: 'إيقاف المركبة فوراً'\r\n      });\r\n    }\r\n\r\n    // 2. فحص حالة الوقود\r\n    const fuelLevel = vehicle.fuelConsumption?.currentFuelLevel || 0;\r\n    if (fuelLevel < 10) {\r\n      alerts.push({\r\n        type: 'low_fuel',\r\n        severity: 'high',\r\n        message: 'مستوى الوقود منخفض جداً',\r\n        action: 'التوجه لأقرب محطة وقود'\r\n      });\r\n    }\r\n\r\n    // 3. فحص موعد الصيانة\r\n    const maintenanceStatus = vehicle.maintenanceStatus;\r\n    if (maintenanceStatus === 'overdue') {\r\n      alerts.push({\r\n        type: 'maintenance_overdue',\r\n        severity: 'high',\r\n        message: 'موعد الصيانة متأخر',\r\n        action: 'حجز موعد صيانة فوري'\r\n      });\r\n    }\r\n\r\n    // 4. فحص وجود حوادث سابقة في المنطقة\r\n    const dangerousZones = await this.checkDangerousZone(currentLocation);\r\n    if (dangerousZones) {\r\n      alerts.push({\r\n        type: 'dangerous_zone',\r\n        severity: 'medium',\r\n        message: 'منطقة بها حوادث متكررة - الحذر مطلوب',\r\n        action: 'قيادة بحذر شديد'\r\n      });\r\n    }\r\n\r\n    return alerts;\r\n  }\r\n\r\n  /**\r\n   * إنشاء تقرير سلوك السائق\r\n   */\r\n  static async generateDriverReport(driver, startDate, endDate) {\r\n    // جلب جميع الرحلات في الفترة المحددة\r\n    const Trip = require('../models/Trip');\r\n    const trips = await Trip.find({\r\n      driver: driver._id,\r\n      actualStartTime: { $gte: startDate, $lte: endDate }\r\n    });\r\n\r\n    const report = {\r\n      driver: {\r\n        id: driver._id,\r\n        name: driver.name,\r\n        email: driver.email\r\n      },\r\n      period: { startDate, endDate },\r\n      totalTrips: trips.length,\r\n      completedTrips: trips.filter(t => t.status === 'completed').length,\r\n      totalDistance: 0,\r\n      totalDuration: 0,\r\n      averageScore: 0,\r\n      incidents: {\r\n        speeding: 0,\r\n        harshBraking: 0,\r\n        harshAcceleration: 0,\r\n        accidents: 0,\r\n        breakdowns: 0\r\n      },\r\n      fuelEfficiency: 0,\r\n      safetyRating: 0\r\n    };\r\n\r\n    // تجميع البيانات\r\n    trips.forEach(trip => {\r\n      report.totalDistance += trip.statistics?.totalDistance || 0;\r\n      report.totalDuration += trip.statistics?.totalDuration || 0;\r\n      report.averageScore += trip.driverBehavior?.score || 0;\r\n      \r\n      report.incidents.speeding += trip.driverBehavior?.speedingIncidents || 0;\r\n      report.incidents.harshBraking += trip.driverBehavior?.harshBrakingCount || 0;\r\n      report.incidents.harshAcceleration += trip.driverBehavior?.harshAccelerationCount || 0;\r\n      \r\n      trip.incidents?.forEach(incident => {\r\n        if (incident.type === 'accident') report.incidents.accidents++;\r\n        if (incident.type === 'breakdown') report.incidents.breakdowns++;\r\n      });\r\n\r\n      report.fuelEfficiency += trip.fuelData?.efficiency || 0;\r\n    });\r\n\r\n    // حساب المتوسطات\r\n    if (trips.length > 0) {\r\n      report.averageScore = report.averageScore / trips.length;\r\n      report.fuelEfficiency = report.fuelEfficiency / trips.length;\r\n    }\r\n\r\n    // حساب تقييم السلامة\r\n    report.safetyRating = this.calculateSafetyRating(report);\r\n\r\n    return report;\r\n  }\r\n\r\n  /**\r\n   * حساب تقييم السلامة\r\n   */\r\n  static calculateSafetyRating(report) {\r\n    let rating = 100;\r\n\r\n    // خصم النقاط بناءً على الحوادث\r\n    rating -= report.incidents.accidents * 20;\r\n    rating -= report.incidents.speeding * 2;\r\n    rating -= report.incidents.harshBraking * 1;\r\n    rating -= report.incidents.harshAcceleration * 1;\r\n    rating -= report.incidents.breakdowns * 5;\r\n\r\n    // مكافأة على معدل الإنجاز\r\n    const completionRate = report.completedTrips / (report.totalTrips || 1);\r\n    if (completionRate > 0.95) rating += 10;\r\n\r\n    return Math.max(0, Math.min(100, rating));\r\n  }\r\n\r\n  // ========== وظائف مساعدة ==========\r\n\r\n  static calculateDistance(point1, point2) {\r\n    const [lon1, lat1] = point1;\r\n    const [lon2, lat2] = point2;\r\n\r\n    const R = 6371;\r\n    const dLat = this.toRad(lat2 - lat1);\r\n    const dLon = this.toRad(lon2 - lon1);\r\n\r\n    const a =\r\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(this.toRad(lat1)) *\r\n        Math.cos(this.toRad(lat2)) *\r\n        Math.sin(dLon / 2) *\r\n        Math.sin(dLon / 2);\r\n\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n  }\r\n\r\n  static toRad(degrees) {\r\n    return degrees * (Math.PI / 180);\r\n  }\r\n\r\n  static detectZoneType(location) {\r\n    // محاكاة - يمكن دمج مع API خرائط\r\n    return 'city';\r\n  }\r\n\r\n  static calculateDistanceFromPath(point, pathCoordinates) {\r\n    let minDistance = Infinity;\r\n\r\n    for (let i = 0; i < pathCoordinates.length - 1; i++) {\r\n      const distance = this.distanceToSegment(\r\n        point,\r\n        pathCoordinates[i],\r\n        pathCoordinates[i + 1]\r\n      );\r\n      minDistance = Math.min(minDistance, distance);\r\n    }\r\n\r\n    return minDistance * 1000; // تحويل لمتر\r\n  }\r\n\r\n  static distanceToSegment(point, segmentStart, segmentEnd) {\r\n    const [x, y] = point;\r\n    const [x1, y1] = segmentStart;\r\n    const [x2, y2] = segmentEnd;\r\n\r\n    const A = x - x1;\r\n    const B = y - y1;\r\n    const C = x2 - x1;\r\n    const D = y2 - y1;\r\n\r\n    const dot = A * C + B * D;\r\n    const lenSq = C * C + D * D;\r\n    let param = -1;\r\n\r\n    if (lenSq !== 0) param = dot / lenSq;\r\n\r\n    let xx, yy;\r\n\r\n    if (param < 0) {\r\n      xx = x1;\r\n      yy = y1;\r\n    } else if (param > 1) {\r\n      xx = x2;\r\n      yy = y2;\r\n    } else {\r\n      xx = x1 + param * C;\r\n      yy = y1 + param * D;\r\n    }\r\n\r\n    const dx = x - xx;\r\n    const dy = y - yy;\r\n\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  }\r\n\r\n  static getGridKey(coordinates) {\r\n    const [lon, lat] = coordinates;\r\n    // تقسيم الخريطة إلى شبكة 0.01 درجة (~1 كم)\r\n    return `${Math.floor(lat * 100)},${Math.floor(lon * 100)}`;\r\n  }\r\n\r\n  static async getTrafficFactor(start, end) {\r\n    // محاكاة - يمكن دمج مع API حركة المرور\r\n    const hour = new Date().getHours();\r\n    const isPeakHour = (hour >= 7 && hour <= 9) || (hour >= 16 && hour <= 18);\r\n    return isPeakHour ? 0.6 : 0.9;\r\n  }\r\n\r\n  static async checkDangerousZone(location) {\r\n    // محاكاة - يمكن دمج مع قاعدة بيانات الحوادث\r\n    return false;\r\n  }\r\n}\r\n\r\nmodule.exports = GPSTrackingService;\r\n"],"mappings":"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","ignoreList":[]}