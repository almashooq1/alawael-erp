{"version":3,"names":["express","require","router","Router","SmartScheduler","post","req","res","beneficiaryId","programId","frequency","sessionsPerWeek","planDuration","schedulingCriteria","body","error","planStartDate","Date","planEndDate","setDate","getDate","scheduler","model","schedulingPlan","suggestedSchedule","status","createdBy","user","id","save","success","get","findById","params","populate","path","select","suggestions","generateScheduleSuggestions","totalSuggestions","length","slice","fullCount","approverType","approvals","specialistApproval","approved","approvedAt","approvedBy","supervisorApproval","beneficiaryApproval","allApproved","updatedAt","conflicts","detectScheduleConflicts","conflictsFound","resolutionStrategies","generateResolutionStrategies","baseSessionDuration","adjustments","sessionDurationCustomization","Array","isArray","adjustmentFactors","recommendedDuration","calculateRecommendedDuration","recommendedDurationAdjustment","analytics","efficiency","calculateScheduleEfficiency","recommendations","generateScheduleRecommendations","currentDate","sessionCount","totalPlannedSessions","dayOfWeek","getDay","push","scheduledDateTime","recommendedSpecialist","name","specialistId","confidenceScore","explanation","map","conflict","strategies","suggestedDuration","reason","basedOn","confidence","overallEfficiency","resourceUtilization","specialistUtilization","module","exports"],"sources":["smartScheduler.js"],"sourcesContent":["/**\r\n * API الجدولة الذكية - Smart Scheduler API\r\n * يدير جدولة الجلسات بشكل ذكي مع تجنب التعارضات\r\n */\r\n\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst { SmartScheduler } = require('../models/smartScheduler');\r\n\r\n/**\r\n * POST /api/scheduler/create-schedule\r\n * إنشاء جدولة ذكية جديدة\r\n */\r\nrouter.post('/create-schedule', async (req, res) => {\r\n  try {\r\n    const {\r\n      beneficiaryId,\r\n      programId,\r\n      frequency,\r\n      sessionsPerWeek,\r\n      planDuration,\r\n      schedulingCriteria,\r\n    } = req.body;\r\n\r\n    if (!beneficiaryId || !programId) {\r\n      return res.error('البيانات المطلوبة غير مكتملة', 'Missing required fields', 400);\r\n    }\r\n\r\n    const planStartDate = new Date();\r\n    const planEndDate = new Date();\r\n    planEndDate.setDate(planEndDate.getDate() + (planDuration || 90));\r\n\r\n    const scheduler = new SmartScheduler.model({\r\n      beneficiaryId,\r\n      programId,\r\n      schedulingCriteria: schedulingCriteria || {},\r\n      schedulingPlan: {\r\n        frequency: frequency || 'weekly',\r\n        sessionsPerWeek: sessionsPerWeek || 2,\r\n        planStartDate,\r\n        planEndDate,\r\n        suggestedSchedule: [],\r\n      },\r\n      status: 'draft',\r\n      createdBy: req.user?.id,\r\n    });\r\n\r\n    await scheduler.save();\r\n\r\n    res.success(scheduler, 'تم إنشاء الجدولة الذكية بنجاح', 201);\r\n  } catch (error) {\r\n    res.error(error, 'فشل في إنشاء الجدولة');\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/scheduler/:id\r\n * الحصول على تفاصيل جدولة\r\n */\r\nrouter.get('/:id', async (req, res) => {\r\n  try {\r\n    const scheduler = await SmartScheduler.model.findById(req.params.id).populate([\r\n      { path: 'beneficiaryId', select: 'name email' },\r\n      { path: 'programId', select: 'name sessionConfig' },\r\n    ]);\r\n\r\n    if (!scheduler) {\r\n      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);\r\n    }\r\n\r\n    res.success(scheduler, 'تم جلب تفاصيل الجدولة');\r\n  } catch (error) {\r\n    res.error(error, 'فشل في جلب الجدولة');\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/scheduler/:id/generate-suggestions\r\n * توليد مقترحات جدولة ذكية\r\n */\r\nrouter.post('/:id/generate-suggestions', async (req, res) => {\r\n  try {\r\n    const scheduler = await SmartScheduler.model.findById(req.params.id);\r\n\r\n    if (!scheduler) {\r\n      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);\r\n    }\r\n\r\n    // توليد المقترحات بناءً على المعايير\r\n    const suggestions = generateScheduleSuggestions(scheduler);\r\n\r\n    scheduler.schedulingPlan.suggestedSchedule = suggestions;\r\n    scheduler.status = 'pending-review';\r\n\r\n    await scheduler.save();\r\n\r\n    res.success(\r\n      {\r\n        totalSuggestions: suggestions.length,\r\n        suggestions: suggestions.slice(0, 10), // إرسال أول 10 مقترحات\r\n        fullCount: suggestions.length,\r\n      },\r\n      'تم توليد المقترحات بنجاح'\r\n    );\r\n  } catch (error) {\r\n    res.error(error, 'فشل في توليد المقترحات');\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/scheduler/:id/approve-schedule\r\n * الموافقة على الجدولة\r\n */\r\nrouter.post('/:id/approve-schedule', async (req, res) => {\r\n  try {\r\n    const scheduler = await SmartScheduler.model.findById(req.params.id);\r\n\r\n    if (!scheduler) {\r\n      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);\r\n    }\r\n\r\n    const { approverType = 'specialist' } = req.body;\r\n\r\n    if (approverType === 'specialist') {\r\n      scheduler.approvals.specialistApproval = {\r\n        approved: true,\r\n        approvedAt: new Date(),\r\n        approvedBy: req.user?.id,\r\n      };\r\n    } else if (approverType === 'supervisor') {\r\n      scheduler.approvals.supervisorApproval = {\r\n        approved: true,\r\n        approvedAt: new Date(),\r\n        approvedBy: req.user?.id,\r\n      };\r\n    } else if (approverType === 'beneficiary') {\r\n      scheduler.approvals.beneficiaryApproval = {\r\n        approved: true,\r\n        approvedAt: new Date(),\r\n        approvedBy: req.user?.id,\r\n      };\r\n    }\r\n\r\n    // التحقق من جميع الموافقات\r\n    const allApproved =\r\n      scheduler.approvals.specialistApproval?.approved &&\r\n      scheduler.approvals.supervisorApproval?.approved &&\r\n      scheduler.approvals.beneficiaryApproval?.approved;\r\n\r\n    if (allApproved) {\r\n      scheduler.status = 'approved';\r\n    }\r\n\r\n    await scheduler.save();\r\n\r\n    res.success(scheduler, 'تم تسجيل الموافقة بنجاح');\r\n  } catch (error) {\r\n    res.error(error, 'فشل في تسجيل الموافقة');\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/scheduler/:id/activate-schedule\r\n * تفعيل الجدولة\r\n */\r\nrouter.post('/:id/activate-schedule', async (req, res) => {\r\n  try {\r\n    const scheduler = await SmartScheduler.model.findById(req.params.id);\r\n\r\n    if (!scheduler) {\r\n      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);\r\n    }\r\n\r\n    if (scheduler.status !== 'approved') {\r\n      return res.error('الجدولة يجب أن تكون موافق عليها', 'Schedule must be approved first', 400);\r\n    }\r\n\r\n    scheduler.status = 'active';\r\n    scheduler.updatedAt = new Date();\r\n\r\n    await scheduler.save();\r\n\r\n    res.success(scheduler, 'تم تفعيل الجدولة بنجاح');\r\n  } catch (error) {\r\n    res.error(error, 'فشل في تفعيل الجدولة');\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/scheduler/:id/conflicts\r\n * الحصول على التعارضات المحتملة\r\n */\r\nrouter.get('/:id/conflicts', async (req, res) => {\r\n  try {\r\n    const scheduler = await SmartScheduler.model.findById(req.params.id);\r\n\r\n    if (!scheduler) {\r\n      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);\r\n    }\r\n\r\n    // تحديد التعارضات\r\n    const conflicts = detectScheduleConflicts(scheduler);\r\n\r\n    res.success(\r\n      {\r\n        conflictsFound: conflicts.length > 0,\r\n        conflicts,\r\n        resolutionStrategies: generateResolutionStrategies(conflicts),\r\n      },\r\n      'تم الكشف عن التعارضات'\r\n    );\r\n  } catch (error) {\r\n    res.error(error, 'فشل في الكشف عن التعارضات');\r\n  }\r\n});\r\n\r\n/**\r\n * POST /api/scheduler/:id/customize-duration\r\n * تخصيص مدة الجلسات\r\n */\r\nrouter.post('/:id/customize-duration', async (req, res) => {\r\n  try {\r\n    const scheduler = await SmartScheduler.model.findById(req.params.id);\r\n\r\n    if (!scheduler) {\r\n      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);\r\n    }\r\n\r\n    const { baseSessionDuration, adjustments } = req.body;\r\n\r\n    if (baseSessionDuration) {\r\n      scheduler.sessionDurationCustomization.baseSessionDuration = baseSessionDuration;\r\n    }\r\n\r\n    if (adjustments && Array.isArray(adjustments)) {\r\n      scheduler.sessionDurationCustomization.adjustmentFactors = adjustments;\r\n    }\r\n\r\n    // حساب المدة الموصى بها\r\n    const recommendedDuration = calculateRecommendedDuration(scheduler);\r\n    scheduler.sessionDurationCustomization.recommendedDurationAdjustment = recommendedDuration;\r\n\r\n    await scheduler.save();\r\n\r\n    res.success(scheduler.sessionDurationCustomization, 'تم تخصيص المدة بنجاح');\r\n  } catch (error) {\r\n    res.error(error, 'فشل في تخصيص المدة');\r\n  }\r\n});\r\n\r\n/**\r\n * GET /api/scheduler/:id/analytics\r\n * الحصول على تحليلات الجدولة\r\n */\r\nrouter.get('/:id/analytics', async (req, res) => {\r\n  try {\r\n    const scheduler = await SmartScheduler.model.findById(req.params.id);\r\n\r\n    if (!scheduler) {\r\n      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);\r\n    }\r\n\r\n    res.success(\r\n      {\r\n        analytics: scheduler.analytics || {},\r\n        efficiency: calculateScheduleEfficiency(scheduler),\r\n        recommendations: generateScheduleRecommendations(scheduler),\r\n      },\r\n      'تم جلب تحليلات الجدولة'\r\n    );\r\n  } catch (error) {\r\n    res.error(error, 'فشل في جلب التحليلات');\r\n  }\r\n});\r\n\r\n// ============ الدوال المساعدة ============\r\n\r\nfunction generateScheduleSuggestions(scheduler) {\r\n  // منطق لتوليد المقترحات الذكية\r\n  const suggestions = [];\r\n  const { planStartDate, planEndDate, sessionsPerWeek } = scheduler.schedulingPlan;\r\n\r\n  let currentDate = new Date(planStartDate);\r\n  let sessionCount = 0;\r\n\r\n  while (\r\n    currentDate <= planEndDate &&\r\n    sessionCount < scheduler.schedulingPlan.totalPlannedSessions\r\n  ) {\r\n    const dayOfWeek = currentDate.getDay();\r\n\r\n    // تجنب الجمعة والسبت\r\n    if (dayOfWeek !== 5 && dayOfWeek !== 6) {\r\n      suggestions.push({\r\n        scheduledDateTime: new Date(currentDate),\r\n        recommendedSpecialist: {\r\n          name: 'متاح',\r\n          specialistId: null,\r\n        },\r\n        confidenceScore: 85,\r\n        explanation: 'موعد متاح ومناسب',\r\n      });\r\n      sessionCount++;\r\n    }\r\n    currentDate.setDate(currentDate.getDate() + 1);\r\n  }\r\n\r\n  return suggestions;\r\n}\r\n\r\nfunction detectScheduleConflicts(scheduler) {\r\n  const conflicts = [];\r\n  const { suggestedSchedule } = scheduler.schedulingPlan;\r\n\r\n  // منطق الكشف عن التعارضات\r\n  // مثال: الجلسات المتتالية دون فترة راحة\r\n\r\n  return conflicts;\r\n}\r\n\r\nfunction generateResolutionStrategies(conflicts) {\r\n  return conflicts.map(conflict => ({\r\n    conflict: conflict,\r\n    strategies: ['تأجيل إحدى الجلسات', 'تغيير الأخصائي', 'تغيير الموقع'],\r\n  }));\r\n}\r\n\r\nfunction calculateRecommendedDuration(scheduler) {\r\n  return {\r\n    suggestedDuration: 60,\r\n    reason: 'مدة معيارية موصى بها',\r\n    basedOn: ['assessment', 'fatigue-level'],\r\n    confidence: 80,\r\n  };\r\n}\r\n\r\nfunction calculateScheduleEfficiency(scheduler) {\r\n  // حساب كفاءة الجدولة\r\n  return {\r\n    overallEfficiency: 85,\r\n    resourceUtilization: 90,\r\n    specialistUtilization: 80,\r\n  };\r\n}\r\n\r\nfunction generateScheduleRecommendations(scheduler) {\r\n  return ['زيادة عدد الجلسات الأسبوعية', 'إضافة فترات راحة أطول', 'تنويع الأنشطة'];\r\n}\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]}