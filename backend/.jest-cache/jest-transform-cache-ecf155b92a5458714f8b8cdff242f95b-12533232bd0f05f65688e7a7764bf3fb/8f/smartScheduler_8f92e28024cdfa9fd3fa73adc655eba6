75f06a09feb98aa31a8a3efb0636c678
/**
 * API الجدولة الذكية - Smart Scheduler API
 * يدير جدولة الجلسات بشكل ذكي مع تجنب التعارضات
 */

const express = require('express');
const router = express.Router();
const {
  SmartScheduler
} = require('../models/smartScheduler');

/**
 * POST /api/scheduler/create-schedule
 * إنشاء جدولة ذكية جديدة
 */
router.post('/create-schedule', async (req, res) => {
  try {
    const {
      beneficiaryId,
      programId,
      frequency,
      sessionsPerWeek,
      planDuration,
      schedulingCriteria
    } = req.body;
    if (!beneficiaryId || !programId) {
      return res.error('البيانات المطلوبة غير مكتملة', 'Missing required fields', 400);
    }
    const planStartDate = new Date();
    const planEndDate = new Date();
    planEndDate.setDate(planEndDate.getDate() + (planDuration || 90));
    const scheduler = new SmartScheduler.model({
      beneficiaryId,
      programId,
      schedulingCriteria: schedulingCriteria || {},
      schedulingPlan: {
        frequency: frequency || 'weekly',
        sessionsPerWeek: sessionsPerWeek || 2,
        planStartDate,
        planEndDate,
        suggestedSchedule: []
      },
      status: 'draft',
      createdBy: req.user?.id
    });
    await scheduler.save();
    res.success(scheduler, 'تم إنشاء الجدولة الذكية بنجاح', 201);
  } catch (error) {
    res.error(error, 'فشل في إنشاء الجدولة');
  }
});

/**
 * GET /api/scheduler/:id
 * الحصول على تفاصيل جدولة
 */
router.get('/:id', async (req, res) => {
  try {
    const scheduler = await SmartScheduler.model.findById(req.params.id).populate([{
      path: 'beneficiaryId',
      select: 'name email'
    }, {
      path: 'programId',
      select: 'name sessionConfig'
    }]);
    if (!scheduler) {
      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);
    }
    res.success(scheduler, 'تم جلب تفاصيل الجدولة');
  } catch (error) {
    res.error(error, 'فشل في جلب الجدولة');
  }
});

/**
 * POST /api/scheduler/:id/generate-suggestions
 * توليد مقترحات جدولة ذكية
 */
router.post('/:id/generate-suggestions', async (req, res) => {
  try {
    const scheduler = await SmartScheduler.model.findById(req.params.id);
    if (!scheduler) {
      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);
    }

    // توليد المقترحات بناءً على المعايير
    const suggestions = generateScheduleSuggestions(scheduler);
    scheduler.schedulingPlan.suggestedSchedule = suggestions;
    scheduler.status = 'pending-review';
    await scheduler.save();
    res.success({
      totalSuggestions: suggestions.length,
      suggestions: suggestions.slice(0, 10),
      // إرسال أول 10 مقترحات
      fullCount: suggestions.length
    }, 'تم توليد المقترحات بنجاح');
  } catch (error) {
    res.error(error, 'فشل في توليد المقترحات');
  }
});

/**
 * POST /api/scheduler/:id/approve-schedule
 * الموافقة على الجدولة
 */
router.post('/:id/approve-schedule', async (req, res) => {
  try {
    const scheduler = await SmartScheduler.model.findById(req.params.id);
    if (!scheduler) {
      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);
    }
    const {
      approverType = 'specialist'
    } = req.body;
    if (approverType === 'specialist') {
      scheduler.approvals.specialistApproval = {
        approved: true,
        approvedAt: new Date(),
        approvedBy: req.user?.id
      };
    } else if (approverType === 'supervisor') {
      scheduler.approvals.supervisorApproval = {
        approved: true,
        approvedAt: new Date(),
        approvedBy: req.user?.id
      };
    } else if (approverType === 'beneficiary') {
      scheduler.approvals.beneficiaryApproval = {
        approved: true,
        approvedAt: new Date(),
        approvedBy: req.user?.id
      };
    }

    // التحقق من جميع الموافقات
    const allApproved = scheduler.approvals.specialistApproval?.approved && scheduler.approvals.supervisorApproval?.approved && scheduler.approvals.beneficiaryApproval?.approved;
    if (allApproved) {
      scheduler.status = 'approved';
    }
    await scheduler.save();
    res.success(scheduler, 'تم تسجيل الموافقة بنجاح');
  } catch (error) {
    res.error(error, 'فشل في تسجيل الموافقة');
  }
});

/**
 * POST /api/scheduler/:id/activate-schedule
 * تفعيل الجدولة
 */
router.post('/:id/activate-schedule', async (req, res) => {
  try {
    const scheduler = await SmartScheduler.model.findById(req.params.id);
    if (!scheduler) {
      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);
    }
    if (scheduler.status !== 'approved') {
      return res.error('الجدولة يجب أن تكون موافق عليها', 'Schedule must be approved first', 400);
    }
    scheduler.status = 'active';
    scheduler.updatedAt = new Date();
    await scheduler.save();
    res.success(scheduler, 'تم تفعيل الجدولة بنجاح');
  } catch (error) {
    res.error(error, 'فشل في تفعيل الجدولة');
  }
});

/**
 * GET /api/scheduler/:id/conflicts
 * الحصول على التعارضات المحتملة
 */
router.get('/:id/conflicts', async (req, res) => {
  try {
    const scheduler = await SmartScheduler.model.findById(req.params.id);
    if (!scheduler) {
      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);
    }

    // تحديد التعارضات
    const conflicts = detectScheduleConflicts(scheduler);
    res.success({
      conflictsFound: conflicts.length > 0,
      conflicts,
      resolutionStrategies: generateResolutionStrategies(conflicts)
    }, 'تم الكشف عن التعارضات');
  } catch (error) {
    res.error(error, 'فشل في الكشف عن التعارضات');
  }
});

/**
 * POST /api/scheduler/:id/customize-duration
 * تخصيص مدة الجلسات
 */
router.post('/:id/customize-duration', async (req, res) => {
  try {
    const scheduler = await SmartScheduler.model.findById(req.params.id);
    if (!scheduler) {
      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);
    }
    const {
      baseSessionDuration,
      adjustments
    } = req.body;
    if (baseSessionDuration) {
      scheduler.sessionDurationCustomization.baseSessionDuration = baseSessionDuration;
    }
    if (adjustments && Array.isArray(adjustments)) {
      scheduler.sessionDurationCustomization.adjustmentFactors = adjustments;
    }

    // حساب المدة الموصى بها
    const recommendedDuration = calculateRecommendedDuration(scheduler);
    scheduler.sessionDurationCustomization.recommendedDurationAdjustment = recommendedDuration;
    await scheduler.save();
    res.success(scheduler.sessionDurationCustomization, 'تم تخصيص المدة بنجاح');
  } catch (error) {
    res.error(error, 'فشل في تخصيص المدة');
  }
});

/**
 * GET /api/scheduler/:id/analytics
 * الحصول على تحليلات الجدولة
 */
router.get('/:id/analytics', async (req, res) => {
  try {
    const scheduler = await SmartScheduler.model.findById(req.params.id);
    if (!scheduler) {
      return res.error('الجدولة غير موجودة', 'Scheduler not found', 404);
    }
    res.success({
      analytics: scheduler.analytics || {},
      efficiency: calculateScheduleEfficiency(scheduler),
      recommendations: generateScheduleRecommendations(scheduler)
    }, 'تم جلب تحليلات الجدولة');
  } catch (error) {
    res.error(error, 'فشل في جلب التحليلات');
  }
});

// ============ الدوال المساعدة ============

function generateScheduleSuggestions(scheduler) {
  // منطق لتوليد المقترحات الذكية
  const suggestions = [];
  const {
    planStartDate,
    planEndDate
  } = scheduler.schedulingPlan;
  let currentDate = new Date(planStartDate);
  let sessionCount = 0;
  while (currentDate <= planEndDate && sessionCount < scheduler.schedulingPlan.totalPlannedSessions) {
    const dayOfWeek = currentDate.getDay();

    // تجنب الجمعة والسبت
    if (dayOfWeek !== 5 && dayOfWeek !== 6) {
      suggestions.push({
        scheduledDateTime: new Date(currentDate),
        recommendedSpecialist: {
          name: 'متاح',
          specialistId: null
        },
        confidenceScore: 85,
        explanation: 'موعد متاح ومناسب'
      });
      sessionCount++;
    }
    currentDate.setDate(currentDate.getDate() + 1);
  }
  return suggestions;
}
function detectScheduleConflicts(scheduler) {
  const conflicts = [];

  // منطق الكشف عن التعارضات
  // مثال: الجلسات المتتالية دون فترة راحة

  return conflicts;
}
function generateResolutionStrategies(conflicts) {
  return conflicts.map(conflict => ({
    conflict: conflict,
    strategies: ['تأجيل إحدى الجلسات', 'تغيير الأخصائي', 'تغيير الموقع']
  }));
}
function calculateRecommendedDuration(scheduler) {
  return {
    suggestedDuration: 60,
    reason: 'مدة معيارية موصى بها',
    basedOn: ['assessment', 'fatigue-level'],
    confidence: 80
  };
}
function calculateScheduleEfficiency(scheduler) {
  // حساب كفاءة الجدولة
  return {
    overallEfficiency: 85,
    resourceUtilization: 90,
    specialistUtilization: 80
  };
}
function generateScheduleRecommendations(scheduler) {
  return ['زيادة عدد الجلسات الأسبوعية', 'إضافة فترات راحة أطول', 'تنويع الأنشطة'];
}
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlNtYXJ0U2NoZWR1bGVyIiwicG9zdCIsInJlcSIsInJlcyIsImJlbmVmaWNpYXJ5SWQiLCJwcm9ncmFtSWQiLCJmcmVxdWVuY3kiLCJzZXNzaW9uc1BlcldlZWsiLCJwbGFuRHVyYXRpb24iLCJzY2hlZHVsaW5nQ3JpdGVyaWEiLCJib2R5IiwiZXJyb3IiLCJwbGFuU3RhcnREYXRlIiwiRGF0ZSIsInBsYW5FbmREYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJzY2hlZHVsZXIiLCJtb2RlbCIsInNjaGVkdWxpbmdQbGFuIiwic3VnZ2VzdGVkU2NoZWR1bGUiLCJzdGF0dXMiLCJjcmVhdGVkQnkiLCJ1c2VyIiwiaWQiLCJzYXZlIiwic3VjY2VzcyIsImdldCIsImZpbmRCeUlkIiwicGFyYW1zIiwicG9wdWxhdGUiLCJwYXRoIiwic2VsZWN0Iiwic3VnZ2VzdGlvbnMiLCJnZW5lcmF0ZVNjaGVkdWxlU3VnZ2VzdGlvbnMiLCJ0b3RhbFN1Z2dlc3Rpb25zIiwibGVuZ3RoIiwic2xpY2UiLCJmdWxsQ291bnQiLCJhcHByb3ZlclR5cGUiLCJhcHByb3ZhbHMiLCJzcGVjaWFsaXN0QXBwcm92YWwiLCJhcHByb3ZlZCIsImFwcHJvdmVkQXQiLCJhcHByb3ZlZEJ5Iiwic3VwZXJ2aXNvckFwcHJvdmFsIiwiYmVuZWZpY2lhcnlBcHByb3ZhbCIsImFsbEFwcHJvdmVkIiwidXBkYXRlZEF0IiwiY29uZmxpY3RzIiwiZGV0ZWN0U2NoZWR1bGVDb25mbGljdHMiLCJjb25mbGljdHNGb3VuZCIsInJlc29sdXRpb25TdHJhdGVnaWVzIiwiZ2VuZXJhdGVSZXNvbHV0aW9uU3RyYXRlZ2llcyIsImJhc2VTZXNzaW9uRHVyYXRpb24iLCJhZGp1c3RtZW50cyIsInNlc3Npb25EdXJhdGlvbkN1c3RvbWl6YXRpb24iLCJBcnJheSIsImlzQXJyYXkiLCJhZGp1c3RtZW50RmFjdG9ycyIsInJlY29tbWVuZGVkRHVyYXRpb24iLCJjYWxjdWxhdGVSZWNvbW1lbmRlZER1cmF0aW9uIiwicmVjb21tZW5kZWREdXJhdGlvbkFkanVzdG1lbnQiLCJhbmFseXRpY3MiLCJlZmZpY2llbmN5IiwiY2FsY3VsYXRlU2NoZWR1bGVFZmZpY2llbmN5IiwicmVjb21tZW5kYXRpb25zIiwiZ2VuZXJhdGVTY2hlZHVsZVJlY29tbWVuZGF0aW9ucyIsImN1cnJlbnREYXRlIiwic2Vzc2lvbkNvdW50IiwidG90YWxQbGFubmVkU2Vzc2lvbnMiLCJkYXlPZldlZWsiLCJnZXREYXkiLCJwdXNoIiwic2NoZWR1bGVkRGF0ZVRpbWUiLCJyZWNvbW1lbmRlZFNwZWNpYWxpc3QiLCJuYW1lIiwic3BlY2lhbGlzdElkIiwiY29uZmlkZW5jZVNjb3JlIiwiZXhwbGFuYXRpb24iLCJtYXAiLCJjb25mbGljdCIsInN0cmF0ZWdpZXMiLCJzdWdnZXN0ZWREdXJhdGlvbiIsInJlYXNvbiIsImJhc2VkT24iLCJjb25maWRlbmNlIiwib3ZlcmFsbEVmZmljaWVuY3kiLCJyZXNvdXJjZVV0aWxpemF0aW9uIiwic3BlY2lhbGlzdFV0aWxpemF0aW9uIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInNtYXJ0U2NoZWR1bGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBBUEkg2KfZhNis2K/ZiNmE2Kkg2KfZhNiw2YPZitipIC0gU21hcnQgU2NoZWR1bGVyIEFQSVxyXG4gKiDZitiv2YrYsSDYrNiv2YjZhNipINin2YTYrNmE2LPYp9iqINio2LTZg9mEINiw2YPZiiDZhdi5INiq2KzZhtioINin2YTYqti52KfYsdi22KfYqlxyXG4gKi9cclxuXHJcbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHsgU21hcnRTY2hlZHVsZXIgfSA9IHJlcXVpcmUoJy4uL21vZGVscy9zbWFydFNjaGVkdWxlcicpO1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9zY2hlZHVsZXIvY3JlYXRlLXNjaGVkdWxlXHJcbiAqINil2YbYtNin2KEg2KzYr9mI2YTYqSDYsNmD2YrYqSDYrNiv2YrYr9ipXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL2NyZWF0ZS1zY2hlZHVsZScsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGJlbmVmaWNpYXJ5SWQsXHJcbiAgICAgIHByb2dyYW1JZCxcclxuICAgICAgZnJlcXVlbmN5LFxyXG4gICAgICBzZXNzaW9uc1BlcldlZWssXHJcbiAgICAgIHBsYW5EdXJhdGlvbixcclxuICAgICAgc2NoZWR1bGluZ0NyaXRlcmlhLFxyXG4gICAgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGlmICghYmVuZWZpY2lhcnlJZCB8fCAhcHJvZ3JhbUlkKSB7XHJcbiAgICAgIHJldHVybiByZXMuZXJyb3IoJ9in2YTYqNmK2KfZhtin2Kog2KfZhNmF2LfZhNmI2KjYqSDYutmK2LEg2YXZg9iq2YXZhNipJywgJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzJywgNDAwKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwbGFuU3RhcnREYXRlID0gbmV3IERhdGUoKTtcclxuICAgIGNvbnN0IHBsYW5FbmREYXRlID0gbmV3IERhdGUoKTtcclxuICAgIHBsYW5FbmREYXRlLnNldERhdGUocGxhbkVuZERhdGUuZ2V0RGF0ZSgpICsgKHBsYW5EdXJhdGlvbiB8fCA5MCkpO1xyXG5cclxuICAgIGNvbnN0IHNjaGVkdWxlciA9IG5ldyBTbWFydFNjaGVkdWxlci5tb2RlbCh7XHJcbiAgICAgIGJlbmVmaWNpYXJ5SWQsXHJcbiAgICAgIHByb2dyYW1JZCxcclxuICAgICAgc2NoZWR1bGluZ0NyaXRlcmlhOiBzY2hlZHVsaW5nQ3JpdGVyaWEgfHwge30sXHJcbiAgICAgIHNjaGVkdWxpbmdQbGFuOiB7XHJcbiAgICAgICAgZnJlcXVlbmN5OiBmcmVxdWVuY3kgfHwgJ3dlZWtseScsXHJcbiAgICAgICAgc2Vzc2lvbnNQZXJXZWVrOiBzZXNzaW9uc1BlcldlZWsgfHwgMixcclxuICAgICAgICBwbGFuU3RhcnREYXRlLFxyXG4gICAgICAgIHBsYW5FbmREYXRlLFxyXG4gICAgICAgIHN1Z2dlc3RlZFNjaGVkdWxlOiBbXSxcclxuICAgICAgfSxcclxuICAgICAgc3RhdHVzOiAnZHJhZnQnLFxyXG4gICAgICBjcmVhdGVkQnk6IHJlcS51c2VyPy5pZCxcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IHNjaGVkdWxlci5zYXZlKCk7XHJcblxyXG4gICAgcmVzLnN1Y2Nlc3Moc2NoZWR1bGVyLCAn2KrZhSDYpdmG2LTYp9ihINin2YTYrNiv2YjZhNipINin2YTYsNmD2YrYqSDYqNmG2KzYp9itJywgMjAxKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLmVycm9yKGVycm9yLCAn2YHYtNmEINmB2Yog2KXZhti02KfYoSDYp9mE2KzYr9mI2YTYqScpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR0VUIC9hcGkvc2NoZWR1bGVyLzppZFxyXG4gKiDYp9mE2K3YtdmI2YQg2LnZhNmJINiq2YHYp9i12YrZhCDYrNiv2YjZhNipXHJcbiAqL1xyXG5yb3V0ZXIuZ2V0KCcvOmlkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNjaGVkdWxlciA9IGF3YWl0IFNtYXJ0U2NoZWR1bGVyLm1vZGVsLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpLnBvcHVsYXRlKFtcclxuICAgICAgeyBwYXRoOiAnYmVuZWZpY2lhcnlJZCcsIHNlbGVjdDogJ25hbWUgZW1haWwnIH0sXHJcbiAgICAgIHsgcGF0aDogJ3Byb2dyYW1JZCcsIHNlbGVjdDogJ25hbWUgc2Vzc2lvbkNvbmZpZycgfSxcclxuICAgIF0pO1xyXG5cclxuICAgIGlmICghc2NoZWR1bGVyKSB7XHJcbiAgICAgIHJldHVybiByZXMuZXJyb3IoJ9in2YTYrNiv2YjZhNipINi62YrYsSDZhdmI2KzZiNiv2KknLCAnU2NoZWR1bGVyIG5vdCBmb3VuZCcsIDQwNCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzLnN1Y2Nlc3Moc2NoZWR1bGVyLCAn2KrZhSDYrNmE2Kgg2KrZgdin2LXZitmEINin2YTYrNiv2YjZhNipJyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJlcy5lcnJvcihlcnJvciwgJ9mB2LTZhCDZgdmKINis2YTYqCDYp9mE2KzYr9mI2YTYqScpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL3NjaGVkdWxlci86aWQvZ2VuZXJhdGUtc3VnZ2VzdGlvbnNcclxuICog2KrZiNmE2YrYryDZhdmC2KrYsdit2KfYqiDYrNiv2YjZhNipINiw2YPZitipXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnLzppZC9nZW5lcmF0ZS1zdWdnZXN0aW9ucycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzY2hlZHVsZXIgPSBhd2FpdCBTbWFydFNjaGVkdWxlci5tb2RlbC5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuXHJcbiAgICBpZiAoIXNjaGVkdWxlcikge1xyXG4gICAgICByZXR1cm4gcmVzLmVycm9yKCfYp9mE2KzYr9mI2YTYqSDYutmK2LEg2YXZiNis2YjYr9ipJywgJ1NjaGVkdWxlciBub3QgZm91bmQnLCA0MDQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINiq2YjZhNmK2K8g2KfZhNmF2YLYqtix2K3Yp9iqINio2YbYp9ih2Ysg2LnZhNmJINin2YTZhdi52KfZitmK2LFcclxuICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gZ2VuZXJhdGVTY2hlZHVsZVN1Z2dlc3Rpb25zKHNjaGVkdWxlcik7XHJcblxyXG4gICAgc2NoZWR1bGVyLnNjaGVkdWxpbmdQbGFuLnN1Z2dlc3RlZFNjaGVkdWxlID0gc3VnZ2VzdGlvbnM7XHJcbiAgICBzY2hlZHVsZXIuc3RhdHVzID0gJ3BlbmRpbmctcmV2aWV3JztcclxuXHJcbiAgICBhd2FpdCBzY2hlZHVsZXIuc2F2ZSgpO1xyXG5cclxuICAgIHJlcy5zdWNjZXNzKFxyXG4gICAgICB7XHJcbiAgICAgICAgdG90YWxTdWdnZXN0aW9uczogc3VnZ2VzdGlvbnMubGVuZ3RoLFxyXG4gICAgICAgIHN1Z2dlc3Rpb25zOiBzdWdnZXN0aW9ucy5zbGljZSgwLCAxMCksIC8vINil2LHYs9in2YQg2KPZiNmEIDEwINmF2YLYqtix2K3Yp9iqXHJcbiAgICAgICAgZnVsbENvdW50OiBzdWdnZXN0aW9ucy5sZW5ndGgsXHJcbiAgICAgIH0sXHJcbiAgICAgICfYqtmFINiq2YjZhNmK2K8g2KfZhNmF2YLYqtix2K3Yp9iqINio2YbYrNin2K0nXHJcbiAgICApO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXMuZXJyb3IoZXJyb3IsICfZgdi02YQg2YHZiiDYqtmI2YTZitivINin2YTZhdmC2KrYsdit2KfYqicpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL3NjaGVkdWxlci86aWQvYXBwcm92ZS1zY2hlZHVsZVxyXG4gKiDYp9mE2YXZiNin2YHZgtipINi52YTZiSDYp9mE2KzYr9mI2YTYqVxyXG4gKi9cclxucm91dGVyLnBvc3QoJy86aWQvYXBwcm92ZS1zY2hlZHVsZScsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzY2hlZHVsZXIgPSBhd2FpdCBTbWFydFNjaGVkdWxlci5tb2RlbC5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuXHJcbiAgICBpZiAoIXNjaGVkdWxlcikge1xyXG4gICAgICByZXR1cm4gcmVzLmVycm9yKCfYp9mE2KzYr9mI2YTYqSDYutmK2LEg2YXZiNis2YjYr9ipJywgJ1NjaGVkdWxlciBub3QgZm91bmQnLCA0MDQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgYXBwcm92ZXJUeXBlID0gJ3NwZWNpYWxpc3QnIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBpZiAoYXBwcm92ZXJUeXBlID09PSAnc3BlY2lhbGlzdCcpIHtcclxuICAgICAgc2NoZWR1bGVyLmFwcHJvdmFscy5zcGVjaWFsaXN0QXBwcm92YWwgPSB7XHJcbiAgICAgICAgYXBwcm92ZWQ6IHRydWUsXHJcbiAgICAgICAgYXBwcm92ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICBhcHByb3ZlZEJ5OiByZXEudXNlcj8uaWQsXHJcbiAgICAgIH07XHJcbiAgICB9IGVsc2UgaWYgKGFwcHJvdmVyVHlwZSA9PT0gJ3N1cGVydmlzb3InKSB7XHJcbiAgICAgIHNjaGVkdWxlci5hcHByb3ZhbHMuc3VwZXJ2aXNvckFwcHJvdmFsID0ge1xyXG4gICAgICAgIGFwcHJvdmVkOiB0cnVlLFxyXG4gICAgICAgIGFwcHJvdmVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgYXBwcm92ZWRCeTogcmVxLnVzZXI/LmlkLFxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIGlmIChhcHByb3ZlclR5cGUgPT09ICdiZW5lZmljaWFyeScpIHtcclxuICAgICAgc2NoZWR1bGVyLmFwcHJvdmFscy5iZW5lZmljaWFyeUFwcHJvdmFsID0ge1xyXG4gICAgICAgIGFwcHJvdmVkOiB0cnVlLFxyXG4gICAgICAgIGFwcHJvdmVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgYXBwcm92ZWRCeTogcmVxLnVzZXI/LmlkLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vINin2YTYqtit2YLZgiDZhdmGINis2YXZiti5INin2YTZhdmI2KfZgdmC2KfYqlxyXG4gICAgY29uc3QgYWxsQXBwcm92ZWQgPVxyXG4gICAgICBzY2hlZHVsZXIuYXBwcm92YWxzLnNwZWNpYWxpc3RBcHByb3ZhbD8uYXBwcm92ZWQgJiZcclxuICAgICAgc2NoZWR1bGVyLmFwcHJvdmFscy5zdXBlcnZpc29yQXBwcm92YWw/LmFwcHJvdmVkICYmXHJcbiAgICAgIHNjaGVkdWxlci5hcHByb3ZhbHMuYmVuZWZpY2lhcnlBcHByb3ZhbD8uYXBwcm92ZWQ7XHJcblxyXG4gICAgaWYgKGFsbEFwcHJvdmVkKSB7XHJcbiAgICAgIHNjaGVkdWxlci5zdGF0dXMgPSAnYXBwcm92ZWQnO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHNjaGVkdWxlci5zYXZlKCk7XHJcblxyXG4gICAgcmVzLnN1Y2Nlc3Moc2NoZWR1bGVyLCAn2KrZhSDYqtiz2KzZitmEINin2YTZhdmI2KfZgdmC2Kkg2KjZhtis2KfYrScpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXMuZXJyb3IoZXJyb3IsICfZgdi02YQg2YHZiiDYqtiz2KzZitmEINin2YTZhdmI2KfZgdmC2KknKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9zY2hlZHVsZXIvOmlkL2FjdGl2YXRlLXNjaGVkdWxlXHJcbiAqINiq2YHYudmK2YQg2KfZhNis2K/ZiNmE2KlcclxuICovXHJcbnJvdXRlci5wb3N0KCcvOmlkL2FjdGl2YXRlLXNjaGVkdWxlJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNjaGVkdWxlciA9IGF3YWl0IFNtYXJ0U2NoZWR1bGVyLm1vZGVsLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xyXG5cclxuICAgIGlmICghc2NoZWR1bGVyKSB7XHJcbiAgICAgIHJldHVybiByZXMuZXJyb3IoJ9in2YTYrNiv2YjZhNipINi62YrYsSDZhdmI2KzZiNiv2KknLCAnU2NoZWR1bGVyIG5vdCBmb3VuZCcsIDQwNCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNjaGVkdWxlci5zdGF0dXMgIT09ICdhcHByb3ZlZCcpIHtcclxuICAgICAgcmV0dXJuIHJlcy5lcnJvcign2KfZhNis2K/ZiNmE2Kkg2YrYrNioINij2YYg2KrZg9mI2YYg2YXZiNin2YHZgiDYudmE2YrZh9inJywgJ1NjaGVkdWxlIG11c3QgYmUgYXBwcm92ZWQgZmlyc3QnLCA0MDApO1xyXG4gICAgfVxyXG5cclxuICAgIHNjaGVkdWxlci5zdGF0dXMgPSAnYWN0aXZlJztcclxuICAgIHNjaGVkdWxlci51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgIGF3YWl0IHNjaGVkdWxlci5zYXZlKCk7XHJcblxyXG4gICAgcmVzLnN1Y2Nlc3Moc2NoZWR1bGVyLCAn2KrZhSDYqtmB2LnZitmEINin2YTYrNiv2YjZhNipINio2YbYrNin2K0nKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLmVycm9yKGVycm9yLCAn2YHYtNmEINmB2Yog2KrZgdi52YrZhCDYp9mE2KzYr9mI2YTYqScpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR0VUIC9hcGkvc2NoZWR1bGVyLzppZC9jb25mbGljdHNcclxuICog2KfZhNit2LXZiNmEINi52YTZiSDYp9mE2KrYudin2LHYttin2Kog2KfZhNmF2K3YqtmF2YTYqVxyXG4gKi9cclxucm91dGVyLmdldCgnLzppZC9jb25mbGljdHMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2NoZWR1bGVyID0gYXdhaXQgU21hcnRTY2hlZHVsZXIubW9kZWwuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XHJcblxyXG4gICAgaWYgKCFzY2hlZHVsZXIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5lcnJvcign2KfZhNis2K/ZiNmE2Kkg2LrZitixINmF2YjYrNmI2K/YqScsICdTY2hlZHVsZXIgbm90IGZvdW5kJywgNDA0KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYqtit2K/ZitivINin2YTYqti52KfYsdi22KfYqlxyXG4gICAgY29uc3QgY29uZmxpY3RzID0gZGV0ZWN0U2NoZWR1bGVDb25mbGljdHMoc2NoZWR1bGVyKTtcclxuXHJcbiAgICByZXMuc3VjY2VzcyhcclxuICAgICAge1xyXG4gICAgICAgIGNvbmZsaWN0c0ZvdW5kOiBjb25mbGljdHMubGVuZ3RoID4gMCxcclxuICAgICAgICBjb25mbGljdHMsXHJcbiAgICAgICAgcmVzb2x1dGlvblN0cmF0ZWdpZXM6IGdlbmVyYXRlUmVzb2x1dGlvblN0cmF0ZWdpZXMoY29uZmxpY3RzKSxcclxuICAgICAgfSxcclxuICAgICAgJ9iq2YUg2KfZhNmD2LTZgSDYudmGINin2YTYqti52KfYsdi22KfYqidcclxuICAgICk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJlcy5lcnJvcihlcnJvciwgJ9mB2LTZhCDZgdmKINin2YTZg9i02YEg2LnZhiDYp9mE2KrYudin2LHYttin2KonKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9zY2hlZHVsZXIvOmlkL2N1c3RvbWl6ZS1kdXJhdGlvblxyXG4gKiDYqtiu2LXZiti1INmF2K/YqSDYp9mE2KzZhNiz2KfYqlxyXG4gKi9cclxucm91dGVyLnBvc3QoJy86aWQvY3VzdG9taXplLWR1cmF0aW9uJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNjaGVkdWxlciA9IGF3YWl0IFNtYXJ0U2NoZWR1bGVyLm1vZGVsLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xyXG5cclxuICAgIGlmICghc2NoZWR1bGVyKSB7XHJcbiAgICAgIHJldHVybiByZXMuZXJyb3IoJ9in2YTYrNiv2YjZhNipINi62YrYsSDZhdmI2KzZiNiv2KknLCAnU2NoZWR1bGVyIG5vdCBmb3VuZCcsIDQwNCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBiYXNlU2Vzc2lvbkR1cmF0aW9uLCBhZGp1c3RtZW50cyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgaWYgKGJhc2VTZXNzaW9uRHVyYXRpb24pIHtcclxuICAgICAgc2NoZWR1bGVyLnNlc3Npb25EdXJhdGlvbkN1c3RvbWl6YXRpb24uYmFzZVNlc3Npb25EdXJhdGlvbiA9IGJhc2VTZXNzaW9uRHVyYXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFkanVzdG1lbnRzICYmIEFycmF5LmlzQXJyYXkoYWRqdXN0bWVudHMpKSB7XHJcbiAgICAgIHNjaGVkdWxlci5zZXNzaW9uRHVyYXRpb25DdXN0b21pemF0aW9uLmFkanVzdG1lbnRGYWN0b3JzID0gYWRqdXN0bWVudHM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g2K3Ys9in2Kgg2KfZhNmF2K/YqSDYp9mE2YXZiNi12Ykg2KjZh9inXHJcbiAgICBjb25zdCByZWNvbW1lbmRlZER1cmF0aW9uID0gY2FsY3VsYXRlUmVjb21tZW5kZWREdXJhdGlvbihzY2hlZHVsZXIpO1xyXG4gICAgc2NoZWR1bGVyLnNlc3Npb25EdXJhdGlvbkN1c3RvbWl6YXRpb24ucmVjb21tZW5kZWREdXJhdGlvbkFkanVzdG1lbnQgPSByZWNvbW1lbmRlZER1cmF0aW9uO1xyXG5cclxuICAgIGF3YWl0IHNjaGVkdWxlci5zYXZlKCk7XHJcblxyXG4gICAgcmVzLnN1Y2Nlc3Moc2NoZWR1bGVyLnNlc3Npb25EdXJhdGlvbkN1c3RvbWl6YXRpb24sICfYqtmFINiq2K7YtdmK2LUg2KfZhNmF2K/YqSDYqNmG2KzYp9itJyk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJlcy5lcnJvcihlcnJvciwgJ9mB2LTZhCDZgdmKINiq2K7YtdmK2LUg2KfZhNmF2K/YqScpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vKipcclxuICogR0VUIC9hcGkvc2NoZWR1bGVyLzppZC9hbmFseXRpY3NcclxuICog2KfZhNit2LXZiNmEINi52YTZiSDYqtit2YTZitmE2KfYqiDYp9mE2KzYr9mI2YTYqVxyXG4gKi9cclxucm91dGVyLmdldCgnLzppZC9hbmFseXRpY3MnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2NoZWR1bGVyID0gYXdhaXQgU21hcnRTY2hlZHVsZXIubW9kZWwuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XHJcblxyXG4gICAgaWYgKCFzY2hlZHVsZXIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5lcnJvcign2KfZhNis2K/ZiNmE2Kkg2LrZitixINmF2YjYrNmI2K/YqScsICdTY2hlZHVsZXIgbm90IGZvdW5kJywgNDA0KTtcclxuICAgIH1cclxuXHJcbiAgICByZXMuc3VjY2VzcyhcclxuICAgICAge1xyXG4gICAgICAgIGFuYWx5dGljczogc2NoZWR1bGVyLmFuYWx5dGljcyB8fCB7fSxcclxuICAgICAgICBlZmZpY2llbmN5OiBjYWxjdWxhdGVTY2hlZHVsZUVmZmljaWVuY3koc2NoZWR1bGVyKSxcclxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IGdlbmVyYXRlU2NoZWR1bGVSZWNvbW1lbmRhdGlvbnMoc2NoZWR1bGVyKSxcclxuICAgICAgfSxcclxuICAgICAgJ9iq2YUg2KzZhNioINiq2K3ZhNmK2YTYp9iqINin2YTYrNiv2YjZhNipJ1xyXG4gICAgKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLmVycm9yKGVycm9yLCAn2YHYtNmEINmB2Yog2KzZhNioINin2YTYqtit2YTZitmE2KfYqicpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyA9PT09PT09PT09PT0g2KfZhNiv2YjYp9mEINin2YTZhdiz2KfYudiv2KkgPT09PT09PT09PT09XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZVNjaGVkdWxlU3VnZ2VzdGlvbnMoc2NoZWR1bGVyKSB7XHJcbiAgLy8g2YXZhti32YIg2YTYqtmI2YTZitivINin2YTZhdmC2KrYsdit2KfYqiDYp9mE2LDZg9mK2KlcclxuICBjb25zdCBzdWdnZXN0aW9ucyA9IFtdO1xyXG4gIGNvbnN0IHsgcGxhblN0YXJ0RGF0ZSwgcGxhbkVuZERhdGUgfSA9IHNjaGVkdWxlci5zY2hlZHVsaW5nUGxhbjtcclxuXHJcbiAgbGV0IGN1cnJlbnREYXRlID0gbmV3IERhdGUocGxhblN0YXJ0RGF0ZSk7XHJcbiAgbGV0IHNlc3Npb25Db3VudCA9IDA7XHJcblxyXG4gIHdoaWxlIChcclxuICAgIGN1cnJlbnREYXRlIDw9IHBsYW5FbmREYXRlICYmXHJcbiAgICBzZXNzaW9uQ291bnQgPCBzY2hlZHVsZXIuc2NoZWR1bGluZ1BsYW4udG90YWxQbGFubmVkU2Vzc2lvbnNcclxuICApIHtcclxuICAgIGNvbnN0IGRheU9mV2VlayA9IGN1cnJlbnREYXRlLmdldERheSgpO1xyXG5cclxuICAgIC8vINiq2KzZhtioINin2YTYrNmF2LnYqSDZiNin2YTYs9io2KpcclxuICAgIGlmIChkYXlPZldlZWsgIT09IDUgJiYgZGF5T2ZXZWVrICE9PSA2KSB7XHJcbiAgICAgIHN1Z2dlc3Rpb25zLnB1c2goe1xyXG4gICAgICAgIHNjaGVkdWxlZERhdGVUaW1lOiBuZXcgRGF0ZShjdXJyZW50RGF0ZSksXHJcbiAgICAgICAgcmVjb21tZW5kZWRTcGVjaWFsaXN0OiB7XHJcbiAgICAgICAgICBuYW1lOiAn2YXYqtin2K0nLFxyXG4gICAgICAgICAgc3BlY2lhbGlzdElkOiBudWxsLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29uZmlkZW5jZVNjb3JlOiA4NSxcclxuICAgICAgICBleHBsYW5hdGlvbjogJ9mF2YjYudivINmF2KrYp9itINmI2YXZhtin2LPYqCcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBzZXNzaW9uQ291bnQrKztcclxuICAgIH1cclxuICAgIGN1cnJlbnREYXRlLnNldERhdGUoY3VycmVudERhdGUuZ2V0RGF0ZSgpICsgMSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc3VnZ2VzdGlvbnM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRldGVjdFNjaGVkdWxlQ29uZmxpY3RzKHNjaGVkdWxlcikge1xyXG4gIGNvbnN0IGNvbmZsaWN0cyA9IFtdO1xyXG5cclxuICAvLyDZhdmG2LfZgiDYp9mE2YPYtNmBINi52YYg2KfZhNiq2LnYp9ix2LbYp9iqXHJcbiAgLy8g2YXYq9in2YQ6INin2YTYrNmE2LPYp9iqINin2YTZhdiq2KrYp9mE2YrYqSDYr9mI2YYg2YHYqtix2Kkg2LHYp9it2KlcclxuXHJcbiAgcmV0dXJuIGNvbmZsaWN0cztcclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVSZXNvbHV0aW9uU3RyYXRlZ2llcyhjb25mbGljdHMpIHtcclxuICByZXR1cm4gY29uZmxpY3RzLm1hcChjb25mbGljdCA9PiAoe1xyXG4gICAgY29uZmxpY3Q6IGNvbmZsaWN0LFxyXG4gICAgc3RyYXRlZ2llczogWyfYqtij2KzZitmEINil2K3Yr9mJINin2YTYrNmE2LPYp9iqJywgJ9iq2LrZitmK2LEg2KfZhNij2K7Ytdin2KbZiicsICfYqti62YrZitixINin2YTZhdmI2YLYuSddLFxyXG4gIH0pKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2FsY3VsYXRlUmVjb21tZW5kZWREdXJhdGlvbihzY2hlZHVsZXIpIHtcclxuICByZXR1cm4ge1xyXG4gICAgc3VnZ2VzdGVkRHVyYXRpb246IDYwLFxyXG4gICAgcmVhc29uOiAn2YXYr9ipINmF2LnZitin2LHZitipINmF2YjYtdmJINio2YfYpycsXHJcbiAgICBiYXNlZE9uOiBbJ2Fzc2Vzc21lbnQnLCAnZmF0aWd1ZS1sZXZlbCddLFxyXG4gICAgY29uZmlkZW5jZTogODAsXHJcbiAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2FsY3VsYXRlU2NoZWR1bGVFZmZpY2llbmN5KHNjaGVkdWxlcikge1xyXG4gIC8vINit2LPYp9ioINmD2YHYp9ih2Kkg2KfZhNis2K/ZiNmE2KlcclxuICByZXR1cm4ge1xyXG4gICAgb3ZlcmFsbEVmZmljaWVuY3k6IDg1LFxyXG4gICAgcmVzb3VyY2VVdGlsaXphdGlvbjogOTAsXHJcbiAgICBzcGVjaWFsaXN0VXRpbGl6YXRpb246IDgwLFxyXG4gIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlU2NoZWR1bGVSZWNvbW1lbmRhdGlvbnMoc2NoZWR1bGVyKSB7XHJcbiAgcmV0dXJuIFsn2LLZitin2K/YqSDYudiv2K8g2KfZhNis2YTYs9in2Kog2KfZhNij2LPYqNmI2LnZitipJywgJ9il2LbYp9mB2Kkg2YHYqtix2KfYqiDYsdin2K3YqSDYo9i32YjZhCcsICfYqtmG2YjZiti5INin2YTYo9mG2LTYt9ipJ107XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xyXG4iXSwibWFw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