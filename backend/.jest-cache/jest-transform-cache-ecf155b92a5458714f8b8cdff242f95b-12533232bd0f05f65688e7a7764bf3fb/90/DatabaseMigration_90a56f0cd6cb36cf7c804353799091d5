2474a2a852e95a7f8a8c58a27b2b54fd
/**
 * Database Migration Service
 * Manages data migration between databases
 */

class DatabaseMigration {
  constructor(sourceDB, targetDB, logger = console) {
    this.sourceDB = sourceDB;
    this.targetDB = targetDB;
    this.logger = logger;
    this.migrationLog = [];
    this.batchSize = 1000;
  }

  /**
   * Set batch size for migration
   */
  setBatchSize(size) {
    this.batchSize = size;
    return this;
  }

  /**
   * Copy table from source to target
   */
  async migrateTable(tableName, options = {}) {
    const startTime = Date.now();
    const migrationRecord = {
      table: tableName,
      startTime: new Date().toISOString(),
      status: 'in_progress'
    };
    try {
      this.logger.info(`Starting migration for table: ${tableName}`);

      // Get total record count
      const countResult = await this.sourceDB.query(`SELECT COUNT(*) as count FROM ${tableName}`);
      const totalRecords = countResult[0]?.count || 0;
      if (totalRecords === 0) {
        this.logger.warn(`Table ${tableName} is empty`);
        migrationRecord.recordsMigrated = 0;
        migrationRecord.status = 'completed';
        this.migrationLog.push(migrationRecord);
        return migrationRecord;
      }
      let migratedCount = 0;
      let offset = 0;

      // Migrate in batches
      while (offset < totalRecords) {
        const rows = await this.sourceDB.query(`SELECT * FROM ${tableName} LIMIT ${this.batchSize} OFFSET ${offset}`);
        if (rows.length === 0) break;

        // Insert batch into target
        await this.insertBatch(tableName, rows, options);
        migratedCount += rows.length;
        offset += this.batchSize;
        const progress = (migratedCount / totalRecords * 100).toFixed(2);
        this.logger.info(`Migration progress for ${tableName}: ${progress}%`);
      }
      migrationRecord.recordsMigrated = migratedCount;
      migrationRecord.status = 'completed';
      migrationRecord.duration = Date.now() - startTime;
      migrationRecord.endTime = new Date().toISOString();
      this.migrationLog.push(migrationRecord);
      this.logger.info(`Successfully migrated ${migratedCount} records from ${tableName}`);
      return migrationRecord;
    } catch (error) {
      migrationRecord.status = 'failed';
      migrationRecord.error = error.message;
      migrationRecord.duration = Date.now() - startTime;
      this.migrationLog.push(migrationRecord);
      this.logger.error(`Migration failed for table ${tableName}: ${error.message}`);
      throw error;
    }
  }

  /**
   * Insert batch of records
   */
  async insertBatch(tableName, rows, options = {}) {
    if (rows.length === 0) return;
    try {
      const columns = Object.keys(rows[0]);
      const placeholders = rows.map(() => `(${columns.map(() => '?').join(',')})`).join(',');
      const values = rows.flatMap(row => columns.map(col => row[col]));
      const insertQuery = `INSERT INTO ${tableName} (${columns.join(',')}) VALUES ${placeholders}`;
      if (options.skipDuplicates) {
        return await this.insertBatchIgnoreDuplicates(tableName, rows, columns);
      }
      await this.targetDB.query(insertQuery, values);
    } catch (error) {
      throw new Error(`Failed to insert batch into ${tableName}: ${error.message}`);
    }
  }

  /**
   * Insert batch ignoring duplicates
   */
  async insertBatchIgnoreDuplicates(tableName, rows, columns) {
    for (const row of rows) {
      try {
        const values = columns.map(col => row[col]);
        const placeholders = columns.map(() => '?').join(',');
        const query = `INSERT IGNORE INTO ${tableName} (${columns.join(',')}) VALUES (${placeholders})`;
        await this.targetDB.query(query, values);
      } catch (error) {
        if (!error.message.includes('Duplicate')) {
          throw error;
        }
        // Skip duplicates
      }
    }
  }

  /**
   * Migrate multiple tables
   */
  async migrateTables(tableList, options = {}) {
    const results = [];
    for (const table of tableList) {
      try {
        const result = await this.migrateTable(table, options);
        results.push(result);
      } catch (error) {
        results.push({
          table,
          status: 'failed',
          error: error.message
        });
        if (!options.continueOnError) {
          throw error;
        }
      }
    }
    return results;
  }

  /**
   * Migrate with data transformation
   */
  async migrateTableWithTransform(tableName, transformFn, options = {}) {
    const startTime = Date.now();
    const migrationRecord = {
      table: tableName,
      startTime: new Date().toISOString(),
      status: 'in_progress'
    };
    try {
      this.logger.info(`Starting transformed migration for table: ${tableName}`);
      const countResult = await this.sourceDB.query(`SELECT COUNT(*) as count FROM ${tableName}`);
      const totalRecords = countResult[0]?.count || 0;
      let migratedCount = 0;
      let offset = 0;
      while (offset < totalRecords) {
        const rows = await this.sourceDB.query(`SELECT * FROM ${tableName} LIMIT ${this.batchSize} OFFSET ${offset}`);
        if (rows.length === 0) break;

        // Transform rows
        const transformedRows = rows.map(row => transformFn(row));

        // Insert transformed batch
        await this.insertBatch(tableName, transformedRows, options);
        migratedCount += rows.length;
        offset += this.batchSize;
      }
      migrationRecord.recordsMigrated = migratedCount;
      migrationRecord.status = 'completed';
      migrationRecord.duration = Date.now() - startTime;
      this.migrationLog.push(migrationRecord);
      return migrationRecord;
    } catch (error) {
      migrationRecord.status = 'failed';
      migrationRecord.error = error.message;
      this.migrationLog.push(migrationRecord);
      throw error;
    }
  }

  /**
   * Verify migration integrity
   */
  async verifyMigration(tableName) {
    try {
      const sourceCount = await this.sourceDB.query(`SELECT COUNT(*) as count FROM ${tableName}`);
      const targetCount = await this.targetDB.query(`SELECT COUNT(*) as count FROM ${tableName}`);
      const sourceRecords = sourceCount[0]?.count || 0;
      const targetRecords = targetCount[0]?.count || 0;
      return {
        table: tableName,
        sourceRecords,
        targetRecords,
        match: sourceRecords === targetRecords,
        discrepancy: Math.abs(sourceRecords - targetRecords)
      };
    } catch (error) {
      throw new Error(`Verification failed for table ${tableName}: ${error.message}`);
    }
  }

  /**
   * Verify all tables
   */
  async verifyAllMigrations(tableList) {
    const results = [];
    for (const table of tableList) {
      try {
        const result = await this.verifyMigration(table);
        results.push(result);
      } catch (error) {
        results.push({
          table,
          error: error.message
        });
      }
    }
    return results;
  }

  /**
   * Rollback migration
   */
  async rollbackMigration(tableName) {
    try {
      this.logger.info(`Rolling back migration for table: ${tableName}`);

      // Truncate target table
      await this.targetDB.query(`TRUNCATE TABLE ${tableName}`);
      this.logger.info(`Successfully rolled back table: ${tableName}`);
      return {
        table: tableName,
        status: 'rolled_back'
      };
    } catch (error) {
      throw new Error(`Rollback failed for table ${tableName}: ${error.message}`);
    }
  }

  /**
   * Get migration log
   */
  getMigrationLog() {
    return this.migrationLog;
  }

  /**
   * Get migration summary
   */
  getMigrationSummary() {
    const log = this.migrationLog;
    const completed = log.filter(l => l.status === 'completed');
    const failed = log.filter(l => l.status === 'failed');
    const totalRecords = completed.reduce((sum, l) => sum + (l.recordsMigrated || 0), 0);
    const totalDuration = completed.reduce((sum, l) => sum + (l.duration || 0), 0);
    return {
      totalTables: log.length,
      completedTables: completed.length,
      failedTables: failed.length,
      totalRecordsMigrated: totalRecords,
      totalDuration,
      averageTimePerTable: completed.length > 0 ? totalDuration / completed.length : 0,
      migrations: log
    };
  }

  /**
   * Clear migration log
   */
  clearLog() {
    this.migrationLog = [];
    return this;
  }
}
module.exports = DatabaseMigration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEYXRhYmFzZU1pZ3JhdGlvbiIsImNvbnN0cnVjdG9yIiwic291cmNlREIiLCJ0YXJnZXREQiIsImxvZ2dlciIsImNvbnNvbGUiLCJtaWdyYXRpb25Mb2ciLCJiYXRjaFNpemUiLCJzZXRCYXRjaFNpemUiLCJzaXplIiwibWlncmF0ZVRhYmxlIiwidGFibGVOYW1lIiwib3B0aW9ucyIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJtaWdyYXRpb25SZWNvcmQiLCJ0YWJsZSIsInRvSVNPU3RyaW5nIiwic3RhdHVzIiwiaW5mbyIsImNvdW50UmVzdWx0IiwicXVlcnkiLCJ0b3RhbFJlY29yZHMiLCJjb3VudCIsIndhcm4iLCJyZWNvcmRzTWlncmF0ZWQiLCJwdXNoIiwibWlncmF0ZWRDb3VudCIsIm9mZnNldCIsInJvd3MiLCJsZW5ndGgiLCJpbnNlcnRCYXRjaCIsInByb2dyZXNzIiwidG9GaXhlZCIsImR1cmF0aW9uIiwiZW5kVGltZSIsImVycm9yIiwibWVzc2FnZSIsImNvbHVtbnMiLCJPYmplY3QiLCJrZXlzIiwicGxhY2Vob2xkZXJzIiwibWFwIiwiam9pbiIsInZhbHVlcyIsImZsYXRNYXAiLCJyb3ciLCJjb2wiLCJpbnNlcnRRdWVyeSIsInNraXBEdXBsaWNhdGVzIiwiaW5zZXJ0QmF0Y2hJZ25vcmVEdXBsaWNhdGVzIiwiRXJyb3IiLCJpbmNsdWRlcyIsIm1pZ3JhdGVUYWJsZXMiLCJ0YWJsZUxpc3QiLCJyZXN1bHRzIiwicmVzdWx0IiwiY29udGludWVPbkVycm9yIiwibWlncmF0ZVRhYmxlV2l0aFRyYW5zZm9ybSIsInRyYW5zZm9ybUZuIiwidHJhbnNmb3JtZWRSb3dzIiwidmVyaWZ5TWlncmF0aW9uIiwic291cmNlQ291bnQiLCJ0YXJnZXRDb3VudCIsInNvdXJjZVJlY29yZHMiLCJ0YXJnZXRSZWNvcmRzIiwibWF0Y2giLCJkaXNjcmVwYW5jeSIsIk1hdGgiLCJhYnMiLCJ2ZXJpZnlBbGxNaWdyYXRpb25zIiwicm9sbGJhY2tNaWdyYXRpb24iLCJnZXRNaWdyYXRpb25Mb2ciLCJnZXRNaWdyYXRpb25TdW1tYXJ5IiwibG9nIiwiY29tcGxldGVkIiwiZmlsdGVyIiwibCIsImZhaWxlZCIsInJlZHVjZSIsInN1bSIsInRvdGFsRHVyYXRpb24iLCJ0b3RhbFRhYmxlcyIsImNvbXBsZXRlZFRhYmxlcyIsImZhaWxlZFRhYmxlcyIsInRvdGFsUmVjb3Jkc01pZ3JhdGVkIiwiYXZlcmFnZVRpbWVQZXJUYWJsZSIsIm1pZ3JhdGlvbnMiLCJjbGVhckxvZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJEYXRhYmFzZU1pZ3JhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRGF0YWJhc2UgTWlncmF0aW9uIFNlcnZpY2VcclxuICogTWFuYWdlcyBkYXRhIG1pZ3JhdGlvbiBiZXR3ZWVuIGRhdGFiYXNlc1xyXG4gKi9cclxuXHJcbmNsYXNzIERhdGFiYXNlTWlncmF0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcihzb3VyY2VEQiwgdGFyZ2V0REIsIGxvZ2dlciA9IGNvbnNvbGUpIHtcclxuICAgIHRoaXMuc291cmNlREIgPSBzb3VyY2VEQjtcclxuICAgIHRoaXMudGFyZ2V0REIgPSB0YXJnZXREQjtcclxuICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xyXG4gICAgdGhpcy5taWdyYXRpb25Mb2cgPSBbXTtcclxuICAgIHRoaXMuYmF0Y2hTaXplID0gMTAwMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCBiYXRjaCBzaXplIGZvciBtaWdyYXRpb25cclxuICAgKi9cclxuICBzZXRCYXRjaFNpemUoc2l6ZSkge1xyXG4gICAgdGhpcy5iYXRjaFNpemUgPSBzaXplO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb3B5IHRhYmxlIGZyb20gc291cmNlIHRvIHRhcmdldFxyXG4gICAqL1xyXG4gIGFzeW5jIG1pZ3JhdGVUYWJsZSh0YWJsZU5hbWUsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgIGNvbnN0IG1pZ3JhdGlvblJlY29yZCA9IHtcclxuICAgICAgdGFibGU6IHRhYmxlTmFtZSxcclxuICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHN0YXR1czogJ2luX3Byb2dyZXNzJyxcclxuICAgIH07XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgU3RhcnRpbmcgbWlncmF0aW9uIGZvciB0YWJsZTogJHt0YWJsZU5hbWV9YCk7XHJcblxyXG4gICAgICAvLyBHZXQgdG90YWwgcmVjb3JkIGNvdW50XHJcbiAgICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5zb3VyY2VEQi5xdWVyeShcclxuICAgICAgICBgU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gJHt0YWJsZU5hbWV9YCxcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgdG90YWxSZWNvcmRzID0gY291bnRSZXN1bHRbMF0/LmNvdW50IHx8IDA7XHJcblxyXG4gICAgICBpZiAodG90YWxSZWNvcmRzID09PSAwKSB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihgVGFibGUgJHt0YWJsZU5hbWV9IGlzIGVtcHR5YCk7XHJcbiAgICAgICAgbWlncmF0aW9uUmVjb3JkLnJlY29yZHNNaWdyYXRlZCA9IDA7XHJcbiAgICAgICAgbWlncmF0aW9uUmVjb3JkLnN0YXR1cyA9ICdjb21wbGV0ZWQnO1xyXG4gICAgICAgIHRoaXMubWlncmF0aW9uTG9nLnB1c2gobWlncmF0aW9uUmVjb3JkKTtcclxuICAgICAgICByZXR1cm4gbWlncmF0aW9uUmVjb3JkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgbWlncmF0ZWRDb3VudCA9IDA7XHJcbiAgICAgIGxldCBvZmZzZXQgPSAwO1xyXG5cclxuICAgICAgLy8gTWlncmF0ZSBpbiBiYXRjaGVzXHJcbiAgICAgIHdoaWxlIChvZmZzZXQgPCB0b3RhbFJlY29yZHMpIHtcclxuICAgICAgICBjb25zdCByb3dzID0gYXdhaXQgdGhpcy5zb3VyY2VEQi5xdWVyeShcclxuICAgICAgICAgIGBTRUxFQ1QgKiBGUk9NICR7dGFibGVOYW1lfSBMSU1JVCAke3RoaXMuYmF0Y2hTaXplfSBPRkZTRVQgJHtvZmZzZXR9YCxcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAocm93cy5sZW5ndGggPT09IDApIGJyZWFrO1xyXG5cclxuICAgICAgICAvLyBJbnNlcnQgYmF0Y2ggaW50byB0YXJnZXRcclxuICAgICAgICBhd2FpdCB0aGlzLmluc2VydEJhdGNoKHRhYmxlTmFtZSwgcm93cywgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIG1pZ3JhdGVkQ291bnQgKz0gcm93cy5sZW5ndGg7XHJcbiAgICAgICAgb2Zmc2V0ICs9IHRoaXMuYmF0Y2hTaXplO1xyXG5cclxuICAgICAgICBjb25zdCBwcm9ncmVzcyA9ICgobWlncmF0ZWRDb3VudCAvIHRvdGFsUmVjb3JkcykgKiAxMDApLnRvRml4ZWQoMik7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgTWlncmF0aW9uIHByb2dyZXNzIGZvciAke3RhYmxlTmFtZX06ICR7cHJvZ3Jlc3N9JWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBtaWdyYXRpb25SZWNvcmQucmVjb3Jkc01pZ3JhdGVkID0gbWlncmF0ZWRDb3VudDtcclxuICAgICAgbWlncmF0aW9uUmVjb3JkLnN0YXR1cyA9ICdjb21wbGV0ZWQnO1xyXG4gICAgICBtaWdyYXRpb25SZWNvcmQuZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgICBtaWdyYXRpb25SZWNvcmQuZW5kVGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuXHJcbiAgICAgIHRoaXMubWlncmF0aW9uTG9nLnB1c2gobWlncmF0aW9uUmVjb3JkKTtcclxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgU3VjY2Vzc2Z1bGx5IG1pZ3JhdGVkICR7bWlncmF0ZWRDb3VudH0gcmVjb3JkcyBmcm9tICR7dGFibGVOYW1lfWApO1xyXG5cclxuICAgICAgcmV0dXJuIG1pZ3JhdGlvblJlY29yZDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIG1pZ3JhdGlvblJlY29yZC5zdGF0dXMgPSAnZmFpbGVkJztcclxuICAgICAgbWlncmF0aW9uUmVjb3JkLmVycm9yID0gZXJyb3IubWVzc2FnZTtcclxuICAgICAgbWlncmF0aW9uUmVjb3JkLmR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuICAgICAgdGhpcy5taWdyYXRpb25Mb2cucHVzaChtaWdyYXRpb25SZWNvcmQpO1xyXG5cclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYE1pZ3JhdGlvbiBmYWlsZWQgZm9yIHRhYmxlICR7dGFibGVOYW1lfTogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluc2VydCBiYXRjaCBvZiByZWNvcmRzXHJcbiAgICovXHJcbiAgYXN5bmMgaW5zZXJ0QmF0Y2godGFibGVOYW1lLCByb3dzLCBvcHRpb25zID0ge30pIHtcclxuICAgIGlmIChyb3dzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGNvbHVtbnMgPSBPYmplY3Qua2V5cyhyb3dzWzBdKTtcclxuICAgICAgY29uc3QgcGxhY2Vob2xkZXJzID0gcm93cy5tYXAoKCkgPT4gYCgke2NvbHVtbnMubWFwKCgpID0+ICc/Jykuam9pbignLCcpfSlgKS5qb2luKCcsJyk7XHJcbiAgICAgIGNvbnN0IHZhbHVlcyA9IHJvd3MuZmxhdE1hcCgocm93KSA9PiBjb2x1bW5zLm1hcCgoY29sKSA9PiByb3dbY29sXSkpO1xyXG5cclxuICAgICAgY29uc3QgaW5zZXJ0UXVlcnkgPSBgSU5TRVJUIElOVE8gJHt0YWJsZU5hbWV9ICgke2NvbHVtbnMuam9pbignLCcpfSkgVkFMVUVTICR7cGxhY2Vob2xkZXJzfWA7XHJcblxyXG4gICAgICBpZiAob3B0aW9ucy5za2lwRHVwbGljYXRlcykge1xyXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmluc2VydEJhdGNoSWdub3JlRHVwbGljYXRlcyh0YWJsZU5hbWUsIHJvd3MsIGNvbHVtbnMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCB0aGlzLnRhcmdldERCLnF1ZXJ5KGluc2VydFF1ZXJ5LCB2YWx1ZXMpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gaW5zZXJ0IGJhdGNoIGludG8gJHt0YWJsZU5hbWV9OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbnNlcnQgYmF0Y2ggaWdub3JpbmcgZHVwbGljYXRlc1xyXG4gICAqL1xyXG4gIGFzeW5jIGluc2VydEJhdGNoSWdub3JlRHVwbGljYXRlcyh0YWJsZU5hbWUsIHJvd3MsIGNvbHVtbnMpIHtcclxuICAgIGZvciAoY29uc3Qgcm93IG9mIHJvd3MpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB2YWx1ZXMgPSBjb2x1bW5zLm1hcCgoY29sKSA9PiByb3dbY29sXSk7XHJcbiAgICAgICAgY29uc3QgcGxhY2Vob2xkZXJzID0gY29sdW1ucy5tYXAoKCkgPT4gJz8nKS5qb2luKCcsJyk7XHJcbiAgICAgICAgY29uc3QgcXVlcnkgPSBgSU5TRVJUIElHTk9SRSBJTlRPICR7dGFibGVOYW1lfSAoJHtjb2x1bW5zLmpvaW4oJywnKX0pIFZBTFVFUyAoJHtwbGFjZWhvbGRlcnN9KWA7XHJcbiAgICAgICAgYXdhaXQgdGhpcy50YXJnZXREQi5xdWVyeShxdWVyeSwgdmFsdWVzKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBpZiAoIWVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0R1cGxpY2F0ZScpKSB7XHJcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU2tpcCBkdXBsaWNhdGVzXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1pZ3JhdGUgbXVsdGlwbGUgdGFibGVzXHJcbiAgICovXHJcbiAgYXN5bmMgbWlncmF0ZVRhYmxlcyh0YWJsZUxpc3QsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xyXG5cclxuICAgIGZvciAoY29uc3QgdGFibGUgb2YgdGFibGVMaXN0KSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5taWdyYXRlVGFibGUodGFibGUsIG9wdGlvbnMpO1xyXG4gICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaCh7XHJcbiAgICAgICAgICB0YWJsZSxcclxuICAgICAgICAgIHN0YXR1czogJ2ZhaWxlZCcsXHJcbiAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKCFvcHRpb25zLmNvbnRpbnVlT25FcnJvcikge1xyXG4gICAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNaWdyYXRlIHdpdGggZGF0YSB0cmFuc2Zvcm1hdGlvblxyXG4gICAqL1xyXG4gIGFzeW5jIG1pZ3JhdGVUYWJsZVdpdGhUcmFuc2Zvcm0odGFibGVOYW1lLCB0cmFuc2Zvcm1Gbiwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3QgbWlncmF0aW9uUmVjb3JkID0ge1xyXG4gICAgICB0YWJsZTogdGFibGVOYW1lLFxyXG4gICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgc3RhdHVzOiAnaW5fcHJvZ3Jlc3MnLFxyXG4gICAgfTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLmxvZ2dlci5pbmZvKGBTdGFydGluZyB0cmFuc2Zvcm1lZCBtaWdyYXRpb24gZm9yIHRhYmxlOiAke3RhYmxlTmFtZX1gKTtcclxuXHJcbiAgICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgdGhpcy5zb3VyY2VEQi5xdWVyeShcclxuICAgICAgICBgU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gJHt0YWJsZU5hbWV9YCxcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgdG90YWxSZWNvcmRzID0gY291bnRSZXN1bHRbMF0/LmNvdW50IHx8IDA7XHJcblxyXG4gICAgICBsZXQgbWlncmF0ZWRDb3VudCA9IDA7XHJcbiAgICAgIGxldCBvZmZzZXQgPSAwO1xyXG5cclxuICAgICAgd2hpbGUgKG9mZnNldCA8IHRvdGFsUmVjb3Jkcykge1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCB0aGlzLnNvdXJjZURCLnF1ZXJ5KFxyXG4gICAgICAgICAgYFNFTEVDVCAqIEZST00gJHt0YWJsZU5hbWV9IExJTUlUICR7dGhpcy5iYXRjaFNpemV9IE9GRlNFVCAke29mZnNldH1gLFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChyb3dzLmxlbmd0aCA9PT0gMCkgYnJlYWs7XHJcblxyXG4gICAgICAgIC8vIFRyYW5zZm9ybSByb3dzXHJcbiAgICAgICAgY29uc3QgdHJhbnNmb3JtZWRSb3dzID0gcm93cy5tYXAoKHJvdykgPT4gdHJhbnNmb3JtRm4ocm93KSk7XHJcblxyXG4gICAgICAgIC8vIEluc2VydCB0cmFuc2Zvcm1lZCBiYXRjaFxyXG4gICAgICAgIGF3YWl0IHRoaXMuaW5zZXJ0QmF0Y2godGFibGVOYW1lLCB0cmFuc2Zvcm1lZFJvd3MsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICBtaWdyYXRlZENvdW50ICs9IHJvd3MubGVuZ3RoO1xyXG4gICAgICAgIG9mZnNldCArPSB0aGlzLmJhdGNoU2l6ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbWlncmF0aW9uUmVjb3JkLnJlY29yZHNNaWdyYXRlZCA9IG1pZ3JhdGVkQ291bnQ7XHJcbiAgICAgIG1pZ3JhdGlvblJlY29yZC5zdGF0dXMgPSAnY29tcGxldGVkJztcclxuICAgICAgbWlncmF0aW9uUmVjb3JkLmR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuXHJcbiAgICAgIHRoaXMubWlncmF0aW9uTG9nLnB1c2gobWlncmF0aW9uUmVjb3JkKTtcclxuICAgICAgcmV0dXJuIG1pZ3JhdGlvblJlY29yZDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIG1pZ3JhdGlvblJlY29yZC5zdGF0dXMgPSAnZmFpbGVkJztcclxuICAgICAgbWlncmF0aW9uUmVjb3JkLmVycm9yID0gZXJyb3IubWVzc2FnZTtcclxuICAgICAgdGhpcy5taWdyYXRpb25Mb2cucHVzaChtaWdyYXRpb25SZWNvcmQpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZlcmlmeSBtaWdyYXRpb24gaW50ZWdyaXR5XHJcbiAgICovXHJcbiAgYXN5bmMgdmVyaWZ5TWlncmF0aW9uKHRhYmxlTmFtZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc291cmNlQ291bnQgPSBhd2FpdCB0aGlzLnNvdXJjZURCLnF1ZXJ5KFxyXG4gICAgICAgIGBTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSAke3RhYmxlTmFtZX1gLFxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCB0YXJnZXRDb3VudCA9IGF3YWl0IHRoaXMudGFyZ2V0REIucXVlcnkoXHJcbiAgICAgICAgYFNFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NICR7dGFibGVOYW1lfWAsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCBzb3VyY2VSZWNvcmRzID0gc291cmNlQ291bnRbMF0/LmNvdW50IHx8IDA7XHJcbiAgICAgIGNvbnN0IHRhcmdldFJlY29yZHMgPSB0YXJnZXRDb3VudFswXT8uY291bnQgfHwgMDtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdGFibGU6IHRhYmxlTmFtZSxcclxuICAgICAgICBzb3VyY2VSZWNvcmRzLFxyXG4gICAgICAgIHRhcmdldFJlY29yZHMsXHJcbiAgICAgICAgbWF0Y2g6IHNvdXJjZVJlY29yZHMgPT09IHRhcmdldFJlY29yZHMsXHJcbiAgICAgICAgZGlzY3JlcGFuY3k6IE1hdGguYWJzKHNvdXJjZVJlY29yZHMgLSB0YXJnZXRSZWNvcmRzKSxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVmVyaWZpY2F0aW9uIGZhaWxlZCBmb3IgdGFibGUgJHt0YWJsZU5hbWV9OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWZXJpZnkgYWxsIHRhYmxlc1xyXG4gICAqL1xyXG4gIGFzeW5jIHZlcmlmeUFsbE1pZ3JhdGlvbnModGFibGVMaXN0KSB7XHJcbiAgICBjb25zdCByZXN1bHRzID0gW107XHJcblxyXG4gICAgZm9yIChjb25zdCB0YWJsZSBvZiB0YWJsZUxpc3QpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnZlcmlmeU1pZ3JhdGlvbih0YWJsZSk7XHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgIHRhYmxlLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0cztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJvbGxiYWNrIG1pZ3JhdGlvblxyXG4gICAqL1xyXG4gIGFzeW5jIHJvbGxiYWNrTWlncmF0aW9uKHRhYmxlTmFtZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgUm9sbGluZyBiYWNrIG1pZ3JhdGlvbiBmb3IgdGFibGU6ICR7dGFibGVOYW1lfWApO1xyXG5cclxuICAgICAgLy8gVHJ1bmNhdGUgdGFyZ2V0IHRhYmxlXHJcbiAgICAgIGF3YWl0IHRoaXMudGFyZ2V0REIucXVlcnkoYFRSVU5DQVRFIFRBQkxFICR7dGFibGVOYW1lfWApO1xyXG5cclxuICAgICAgdGhpcy5sb2dnZXIuaW5mbyhgU3VjY2Vzc2Z1bGx5IHJvbGxlZCBiYWNrIHRhYmxlOiAke3RhYmxlTmFtZX1gKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdGFibGU6IHRhYmxlTmFtZSxcclxuICAgICAgICBzdGF0dXM6ICdyb2xsZWRfYmFjaycsXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFJvbGxiYWNrIGZhaWxlZCBmb3IgdGFibGUgJHt0YWJsZU5hbWV9OiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgbWlncmF0aW9uIGxvZ1xyXG4gICAqL1xyXG4gIGdldE1pZ3JhdGlvbkxvZygpIHtcclxuICAgIHJldHVybiB0aGlzLm1pZ3JhdGlvbkxvZztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBtaWdyYXRpb24gc3VtbWFyeVxyXG4gICAqL1xyXG4gIGdldE1pZ3JhdGlvblN1bW1hcnkoKSB7XHJcbiAgICBjb25zdCBsb2cgPSB0aGlzLm1pZ3JhdGlvbkxvZztcclxuICAgIGNvbnN0IGNvbXBsZXRlZCA9IGxvZy5maWx0ZXIoKGwpID0+IGwuc3RhdHVzID09PSAnY29tcGxldGVkJyk7XHJcbiAgICBjb25zdCBmYWlsZWQgPSBsb2cuZmlsdGVyKChsKSA9PiBsLnN0YXR1cyA9PT0gJ2ZhaWxlZCcpO1xyXG4gICAgY29uc3QgdG90YWxSZWNvcmRzID0gY29tcGxldGVkLnJlZHVjZSgoc3VtLCBsKSA9PiBzdW0gKyAobC5yZWNvcmRzTWlncmF0ZWQgfHwgMCksIDApO1xyXG4gICAgY29uc3QgdG90YWxEdXJhdGlvbiA9IGNvbXBsZXRlZC5yZWR1Y2UoKHN1bSwgbCkgPT4gc3VtICsgKGwuZHVyYXRpb24gfHwgMCksIDApO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRvdGFsVGFibGVzOiBsb2cubGVuZ3RoLFxyXG4gICAgICBjb21wbGV0ZWRUYWJsZXM6IGNvbXBsZXRlZC5sZW5ndGgsXHJcbiAgICAgIGZhaWxlZFRhYmxlczogZmFpbGVkLmxlbmd0aCxcclxuICAgICAgdG90YWxSZWNvcmRzTWlncmF0ZWQ6IHRvdGFsUmVjb3JkcyxcclxuICAgICAgdG90YWxEdXJhdGlvbixcclxuICAgICAgYXZlcmFnZVRpbWVQZXJUYWJsZTogY29tcGxldGVkLmxlbmd0aCA+IDAgPyB0b3RhbER1cmF0aW9uIC8gY29tcGxldGVkLmxlbmd0aCA6IDAsXHJcbiAgICAgIG1pZ3JhdGlvbnM6IGxvZyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhciBtaWdyYXRpb24gbG9nXHJcbiAgICovXHJcbiAgY2xlYXJMb2coKSB7XHJcbiAgICB0aGlzLm1pZ3JhdGlvbkxvZyA9IFtdO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IERhdGFiYXNlTWlncmF0aW9uO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLGlCQUFpQixDQUFD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