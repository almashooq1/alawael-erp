85c0549ca6831e8450753161e736fee4
/**
 * Real-time Dashboard Integration Service
 * Aggregates data from multiple sources and provides real-time updates
 * 
 * Features:
 * - Multi-source data aggregation
 * - Real-time data streaming
 * - Data caching and optimization
 * - Webhook integration
 * - WebSocket support
 * - Data consistency checks
 */

const logger = require('../utils/logger');
class RealtimeDashboardService {
  constructor() {
    this.dataConnections = new Map();
    this.activeSubscriptions = new Map();
    this.cachedData = new Map();
    this.webhooks = [];
    this.streamingConnections = [];
    this.lastUpdateTime = new Map();
  }

  /**
   * Initialize real-time connections
   */
  async initialize() {
    try {
      logger.info('ðŸš€ Real-time Dashboard Service: Initializing...');

      // Initialize data sources
      this.initializeDataSources();

      // Setup caching
      this.setupCaching();

      // Enable real-time updates
      this.enableRealtimeUpdates();
      logger.info('âœ… Real-time Dashboard Service: Initialized');
      return true;
    } catch (error) {
      logger.error('âŒ Real-time Dashboard Service: Initialization failed', error);
      return false;
    }
  }

  /**
   * Initialize available data sources
   */
  initializeDataSources() {
    const sources = [{
      id: 'financial',
      name: 'Financial Data',
      endpoints: ['/api/finance/transactions', '/api/finance/budgets'],
      refreshInterval: 60000 // 1 minute
    }, {
      id: 'hr',
      name: 'HR Data',
      endpoints: ['/api/hr/employees', '/api/hr/attendance'],
      refreshInterval: 300000 // 5 minutes
    }, {
      id: 'operations',
      name: 'Operations Data',
      endpoints: ['/api/operations/tasks', '/api/operations/efficiency'],
      refreshInterval: 120000 // 2 minutes
    }, {
      id: 'customer',
      name: 'Customer Data',
      endpoints: ['/api/customer/satisfaction', '/api/customer/engagement'],
      refreshInterval: 180000 // 3 minutes
    }, {
      id: 'system',
      name: 'System Performance',
      endpoints: ['/api/system/health', '/api/system/performance'],
      refreshInterval: 30000 // 30 seconds
    }];
    sources.forEach(source => {
      this.dataConnections.set(source.id, {
        ...source,
        lastFetch: null,
        status: 'inactive',
        data: null
      });
    });
  }

  /**
   * Setup data caching
   */
  setupCaching() {
    const cacheStrategy = {
      financialData: {
        ttl: 60000,
        maxSize: 1000
      },
      hrData: {
        ttl: 300000,
        maxSize: 500
      },
      operationsData: {
        ttl: 120000,
        maxSize: 500
      },
      customerData: {
        ttl: 180000,
        maxSize: 500
      },
      systemMetrics: {
        ttl: 30000,
        maxSize: 2000
      }
    };
    for (const [key, config] of Object.entries(cacheStrategy)) {
      this.cachedData.set(key, {
        data: null,
        timestamp: null,
        ttl: config.ttl,
        maxSize: config.maxSize
      });
    }
  }

  /**
   * Enable real-time updates
   */
  enableRealtimeUpdates() {
    // Setup periodic update intervals for each data source
    for (const [sourceId, source] of this.dataConnections.entries()) {
      setInterval(() => {
        this.fetchSourceData(sourceId);
      }, source.refreshInterval);
    }
  }

  /**
   * Fetch data from a specific source
   */
  async fetchSourceData(sourceId) {
    const source = this.dataConnections.get(sourceId);
    if (!source) return;
    try {
      // Simulate data fetching
      const data = this.generateMockData(sourceId);
      source.data = data;
      source.lastFetch = new Date();
      source.status = 'active';
      this.updateCache(sourceId, data);
      this.notifySubscribers(sourceId, data);
      return data;
    } catch (error) {
      logger.error(`Error fetching data from ${sourceId}:`, error);
      source.status = 'error';
      source.error = error.message;
    }
  }

  /**
   * Generate mock data for demonstration
   */
  generateMockData(sourceId) {
    const baseData = {
      timestamp: new Date(),
      sourceId
    };
    switch (sourceId) {
      case 'financial':
        return {
          ...baseData,
          totalRevenue: 950000,
          totalExpenses: 620000,
          netProfit: 330000,
          cashFlow: 120000,
          budgetUtilization: 78.5,
          transactions: [{
            id: 1,
            amount: 50000,
            type: 'income',
            date: new Date()
          }, {
            id: 2,
            amount: 15000,
            type: 'expense',
            date: new Date()
          }]
        };
      case 'hr':
        return {
          ...baseData,
          totalEmployees: 250,
          activeEmployees: 245,
          attendanceRate: 96.2,
          trainingCompleted: 178,
          performanceRating: 4.2,
          departments: {
            engineering: 85,
            sales: 45,
            support: 40,
            admin: 35,
            hr: 15,
            management: 15
          }
        };
      case 'operations':
        return {
          ...baseData,
          activeProjects: 12,
          completedTasks: 84,
          pendingTasks: 23,
          operationalEfficiency: 88.5,
          projectCompletion: 91.2,
          averageTaskDuration: 4.5,
          bottlenecks: ['approval_process', 'resource_allocation']
        };
      case 'customer':
        return {
          ...baseData,
          totalCustomers: 1200,
          activeCustomers: 950,
          customerSatisfaction: 92,
          nps: 74,
          retentionRate: 94.2,
          churnRate: 1.2,
          averageTicketResolutionTime: 2.3,
          openTickets: 23
        };
      case 'system':
        return {
          ...baseData,
          uptime: 99.98,
          averageResponseTime: 125,
          errorRate: 0.02,
          cacheHitRate: 94.5,
          databaseHealth: 'healthy',
          messageQueueDepth: 234,
          activeConnections: 2048,
          cpuUsage: 45.2,
          memoryUsage: 62.8
        };
      default:
        return baseData;
    }
  }

  /**
   * Update cache with new data
   */
  updateCache(sourceId, data) {
    const cacheKey = `${sourceId}Data`;
    const cacheEntry = this.cachedData.get(cacheKey);
    if (cacheEntry) {
      cacheEntry.data = data;
      cacheEntry.timestamp = new Date();
      this.lastUpdateTime.set(sourceId, new Date());
    }
  }

  /**
   * Get cached data
   */
  getCachedData(sourceId) {
    const cacheKey = `${sourceId}Data`;
    const cacheEntry = this.cachedData.get(cacheKey);
    if (!cacheEntry) return null;

    // Check if cache is still valid
    if (cacheEntry.timestamp && Date.now() - cacheEntry.timestamp.getTime() > cacheEntry.ttl) {
      return null; // Cache expired
    }
    return cacheEntry.data;
  }

  /**
   * Get aggregated dashboard data
   */
  getAggregatedDashboardData() {
    const aggregated = {
      timestamp: new Date(),
      sources: {},
      summary: {
        healthStatus: 'healthy',
        dataFreshness: {}
      }
    };
    for (const [sourceId, source] of this.dataConnections.entries()) {
      const cachedData = this.getCachedData(sourceId);
      aggregated.sources[sourceId] = {
        name: source.name,
        status: source.status,
        lastUpdate: source.lastFetch,
        data: cachedData || source.data
      };

      // Calculate data freshness
      if (source.lastFetch) {
        const age = Date.now() - source.lastFetch.getTime();
        aggregated.summary.dataFreshness[sourceId] = {
          ageMs: age,
          isFresh: age < source.refreshInterval * 2
        };
      }
    }
    return aggregated;
  }

  /**
   * Subscribe to real-time updates
   */
  subscribe(sourceId, callback) {
    if (!this.activeSubscriptions.has(sourceId)) {
      this.activeSubscriptions.set(sourceId, []);
    }
    this.activeSubscriptions.get(sourceId).push(callback);

    // Return unsubscribe function
    return () => {
      const callbacks = this.activeSubscriptions.get(sourceId);
      const index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    };
  }

  /**
   * Notify subscribers of data updates
   */
  notifySubscribers(sourceId, data) {
    const callbacks = this.activeSubscriptions.get(sourceId);
    if (callbacks) {
      callbacks.forEach(callback => {
        try {
          callback(data);
        } catch (error) {
          logger.error(`Error in subscriber callback for ${sourceId}:`, error);
        }
      });
    }
  }

  /**
   * Register webhook for external notifications
   */
  registerWebhook(sourceId, url, events = []) {
    const webhook = {
      id: `webhook_${Date.now()}`,
      sourceId,
      url,
      events: events.length > 0 ? events : ['update'],
      createdAt: new Date(),
      active: true
    };
    this.webhooks.push(webhook);
    return webhook;
  }

  /**
   * Trigger webhook event
   */
  async triggerWebhook(sourceId, eventType, data) {
    const relevantWebhooks = this.webhooks.filter(w => w.sourceId === sourceId && w.events.includes(eventType) && w.active);
    for (const webhook of relevantWebhooks) {
      try {
        // Simulate webhook call
        logger.info(`Triggering webhook: ${webhook.url}`, {
          eventType,
          sourceId
        });
        // In real implementation, would use axios or fetch to call webhook
      } catch (error) {
        logger.error(`Webhook trigger failed: ${webhook.id}`, error);
      }
    }
  }

  /**
   * Get data quality metrics
   */
  getDataQualityMetrics() {
    const metrics = {
      timestamp: new Date(),
      sources: {},
      overall: {
        completeness: 0,
        accuracy: 0,
        timeliness: 0,
        consistency: 0
      }
    };
    let totalCompleteness = 0;
    let totalTimeliness = 0;
    for (const [sourceId, source] of this.dataConnections.entries()) {
      const data = this.getCachedData(sourceId);
      const age = source.lastFetch ? Date.now() - source.lastFetch.getTime() : null;
      const timelinessScore = age ? Math.max(0, 100 - age / source.refreshInterval * 100) : 0;
      const completenessScore = data ? 95 : 0;
      metrics.sources[sourceId] = {
        completeness: completenessScore,
        timeliness: timelinessScore,
        consistency: 98,
        accuracy: 96
      };
      totalCompleteness += completenessScore;
      totalTimeliness += timelinessScore;
    }
    const sourceCount = this.dataConnections.size;
    metrics.overall.completeness = totalCompleteness / sourceCount;
    metrics.overall.timeliness = totalTimeliness / sourceCount;
    metrics.overall.consistency = 97;
    metrics.overall.accuracy = 96;
    return metrics;
  }

  /**
   * Get connection statistics
   */
  getConnectionStats() {
    return {
      timestamp: new Date(),
      totalSources: this.dataConnections.size,
      activeSources: Array.from(this.dataConnections.values()).filter(s => s.status === 'active').length,
      erroredSources: Array.from(this.dataConnections.values()).filter(s => s.status === 'error').length,
      activeSubscriptions: Array.from(this.activeSubscriptions.values()).reduce((sum, arr) => sum + arr.length, 0),
      registeredWebhooks: this.webhooks.length,
      activeWebhooks: this.webhooks.filter(w => w.active).length
    };
  }

  /**
   * Force refresh all data sources
   */
  async refreshAllData() {
    const results = {};
    for (const sourceId of this.dataConnections.keys()) {
      try {
        const data = await this.fetchSourceData(sourceId);
        results[sourceId] = {
          success: true,
          data
        };
      } catch (error) {
        results[sourceId] = {
          success: false,
          error: error.message
        };
      }
    }
    return results;
  }

  /**
   * Get streaming data for WebSocket
   */
  getStreamingData(sourceId) {
    const source = this.dataConnections.get(sourceId);
    const cachedData = this.getCachedData(sourceId);
    if (!source) {
      return {
        error: 'Source not found'
      };
    }
    return {
      sourceId,
      timestamp: new Date(),
      data: cachedData || source.data,
      status: source.status,
      lastUpdate: source.lastFetch
    };
  }
}
module.exports = new RealtimeDashboardService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiUmVhbHRpbWVEYXNoYm9hcmRTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJkYXRhQ29ubmVjdGlvbnMiLCJNYXAiLCJhY3RpdmVTdWJzY3JpcHRpb25zIiwiY2FjaGVkRGF0YSIsIndlYmhvb2tzIiwic3RyZWFtaW5nQ29ubmVjdGlvbnMiLCJsYXN0VXBkYXRlVGltZSIsImluaXRpYWxpemUiLCJpbmZvIiwiaW5pdGlhbGl6ZURhdGFTb3VyY2VzIiwic2V0dXBDYWNoaW5nIiwiZW5hYmxlUmVhbHRpbWVVcGRhdGVzIiwiZXJyb3IiLCJzb3VyY2VzIiwiaWQiLCJuYW1lIiwiZW5kcG9pbnRzIiwicmVmcmVzaEludGVydmFsIiwiZm9yRWFjaCIsInNvdXJjZSIsInNldCIsImxhc3RGZXRjaCIsInN0YXR1cyIsImRhdGEiLCJjYWNoZVN0cmF0ZWd5IiwiZmluYW5jaWFsRGF0YSIsInR0bCIsIm1heFNpemUiLCJockRhdGEiLCJvcGVyYXRpb25zRGF0YSIsImN1c3RvbWVyRGF0YSIsInN5c3RlbU1ldHJpY3MiLCJrZXkiLCJjb25maWciLCJPYmplY3QiLCJlbnRyaWVzIiwidGltZXN0YW1wIiwic291cmNlSWQiLCJzZXRJbnRlcnZhbCIsImZldGNoU291cmNlRGF0YSIsImdldCIsImdlbmVyYXRlTW9ja0RhdGEiLCJEYXRlIiwidXBkYXRlQ2FjaGUiLCJub3RpZnlTdWJzY3JpYmVycyIsIm1lc3NhZ2UiLCJiYXNlRGF0YSIsInRvdGFsUmV2ZW51ZSIsInRvdGFsRXhwZW5zZXMiLCJuZXRQcm9maXQiLCJjYXNoRmxvdyIsImJ1ZGdldFV0aWxpemF0aW9uIiwidHJhbnNhY3Rpb25zIiwiYW1vdW50IiwidHlwZSIsImRhdGUiLCJ0b3RhbEVtcGxveWVlcyIsImFjdGl2ZUVtcGxveWVlcyIsImF0dGVuZGFuY2VSYXRlIiwidHJhaW5pbmdDb21wbGV0ZWQiLCJwZXJmb3JtYW5jZVJhdGluZyIsImRlcGFydG1lbnRzIiwiZW5naW5lZXJpbmciLCJzYWxlcyIsInN1cHBvcnQiLCJhZG1pbiIsImhyIiwibWFuYWdlbWVudCIsImFjdGl2ZVByb2plY3RzIiwiY29tcGxldGVkVGFza3MiLCJwZW5kaW5nVGFza3MiLCJvcGVyYXRpb25hbEVmZmljaWVuY3kiLCJwcm9qZWN0Q29tcGxldGlvbiIsImF2ZXJhZ2VUYXNrRHVyYXRpb24iLCJib3R0bGVuZWNrcyIsInRvdGFsQ3VzdG9tZXJzIiwiYWN0aXZlQ3VzdG9tZXJzIiwiY3VzdG9tZXJTYXRpc2ZhY3Rpb24iLCJucHMiLCJyZXRlbnRpb25SYXRlIiwiY2h1cm5SYXRlIiwiYXZlcmFnZVRpY2tldFJlc29sdXRpb25UaW1lIiwib3BlblRpY2tldHMiLCJ1cHRpbWUiLCJhdmVyYWdlUmVzcG9uc2VUaW1lIiwiZXJyb3JSYXRlIiwiY2FjaGVIaXRSYXRlIiwiZGF0YWJhc2VIZWFsdGgiLCJtZXNzYWdlUXVldWVEZXB0aCIsImFjdGl2ZUNvbm5lY3Rpb25zIiwiY3B1VXNhZ2UiLCJtZW1vcnlVc2FnZSIsImNhY2hlS2V5IiwiY2FjaGVFbnRyeSIsImdldENhY2hlZERhdGEiLCJub3ciLCJnZXRUaW1lIiwiZ2V0QWdncmVnYXRlZERhc2hib2FyZERhdGEiLCJhZ2dyZWdhdGVkIiwic3VtbWFyeSIsImhlYWx0aFN0YXR1cyIsImRhdGFGcmVzaG5lc3MiLCJsYXN0VXBkYXRlIiwiYWdlIiwiYWdlTXMiLCJpc0ZyZXNoIiwic3Vic2NyaWJlIiwiY2FsbGJhY2siLCJoYXMiLCJwdXNoIiwiY2FsbGJhY2tzIiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwicmVnaXN0ZXJXZWJob29rIiwidXJsIiwiZXZlbnRzIiwid2ViaG9vayIsImxlbmd0aCIsImNyZWF0ZWRBdCIsImFjdGl2ZSIsInRyaWdnZXJXZWJob29rIiwiZXZlbnRUeXBlIiwicmVsZXZhbnRXZWJob29rcyIsImZpbHRlciIsInciLCJpbmNsdWRlcyIsImdldERhdGFRdWFsaXR5TWV0cmljcyIsIm1ldHJpY3MiLCJvdmVyYWxsIiwiY29tcGxldGVuZXNzIiwiYWNjdXJhY3kiLCJ0aW1lbGluZXNzIiwiY29uc2lzdGVuY3kiLCJ0b3RhbENvbXBsZXRlbmVzcyIsInRvdGFsVGltZWxpbmVzcyIsInRpbWVsaW5lc3NTY29yZSIsIk1hdGgiLCJtYXgiLCJjb21wbGV0ZW5lc3NTY29yZSIsInNvdXJjZUNvdW50Iiwic2l6ZSIsImdldENvbm5lY3Rpb25TdGF0cyIsInRvdGFsU291cmNlcyIsImFjdGl2ZVNvdXJjZXMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJzIiwiZXJyb3JlZFNvdXJjZXMiLCJyZWR1Y2UiLCJzdW0iLCJhcnIiLCJyZWdpc3RlcmVkV2ViaG9va3MiLCJhY3RpdmVXZWJob29rcyIsInJlZnJlc2hBbGxEYXRhIiwicmVzdWx0cyIsImtleXMiLCJzdWNjZXNzIiwiZ2V0U3RyZWFtaW5nRGF0YSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyZWFsdGltZURhc2hib2FyZFNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFJlYWwtdGltZSBEYXNoYm9hcmQgSW50ZWdyYXRpb24gU2VydmljZVxyXG4gKiBBZ2dyZWdhdGVzIGRhdGEgZnJvbSBtdWx0aXBsZSBzb3VyY2VzIGFuZCBwcm92aWRlcyByZWFsLXRpbWUgdXBkYXRlc1xyXG4gKiBcclxuICogRmVhdHVyZXM6XHJcbiAqIC0gTXVsdGktc291cmNlIGRhdGEgYWdncmVnYXRpb25cclxuICogLSBSZWFsLXRpbWUgZGF0YSBzdHJlYW1pbmdcclxuICogLSBEYXRhIGNhY2hpbmcgYW5kIG9wdGltaXphdGlvblxyXG4gKiAtIFdlYmhvb2sgaW50ZWdyYXRpb25cclxuICogLSBXZWJTb2NrZXQgc3VwcG9ydFxyXG4gKiAtIERhdGEgY29uc2lzdGVuY3kgY2hlY2tzXHJcbiAqL1xyXG5cclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XHJcblxyXG5jbGFzcyBSZWFsdGltZURhc2hib2FyZFNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5kYXRhQ29ubmVjdGlvbnMgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLmFjdGl2ZVN1YnNjcmlwdGlvbnMgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLmNhY2hlZERhdGEgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLndlYmhvb2tzID0gW107XHJcbiAgICB0aGlzLnN0cmVhbWluZ0Nvbm5lY3Rpb25zID0gW107XHJcbiAgICB0aGlzLmxhc3RVcGRhdGVUaW1lID0gbmV3IE1hcCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSByZWFsLXRpbWUgY29ubmVjdGlvbnNcclxuICAgKi9cclxuICBhc3luYyBpbml0aWFsaXplKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbG9nZ2VyLmluZm8oJ/CfmoAgUmVhbC10aW1lIERhc2hib2FyZCBTZXJ2aWNlOiBJbml0aWFsaXppbmcuLi4nKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEluaXRpYWxpemUgZGF0YSBzb3VyY2VzXHJcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZURhdGFTb3VyY2VzKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTZXR1cCBjYWNoaW5nXHJcbiAgICAgIHRoaXMuc2V0dXBDYWNoaW5nKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBFbmFibGUgcmVhbC10aW1lIHVwZGF0ZXNcclxuICAgICAgdGhpcy5lbmFibGVSZWFsdGltZVVwZGF0ZXMoKTtcclxuICAgICAgXHJcbiAgICAgIGxvZ2dlci5pbmZvKCfinIUgUmVhbC10aW1lIERhc2hib2FyZCBTZXJ2aWNlOiBJbml0aWFsaXplZCcpO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcign4p2MIFJlYWwtdGltZSBEYXNoYm9hcmQgU2VydmljZTogSW5pdGlhbGl6YXRpb24gZmFpbGVkJywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbml0aWFsaXplIGF2YWlsYWJsZSBkYXRhIHNvdXJjZXNcclxuICAgKi9cclxuICBpbml0aWFsaXplRGF0YVNvdXJjZXMoKSB7XHJcbiAgICBjb25zdCBzb3VyY2VzID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgaWQ6ICdmaW5hbmNpYWwnLFxyXG4gICAgICAgIG5hbWU6ICdGaW5hbmNpYWwgRGF0YScsXHJcbiAgICAgICAgZW5kcG9pbnRzOiBbJy9hcGkvZmluYW5jZS90cmFuc2FjdGlvbnMnLCAnL2FwaS9maW5hbmNlL2J1ZGdldHMnXSxcclxuICAgICAgICByZWZyZXNoSW50ZXJ2YWw6IDYwMDAwLCAvLyAxIG1pbnV0ZVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgaWQ6ICdocicsXHJcbiAgICAgICAgbmFtZTogJ0hSIERhdGEnLFxyXG4gICAgICAgIGVuZHBvaW50czogWycvYXBpL2hyL2VtcGxveWVlcycsICcvYXBpL2hyL2F0dGVuZGFuY2UnXSxcclxuICAgICAgICByZWZyZXNoSW50ZXJ2YWw6IDMwMDAwMCwgLy8gNSBtaW51dGVzXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBpZDogJ29wZXJhdGlvbnMnLFxyXG4gICAgICAgIG5hbWU6ICdPcGVyYXRpb25zIERhdGEnLFxyXG4gICAgICAgIGVuZHBvaW50czogWycvYXBpL29wZXJhdGlvbnMvdGFza3MnLCAnL2FwaS9vcGVyYXRpb25zL2VmZmljaWVuY3knXSxcclxuICAgICAgICByZWZyZXNoSW50ZXJ2YWw6IDEyMDAwMCwgLy8gMiBtaW51dGVzXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBpZDogJ2N1c3RvbWVyJyxcclxuICAgICAgICBuYW1lOiAnQ3VzdG9tZXIgRGF0YScsXHJcbiAgICAgICAgZW5kcG9pbnRzOiBbJy9hcGkvY3VzdG9tZXIvc2F0aXNmYWN0aW9uJywgJy9hcGkvY3VzdG9tZXIvZW5nYWdlbWVudCddLFxyXG4gICAgICAgIHJlZnJlc2hJbnRlcnZhbDogMTgwMDAwLCAvLyAzIG1pbnV0ZXNcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGlkOiAnc3lzdGVtJyxcclxuICAgICAgICBuYW1lOiAnU3lzdGVtIFBlcmZvcm1hbmNlJyxcclxuICAgICAgICBlbmRwb2ludHM6IFsnL2FwaS9zeXN0ZW0vaGVhbHRoJywgJy9hcGkvc3lzdGVtL3BlcmZvcm1hbmNlJ10sXHJcbiAgICAgICAgcmVmcmVzaEludGVydmFsOiAzMDAwMCwgLy8gMzAgc2Vjb25kc1xyXG4gICAgICB9LFxyXG4gICAgXTtcclxuXHJcbiAgICBzb3VyY2VzLmZvckVhY2goc291cmNlID0+IHtcclxuICAgICAgdGhpcy5kYXRhQ29ubmVjdGlvbnMuc2V0KHNvdXJjZS5pZCwge1xyXG4gICAgICAgIC4uLnNvdXJjZSxcclxuICAgICAgICBsYXN0RmV0Y2g6IG51bGwsXHJcbiAgICAgICAgc3RhdHVzOiAnaW5hY3RpdmUnLFxyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR1cCBkYXRhIGNhY2hpbmdcclxuICAgKi9cclxuICBzZXR1cENhY2hpbmcoKSB7XHJcbiAgICBjb25zdCBjYWNoZVN0cmF0ZWd5ID0ge1xyXG4gICAgICBmaW5hbmNpYWxEYXRhOiB7IHR0bDogNjAwMDAsIG1heFNpemU6IDEwMDAgfSxcclxuICAgICAgaHJEYXRhOiB7IHR0bDogMzAwMDAwLCBtYXhTaXplOiA1MDAgfSxcclxuICAgICAgb3BlcmF0aW9uc0RhdGE6IHsgdHRsOiAxMjAwMDAsIG1heFNpemU6IDUwMCB9LFxyXG4gICAgICBjdXN0b21lckRhdGE6IHsgdHRsOiAxODAwMDAsIG1heFNpemU6IDUwMCB9LFxyXG4gICAgICBzeXN0ZW1NZXRyaWNzOiB7IHR0bDogMzAwMDAsIG1heFNpemU6IDIwMDAgfSxcclxuICAgIH07XHJcblxyXG4gICAgZm9yIChjb25zdCBba2V5LCBjb25maWddIG9mIE9iamVjdC5lbnRyaWVzKGNhY2hlU3RyYXRlZ3kpKSB7XHJcbiAgICAgIHRoaXMuY2FjaGVkRGF0YS5zZXQoa2V5LCB7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICB0aW1lc3RhbXA6IG51bGwsXHJcbiAgICAgICAgdHRsOiBjb25maWcudHRsLFxyXG4gICAgICAgIG1heFNpemU6IGNvbmZpZy5tYXhTaXplLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVuYWJsZSByZWFsLXRpbWUgdXBkYXRlc1xyXG4gICAqL1xyXG4gIGVuYWJsZVJlYWx0aW1lVXBkYXRlcygpIHtcclxuICAgIC8vIFNldHVwIHBlcmlvZGljIHVwZGF0ZSBpbnRlcnZhbHMgZm9yIGVhY2ggZGF0YSBzb3VyY2VcclxuICAgIGZvciAoY29uc3QgW3NvdXJjZUlkLCBzb3VyY2VdIG9mIHRoaXMuZGF0YUNvbm5lY3Rpb25zLmVudHJpZXMoKSkge1xyXG4gICAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5mZXRjaFNvdXJjZURhdGEoc291cmNlSWQpO1xyXG4gICAgICB9LCBzb3VyY2UucmVmcmVzaEludGVydmFsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGRhdGEgZnJvbSBhIHNwZWNpZmljIHNvdXJjZVxyXG4gICAqL1xyXG4gIGFzeW5jIGZldGNoU291cmNlRGF0YShzb3VyY2VJZCkge1xyXG4gICAgY29uc3Qgc291cmNlID0gdGhpcy5kYXRhQ29ubmVjdGlvbnMuZ2V0KHNvdXJjZUlkKTtcclxuICAgIGlmICghc291cmNlKSByZXR1cm47XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gU2ltdWxhdGUgZGF0YSBmZXRjaGluZ1xyXG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5nZW5lcmF0ZU1vY2tEYXRhKHNvdXJjZUlkKTtcclxuICAgICAgXHJcbiAgICAgIHNvdXJjZS5kYXRhID0gZGF0YTtcclxuICAgICAgc291cmNlLmxhc3RGZXRjaCA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIHNvdXJjZS5zdGF0dXMgPSAnYWN0aXZlJztcclxuICAgICAgXHJcbiAgICAgIHRoaXMudXBkYXRlQ2FjaGUoc291cmNlSWQsIGRhdGEpO1xyXG4gICAgICB0aGlzLm5vdGlmeVN1YnNjcmliZXJzKHNvdXJjZUlkLCBkYXRhKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBmZXRjaGluZyBkYXRhIGZyb20gJHtzb3VyY2VJZH06YCwgZXJyb3IpO1xyXG4gICAgICBzb3VyY2Uuc3RhdHVzID0gJ2Vycm9yJztcclxuICAgICAgc291cmNlLmVycm9yID0gZXJyb3IubWVzc2FnZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIG1vY2sgZGF0YSBmb3IgZGVtb25zdHJhdGlvblxyXG4gICAqL1xyXG4gIGdlbmVyYXRlTW9ja0RhdGEoc291cmNlSWQpIHtcclxuICAgIGNvbnN0IGJhc2VEYXRhID0ge1xyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIHNvdXJjZUlkLFxyXG4gICAgfTtcclxuXHJcbiAgICBzd2l0Y2ggKHNvdXJjZUlkKSB7XHJcbiAgICAgIGNhc2UgJ2ZpbmFuY2lhbCc6XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIC4uLmJhc2VEYXRhLFxyXG4gICAgICAgICAgdG90YWxSZXZlbnVlOiA5NTAwMDAsXHJcbiAgICAgICAgICB0b3RhbEV4cGVuc2VzOiA2MjAwMDAsXHJcbiAgICAgICAgICBuZXRQcm9maXQ6IDMzMDAwMCxcclxuICAgICAgICAgIGNhc2hGbG93OiAxMjAwMDAsXHJcbiAgICAgICAgICBidWRnZXRVdGlsaXphdGlvbjogNzguNSxcclxuICAgICAgICAgIHRyYW5zYWN0aW9uczogW1xyXG4gICAgICAgICAgICB7IGlkOiAxLCBhbW91bnQ6IDUwMDAwLCB0eXBlOiAnaW5jb21lJywgZGF0ZTogbmV3IERhdGUoKSB9LFxyXG4gICAgICAgICAgICB7IGlkOiAyLCBhbW91bnQ6IDE1MDAwLCB0eXBlOiAnZXhwZW5zZScsIGRhdGU6IG5ldyBEYXRlKCkgfSxcclxuICAgICAgICAgIF0sXHJcbiAgICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNhc2UgJ2hyJzpcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgLi4uYmFzZURhdGEsXHJcbiAgICAgICAgICB0b3RhbEVtcGxveWVlczogMjUwLFxyXG4gICAgICAgICAgYWN0aXZlRW1wbG95ZWVzOiAyNDUsXHJcbiAgICAgICAgICBhdHRlbmRhbmNlUmF0ZTogOTYuMixcclxuICAgICAgICAgIHRyYWluaW5nQ29tcGxldGVkOiAxNzgsXHJcbiAgICAgICAgICBwZXJmb3JtYW5jZVJhdGluZzogNC4yLFxyXG4gICAgICAgICAgZGVwYXJ0bWVudHM6IHtcclxuICAgICAgICAgICAgZW5naW5lZXJpbmc6IDg1LFxyXG4gICAgICAgICAgICBzYWxlczogNDUsXHJcbiAgICAgICAgICAgIHN1cHBvcnQ6IDQwLFxyXG4gICAgICAgICAgICBhZG1pbjogMzUsXHJcbiAgICAgICAgICAgIGhyOiAxNSxcclxuICAgICAgICAgICAgbWFuYWdlbWVudDogMTUsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjYXNlICdvcGVyYXRpb25zJzpcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgLi4uYmFzZURhdGEsXHJcbiAgICAgICAgICBhY3RpdmVQcm9qZWN0czogMTIsXHJcbiAgICAgICAgICBjb21wbGV0ZWRUYXNrczogODQsXHJcbiAgICAgICAgICBwZW5kaW5nVGFza3M6IDIzLFxyXG4gICAgICAgICAgb3BlcmF0aW9uYWxFZmZpY2llbmN5OiA4OC41LFxyXG4gICAgICAgICAgcHJvamVjdENvbXBsZXRpb246IDkxLjIsXHJcbiAgICAgICAgICBhdmVyYWdlVGFza0R1cmF0aW9uOiA0LjUsXHJcbiAgICAgICAgICBib3R0bGVuZWNrczogWydhcHByb3ZhbF9wcm9jZXNzJywgJ3Jlc291cmNlX2FsbG9jYXRpb24nXSxcclxuICAgICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY2FzZSAnY3VzdG9tZXInOlxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAuLi5iYXNlRGF0YSxcclxuICAgICAgICAgIHRvdGFsQ3VzdG9tZXJzOiAxMjAwLFxyXG4gICAgICAgICAgYWN0aXZlQ3VzdG9tZXJzOiA5NTAsXHJcbiAgICAgICAgICBjdXN0b21lclNhdGlzZmFjdGlvbjogOTIsXHJcbiAgICAgICAgICBucHM6IDc0LFxyXG4gICAgICAgICAgcmV0ZW50aW9uUmF0ZTogOTQuMixcclxuICAgICAgICAgIGNodXJuUmF0ZTogMS4yLFxyXG4gICAgICAgICAgYXZlcmFnZVRpY2tldFJlc29sdXRpb25UaW1lOiAyLjMsXHJcbiAgICAgICAgICBvcGVuVGlja2V0czogMjMsXHJcbiAgICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNhc2UgJ3N5c3RlbSc6XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIC4uLmJhc2VEYXRhLFxyXG4gICAgICAgICAgdXB0aW1lOiA5OS45OCxcclxuICAgICAgICAgIGF2ZXJhZ2VSZXNwb25zZVRpbWU6IDEyNSxcclxuICAgICAgICAgIGVycm9yUmF0ZTogMC4wMixcclxuICAgICAgICAgIGNhY2hlSGl0UmF0ZTogOTQuNSxcclxuICAgICAgICAgIGRhdGFiYXNlSGVhbHRoOiAnaGVhbHRoeScsXHJcbiAgICAgICAgICBtZXNzYWdlUXVldWVEZXB0aDogMjM0LFxyXG4gICAgICAgICAgYWN0aXZlQ29ubmVjdGlvbnM6IDIwNDgsXHJcbiAgICAgICAgICBjcHVVc2FnZTogNDUuMixcclxuICAgICAgICAgIG1lbW9yeVVzYWdlOiA2Mi44LFxyXG4gICAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiBiYXNlRGF0YTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBjYWNoZSB3aXRoIG5ldyBkYXRhXHJcbiAgICovXHJcbiAgdXBkYXRlQ2FjaGUoc291cmNlSWQsIGRhdGEpIHtcclxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7c291cmNlSWR9RGF0YWA7XHJcbiAgICBjb25zdCBjYWNoZUVudHJ5ID0gdGhpcy5jYWNoZWREYXRhLmdldChjYWNoZUtleSk7XHJcbiAgICBcclxuICAgIGlmIChjYWNoZUVudHJ5KSB7XHJcbiAgICAgIGNhY2hlRW50cnkuZGF0YSA9IGRhdGE7XHJcbiAgICAgIGNhY2hlRW50cnkudGltZXN0YW1wID0gbmV3IERhdGUoKTtcclxuICAgICAgdGhpcy5sYXN0VXBkYXRlVGltZS5zZXQoc291cmNlSWQsIG5ldyBEYXRlKCkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGNhY2hlZCBkYXRhXHJcbiAgICovXHJcbiAgZ2V0Q2FjaGVkRGF0YShzb3VyY2VJZCkge1xyXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgJHtzb3VyY2VJZH1EYXRhYDtcclxuICAgIGNvbnN0IGNhY2hlRW50cnkgPSB0aGlzLmNhY2hlZERhdGEuZ2V0KGNhY2hlS2V5KTtcclxuICAgIFxyXG4gICAgaWYgKCFjYWNoZUVudHJ5KSByZXR1cm4gbnVsbDtcclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgaWYgY2FjaGUgaXMgc3RpbGwgdmFsaWRcclxuICAgIGlmIChjYWNoZUVudHJ5LnRpbWVzdGFtcCAmJiBEYXRlLm5vdygpIC0gY2FjaGVFbnRyeS50aW1lc3RhbXAuZ2V0VGltZSgpID4gY2FjaGVFbnRyeS50dGwpIHtcclxuICAgICAgcmV0dXJuIG51bGw7IC8vIENhY2hlIGV4cGlyZWRcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGNhY2hlRW50cnkuZGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhZ2dyZWdhdGVkIGRhc2hib2FyZCBkYXRhXHJcbiAgICovXHJcbiAgZ2V0QWdncmVnYXRlZERhc2hib2FyZERhdGEoKSB7XHJcbiAgICBjb25zdCBhZ2dyZWdhdGVkID0ge1xyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIHNvdXJjZXM6IHt9LFxyXG4gICAgICBzdW1tYXJ5OiB7XHJcbiAgICAgICAgaGVhbHRoU3RhdHVzOiAnaGVhbHRoeScsXHJcbiAgICAgICAgZGF0YUZyZXNobmVzczoge30sXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIGZvciAoY29uc3QgW3NvdXJjZUlkLCBzb3VyY2VdIG9mIHRoaXMuZGF0YUNvbm5lY3Rpb25zLmVudHJpZXMoKSkge1xyXG4gICAgICBjb25zdCBjYWNoZWREYXRhID0gdGhpcy5nZXRDYWNoZWREYXRhKHNvdXJjZUlkKTtcclxuICAgICAgXHJcbiAgICAgIGFnZ3JlZ2F0ZWQuc291cmNlc1tzb3VyY2VJZF0gPSB7XHJcbiAgICAgICAgbmFtZTogc291cmNlLm5hbWUsXHJcbiAgICAgICAgc3RhdHVzOiBzb3VyY2Uuc3RhdHVzLFxyXG4gICAgICAgIGxhc3RVcGRhdGU6IHNvdXJjZS5sYXN0RmV0Y2gsXHJcbiAgICAgICAgZGF0YTogY2FjaGVkRGF0YSB8fCBzb3VyY2UuZGF0YSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIENhbGN1bGF0ZSBkYXRhIGZyZXNobmVzc1xyXG4gICAgICBpZiAoc291cmNlLmxhc3RGZXRjaCkge1xyXG4gICAgICAgIGNvbnN0IGFnZSA9IERhdGUubm93KCkgLSBzb3VyY2UubGFzdEZldGNoLmdldFRpbWUoKTtcclxuICAgICAgICBhZ2dyZWdhdGVkLnN1bW1hcnkuZGF0YUZyZXNobmVzc1tzb3VyY2VJZF0gPSB7XHJcbiAgICAgICAgICBhZ2VNczogYWdlLFxyXG4gICAgICAgICAgaXNGcmVzaDogYWdlIDwgc291cmNlLnJlZnJlc2hJbnRlcnZhbCAqIDIsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhZ2dyZWdhdGVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3Vic2NyaWJlIHRvIHJlYWwtdGltZSB1cGRhdGVzXHJcbiAgICovXHJcbiAgc3Vic2NyaWJlKHNvdXJjZUlkLCBjYWxsYmFjaykge1xyXG4gICAgaWYgKCF0aGlzLmFjdGl2ZVN1YnNjcmlwdGlvbnMuaGFzKHNvdXJjZUlkKSkge1xyXG4gICAgICB0aGlzLmFjdGl2ZVN1YnNjcmlwdGlvbnMuc2V0KHNvdXJjZUlkLCBbXSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hY3RpdmVTdWJzY3JpcHRpb25zLmdldChzb3VyY2VJZCkucHVzaChjYWxsYmFjayk7XHJcblxyXG4gICAgLy8gUmV0dXJuIHVuc3Vic2NyaWJlIGZ1bmN0aW9uXHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBjb25zdCBjYWxsYmFja3MgPSB0aGlzLmFjdGl2ZVN1YnNjcmlwdGlvbnMuZ2V0KHNvdXJjZUlkKTtcclxuICAgICAgY29uc3QgaW5kZXggPSBjYWxsYmFja3MuaW5kZXhPZihjYWxsYmFjayk7XHJcbiAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgY2FsbGJhY2tzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBOb3RpZnkgc3Vic2NyaWJlcnMgb2YgZGF0YSB1cGRhdGVzXHJcbiAgICovXHJcbiAgbm90aWZ5U3Vic2NyaWJlcnMoc291cmNlSWQsIGRhdGEpIHtcclxuICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMuYWN0aXZlU3Vic2NyaXB0aW9ucy5nZXQoc291cmNlSWQpO1xyXG4gICAgXHJcbiAgICBpZiAoY2FsbGJhY2tzKSB7XHJcbiAgICAgIGNhbGxiYWNrcy5mb3JFYWNoKGNhbGxiYWNrID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgaW4gc3Vic2NyaWJlciBjYWxsYmFjayBmb3IgJHtzb3VyY2VJZH06YCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWdpc3RlciB3ZWJob29rIGZvciBleHRlcm5hbCBub3RpZmljYXRpb25zXHJcbiAgICovXHJcbiAgcmVnaXN0ZXJXZWJob29rKHNvdXJjZUlkLCB1cmwsIGV2ZW50cyA9IFtdKSB7XHJcbiAgICBjb25zdCB3ZWJob29rID0ge1xyXG4gICAgICBpZDogYHdlYmhvb2tfJHtEYXRlLm5vdygpfWAsXHJcbiAgICAgIHNvdXJjZUlkLFxyXG4gICAgICB1cmwsXHJcbiAgICAgIGV2ZW50czogZXZlbnRzLmxlbmd0aCA+IDAgPyBldmVudHMgOiBbJ3VwZGF0ZSddLFxyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgIGFjdGl2ZTogdHJ1ZSxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy53ZWJob29rcy5wdXNoKHdlYmhvb2spO1xyXG4gICAgcmV0dXJuIHdlYmhvb2s7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUcmlnZ2VyIHdlYmhvb2sgZXZlbnRcclxuICAgKi9cclxuICBhc3luYyB0cmlnZ2VyV2ViaG9vayhzb3VyY2VJZCwgZXZlbnRUeXBlLCBkYXRhKSB7XHJcbiAgICBjb25zdCByZWxldmFudFdlYmhvb2tzID0gdGhpcy53ZWJob29rcy5maWx0ZXIoXHJcbiAgICAgIHcgPT4gdy5zb3VyY2VJZCA9PT0gc291cmNlSWQgJiYgdy5ldmVudHMuaW5jbHVkZXMoZXZlbnRUeXBlKSAmJiB3LmFjdGl2ZVxyXG4gICAgKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IHdlYmhvb2sgb2YgcmVsZXZhbnRXZWJob29rcykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIC8vIFNpbXVsYXRlIHdlYmhvb2sgY2FsbFxyXG4gICAgICAgIGxvZ2dlci5pbmZvKGBUcmlnZ2VyaW5nIHdlYmhvb2s6ICR7d2ViaG9vay51cmx9YCwgeyBldmVudFR5cGUsIHNvdXJjZUlkIH0pO1xyXG4gICAgICAgIC8vIEluIHJlYWwgaW1wbGVtZW50YXRpb24sIHdvdWxkIHVzZSBheGlvcyBvciBmZXRjaCB0byBjYWxsIHdlYmhvb2tcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBsb2dnZXIuZXJyb3IoYFdlYmhvb2sgdHJpZ2dlciBmYWlsZWQ6ICR7d2ViaG9vay5pZH1gLCBlcnJvcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBkYXRhIHF1YWxpdHkgbWV0cmljc1xyXG4gICAqL1xyXG4gIGdldERhdGFRdWFsaXR5TWV0cmljcygpIHtcclxuICAgIGNvbnN0IG1ldHJpY3MgPSB7XHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgc291cmNlczoge30sXHJcbiAgICAgIG92ZXJhbGw6IHtcclxuICAgICAgICBjb21wbGV0ZW5lc3M6IDAsXHJcbiAgICAgICAgYWNjdXJhY3k6IDAsXHJcbiAgICAgICAgdGltZWxpbmVzczogMCxcclxuICAgICAgICBjb25zaXN0ZW5jeTogMCxcclxuICAgICAgfSxcclxuICAgIH07XHJcblxyXG4gICAgbGV0IHRvdGFsQ29tcGxldGVuZXNzID0gMDtcclxuICAgIGxldCB0b3RhbFRpbWVsaW5lc3MgPSAwO1xyXG5cclxuICAgIGZvciAoY29uc3QgW3NvdXJjZUlkLCBzb3VyY2VdIG9mIHRoaXMuZGF0YUNvbm5lY3Rpb25zLmVudHJpZXMoKSkge1xyXG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRDYWNoZWREYXRhKHNvdXJjZUlkKTtcclxuICAgICAgY29uc3QgYWdlID0gc291cmNlLmxhc3RGZXRjaCA/IERhdGUubm93KCkgLSBzb3VyY2UubGFzdEZldGNoLmdldFRpbWUoKSA6IG51bGw7XHJcblxyXG4gICAgICBjb25zdCB0aW1lbGluZXNzU2NvcmUgPSBhZ2VcclxuICAgICAgICA/IE1hdGgubWF4KDAsIDEwMCAtIChhZ2UgLyBzb3VyY2UucmVmcmVzaEludGVydmFsKSAqIDEwMClcclxuICAgICAgICA6IDA7XHJcblxyXG4gICAgICBjb25zdCBjb21wbGV0ZW5lc3NTY29yZSA9IGRhdGEgPyA5NSA6IDA7XHJcblxyXG4gICAgICBtZXRyaWNzLnNvdXJjZXNbc291cmNlSWRdID0ge1xyXG4gICAgICAgIGNvbXBsZXRlbmVzczogY29tcGxldGVuZXNzU2NvcmUsXHJcbiAgICAgICAgdGltZWxpbmVzczogdGltZWxpbmVzc1Njb3JlLFxyXG4gICAgICAgIGNvbnNpc3RlbmN5OiA5OCxcclxuICAgICAgICBhY2N1cmFjeTogOTYsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICB0b3RhbENvbXBsZXRlbmVzcyArPSBjb21wbGV0ZW5lc3NTY29yZTtcclxuICAgICAgdG90YWxUaW1lbGluZXNzICs9IHRpbWVsaW5lc3NTY29yZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzb3VyY2VDb3VudCA9IHRoaXMuZGF0YUNvbm5lY3Rpb25zLnNpemU7XHJcbiAgICBtZXRyaWNzLm92ZXJhbGwuY29tcGxldGVuZXNzID0gdG90YWxDb21wbGV0ZW5lc3MgLyBzb3VyY2VDb3VudDtcclxuICAgIG1ldHJpY3Mub3ZlcmFsbC50aW1lbGluZXNzID0gdG90YWxUaW1lbGluZXNzIC8gc291cmNlQ291bnQ7XHJcbiAgICBtZXRyaWNzLm92ZXJhbGwuY29uc2lzdGVuY3kgPSA5NztcclxuICAgIG1ldHJpY3Mub3ZlcmFsbC5hY2N1cmFjeSA9IDk2O1xyXG5cclxuICAgIHJldHVybiBtZXRyaWNzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGNvbm5lY3Rpb24gc3RhdGlzdGljc1xyXG4gICAqL1xyXG4gIGdldENvbm5lY3Rpb25TdGF0cygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgdG90YWxTb3VyY2VzOiB0aGlzLmRhdGFDb25uZWN0aW9ucy5zaXplLFxyXG4gICAgICBhY3RpdmVTb3VyY2VzOiBBcnJheS5mcm9tKHRoaXMuZGF0YUNvbm5lY3Rpb25zLnZhbHVlcygpKS5maWx0ZXIocyA9PiBzLnN0YXR1cyA9PT0gJ2FjdGl2ZScpLmxlbmd0aCxcclxuICAgICAgZXJyb3JlZFNvdXJjZXM6IEFycmF5LmZyb20odGhpcy5kYXRhQ29ubmVjdGlvbnMudmFsdWVzKCkpLmZpbHRlcihzID0+IHMuc3RhdHVzID09PSAnZXJyb3InKS5sZW5ndGgsXHJcbiAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnM6IEFycmF5LmZyb20odGhpcy5hY3RpdmVTdWJzY3JpcHRpb25zLnZhbHVlcygpKS5yZWR1Y2UoKHN1bSwgYXJyKSA9PiBzdW0gKyBhcnIubGVuZ3RoLCAwKSxcclxuICAgICAgcmVnaXN0ZXJlZFdlYmhvb2tzOiB0aGlzLndlYmhvb2tzLmxlbmd0aCxcclxuICAgICAgYWN0aXZlV2ViaG9va3M6IHRoaXMud2ViaG9va3MuZmlsdGVyKHcgPT4gdy5hY3RpdmUpLmxlbmd0aCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGb3JjZSByZWZyZXNoIGFsbCBkYXRhIHNvdXJjZXNcclxuICAgKi9cclxuICBhc3luYyByZWZyZXNoQWxsRGF0YSgpIHtcclxuICAgIGNvbnN0IHJlc3VsdHMgPSB7fTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IHNvdXJjZUlkIG9mIHRoaXMuZGF0YUNvbm5lY3Rpb25zLmtleXMoKSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmZldGNoU291cmNlRGF0YShzb3VyY2VJZCk7XHJcbiAgICAgICAgcmVzdWx0c1tzb3VyY2VJZF0gPSB7IHN1Y2Nlc3M6IHRydWUsIGRhdGEgfTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXN1bHRzW3NvdXJjZUlkXSA9IHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0cztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBzdHJlYW1pbmcgZGF0YSBmb3IgV2ViU29ja2V0XHJcbiAgICovXHJcbiAgZ2V0U3RyZWFtaW5nRGF0YShzb3VyY2VJZCkge1xyXG4gICAgY29uc3Qgc291cmNlID0gdGhpcy5kYXRhQ29ubmVjdGlvbnMuZ2V0KHNvdXJjZUlkKTtcclxuICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLmdldENhY2hlZERhdGEoc291cmNlSWQpO1xyXG5cclxuICAgIGlmICghc291cmNlKSB7XHJcbiAgICAgIHJldHVybiB7IGVycm9yOiAnU291cmNlIG5vdCBmb3VuZCcgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzb3VyY2VJZCxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICBkYXRhOiBjYWNoZWREYXRhIHx8IHNvdXJjZS5kYXRhLFxyXG4gICAgICBzdGF0dXM6IHNvdXJjZS5zdGF0dXMsXHJcbiAgICAgIGxhc3RVcGRhdGU6IHNvdXJjZS5sYXN0RmV0Y2gsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgUmVhbHRpbWVEYXNoYm9hcmRTZXJ2aWNlKCk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLE1BQU0sR0FBR0MsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0FBRXpDLE1BQU1DLHdCQUF3QixDQUFDO0VBQzdCQyxX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