{"version":3,"names":["RouteOptimizationService","optimizeRoute","route","options","score","suggestions","estimatedImprovements","considerTraffic","considerPassengerDemand","considerFuelEfficiency","considerTimeEfficiency","optimization","trafficAnalysis","analyzeTraffic","push","demandAnalysis","analyzePassengerDemand","fuelAnalysis","analyzeFuelEfficiency","timeAnalysis","analyzeTimeEfficiency","divisor","Math","min","error","console","message","type","description","estimatedImprovement","calculateShortestPath","stops","startPoint","graph","buildGraph","distances","visited","Set","previous","path","Object","keys","forEach","node","Infinity","id","size","length","closestNode","shortestDistance","has","add","neighbor","distance","current","unshift","totalDistance","optimized","optimizeStopSequence","vehicle","optimizedStops","remaining","currentLocation","gpsDevice","coordinates","nearestIndex","nearestDistance","stop","index","calculateDistance","location","nearest","splice","analysis","trafficData","simulateTrafficData","congestionLevel","priority","peakHours","occupancyRate","passengers","capacity","total","stopAnalysis","analyzeStopUsage","unusedStops","avgDistance","stopCount","estimatedDuration","avgStopTime","point1","point2","lon1","lat1","lon2","lat2","R","dLat","toRad","dLon","a","sin","cos","c","atan2","sqrt","degrees","PI","i","otherStop","j","hour","Date","getHours","isPeakHour","averageSpeed","underutilizedStops","passengerCount","totalStops","suggestAlternativeRoutes","passengerNeeds","alternatives","fastRoute","name","estimatedTime","round","reduceStops","comprehensiveRoute","expandStops","economicRoute","optimizeStopsForFuel","percentage","keepCount","ceil","sort","b","slice","module","exports"],"sources":["routeOptimization.service.js"],"sourcesContent":["/**\r\n * خدمة تحسين المسارات الذكية\r\n * Smart Route Optimization Service\r\n */\r\n\r\nclass RouteOptimizationService {\r\n  /**\r\n   * خوارزمية تحسين المسار بناءً على عدة عوامل\r\n   * @param {Object} route - المسار الحالي\r\n   * @param {Object} options - خيارات التحسين\r\n   * @returns {Object} - المسار المحسّن مع التوصيات\r\n   */\r\n  static async optimizeRoute(route, options = {}) {\r\n    try {\r\n      if (!route) {\r\n        return {\r\n          score: 0,\r\n          suggestions: [],\r\n          estimatedImprovements: {},\r\n        };\r\n      }\r\n\r\n      const {\r\n        considerTraffic = true,\r\n        considerPassengerDemand = true,\r\n        considerFuelEfficiency = true,\r\n        considerTimeEfficiency = true,\r\n      } = options;\r\n\r\n      const optimization = {\r\n        score: 0,\r\n        suggestions: [],\r\n        estimatedImprovements: {},\r\n      };\r\n\r\n      // 1. تحليل حركة المرور\r\n      if (considerTraffic) {\r\n        const trafficAnalysis = await this.analyzeTraffic(route);\r\n        if (trafficAnalysis) {\r\n          optimization.suggestions.push(...(trafficAnalysis.suggestions || []));\r\n          optimization.score += trafficAnalysis.score || 0;\r\n        }\r\n      }\r\n\r\n      // 2. تحليل طلب الركاب\r\n      if (considerPassengerDemand) {\r\n        const demandAnalysis = this.analyzePassengerDemand(route);\r\n        if (demandAnalysis) {\r\n          optimization.suggestions.push(...(demandAnalysis.suggestions || []));\r\n          optimization.score += demandAnalysis.score || 0;\r\n        }\r\n      }\r\n\r\n      // 3. تحسين استهلاك الوقود\r\n      if (considerFuelEfficiency) {\r\n        const fuelAnalysis = this.analyzeFuelEfficiency(route);\r\n        if (fuelAnalysis) {\r\n          optimization.suggestions.push(...(fuelAnalysis.suggestions || []));\r\n          optimization.score += fuelAnalysis.score || 0;\r\n        }\r\n      }\r\n\r\n      // 4. تحسين الوقت\r\n      if (considerTimeEfficiency) {\r\n        const timeAnalysis = this.analyzeTimeEfficiency(route);\r\n        if (timeAnalysis) {\r\n          optimization.suggestions.push(...(timeAnalysis.suggestions || []));\r\n          optimization.score += timeAnalysis.score || 0;\r\n        }\r\n      }\r\n\r\n      // حساب النتيجة النهائية\r\n      const divisor = (considerTraffic ? 1 : 0) + (considerPassengerDemand ? 1 : 0) + (considerFuelEfficiency ? 1 : 0) + (considerTimeEfficiency ? 1 : 0);\r\n      optimization.score = divisor > 0 ? Math.min(100, optimization.score / divisor) : 0;\r\n\r\n      return optimization;\r\n    } catch (error) {\r\n      console.error('Route optimization error:', error.message);\r\n      return {\r\n        score: 0,\r\n        suggestions: [\r\n          {\r\n            type: 'optimization_failed',\r\n            description: 'فشل تحسين المسار: ' + error.message,\r\n            estimatedImprovement: 0,\r\n          },\r\n        ],\r\n        estimatedImprovements: {},\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * خوارزمية إيجاد أقصر مسار (Dijkstra's Algorithm)\r\n   * @param {Array} stops - نقاط التوقف\r\n   * @param {Object} startPoint - نقطة البداية\r\n   * @returns {Object} - المسار الأمثل\r\n   */\r\n  static calculateShortestPath(stops, startPoint) {\r\n    const graph = this.buildGraph(stops);\r\n    const distances = {};\r\n    const visited = new Set();\r\n    const previous = {};\r\n    const path = [];\r\n\r\n    // تهيئة المسافات\r\n    Object.keys(graph).forEach(node => {\r\n      distances[node] = Infinity;\r\n      previous[node] = null;\r\n    });\r\n    distances[startPoint.id] = 0;\r\n\r\n    while (visited.size < Object.keys(graph).length) {\r\n      // إيجاد العقدة الأقرب غير المزارة\r\n      let closestNode = null;\r\n      let shortestDistance = Infinity;\r\n\r\n      for (const node in distances) {\r\n        if (!visited.has(node) && distances[node] < shortestDistance) {\r\n          closestNode = node;\r\n          shortestDistance = distances[node];\r\n        }\r\n      }\r\n\r\n      if (!closestNode) break;\r\n\r\n      visited.add(closestNode);\r\n\r\n      // تحديث المسافات للعقد المجاورة\r\n      for (const neighbor in graph[closestNode]) {\r\n        const distance = distances[closestNode] + graph[closestNode][neighbor];\r\n\r\n        if (distance < distances[neighbor]) {\r\n          distances[neighbor] = distance;\r\n          previous[neighbor] = closestNode;\r\n        }\r\n      }\r\n    }\r\n\r\n    // بناء المسار\r\n    let current = stops[stops.length - 1].id;\r\n    while (current) {\r\n      path.unshift(current);\r\n      current = previous[current];\r\n    }\r\n\r\n    return {\r\n      path,\r\n      totalDistance: distances[stops[stops.length - 1].id],\r\n      optimized: true,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * خوارزمية تحسين ترتيب المحطات\r\n   * @param {Array} stops - المحطات\r\n   * @param {Object} vehicle - المركبة\r\n   * @returns {Array} - المحطات المحسنة\r\n   */\r\n  static optimizeStopSequence(stops, vehicle) {\r\n    // خوارزمية الجار الأقرب (Nearest Neighbor)\r\n    const optimizedStops = [];\r\n    const remaining = [...stops];\r\n    let currentLocation = vehicle.gpsDevice?.currentLocation?.coordinates || [0, 0];\r\n\r\n    while (remaining.length > 0) {\r\n      let nearestIndex = 0;\r\n      let nearestDistance = Infinity;\r\n\r\n      // إيجاد أقرب محطة\r\n      remaining.forEach((stop, index) => {\r\n        const distance = this.calculateDistance(currentLocation, stop.location.coordinates);\r\n\r\n        if (distance < nearestDistance) {\r\n          nearestDistance = distance;\r\n          nearestIndex = index;\r\n        }\r\n      });\r\n\r\n      const nearest = remaining.splice(nearestIndex, 1)[0];\r\n      optimizedStops.push(nearest);\r\n      currentLocation = nearest.location.coordinates;\r\n    }\r\n\r\n    return optimizedStops;\r\n  }\r\n\r\n  /**\r\n   * تحليل حركة المرور (محاكاة - يمكن دمج مع API خارجي)\r\n   */\r\n  static async analyzeTraffic(route) {\r\n    const analysis = {\r\n      score: 70,\r\n      suggestions: [],\r\n    };\r\n\r\n    // محاكاة بيانات حركة المرور\r\n    const trafficData = this.simulateTrafficData(route);\r\n\r\n    if (trafficData.congestionLevel > 0.7) {\r\n      analysis.suggestions.push({\r\n        type: 'traffic_alternative',\r\n        description: 'اقتراح مسار بديل لتجنب الازدحام المروري',\r\n        estimatedImprovement: 15,\r\n        priority: 'high',\r\n      });\r\n      analysis.score -= 20;\r\n    }\r\n\r\n    if (trafficData.peakHours) {\r\n      analysis.suggestions.push({\r\n        type: 'time_adjustment',\r\n        description: 'تعديل مواعيد الرحلات لتجنب ساعات الذروة',\r\n        estimatedImprovement: 10,\r\n        priority: 'medium',\r\n      });\r\n      analysis.score -= 10;\r\n    }\r\n\r\n    return analysis;\r\n  }\r\n\r\n  /**\r\n   * تحليل طلب الركاب\r\n   */\r\n  static analyzePassengerDemand(route) {\r\n    const analysis = {\r\n      score: 80,\r\n      suggestions: [],\r\n    };\r\n\r\n    const occupancyRate = (route.passengers?.length || 0) / (route.capacity?.total || 1);\r\n\r\n    if (occupancyRate < 0.5) {\r\n      analysis.suggestions.push({\r\n        type: 'reduce_frequency',\r\n        description: 'تقليل عدد الرحلات أو دمج مسارات قليلة الاستخدام',\r\n        estimatedImprovement: 20,\r\n        priority: 'low',\r\n      });\r\n      analysis.score -= 15;\r\n    }\r\n\r\n    if (occupancyRate > 0.9) {\r\n      analysis.suggestions.push({\r\n        type: 'increase_capacity',\r\n        description: 'زيادة عدد المركبات أو استخدام مركبات أكبر',\r\n        estimatedImprovement: 25,\r\n        priority: 'high',\r\n      });\r\n      analysis.score -= 10;\r\n    }\r\n\r\n    // تحليل توزيع الركاب على المحطات\r\n    const stopAnalysis = this.analyzeStopUsage(route.stops);\r\n    if (stopAnalysis.unusedStops > 0) {\r\n      analysis.suggestions.push({\r\n        type: 'remove_stops',\r\n        description: `إزالة ${stopAnalysis.unusedStops} محطة غير مستخدمة`,\r\n        estimatedImprovement: 10,\r\n        priority: 'medium',\r\n      });\r\n    }\r\n\r\n    return analysis;\r\n  }\r\n\r\n  /**\r\n   * تحليل كفاءة استهلاك الوقود\r\n   */\r\n  static analyzeFuelEfficiency(route) {\r\n    const analysis = {\r\n      score: 75,\r\n      suggestions: [],\r\n    };\r\n\r\n    const avgDistance = route.totalDistance || 0;\r\n    const stopCount = route.stops?.length || 0;\r\n\r\n    // تحليل عدد نقاط التوقف\r\n    if (stopCount > 15) {\r\n      analysis.suggestions.push({\r\n        type: 'consolidate_stops',\r\n        description: 'دمج المحطات القريبة لتقليل عدد التوقفات',\r\n        estimatedImprovement: 12,\r\n        priority: 'medium',\r\n      });\r\n      analysis.score -= 10;\r\n    }\r\n\r\n    // تحليل المسافة الكلية\r\n    if (avgDistance > 50) {\r\n      analysis.suggestions.push({\r\n        type: 'optimize_distance',\r\n        description: 'تحسين المسار لتقليل المسافة الكلية',\r\n        estimatedImprovement: 15,\r\n        priority: 'high',\r\n      });\r\n      analysis.score -= 15;\r\n    }\r\n\r\n    return analysis;\r\n  }\r\n\r\n  /**\r\n   * تحليل كفاءة الوقت\r\n   */\r\n  static analyzeTimeEfficiency(route) {\r\n    const analysis = {\r\n      score: 85,\r\n      suggestions: [],\r\n    };\r\n\r\n    const estimatedDuration = route.estimatedDuration || 0;\r\n    const stopCount = route.stops?.length || 0;\r\n    const avgStopTime = estimatedDuration / (stopCount || 1);\r\n\r\n    if (avgStopTime > 5) {\r\n      analysis.suggestions.push({\r\n        type: 'reduce_wait_time',\r\n        description: 'تقليل وقت الانتظار في المحطات',\r\n        estimatedImprovement: 10,\r\n        priority: 'medium',\r\n      });\r\n      analysis.score -= 10;\r\n    }\r\n\r\n    return analysis;\r\n  }\r\n\r\n  /**\r\n   * حساب المسافة بين نقطتين (Haversine Formula)\r\n   */\r\n  static calculateDistance(point1, point2) {\r\n    const [lon1, lat1] = point1;\r\n    const [lon2, lat2] = point2;\r\n\r\n    const R = 6371; // نصف قطر الأرض بالكيلومتر\r\n    const dLat = this.toRad(lat2 - lat1);\r\n    const dLon = this.toRad(lon2 - lon1);\r\n\r\n    const a =\r\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(this.toRad(lat1)) *\r\n        Math.cos(this.toRad(lat2)) *\r\n        Math.sin(dLon / 2) *\r\n        Math.sin(dLon / 2);\r\n\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n  }\r\n\r\n  /**\r\n   * تحويل الدرجات إلى راديان\r\n   */\r\n  static toRad(degrees) {\r\n    return degrees * (Math.PI / 180);\r\n  }\r\n\r\n  /**\r\n   * بناء رسم بياني من المحطات\r\n   */\r\n  static buildGraph(stops) {\r\n    const graph = {};\r\n\r\n    stops.forEach((stop, i) => {\r\n      graph[stop.id] = {};\r\n\r\n      stops.forEach((otherStop, j) => {\r\n        if (i !== j) {\r\n          const distance = this.calculateDistance(\r\n            stop.location.coordinates,\r\n            otherStop.location.coordinates\r\n          );\r\n          graph[stop.id][otherStop.id] = distance;\r\n        }\r\n      });\r\n    });\r\n\r\n    return graph;\r\n  }\r\n\r\n  /**\r\n   * محاكاة بيانات حركة المرور\r\n   */\r\n  static simulateTrafficData(route) {\r\n    const hour = new Date().getHours();\r\n    const isPeakHour = (hour >= 7 && hour <= 9) || (hour >= 16 && hour <= 18);\r\n\r\n    return {\r\n      congestionLevel: isPeakHour ? 0.8 : 0.3,\r\n      peakHours: isPeakHour,\r\n      averageSpeed: isPeakHour ? 30 : 60,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * تحليل استخدام المحطات\r\n   */\r\n  static analyzeStopUsage(stops) {\r\n    let unusedStops = 0;\r\n    let underutilizedStops = 0;\r\n\r\n    stops.forEach(stop => {\r\n      const passengerCount = stop.passengers?.length || 0;\r\n\r\n      if (passengerCount === 0) {\r\n        unusedStops++;\r\n      } else if (passengerCount < 2) {\r\n        underutilizedStops++;\r\n      }\r\n    });\r\n\r\n    return {\r\n      unusedStops,\r\n      underutilizedStops,\r\n      totalStops: stops.length,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * اقتراح مسارات بديلة\r\n   */\r\n  static async suggestAlternativeRoutes(route, passengerNeeds) {\r\n    const alternatives = [];\r\n\r\n    // المسار السريع\r\n    const fastRoute = {\r\n      name: 'المسار السريع',\r\n      type: 'fast',\r\n      estimatedTime: Math.round(route.estimatedDuration * 0.8),\r\n      stops: this.reduceStops(route.stops, 0.5),\r\n      score: 85,\r\n    };\r\n    alternatives.push(fastRoute);\r\n\r\n    // المسار الشامل\r\n    const comprehensiveRoute = {\r\n      name: 'المسار الشامل',\r\n      type: 'comprehensive',\r\n      estimatedTime: Math.round(route.estimatedDuration * 1.2),\r\n      stops: this.expandStops(route.stops, passengerNeeds),\r\n      score: 90,\r\n    };\r\n    alternatives.push(comprehensiveRoute);\r\n\r\n    // المسار الاقتصادي\r\n    const economicRoute = {\r\n      name: 'المسار الاقتصادي',\r\n      type: 'economic',\r\n      estimatedTime: route.estimatedDuration,\r\n      stops: this.optimizeStopsForFuel(route.stops),\r\n      score: 80,\r\n    };\r\n    alternatives.push(economicRoute);\r\n\r\n    return alternatives;\r\n  }\r\n\r\n  static reduceStops(stops, percentage) {\r\n    const keepCount = Math.ceil(stops.length * percentage);\r\n    return stops\r\n      .sort((a, b) => (b.passengers?.length || 0) - (a.passengers?.length || 0))\r\n      .slice(0, keepCount);\r\n  }\r\n\r\n  static expandStops(stops, passengerNeeds) {\r\n    // إضافة محطات جديدة بناءً على احتياجات الركاب\r\n    return stops; // سيتم التوسع لاحقاً\r\n  }\r\n\r\n  static optimizeStopsForFuel(stops) {\r\n    // تحسين المحطات لتقليل استهلاك الوقود\r\n    return this.optimizeStopSequence(stops, {});\r\n  }\r\n}\r\n\r\nmodule.exports = RouteOptimizationService;\r\n"],"mappings":"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","ignoreList":[]}