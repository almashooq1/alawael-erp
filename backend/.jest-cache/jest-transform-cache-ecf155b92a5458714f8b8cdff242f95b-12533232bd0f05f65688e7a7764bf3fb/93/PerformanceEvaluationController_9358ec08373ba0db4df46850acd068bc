551c2c6888e470f2119ccb377875dafa
const PerformanceEvaluation = require('../models/PerformanceEvaluation');
const {
  generateAIRecommendation
} = require('../services/performanceEvaluationAI');
const PerformanceEvaluationController = {
  // إنشاء تقييم جديد
  createEvaluation: async (req, res) => {
    try {
      const {
        employeeId,
        evaluationPeriod,
        evaluations,
        hrNotes
      } = req.body;
      const perfEval = new PerformanceEvaluation({
        employeeId,
        evaluationPeriod,
        evaluations,
        hrNotes,
        status: 'draft'
      });
      perfEval.calculateOverallScore();
      perfEval.summary.aiRecommendation = generateAIRecommendation(perfEval);
      await perfEval.save();
      res.json({
        success: true,
        evaluation: perfEval
      });
    } catch (err) {
      res.status(500).json({
        success: false,
        error: err.message
      });
    }
  },
  // جلب تقييمات موظف
  getEmployeeEvaluations: async (req, res) => {
    try {
      const {
        employeeId
      } = req.params;
      const evals = await PerformanceEvaluation.find({
        employeeId
      }).sort({
        'evaluationPeriod.startDate': -1
      });
      res.json({
        success: true,
        evaluations: evals
      });
    } catch (err) {
      res.status(500).json({
        success: false,
        error: err.message
      });
    }
  },
  // توليد توصية ذكية لتقييم موجود
  getAIRecommendation: async (req, res) => {
    try {
      const {
        id
      } = req.params;
      const perfEval = await PerformanceEvaluation.findById(id);
      if (!perfEval) return res.status(404).json({
        success: false,
        message: 'Not found'
      });
      perfEval.calculateOverallScore();
      const rec = generateAIRecommendation(perfEval);
      res.json({
        success: true,
        recommendation: rec
      });
    } catch (err) {
      res.status(500).json({
        success: false,
        error: err.message
      });
    }
  }
};
module.exports = PerformanceEvaluationController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQZXJmb3JtYW5jZUV2YWx1YXRpb24iLCJyZXF1aXJlIiwiZ2VuZXJhdGVBSVJlY29tbWVuZGF0aW9uIiwiUGVyZm9ybWFuY2VFdmFsdWF0aW9uQ29udHJvbGxlciIsImNyZWF0ZUV2YWx1YXRpb24iLCJyZXEiLCJyZXMiLCJlbXBsb3llZUlkIiwiZXZhbHVhdGlvblBlcmlvZCIsImV2YWx1YXRpb25zIiwiaHJOb3RlcyIsImJvZHkiLCJwZXJmRXZhbCIsInN0YXR1cyIsImNhbGN1bGF0ZU92ZXJhbGxTY29yZSIsInN1bW1hcnkiLCJhaVJlY29tbWVuZGF0aW9uIiwic2F2ZSIsImpzb24iLCJzdWNjZXNzIiwiZXZhbHVhdGlvbiIsImVyciIsImVycm9yIiwibWVzc2FnZSIsImdldEVtcGxveWVlRXZhbHVhdGlvbnMiLCJwYXJhbXMiLCJldmFscyIsImZpbmQiLCJzb3J0IiwiZ2V0QUlSZWNvbW1lbmRhdGlvbiIsImlkIiwiZmluZEJ5SWQiLCJyZWMiLCJyZWNvbW1lbmRhdGlvbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJQZXJmb3JtYW5jZUV2YWx1YXRpb25Db250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFBlcmZvcm1hbmNlRXZhbHVhdGlvbiA9IHJlcXVpcmUoJy4uL21vZGVscy9QZXJmb3JtYW5jZUV2YWx1YXRpb24nKTtcclxuY29uc3QgeyBnZW5lcmF0ZUFJUmVjb21tZW5kYXRpb24gfSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3BlcmZvcm1hbmNlRXZhbHVhdGlvbkFJJyk7XHJcblxyXG5jb25zdCBQZXJmb3JtYW5jZUV2YWx1YXRpb25Db250cm9sbGVyID0ge1xyXG4gIC8vINil2YbYtNin2KEg2KrZgtmK2YrZhSDYrNiv2YrYr1xyXG4gIGNyZWF0ZUV2YWx1YXRpb246IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBlbXBsb3llZUlkLCBldmFsdWF0aW9uUGVyaW9kLCBldmFsdWF0aW9ucywgaHJOb3RlcyB9ID0gcmVxLmJvZHk7XHJcbiAgICAgIGNvbnN0IHBlcmZFdmFsID0gbmV3IFBlcmZvcm1hbmNlRXZhbHVhdGlvbih7XHJcbiAgICAgICAgZW1wbG95ZWVJZCxcclxuICAgICAgICBldmFsdWF0aW9uUGVyaW9kLFxyXG4gICAgICAgIGV2YWx1YXRpb25zLFxyXG4gICAgICAgIGhyTm90ZXMsXHJcbiAgICAgICAgc3RhdHVzOiAnZHJhZnQnLFxyXG4gICAgICB9KTtcclxuICAgICAgcGVyZkV2YWwuY2FsY3VsYXRlT3ZlcmFsbFNjb3JlKCk7XHJcbiAgICAgIHBlcmZFdmFsLnN1bW1hcnkuYWlSZWNvbW1lbmRhdGlvbiA9IGdlbmVyYXRlQUlSZWNvbW1lbmRhdGlvbihwZXJmRXZhbCk7XHJcbiAgICAgIGF3YWl0IHBlcmZFdmFsLnNhdmUoKTtcclxuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBldmFsdWF0aW9uOiBwZXJmRXZhbCB9KTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgICB9XHJcbiAgfSxcclxuICAvLyDYrNmE2Kgg2KrZgtmK2YrZhdin2Kog2YXZiNi42YFcclxuICBnZXRFbXBsb3llZUV2YWx1YXRpb25zOiBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZW1wbG95ZWVJZCB9ID0gcmVxLnBhcmFtcztcclxuICAgICAgY29uc3QgZXZhbHMgPSBhd2FpdCBQZXJmb3JtYW5jZUV2YWx1YXRpb24uZmluZCh7IGVtcGxveWVlSWQgfSkuc29ydCh7XHJcbiAgICAgICAgJ2V2YWx1YXRpb25QZXJpb2Quc3RhcnREYXRlJzogLTEsXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGV2YWx1YXRpb25zOiBldmFscyB9KTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgICB9XHJcbiAgfSxcclxuICAvLyDYqtmI2YTZitivINiq2YjYtdmK2Kkg2LDZg9mK2Kkg2YTYqtmC2YrZitmFINmF2YjYrNmI2K9cclxuICBnZXRBSVJlY29tbWVuZGF0aW9uOiBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICAgIGNvbnN0IHBlcmZFdmFsID0gYXdhaXQgUGVyZm9ybWFuY2VFdmFsdWF0aW9uLmZpbmRCeUlkKGlkKTtcclxuICAgICAgaWYgKCFwZXJmRXZhbCkgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdOb3QgZm91bmQnIH0pO1xyXG4gICAgICBwZXJmRXZhbC5jYWxjdWxhdGVPdmVyYWxsU2NvcmUoKTtcclxuICAgICAgY29uc3QgcmVjID0gZ2VuZXJhdGVBSVJlY29tbWVuZGF0aW9uKHBlcmZFdmFsKTtcclxuICAgICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCByZWNvbW1lbmRhdGlvbjogcmVjIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9KTtcclxuICAgIH1cclxuICB9LFxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQZXJmb3JtYW5jZUV2YWx1YXRpb25Db250cm9sbGVyO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLHFCQUFxQixHQUFHQyxPQUFPLENBQUMsaUNBQWlDLENBQUM7QUFDeEUsTUFBTTtFQUFFQztBQUF5QixDQUFDLEdBQUdELE9BQU8sQ0FBQyxxQ0FBcUMsQ0FBQztBQUVuRixNQUFNRSwr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