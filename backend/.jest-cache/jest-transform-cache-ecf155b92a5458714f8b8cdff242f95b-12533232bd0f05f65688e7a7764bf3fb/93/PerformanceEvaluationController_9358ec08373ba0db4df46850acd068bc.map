{"version":3,"names":["PerformanceEvaluation","require","generateAIRecommendation","PerformanceEvaluationController","createEvaluation","req","res","employeeId","evaluationPeriod","evaluations","hrNotes","body","perfEval","status","calculateOverallScore","summary","aiRecommendation","save","json","success","evaluation","err","error","message","getEmployeeEvaluations","params","evals","find","sort","getAIRecommendation","id","findById","rec","recommendation","module","exports"],"sources":["PerformanceEvaluationController.js"],"sourcesContent":["const PerformanceEvaluation = require('../models/PerformanceEvaluation');\r\nconst { generateAIRecommendation } = require('../services/performanceEvaluationAI');\r\n\r\nconst PerformanceEvaluationController = {\r\n  // إنشاء تقييم جديد\r\n  createEvaluation: async (req, res) => {\r\n    try {\r\n      const { employeeId, evaluationPeriod, evaluations, hrNotes } = req.body;\r\n      const perfEval = new PerformanceEvaluation({\r\n        employeeId,\r\n        evaluationPeriod,\r\n        evaluations,\r\n        hrNotes,\r\n        status: 'draft',\r\n      });\r\n      perfEval.calculateOverallScore();\r\n      perfEval.summary.aiRecommendation = generateAIRecommendation(perfEval);\r\n      await perfEval.save();\r\n      res.json({ success: true, evaluation: perfEval });\r\n    } catch (err) {\r\n      res.status(500).json({ success: false, error: err.message });\r\n    }\r\n  },\r\n  // جلب تقييمات موظف\r\n  getEmployeeEvaluations: async (req, res) => {\r\n    try {\r\n      const { employeeId } = req.params;\r\n      const evals = await PerformanceEvaluation.find({ employeeId }).sort({\r\n        'evaluationPeriod.startDate': -1,\r\n      });\r\n      res.json({ success: true, evaluations: evals });\r\n    } catch (err) {\r\n      res.status(500).json({ success: false, error: err.message });\r\n    }\r\n  },\r\n  // توليد توصية ذكية لتقييم موجود\r\n  getAIRecommendation: async (req, res) => {\r\n    try {\r\n      const { id } = req.params;\r\n      const perfEval = await PerformanceEvaluation.findById(id);\r\n      if (!perfEval) return res.status(404).json({ success: false, message: 'Not found' });\r\n      perfEval.calculateOverallScore();\r\n      const rec = generateAIRecommendation(perfEval);\r\n      res.json({ success: true, recommendation: rec });\r\n    } catch (err) {\r\n      res.status(500).json({ success: false, error: err.message });\r\n    }\r\n  },\r\n};\r\n\r\nmodule.exports = PerformanceEvaluationController;\r\n"],"mappings":"AAAA,MAAMA,qBAAqB,GAAGC,OAAO,CAAC,iCAAiC,CAAC;AACxE,MAAM;EAAEC;AAAyB,CAAC,GAAGD,OAAO,CAAC,qCAAqC,CAAC;AAEnF,MAAME,+BAA+B,GAAG;EACtC;EACAC,gBAAgB,EAAE,MAAAA,CAAOC,GAAG,EAAEC,GAAG,KAAK;IACpC,IAAI;MACF,MAAM;QAAEC,UAAU;QAAEC,gBAAgB;QAAEC,WAAW;QAAEC;MAAQ,CAAC,GAAGL,GAAG,CAACM,IAAI;MACvE,MAAMC,QAAQ,GAAG,IAAIZ,qBAAqB,CAAC;QACzCO,UAAU;QACVC,gBAAgB;QAChBC,WAAW;QACXC,OAAO;QACPG,MAAM,EAAE;MACV,CAAC,CAAC;MACFD,QAAQ,CAACE,qBAAqB,CAAC,CAAC;MAChCF,QAAQ,CAACG,OAAO,CAACC,gBAAgB,GAAGd,wBAAwB,CAACU,QAAQ,CAAC;MACtE,MAAMA,QAAQ,CAACK,IAAI,CAAC,CAAC;MACrBX,GAAG,CAACY,IAAI,CAAC;QAAEC,OAAO,EAAE,IAAI;QAAEC,UAAU,EAAER;MAAS,CAAC,CAAC;IACnD,CAAC,CAAC,OAAOS,GAAG,EAAE;MACZf,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACK,IAAI,CAAC;QAAEC,OAAO,EAAE,KAAK;QAAEG,KAAK,EAAED,GAAG,CAACE;MAAQ,CAAC,CAAC;IAC9D;EACF,CAAC;EACD;EACAC,sBAAsB,EAAE,MAAAA,CAAOnB,GAAG,EAAEC,GAAG,KAAK;IAC1C,IAAI;MACF,MAAM;QAAEC;MAAW,CAAC,GAAGF,GAAG,CAACoB,MAAM;MACjC,MAAMC,KAAK,GAAG,MAAM1B,qBAAqB,CAAC2B,IAAI,CAAC;QAAEpB;MAAW,CAAC,CAAC,CAACqB,IAAI,CAAC;QAClE,4BAA4B,EAAE,CAAC;MACjC,CAAC,CAAC;MACFtB,GAAG,CAACY,IAAI,CAAC;QAAEC,OAAO,EAAE,IAAI;QAAEV,WAAW,EAAEiB;MAAM,CAAC,CAAC;IACjD,CAAC,CAAC,OAAOL,GAAG,EAAE;MACZf,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACK,IAAI,CAAC;QAAEC,OAAO,EAAE,KAAK;QAAEG,KAAK,EAAED,GAAG,CAACE;MAAQ,CAAC,CAAC;IAC9D;EACF,CAAC;EACD;EACAM,mBAAmB,EAAE,MAAAA,CAAOxB,GAAG,EAAEC,GAAG,KAAK;IACvC,IAAI;MACF,MAAM;QAAEwB;MAAG,CAAC,GAAGzB,GAAG,CAACoB,MAAM;MACzB,MAAMb,QAAQ,GAAG,MAAMZ,qBAAqB,CAAC+B,QAAQ,CAACD,EAAE,CAAC;MACzD,IAAI,CAAClB,QAAQ,EAAE,OAAON,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACK,IAAI,CAAC;QAAEC,OAAO,EAAE,KAAK;QAAEI,OAAO,EAAE;MAAY,CAAC,CAAC;MACpFX,QAAQ,CAACE,qBAAqB,CAAC,CAAC;MAChC,MAAMkB,GAAG,GAAG9B,wBAAwB,CAACU,QAAQ,CAAC;MAC9CN,GAAG,CAACY,IAAI,CAAC;QAAEC,OAAO,EAAE,IAAI;QAAEc,cAAc,EAAED;MAAI,CAAC,CAAC;IAClD,CAAC,CAAC,OAAOX,GAAG,EAAE;MACZf,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACK,IAAI,CAAC;QAAEC,OAAO,EAAE,KAAK;QAAEG,KAAK,EAAED,GAAG,CAACE;MAAQ,CAAC,CAAC;IAC9D;EACF;AACF,CAAC;AAEDW,MAAM,CAACC,OAAO,GAAGhC,+BAA+B","ignoreList":[]}