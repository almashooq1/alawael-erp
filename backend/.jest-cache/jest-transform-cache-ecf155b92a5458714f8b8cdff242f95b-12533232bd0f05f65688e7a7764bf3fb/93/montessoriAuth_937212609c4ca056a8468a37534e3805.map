{"version":3,"names":["jwt","require","User","authenticateToken","req","res","next","authHeader","headers","token","split","sendStatus","verify","process","env","JWT_SECRET","err","user","authorizeRoles","roles","includes","role","status","json","message","module","exports"],"sources":["montessoriAuth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\r\nconst User = require('../models/User');\r\n\r\n// التحقق من التوكن\r\nfunction authenticateToken(req, res, next) {\r\n  const authHeader = req.headers['authorization'];\r\n  const token = authHeader && authHeader.split(' ')[1];\r\n  if (!token) return res.sendStatus(401);\r\n  jwt.verify(token, process.env.JWT_SECRET, (err, user) => {\r\n    if (err) return res.sendStatus(403);\r\n    req.user = user;\r\n    next();\r\n  });\r\n}\r\n\r\n// التحقق من الدور\r\nfunction authorizeRoles(...roles) {\r\n  return (req, res, next) => {\r\n    if (!req.user || !roles.includes(req.user.role)) {\r\n      return res.status(403).json({ message: 'غير مصرح' });\r\n    }\r\n    next();\r\n  };\r\n}\r\n\r\nmodule.exports = { authenticateToken, authorizeRoles };\r\n"],"mappings":"AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAC,cAAc,CAAC;AACnC,MAAMC,IAAI,GAAGD,OAAO,CAAC,gBAAgB,CAAC;;AAEtC;AACA,SAASE,iBAAiBA,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE;EACzC,MAAMC,UAAU,GAAGH,GAAG,CAACI,OAAO,CAAC,eAAe,CAAC;EAC/C,MAAMC,KAAK,GAAGF,UAAU,IAAIA,UAAU,CAACG,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EACpD,IAAI,CAACD,KAAK,EAAE,OAAOJ,GAAG,CAACM,UAAU,CAAC,GAAG,CAAC;EACtCX,GAAG,CAACY,MAAM,CAACH,KAAK,EAAEI,OAAO,CAACC,GAAG,CAACC,UAAU,EAAE,CAACC,GAAG,EAAEC,IAAI,KAAK;IACvD,IAAID,GAAG,EAAE,OAAOX,GAAG,CAACM,UAAU,CAAC,GAAG,CAAC;IACnCP,GAAG,CAACa,IAAI,GAAGA,IAAI;IACfX,IAAI,CAAC,CAAC;EACR,CAAC,CAAC;AACJ;;AAEA;AACA,SAASY,cAAcA,CAAC,GAAGC,KAAK,EAAE;EAChC,OAAO,CAACf,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;IACzB,IAAI,CAACF,GAAG,CAACa,IAAI,IAAI,CAACE,KAAK,CAACC,QAAQ,CAAChB,GAAG,CAACa,IAAI,CAACI,IAAI,CAAC,EAAE;MAC/C,OAAOhB,GAAG,CAACiB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAW,CAAC,CAAC;IACtD;IACAlB,IAAI,CAAC,CAAC;EACR,CAAC;AACH;AAEAmB,MAAM,CAACC,OAAO,GAAG;EAAEvB,iBAAiB;EAAEe;AAAe,CAAC","ignoreList":[]}