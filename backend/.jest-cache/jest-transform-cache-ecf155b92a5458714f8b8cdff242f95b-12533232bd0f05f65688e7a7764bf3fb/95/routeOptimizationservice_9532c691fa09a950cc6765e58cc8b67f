f62b5683b07391ad20a59c4623870ecd
/**
 * خدمة تحسين المسارات الذكية
 * Smart Route Optimization Service
 */

class RouteOptimizationService {
  /**
   * خوارزمية تحسين المسار بناءً على عدة عوامل
   * @param {Object} route - المسار الحالي
   * @param {Object} options - خيارات التحسين
   * @returns {Object} - المسار المحسّن مع التوصيات
   */
  static async optimizeRoute(route, options = {}) {
    try {
      if (!route) {
        return {
          score: 0,
          suggestions: [],
          estimatedImprovements: {}
        };
      }
      const {
        considerTraffic = true,
        considerPassengerDemand = true,
        considerFuelEfficiency = true,
        considerTimeEfficiency = true
      } = options;
      const optimization = {
        score: 0,
        suggestions: [],
        estimatedImprovements: {}
      };

      // 1. تحليل حركة المرور
      if (considerTraffic) {
        const trafficAnalysis = await this.analyzeTraffic(route);
        if (trafficAnalysis) {
          optimization.suggestions.push(...(trafficAnalysis.suggestions || []));
          optimization.score += trafficAnalysis.score || 0;
        }
      }

      // 2. تحليل طلب الركاب
      if (considerPassengerDemand) {
        const demandAnalysis = this.analyzePassengerDemand(route);
        if (demandAnalysis) {
          optimization.suggestions.push(...(demandAnalysis.suggestions || []));
          optimization.score += demandAnalysis.score || 0;
        }
      }

      // 3. تحسين استهلاك الوقود
      if (considerFuelEfficiency) {
        const fuelAnalysis = this.analyzeFuelEfficiency(route);
        if (fuelAnalysis) {
          optimization.suggestions.push(...(fuelAnalysis.suggestions || []));
          optimization.score += fuelAnalysis.score || 0;
        }
      }

      // 4. تحسين الوقت
      if (considerTimeEfficiency) {
        const timeAnalysis = this.analyzeTimeEfficiency(route);
        if (timeAnalysis) {
          optimization.suggestions.push(...(timeAnalysis.suggestions || []));
          optimization.score += timeAnalysis.score || 0;
        }
      }

      // حساب النتيجة النهائية
      const divisor = (considerTraffic ? 1 : 0) + (considerPassengerDemand ? 1 : 0) + (considerFuelEfficiency ? 1 : 0) + (considerTimeEfficiency ? 1 : 0);
      optimization.score = divisor > 0 ? Math.min(100, optimization.score / divisor) : 0;
      return optimization;
    } catch (error) {
      console.error('Route optimization error:', error.message);
      return {
        score: 0,
        suggestions: [{
          type: 'optimization_failed',
          description: 'فشل تحسين المسار: ' + error.message,
          estimatedImprovement: 0
        }],
        estimatedImprovements: {}
      };
    }
  }

  /**
   * خوارزمية إيجاد أقصر مسار (Dijkstra's Algorithm)
   * @param {Array} stops - نقاط التوقف
   * @param {Object} startPoint - نقطة البداية
   * @returns {Object} - المسار الأمثل
   */
  static calculateShortestPath(stops, startPoint) {
    const graph = this.buildGraph(stops);
    const distances = {};
    const visited = new Set();
    const previous = {};
    const path = [];

    // تهيئة المسافات
    Object.keys(graph).forEach(node => {
      distances[node] = Infinity;
      previous[node] = null;
    });
    distances[startPoint.id] = 0;
    while (visited.size < Object.keys(graph).length) {
      // إيجاد العقدة الأقرب غير المزارة
      let closestNode = null;
      let shortestDistance = Infinity;
      for (const node in distances) {
        if (!visited.has(node) && distances[node] < shortestDistance) {
          closestNode = node;
          shortestDistance = distances[node];
        }
      }
      if (!closestNode) break;
      visited.add(closestNode);

      // تحديث المسافات للعقد المجاورة
      for (const neighbor in graph[closestNode]) {
        const distance = distances[closestNode] + graph[closestNode][neighbor];
        if (distance < distances[neighbor]) {
          distances[neighbor] = distance;
          previous[neighbor] = closestNode;
        }
      }
    }

    // بناء المسار
    let current = stops[stops.length - 1].id;
    while (current) {
      path.unshift(current);
      current = previous[current];
    }
    return {
      path,
      totalDistance: distances[stops[stops.length - 1].id],
      optimized: true
    };
  }

  /**
   * خوارزمية تحسين ترتيب المحطات
   * @param {Array} stops - المحطات
   * @param {Object} vehicle - المركبة
   * @returns {Array} - المحطات المحسنة
   */
  static optimizeStopSequence(stops, vehicle) {
    // خوارزمية الجار الأقرب (Nearest Neighbor)
    const optimizedStops = [];
    const remaining = [...stops];
    let currentLocation = vehicle.gpsDevice?.currentLocation?.coordinates || [0, 0];
    while (remaining.length > 0) {
      let nearestIndex = 0;
      let nearestDistance = Infinity;

      // إيجاد أقرب محطة
      remaining.forEach((stop, index) => {
        const distance = this.calculateDistance(currentLocation, stop.location.coordinates);
        if (distance < nearestDistance) {
          nearestDistance = distance;
          nearestIndex = index;
        }
      });
      const nearest = remaining.splice(nearestIndex, 1)[0];
      optimizedStops.push(nearest);
      currentLocation = nearest.location.coordinates;
    }
    return optimizedStops;
  }

  /**
   * تحليل حركة المرور (محاكاة - يمكن دمج مع API خارجي)
   */
  static async analyzeTraffic(route) {
    const analysis = {
      score: 70,
      suggestions: []
    };

    // محاكاة بيانات حركة المرور
    const trafficData = this.simulateTrafficData(route);
    if (trafficData.congestionLevel > 0.7) {
      analysis.suggestions.push({
        type: 'traffic_alternative',
        description: 'اقتراح مسار بديل لتجنب الازدحام المروري',
        estimatedImprovement: 15,
        priority: 'high'
      });
      analysis.score -= 20;
    }
    if (trafficData.peakHours) {
      analysis.suggestions.push({
        type: 'time_adjustment',
        description: 'تعديل مواعيد الرحلات لتجنب ساعات الذروة',
        estimatedImprovement: 10,
        priority: 'medium'
      });
      analysis.score -= 10;
    }
    return analysis;
  }

  /**
   * تحليل طلب الركاب
   */
  static analyzePassengerDemand(route) {
    const analysis = {
      score: 80,
      suggestions: []
    };
    const occupancyRate = (route.passengers?.length || 0) / (route.capacity?.total || 1);
    if (occupancyRate < 0.5) {
      analysis.suggestions.push({
        type: 'reduce_frequency',
        description: 'تقليل عدد الرحلات أو دمج مسارات قليلة الاستخدام',
        estimatedImprovement: 20,
        priority: 'low'
      });
      analysis.score -= 15;
    }
    if (occupancyRate > 0.9) {
      analysis.suggestions.push({
        type: 'increase_capacity',
        description: 'زيادة عدد المركبات أو استخدام مركبات أكبر',
        estimatedImprovement: 25,
        priority: 'high'
      });
      analysis.score -= 10;
    }

    // تحليل توزيع الركاب على المحطات
    const stopAnalysis = this.analyzeStopUsage(route.stops);
    if (stopAnalysis.unusedStops > 0) {
      analysis.suggestions.push({
        type: 'remove_stops',
        description: `إزالة ${stopAnalysis.unusedStops} محطة غير مستخدمة`,
        estimatedImprovement: 10,
        priority: 'medium'
      });
    }
    return analysis;
  }

  /**
   * تحليل كفاءة استهلاك الوقود
   */
  static analyzeFuelEfficiency(route) {
    const analysis = {
      score: 75,
      suggestions: []
    };
    const avgDistance = route.totalDistance || 0;
    const stopCount = route.stops?.length || 0;

    // تحليل عدد نقاط التوقف
    if (stopCount > 15) {
      analysis.suggestions.push({
        type: 'consolidate_stops',
        description: 'دمج المحطات القريبة لتقليل عدد التوقفات',
        estimatedImprovement: 12,
        priority: 'medium'
      });
      analysis.score -= 10;
    }

    // تحليل المسافة الكلية
    if (avgDistance > 50) {
      analysis.suggestions.push({
        type: 'optimize_distance',
        description: 'تحسين المسار لتقليل المسافة الكلية',
        estimatedImprovement: 15,
        priority: 'high'
      });
      analysis.score -= 15;
    }
    return analysis;
  }

  /**
   * تحليل كفاءة الوقت
   */
  static analyzeTimeEfficiency(route) {
    const analysis = {
      score: 85,
      suggestions: []
    };
    const estimatedDuration = route.estimatedDuration || 0;
    const stopCount = route.stops?.length || 0;
    const avgStopTime = estimatedDuration / (stopCount || 1);
    if (avgStopTime > 5) {
      analysis.suggestions.push({
        type: 'reduce_wait_time',
        description: 'تقليل وقت الانتظار في المحطات',
        estimatedImprovement: 10,
        priority: 'medium'
      });
      analysis.score -= 10;
    }
    return analysis;
  }

  /**
   * حساب المسافة بين نقطتين (Haversine Formula)
   */
  static calculateDistance(point1, point2) {
    const [lon1, lat1] = point1;
    const [lon2, lat2] = point2;
    const R = 6371; // نصف قطر الأرض بالكيلومتر
    const dLat = this.toRad(lat2 - lat1);
    const dLon = this.toRad(lon2 - lon1);
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(this.toRad(lat1)) * Math.cos(this.toRad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  /**
   * تحويل الدرجات إلى راديان
   */
  static toRad(degrees) {
    return degrees * (Math.PI / 180);
  }

  /**
   * بناء رسم بياني من المحطات
   */
  static buildGraph(stops) {
    const graph = {};
    stops.forEach((stop, i) => {
      graph[stop.id] = {};
      stops.forEach((otherStop, j) => {
        if (i !== j) {
          const distance = this.calculateDistance(stop.location.coordinates, otherStop.location.coordinates);
          graph[stop.id][otherStop.id] = distance;
        }
      });
    });
    return graph;
  }

  /**
   * محاكاة بيانات حركة المرور
   */
  static simulateTrafficData(route) {
    const hour = new Date().getHours();
    const isPeakHour = hour >= 7 && hour <= 9 || hour >= 16 && hour <= 18;
    return {
      congestionLevel: isPeakHour ? 0.8 : 0.3,
      peakHours: isPeakHour,
      averageSpeed: isPeakHour ? 30 : 60
    };
  }

  /**
   * تحليل استخدام المحطات
   */
  static analyzeStopUsage(stops) {
    let unusedStops = 0;
    let underutilizedStops = 0;
    stops.forEach(stop => {
      const passengerCount = stop.passengers?.length || 0;
      if (passengerCount === 0) {
        unusedStops++;
      } else if (passengerCount < 2) {
        underutilizedStops++;
      }
    });
    return {
      unusedStops,
      underutilizedStops,
      totalStops: stops.length
    };
  }

  /**
   * اقتراح مسارات بديلة
   */
  static async suggestAlternativeRoutes(route, passengerNeeds) {
    const alternatives = [];

    // المسار السريع
    const fastRoute = {
      name: 'المسار السريع',
      type: 'fast',
      estimatedTime: Math.round(route.estimatedDuration * 0.8),
      stops: this.reduceStops(route.stops, 0.5),
      score: 85
    };
    alternatives.push(fastRoute);

    // المسار الشامل
    const comprehensiveRoute = {
      name: 'المسار الشامل',
      type: 'comprehensive',
      estimatedTime: Math.round(route.estimatedDuration * 1.2),
      stops: this.expandStops(route.stops, passengerNeeds),
      score: 90
    };
    alternatives.push(comprehensiveRoute);

    // المسار الاقتصادي
    const economicRoute = {
      name: 'المسار الاقتصادي',
      type: 'economic',
      estimatedTime: route.estimatedDuration,
      stops: this.optimizeStopsForFuel(route.stops),
      score: 80
    };
    alternatives.push(economicRoute);
    return alternatives;
  }
  static reduceStops(stops, percentage) {
    const keepCount = Math.ceil(stops.length * percentage);
    return stops.sort((a, b) => (b.passengers?.length || 0) - (a.passengers?.length || 0)).slice(0, keepCount);
  }
  static expandStops(stops, passengerNeeds) {
    // إضافة محطات جديدة بناءً على احتياجات الركاب
    return stops; // سيتم التوسع لاحقاً
  }
  static optimizeStopsForFuel(stops) {
    // تحسين المحطات لتقليل استهلاك الوقود
    return this.optimizeStopSequence(stops, {});
  }
}
module.exports = RouteOptimizationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSb3V0ZU9wdGltaXphdGlvblNlcnZpY2UiLCJvcHRpbWl6ZVJvdXRlIiwicm91dGUiLCJvcHRpb25zIiwic2NvcmUiLCJzdWdnZXN0aW9ucyIsImVzdGltYXRlZEltcHJvdmVtZW50cyIsImNvbnNpZGVyVHJhZmZpYyIsImNvbnNpZGVyUGFzc2VuZ2VyRGVtYW5kIiwiY29uc2lkZXJGdWVsRWZmaWNpZW5jeSIsImNvbnNpZGVyVGltZUVmZmljaWVuY3kiLCJvcHRpbWl6YXRpb24iLCJ0cmFmZmljQW5hbHlzaXMiLCJhbmFseXplVHJhZmZpYyIsInB1c2giLCJkZW1hbmRBbmFseXNpcyIsImFuYWx5emVQYXNzZW5nZXJEZW1hbmQiLCJmdWVsQW5hbHlzaXMiLCJhbmFseXplRnVlbEVmZmljaWVuY3kiLCJ0aW1lQW5hbHlzaXMiLCJhbmFseXplVGltZUVmZmljaWVuY3kiLCJkaXZpc29yIiwiTWF0aCIsIm1pbiIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJ0eXBlIiwiZGVzY3JpcHRpb24iLCJlc3RpbWF0ZWRJbXByb3ZlbWVudCIsImNhbGN1bGF0ZVNob3J0ZXN0UGF0aCIsInN0b3BzIiwic3RhcnRQb2ludCIsImdyYXBoIiwiYnVpbGRHcmFwaCIsImRpc3RhbmNlcyIsInZpc2l0ZWQiLCJTZXQiLCJwcmV2aW91cyIsInBhdGgiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsIm5vZGUiLCJJbmZpbml0eSIsImlkIiwic2l6ZSIsImxlbmd0aCIsImNsb3Nlc3ROb2RlIiwic2hvcnRlc3REaXN0YW5jZSIsImhhcyIsImFkZCIsIm5laWdoYm9yIiwiZGlzdGFuY2UiLCJjdXJyZW50IiwidW5zaGlmdCIsInRvdGFsRGlzdGFuY2UiLCJvcHRpbWl6ZWQiLCJvcHRpbWl6ZVN0b3BTZXF1ZW5jZSIsInZlaGljbGUiLCJvcHRpbWl6ZWRTdG9wcyIsInJlbWFpbmluZyIsImN1cnJlbnRMb2NhdGlvbiIsImdwc0RldmljZSIsImNvb3JkaW5hdGVzIiwibmVhcmVzdEluZGV4IiwibmVhcmVzdERpc3RhbmNlIiwic3RvcCIsImluZGV4IiwiY2FsY3VsYXRlRGlzdGFuY2UiLCJsb2NhdGlvbiIsIm5lYXJlc3QiLCJzcGxpY2UiLCJhbmFseXNpcyIsInRyYWZmaWNEYXRhIiwic2ltdWxhdGVUcmFmZmljRGF0YSIsImNvbmdlc3Rpb25MZXZlbCIsInByaW9yaXR5IiwicGVha0hvdXJzIiwib2NjdXBhbmN5UmF0ZSIsInBhc3NlbmdlcnMiLCJjYXBhY2l0eSIsInRvdGFsIiwic3RvcEFuYWx5c2lzIiwiYW5hbHl6ZVN0b3BVc2FnZSIsInVudXNlZFN0b3BzIiwiYXZnRGlzdGFuY2UiLCJzdG9wQ291bnQiLCJlc3RpbWF0ZWREdXJhdGlvbiIsImF2Z1N0b3BUaW1lIiwicG9pbnQxIiwicG9pbnQyIiwibG9uMSIsImxhdDEiLCJsb24yIiwibGF0MiIsIlIiLCJkTGF0IiwidG9SYWQiLCJkTG9uIiwiYSIsInNpbiIsImNvcyIsImMiLCJhdGFuMiIsInNxcnQiLCJkZWdyZWVzIiwiUEkiLCJpIiwib3RoZXJTdG9wIiwiaiIsImhvdXIiLCJEYXRlIiwiZ2V0SG91cnMiLCJpc1BlYWtIb3VyIiwiYXZlcmFnZVNwZWVkIiwidW5kZXJ1dGlsaXplZFN0b3BzIiwicGFzc2VuZ2VyQ291bnQiLCJ0b3RhbFN0b3BzIiwic3VnZ2VzdEFsdGVybmF0aXZlUm91dGVzIiwicGFzc2VuZ2VyTmVlZHMiLCJhbHRlcm5hdGl2ZXMiLCJmYXN0Um91dGUiLCJuYW1lIiwiZXN0aW1hdGVkVGltZSIsInJvdW5kIiwicmVkdWNlU3RvcHMiLCJjb21wcmVoZW5zaXZlUm91dGUiLCJleHBhbmRTdG9wcyIsImVjb25vbWljUm91dGUiLCJvcHRpbWl6ZVN0b3BzRm9yRnVlbCIsInBlcmNlbnRhZ2UiLCJrZWVwQ291bnQiLCJjZWlsIiwic29ydCIsImIiLCJzbGljZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyb3V0ZU9wdGltaXphdGlvbi5zZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDYrtiv2YXYqSDYqtit2LPZitmGINin2YTZhdiz2KfYsdin2Kog2KfZhNiw2YPZitipXHJcbiAqIFNtYXJ0IFJvdXRlIE9wdGltaXphdGlvbiBTZXJ2aWNlXHJcbiAqL1xyXG5cclxuY2xhc3MgUm91dGVPcHRpbWl6YXRpb25TZXJ2aWNlIHtcclxuICAvKipcclxuICAgKiDYrtmI2KfYsdiy2YXZitipINiq2K3Ys9mK2YYg2KfZhNmF2LPYp9ixINio2YbYp9ih2Ysg2LnZhNmJINi52K/YqSDYudmI2KfZhdmEXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHJvdXRlIC0g2KfZhNmF2LPYp9ixINin2YTYrdin2YTZilxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0g2K7Zitin2LHYp9iqINin2YTYqtit2LPZitmGXHJcbiAgICogQHJldHVybnMge09iamVjdH0gLSDYp9mE2YXYs9in2LEg2KfZhNmF2K3Ys9mR2YYg2YXYuSDYp9mE2KrZiNi12YrYp9iqXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIG9wdGltaXplUm91dGUocm91dGUsIG9wdGlvbnMgPSB7fSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCFyb3V0ZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzY29yZTogMCxcclxuICAgICAgICAgIHN1Z2dlc3Rpb25zOiBbXSxcclxuICAgICAgICAgIGVzdGltYXRlZEltcHJvdmVtZW50czoge30sXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qge1xyXG4gICAgICAgIGNvbnNpZGVyVHJhZmZpYyA9IHRydWUsXHJcbiAgICAgICAgY29uc2lkZXJQYXNzZW5nZXJEZW1hbmQgPSB0cnVlLFxyXG4gICAgICAgIGNvbnNpZGVyRnVlbEVmZmljaWVuY3kgPSB0cnVlLFxyXG4gICAgICAgIGNvbnNpZGVyVGltZUVmZmljaWVuY3kgPSB0cnVlLFxyXG4gICAgICB9ID0gb3B0aW9ucztcclxuXHJcbiAgICAgIGNvbnN0IG9wdGltaXphdGlvbiA9IHtcclxuICAgICAgICBzY29yZTogMCxcclxuICAgICAgICBzdWdnZXN0aW9uczogW10sXHJcbiAgICAgICAgZXN0aW1hdGVkSW1wcm92ZW1lbnRzOiB7fSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIDEuINiq2K3ZhNmK2YQg2K3YsdmD2Kkg2KfZhNmF2LHZiNixXHJcbiAgICAgIGlmIChjb25zaWRlclRyYWZmaWMpIHtcclxuICAgICAgICBjb25zdCB0cmFmZmljQW5hbHlzaXMgPSBhd2FpdCB0aGlzLmFuYWx5emVUcmFmZmljKHJvdXRlKTtcclxuICAgICAgICBpZiAodHJhZmZpY0FuYWx5c2lzKSB7XHJcbiAgICAgICAgICBvcHRpbWl6YXRpb24uc3VnZ2VzdGlvbnMucHVzaCguLi4odHJhZmZpY0FuYWx5c2lzLnN1Z2dlc3Rpb25zIHx8IFtdKSk7XHJcbiAgICAgICAgICBvcHRpbWl6YXRpb24uc2NvcmUgKz0gdHJhZmZpY0FuYWx5c2lzLnNjb3JlIHx8IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyAyLiDYqtit2YTZitmEINi32YTYqCDYp9mE2LHZg9in2KhcclxuICAgICAgaWYgKGNvbnNpZGVyUGFzc2VuZ2VyRGVtYW5kKSB7XHJcbiAgICAgICAgY29uc3QgZGVtYW5kQW5hbHlzaXMgPSB0aGlzLmFuYWx5emVQYXNzZW5nZXJEZW1hbmQocm91dGUpO1xyXG4gICAgICAgIGlmIChkZW1hbmRBbmFseXNpcykge1xyXG4gICAgICAgICAgb3B0aW1pemF0aW9uLnN1Z2dlc3Rpb25zLnB1c2goLi4uKGRlbWFuZEFuYWx5c2lzLnN1Z2dlc3Rpb25zIHx8IFtdKSk7XHJcbiAgICAgICAgICBvcHRpbWl6YXRpb24uc2NvcmUgKz0gZGVtYW5kQW5hbHlzaXMuc2NvcmUgfHwgMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIDMuINiq2K3Ys9mK2YYg2KfYs9iq2YfZhNin2YMg2KfZhNmI2YLZiNivXHJcbiAgICAgIGlmIChjb25zaWRlckZ1ZWxFZmZpY2llbmN5KSB7XHJcbiAgICAgICAgY29uc3QgZnVlbEFuYWx5c2lzID0gdGhpcy5hbmFseXplRnVlbEVmZmljaWVuY3kocm91dGUpO1xyXG4gICAgICAgIGlmIChmdWVsQW5hbHlzaXMpIHtcclxuICAgICAgICAgIG9wdGltaXphdGlvbi5zdWdnZXN0aW9ucy5wdXNoKC4uLihmdWVsQW5hbHlzaXMuc3VnZ2VzdGlvbnMgfHwgW10pKTtcclxuICAgICAgICAgIG9wdGltaXphdGlvbi5zY29yZSArPSBmdWVsQW5hbHlzaXMuc2NvcmUgfHwgMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIDQuINiq2K3Ys9mK2YYg2KfZhNmI2YLYqlxyXG4gICAgICBpZiAoY29uc2lkZXJUaW1lRWZmaWNpZW5jeSkge1xyXG4gICAgICAgIGNvbnN0IHRpbWVBbmFseXNpcyA9IHRoaXMuYW5hbHl6ZVRpbWVFZmZpY2llbmN5KHJvdXRlKTtcclxuICAgICAgICBpZiAodGltZUFuYWx5c2lzKSB7XHJcbiAgICAgICAgICBvcHRpbWl6YXRpb24uc3VnZ2VzdGlvbnMucHVzaCguLi4odGltZUFuYWx5c2lzLnN1Z2dlc3Rpb25zIHx8IFtdKSk7XHJcbiAgICAgICAgICBvcHRpbWl6YXRpb24uc2NvcmUgKz0gdGltZUFuYWx5c2lzLnNjb3JlIHx8IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDYrdiz2KfYqCDYp9mE2YbYqtmK2KzYqSDYp9mE2YbZh9in2KbZitipXHJcbiAgICAgIGNvbnN0IGRpdmlzb3IgPSAoY29uc2lkZXJUcmFmZmljID8gMSA6IDApICsgKGNvbnNpZGVyUGFzc2VuZ2VyRGVtYW5kID8gMSA6IDApICsgKGNvbnNpZGVyRnVlbEVmZmljaWVuY3kgPyAxIDogMCkgKyAoY29uc2lkZXJUaW1lRWZmaWNpZW5jeSA/IDEgOiAwKTtcclxuICAgICAgb3B0aW1pemF0aW9uLnNjb3JlID0gZGl2aXNvciA+IDAgPyBNYXRoLm1pbigxMDAsIG9wdGltaXphdGlvbi5zY29yZSAvIGRpdmlzb3IpIDogMDtcclxuXHJcbiAgICAgIHJldHVybiBvcHRpbWl6YXRpb247XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdSb3V0ZSBvcHRpbWl6YXRpb24gZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc2NvcmU6IDAsXHJcbiAgICAgICAgc3VnZ2VzdGlvbnM6IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgdHlwZTogJ29wdGltaXphdGlvbl9mYWlsZWQnLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ9mB2LTZhCDYqtit2LPZitmGINin2YTZhdiz2KfYsTogJyArIGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgIGVzdGltYXRlZEltcHJvdmVtZW50OiAwLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdLFxyXG4gICAgICAgIGVzdGltYXRlZEltcHJvdmVtZW50czoge30sXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYrtmI2KfYsdiy2YXZitipINil2YrYrNin2K8g2KPZgti12LEg2YXYs9in2LEgKERpamtzdHJhJ3MgQWxnb3JpdGhtKVxyXG4gICAqIEBwYXJhbSB7QXJyYXl9IHN0b3BzIC0g2YbZgtin2Lcg2KfZhNiq2YjZgtmBXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHN0YXJ0UG9pbnQgLSDZhtmC2LfYqSDYp9mE2KjYr9in2YrYqVxyXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IC0g2KfZhNmF2LPYp9ixINin2YTYo9mF2KvZhFxyXG4gICAqL1xyXG4gIHN0YXRpYyBjYWxjdWxhdGVTaG9ydGVzdFBhdGgoc3RvcHMsIHN0YXJ0UG9pbnQpIHtcclxuICAgIGNvbnN0IGdyYXBoID0gdGhpcy5idWlsZEdyYXBoKHN0b3BzKTtcclxuICAgIGNvbnN0IGRpc3RhbmNlcyA9IHt9O1xyXG4gICAgY29uc3QgdmlzaXRlZCA9IG5ldyBTZXQoKTtcclxuICAgIGNvbnN0IHByZXZpb3VzID0ge307XHJcbiAgICBjb25zdCBwYXRoID0gW107XHJcblxyXG4gICAgLy8g2KrZh9mK2KbYqSDYp9mE2YXYs9in2YHYp9iqXHJcbiAgICBPYmplY3Qua2V5cyhncmFwaCkuZm9yRWFjaChub2RlID0+IHtcclxuICAgICAgZGlzdGFuY2VzW25vZGVdID0gSW5maW5pdHk7XHJcbiAgICAgIHByZXZpb3VzW25vZGVdID0gbnVsbDtcclxuICAgIH0pO1xyXG4gICAgZGlzdGFuY2VzW3N0YXJ0UG9pbnQuaWRdID0gMDtcclxuXHJcbiAgICB3aGlsZSAodmlzaXRlZC5zaXplIDwgT2JqZWN0LmtleXMoZ3JhcGgpLmxlbmd0aCkge1xyXG4gICAgICAvLyDYpdmK2KzYp9ivINin2YTYudmC2K/YqSDYp9mE2KPZgtix2Kgg2LrZitixINin2YTZhdiy2KfYsdipXHJcbiAgICAgIGxldCBjbG9zZXN0Tm9kZSA9IG51bGw7XHJcbiAgICAgIGxldCBzaG9ydGVzdERpc3RhbmNlID0gSW5maW5pdHk7XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IG5vZGUgaW4gZGlzdGFuY2VzKSB7XHJcbiAgICAgICAgaWYgKCF2aXNpdGVkLmhhcyhub2RlKSAmJiBkaXN0YW5jZXNbbm9kZV0gPCBzaG9ydGVzdERpc3RhbmNlKSB7XHJcbiAgICAgICAgICBjbG9zZXN0Tm9kZSA9IG5vZGU7XHJcbiAgICAgICAgICBzaG9ydGVzdERpc3RhbmNlID0gZGlzdGFuY2VzW25vZGVdO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFjbG9zZXN0Tm9kZSkgYnJlYWs7XHJcblxyXG4gICAgICB2aXNpdGVkLmFkZChjbG9zZXN0Tm9kZSk7XHJcblxyXG4gICAgICAvLyDYqtit2K/ZitirINin2YTZhdiz2KfZgdin2Kog2YTZhNi52YLYryDYp9mE2YXYrNin2YjYsdipXHJcbiAgICAgIGZvciAoY29uc3QgbmVpZ2hib3IgaW4gZ3JhcGhbY2xvc2VzdE5vZGVdKSB7XHJcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBkaXN0YW5jZXNbY2xvc2VzdE5vZGVdICsgZ3JhcGhbY2xvc2VzdE5vZGVdW25laWdoYm9yXTtcclxuXHJcbiAgICAgICAgaWYgKGRpc3RhbmNlIDwgZGlzdGFuY2VzW25laWdoYm9yXSkge1xyXG4gICAgICAgICAgZGlzdGFuY2VzW25laWdoYm9yXSA9IGRpc3RhbmNlO1xyXG4gICAgICAgICAgcHJldmlvdXNbbmVpZ2hib3JdID0gY2xvc2VzdE5vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g2KjZhtin2KEg2KfZhNmF2LPYp9ixXHJcbiAgICBsZXQgY3VycmVudCA9IHN0b3BzW3N0b3BzLmxlbmd0aCAtIDFdLmlkO1xyXG4gICAgd2hpbGUgKGN1cnJlbnQpIHtcclxuICAgICAgcGF0aC51bnNoaWZ0KGN1cnJlbnQpO1xyXG4gICAgICBjdXJyZW50ID0gcHJldmlvdXNbY3VycmVudF07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcGF0aCxcclxuICAgICAgdG90YWxEaXN0YW5jZTogZGlzdGFuY2VzW3N0b3BzW3N0b3BzLmxlbmd0aCAtIDFdLmlkXSxcclxuICAgICAgb3B0aW1pemVkOiB0cnVlLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiu2YjYp9ix2LLZhdmK2Kkg2KrYrdiz2YrZhiDYqtix2KrZitioINin2YTZhdit2LfYp9iqXHJcbiAgICogQHBhcmFtIHtBcnJheX0gc3RvcHMgLSDYp9mE2YXYrdi32KfYqlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB2ZWhpY2xlIC0g2KfZhNmF2LHZg9io2KlcclxuICAgKiBAcmV0dXJucyB7QXJyYXl9IC0g2KfZhNmF2K3Yt9in2Kog2KfZhNmF2K3Ys9mG2KlcclxuICAgKi9cclxuICBzdGF0aWMgb3B0aW1pemVTdG9wU2VxdWVuY2Uoc3RvcHMsIHZlaGljbGUpIHtcclxuICAgIC8vINiu2YjYp9ix2LLZhdmK2Kkg2KfZhNis2KfYsSDYp9mE2KPZgtix2KggKE5lYXJlc3QgTmVpZ2hib3IpXHJcbiAgICBjb25zdCBvcHRpbWl6ZWRTdG9wcyA9IFtdO1xyXG4gICAgY29uc3QgcmVtYWluaW5nID0gWy4uLnN0b3BzXTtcclxuICAgIGxldCBjdXJyZW50TG9jYXRpb24gPSB2ZWhpY2xlLmdwc0RldmljZT8uY3VycmVudExvY2F0aW9uPy5jb29yZGluYXRlcyB8fCBbMCwgMF07XHJcblxyXG4gICAgd2hpbGUgKHJlbWFpbmluZy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGxldCBuZWFyZXN0SW5kZXggPSAwO1xyXG4gICAgICBsZXQgbmVhcmVzdERpc3RhbmNlID0gSW5maW5pdHk7XHJcblxyXG4gICAgICAvLyDYpdmK2KzYp9ivINij2YLYsdioINmF2K3Yt9ipXHJcbiAgICAgIHJlbWFpbmluZy5mb3JFYWNoKChzdG9wLCBpbmRleCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRpc3RhbmNlID0gdGhpcy5jYWxjdWxhdGVEaXN0YW5jZShjdXJyZW50TG9jYXRpb24sIHN0b3AubG9jYXRpb24uY29vcmRpbmF0ZXMpO1xyXG5cclxuICAgICAgICBpZiAoZGlzdGFuY2UgPCBuZWFyZXN0RGlzdGFuY2UpIHtcclxuICAgICAgICAgIG5lYXJlc3REaXN0YW5jZSA9IGRpc3RhbmNlO1xyXG4gICAgICAgICAgbmVhcmVzdEluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IG5lYXJlc3QgPSByZW1haW5pbmcuc3BsaWNlKG5lYXJlc3RJbmRleCwgMSlbMF07XHJcbiAgICAgIG9wdGltaXplZFN0b3BzLnB1c2gobmVhcmVzdCk7XHJcbiAgICAgIGN1cnJlbnRMb2NhdGlvbiA9IG5lYXJlc3QubG9jYXRpb24uY29vcmRpbmF0ZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG9wdGltaXplZFN0b3BzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KrYrdmE2YrZhCDYrdix2YPYqSDYp9mE2YXYsdmI2LEgKNmF2K3Yp9mD2KfYqSAtINmK2YXZg9mGINiv2YXYrCDZhdi5IEFQSSDYrtin2LHYrNmKKVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBhbmFseXplVHJhZmZpYyhyb3V0ZSkge1xyXG4gICAgY29uc3QgYW5hbHlzaXMgPSB7XHJcbiAgICAgIHNjb3JlOiA3MCxcclxuICAgICAgc3VnZ2VzdGlvbnM6IFtdLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDZhdit2KfZg9in2Kkg2KjZitin2YbYp9iqINit2LHZg9ipINin2YTZhdix2YjYsVxyXG4gICAgY29uc3QgdHJhZmZpY0RhdGEgPSB0aGlzLnNpbXVsYXRlVHJhZmZpY0RhdGEocm91dGUpO1xyXG5cclxuICAgIGlmICh0cmFmZmljRGF0YS5jb25nZXN0aW9uTGV2ZWwgPiAwLjcpIHtcclxuICAgICAgYW5hbHlzaXMuc3VnZ2VzdGlvbnMucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ3RyYWZmaWNfYWx0ZXJuYXRpdmUnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn2KfZgtiq2LHYp9itINmF2LPYp9ixINio2K/ZitmEINmE2KrYrNmG2Kgg2KfZhNin2LLYr9it2KfZhSDYp9mE2YXYsdmI2LHZiicsXHJcbiAgICAgICAgZXN0aW1hdGVkSW1wcm92ZW1lbnQ6IDE1LFxyXG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhbmFseXNpcy5zY29yZSAtPSAyMDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHJhZmZpY0RhdGEucGVha0hvdXJzKSB7XHJcbiAgICAgIGFuYWx5c2lzLnN1Z2dlc3Rpb25zLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICd0aW1lX2FkanVzdG1lbnQnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn2KrYudiv2YrZhCDZhdmI2KfYudmK2K8g2KfZhNix2K3ZhNin2Kog2YTYqtis2YbYqCDYs9in2LnYp9iqINin2YTYsNix2YjYqScsXHJcbiAgICAgICAgZXN0aW1hdGVkSW1wcm92ZW1lbnQ6IDEwLFxyXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcclxuICAgICAgfSk7XHJcbiAgICAgIGFuYWx5c2lzLnNjb3JlIC09IDEwO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhbmFseXNpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiq2K3ZhNmK2YQg2LfZhNioINin2YTYsdmD2KfYqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBhbmFseXplUGFzc2VuZ2VyRGVtYW5kKHJvdXRlKSB7XHJcbiAgICBjb25zdCBhbmFseXNpcyA9IHtcclxuICAgICAgc2NvcmU6IDgwLFxyXG4gICAgICBzdWdnZXN0aW9uczogW10sXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IG9jY3VwYW5jeVJhdGUgPSAocm91dGUucGFzc2VuZ2Vycz8ubGVuZ3RoIHx8IDApIC8gKHJvdXRlLmNhcGFjaXR5Py50b3RhbCB8fCAxKTtcclxuXHJcbiAgICBpZiAob2NjdXBhbmN5UmF0ZSA8IDAuNSkge1xyXG4gICAgICBhbmFseXNpcy5zdWdnZXN0aW9ucy5wdXNoKHtcclxuICAgICAgICB0eXBlOiAncmVkdWNlX2ZyZXF1ZW5jeScsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICfYqtmC2YTZitmEINi52K/YryDYp9mE2LHYrdmE2KfYqiDYo9mIINiv2YXYrCDZhdiz2KfYsdin2Kog2YLZhNmK2YTYqSDYp9mE2KfYs9iq2K7Yr9in2YUnLFxyXG4gICAgICAgIGVzdGltYXRlZEltcHJvdmVtZW50OiAyMCxcclxuICAgICAgICBwcmlvcml0eTogJ2xvdycsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhbmFseXNpcy5zY29yZSAtPSAxNTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob2NjdXBhbmN5UmF0ZSA+IDAuOSkge1xyXG4gICAgICBhbmFseXNpcy5zdWdnZXN0aW9ucy5wdXNoKHtcclxuICAgICAgICB0eXBlOiAnaW5jcmVhc2VfY2FwYWNpdHknLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn2LLZitin2K/YqSDYudiv2K8g2KfZhNmF2LHZg9io2KfYqiDYo9mIINin2LPYqtiu2K/Yp9mFINmF2LHZg9io2KfYqiDYo9mD2KjYsScsXHJcbiAgICAgICAgZXN0aW1hdGVkSW1wcm92ZW1lbnQ6IDI1LFxyXG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhbmFseXNpcy5zY29yZSAtPSAxMDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDYqtit2YTZitmEINiq2YjYstmK2Lkg2KfZhNix2YPYp9ioINi52YTZiSDYp9mE2YXYrdi32KfYqlxyXG4gICAgY29uc3Qgc3RvcEFuYWx5c2lzID0gdGhpcy5hbmFseXplU3RvcFVzYWdlKHJvdXRlLnN0b3BzKTtcclxuICAgIGlmIChzdG9wQW5hbHlzaXMudW51c2VkU3RvcHMgPiAwKSB7XHJcbiAgICAgIGFuYWx5c2lzLnN1Z2dlc3Rpb25zLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICdyZW1vdmVfc3RvcHMnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBg2KXYstin2YTYqSAke3N0b3BBbmFseXNpcy51bnVzZWRTdG9wc30g2YXYrdi32Kkg2LrZitixINmF2LPYqtiu2K/ZhdipYCxcclxuICAgICAgICBlc3RpbWF0ZWRJbXByb3ZlbWVudDogMTAsXHJcbiAgICAgICAgcHJpb3JpdHk6ICdtZWRpdW0nLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYW5hbHlzaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtit2YTZitmEINmD2YHYp9ih2Kkg2KfYs9iq2YfZhNin2YMg2KfZhNmI2YLZiNivXHJcbiAgICovXHJcbiAgc3RhdGljIGFuYWx5emVGdWVsRWZmaWNpZW5jeShyb3V0ZSkge1xyXG4gICAgY29uc3QgYW5hbHlzaXMgPSB7XHJcbiAgICAgIHNjb3JlOiA3NSxcclxuICAgICAgc3VnZ2VzdGlvbnM6IFtdLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBhdmdEaXN0YW5jZSA9IHJvdXRlLnRvdGFsRGlzdGFuY2UgfHwgMDtcclxuICAgIGNvbnN0IHN0b3BDb3VudCA9IHJvdXRlLnN0b3BzPy5sZW5ndGggfHwgMDtcclxuXHJcbiAgICAvLyDYqtit2YTZitmEINi52K/YryDZhtmC2KfYtyDYp9mE2KrZiNmC2YFcclxuICAgIGlmIChzdG9wQ291bnQgPiAxNSkge1xyXG4gICAgICBhbmFseXNpcy5zdWdnZXN0aW9ucy5wdXNoKHtcclxuICAgICAgICB0eXBlOiAnY29uc29saWRhdGVfc3RvcHMnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn2K/ZhdisINin2YTZhdit2LfYp9iqINin2YTZgtix2YrYqNipINmE2KrZgtmE2YrZhCDYudiv2K8g2KfZhNiq2YjZgtmB2KfYqicsXHJcbiAgICAgICAgZXN0aW1hdGVkSW1wcm92ZW1lbnQ6IDEyLFxyXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcclxuICAgICAgfSk7XHJcbiAgICAgIGFuYWx5c2lzLnNjb3JlIC09IDEwO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINiq2K3ZhNmK2YQg2KfZhNmF2LPYp9mB2Kkg2KfZhNmD2YTZitipXHJcbiAgICBpZiAoYXZnRGlzdGFuY2UgPiA1MCkge1xyXG4gICAgICBhbmFseXNpcy5zdWdnZXN0aW9ucy5wdXNoKHtcclxuICAgICAgICB0eXBlOiAnb3B0aW1pemVfZGlzdGFuY2UnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn2KrYrdiz2YrZhiDYp9mE2YXYs9in2LEg2YTYqtmC2YTZitmEINin2YTZhdiz2KfZgdipINin2YTZg9mE2YrYqScsXHJcbiAgICAgICAgZXN0aW1hdGVkSW1wcm92ZW1lbnQ6IDE1LFxyXG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhbmFseXNpcy5zY29yZSAtPSAxNTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYW5hbHlzaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtit2YTZitmEINmD2YHYp9ih2Kkg2KfZhNmI2YLYqlxyXG4gICAqL1xyXG4gIHN0YXRpYyBhbmFseXplVGltZUVmZmljaWVuY3kocm91dGUpIHtcclxuICAgIGNvbnN0IGFuYWx5c2lzID0ge1xyXG4gICAgICBzY29yZTogODUsXHJcbiAgICAgIHN1Z2dlc3Rpb25zOiBbXSxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgZXN0aW1hdGVkRHVyYXRpb24gPSByb3V0ZS5lc3RpbWF0ZWREdXJhdGlvbiB8fCAwO1xyXG4gICAgY29uc3Qgc3RvcENvdW50ID0gcm91dGUuc3RvcHM/Lmxlbmd0aCB8fCAwO1xyXG4gICAgY29uc3QgYXZnU3RvcFRpbWUgPSBlc3RpbWF0ZWREdXJhdGlvbiAvIChzdG9wQ291bnQgfHwgMSk7XHJcblxyXG4gICAgaWYgKGF2Z1N0b3BUaW1lID4gNSkge1xyXG4gICAgICBhbmFseXNpcy5zdWdnZXN0aW9ucy5wdXNoKHtcclxuICAgICAgICB0eXBlOiAncmVkdWNlX3dhaXRfdGltZScsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICfYqtmC2YTZitmEINmI2YLYqiDYp9mE2KfZhtiq2LjYp9ixINmB2Yog2KfZhNmF2K3Yt9in2KonLFxyXG4gICAgICAgIGVzdGltYXRlZEltcHJvdmVtZW50OiAxMCxcclxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhbmFseXNpcy5zY29yZSAtPSAxMDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYW5hbHlzaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYrdiz2KfYqCDYp9mE2YXYs9in2YHYqSDYqNmK2YYg2YbZgti32KrZitmGIChIYXZlcnNpbmUgRm9ybXVsYSlcclxuICAgKi9cclxuICBzdGF0aWMgY2FsY3VsYXRlRGlzdGFuY2UocG9pbnQxLCBwb2ludDIpIHtcclxuICAgIGNvbnN0IFtsb24xLCBsYXQxXSA9IHBvaW50MTtcclxuICAgIGNvbnN0IFtsb24yLCBsYXQyXSA9IHBvaW50MjtcclxuXHJcbiAgICBjb25zdCBSID0gNjM3MTsgLy8g2YbYtdmBINmC2LfYsSDYp9mE2KPYsdi2INio2KfZhNmD2YrZhNmI2YXYqtixXHJcbiAgICBjb25zdCBkTGF0ID0gdGhpcy50b1JhZChsYXQyIC0gbGF0MSk7XHJcbiAgICBjb25zdCBkTG9uID0gdGhpcy50b1JhZChsb24yIC0gbG9uMSk7XHJcblxyXG4gICAgY29uc3QgYSA9XHJcbiAgICAgIE1hdGguc2luKGRMYXQgLyAyKSAqIE1hdGguc2luKGRMYXQgLyAyKSArXHJcbiAgICAgIE1hdGguY29zKHRoaXMudG9SYWQobGF0MSkpICpcclxuICAgICAgICBNYXRoLmNvcyh0aGlzLnRvUmFkKGxhdDIpKSAqXHJcbiAgICAgICAgTWF0aC5zaW4oZExvbiAvIDIpICpcclxuICAgICAgICBNYXRoLnNpbihkTG9uIC8gMik7XHJcblxyXG4gICAgY29uc3QgYyA9IDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEgLSBhKSk7XHJcbiAgICByZXR1cm4gUiAqIGM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtit2YjZitmEINin2YTYr9ix2KzYp9iqINil2YTZiSDYsdin2K/Zitin2YZcclxuICAgKi9cclxuICBzdGF0aWMgdG9SYWQoZGVncmVlcykge1xyXG4gICAgcmV0dXJuIGRlZ3JlZXMgKiAoTWF0aC5QSSAvIDE4MCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqNmG2KfYoSDYsdiz2YUg2KjZitin2YbZiiDZhdmGINin2YTZhdit2LfYp9iqXHJcbiAgICovXHJcbiAgc3RhdGljIGJ1aWxkR3JhcGgoc3RvcHMpIHtcclxuICAgIGNvbnN0IGdyYXBoID0ge307XHJcblxyXG4gICAgc3RvcHMuZm9yRWFjaCgoc3RvcCwgaSkgPT4ge1xyXG4gICAgICBncmFwaFtzdG9wLmlkXSA9IHt9O1xyXG5cclxuICAgICAgc3RvcHMuZm9yRWFjaCgob3RoZXJTdG9wLCBqKSA9PiB7XHJcbiAgICAgICAgaWYgKGkgIT09IGopIHtcclxuICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gdGhpcy5jYWxjdWxhdGVEaXN0YW5jZShcclxuICAgICAgICAgICAgc3RvcC5sb2NhdGlvbi5jb29yZGluYXRlcyxcclxuICAgICAgICAgICAgb3RoZXJTdG9wLmxvY2F0aW9uLmNvb3JkaW5hdGVzXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgZ3JhcGhbc3RvcC5pZF1bb3RoZXJTdG9wLmlkXSA9IGRpc3RhbmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZ3JhcGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDZhdit2KfZg9in2Kkg2KjZitin2YbYp9iqINit2LHZg9ipINin2YTZhdix2YjYsVxyXG4gICAqL1xyXG4gIHN0YXRpYyBzaW11bGF0ZVRyYWZmaWNEYXRhKHJvdXRlKSB7XHJcbiAgICBjb25zdCBob3VyID0gbmV3IERhdGUoKS5nZXRIb3VycygpO1xyXG4gICAgY29uc3QgaXNQZWFrSG91ciA9IChob3VyID49IDcgJiYgaG91ciA8PSA5KSB8fCAoaG91ciA+PSAxNiAmJiBob3VyIDw9IDE4KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBjb25nZXN0aW9uTGV2ZWw6IGlzUGVha0hvdXIgPyAwLjggOiAwLjMsXHJcbiAgICAgIHBlYWtIb3VyczogaXNQZWFrSG91cixcclxuICAgICAgYXZlcmFnZVNwZWVkOiBpc1BlYWtIb3VyID8gMzAgOiA2MCxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtit2YTZitmEINin2LPYqtiu2K/Yp9mFINin2YTZhdit2LfYp9iqXHJcbiAgICovXHJcbiAgc3RhdGljIGFuYWx5emVTdG9wVXNhZ2Uoc3RvcHMpIHtcclxuICAgIGxldCB1bnVzZWRTdG9wcyA9IDA7XHJcbiAgICBsZXQgdW5kZXJ1dGlsaXplZFN0b3BzID0gMDtcclxuXHJcbiAgICBzdG9wcy5mb3JFYWNoKHN0b3AgPT4ge1xyXG4gICAgICBjb25zdCBwYXNzZW5nZXJDb3VudCA9IHN0b3AucGFzc2VuZ2Vycz8ubGVuZ3RoIHx8IDA7XHJcblxyXG4gICAgICBpZiAocGFzc2VuZ2VyQ291bnQgPT09IDApIHtcclxuICAgICAgICB1bnVzZWRTdG9wcysrO1xyXG4gICAgICB9IGVsc2UgaWYgKHBhc3NlbmdlckNvdW50IDwgMikge1xyXG4gICAgICAgIHVuZGVydXRpbGl6ZWRTdG9wcysrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB1bnVzZWRTdG9wcyxcclxuICAgICAgdW5kZXJ1dGlsaXplZFN0b3BzLFxyXG4gICAgICB0b3RhbFN0b3BzOiBzdG9wcy5sZW5ndGgsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KfZgtiq2LHYp9itINmF2LPYp9ix2KfYqiDYqNiv2YrZhNipXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHN1Z2dlc3RBbHRlcm5hdGl2ZVJvdXRlcyhyb3V0ZSwgcGFzc2VuZ2VyTmVlZHMpIHtcclxuICAgIGNvbnN0IGFsdGVybmF0aXZlcyA9IFtdO1xyXG5cclxuICAgIC8vINin2YTZhdiz2KfYsSDYp9mE2LPYsdmK2LlcclxuICAgIGNvbnN0IGZhc3RSb3V0ZSA9IHtcclxuICAgICAgbmFtZTogJ9in2YTZhdiz2KfYsSDYp9mE2LPYsdmK2LknLFxyXG4gICAgICB0eXBlOiAnZmFzdCcsXHJcbiAgICAgIGVzdGltYXRlZFRpbWU6IE1hdGgucm91bmQocm91dGUuZXN0aW1hdGVkRHVyYXRpb24gKiAwLjgpLFxyXG4gICAgICBzdG9wczogdGhpcy5yZWR1Y2VTdG9wcyhyb3V0ZS5zdG9wcywgMC41KSxcclxuICAgICAgc2NvcmU6IDg1LFxyXG4gICAgfTtcclxuICAgIGFsdGVybmF0aXZlcy5wdXNoKGZhc3RSb3V0ZSk7XHJcblxyXG4gICAgLy8g2KfZhNmF2LPYp9ixINin2YTYtNin2YXZhFxyXG4gICAgY29uc3QgY29tcHJlaGVuc2l2ZVJvdXRlID0ge1xyXG4gICAgICBuYW1lOiAn2KfZhNmF2LPYp9ixINin2YTYtNin2YXZhCcsXHJcbiAgICAgIHR5cGU6ICdjb21wcmVoZW5zaXZlJyxcclxuICAgICAgZXN0aW1hdGVkVGltZTogTWF0aC5yb3VuZChyb3V0ZS5lc3RpbWF0ZWREdXJhdGlvbiAqIDEuMiksXHJcbiAgICAgIHN0b3BzOiB0aGlzLmV4cGFuZFN0b3BzKHJvdXRlLnN0b3BzLCBwYXNzZW5nZXJOZWVkcyksXHJcbiAgICAgIHNjb3JlOiA5MCxcclxuICAgIH07XHJcbiAgICBhbHRlcm5hdGl2ZXMucHVzaChjb21wcmVoZW5zaXZlUm91dGUpO1xyXG5cclxuICAgIC8vINin2YTZhdiz2KfYsSDYp9mE2KfZgtiq2LXYp9iv2YpcclxuICAgIGNvbnN0IGVjb25vbWljUm91dGUgPSB7XHJcbiAgICAgIG5hbWU6ICfYp9mE2YXYs9in2LEg2KfZhNin2YLYqti12KfYr9mKJyxcclxuICAgICAgdHlwZTogJ2Vjb25vbWljJyxcclxuICAgICAgZXN0aW1hdGVkVGltZTogcm91dGUuZXN0aW1hdGVkRHVyYXRpb24sXHJcbiAgICAgIHN0b3BzOiB0aGlzLm9wdGltaXplU3RvcHNGb3JGdWVsKHJvdXRlLnN0b3BzKSxcclxuICAgICAgc2NvcmU6IDgwLFxyXG4gICAgfTtcclxuICAgIGFsdGVybmF0aXZlcy5wdXNoKGVjb25vbWljUm91dGUpO1xyXG5cclxuICAgIHJldHVybiBhbHRlcm5hdGl2ZXM7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcmVkdWNlU3RvcHMoc3RvcHMsIHBlcmNlbnRhZ2UpIHtcclxuICAgIGNvbnN0IGtlZXBDb3VudCA9IE1hdGguY2VpbChzdG9wcy5sZW5ndGggKiBwZXJjZW50YWdlKTtcclxuICAgIHJldHVybiBzdG9wc1xyXG4gICAgICAuc29ydCgoYSwgYikgPT4gKGIucGFzc2VuZ2Vycz8ubGVuZ3RoIHx8IDApIC0gKGEucGFzc2VuZ2Vycz8ubGVuZ3RoIHx8IDApKVxyXG4gICAgICAuc2xpY2UoMCwga2VlcENvdW50KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBleHBhbmRTdG9wcyhzdG9wcywgcGFzc2VuZ2VyTmVlZHMpIHtcclxuICAgIC8vINil2LbYp9mB2Kkg2YXYrdi32KfYqiDYrNiv2YrYr9ipINio2YbYp9ih2Ysg2LnZhNmJINin2K3YqtmK2KfYrNin2Kog2KfZhNix2YPYp9ioXHJcbiAgICByZXR1cm4gc3RvcHM7IC8vINiz2YrYqtmFINin2YTYqtmI2LPYuSDZhNin2K3Zgtin2YtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBvcHRpbWl6ZVN0b3BzRm9yRnVlbChzdG9wcykge1xyXG4gICAgLy8g2KrYrdiz2YrZhiDYp9mE2YXYrdi32KfYqiDZhNiq2YLZhNmK2YQg2KfYs9iq2YfZhNin2YMg2KfZhNmI2YLZiNivXHJcbiAgICByZXR1cm4gdGhpcy5vcHRpbWl6ZVN0b3BTZXF1ZW5jZShzdG9wcywge30pO1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBSb3V0ZU9wdGltaXphdGlvblNlcnZpY2U7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsd0JBQXdCLENBQUM7RUFDN0I7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0UsYUFBYUMsYUFBYUEsQ0FBQ0MsS0FBSyxFQUFFQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUU7SUFDOUMsSUFBSTtNQUNGLElBQUksQ0FBQ0QsS0FBSyxFQUFFO1FBQ1YsT0FBTztVQUNMRSxLQUFLLEVBQUUsQ0FBQztVQUNSQyxXQUFXLEVBQUUsRUFBRTtVQUNmQyxxQkFBcUIsRUFBRSxDQUFDO1FBQzFCLENBQUM7TUFDSDtNQUVBLE1BQU07UUFDSkMsZUFBZSxHQUFHLElBQUk7UUFDdEJDLHVCQUF1QixHQUFHLElBQUk7UUFDOUJDLHNCQUFzQixHQUFHLElBQUk7UUFDN0JDLHNCQUFzQixHQUFH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