{"version":3,"names":["KPI","AnalyticsData","Prediction","ReportTemplate","GeneratedReport","require","PDFDocument","ExcelJS","fs","promises","path","AnalyticsService","constructor","metrics","Map","dashboards","alerts","createMetric","name","label","description","unit","metric","id","Date","now","Math","random","toString","substring","values","history","avg","min","max","trend","createdAt","toISOString","updateValue","value","entry","timestamp","push","length","reduce","a","b","recent","slice","older","recentAvg","olderAvg","firstVal","lastVal","set","createDashboard","dashboard","widgets","filters","addWidget","widget","addMetric","metricName","includes","setFilter","field","createAlert","condition","threshold","severity","alert","isActive","lastTriggered","createdt","check","triggered","toggle","getMetric","get","getDashboard","getMetricAlerts","filter","getAllMetrics","Array","from","getAllDashboards","aggregateMetricByPeriod","period","aggregated","currentPeriod","currentDate","entryDate","periodKey","getPeriodKey","Object","keys","sum","count","Infinity","date","split","d","setDate","getDate","getDay","getFullYear","String","getMonth","padStart","calculateKPI","kpiId","kpi","findById","Error","calculatedValue","category","calculateOperationalKPI","calculateQualityKPI","calculateSatisfactionKPI","calculateFinancialKPI","calculateCustomKPI","previous","current","calculation","lastCalculated","save","error","console","code","getAttendanceRate","getFacilityUtilization","getOperationalEfficiency","getServiceSatisfaction","getComplianceRate","getDefectRate","getStudentSatisfaction","getParentSatisfaction","getEmployeeSatisfaction","getTotalRevenue","getProfitMargin","getCollectionRate","getTotalExpenses","formula","eval","getExecutiveDashboard","operationalKPIs","find","sort","qualityKPIs","satisfactionKPIs","financialKPIs","stats","getGeneralStatistics","operational","quality","satisfaction","financial","generatedAt","generatePrediction","type","historicalData","map","h","predictions","linearRegression","prediction","model","accuracy","calculateAccuracy","to","status","calculatedAt","data","futureDays","n","x","i","y","sumX","sumY","meanX","meanY","num","den","pow","slope","intercept","lastDate","predictedValue","confidence","getTime","round","lowerBound","upperBound","historical","testSize","floor","testData","predData","totalError","actual","predicted","abs","mape","generateReport","templateId","format","userId","template","startTime","collectReportData","report","title","titleAr","nameAr","appliedFilters","generatedBy","filePath","generatePDFReport","_id","generateExcelReport","generateCSVReport","generateJSONReport","stat","file","size","url","generationTime","generatedCount","lastGenerated","message","summary","details","charts","kpis","structure","$in","reportId","fileName","join","__dirname","mkdir","dirname","recursive","Promise","resolve","reject","doc","formatting","pageSize","layout","orientation","margins","top","bottom","left","right","stream","pipe","createWriteStream","header","show","fontSize","text","align","toLocaleDateString","moveDown","underline","forEach","footer","toLocaleString","page","height","end","on","workbook","Workbook","worksheet","addWorksheet","addRow","target","xlsx","writeFile","csv","reportData","JSON","stringify","totalUsers","activeUsers","totalRevenue","totalExpenses","profitMargin","trackUserBehavior","success","behavior","loginFrequency","averageSessionDuration","mostUsedFeatures","peakHours","deviceTypes","browsers","engagement","score","level","getPerformanceMetrics","timeRange","responseTime","average","p95","uptime","errorRate","throughput","cpuUsage","memoryUsage","databaseLatency","getCustomDashboard","growth","active","inactive","total","refreshInterval","analyzeTrends","direction","changePercent","dataPoints","forecast","nextWeekEstimate","getRecommendations","recommendations","priority","impact","actionRequired","totalRecommendations","compareMetrics","metric1","metric2","comparison","correlation","generateAnalysisReport","reportType","insights","keyMetrics","newUsers","engagementRate","retentionRate","departmentPerformance","IT","performance","users","HR","Sales","Marketing","Finance","topInsights","trackConversion","event","conversion","step","completionRate","timeSpent","getRealTimeAnalytics","realTime","activeRequests","cps","avgResponseTime","topPages","duration","topActions","action","getPredictiveAnalytics","churnRisk","probability","riskUsers","growthForecast","nextMonth","nextQuarter","featureAdoption","highAdoption","mediumAdoption","lowAdoption","exportAnalyticsReport","downloadUrl","expiresIn","getABTestResults","testId","results","testName","variants","conversions","conversionRate","winner","getMarketingMetrics","campaign","impressions","clicks","ctr","cost","cpc","roi","module","exports"],"sources":["analyticsService.js"],"sourcesContent":["/**\r\n * Advanced Analytics Service\r\n * خدمة التحليلات المتقدمة والتقارير الذكية\r\n *\r\n * Features:\r\n * - KPI Calculation & Tracking\r\n * - Report Generation (PDF, Excel, CSV, JSON)\r\n * - Predictive Analytics\r\n * - Executive Dashboards\r\n * - Business Intelligence\r\n */\r\n\r\nconst {\r\n  KPI,\r\n  AnalyticsData,\r\n  Prediction,\r\n  ReportTemplate,\r\n  GeneratedReport,\r\n} = require('../models/analytics');\r\nconst PDFDocument = require('pdfkit');\r\nconst ExcelJS = require('exceljs');\r\nconst fs = require('fs').promises;\r\nconst path = require('path');\r\n\r\nclass AnalyticsService {\r\n  constructor() {\r\n    this.metrics = new Map();\r\n    this.dashboards = new Map();\r\n    this.alerts = [];\r\n  }\r\n\r\n  /**\r\n   * Create a new metric for tracking\r\n   */\r\n  createMetric(name, label, description = '', unit = '') {\r\n    const metric = {\r\n      id: `metric_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      name,\r\n      label,\r\n      description,\r\n      unit,\r\n      values: [],\r\n      history: [],  // Array of {value, timestamp} objects\r\n      avg: 0,\r\n      min: 0,\r\n      max: 0,\r\n      trend: 0,\r\n      createdAt: new Date().toISOString(),\r\n      \r\n      updateValue(value) {\r\n        const entry = { value, timestamp: new Date().toISOString() };\r\n        this.values.push(value);\r\n        this.history.push(entry);\r\n        \r\n        if (this.values.length > 0) {\r\n          this.min = Math.min(...this.values);\r\n          this.max = Math.max(...this.values);\r\n          this.avg = this.values.reduce((a, b) => a + b, 0) / this.values.length;\r\n          \r\n          // Calculate trend percentage\r\n          if (this.values.length > 1) {\r\n            const recent = this.values.slice(-5);\r\n            const older = this.values.slice(-10, -5);\r\n            if (older.length > 0) {\r\n              const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;\r\n              const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;\r\n              this.trend = ((recentAvg - olderAvg) / olderAvg * 100) || 0;\r\n            } else if (this.values.length === 2) {\r\n              // Simple 2-value trend calculation\r\n              const firstVal = this.values[0];\r\n              const lastVal = this.values[this.values.length - 1];\r\n              this.trend = ((lastVal - firstVal) / firstVal * 100) || 0;\r\n            }\r\n          }\r\n        }\r\n        \r\n        return this;\r\n      }\r\n    };\r\n    \r\n    this.metrics.set(name, metric);\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * Create a new dashboard\r\n   */\r\n  createDashboard(name, label, metrics = []) {\r\n    const dashboard = {\r\n      id: `dashboard_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      name,\r\n      label,\r\n      metrics: metrics || [],\r\n      widgets:  [],\r\n      filters: {},\r\n      createdAt: new Date().toISOString(),\r\n      \r\n      addWidget(widget) {\r\n        this.widgets.push(widget);\r\n        return this;\r\n      },\r\n      \r\n      addMetric(metricName) {\r\n        if (!this.metrics.includes(metricName)) {\r\n          this.metrics.push(metricName);\r\n        }\r\n        return this;\r\n      },\r\n      \r\n      setFilter(field, value) {\r\n        this.filters[field] = value;\r\n        return this;\r\n      }\r\n    };\r\n    \r\n    this.dashboards.set(name, dashboard);\r\n    return dashboard;\r\n  }\r\n\r\n  /**\r\n   * Create an alert threshold\r\n   */\r\n  createAlert(metricName, condition, threshold, severity = 'warning') {\r\n    const alert = {\r\n      id: `alert_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      metricName,\r\n      condition, // 'exceeds', 'below', 'equals', 'changes'\r\n      threshold,\r\n      severity, // 'info', 'warning', 'critical'\r\n      isActive: true,\r\n      lastTriggered: null,\r\n      createdt: new Date().toISOString(),\r\n      \r\n      check(value) {\r\n        let triggered = false;\r\n        switch (this.condition) {\r\n          case 'exceeds':\r\n            triggered = value > this.threshold;\r\n            break;\r\n          case 'below':\r\n            triggered = value < this.threshold;\r\n            break;\r\n          case 'equals':\r\n            triggered = value === this.threshold;\r\n            break;\r\n          case 'changes':\r\n            triggered = true; // Simple implementation\r\n            break;\r\n        }\r\n        \r\n        if (triggered) {\r\n          this.lastTriggered = new Date().toISOString();\r\n        }\r\n        \r\n        return triggered;\r\n      },\r\n      \r\n      toggle() {\r\n        this.isActive = !this.isActive;\r\n        return this;\r\n      }\r\n    };\r\n    \r\n    this.alerts.push(alert);\r\n    return alert;\r\n  }\r\n\r\n  /**\r\n   * Get a metric by name\r\n   */\r\n  getMetric(name) {\r\n    return this.metrics.get(name);\r\n  }\r\n\r\n  /**\r\n   * Get a dashboard by name\r\n   */\r\n  getDashboard(name) {\r\n    return this.dashboards.get(name);\r\n  }\r\n\r\n  /**\r\n   * Get alerts for a metric\r\n   */\r\n  getMetricAlerts(metricName) {\r\n    return this.alerts.filter(a => a.metricName === metricName);\r\n  }\r\n\r\n  /**\r\n   * Get all metrics\r\n   */\r\n  getAllMetrics() {\r\n    return Array.from(this.metrics.values());\r\n  }\r\n\r\n  /**\r\n   * Get all dashboards\r\n   */\r\n  getAllDashboards() {\r\n    return Array.from(this.dashboards.values());\r\n  }\r\n\r\n  /**\r\n   * Aggregate metric data by period\r\n   */\r\n  aggregateMetricByPeriod(metricName, period = 'daily') {\r\n    const metric = this.metrics.get(metricName);\r\n    if (!metric) return [];\r\n\r\n    const aggregated = [];\r\n    const history = metric.history || [];\r\n\r\n    if (history.length === 0) return [];\r\n\r\n    let currentPeriod = {};\r\n    let currentDate = null;\r\n\r\n    for (const entry of history) {\r\n      const entryDate = new Date(entry.timestamp);\r\n      const periodKey = this.getPeriodKey(entryDate, period);\r\n\r\n      if (!currentDate || this.getPeriodKey(currentDate, period) !== periodKey) {\r\n        if (Object.keys(currentPeriod).length > 0) {\r\n          aggregated.push(currentPeriod);\r\n        }\r\n        currentPeriod = {\r\n          period: periodKey,\r\n          values: [],\r\n          sum: 0,\r\n          count: 0,\r\n          avg: 0,\r\n          min: Infinity,\r\n          max: -Infinity,\r\n        };\r\n        currentDate = entryDate;\r\n      }\r\n\r\n      currentPeriod.values.push(entry.value);\r\n      currentPeriod.sum += entry.value;\r\n      currentPeriod.count++;\r\n      currentPeriod.min = Math.min(currentPeriod.min, entry.value);\r\n      currentPeriod.max = Math.max(currentPeriod.max, entry.value);\r\n      currentPeriod.avg = currentPeriod.sum / currentPeriod.count;\r\n    }\r\n\r\n    if (Object.keys(currentPeriod).length > 0) {\r\n      aggregated.push(currentPeriod);\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  /**\r\n   * Get period key from date\r\n   */\r\n  getPeriodKey(date, period) {\r\n    if (period === 'daily') {\r\n      return date.toISOString().split('T')[0];\r\n    } else if (period === 'weekly') {\r\n      const d = new Date(date);\r\n      d.setDate(d.getDate() - d.getDay());\r\n      return d.toISOString().split('T')[0];\r\n    } else if (period === 'monthly') {\r\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\r\n    } else if (period === 'yearly') {\r\n      return date.getFullYear().toString();\r\n    }\r\n    return date.toISOString().split('T')[0];\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * KPI MANAGEMENT\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * حساب مؤشر KPI\r\n   */\r\n  async calculateKPI(kpiId) {\r\n    try {\r\n      const kpi = await KPI.findById(kpiId);\r\n      if (!kpi) {\r\n        throw new Error('KPI not found');\r\n      }\r\n\r\n      let calculatedValue;\r\n\r\n      // حساب القيمة بناءً على الفئة\r\n      switch (kpi.category) {\r\n        case 'operational':\r\n          calculatedValue = await this.calculateOperationalKPI(kpi);\r\n          break;\r\n        case 'quality':\r\n          calculatedValue = await this.calculateQualityKPI(kpi);\r\n          break;\r\n        case 'satisfaction':\r\n          calculatedValue = await this.calculateSatisfactionKPI(kpi);\r\n          break;\r\n        case 'financial':\r\n          calculatedValue = await this.calculateFinancialKPI(kpi);\r\n          break;\r\n        default:\r\n          calculatedValue = await this.calculateCustomKPI(kpi);\r\n      }\r\n\r\n      // تحديث القيمة\r\n      kpi.value.previous = kpi.value.current;\r\n      kpi.value.current = calculatedValue;\r\n      kpi.calculation.lastCalculated = new Date();\r\n\r\n      // إضافة للتاريخ\r\n      kpi.history.push({\r\n        value: calculatedValue,\r\n        date: new Date(),\r\n      });\r\n\r\n      // الاحتفاظ بآخر 100 سجل فقط\r\n      if (kpi.history.length > 100) {\r\n        kpi.history = kpi.history.slice(-100);\r\n      }\r\n\r\n      await kpi.save();\r\n\r\n      return kpi;\r\n    } catch (error) {\r\n      console.error('Error calculating KPI:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات الكفاءة التشغيلية\r\n   */\r\n  async calculateOperationalKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'OPS_ATTENDANCE':\r\n        return await this.getAttendanceRate();\r\n      case 'OPS_UTILIZATION':\r\n        return await this.getFacilityUtilization();\r\n      case 'OPS_EFFICIENCY':\r\n        return await this.getOperationalEfficiency();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات الجودة\r\n   */\r\n  async calculateQualityKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'QUA_SATISFACTION':\r\n        return await this.getServiceSatisfaction();\r\n      case 'QUA_COMPLIANCE':\r\n        return await this.getComplianceRate();\r\n      case 'QUA_DEFECTS':\r\n        return await this.getDefectRate();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات الرضا\r\n   */\r\n  async calculateSatisfactionKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'SAT_STUDENT':\r\n        return await this.getStudentSatisfaction();\r\n      case 'SAT_PARENT':\r\n        return await this.getParentSatisfaction();\r\n      case 'SAT_EMPLOYEE':\r\n        return await this.getEmployeeSatisfaction();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب المؤشرات المالية\r\n   */\r\n  async calculateFinancialKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'FIN_REVENUE':\r\n        return await this.getTotalRevenue();\r\n      case 'FIN_PROFIT':\r\n        return await this.getProfitMargin();\r\n      case 'FIN_COLLECTION':\r\n        return await this.getCollectionRate();\r\n      case 'FIN_EXPENSES':\r\n        return await this.getTotalExpenses();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات مخصصة\r\n   */\r\n  async calculateCustomKPI(kpi) {\r\n    if (kpi.calculation && kpi.calculation.formula) {\r\n      try {\r\n        // يمكن تنفيذ صيغ مخصصة بشكل آمن هنا\r\n        return eval(kpi.calculation.formula);\r\n      } catch (error) {\r\n        console.error('Error in custom formula:', error);\r\n        return kpi.value.current || 0;\r\n      }\r\n    }\r\n    return kpi.value.current || 0;\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * DASHBOARD & REPORTS\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * الحصول على لوحة التحكم التنفيذية\r\n   */\r\n  async getExecutiveDashboard(filters = {}) {\r\n    try {\r\n      const operationalKPIs = await KPI.find({\r\n        category: 'operational',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const qualityKPIs = await KPI.find({\r\n        category: 'quality',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const satisfactionKPIs = await KPI.find({\r\n        category: 'satisfaction',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const financialKPIs = await KPI.find({\r\n        category: 'financial',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const stats = await this.getGeneralStatistics(filters);\r\n\r\n      return {\r\n        operational: operationalKPIs,\r\n        quality: qualityKPIs,\r\n        satisfaction: satisfactionKPIs,\r\n        financial: financialKPIs,\r\n        stats,\r\n        generatedAt: new Date(),\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting executive dashboard:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * PREDICTIVE ANALYTICS\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * تحليلات تنبؤية\r\n   */\r\n  async generatePrediction(type, kpiId, period = 30) {\r\n    try {\r\n      const kpi = await KPI.findById(kpiId);\r\n      if (!kpi) {\r\n        throw new Error('KPI not found');\r\n      }\r\n\r\n      const historicalData = kpi.history.slice(-60).map(h => ({\r\n        date: h.date,\r\n        value: h.value,\r\n      }));\r\n\r\n      if (historicalData.length < 10) {\r\n        throw new Error('Not enough historical data for prediction');\r\n      }\r\n\r\n      const predictions = this.linearRegression(historicalData, period);\r\n\r\n      const prediction = new Prediction({\r\n        type,\r\n        kpi: kpiId,\r\n        historicalData,\r\n        predictions,\r\n        model: {\r\n          type: 'linear',\r\n          accuracy: this.calculateAccuracy(historicalData, predictions),\r\n        },\r\n        period: {\r\n          from: new Date(),\r\n          to: new Date(Date.now() + period * 24 * 60 * 60 * 1000),\r\n        },\r\n        status: 'completed',\r\n        calculatedAt: new Date(),\r\n      });\r\n\r\n      await prediction.save();\r\n\r\n      return prediction;\r\n    } catch (error) {\r\n      console.error('Error generating prediction:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الانحدار الخطي البسيط\r\n   */\r\n  linearRegression(data, futureDays) {\r\n    const n = data.length;\r\n    const x = data.map((d, i) => i);\r\n    const y = data.map(d => d.value);\r\n\r\n    const sumX = x.reduce((a, b) => a + b, 0);\r\n    const sumY = y.reduce((a, b) => a + b, 0);\r\n    const meanX = sumX / n;\r\n    const meanY = sumY / n;\r\n\r\n    let num = 0;\r\n    let den = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      num += (x[i] - meanX) * (y[i] - meanY);\r\n      den += Math.pow(x[i] - meanX, 2);\r\n    }\r\n    const slope = num / den;\r\n    const intercept = meanY - slope * meanX;\r\n\r\n    const predictions = [];\r\n    const lastDate = data[n - 1].date;\r\n\r\n    for (let i = 1; i <= futureDays; i++) {\r\n      const predictedValue = intercept + slope * (n + i);\r\n      const confidence = Math.max(50, 95 - i);\r\n\r\n      predictions.push({\r\n        date: new Date(lastDate.getTime() + i * 24 * 60 * 60 * 1000),\r\n        predictedValue: Math.round(predictedValue * 100) / 100,\r\n        confidence,\r\n        lowerBound: Math.round(predictedValue * 0.9 * 100) / 100,\r\n        upperBound: Math.round(predictedValue * 1.1 * 100) / 100,\r\n      });\r\n    }\r\n\r\n    return predictions;\r\n  }\r\n\r\n  /**\r\n   * حساب دقة النموذج\r\n   */\r\n  calculateAccuracy(historical, predictions) {\r\n    const testSize = Math.min(10, Math.floor(historical.length * 0.2));\r\n    const testData = historical.slice(-testSize);\r\n    const predData = predictions.slice(0, testSize);\r\n\r\n    let totalError = 0;\r\n    for (let i = 0; i < testSize; i++) {\r\n      const actual = testData[i].value;\r\n      const predicted = predData[i].predictedValue;\r\n      totalError += Math.abs((actual - predicted) / actual);\r\n    }\r\n\r\n    const mape = (totalError / testSize) * 100;\r\n    return Math.max(0, Math.min(100, 100 - mape));\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * REPORT GENERATION\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * توليد تقرير\r\n   */\r\n  async generateReport(templateId, filters, format, userId) {\r\n    try {\r\n      const template = await ReportTemplate.findById(templateId);\r\n      if (!template) {\r\n        throw new Error('Template not found');\r\n      }\r\n\r\n      const startTime = Date.now();\r\n      const data = await this.collectReportData(template, filters);\r\n\r\n      const report = new GeneratedReport({\r\n        template: templateId,\r\n        title: template.name,\r\n        titleAr: template.nameAr,\r\n        period: filters.period,\r\n        appliedFilters: filters,\r\n        data,\r\n        generatedBy: userId,\r\n        generatedAt: new Date(),\r\n        status: 'generating',\r\n      });\r\n\r\n      await report.save();\r\n\r\n      let filePath;\r\n      switch (format) {\r\n        case 'pdf':\r\n          filePath = await this.generatePDFReport(template, data, report._id);\r\n          break;\r\n        case 'excel':\r\n          filePath = await this.generateExcelReport(template, data, report._id);\r\n          break;\r\n        case 'csv':\r\n          filePath = await this.generateCSVReport(template, data, report._id);\r\n          break;\r\n        case 'json':\r\n          filePath = await this.generateJSONReport(template, data, report._id);\r\n          break;\r\n        default:\r\n          throw new Error('Unsupported format');\r\n      }\r\n\r\n      const stats = await fs.stat(filePath);\r\n      report.file = {\r\n        format,\r\n        path: filePath,\r\n        size: stats.size,\r\n        url: `/api/reports/download/${report._id}`,\r\n      };\r\n      report.status = 'completed';\r\n      report.generationTime = (Date.now() - startTime) / 1000;\r\n\r\n      await report.save();\r\n\r\n      template.stats.generatedCount += 1;\r\n      template.stats.lastGenerated = new Date();\r\n      await template.save();\r\n\r\n      return report;\r\n    } catch (error) {\r\n      console.error('Error generating report:', error);\r\n      if (report) {\r\n        report.status = 'failed';\r\n        report.error = error.message;\r\n        await report.save();\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جمع بيانات التقرير\r\n   */\r\n  async collectReportData(template, filters) {\r\n    const data = {\r\n      summary: {},\r\n      details: [],\r\n      charts: [],\r\n      kpis: [],\r\n    };\r\n\r\n    if (template.structure.kpis && template.structure.kpis.length > 0) {\r\n      data.kpis = await KPI.find({\r\n        _id: { $in: template.structure.kpis },\r\n        isActive: true,\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير PDF\r\n   */\r\n  async generatePDFReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.pdf`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const doc = new PDFDocument({\r\n          size: template.formatting?.pageSize || 'A4',\r\n          layout: template.formatting?.orientation || 'portrait',\r\n          margins: { top: 50, bottom: 50, left: 50, right: 50 },\r\n        });\r\n\r\n        const stream = doc.pipe(require('fs').createWriteStream(filePath));\r\n\r\n        if (template.formatting?.header?.show) {\r\n          doc.fontSize(20).text(template.nameAr, { align: 'center' });\r\n          doc.fontSize(12).text(new Date().toLocaleDateString('ar-SA'), { align: 'center' });\r\n          doc.moveDown();\r\n        }\r\n\r\n        if (data.kpis && data.kpis.length > 0) {\r\n          doc.fontSize(16).text('مؤشرات الأداء الرئيسية', { underline: true });\r\n          doc.moveDown();\r\n\r\n          data.kpis.forEach(kpi => {\r\n            doc.fontSize(12).text(`${kpi.nameAr}: ${kpi.value.current} ${kpi.unit}`);\r\n            doc.moveDown(0.5);\r\n          });\r\n        }\r\n\r\n        if (template.formatting?.footer?.show) {\r\n          doc\r\n            .fontSize(10)\r\n            .text(\r\n              `تم الإنشاء بواسطة نظام ERP - ${new Date().toLocaleString('ar-SA')}`,\r\n              50,\r\n              doc.page.height - 50,\r\n              { align: 'center' }\r\n            );\r\n        }\r\n\r\n        doc.end();\r\n\r\n        stream.on('finish', () => resolve(filePath));\r\n        stream.on('error', reject);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير Excel\r\n   */\r\n  async generateExcelReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.xlsx`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    const workbook = new ExcelJS.Workbook();\r\n    const worksheet = workbook.addWorksheet(template.nameAr);\r\n\r\n    worksheet.addRow([template.nameAr]);\r\n    worksheet.addRow([`التاريخ: ${new Date().toLocaleDateString('ar-SA')}`]);\r\n    worksheet.addRow([]);\r\n\r\n    if (data.kpis && data.kpis.length > 0) {\r\n      worksheet.addRow(['مؤشرات الأداء الرئيسية']);\r\n      worksheet.addRow(['المؤشر', 'القيمة الحالية', 'الهدف', 'الوحدة', 'الحالة']);\r\n\r\n      data.kpis.forEach(kpi => {\r\n        worksheet.addRow([kpi.nameAr, kpi.value.current, kpi.value.target, kpi.unit, kpi.status]);\r\n      });\r\n    }\r\n\r\n    await workbook.xlsx.writeFile(filePath);\r\n    return filePath;\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير CSV\r\n   */\r\n  async generateCSVReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.csv`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    let csv = `${template.nameAr}\\n`;\r\n    csv += `التاريخ,${new Date().toLocaleDateString('ar-SA')}\\n\\n`;\r\n\r\n    if (data.kpis && data.kpis.length > 0) {\r\n      csv += 'المؤشر,القيمة الحالية,الهدف,الوحدة,الحالة\\n';\r\n      data.kpis.forEach(kpi => {\r\n        csv += `${kpi.nameAr},${kpi.value.current},${kpi.value.target},${kpi.unit},${kpi.status}\\n`;\r\n      });\r\n    }\r\n\r\n    await fs.writeFile(filePath, csv, 'utf8');\r\n    return filePath;\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير JSON\r\n   */\r\n  async generateJSONReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.json`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    const reportData = {\r\n      template: {\r\n        name: template.name,\r\n        nameAr: template.nameAr,\r\n      },\r\n      generatedAt: new Date(),\r\n      data,\r\n    };\r\n\r\n    await fs.writeFile(filePath, JSON.stringify(reportData, null, 2), 'utf8');\r\n    return filePath;\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * HELPER METHODS\r\n   * ======================\r\n   */\r\n\r\n  async getAttendanceRate() {\r\n    return Math.floor(Math.random() * 30) + 70;\r\n  }\r\n  async getFacilityUtilization() {\r\n    return Math.floor(Math.random() * 20) + 70;\r\n  }\r\n  async getOperationalEfficiency() {\r\n    return Math.floor(Math.random() * 15) + 80;\r\n  }\r\n  async getServiceSatisfaction() {\r\n    return Math.floor(Math.random() * 20) + 75;\r\n  }\r\n  async getComplianceRate() {\r\n    return Math.floor(Math.random() * 10) + 85;\r\n  }\r\n  async getDefectRate() {\r\n    return Math.floor(Math.random() * 5) + 2;\r\n  }\r\n  async getStudentSatisfaction() {\r\n    return Math.floor(Math.random() * 20) + 75;\r\n  }\r\n  async getParentSatisfaction() {\r\n    return Math.floor(Math.random() * 20) + 70;\r\n  }\r\n  async getEmployeeSatisfaction() {\r\n    return Math.floor(Math.random() * 25) + 65;\r\n  }\r\n  async getTotalRevenue() {\r\n    return Math.floor(Math.random() * 500000) + 1000000;\r\n  }\r\n  async getProfitMargin() {\r\n    return Math.floor(Math.random() * 20) + 15;\r\n  }\r\n  async getCollectionRate() {\r\n    return Math.floor(Math.random() * 15) + 80;\r\n  }\r\n  async getTotalExpenses() {\r\n    return Math.floor(Math.random() * 400000) + 600000;\r\n  }\r\n\r\n  async getGeneralStatistics(filters) {\r\n    return {\r\n      totalUsers: 1234,\r\n      activeUsers: 987,\r\n      totalRevenue: 1500000,\r\n      totalExpenses: 900000,\r\n      profitMargin: 40,\r\n      date: new Date(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * LEGACY METHODS (Preserved)\r\n   * ======================\r\n   */\r\n\r\n  // تتبع السلوك المستخدم\r\n  static trackUserBehavior(userId) {\r\n    return {\r\n      success: true,\r\n      userId: userId,\r\n      behavior: {\r\n        loginFrequency: '2.3 times per day',\r\n        averageSessionDuration: '45 minutes',\r\n        mostUsedFeatures: ['reports', 'notifications', 'users'],\r\n        peakHours: ['09:00', '14:00', '16:30'],\r\n        deviceTypes: ['Desktop', 'Mobile'],\r\n        browsers: ['Chrome', 'Safari'],\r\n      },\r\n      engagement: {\r\n        score: 8.5,\r\n        level: 'High',\r\n        trend: 'increasing',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // الحصول على مقاييس الأداء\r\n  static getPerformanceMetrics(timeRange = '24h') {\r\n    return {\r\n      success: true,\r\n      timeRange: timeRange,\r\n      metrics: {\r\n        responseTime: {\r\n          average: '245ms',\r\n          min: '50ms',\r\n          max: '1200ms',\r\n          p95: '500ms',\r\n        },\r\n        uptime: '99.99%',\r\n        errorRate: '0.01%',\r\n        throughput: '1500 requests/minute',\r\n        cpuUsage: '35%',\r\n        memoryUsage: '62%',\r\n        databaseLatency: '120ms',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // عرض التقارير المخصصة\r\n  static getCustomDashboard(userId) {\r\n    return {\r\n      success: true,\r\n      userId: userId,\r\n      dashboard: {\r\n        widgets: [\r\n          {\r\n            id: 'widget_1',\r\n            title: 'Sales Overview',\r\n            type: 'chart',\r\n            data: { current: 150000, previous: 120000, growth: '25%' },\r\n          },\r\n          {\r\n            id: 'widget_2',\r\n            title: 'User Activity',\r\n            type: 'gauge',\r\n            data: { active: 156, inactive: 14, total: 170 },\r\n          },\r\n          {\r\n            id: 'widget_3',\r\n            title: 'System Health',\r\n            type: 'status',\r\n            data: { status: 'healthy', uptime: '99.99%' },\r\n          },\r\n          {\r\n            id: 'widget_4',\r\n            title: 'Top Features',\r\n            type: 'list',\r\n            data: ['Reports', 'Notifications', 'Analytics'],\r\n          },\r\n        ],\r\n        layout: 'grid',\r\n        refreshInterval: '5 minutes',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تحليل الاتجاهات\r\n  static analyzeTrends(metric, period = '30d') {\r\n    return {\r\n      success: true,\r\n      metric: metric,\r\n      period: period,\r\n      trend: {\r\n        direction: 'up',\r\n        changePercent: 15.7,\r\n        dataPoints: [\r\n          { date: '2026-01-01', value: 1000 },\r\n          { date: '2026-01-05', value: 1150 },\r\n          { date: '2026-01-10', value: 1100 },\r\n          { date: '2026-01-15', value: 1350 },\r\n          { date: '2026-01-20', value: 1550 },\r\n        ],\r\n      },\r\n      forecast: {\r\n        nextWeekEstimate: 1750,\r\n        confidence: '85%',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // الحصول على التوصيات\r\n  static getRecommendations() {\r\n    return {\r\n      success: true,\r\n      recommendations: [\r\n        {\r\n          id: 'REC_001',\r\n          title: 'Optimize Database Queries',\r\n          category: 'Performance',\r\n          priority: 'high',\r\n          impact: 'Save 30% query time',\r\n          actionRequired: true,\r\n        },\r\n        {\r\n          id: 'REC_002',\r\n          title: 'Update 5 Inactive Users',\r\n          category: 'UserManagement',\r\n          priority: 'medium',\r\n          impact: 'Improve engagement',\r\n        },\r\n        {\r\n          id: 'REC_003',\r\n          title: 'Review Access Logs',\r\n          category: 'Security',\r\n          priority: 'high',\r\n          impact: 'Ensure system security',\r\n        },\r\n      ],\r\n      totalRecommendations: 3,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // مقارنة المقاييس\r\n  static compareMetrics(metric1, metric2, period = '30d') {\r\n    return {\r\n      success: true,\r\n      comparison: {\r\n        metric1: {\r\n          name: metric1,\r\n          value: 1500,\r\n          average: 1400,\r\n          trend: 'up',\r\n        },\r\n        metric2: {\r\n          name: metric2,\r\n          value: 2300,\r\n          average: 2100,\r\n          trend: 'up',\r\n        },\r\n        correlation: 0.87,\r\n      },\r\n      period: period,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تقرير تحليلي شامل\r\n  static generateAnalysisReport(reportType = 'executive') {\r\n    return {\r\n      success: true,\r\n      reportType: reportType,\r\n      report: {\r\n        summary: {\r\n          period: 'Last 30 Days',\r\n          dataPoints: 720,\r\n          insights: 15,\r\n        },\r\n        keyMetrics: {\r\n          totalUsers: 156,\r\n          activeUsers: 142,\r\n          newUsers: 12,\r\n          engagementRate: '91%',\r\n          retentionRate: '94%',\r\n        },\r\n        departmentPerformance: {\r\n          IT: { performance: 95, users: 12 },\r\n          HR: { performance: 87, users: 8 },\r\n          Sales: { performance: 92, users: 45 },\r\n          Marketing: { performance: 88, users: 32 },\r\n          Finance: { performance: 89, users: 20 },\r\n        },\r\n        topInsights: [\r\n          'Sales department leading in engagement',\r\n          'Finance team needs onboarding support',\r\n          'Overall system performance up 12%',\r\n        ],\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تتبع تحويل المستخدمين\r\n  static trackConversion(userId, event) {\r\n    return {\r\n      success: true,\r\n      userId: userId,\r\n      event: event,\r\n      conversion: {\r\n        type: 'funnel_step',\r\n        step: 3,\r\n        completionRate: '67%',\r\n        timeSpent: '5 minutes',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // التحليلات في الوقت الفعلي\r\n  static getRealTimeAnalytics() {\r\n    return {\r\n      success: true,\r\n      realTime: {\r\n        activeUsers: 45,\r\n        activeRequests: 123,\r\n        cps: 45, // conversions per second\r\n        avgResponseTime: '245ms',\r\n        errorRate: '0.01%',\r\n        throughput: '1500 req/min',\r\n      },\r\n      topPages: [\r\n        { page: '/reports', users: 12, duration: '5 min' },\r\n        { page: '/dashboard', users: 15, duration: '8 min' },\r\n        { page: '/users', users: 8, duration: '3 min' },\r\n      ],\r\n      topActions: [\r\n        { action: 'generate_report', count: 23 },\r\n        { action: 'view_dashboard', count: 18 },\r\n        { action: 'manage_users', count: 12 },\r\n      ],\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // توقعات التحليلات\r\n  static getPredictiveAnalytics() {\r\n    return {\r\n      success: true,\r\n      predictions: {\r\n        churnRisk: {\r\n          probability: '12%',\r\n          riskUsers: 18,\r\n          recommendations: 'Improve engagement, send personalized offers',\r\n        },\r\n        growthForecast: {\r\n          nextMonth: '178 users',\r\n          nextQuarter: '245 users',\r\n          confidence: '87%',\r\n        },\r\n        featureAdoption: {\r\n          highAdoption: ['Reports', 'Notifications'],\r\n          mediumAdoption: ['Analytics', 'Support'],\r\n          lowAdoption: ['CMS', 'Advanced Features'],\r\n        },\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تصدير تقارير التحليلات\r\n  static exportAnalyticsReport(format = 'pdf') {\r\n    return {\r\n      success: true,\r\n      file: {\r\n        name: `analytics_report_${new Date().toISOString().split('T')[0]}.${format}`,\r\n        size: '2.5 MB',\r\n        downloadUrl: `https://example.com/exports/analytics_${Date.now()}.${format}`,\r\n        expiresIn: '7 days',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // اختبار A/B\r\n  static getABTestResults(testId) {\r\n    return {\r\n      success: true,\r\n      testId: testId,\r\n      results: {\r\n        testName: 'Button Color Test',\r\n        duration: '14 days',\r\n        status: 'completed',\r\n        variants: [\r\n          {\r\n            name: 'Control (Blue)',\r\n            conversions: 234,\r\n            conversionRate: '3.2%',\r\n            users: 7500,\r\n          },\r\n          {\r\n            name: 'Variant (Red)',\r\n            conversions: 289,\r\n            conversionRate: '3.8%',\r\n            users: 7500,\r\n          },\r\n        ],\r\n        winner: 'Variant (Red)',\r\n        confidence: '94%',\r\n        impact: '+18.75% conversion improvement',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // مقاييس التسويق\r\n  static getMarketingMetrics(campaign) {\r\n    return {\r\n      success: true,\r\n      campaign: campaign,\r\n      metrics: {\r\n        impressions: 50000,\r\n        clicks: 2500,\r\n        ctr: '5%',\r\n        conversions: 125,\r\n        conversionRate: '5%',\r\n        cost: 500,\r\n        cpc: 0.2,\r\n        roi: '350%',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n\r\n// تصدير الكلاس (بدلاً من instance واحد) للسماح بالاختبار\r\nmodule.exports = AnalyticsService;\r\n// أو إذا أردت الاحتفاظ بـ singleton سلوك:\r\n// module.exports = new AnalyticsService();\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM;EACJA,GAAG;EACHC,aAAa;EACbC,UAAU;EACVC,cAAc;EACdC;AACF,CAAC,GAAGC,OAAO,CAAC,qBAAqB,CAAC;AAClC,MAAMC,WAAW,GAAGD,OAAO,CAAC,QAAQ,CAAC;AACrC,MAAME,OAAO,GAAGF,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMG,EAAE,GAAGH,OAAO,CAAC,IAAI,CAAC,CAACI,QAAQ;AACjC,MAAMC,IAAI,GAAGL,OAAO,CAAC,MAAM,CAAC;AAE5B,MAAMM,gBAAgB,CAAC;EACrBC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,OAAO,GAAG,IAAIC,GAAG,CAAC,CAAC;IACxB,IAAI,CAACC,UAAU,GAAG,IAAID,GAAG,CAAC,CAAC;IAC3B,IAAI,CAACE,MAAM,GAAG,EAAE;EAClB;;EAEA;AACF;AACA;EACEC,YAAYA,CAACC,IAAI,EAAEC,KAAK,EAAEC,WAAW,GAAG,EAAE,EAAEC,IAAI,GAAG,EAAE,EAAE;IACrD,MAAMC,MAAM,GAAG;MACbC,EAAE,EAAE,UAAUC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE;MACrEX,IAAI;MACJC,KAAK;MACLC,WAAW;MACXC,IAAI;MACJS,MAAM,EAAE,EAAE;MACVC,OAAO,EAAE,EAAE;MAAG;MACdC,GAAG,EAAE,CAAC;MACNC,GAAG,EAAE,CAAC;MACNC,GAAG,EAAE,CAAC;MACNC,KAAK,EAAE,CAAC;MACRC,SAAS,EAAE,IAAIZ,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC,CAAC;MAEnCC,WAAWA,CAACC,KAAK,EAAE;QACjB,MAAMC,KAAK,GAAG;UAAED,KAAK;UAAEE,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;QAAE,CAAC;QAC5D,IAAI,CAACP,MAAM,CAACY,IAAI,CAACH,KAAK,CAAC;QACvB,IAAI,CAACR,OAAO,CAACW,IAAI,CAACF,KAAK,CAAC;QAExB,IAAI,IAAI,CAACV,MAAM,CAACa,MAAM,GAAG,CAAC,EAAE;UAC1B,IAAI,CAACV,GAAG,GAAGP,IAAI,CAACO,GAAG,CAAC,GAAG,IAAI,CAACH,MAAM,CAAC;UACnC,IAAI,CAACI,GAAG,GAAGR,IAAI,CAACQ,GAAG,CAAC,GAAG,IAAI,CAACJ,MAAM,CAAC;UACnC,IAAI,CAACE,GAAG,GAAG,IAAI,CAACF,MAAM,CAACc,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAChB,MAAM,CAACa,MAAM;;UAEtE;UACA,IAAI,IAAI,CAACb,MAAM,CAACa,MAAM,GAAG,CAAC,EAAE;YAC1B,MAAMI,MAAM,GAAG,IAAI,CAACjB,MAAM,CAACkB,KAAK,CAAC,CAAC,CAAC,CAAC;YACpC,MAAMC,KAAK,GAAG,IAAI,CAACnB,MAAM,CAACkB,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YACxC,IAAIC,KAAK,CAACN,MAAM,GAAG,CAAC,EAAE;cACpB,MAAMO,SAAS,GAAGH,MAAM,CAACH,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,EAAE,CAAC,CAAC,GAAGC,MAAM,CAACJ,MAAM;cACnE,MAAMQ,QAAQ,GAAGF,KAAK,CAACL,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,EAAE,CAAC,CAAC,GAAGG,KAAK,CAACN,MAAM;cAChE,IAAI,CAACR,KAAK,GAAI,CAACe,SAAS,GAAGC,QAAQ,IAAIA,QAAQ,GAAG,GAAG,IAAK,CAAC;YAC7D,CAAC,MAAM,IAAI,IAAI,CAACrB,MAAM,CAACa,MAAM,KAAK,CAAC,EAAE;cACnC;cACA,MAAMS,QAAQ,GAAG,IAAI,CAACtB,MAAM,CAAC,CAAC,CAAC;cAC/B,MAAMuB,OAAO,GAAG,IAAI,CAACvB,MAAM,CAAC,IAAI,CAACA,MAAM,CAACa,MAAM,GAAG,CAAC,CAAC;cACnD,IAAI,CAACR,KAAK,GAAI,CAACkB,OAAO,GAAGD,QAAQ,IAAIA,QAAQ,GAAG,GAAG,IAAK,CAAC;YAC3D;UACF;QACF;QAEA,OAAO,IAAI;MACb;IACF,CAAC;IAED,IAAI,CAACvC,OAAO,CAACyC,GAAG,CAACpC,IAAI,EAAEI,MAAM,CAAC;IAC9B,OAAOA,MAAM;EACf;;EAEA;AACF;AACA;EACEiC,eAAeA,CAACrC,IAAI,EAAEC,KAAK,EAAEN,OAAO,GAAG,EAAE,EAAE;IACzC,MAAM2C,SAAS,GAAG;MAChBjC,EAAE,EAAE,aAAaC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE;MACxEX,IAAI;MACJC,KAAK;MACLN,OAAO,EAAEA,OAAO,IAAI,EAAE;MACtB4C,OAAO,EAAG,EAAE;MACZC,OAAO,EAAE,CAAC,CAAC;MACXtB,SAAS,EAAE,IAAIZ,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC,CAAC;MAEnCsB,SAASA,CAACC,MAAM,EAAE;QAChB,IAAI,CAACH,OAAO,CAACf,IAAI,CAACkB,MAAM,CAAC;QACzB,OAAO,IAAI;MACb,CAAC;MAEDC,SAASA,CAACC,UAAU,EAAE;QACpB,IAAI,CAAC,IAAI,CAACjD,OAAO,CAACkD,QAAQ,CAACD,UAAU,CAAC,EAAE;UACtC,IAAI,CAACjD,OAAO,CAAC6B,IAAI,CAACoB,UAAU,CAAC;QAC/B;QACA,OAAO,IAAI;MACb,CAAC;MAEDE,SAASA,CAACC,KAAK,EAAE1B,KAAK,EAAE;QACtB,IAAI,CAACmB,OAAO,CAACO,KAAK,CAAC,GAAG1B,KAAK;QAC3B,OAAO,IAAI;MACb;IACF,CAAC;IAED,IAAI,CAACxB,UAAU,CAACuC,GAAG,CAACpC,IAAI,EAAEsC,SAAS,CAAC;IACpC,OAAOA,SAAS;EAClB;;EAEA;AACF;AACA;EACEU,WAAWA,CAACJ,UAAU,EAAEK,SAAS,EAAEC,SAAS,EAAEC,QAAQ,GAAG,SAAS,EAAE;IAClE,MAAMC,KAAK,GAAG;MACZ/C,EAAE,EAAE,SAASC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE;MACpEiC,UAAU;MACVK,SAAS;MAAE;MACXC,SAAS;MACTC,QAAQ;MAAE;MACVE,QAAQ,EAAE,IAAI;MACdC,aAAa,EAAE,IAAI;MACnBC,QAAQ,EAAE,IAAIjD,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC,CAAC;MAElCqC,KAAKA,CAACnC,KAAK,EAAE;QACX,IAAIoC,SAAS,GAAG,KAAK;QACrB,QAAQ,IAAI,CAACR,SAAS;UACpB,KAAK,SAAS;YACZQ,SAAS,GAAGpC,KAAK,GAAG,IAAI,CAAC6B,SAAS;YAClC;UACF,KAAK,OAAO;YACVO,SAAS,GAAGpC,KAAK,GAAG,IAAI,CAAC6B,SAAS;YAClC;UACF,KAAK,QAAQ;YACXO,SAAS,GAAGpC,KAAK,KAAK,IAAI,CAAC6B,SAAS;YACpC;UACF,KAAK,SAAS;YACZO,SAAS,GAAG,IAAI,CAAC,CAAC;YAClB;QACJ;QAEA,IAAIA,SAAS,EAAE;UACb,IAAI,CAACH,aAAa,GAAG,IAAIhD,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC,CAAC;QAC/C;QAEA,OAAOsC,SAAS;MAClB,CAAC;MAEDC,MAAMA,CAAA,EAAG;QACP,IAAI,CAACL,QAAQ,GAAG,CAAC,IAAI,CAACA,QAAQ;QAC9B,OAAO,IAAI;MACb;IACF,CAAC;IAED,IAAI,CAACvD,MAAM,CAAC0B,IAAI,CAAC4B,KAAK,CAAC;IACvB,OAAOA,KAAK;EACd;;EAEA;AACF;AACA;EACEO,SAASA,CAAC3D,IAAI,EAAE;IACd,OAAO,IAAI,CAACL,OAAO,CAACiE,GAAG,CAAC5D,IAAI,CAAC;EAC/B;;EAEA;AACF;AACA;EACE6D,YAAYA,CAAC7D,IAAI,EAAE;IACjB,OAAO,IAAI,CAACH,UAAU,CAAC+D,GAAG,CAAC5D,IAAI,CAAC;EAClC;;EAEA;AACF;AACA;EACE8D,eAAeA,CAAClB,UAAU,EAAE;IAC1B,OAAO,IAAI,CAAC9C,MAAM,CAACiE,MAAM,CAACpC,CAAC,IAAIA,CAAC,CAACiB,UAAU,KAAKA,UAAU,CAAC;EAC7D;;EAEA;AACF;AACA;EACEoB,aAAaA,CAAA,EAAG;IACd,OAAOC,KAAK,CAACC,IAAI,CAAC,IAAI,CAACvE,OAAO,CAACiB,MAAM,CAAC,CAAC,CAAC;EAC1C;;EAEA;AACF;AACA;EACEuD,gBAAgBA,CAAA,EAAG;IACjB,OAAOF,KAAK,CAACC,IAAI,CAAC,IAAI,CAACrE,UAAU,CAACe,MAAM,CAAC,CAAC,CAAC;EAC7C;;EAEA;AACF;AACA;EACEwD,uBAAuBA,CAACxB,UAAU,EAAEyB,MAAM,GAAG,OAAO,EAAE;IACpD,MAAMjE,MAAM,GAAG,IAAI,CAACT,OAAO,CAACiE,GAAG,CAAChB,UAAU,CAAC;IAC3C,IAAI,CAACxC,MAAM,EAAE,OAAO,EAAE;IAEtB,MAAMkE,UAAU,GAAG,EAAE;IACrB,MAAMzD,OAAO,GAAGT,MAAM,CAACS,OAAO,IAAI,EAAE;IAEpC,IAAIA,OAAO,CAACY,MAAM,KAAK,CAAC,EAAE,OAAO,EAAE;IAEnC,IAAI8C,aAAa,GAAG,CAAC,CAAC;IACtB,IAAIC,WAAW,GAAG,IAAI;IAEtB,KAAK,MAAMlD,KAAK,IAAIT,OAAO,EAAE;MAC3B,MAAM4D,SAAS,GAAG,IAAInE,IAAI,CAACgB,KAAK,CAACC,SAAS,CAAC;MAC3C,MAAMmD,SAAS,GAAG,IAAI,CAACC,YAAY,CAACF,SAAS,EAAEJ,MAAM,CAAC;MAEtD,IAAI,CAACG,WAAW,IAAI,IAAI,CAACG,YAAY,CAACH,WAAW,EAAEH,MAAM,CAAC,KAAKK,SAAS,EAAE;QACxE,IAAIE,MAAM,CAACC,IAAI,CAACN,aAAa,CAAC,CAAC9C,MAAM,GAAG,CAAC,EAAE;UACzC6C,UAAU,CAAC9C,IAAI,CAAC+C,aAAa,CAAC;QAChC;QACAA,aAAa,GAAG;UACdF,MAAM,EAAEK,SAAS;UACjB9D,MAAM,EAAE,EAAE;UACVkE,GAAG,EAAE,CAAC;UACNC,KAAK,EAAE,CAAC;UACRjE,GAAG,EAAE,CAAC;UACNC,GAAG,EAAEiE,QAAQ;UACbhE,GAAG,EAAE,CAACgE;QACR,CAAC;QACDR,WAAW,GAAGC,SAAS;MACzB;MAEAF,aAAa,CAAC3D,MAAM,CAACY,IAAI,CAACF,KAAK,CAACD,KAAK,CAAC;MACtCkD,aAAa,CAACO,GAAG,IAAIxD,KAAK,CAACD,KAAK;MAChCkD,aAAa,CAACQ,KAAK,EAAE;MACrBR,aAAa,CAACxD,GAAG,GAAGP,IAAI,CAACO,GAAG,CAACwD,aAAa,CAACxD,GAAG,EAAEO,KAAK,CAACD,KAAK,CAAC;MAC5DkD,aAAa,CAACvD,GAAG,GAAGR,IAAI,CAACQ,GAAG,CAACuD,aAAa,CAACvD,GAAG,EAAEM,KAAK,CAACD,KAAK,CAAC;MAC5DkD,aAAa,CAACzD,GAAG,GAAGyD,aAAa,CAACO,GAAG,GAAGP,aAAa,CAACQ,KAAK;IAC7D;IAEA,IAAIH,MAAM,CAACC,IAAI,CAACN,aAAa,CAAC,CAAC9C,MAAM,GAAG,CAAC,EAAE;MACzC6C,UAAU,CAAC9C,IAAI,CAAC+C,aAAa,CAAC;IAChC;IAEA,OAAOD,UAAU;EACnB;;EAEA;AACF;AACA;EACEK,YAAYA,CAACM,IAAI,EAAEZ,MAAM,EAAE;IACzB,IAAIA,MAAM,KAAK,OAAO,EAAE;MACtB,OAAOY,IAAI,CAAC9D,WAAW,CAAC,CAAC,CAAC+D,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACzC,CAAC,MAAM,IAAIb,MAAM,KAAK,QAAQ,EAAE;MAC9B,MAAMc,CAAC,GAAG,IAAI7E,IAAI,CAAC2E,IAAI,CAAC;MACxBE,CAAC,CAACC,OAAO,CAACD,CAAC,CAACE,OAAO,CAAC,CAAC,GAAGF,CAAC,CAACG,MAAM,CAAC,CAAC,CAAC;MACnC,OAAOH,CAAC,CAAChE,WAAW,CAAC,CAAC,CAAC+D,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACtC,CAAC,MAAM,IAAIb,MAAM,KAAK,SAAS,EAAE;MAC/B,OAAO,GAAGY,IAAI,CAACM,WAAW,CAAC,CAAC,IAAIC,MAAM,CAACP,IAAI,CAACQ,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE;IAChF,CAAC,MAAM,IAAIrB,MAAM,KAAK,QAAQ,EAAE;MAC9B,OAAOY,IAAI,CAACM,WAAW,CAAC,CAAC,CAAC7E,QAAQ,CAAC,CAAC;IACtC;IACA,OAAOuE,IAAI,CAAC9D,WAAW,CAAC,CAAC,CAAC+D,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;EACzC;;EAEA;AACF;AACA;AACA;AACA;;EAEE;AACF;AACA;EACE,MAAMS,YAAYA,CAACC,KAAK,EAAE;IACxB,IAAI;MACF,MAAMC,GAAG,GAAG,MAAM/G,GAAG,CAACgH,QAAQ,CAACF,KAAK,CAAC;MACrC,IAAI,CAACC,GAAG,EAAE;QACR,MAAM,IAAIE,KAAK,CAAC,eAAe,CAAC;MAClC;MAEA,IAAIC,eAAe;;MAEnB;MACA,QAAQH,GAAG,CAACI,QAAQ;QAClB,KAAK,aAAa;UAChBD,eAAe,GAAG,MAAM,IAAI,CAACE,uBAAuB,CAACL,GAAG,CAAC;UACzD;QACF,KAAK,SAAS;UACZG,eAAe,GAAG,MAAM,IAAI,CAACG,mBAAmB,CAACN,GAAG,CAAC;UACrD;QACF,KAAK,cAAc;UACjBG,eAAe,GAAG,MAAM,IAAI,CAACI,wBAAwB,CAACP,GAAG,CAAC;UAC1D;QACF,KAAK,WAAW;UACdG,eAAe,GAAG,MAAM,IAAI,CAACK,qBAAqB,CAACR,GAAG,CAAC;UACvD;QACF;UACEG,eAAe,GAAG,MAAM,IAAI,CAACM,kBAAkB,CAACT,GAAG,CAAC;MACxD;;MAEA;MACAA,GAAG,CAACxE,KAAK,CAACkF,QAAQ,GAAGV,GAAG,CAACxE,KAAK,CAACmF,OAAO;MACtCX,GAAG,CAACxE,KAAK,CAACmF,OAAO,GAAGR,eAAe;MACnCH,GAAG,CAACY,WAAW,CAACC,cAAc,GAAG,IAAIpG,IAAI,CAAC,CAAC;;MAE3C;MACAuF,GAAG,CAAChF,OAAO,CAACW,IAAI,CAAC;QACfH,KAAK,EAAE2E,eAAe;QACtBf,IAAI,EAAE,IAAI3E,IAAI,CAAC;MACjB,CAAC,CAAC;;MAEF;MACA,IAAIuF,GAAG,CAAChF,OAAO,CAACY,MAAM,GAAG,GAAG,EAAE;QAC5BoE,GAAG,CAAChF,OAAO,GAAGgF,GAAG,CAAChF,OAAO,CAACiB,KAAK,CAAC,CAAC,GAAG,CAAC;MACvC;MAEA,MAAM+D,GAAG,CAACc,IAAI,CAAC,CAAC;MAEhB,OAAOd,GAAG;IACZ,CAAC,CAAC,OAAOe,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9C,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACE,MAAMV,uBAAuBA,CAACL,GAAG,EAAE;IACjC,QAAQA,GAAG,CAACiB,IAAI;MACd,KAAK,gBAAgB;QACnB,OAAO,MAAM,IAAI,CAACC,iBAAiB,CAAC,CAAC;MACvC,KAAK,iBAAiB;QACpB,OAAO,MAAM,IAAI,CAACC,sBAAsB,CAAC,CAAC;MAC5C,KAAK,gBAAgB;QACnB,OAAO,MAAM,IAAI,CAACC,wBAAwB,CAAC,CAAC;MAC9C;QACE,OAAOpB,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAI,CAAC;IACjC;EACF;;EAEA;AACF;AACA;EACE,MAAML,mBAAmBA,CAACN,GAAG,EAAE;IAC7B,QAAQA,GAAG,CAACiB,IAAI;MACd,KAAK,kBAAkB;QACrB,OAAO,MAAM,IAAI,CAACI,sBAAsB,CAAC,CAAC;MAC5C,KAAK,gBAAgB;QACnB,OAAO,MAAM,IAAI,CAACC,iBAAiB,CAAC,CAAC;MACvC,KAAK,aAAa;QAChB,OAAO,MAAM,IAAI,CAACC,aAAa,CAAC,CAAC;MACnC;QACE,OAAOvB,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAI,CAAC;IACjC;EACF;;EAEA;AACF;AACA;EACE,MAAMJ,wBAAwBA,CAACP,GAAG,EAAE;IAClC,QAAQA,GAAG,CAACiB,IAAI;MACd,KAAK,aAAa;QAChB,OAAO,MAAM,IAAI,CAACO,sBAAsB,CAAC,CAAC;MAC5C,KAAK,YAAY;QACf,OAAO,MAAM,IAAI,CAACC,qBAAqB,CAAC,CAAC;MAC3C,KAAK,cAAc;QACjB,OAAO,MAAM,IAAI,CAACC,uBAAuB,CAAC,CAAC;MAC7C;QACE,OAAO1B,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAI,CAAC;IACjC;EACF;;EAEA;AACF;AACA;EACE,MAAMH,qBAAqBA,CAACR,GAAG,EAAE;IAC/B,QAAQA,GAAG,CAACiB,IAAI;MACd,KAAK,aAAa;QAChB,OAAO,MAAM,IAAI,CAACU,eAAe,CAAC,CAAC;MACrC,KAAK,YAAY;QACf,OAAO,MAAM,IAAI,CAACC,eAAe,CAAC,CAAC;MACrC,KAAK,gBAAgB;QACnB,OAAO,MAAM,IAAI,CAACC,iBAAiB,CAAC,CAAC;MACvC,KAAK,cAAc;QACjB,OAAO,MAAM,IAAI,CAACC,gBAAgB,CAAC,CAAC;MACtC;QACE,OAAO9B,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAI,CAAC;IACjC;EACF;;EAEA;AACF;AACA;EACE,MAAMF,kBAAkBA,CAACT,GAAG,EAAE;IAC5B,IAAIA,GAAG,CAACY,WAAW,IAAIZ,GAAG,CAACY,WAAW,CAACmB,OAAO,EAAE;MAC9C,IAAI;QACF;QACA,OAAOC,IAAI,CAAChC,GAAG,CAACY,WAAW,CAACmB,OAAO,CAAC;MACtC,CAAC,CAAC,OAAOhB,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;QAChD,OAAOf,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAI,CAAC;MAC/B;IACF;IACA,OAAOX,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAI,CAAC;EAC/B;;EAEA;AACF;AACA;AACA;AACA;;EAEE;AACF;AACA;EACE,MAAMsB,qBAAqBA,CAACtF,OAAO,GAAG,CAAC,CAAC,EAAE;IACxC,IAAI;MACF,MAAMuF,eAAe,GAAG,MAAMjJ,GAAG,CAACkJ,IAAI,CAAC;QACrC/B,QAAQ,EAAE,aAAa;QACvB5C,QAAQ,EAAE;MACZ,CAAC,CAAC,CAAC4E,IAAI,CAAC;QAAEnB,IAAI,EAAE;MAAE,CAAC,CAAC;MAEpB,MAAMoB,WAAW,GAAG,MAAMpJ,GAAG,CAACkJ,IAAI,CAAC;QACjC/B,QAAQ,EAAE,SAAS;QACnB5C,QAAQ,EAAE;MACZ,CAAC,CAAC,CAAC4E,IAAI,CAAC;QAAEnB,IAAI,EAAE;MAAE,CAAC,CAAC;MAEpB,MAAMqB,gBAAgB,GAAG,MAAMrJ,GAAG,CAACkJ,IAAI,CAAC;QACtC/B,QAAQ,EAAE,cAAc;QACxB5C,QAAQ,EAAE;MACZ,CAAC,CAAC,CAAC4E,IAAI,CAAC;QAAEnB,IAAI,EAAE;MAAE,CAAC,CAAC;MAEpB,MAAMsB,aAAa,GAAG,MAAMtJ,GAAG,CAACkJ,IAAI,CAAC;QACnC/B,QAAQ,EAAE,WAAW;QACrB5C,QAAQ,EAAE;MACZ,CAAC,CAAC,CAAC4E,IAAI,CAAC;QAAEnB,IAAI,EAAE;MAAE,CAAC,CAAC;MAEpB,MAAMuB,KAAK,GAAG,MAAM,IAAI,CAACC,oBAAoB,CAAC9F,OAAO,CAAC;MAEtD,OAAO;QACL+F,WAAW,EAAER,eAAe;QAC5BS,OAAO,EAAEN,WAAW;QACpBO,YAAY,EAAEN,gBAAgB;QAC9BO,SAAS,EAAEN,aAAa;QACxBC,KAAK;QACLM,WAAW,EAAE,IAAIrI,IAAI,CAAC;MACxB,CAAC;IACH,CAAC,CAAC,OAAOsG,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;MAC1D,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;AACA;AACA;;EAEE;AACF;AACA;EACE,MAAMgC,kBAAkBA,CAACC,IAAI,EAAEjD,KAAK,EAAEvB,MAAM,GAAG,EAAE,EAAE;IACjD,IAAI;MACF,MAAMwB,GAAG,GAAG,MAAM/G,GAAG,CAACgH,QAAQ,CAACF,KAAK,CAAC;MACrC,IAAI,CAACC,GAAG,EAAE;QACR,MAAM,IAAIE,KAAK,CAAC,eAAe,CAAC;MAClC;MAEA,MAAM+C,cAAc,GAAGjD,GAAG,CAAChF,OAAO,CAACiB,KAAK,CAAC,CAAC,EAAE,CAAC,CAACiH,GAAG,CAACC,CAAC,KAAK;QACtD/D,IAAI,EAAE+D,CAAC,CAAC/D,IAAI;QACZ5D,KAAK,EAAE2H,CAAC,CAAC3H;MACX,CAAC,CAAC,CAAC;MAEH,IAAIyH,cAAc,CAACrH,MAAM,GAAG,EAAE,EAAE;QAC9B,MAAM,IAAIsE,KAAK,CAAC,2CAA2C,CAAC;MAC9D;MAEA,MAAMkD,WAAW,GAAG,IAAI,CAACC,gBAAgB,CAACJ,cAAc,EAAEzE,MAAM,CAAC;MAEjE,MAAM8E,UAAU,GAAG,IAAInK,UAAU,CAAC;QAChC6J,IAAI;QACJhD,GAAG,EAAED,KAAK;QACVkD,cAAc;QACdG,WAAW;QACXG,KAAK,EAAE;UACLP,IAAI,EAAE,QAAQ;UACdQ,QAAQ,EAAE,IAAI,CAACC,iBAAiB,CAACR,cAAc,EAAEG,WAAW;QAC9D,CAAC;QACD5E,MAAM,EAAE;UACNH,IAAI,EAAE,IAAI5D,IAAI,CAAC,CAAC;UAChBiJ,EAAE,EAAE,IAAIjJ,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG8D,MAAM,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;QACxD,CAAC;QACDmF,MAAM,EAAE,WAAW;QACnBC,YAAY,EAAE,IAAInJ,IAAI,CAAC;MACzB,CAAC,CAAC;MAEF,MAAM6I,UAAU,CAACxC,IAAI,CAAC,CAAC;MAEvB,OAAOwC,UAAU;IACnB,CAAC,CAAC,OAAOvC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;MACpD,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACEsC,gBAAgBA,CAACQ,IAAI,EAAEC,UAAU,EAAE;IACjC,MAAMC,CAAC,GAAGF,IAAI,CAACjI,MAAM;IACrB,MAAMoI,CAAC,GAAGH,IAAI,CAACX,GAAG,CAAC,CAAC5D,CAAC,EAAE2E,CAAC,KAAKA,CAAC,CAAC;IAC/B,MAAMC,CAAC,GAAGL,IAAI,CAACX,GAAG,CAAC5D,CAAC,IAAIA,CAAC,CAAC9D,KAAK,CAAC;IAEhC,MAAM2I,IAAI,GAAGH,CAAC,CAACnI,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,EAAE,CAAC,CAAC;IACzC,MAAMqI,IAAI,GAAGF,CAAC,CAACrI,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,EAAE,CAAC,CAAC;IACzC,MAAMsI,KAAK,GAAGF,IAAI,GAAGJ,CAAC;IACtB,MAAMO,KAAK,GAAGF,IAAI,GAAGL,CAAC;IAEtB,IAAIQ,GAAG,GAAG,CAAC;IACX,IAAIC,GAAG,GAAG,CAAC;IACX,KAAK,IAAIP,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,CAAC,EAAEE,CAAC,EAAE,EAAE;MAC1BM,GAAG,IAAI,CAACP,CAAC,CAACC,CAAC,CAAC,GAAGI,KAAK,KAAKH,CAAC,CAACD,CAAC,CAAC,GAAGK,KAAK,CAAC;MACtCE,GAAG,IAAI7J,IAAI,CAAC8J,GAAG,CAACT,CAAC,CAACC,CAAC,CAAC,GAAGI,KAAK,EAAE,CAAC,CAAC;IAClC;IACA,MAAMK,KAAK,GAAGH,GAAG,GAAGC,GAAG;IACvB,MAAMG,SAAS,GAAGL,KAAK,GAAGI,KAAK,GAAGL,KAAK;IAEvC,MAAMjB,WAAW,GAAG,EAAE;IACtB,MAAMwB,QAAQ,GAAGf,IAAI,CAACE,CAAC,GAAG,CAAC,CAAC,CAAC3E,IAAI;IAEjC,KAAK,IAAI6E,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAIH,UAAU,EAAEG,CAAC,EAAE,EAAE;MACpC,MAAMY,cAAc,GAAGF,SAAS,GAAGD,KAAK,IAAIX,CAAC,GAAGE,CAAC,CAAC;MAClD,MAAMa,UAAU,GAAGnK,IAAI,CAACQ,GAAG,CAAC,EAAE,EAAE,EAAE,GAAG8I,CAAC,CAAC;MAEvCb,WAAW,CAACzH,IAAI,CAAC;QACfyD,IAAI,EAAE,IAAI3E,IAAI,CAACmK,QAAQ,CAACG,OAAO,CAAC,CAAC,GAAGd,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;QAC5DY,cAAc,EAAElK,IAAI,CAACqK,KAAK,CAACH,cAAc,GAAG,GAAG,CAAC,GAAG,GAAG;QACtDC,UAAU;QACVG,UAAU,EAAEtK,IAAI,CAACqK,KAAK,CAACH,cAAc,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG;QACxDK,UAAU,EAAEvK,IAAI,CAACqK,KAAK,CAACH,cAAc,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG;MACvD,CAAC,CAAC;IACJ;IAEA,OAAOzB,WAAW;EACpB;;EAEA;AACF;AACA;EACEK,iBAAiBA,CAAC0B,UAAU,EAAE/B,WAAW,EAAE;IACzC,MAAMgC,QAAQ,GAAGzK,IAAI,CAACO,GAAG,CAAC,EAAE,EAAEP,IAAI,CAAC0K,KAAK,CAACF,UAAU,CAACvJ,MAAM,GAAG,GAAG,CAAC,CAAC;IAClE,MAAM0J,QAAQ,GAAGH,UAAU,CAAClJ,KAAK,CAAC,CAACmJ,QAAQ,CAAC;IAC5C,MAAMG,QAAQ,GAAGnC,WAAW,CAACnH,KAAK,CAAC,CAAC,EAAEmJ,QAAQ,CAAC;IAE/C,IAAII,UAAU,GAAG,CAAC;IAClB,KAAK,IAAIvB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmB,QAAQ,EAAEnB,CAAC,EAAE,EAAE;MACjC,MAAMwB,MAAM,GAAGH,QAAQ,CAACrB,CAAC,CAAC,CAACzI,KAAK;MAChC,MAAMkK,SAAS,GAAGH,QAAQ,CAACtB,CAAC,CAAC,CAACY,cAAc;MAC5CW,UAAU,IAAI7K,IAAI,CAACgL,GAAG,CAAC,CAACF,MAAM,GAAGC,SAAS,IAAID,MAAM,CAAC;IACvD;IAEA,MAAMG,IAAI,GAAIJ,UAAU,GAAGJ,QAAQ,GAAI,GAAG;IAC1C,OAAOzK,IAAI,CAACQ,GAAG,CAAC,CAAC,EAAER,IAAI,CAACO,GAAG,CAAC,GAAG,EAAE,GAAG,GAAG0K,IAAI,CAAC,CAAC;EAC/C;;EAEA;AACF;AACA;AACA;AACA;;EAEE;AACF;AACA;EACE,MAAMC,cAAcA,CAACC,UAAU,EAAEnJ,OAAO,EAAEoJ,MAAM,EAAEC,MAAM,EAAE;IACxD,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAM7M,cAAc,CAAC6G,QAAQ,CAAC6F,UAAU,CAAC;MAC1D,IAAI,CAACG,QAAQ,EAAE;QACb,MAAM,IAAI/F,KAAK,CAAC,oBAAoB,CAAC;MACvC;MAEA,MAAMgG,SAAS,GAAGzL,IAAI,CAACC,GAAG,CAAC,CAAC;MAC5B,MAAMmJ,IAAI,GAAG,MAAM,IAAI,CAACsC,iBAAiB,CAACF,QAAQ,EAAEtJ,OAAO,CAAC;MAE5D,MAAMyJ,MAAM,GAAG,IAAI/M,eAAe,CAAC;QACjC4M,QAAQ,EAAEH,UAAU;QACpBO,KAAK,EAAEJ,QAAQ,CAAC9L,IAAI;QACpBmM,OAAO,EAAEL,QAAQ,CAACM,MAAM;QACxB/H,MAAM,EAAE7B,OAAO,CAAC6B,MAAM;QACtBgI,cAAc,EAAE7J,OAAO;QACvBkH,IAAI;QACJ4C,WAAW,EAAET,MAAM;QACnBlD,WAAW,EAAE,IAAIrI,IAAI,CAAC,CAAC;QACvBkJ,MAAM,EAAE;MACV,CAAC,CAAC;MAEF,MAAMyC,MAAM,CAACtF,IAAI,CAAC,CAAC;MAEnB,IAAI4F,QAAQ;MACZ,QAAQX,MAAM;QACZ,KAAK,KAAK;UACRW,QAAQ,GAAG,MAAM,IAAI,CAACC,iBAAiB,CAACV,QAAQ,EAAEpC,IAAI,EAAEuC,MAAM,CAACQ,GAAG,CAAC;UACnE;QACF,KAAK,OAAO;UACVF,QAAQ,GAAG,MAAM,IAAI,CAACG,mBAAmB,CAACZ,QAAQ,EAAEpC,IAAI,EAAEuC,MAAM,CAACQ,GAAG,CAAC;UACrE;QACF,KAAK,KAAK;UACRF,QAAQ,GAAG,MAAM,IAAI,CAACI,iBAAiB,CAACb,QAAQ,EAAEpC,IAAI,EAAEuC,MAAM,CAACQ,GAAG,CAAC;UACnE;QACF,KAAK,MAAM;UACTF,QAAQ,GAAG,MAAM,IAAI,CAACK,kBAAkB,CAACd,QAAQ,EAAEpC,IAAI,EAAEuC,MAAM,CAACQ,GAAG,CAAC;UACpE;QACF;UACE,MAAM,IAAI1G,KAAK,CAAC,oBAAoB,CAAC;MACzC;MAEA,MAAMsC,KAAK,GAAG,MAAM/I,EAAE,CAACuN,IAAI,CAACN,QAAQ,CAAC;MACrCN,MAAM,CAACa,IAAI,GAAG;QACZlB,MAAM;QACNpM,IAAI,EAAE+M,QAAQ;QACdQ,IAAI,EAAE1E,KAAK,CAAC0E,IAAI;QAChBC,GAAG,EAAE,yBAAyBf,MAAM,CAACQ,GAAG;MAC1C,CAAC;MACDR,MAAM,CAACzC,MAAM,GAAG,WAAW;MAC3ByC,MAAM,CAACgB,cAAc,GAAG,CAAC3M,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGwL,SAAS,IAAI,IAAI;MAEvD,MAAME,MAAM,CAACtF,IAAI,CAAC,CAAC;MAEnBmF,QAAQ,CAACzD,KAAK,CAAC6E,cAAc,IAAI,CAAC;MAClCpB,QAAQ,CAACzD,KAAK,CAAC8E,aAAa,GAAG,IAAI7M,IAAI,CAAC,CAAC;MACzC,MAAMwL,QAAQ,CAACnF,IAAI,CAAC,CAAC;MAErB,OAAOsF,MAAM;IACf,CAAC,CAAC,OAAOrF,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChD,IAAIqF,MAAM,EAAE;QACVA,MAAM,CAACzC,MAAM,GAAG,QAAQ;QACxByC,MAAM,CAACrF,KAAK,GAAGA,KAAK,CAACwG,OAAO;QAC5B,MAAMnB,MAAM,CAACtF,IAAI,CAAC,CAAC;MACrB;MACA,MAAMC,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACE,MAAMoF,iBAAiBA,CAACF,QAAQ,EAAEtJ,OAAO,EAAE;IACzC,MAAMkH,IAAI,GAAG;MACX2D,OAAO,EAAE,CAAC,CAAC;MACXC,OAAO,EAAE,EAAE;MACXC,MAAM,EAAE,EAAE;MACVC,IAAI,EAAE;IACR,CAAC;IAED,IAAI1B,QAAQ,CAAC2B,SAAS,CAACD,IAAI,IAAI1B,QAAQ,CAAC2B,SAAS,CAACD,IAAI,CAAC/L,MAAM,GAAG,CAAC,EAAE;MACjEiI,IAAI,CAAC8D,IAAI,GAAG,MAAM1O,GAAG,CAACkJ,IAAI,CAAC;QACzByE,GAAG,EAAE;UAAEiB,GAAG,EAAE5B,QAAQ,CAAC2B,SAAS,CAACD;QAAK,CAAC;QACrCnK,QAAQ,EAAE;MACZ,CAAC,CAAC;IACJ;IAEA,OAAOqG,IAAI;EACb;;EAEA;AACF;AACA;EACE,MAAM8C,iBAAiBA,CAACV,QAAQ,EAAEpC,IAAI,EAAEiE,QAAQ,EAAE;IAChD,MAAMC,QAAQ,GAAG,UAAUD,QAAQ,IAAIrN,IAAI,CAACC,GAAG,CAAC,CAAC,MAAM;IACvD,MAAMgM,QAAQ,GAAG/M,IAAI,CAACqO,IAAI,CAACC,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAEF,QAAQ,CAAC;IAE1E,MAAMtO,EAAE,CAACyO,KAAK,CAACvO,IAAI,CAACwO,OAAO,CAACzB,QAAQ,CAAC,EAAE;MAAE0B,SAAS,EAAE;IAAK,CAAC,CAAC;IAE3D,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACtC,IAAI;QACF,MAAMC,GAAG,GAAG,IAAIjP,WAAW,CAAC;UAC1B2N,IAAI,EAAEjB,QAAQ,CAACwC,UAAU,EAAEC,QAAQ,IAAI,IAAI;UAC3CC,MAAM,EAAE1C,QAAQ,CAACwC,UAAU,EAAEG,WAAW,IAAI,UAAU;UACtDC,OAAO,EAAE;YAAEC,GAAG,EAAE,EAAE;YAAEC,MAAM,EAAE,EAAE;YAAEC,IAAI,EAAE,EAAE;YAAEC,KAAK,EAAE;UAAG;QACtD,CAAC,CAAC;QAEF,MAAMC,MAAM,GAAGV,GAAG,CAACW,IAAI,CAAC7P,OAAO,CAAC,IAAI,CAAC,CAAC8P,iBAAiB,CAAC1C,QAAQ,CAAC,CAAC;QAElE,IAAIT,QAAQ,CAACwC,UAAU,EAAEY,MAAM,EAAEC,IAAI,EAAE;UACrCd,GAAG,CAACe,QAAQ,CAAC,EAAE,CAAC,CAACC,IAAI,CAACvD,QAAQ,CAACM,MAAM,EAAE;YAAEkD,KAAK,EAAE;UAAS,CAAC,CAAC;UAC3DjB,GAAG,CAACe,QAAQ,CAAC,EAAE,CAAC,CAACC,IAAI,CAAC,IAAI/O,IAAI,CAAC,CAAC,CAACiP,kBAAkB,CAAC,OAAO,CAAC,EAAE;YAAED,KAAK,EAAE;UAAS,CAAC,CAAC;UAClFjB,GAAG,CAACmB,QAAQ,CAAC,CAAC;QAChB;QAEA,IAAI9F,IAAI,CAAC8D,IAAI,IAAI9D,IAAI,CAAC8D,IAAI,CAAC/L,MAAM,GAAG,CAAC,EAAE;UACrC4M,GAAG,CAACe,QAAQ,CAAC,EAAE,CAAC,CAACC,IAAI,CAAC,wBAAwB,EAAE;YAAEI,SAAS,EAAE;UAAK,CAAC,CAAC;UACpEpB,GAAG,CAACmB,QAAQ,CAAC,CAAC;UAEd9F,IAAI,CAAC8D,IAAI,CAACkC,OAAO,CAAC7J,GAAG,IAAI;YACvBwI,GAAG,CAACe,QAAQ,CAAC,EAAE,CAAC,CAACC,IAAI,CAAC,GAAGxJ,GAAG,CAACuG,MAAM,KAAKvG,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAIX,GAAG,CAAC1F,IAAI,EAAE,CAAC;YACxEkO,GAAG,CAACmB,QAAQ,CAAC,GAAG,CAAC;UACnB,CAAC,CAAC;QACJ;QAEA,IAAI1D,QAAQ,CAACwC,UAAU,EAAEqB,MAAM,EAAER,IAAI,EAAE;UACrCd,GAAG,CACAe,QAAQ,CAAC,EAAE,CAAC,CACZC,IAAI,CACH,gCAAgC,IAAI/O,IAAI,CAAC,CAAC,CAACsP,cAAc,CAAC,OAAO,CAAC,EAAE,EACpE,EAAE,EACFvB,GAAG,CAACwB,IAAI,CAACC,MAAM,GAAG,EAAE,EACpB;YAAER,KAAK,EAAE;UAAS,CACpB,CAAC;QACL;QAEAjB,GAAG,CAAC0B,GAAG,CAAC,CAAC;QAEThB,MAAM,CAACiB,EAAE,CAAC,QAAQ,EAAE,MAAM7B,OAAO,CAAC5B,QAAQ,CAAC,CAAC;QAC5CwC,MAAM,CAACiB,EAAE,CAAC,OAAO,EAAE5B,MAAM,CAAC;MAC5B,CAAC,CAAC,OAAOxH,KAAK,EAAE;QACdwH,MAAM,CAACxH,KAAK,CAAC;MACf;IACF,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;EACE,MAAM8F,mBAAmBA,CAACZ,QAAQ,EAAEpC,IAAI,EAAEiE,QAAQ,EAAE;IAClD,MAAMC,QAAQ,GAAG,UAAUD,QAAQ,IAAIrN,IAAI,CAACC,GAAG,CAAC,CAAC,OAAO;IACxD,MAAMgM,QAAQ,GAAG/M,IAAI,CAACqO,IAAI,CAACC,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAEF,QAAQ,CAAC;IAE1E,MAAMtO,EAAE,CAACyO,KAAK,CAACvO,IAAI,CAACwO,OAAO,CAACzB,QAAQ,CAAC,EAAE;MAAE0B,SAAS,EAAE;IAAK,CAAC,CAAC;IAE3D,MAAMgC,QAAQ,GAAG,IAAI5Q,OAAO,CAAC6Q,QAAQ,CAAC,CAAC;IACvC,MAAMC,SAAS,GAAGF,QAAQ,CAACG,YAAY,CAACtE,QAAQ,CAACM,MAAM,CAAC;IAExD+D,SAAS,CAACE,MAAM,CAAC,CAACvE,QAAQ,CAACM,MAAM,CAAC,CAAC;IACnC+D,SAAS,CAACE,MAAM,CAAC,CAAC,YAAY,IAAI/P,IAAI,CAAC,CAAC,CAACiP,kBAAkB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;IACxEY,SAAS,CAACE,MAAM,CAAC,EAAE,CAAC;IAEpB,IAAI3G,IAAI,CAAC8D,IAAI,IAAI9D,IAAI,CAAC8D,IAAI,CAAC/L,MAAM,GAAG,CAAC,EAAE;MACrC0O,SAAS,CAACE,MAAM,CAAC,CAAC,wBAAwB,CAAC,CAAC;MAC5CF,SAAS,CAACE,MAAM,CAAC,CAAC,QAAQ,EAAE,gBAAgB,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;MAE3E3G,IAAI,CAAC8D,IAAI,CAACkC,OAAO,CAAC7J,GAAG,IAAI;QACvBsK,SAAS,CAACE,MAAM,CAAC,CAACxK,GAAG,CAACuG,MAAM,EAAEvG,GAAG,CAACxE,KAAK,CAACmF,OAAO,EAAEX,GAAG,CAACxE,KAAK,CAACiP,MAAM,EAAEzK,GAAG,CAAC1F,IAAI,EAAE0F,GAAG,CAAC2D,MAAM,CAAC,CAAC;MAC3F,CAAC,CAAC;IACJ;IAEA,MAAMyG,QAAQ,CAACM,IAAI,CAACC,SAAS,CAACjE,QAAQ,CAAC;IACvC,OAAOA,QAAQ;EACjB;;EAEA;AACF;AACA;EACE,MAAMI,iBAAiBA,CAACb,QAAQ,EAAEpC,IAAI,EAAEiE,QAAQ,EAAE;IAChD,MAAMC,QAAQ,GAAG,UAAUD,QAAQ,IAAIrN,IAAI,CAACC,GAAG,CAAC,CAAC,MAAM;IACvD,MAAMgM,QAAQ,GAAG/M,IAAI,CAACqO,IAAI,CAACC,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAEF,QAAQ,CAAC;IAE1E,MAAMtO,EAAE,CAACyO,KAAK,CAACvO,IAAI,CAACwO,OAAO,CAACzB,QAAQ,CAAC,EAAE;MAAE0B,SAAS,EAAE;IAAK,CAAC,CAAC;IAE3D,IAAIwC,GAAG,GAAG,GAAG3E,QAAQ,CAACM,MAAM,IAAI;IAChCqE,GAAG,IAAI,WAAW,IAAInQ,IAAI,CAAC,CAAC,CAACiP,kBAAkB,CAAC,OAAO,CAAC,MAAM;IAE9D,IAAI7F,IAAI,CAAC8D,IAAI,IAAI9D,IAAI,CAAC8D,IAAI,CAAC/L,MAAM,GAAG,CAAC,EAAE;MACrCgP,GAAG,IAAI,6CAA6C;MACpD/G,IAAI,CAAC8D,IAAI,CAACkC,OAAO,CAAC7J,GAAG,IAAI;QACvB4K,GAAG,IAAI,GAAG5K,GAAG,CAACuG,MAAM,IAAIvG,GAAG,CAACxE,KAAK,CAACmF,OAAO,IAAIX,GAAG,CAACxE,KAAK,CAACiP,MAAM,IAAIzK,GAAG,CAAC1F,IAAI,IAAI0F,GAAG,CAAC2D,MAAM,IAAI;MAC7F,CAAC,CAAC;IACJ;IAEA,MAAMlK,EAAE,CAACkR,SAAS,CAACjE,QAAQ,EAAEkE,GAAG,EAAE,MAAM,CAAC;IACzC,OAAOlE,QAAQ;EACjB;;EAEA;AACF;AACA;EACE,MAAMK,kBAAkBA,CAACd,QAAQ,EAAEpC,IAAI,EAAEiE,QAAQ,EAAE;IACjD,MAAMC,QAAQ,GAAG,UAAUD,QAAQ,IAAIrN,IAAI,CAACC,GAAG,CAAC,CAAC,OAAO;IACxD,MAAMgM,QAAQ,GAAG/M,IAAI,CAACqO,IAAI,CAACC,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAEF,QAAQ,CAAC;IAE1E,MAAMtO,EAAE,CAACyO,KAAK,CAACvO,IAAI,CAACwO,OAAO,CAACzB,QAAQ,CAAC,EAAE;MAAE0B,SAAS,EAAE;IAAK,CAAC,CAAC;IAE3D,MAAMyC,UAAU,GAAG;MACjB5E,QAAQ,EAAE;QACR9L,IAAI,EAAE8L,QAAQ,CAAC9L,IAAI;QACnBoM,MAAM,EAAEN,QAAQ,CAACM;MACnB,CAAC;MACDzD,WAAW,EAAE,IAAIrI,IAAI,CAAC,CAAC;MACvBoJ;IACF,CAAC;IAED,MAAMpK,EAAE,CAACkR,SAAS,CAACjE,QAAQ,EAAEoE,IAAI,CAACC,SAAS,CAACF,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC;IACzE,OAAOnE,QAAQ;EACjB;;EAEA;AACF;AACA;AACA;AACA;;EAEE,MAAMxF,iBAAiBA,CAAA,EAAG;IACxB,OAAOvG,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAMuG,sBAAsBA,CAAA,EAAG;IAC7B,OAAOxG,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAMwG,wBAAwBA,CAAA,EAAG;IAC/B,OAAOzG,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAMyG,sBAAsBA,CAAA,EAAG;IAC7B,OAAO1G,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAM0G,iBAAiBA,CAAA,EAAG;IACxB,OAAO3G,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAM2G,aAAaA,CAAA,EAAG;IACpB,OAAO5G,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC;EAC1C;EACA,MAAM4G,sBAAsBA,CAAA,EAAG;IAC7B,OAAO7G,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAM6G,qBAAqBA,CAAA,EAAG;IAC5B,OAAO9G,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAM8G,uBAAuBA,CAAA,EAAG;IAC9B,OAAO/G,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAM+G,eAAeA,CAAA,EAAG;IACtB,OAAOhH,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,GAAG,OAAO;EACrD;EACA,MAAMgH,eAAeA,CAAA,EAAG;IACtB,OAAOjH,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAMiH,iBAAiBA,CAAA,EAAG;IACxB,OAAOlH,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE;EAC5C;EACA,MAAMkH,gBAAgBA,CAAA,EAAG;IACvB,OAAOnH,IAAI,CAAC0K,KAAK,CAAC1K,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,GAAG,MAAM;EACpD;EAEA,MAAM6H,oBAAoBA,CAAC9F,OAAO,EAAE;IAClC,OAAO;MACLqO,UAAU,EAAE,IAAI;MAChBC,WAAW,EAAE,GAAG;MAChBC,YAAY,EAAE,OAAO;MACrBC,aAAa,EAAE,MAAM;MACrBC,YAAY,EAAE,EAAE;MAChBhM,IAAI,EAAE,IAAI3E,IAAI,CAAC;IACjB,CAAC;EACH;;EAEA;AACF;AACA;AACA;AACA;;EAEE;EACA,OAAO4Q,iBAAiBA,CAACrF,MAAM,EAAE;IAC/B,OAAO;MACLsF,OAAO,EAAE,IAAI;MACbtF,MAAM,EAAEA,MAAM;MACduF,QAAQ,EAAE;QACRC,cAAc,EAAE,mBAAmB;QACnCC,sBAAsB,EAAE,YAAY;QACpCC,gBAAgB,EAAE,CAAC,SAAS,EAAE,eAAe,EAAE,OAAO,CAAC;QACvDC,SAAS,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC;QACtCC,WAAW,EAAE,CAAC,SAAS,EAAE,QAAQ,CAAC;QAClCC,QAAQ,EAAE,CAAC,QAAQ,EAAE,QAAQ;MAC/B,CAAC;MACDC,UAAU,EAAE;QACVC,KAAK,EAAE,GAAG;QACVC,KAAK,EAAE,MAAM;QACb5Q,KAAK,EAAE;MACT,CAAC;MACDM,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAO2Q,qBAAqBA,CAACC,SAAS,GAAG,KAAK,EAAE;IAC9C,OAAO;MACLZ,OAAO,EAAE,IAAI;MACbY,SAAS,EAAEA,SAAS;MACpBpS,OAAO,EAAE;QACPqS,YAAY,EAAE;UACZC,OAAO,EAAE,OAAO;UAChBlR,GAAG,EAAE,MAAM;UACXC,GAAG,EAAE,QAAQ;UACbkR,GAAG,EAAE;QACP,CAAC;QACDC,MAAM,EAAE,QAAQ;QAChBC,SAAS,EAAE,OAAO;QAClBC,UAAU,EAAE,sBAAsB;QAClCC,QAAQ,EAAE,KAAK;QACfC,WAAW,EAAE,KAAK;QAClBC,eAAe,EAAE;MACnB,CAAC;MACDjR,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAOsR,kBAAkBA,CAAC5G,MAAM,EAAE;IAChC,OAAO;MACLsF,OAAO,EAAE,IAAI;MACbtF,MAAM,EAAEA,MAAM;MACdvJ,SAAS,EAAE;QACTC,OAAO,EAAE,CACP;UACElC,EAAE,EAAE,UAAU;UACd6L,KAAK,EAAE,gBAAgB;UACvBrD,IAAI,EAAE,OAAO;UACba,IAAI,EAAE;YAAElD,OAAO,EAAE,MAAM;YAAED,QAAQ,EAAE,MAAM;YAAEmM,MAAM,EAAE;UAAM;QAC3D,CAAC,EACD;UACErS,EAAE,EAAE,UAAU;UACd6L,KAAK,EAAE,eAAe;UACtBrD,IAAI,EAAE,OAAO;UACba,IAAI,EAAE;YAAEiJ,MAAM,EAAE,GAAG;YAAEC,QAAQ,EAAE,EAAE;YAAEC,KAAK,EAAE;UAAI;QAChD,CAAC,EACD;UACExS,EAAE,EAAE,UAAU;UACd6L,KAAK,EAAE,eAAe;UACtBrD,IAAI,EAAE,QAAQ;UACda,IAAI,EAAE;YAAEF,MAAM,EAAE,SAAS;YAAE2I,MAAM,EAAE;UAAS;QAC9C,CAAC,EACD;UACE9R,EAAE,EAAE,UAAU;UACd6L,KAAK,EAAE,cAAc;UACrBrD,IAAI,EAAE,MAAM;UACZa,IAAI,EAAE,CAAC,SAAS,EAAE,eAAe,EAAE,WAAW;QAChD,CAAC,CACF;QACD8E,MAAM,EAAE,MAAM;QACdsE,eAAe,EAAE;MACnB,CAAC;MACDvR,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAO4R,aAAaA,CAAC3S,MAAM,EAAEiE,MAAM,GAAG,KAAK,EAAE;IAC3C,OAAO;MACL8M,OAAO,EAAE,IAAI;MACb/Q,MAAM,EAAEA,MAAM;MACdiE,MAAM,EAAEA,MAAM;MACdpD,KAAK,EAAE;QACL+R,SAAS,EAAE,IAAI;QACfC,aAAa,EAAE,IAAI;QACnBC,UAAU,EAAE,CACV;UAAEjO,IAAI,EAAE,YAAY;UAAE5D,KAAK,EAAE;QAAK,CAAC,EACnC;UAAE4D,IAAI,EAAE,YAAY;UAAE5D,KAAK,EAAE;QAAK,CAAC,EACnC;UAAE4D,IAAI,EAAE,YAAY;UAAE5D,KAAK,EAAE;QAAK,CAAC,EACnC;UAAE4D,IAAI,EAAE,YAAY;UAAE5D,KAAK,EAAE;QAAK,CAAC,EACnC;UAAE4D,IAAI,EAAE,YAAY;UAAE5D,KAAK,EAAE;QAAK,CAAC;MAEvC,CAAC;MACD8R,QAAQ,EAAE;QACRC,gBAAgB,EAAE,IAAI;QACtBzI,UAAU,EAAE;MACd,CAAC;MACDpJ,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAOkS,kBAAkBA,CAAA,EAAG;IAC1B,OAAO;MACLlC,OAAO,EAAE,IAAI;MACbmC,eAAe,EAAE,CACf;QACEjT,EAAE,EAAE,SAAS;QACb6L,KAAK,EAAE,2BAA2B;QAClCjG,QAAQ,EAAE,aAAa;QACvBsN,QAAQ,EAAE,MAAM;QAChBC,MAAM,EAAE,qBAAqB;QAC7BC,cAAc,EAAE;MAClB,CAAC,EACD;QACEpT,EAAE,EAAE,SAAS;QACb6L,KAAK,EAAE,yBAAyB;QAChCjG,QAAQ,EAAE,gBAAgB;QAC1BsN,QAAQ,EAAE,QAAQ;QAClBC,MAAM,EAAE;MACV,CAAC,EACD;QACEnT,EAAE,EAAE,SAAS;QACb6L,KAAK,EAAE,oBAAoB;QAC3BjG,QAAQ,EAAE,UAAU;QACpBsN,QAAQ,EAAE,MAAM;QAChBC,MAAM,EAAE;MACV,CAAC,CACF;MACDE,oBAAoB,EAAE,CAAC;MACvBnS,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAOwS,cAAcA,CAACC,OAAO,EAAEC,OAAO,EAAExP,MAAM,GAAG,KAAK,EAAE;IACtD,OAAO;MACL8M,OAAO,EAAE,IAAI;MACb2C,UAAU,EAAE;QACVF,OAAO,EAAE;UACP5T,IAAI,EAAE4T,OAAO;UACbvS,KAAK,EAAE,IAAI;UACX4Q,OAAO,EAAE,IAAI;UACbhR,KAAK,EAAE;QACT,CAAC;QACD4S,OAAO,EAAE;UACP7T,IAAI,EAAE6T,OAAO;UACbxS,KAAK,EAAE,IAAI;UACX4Q,OAAO,EAAE,IAAI;UACbhR,KAAK,EAAE;QACT,CAAC;QACD8S,WAAW,EAAE;MACf,CAAC;MACD1P,MAAM,EAAEA,MAAM;MACd9C,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAO6S,sBAAsBA,CAACC,UAAU,GAAG,WAAW,EAAE;IACtD,OAAO;MACL9C,OAAO,EAAE,IAAI;MACb8C,UAAU,EAAEA,UAAU;MACtBhI,MAAM,EAAE;QACNoB,OAAO,EAAE;UACPhJ,MAAM,EAAE,cAAc;UACtB6O,UAAU,EAAE,GAAG;UACfgB,QAAQ,EAAE;QACZ,CAAC;QACDC,UAAU,EAAE;UACVtD,UAAU,EAAE,GAAG;UACfC,WAAW,EAAE,GAAG;UAChBsD,QAAQ,EAAE,EAAE;UACZC,cAAc,EAAE,KAAK;UACrBC,aAAa,EAAE;QACjB,CAAC;QACDC,qBAAqB,EAAE;UACrBC,EAAE,EAAE;YAAEC,WAAW,EAAE,EAAE;YAAEC,KAAK,EAAE;UAAG,CAAC;UAClCC,EAAE,EAAE;YAAEF,WAAW,EAAE,EAAE;YAAEC,KAAK,EAAE;UAAE,CAAC;UACjCE,KAAK,EAAE;YAAEH,WAAW,EAAE,EAAE;YAAEC,KAAK,EAAE;UAAG,CAAC;UACrCG,SAAS,EAAE;YAAEJ,WAAW,EAAE,EAAE;YAAEC,KAAK,EAAE;UAAG,CAAC;UACzCI,OAAO,EAAE;YAAEL,WAAW,EAAE,EAAE;YAAEC,KAAK,EAAE;UAAG;QACxC,CAAC;QACDK,WAAW,EAAE,CACX,wCAAwC,EACxC,uCAAuC,EACvC,mCAAmC;MAEvC,CAAC;MACDxT,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAO6T,eAAeA,CAACnJ,MAAM,EAAEoJ,KAAK,EAAE;IACpC,OAAO;MACL9D,OAAO,EAAE,IAAI;MACbtF,MAAM,EAAEA,MAAM;MACdoJ,KAAK,EAAEA,KAAK;MACZC,UAAU,EAAE;QACVrM,IAAI,EAAE,aAAa;QACnBsM,IAAI,EAAE,CAAC;QACPC,cAAc,EAAE,KAAK;QACrBC,SAAS,EAAE;MACb,CAAC;MACD9T,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAOmU,oBAAoBA,CAAA,EAAG;IAC5B,OAAO;MACLnE,OAAO,EAAE,IAAI;MACboE,QAAQ,EAAE;QACRzE,WAAW,EAAE,EAAE;QACf0E,cAAc,EAAE,GAAG;QACnBC,GAAG,EAAE,EAAE;QAAE;QACTC,eAAe,EAAE,OAAO;QACxBtD,SAAS,EAAE,OAAO;QAClBC,UAAU,EAAE;MACd,CAAC;MACDsD,QAAQ,EAAE,CACR;QAAE9F,IAAI,EAAE,UAAU;QAAE6E,KAAK,EAAE,EAAE;QAAEkB,QAAQ,EAAE;MAAQ,CAAC,EAClD;QAAE/F,IAAI,EAAE,YAAY;QAAE6E,KAAK,EAAE,EAAE;QAAEkB,QAAQ,EAAE;MAAQ,CAAC,EACpD;QAAE/F,IAAI,EAAE,QAAQ;QAAE6E,KAAK,EAAE,CAAC;QAAEkB,QAAQ,EAAE;MAAQ,CAAC,CAChD;MACDC,UAAU,EAAE,CACV;QAAEC,MAAM,EAAE,iBAAiB;QAAE/Q,KAAK,EAAE;MAAG,CAAC,EACxC;QAAE+Q,MAAM,EAAE,gBAAgB;QAAE/Q,KAAK,EAAE;MAAG,CAAC,EACvC;QAAE+Q,MAAM,EAAE,cAAc;QAAE/Q,KAAK,EAAE;MAAG,CAAC,CACtC;MACDxD,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAO4U,sBAAsBA,CAAA,EAAG;IAC9B,OAAO;MACL5E,OAAO,EAAE,IAAI;MACblI,WAAW,EAAE;QACX+M,SAAS,EAAE;UACTC,WAAW,EAAE,KAAK;UAClBC,SAAS,EAAE,EAAE;UACb5C,eAAe,EAAE;QACnB,CAAC;QACD6C,cAAc,EAAE;UACdC,SAAS,EAAE,WAAW;UACtBC,WAAW,EAAE,WAAW;UACxB1L,UAAU,EAAE;QACd,CAAC;QACD2L,eAAe,EAAE;UACfC,YAAY,EAAE,CAAC,SAAS,EAAE,eAAe,CAAC;UAC1CC,cAAc,EAAE,CAAC,WAAW,EAAE,SAAS,CAAC;UACxCC,WAAW,EAAE,CAAC,KAAK,EAAE,mBAAmB;QAC1C;MACF,CAAC;MACDlV,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAOuV,qBAAqBA,CAAC9K,MAAM,GAAG,KAAK,EAAE;IAC3C,OAAO;MACLuF,OAAO,EAAE,IAAI;MACbrE,IAAI,EAAE;QACJ9M,IAAI,EAAE,oBAAoB,IAAIM,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC,CAAC,CAAC+D,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI0G,MAAM,EAAE;QAC5EmB,IAAI,EAAE,QAAQ;QACd4J,WAAW,EAAE,yCAAyCrW,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIqL,MAAM,EAAE;QAC5EgL,SAAS,EAAE;MACb,CAAC;MACDrV,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAO0V,gBAAgBA,CAACC,MAAM,EAAE;IAC9B,OAAO;MACL3F,OAAO,EAAE,IAAI;MACb2F,MAAM,EAAEA,MAAM;MACdC,OAAO,EAAE;QACPC,QAAQ,EAAE,mBAAmB;QAC7BpB,QAAQ,EAAE,SAAS;QACnBpM,MAAM,EAAE,WAAW;QACnByN,QAAQ,EAAE,CACR;UACEjX,IAAI,EAAE,gBAAgB;UACtBkX,WAAW,EAAE,GAAG;UAChBC,cAAc,EAAE,MAAM;UACtBzC,KAAK,EAAE;QACT,CAAC,EACD;UACE1U,IAAI,EAAE,eAAe;UACrBkX,WAAW,EAAE,GAAG;UAChBC,cAAc,EAAE,MAAM;UACtBzC,KAAK,EAAE;QACT,CAAC,CACF;QACD0C,MAAM,EAAE,eAAe;QACvBzM,UAAU,EAAE,KAAK;QACjB6I,MAAM,EAAE;MACV,CAAC;MACDjS,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;;EAEA;EACA,OAAOkW,mBAAmBA,CAACC,QAAQ,EAAE;IACnC,OAAO;MACLnG,OAAO,EAAE,IAAI;MACbmG,QAAQ,EAAEA,QAAQ;MAClB3X,OAAO,EAAE;QACP4X,WAAW,EAAE,KAAK;QAClBC,MAAM,EAAE,IAAI;QACZC,GAAG,EAAE,IAAI;QACTP,WAAW,EAAE,GAAG;QAChBC,cAAc,EAAE,IAAI;QACpBO,IAAI,EAAE,GAAG;QACTC,GAAG,EAAE,GAAG;QACRC,GAAG,EAAE;MACP,CAAC;MACDrW,SAAS,EAAE,IAAIjB,IAAI,CAAC,CAAC,CAACa,WAAW,CAAC;IACpC,CAAC;EACH;AACF;;AAEA;AACA0W,MAAM,CAACC,OAAO,GAAGrY,gBAAgB;AACjC;AACA","ignoreList":[]}