ca7586b84044d66d0fd858a8a8b5a550
/**
 * نموذج نظام التقييم المتقدم
 * Advanced Performance Evaluation System Model
 */

const mongoose = require('mongoose');

// Schema لمعايير التقييم
const EvaluationCriteriaSchema = new mongoose.Schema({
  category: {
    type: String,
    enum: ['technical_skills',
    // المهارات التقنية
    'soft_skills',
    // المهارات اللينة
    'leadership',
    // القيادة
    'teamwork',
    // العمل الجماعي
    'communication',
    // التواصل
    'productivity',
    // الإنتاجية
    'quality',
    // جودة العمل
    'reliability',
    // الموثوقية
    'innovation',
    // الابتكار
    'customer_service' // خدمة العملاء
    ]
  },
  criteriaName: String,
  description: String,
  weight: Number,
  // وزن المعيار من 0-1
  maxScore: {
    type: Number,
    default: 5
  }
});

// Schema لتقييم الفرد الواحد
const IndividualEvaluationSchema = new mongoose.Schema({
  evaluatedBy: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  evaluationType: {
    type: String,
    enum: ['management', 'peer', 'recipient', 'self'],
    required: true
  },
  score: Number,
  // النتيجة الإجمالية
  scores: [{
    criteriaId: String,
    criteriaName: String,
    score: {
      type: Number,
      min: 1,
      max: 5
    },
    comment: String
  }],
  comments: String,
  strengths: [String],
  areasForImprovement: [String],
  recommendations: String,
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
});

// Schema الرئيسي للتقييم الشامل
const PerformanceEvaluationSchema = new mongoose.Schema({
  employeeId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
  },
  evaluationPeriod: {
    startDate: {
      type: Date,
      required: true
    },
    endDate: {
      type: Date,
      required: true
    }
  },
  // التقييمات من الجهات المختلفة
  evaluations: {
    // تقييم من الإدارة
    managementEvaluation: IndividualEvaluationSchema,
    // تقييمات الزملاء
    peerEvaluations: [IndividualEvaluationSchema],
    // تقييمات المستفيدين/الأسر
    recipientEvaluations: [IndividualEvaluationSchema],
    // التقييم الذاتي
    selfEvaluation: IndividualEvaluationSchema
  },
  // التحليل والملخص
  summary: {
    // النتائج المرجحة
    weightedScores: {
      management: Number,
      // وزن 40%
      peers: Number,
      // وزن 30%
      recipients: Number,
      // وزن 20%
      self: Number // وزن 10%
    },
    // النتيجة النهائية
    overallScore: Number,
    overallRating: {
      type: String,
      enum: ['ممتاز', 'جيد جداً', 'جيد', 'مقبول', 'ضعيف'],
      required: true
    },
    // الملخص التنفيذي
    executiveSummary: String,
    keyAchievements: [String],
    mainChallenges: [String],
    // التوصيات العامة
    promotionRecommended: Boolean,
    trainingNeeds: [String],
    careerPathRecommendation: String,
    salaryAdjustmentRecommended: Boolean,
    salaryAdjustmentPercentage: Number
  },
  // معلومات الموارد البشرية
  hrNotes: String,
  approvedBy: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User'
  },
  approvalDate: Date,
  // حالة التقييم
  status: {
    type: String,
    enum: ['draft', 'in_progress', 'pending_review', 'approved', 'archived'],
    default: 'draft'
  },
  // الجدول الزمني
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  },
  submittedAt: Date,
  reviewedAt: Date
});

// Indexes
PerformanceEvaluationSchema.index({
  employeeId: 1,
  'evaluationPeriod.startDate': -1
});
PerformanceEvaluationSchema.index({
  status: 1
});
PerformanceEvaluationSchema.index({
  'summary.overallRating': 1
});

// Virtual للحصول على مدة التقييم
PerformanceEvaluationSchema.virtual('evaluationDuration').get(function () {
  return this.evaluationPeriod.endDate - this.evaluationPeriod.startDate;
});

// Method لحساب النتيجة النهائية
PerformanceEvaluationSchema.methods.calculateOverallScore = function () {
  const weights = {
    management: 0.4,
    peers: 0.3,
    recipients: 0.2,
    self: 0.1
  };
  let weightedTotal = 0;
  let totalWeight = 0;
  if (this.evaluations.managementEvaluation && this.evaluations.managementEvaluation.score) {
    weightedTotal += this.evaluations.managementEvaluation.score * weights.management;
    totalWeight += weights.management;
  }
  if (this.evaluations.peerEvaluations && this.evaluations.peerEvaluations.length > 0) {
    const peerAverage = this.evaluations.peerEvaluations.reduce((sum, evaluation) => sum + evaluation.score, 0) / this.evaluations.peerEvaluations.length;
    weightedTotal += peerAverage * weights.peers;
    totalWeight += weights.peers;
  }
  if (this.evaluations.recipientEvaluations && this.evaluations.recipientEvaluations.length > 0) {
    const recipientAverage = this.evaluations.recipientEvaluations.reduce((sum, evaluation) => sum + evaluation.score, 0) / this.evaluations.recipientEvaluations.length;
    weightedTotal += recipientAverage * weights.recipients;
    totalWeight += weights.recipients;
  }
  if (this.evaluations.selfEvaluation && this.evaluations.selfEvaluation.score) {
    weightedTotal += this.evaluations.selfEvaluation.score * weights.self;
    totalWeight += weights.self;
  }
  this.summary.overallScore = totalWeight > 0 ? weightedTotal / totalWeight : 0;

  // تحديد التقييم على أساس النتيجة
  if (this.summary.overallScore >= 4.5) {
    this.summary.overallRating = 'ممتاز';
  } else if (this.summary.overallScore >= 4) {
    this.summary.overallRating = 'جيد جداً';
  } else if (this.summary.overallScore >= 3.5) {
    this.summary.overallRating = 'جيد';
  } else if (this.summary.overallScore >= 2.5) {
    this.summary.overallRating = 'مقبول';
  } else {
    this.summary.overallRating = 'ضعيف';
  }
  return this.summary.overallScore;
};
module.exports = mongoose.model('PerformanceEvaluation', PerformanceEvaluationSchema);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJFdmFsdWF0aW9uQ3JpdGVyaWFTY2hlbWEiLCJTY2hlbWEiLCJjYXRlZ29yeSIsInR5cGUiLCJTdHJpbmciLCJlbnVtIiwiY3JpdGVyaWFOYW1lIiwiZGVzY3JpcHRpb24iLCJ3ZWlnaHQiLCJOdW1iZXIiLCJtYXhTY29yZSIsImRlZmF1bHQiLCJJbmRpdmlkdWFsRXZhbHVhdGlvblNjaGVtYSIsImV2YWx1YXRlZEJ5IiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsInJlcXVpcmVkIiwiZXZhbHVhdGlvblR5cGUiLCJzY29yZSIsInNjb3JlcyIsImNyaXRlcmlhSWQiLCJtaW4iLCJtYXgiLCJjb21tZW50IiwiY29tbWVudHMiLCJzdHJlbmd0aHMiLCJhcmVhc0ZvckltcHJvdmVtZW50IiwicmVjb21tZW5kYXRpb25zIiwiY3JlYXRlZEF0IiwiRGF0ZSIsIm5vdyIsInVwZGF0ZWRBdCIsIlBlcmZvcm1hbmNlRXZhbHVhdGlvblNjaGVtYSIsImVtcGxveWVlSWQiLCJldmFsdWF0aW9uUGVyaW9kIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsImV2YWx1YXRpb25zIiwibWFuYWdlbWVudEV2YWx1YXRpb24iLCJwZWVyRXZhbHVhdGlvbnMiLCJyZWNpcGllbnRFdmFsdWF0aW9ucyIsInNlbGZFdmFsdWF0aW9uIiwic3VtbWFyeSIsIndlaWdodGVkU2NvcmVzIiwibWFuYWdlbWVudCIsInBlZXJzIiwicmVjaXBpZW50cyIsInNlbGYiLCJvdmVyYWxsU2NvcmUiLCJvdmVyYWxsUmF0aW5nIiwiZXhlY3V0aXZlU3VtbWFyeSIsImtleUFjaGlldmVtZW50cyIsIm1haW5DaGFsbGVuZ2VzIiwicHJvbW90aW9uUmVjb21tZW5kZWQiLCJCb29sZWFuIiwidHJhaW5pbmdOZWVkcyIsImNhcmVlclBhdGhSZWNvbW1lbmRhdGlvbiIsInNhbGFyeUFkanVzdG1lbnRSZWNvbW1lbmRlZCIsInNhbGFyeUFkanVzdG1lbnRQZXJjZW50YWdlIiwiaHJOb3RlcyIsImFwcHJvdmVkQnkiLCJhcHByb3ZhbERhdGUiLCJzdGF0dXMiLCJzdWJtaXR0ZWRBdCIsInJldmlld2VkQXQiLCJpbmRleCIsInZpcnR1YWwiLCJnZXQiLCJtZXRob2RzIiwiY2FsY3VsYXRlT3ZlcmFsbFNjb3JlIiwid2VpZ2h0cyIsIndlaWdodGVkVG90YWwiLCJ0b3RhbFdlaWdodCIsImxlbmd0aCIsInBlZXJBdmVyYWdlIiwicmVkdWNlIiwic3VtIiwiZXZhbHVhdGlvbiIsInJlY2lwaWVudEF2ZXJhZ2UiLCJtb2R1bGUiLCJleHBvcnRzIiwibW9kZWwiXSwic291cmNlcyI6WyJQZXJmb3JtYW5jZUV2YWx1YXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqINmG2YXZiNiw2Kwg2YbYuNin2YUg2KfZhNiq2YLZitmK2YUg2KfZhNmF2KrZgtiv2YVcclxuICogQWR2YW5jZWQgUGVyZm9ybWFuY2UgRXZhbHVhdGlvbiBTeXN0ZW0gTW9kZWxcclxuICovXHJcblxyXG5jb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG4vLyBTY2hlbWEg2YTZhdi52KfZitmK2LEg2KfZhNiq2YLZitmK2YVcclxuY29uc3QgRXZhbHVhdGlvbkNyaXRlcmlhU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XHJcbiAgY2F0ZWdvcnk6IHtcclxuICAgIHR5cGU6IFN0cmluZyxcclxuICAgIGVudW06IFtcclxuICAgICAgJ3RlY2huaWNhbF9za2lsbHMnLCAgICAgIC8vINin2YTZhdmH2KfYsdin2Kog2KfZhNiq2YLZhtmK2KlcclxuICAgICAgJ3NvZnRfc2tpbGxzJywgICAgICAgICAgICAvLyDYp9mE2YXZh9in2LHYp9iqINin2YTZhNmK2YbYqVxyXG4gICAgICAnbGVhZGVyc2hpcCcsICAgICAgICAgICAgIC8vINin2YTZgtmK2KfYr9ipXHJcbiAgICAgICd0ZWFtd29yaycsICAgICAgICAgICAgICAgLy8g2KfZhNi52YXZhCDYp9mE2KzZhdin2LnZilxyXG4gICAgICAnY29tbXVuaWNhdGlvbicsICAgICAgICAgIC8vINin2YTYqtmI2KfYtdmEXHJcbiAgICAgICdwcm9kdWN0aXZpdHknLCAgICAgICAgICAgLy8g2KfZhNil2YbYqtin2KzZitipXHJcbiAgICAgICdxdWFsaXR5JywgICAgICAgICAgICAgICAgLy8g2KzZiNiv2Kkg2KfZhNi52YXZhFxyXG4gICAgICAncmVsaWFiaWxpdHknLCAgICAgICAgICAgIC8vINin2YTZhdmI2KvZiNmC2YrYqVxyXG4gICAgICAnaW5ub3ZhdGlvbicsICAgICAgICAgICAgIC8vINin2YTYp9io2KrZg9in2LFcclxuICAgICAgJ2N1c3RvbWVyX3NlcnZpY2UnICAgICAgICAvLyDYrtiv2YXYqSDYp9mE2LnZhdmE2KfYoVxyXG4gICAgXVxyXG4gIH0sXHJcbiAgY3JpdGVyaWFOYW1lOiBTdHJpbmcsXHJcbiAgZGVzY3JpcHRpb246IFN0cmluZyxcclxuICB3ZWlnaHQ6IE51bWJlciwgLy8g2YjYstmGINin2YTZhdi52YrYp9ixINmF2YYgMC0xXHJcbiAgbWF4U2NvcmU6IHtcclxuICAgIHR5cGU6IE51bWJlcixcclxuICAgIGRlZmF1bHQ6IDVcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gU2NoZW1hINmE2KrZgtmK2YrZhSDYp9mE2YHYsdivINin2YTZiNin2K3Yr1xyXG5jb25zdCBJbmRpdmlkdWFsRXZhbHVhdGlvblNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gIGV2YWx1YXRlZEJ5OiB7XHJcbiAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICByZWY6ICdVc2VyJyxcclxuICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgfSxcclxuICBldmFsdWF0aW9uVHlwZToge1xyXG4gICAgdHlwZTogU3RyaW5nLFxyXG4gICAgZW51bTogWydtYW5hZ2VtZW50JywgJ3BlZXInLCAncmVjaXBpZW50JywgJ3NlbGYnXSxcclxuICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgfSxcclxuICBzY29yZTogTnVtYmVyLCAvLyDYp9mE2YbYqtmK2KzYqSDYp9mE2KXYrNmF2KfZhNmK2KlcclxuICBzY29yZXM6IFt7XHJcbiAgICBjcml0ZXJpYUlkOiBTdHJpbmcsXHJcbiAgICBjcml0ZXJpYU5hbWU6IFN0cmluZyxcclxuICAgIHNjb3JlOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgbWluOiAxLFxyXG4gICAgICBtYXg6IDVcclxuICAgIH0sXHJcbiAgICBjb21tZW50OiBTdHJpbmdcclxuICB9XSxcclxuICBjb21tZW50czogU3RyaW5nLFxyXG4gIHN0cmVuZ3RoczogW1N0cmluZ10sXHJcbiAgYXJlYXNGb3JJbXByb3ZlbWVudDogW1N0cmluZ10sXHJcbiAgcmVjb21tZW5kYXRpb25zOiBTdHJpbmcsXHJcbiAgY3JlYXRlZEF0OiB7IHR5cGU6IERhdGUsIGRlZmF1bHQ6IERhdGUubm93IH0sXHJcbiAgdXBkYXRlZEF0OiB7IHR5cGU6IERhdGUsIGRlZmF1bHQ6IERhdGUubm93IH1cclxufSk7XHJcblxyXG4vLyBTY2hlbWEg2KfZhNix2KbZitiz2Yog2YTZhNiq2YLZitmK2YUg2KfZhNi02KfZhdmEXHJcbmNvbnN0IFBlcmZvcm1hbmNlRXZhbHVhdGlvblNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gIGVtcGxveWVlSWQ6IHtcclxuICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgIHJlZjogJ1VzZXInLFxyXG4gICAgcmVxdWlyZWQ6IHRydWVcclxuICB9LFxyXG4gIGV2YWx1YXRpb25QZXJpb2Q6IHtcclxuICAgIHN0YXJ0RGF0ZToge1xyXG4gICAgICB0eXBlOiBEYXRlLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGVuZERhdGU6IHtcclxuICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8vINin2YTYqtmC2YrZitmF2KfYqiDZhdmGINin2YTYrNmH2KfYqiDYp9mE2YXYrtiq2YTZgdipXHJcbiAgZXZhbHVhdGlvbnM6IHtcclxuICAgIC8vINiq2YLZitmK2YUg2YXZhiDYp9mE2KXYr9in2LHYqVxyXG4gICAgbWFuYWdlbWVudEV2YWx1YXRpb246IEluZGl2aWR1YWxFdmFsdWF0aW9uU2NoZW1hLFxyXG4gICAgXHJcbiAgICAvLyDYqtmC2YrZitmF2KfYqiDYp9mE2LLZhdmE2KfYoVxyXG4gICAgcGVlckV2YWx1YXRpb25zOiBbSW5kaXZpZHVhbEV2YWx1YXRpb25TY2hlbWFdLFxyXG4gICAgXHJcbiAgICAvLyDYqtmC2YrZitmF2KfYqiDYp9mE2YXYs9iq2YHZitiv2YrZhi/Yp9mE2KPYs9ixXHJcbiAgICByZWNpcGllbnRFdmFsdWF0aW9uczogW0luZGl2aWR1YWxFdmFsdWF0aW9uU2NoZW1hXSxcclxuICAgIFxyXG4gICAgLy8g2KfZhNiq2YLZitmK2YUg2KfZhNiw2KfYqtmKXHJcbiAgICBzZWxmRXZhbHVhdGlvbjogSW5kaXZpZHVhbEV2YWx1YXRpb25TY2hlbWFcclxuICB9LFxyXG5cclxuICAvLyDYp9mE2KrYrdmE2YrZhCDZiNin2YTZhdmE2K7YtVxyXG4gIHN1bW1hcnk6IHtcclxuICAgIC8vINin2YTZhtiq2KfYptisINin2YTZhdix2KzYrdipXHJcbiAgICB3ZWlnaHRlZFNjb3Jlczoge1xyXG4gICAgICBtYW5hZ2VtZW50OiBOdW1iZXIsICAgICAgLy8g2YjYstmGIDQwJVxyXG4gICAgICBwZWVyczogTnVtYmVyLCAgICAgICAgICAgLy8g2YjYstmGIDMwJVxyXG4gICAgICByZWNpcGllbnRzOiBOdW1iZXIsICAgICAgLy8g2YjYstmGIDIwJVxyXG4gICAgICBzZWxmOiBOdW1iZXIgICAgICAgICAgICAgLy8g2YjYstmGIDEwJVxyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8g2KfZhNmG2KrZitis2Kkg2KfZhNmG2YfYp9im2YrYqVxyXG4gICAgb3ZlcmFsbFNjb3JlOiBOdW1iZXIsXHJcbiAgICBvdmVyYWxsUmF0aW5nOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgZW51bTogWyfZhdmF2KrYp9iyJywgJ9is2YrYryDYrNiv2KfZiycsICfYrNmK2K8nLCAn2YXZgtio2YjZhCcsICfYtti52YrZgSddLFxyXG4gICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8g2KfZhNmF2YTYrti1INin2YTYqtmG2YHZitiw2YpcclxuICAgIGV4ZWN1dGl2ZVN1bW1hcnk6IFN0cmluZyxcclxuICAgIGtleUFjaGlldmVtZW50czogW1N0cmluZ10sXHJcbiAgICBtYWluQ2hhbGxlbmdlczogW1N0cmluZ10sXHJcbiAgICBcclxuICAgIC8vINin2YTYqtmI2LXZitin2Kog2KfZhNi52KfZhdipXHJcbiAgICBwcm9tb3Rpb25SZWNvbW1lbmRlZDogQm9vbGVhbixcclxuICAgIHRyYWluaW5nTmVlZHM6IFtTdHJpbmddLFxyXG4gICAgY2FyZWVyUGF0aFJlY29tbWVuZGF0aW9uOiBTdHJpbmcsXHJcbiAgICBzYWxhcnlBZGp1c3RtZW50UmVjb21tZW5kZWQ6IEJvb2xlYW4sXHJcbiAgICBzYWxhcnlBZGp1c3RtZW50UGVyY2VudGFnZTogTnVtYmVyXHJcbiAgfSxcclxuXHJcbiAgLy8g2YXYudmE2YjZhdin2Kog2KfZhNmF2YjYp9ix2K8g2KfZhNio2LTYsdmK2KlcclxuICBock5vdGVzOiBTdHJpbmcsXHJcbiAgYXBwcm92ZWRCeToge1xyXG4gICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgcmVmOiAnVXNlcidcclxuICB9LFxyXG4gIGFwcHJvdmFsRGF0ZTogRGF0ZSxcclxuXHJcbiAgLy8g2K3Yp9mE2Kkg2KfZhNiq2YLZitmK2YVcclxuICBzdGF0dXM6IHtcclxuICAgIHR5cGU6IFN0cmluZyxcclxuICAgIGVudW06IFsnZHJhZnQnLCAnaW5fcHJvZ3Jlc3MnLCAncGVuZGluZ19yZXZpZXcnLCAnYXBwcm92ZWQnLCAnYXJjaGl2ZWQnXSxcclxuICAgIGRlZmF1bHQ6ICdkcmFmdCdcclxuICB9LFxyXG5cclxuICAvLyDYp9mE2KzYr9mI2YQg2KfZhNiy2YXZhtmKXHJcbiAgY3JlYXRlZEF0OiB7IHR5cGU6IERhdGUsIGRlZmF1bHQ6IERhdGUubm93IH0sXHJcbiAgdXBkYXRlZEF0OiB7IHR5cGU6IERhdGUsIGRlZmF1bHQ6IERhdGUubm93IH0sXHJcbiAgc3VibWl0dGVkQXQ6IERhdGUsXHJcbiAgcmV2aWV3ZWRBdDogRGF0ZVxyXG59KTtcclxuXHJcbi8vIEluZGV4ZXNcclxuUGVyZm9ybWFuY2VFdmFsdWF0aW9uU2NoZW1hLmluZGV4KHsgZW1wbG95ZWVJZDogMSwgJ2V2YWx1YXRpb25QZXJpb2Quc3RhcnREYXRlJzogLTEgfSk7XHJcblBlcmZvcm1hbmNlRXZhbHVhdGlvblNjaGVtYS5pbmRleCh7IHN0YXR1czogMSB9KTtcclxuUGVyZm9ybWFuY2VFdmFsdWF0aW9uU2NoZW1hLmluZGV4KHsgJ3N1bW1hcnkub3ZlcmFsbFJhdGluZyc6IDEgfSk7XHJcblxyXG4vLyBWaXJ0dWFsINmE2YTYrdi12YjZhCDYudmE2Ykg2YXYr9ipINin2YTYqtmC2YrZitmFXHJcblBlcmZvcm1hbmNlRXZhbHVhdGlvblNjaGVtYS52aXJ0dWFsKCdldmFsdWF0aW9uRHVyYXRpb24nKS5nZXQoZnVuY3Rpb24oKSB7XHJcbiAgcmV0dXJuIHRoaXMuZXZhbHVhdGlvblBlcmlvZC5lbmREYXRlIC0gdGhpcy5ldmFsdWF0aW9uUGVyaW9kLnN0YXJ0RGF0ZTtcclxufSk7XHJcblxyXG4vLyBNZXRob2Qg2YTYrdiz2KfYqCDYp9mE2YbYqtmK2KzYqSDYp9mE2YbZh9in2KbZitipXHJcblBlcmZvcm1hbmNlRXZhbHVhdGlvblNjaGVtYS5tZXRob2RzLmNhbGN1bGF0ZU92ZXJhbGxTY29yZSA9IGZ1bmN0aW9uKCkge1xyXG4gIGNvbnN0IHdlaWdodHMgPSB7XHJcbiAgICBtYW5hZ2VtZW50OiAwLjQsXHJcbiAgICBwZWVyczogMC4zLFxyXG4gICAgcmVjaXBpZW50czogMC4yLFxyXG4gICAgc2VsZjogMC4xXHJcbiAgfTtcclxuXHJcbiAgbGV0IHdlaWdodGVkVG90YWwgPSAwO1xyXG4gIGxldCB0b3RhbFdlaWdodCA9IDA7XHJcblxyXG4gIGlmICh0aGlzLmV2YWx1YXRpb25zLm1hbmFnZW1lbnRFdmFsdWF0aW9uICYmIHRoaXMuZXZhbHVhdGlvbnMubWFuYWdlbWVudEV2YWx1YXRpb24uc2NvcmUpIHtcclxuICAgIHdlaWdodGVkVG90YWwgKz0gdGhpcy5ldmFsdWF0aW9ucy5tYW5hZ2VtZW50RXZhbHVhdGlvbi5zY29yZSAqIHdlaWdodHMubWFuYWdlbWVudDtcclxuICAgIHRvdGFsV2VpZ2h0ICs9IHdlaWdodHMubWFuYWdlbWVudDtcclxuICB9XHJcblxyXG4gIGlmICh0aGlzLmV2YWx1YXRpb25zLnBlZXJFdmFsdWF0aW9ucyAmJiB0aGlzLmV2YWx1YXRpb25zLnBlZXJFdmFsdWF0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICBjb25zdCBwZWVyQXZlcmFnZSA9IHRoaXMuZXZhbHVhdGlvbnMucGVlckV2YWx1YXRpb25zLnJlZHVjZSgoc3VtLCBldmFsdWF0aW9uKSA9PiBzdW0gKyBldmFsdWF0aW9uLnNjb3JlLCAwKSAvIHRoaXMuZXZhbHVhdGlvbnMucGVlckV2YWx1YXRpb25zLmxlbmd0aDtcclxuICAgIHdlaWdodGVkVG90YWwgKz0gcGVlckF2ZXJhZ2UgKiB3ZWlnaHRzLnBlZXJzO1xyXG4gICAgdG90YWxXZWlnaHQgKz0gd2VpZ2h0cy5wZWVycztcclxuICB9XHJcblxyXG4gIGlmICh0aGlzLmV2YWx1YXRpb25zLnJlY2lwaWVudEV2YWx1YXRpb25zICYmIHRoaXMuZXZhbHVhdGlvbnMucmVjaXBpZW50RXZhbHVhdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgY29uc3QgcmVjaXBpZW50QXZlcmFnZSA9IHRoaXMuZXZhbHVhdGlvbnMucmVjaXBpZW50RXZhbHVhdGlvbnMucmVkdWNlKChzdW0sIGV2YWx1YXRpb24pID0+IHN1bSArIGV2YWx1YXRpb24uc2NvcmUsIDApIC8gdGhpcy5ldmFsdWF0aW9ucy5yZWNpcGllbnRFdmFsdWF0aW9ucy5sZW5ndGg7XHJcbiAgICB3ZWlnaHRlZFRvdGFsICs9IHJlY2lwaWVudEF2ZXJhZ2UgKiB3ZWlnaHRzLnJlY2lwaWVudHM7XHJcbiAgICB0b3RhbFdlaWdodCArPSB3ZWlnaHRzLnJlY2lwaWVudHM7XHJcbiAgfVxyXG5cclxuICBpZiAodGhpcy5ldmFsdWF0aW9ucy5zZWxmRXZhbHVhdGlvbiAmJiB0aGlzLmV2YWx1YXRpb25zLnNlbGZFdmFsdWF0aW9uLnNjb3JlKSB7XHJcbiAgICB3ZWlnaHRlZFRvdGFsICs9IHRoaXMuZXZhbHVhdGlvbnMuc2VsZkV2YWx1YXRpb24uc2NvcmUgKiB3ZWlnaHRzLnNlbGY7XHJcbiAgICB0b3RhbFdlaWdodCArPSB3ZWlnaHRzLnNlbGY7XHJcbiAgfVxyXG5cclxuICB0aGlzLnN1bW1hcnkub3ZlcmFsbFNjb3JlID0gdG90YWxXZWlnaHQgPiAwID8gd2VpZ2h0ZWRUb3RhbCAvIHRvdGFsV2VpZ2h0IDogMDtcclxuXHJcbiAgLy8g2KrYrdiv2YrYryDYp9mE2KrZgtmK2YrZhSDYudmE2Ykg2KPYs9in2LMg2KfZhNmG2KrZitis2KlcclxuICBpZiAodGhpcy5zdW1tYXJ5Lm92ZXJhbGxTY29yZSA+PSA0LjUpIHtcclxuICAgIHRoaXMuc3VtbWFyeS5vdmVyYWxsUmF0aW5nID0gJ9mF2YXYqtin2LInO1xyXG4gIH0gZWxzZSBpZiAodGhpcy5zdW1tYXJ5Lm92ZXJhbGxTY29yZSA+PSA0KSB7XHJcbiAgICB0aGlzLnN1bW1hcnkub3ZlcmFsbFJhdGluZyA9ICfYrNmK2K8g2KzYr9in2YsnO1xyXG4gIH0gZWxzZSBpZiAodGhpcy5zdW1tYXJ5Lm92ZXJhbGxTY29yZSA+PSAzLjUpIHtcclxuICAgIHRoaXMuc3VtbWFyeS5vdmVyYWxsUmF0aW5nID0gJ9is2YrYryc7XHJcbiAgfSBlbHNlIGlmICh0aGlzLnN1bW1hcnkub3ZlcmFsbFNjb3JlID49IDIuNSkge1xyXG4gICAgdGhpcy5zdW1tYXJ5Lm92ZXJhbGxSYXRpbmcgPSAn2YXZgtio2YjZhCc7XHJcbiAgfSBlbHNlIHtcclxuICAgIHRoaXMuc3VtbWFyeS5vdmVyYWxsUmF0aW5nID0gJ9i22LnZitmBJztcclxuICB9XHJcblxyXG4gIHJldHVybiB0aGlzLnN1bW1hcnkub3ZlcmFsbFNjb3JlO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnUGVyZm9ybWFuY2VFdmFsdWF0aW9uJywgUGVyZm9ybWFuY2VFdmFsdWF0aW9uU2NoZW1hKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7O0FBRXBDO0FBQ0EsTUFBTUMsd0JBQXdCLEdBQUcsSUFBSUYsUUFBUSxDQUFDRyxNQUFNLENBQUM7RUFDbkRDLFFBQVEsRUFBRTtJQUNSQyxJQUFJLEVBQUVDLE1BQU07SUFDWkMsSUFBSSxFQUFFLENBQ0osa0JBQWtCO0lBQU87SUFDekIsYUFBYTtJQUFhO0lBQzFCLFlBQVk7SUFBYztJQUMxQixVQUFVO0lBQWdCO0lBQzFCLGVBQWU7SUFBVztJQUMxQixjQUFjO0lBQVk7SUFDMUIsU0FBUztJQUFpQjtJQUMxQixhQUFhO0lBQWE7SUFDMUIsWUFBWTtJQUFjO0lBQzFCLGtCQUFrQixDQUFRO0lBQUE7RUFFOUIsQ0FBQztFQUNEQyxZQUFZLEVBQUVGLE1BQU07RUFDcEJHLFdBQVcsRUFBRUgsTUFBTTtFQUNuQkksTUFBTSxFQUFFQyxNQUFNO0VBQUU7RUFDaEJDLFFBQVEsRUFBRTtJQUNSUCxJQUFJLEVBQUVNLE1BQU07SUFDWkUsT0FBTyxFQUFFO0VBQ1g7QUFDRixDQUFDLENBQUM7O0FBRUY7QUFDQSxNQUFNQywwQkFBMEIsR0FBRyxJQUFJZCxRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUNyRFksV0FBVyxFQUFFO0lBQ1hWLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNhLEtB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