{"version":3,"names":["mongoose","require","EvaluationCriteriaSchema","Schema","category","type","String","enum","criteriaName","description","weight","Number","maxScore","default","IndividualEvaluationSchema","evaluatedBy","Types","ObjectId","ref","required","evaluationType","score","scores","criteriaId","min","max","comment","comments","strengths","areasForImprovement","recommendations","createdAt","Date","now","updatedAt","PerformanceEvaluationSchema","employeeId","evaluationPeriod","startDate","endDate","evaluations","managementEvaluation","peerEvaluations","recipientEvaluations","selfEvaluation","summary","weightedScores","management","peers","recipients","self","overallScore","overallRating","executiveSummary","keyAchievements","mainChallenges","promotionRecommended","Boolean","trainingNeeds","careerPathRecommendation","salaryAdjustmentRecommended","salaryAdjustmentPercentage","hrNotes","approvedBy","approvalDate","status","submittedAt","reviewedAt","index","virtual","get","methods","calculateOverallScore","weights","weightedTotal","totalWeight","length","peerAverage","reduce","sum","evaluation","recipientAverage","module","exports","model"],"sources":["PerformanceEvaluation.js"],"sourcesContent":["/**\r\n * نموذج نظام التقييم المتقدم\r\n * Advanced Performance Evaluation System Model\r\n */\r\n\r\nconst mongoose = require('mongoose');\r\n\r\n// Schema لمعايير التقييم\r\nconst EvaluationCriteriaSchema = new mongoose.Schema({\r\n  category: {\r\n    type: String,\r\n    enum: [\r\n      'technical_skills',      // المهارات التقنية\r\n      'soft_skills',            // المهارات اللينة\r\n      'leadership',             // القيادة\r\n      'teamwork',               // العمل الجماعي\r\n      'communication',          // التواصل\r\n      'productivity',           // الإنتاجية\r\n      'quality',                // جودة العمل\r\n      'reliability',            // الموثوقية\r\n      'innovation',             // الابتكار\r\n      'customer_service'        // خدمة العملاء\r\n    ]\r\n  },\r\n  criteriaName: String,\r\n  description: String,\r\n  weight: Number, // وزن المعيار من 0-1\r\n  maxScore: {\r\n    type: Number,\r\n    default: 5\r\n  }\r\n});\r\n\r\n// Schema لتقييم الفرد الواحد\r\nconst IndividualEvaluationSchema = new mongoose.Schema({\r\n  evaluatedBy: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: 'User',\r\n    required: true\r\n  },\r\n  evaluationType: {\r\n    type: String,\r\n    enum: ['management', 'peer', 'recipient', 'self'],\r\n    required: true\r\n  },\r\n  score: Number, // النتيجة الإجمالية\r\n  scores: [{\r\n    criteriaId: String,\r\n    criteriaName: String,\r\n    score: {\r\n      type: Number,\r\n      min: 1,\r\n      max: 5\r\n    },\r\n    comment: String\r\n  }],\r\n  comments: String,\r\n  strengths: [String],\r\n  areasForImprovement: [String],\r\n  recommendations: String,\r\n  createdAt: { type: Date, default: Date.now },\r\n  updatedAt: { type: Date, default: Date.now }\r\n});\r\n\r\n// Schema الرئيسي للتقييم الشامل\r\nconst PerformanceEvaluationSchema = new mongoose.Schema({\r\n  employeeId: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: 'User',\r\n    required: true\r\n  },\r\n  evaluationPeriod: {\r\n    startDate: {\r\n      type: Date,\r\n      required: true\r\n    },\r\n    endDate: {\r\n      type: Date,\r\n      required: true\r\n    }\r\n  },\r\n  \r\n  // التقييمات من الجهات المختلفة\r\n  evaluations: {\r\n    // تقييم من الإدارة\r\n    managementEvaluation: IndividualEvaluationSchema,\r\n    \r\n    // تقييمات الزملاء\r\n    peerEvaluations: [IndividualEvaluationSchema],\r\n    \r\n    // تقييمات المستفيدين/الأسر\r\n    recipientEvaluations: [IndividualEvaluationSchema],\r\n    \r\n    // التقييم الذاتي\r\n    selfEvaluation: IndividualEvaluationSchema\r\n  },\r\n\r\n  // التحليل والملخص\r\n  summary: {\r\n    // النتائج المرجحة\r\n    weightedScores: {\r\n      management: Number,      // وزن 40%\r\n      peers: Number,           // وزن 30%\r\n      recipients: Number,      // وزن 20%\r\n      self: Number             // وزن 10%\r\n    },\r\n    \r\n    // النتيجة النهائية\r\n    overallScore: Number,\r\n    overallRating: {\r\n      type: String,\r\n      enum: ['ممتاز', 'جيد جداً', 'جيد', 'مقبول', 'ضعيف'],\r\n      required: true\r\n    },\r\n    \r\n    // الملخص التنفيذي\r\n    executiveSummary: String,\r\n    keyAchievements: [String],\r\n    mainChallenges: [String],\r\n    \r\n    // التوصيات العامة\r\n    promotionRecommended: Boolean,\r\n    trainingNeeds: [String],\r\n    careerPathRecommendation: String,\r\n    salaryAdjustmentRecommended: Boolean,\r\n    salaryAdjustmentPercentage: Number\r\n  },\r\n\r\n  // معلومات الموارد البشرية\r\n  hrNotes: String,\r\n  approvedBy: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: 'User'\r\n  },\r\n  approvalDate: Date,\r\n\r\n  // حالة التقييم\r\n  status: {\r\n    type: String,\r\n    enum: ['draft', 'in_progress', 'pending_review', 'approved', 'archived'],\r\n    default: 'draft'\r\n  },\r\n\r\n  // الجدول الزمني\r\n  createdAt: { type: Date, default: Date.now },\r\n  updatedAt: { type: Date, default: Date.now },\r\n  submittedAt: Date,\r\n  reviewedAt: Date\r\n});\r\n\r\n// Indexes\r\nPerformanceEvaluationSchema.index({ employeeId: 1, 'evaluationPeriod.startDate': -1 });\r\nPerformanceEvaluationSchema.index({ status: 1 });\r\nPerformanceEvaluationSchema.index({ 'summary.overallRating': 1 });\r\n\r\n// Virtual للحصول على مدة التقييم\r\nPerformanceEvaluationSchema.virtual('evaluationDuration').get(function() {\r\n  return this.evaluationPeriod.endDate - this.evaluationPeriod.startDate;\r\n});\r\n\r\n// Method لحساب النتيجة النهائية\r\nPerformanceEvaluationSchema.methods.calculateOverallScore = function() {\r\n  const weights = {\r\n    management: 0.4,\r\n    peers: 0.3,\r\n    recipients: 0.2,\r\n    self: 0.1\r\n  };\r\n\r\n  let weightedTotal = 0;\r\n  let totalWeight = 0;\r\n\r\n  if (this.evaluations.managementEvaluation && this.evaluations.managementEvaluation.score) {\r\n    weightedTotal += this.evaluations.managementEvaluation.score * weights.management;\r\n    totalWeight += weights.management;\r\n  }\r\n\r\n  if (this.evaluations.peerEvaluations && this.evaluations.peerEvaluations.length > 0) {\r\n    const peerAverage = this.evaluations.peerEvaluations.reduce((sum, evaluation) => sum + evaluation.score, 0) / this.evaluations.peerEvaluations.length;\r\n    weightedTotal += peerAverage * weights.peers;\r\n    totalWeight += weights.peers;\r\n  }\r\n\r\n  if (this.evaluations.recipientEvaluations && this.evaluations.recipientEvaluations.length > 0) {\r\n    const recipientAverage = this.evaluations.recipientEvaluations.reduce((sum, evaluation) => sum + evaluation.score, 0) / this.evaluations.recipientEvaluations.length;\r\n    weightedTotal += recipientAverage * weights.recipients;\r\n    totalWeight += weights.recipients;\r\n  }\r\n\r\n  if (this.evaluations.selfEvaluation && this.evaluations.selfEvaluation.score) {\r\n    weightedTotal += this.evaluations.selfEvaluation.score * weights.self;\r\n    totalWeight += weights.self;\r\n  }\r\n\r\n  this.summary.overallScore = totalWeight > 0 ? weightedTotal / totalWeight : 0;\r\n\r\n  // تحديد التقييم على أساس النتيجة\r\n  if (this.summary.overallScore >= 4.5) {\r\n    this.summary.overallRating = 'ممتاز';\r\n  } else if (this.summary.overallScore >= 4) {\r\n    this.summary.overallRating = 'جيد جداً';\r\n  } else if (this.summary.overallScore >= 3.5) {\r\n    this.summary.overallRating = 'جيد';\r\n  } else if (this.summary.overallScore >= 2.5) {\r\n    this.summary.overallRating = 'مقبول';\r\n  } else {\r\n    this.summary.overallRating = 'ضعيف';\r\n  }\r\n\r\n  return this.summary.overallScore;\r\n};\r\n\r\nmodule.exports = mongoose.model('PerformanceEvaluation', PerformanceEvaluationSchema);\r\n"],"mappings":"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","ignoreList":[]}