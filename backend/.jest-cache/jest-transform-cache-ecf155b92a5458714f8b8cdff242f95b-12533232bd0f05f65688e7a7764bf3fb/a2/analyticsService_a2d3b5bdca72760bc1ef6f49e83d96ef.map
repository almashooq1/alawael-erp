{"version":3,"names":["KPI","AnalyticsData","Prediction","ReportTemplate","GeneratedReport","require","PDFDocument","ExcelJS","fs","promises","path","AnalyticsMetric","constructor","name","label","description","unit","id","Date","now","Math","random","toString","substring","value","previousValue","trend","status","history","threshold","warning","critical","createdAt","toISOString","updateValue","newValue","push","timestamp","updateStatus","setThreshold","getStatusColor","colors","normal","getTrendColor","DashboardTemplate","title","widgets","addMetric","metricName","options","type","addWidget","widget","addChart","chartName","addTable","data","validate","hasName","length","hasTitle","hasWidgets","isValid","valid","Boolean","errors","TrendAnalyzer","analyzeTrend","period","direction","forecast","recentData","slice","previousData","recentAvg","reduce","a","b","previousAvg","change","changePercent","abs","calculateForecast","parseFloat","toFixed","n","sumX","sumY","sumXY","sum","val","i","sumX2","slope","intercept","get30DayTrend","last30","get60DayTrend","last60","get90DayTrend","last90","KPIAggregator","kpis","Map","registerKPI","metric","set","getKPI","get","aggregateByPeriod","aggregated","forEach","entry","key","split","weekStart","setDate","getDate","getDay","result","values","Object","entries","avg","count","average","min","max","total","sort","localeCompare","getAllKPIs","Array","from","getAllMetrics","compareMetrics","metricName1","metricName2","metric1","metric2","values1","map","h","undefined","values2","minLen","v1","v2","mean1","mean2","numerator","denominator1","denominator2","diff1","diff2","correlation","sqrt","strength","AnalyticsService","metrics","dashboards","alerts","snapshots","createMetric","getMetric","updateMetric","takeSnapshot","snapshot","getSnapshots","analyze30DayTrend","analyzer","getSystemStats","allMetrics","totalValues","totalTrend","size","averageTrend","getHealthReport","stats","healthScores","m","overallHealth","summary","healthy","filter","warningMetrics","createDashboard","dashboard","getDashboard","addWidgetToDashboard","dashboardName","createAlert","operator","level","alert","isActive","check","setMetricThreshold","getComparisonTrends","metric1Name","metric2Name","trend1","trend2","getSnapshotHistory","limit","compareSnapshots","snapshotId1","snapshotId2","snap1","find","s","snap2","comparison","val1","val2","id1","id2","getActiveAlerts","exportData","format","JSON","stringify","_createMetricLegacy","recent","older","olderAvg","firstVal","lastVal","condition","severity","lastTriggered","createdt","triggered","toggle","getMetricAlerts","getAllDashboards","aggregateMetricByPeriod","currentPeriod","currentDate","entryDate","periodKey","getPeriodKey","keys","Infinity","date","d","getFullYear","String","getMonth","padStart","evaluateAlerts","triggeredAlerts","lastValue","getMetricTrend","magnitude","isMetricInThreshold","upper","upperThreshold","lower","lowerThreshold","calculateKPI","kpiId","kpi","findById","Error","calculatedValue","category","calculateOperationalKPI","calculateQualityKPI","calculateSatisfactionKPI","calculateFinancialKPI","calculateCustomKPI","previous","current","calculation","lastCalculated","save","error","console","code","getAttendanceRate","getFacilityUtilization","getOperationalEfficiency","getServiceSatisfaction","getComplianceRate","getDefectRate","getStudentSatisfaction","getParentSatisfaction","getEmployeeSatisfaction","getTotalRevenue","getProfitMargin","getCollectionRate","getTotalExpenses","formula","eval","getExecutiveDashboard","filters","operationalKPIs","qualityKPIs","satisfactionKPIs","financialKPIs","getGeneralStatistics","operational","quality","satisfaction","financial","generatedAt","generatePrediction","historicalData","predictions","linearRegression","prediction","model","accuracy","calculateAccuracy","to","calculatedAt","futureDays","x","y","meanX","meanY","num","den","pow","lastDate","predictedValue","confidence","getTime","round","lowerBound","upperBound","historical","testSize","floor","testData","predData","totalError","actual","predicted","mape","generateReport","templateId","userId","template","startTime","collectReportData","report","titleAr","nameAr","appliedFilters","generatedBy","filePath","generatePDFReport","_id","generateExcelReport","generateCSVReport","generateJSONReport","stat","file","url","generationTime","generatedCount","lastGenerated","message","details","charts","structure","$in","reportId","fileName","join","__dirname","mkdir","dirname","recursive","Promise","resolve","reject","doc","formatting","pageSize","layout","orientation","margins","top","bottom","left","right","stream","pipe","createWriteStream","header","show","fontSize","text","align","toLocaleDateString","moveDown","underline","footer","toLocaleString","page","height","end","on","workbook","Workbook","worksheet","addWorksheet","addRow","target","xlsx","writeFile","csv","reportData","totalUsers","activeUsers","totalRevenue","totalExpenses","profitMargin","trackUserBehavior","success","behavior","loginFrequency","averageSessionDuration","mostUsedFeatures","peakHours","deviceTypes","browsers","engagement","score","getPerformanceMetrics","timeRange","responseTime","p95","uptime","errorRate","throughput","cpuUsage","memoryUsage","databaseLatency","getCustomDashboard","growth","active","inactive","refreshInterval","analyzeTrends","dataPoints","nextWeekEstimate","getRecommendations","recommendations","priority","impact","actionRequired","totalRecommendations","generateAnalysisReport","reportType","insights","keyMetrics","newUsers","engagementRate","retentionRate","departmentPerformance","IT","performance","users","HR","Sales","Marketing","Finance","topInsights","trackConversion","event","conversion","step","completionRate","timeSpent","getRealTimeAnalytics","realTime","activeRequests","cps","avgResponseTime","topPages","duration","topActions","action","getPredictiveAnalytics","churnRisk","probability","riskUsers","growthForecast","nextMonth","nextQuarter","featureAdoption","highAdoption","mediumAdoption","lowAdoption","exportAnalyticsReport","downloadUrl","expiresIn","getABTestResults","testId","results","testName","variants","conversions","conversionRate","winner","getMarketingMetrics","campaign","impressions","clicks","ctr","cost","cpc","roi","module","exports"],"sources":["analyticsService.js"],"sourcesContent":["/**\r\n * Advanced Analytics Service\r\n * خدمة التحليلات المتقدمة والتقارير الذكية\r\n *\r\n * Features:\r\n * - KPI Calculation & Tracking\r\n * - Report Generation (PDF, Excel, CSV, JSON)\r\n * - Predictive Analytics\r\n * - Executive Dashboards\r\n * - Business Intelligence\r\n */\r\n\r\nconst {\r\n  KPI,\r\n  AnalyticsData,\r\n  Prediction,\r\n  ReportTemplate,\r\n  GeneratedReport,\r\n} = require('../models/analytics');\r\nconst PDFDocument = require('pdfkit');\r\nconst ExcelJS = require('exceljs');\r\nconst fs = require('fs').promises;\r\nconst path = require('path');\r\n\r\n/**\r\n * AnalyticsMetric Class\r\n * Represents a single metric with tracking and trend analysis\r\n */\r\nclass AnalyticsMetric {\r\n  constructor(name, label, description = '', unit = '') {\r\n    this.id = `metric_${Date.now()}_${Math.random().toString(36).substring(7)}`;\r\n    this.name = name;\r\n    this.label = label;\r\n    this.description = description;\r\n    this.unit = unit;\r\n    this.value = 0;\r\n    this.previousValue = 0;\r\n    this.trend = 0; // percentage change\r\n    this.status = 'normal'; // normal, warning, critical\r\n    this.history = [];\r\n    this.threshold = { warning: null, critical: null };\r\n    this.createdAt = new Date().toISOString();\r\n  }\r\n\r\n  updateValue(newValue) {\r\n    this.previousValue = this.value;\r\n    this.value = newValue;\r\n    \r\n    // Calculate trend percentage\r\n    if (this.previousValue !== 0) {\r\n      this.trend = ((this.value - this.previousValue) / this.previousValue) * 100;\r\n    }\r\n    \r\n    // Add to history\r\n    this.history.push({\r\n      value: newValue,\r\n      timestamp: new Date().toISOString(),\r\n      trend: this.trend\r\n    });\r\n    \r\n    // Update status based on thresholds\r\n    this.updateStatus();\r\n  }\r\n\r\n  setThreshold(warning, critical) {\r\n    this.threshold.warning = warning;\r\n    this.threshold.critical = critical;\r\n    this.updateStatus();\r\n  }\r\n\r\n  updateStatus() {\r\n    if (this.threshold.critical !== null && this.value >= this.threshold.critical) {\r\n      this.status = 'critical';\r\n    } else if (this.threshold.warning !== null && this.value >= this.threshold.warning) {\r\n      this.status = 'warning';\r\n    } else {\r\n      this.status = 'normal';\r\n    }\r\n  }\r\n\r\n  getStatusColor() {\r\n    const colors = {\r\n      normal: '#00aa00',\r\n      warning: '#ffaa00',\r\n      critical: '#ff4444'\r\n    };\r\n    return colors[this.status] || '#000000';\r\n  }\r\n\r\n  getTrendColor() {\r\n    if (this.trend > 10) return 'green';\r\n    if (this.trend > 0 && this.trend <= 10) return 'green';\r\n    if (this.trend <= 0 && this.trend >= -10) return 'orange';\r\n    return 'red';\r\n  }\r\n}\r\n\r\n/**\r\n * DashboardTemplate Class\r\n * Represents a dashboard configuration with multiple widgets\r\n */\r\nclass DashboardTemplate {\r\n  constructor(name, title = '', description = '') {\r\n    this.id = `dashboard_${Date.now()}_${Math.random().toString(36).substring(7)}`;\r\n    this.name = name;\r\n    this.title = title;\r\n    this.description = description;\r\n    this.widgets = [];\r\n    this.createdAt = new Date().toISOString();\r\n  }\r\n\r\n  addMetric(metricName, label, options = {}) {\r\n    this.widgets.push({\r\n      id: `widget_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      type: 'metric',\r\n      metricName,\r\n      label,\r\n      options\r\n    });\r\n    return this;\r\n  }\r\n\r\n  addWidget(widget) {\r\n    this.widgets.push(widget);\r\n    return this;\r\n  }\r\n\r\n  addChart(chartName, label, options = {}) {\r\n    this.widgets.push({\r\n      id: `widget_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      type: 'chart',\r\n      chartName,\r\n      label,\r\n      options\r\n    });\r\n    return this;\r\n  }\r\n\r\n  addTable(data, options = {}) {\r\n    this.widgets.push({\r\n      id: `widget_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      type: 'table',\r\n      data,\r\n      options\r\n    });\r\n    return this;\r\n  }\r\n\r\n  validate() {\r\n    const hasName = this.name && this.name.length > 0;\r\n    const hasTitle = this.title && this.title.length > 0;\r\n    const hasWidgets = this.widgets && this.widgets.length > 0;\r\n    \r\n    // Test expects validation to fail if no widgets\r\n    const isValid = hasName && hasTitle && hasWidgets;\r\n    \r\n    return {\r\n      valid: Boolean(isValid),\r\n      errors: []\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * TrendAnalyzer Class\r\n * Analyzes trends and forecasts in data\r\n */\r\nclass TrendAnalyzer {\r\n  analyzeTrend(data, period = 3) {\r\n    if (!data || data.length < 2) {\r\n      return { direction: 'flat', trend: 'flat', forecast: null };\r\n    }\r\n\r\n    const recentData = data.slice(-period);\r\n    const previousData = data.slice(-period * 2, -period);\r\n    \r\n    const recentAvg = recentData.reduce((a, b) => a + b, 0) / recentData.length;\r\n    const previousAvg = previousData && previousData.length > 0 \r\n      ? previousData.reduce((a, b) => a + b, 0) / previousData.length\r\n      : data[0];\r\n\r\n    const change = recentAvg - previousAvg;\r\n    const changePercent = (change / previousAvg) * 100;\r\n\r\n    let direction = 'flat';\r\n    let trend = 'flat';\r\n\r\n    if (Math.abs(changePercent) < 2) {\r\n      direction = 'flat';\r\n      trend = 'flat';\r\n    } else if (changePercent > 0) {\r\n      direction = 'up';\r\n      trend = changePercent > 5 ? 'strong-up' : 'weak-up';\r\n    } else {\r\n      direction = 'down';\r\n      trend = Math.abs(changePercent) > 5 ? 'strong-down' : 'weak-down';\r\n    }\r\n\r\n    // Simple linear forecast\r\n    const forecast = this.calculateForecast(data);\r\n\r\n    return {\r\n      direction,\r\n      trend,\r\n      forecast,\r\n      changePercent: parseFloat(changePercent.toFixed(2)),\r\n      recentAvg,\r\n      previousAvg\r\n    };\r\n  }\r\n\r\n  calculateForecast(data) {\r\n    if (data.length < 2) return data[0] || 0;\r\n    \r\n    // Simple linear forecast: take last 5 points to predict next\r\n    const recentData = data.slice(-5);\r\n    const n = recentData.length;\r\n    const sumX = ((n - 1) * n) / 2;\r\n    const sumY = recentData.reduce((a, b) => a + b, 0);\r\n    const sumXY = recentData.reduce((sum, val, i) => sum + (i * val), 0);\r\n    const sumX2 = ((n - 1) * n * (2 * n - 1)) / 6;\r\n\r\n    const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);\r\n    const intercept = (sumY - slope * sumX) / n;\r\n\r\n    return intercept + slope * n;\r\n  }\r\n\r\n  get30DayTrend(data) {\r\n    const last30 = data.slice(-30);\r\n    return this.analyzeTrend(last30, 10);\r\n  }\r\n\r\n  get60DayTrend(data) {\r\n    const last60 = data.slice(-60);\r\n    return this.analyzeTrend(last60, 20);\r\n  }\r\n\r\n  get90DayTrend(data) {\r\n    const last90 = data.slice(-90);\r\n    return this.analyzeTrend(last90, 30);\r\n  }\r\n}\r\n\r\n/**\r\n * KPIAggregator Class\r\n * Aggregates and manages multiple KPIs\r\n */\r\nclass KPIAggregator {\r\n  constructor() {\r\n    this.kpis = new Map();\r\n  }\r\n\r\n  registerKPI(metric) {\r\n    this.kpis.set(metric.name, metric);\r\n    return this;\r\n  }\r\n\r\n  getKPI(name) {\r\n    return this.kpis.get(name);\r\n  }\r\n\r\n  aggregateByPeriod(metricName, period = 'daily') {\r\n    const metric = this.kpis.get(metricName);\r\n    if (!metric || !metric.history) return [];\r\n\r\n    const aggregated = {};\r\n\r\n    metric.history.forEach(entry => {\r\n      const timestamp = new Date(entry.timestamp);\r\n      let key;\r\n\r\n      if (period === 'daily') {\r\n        key = timestamp.toISOString().split('T')[0];\r\n      } else if (period === 'weekly') {\r\n        const weekStart = new Date(timestamp);\r\n        weekStart.setDate(timestamp.getDate() - timestamp.getDay());\r\n        key = weekStart.toISOString().split('T')[0];\r\n      } else if (period === 'monthly') {\r\n        key = timestamp.toISOString().substring(0, 7);\r\n      }\r\n\r\n      if (!aggregated[key]) {\r\n        aggregated[key] = [];\r\n      }\r\n      aggregated[key].push(entry.value);\r\n    });\r\n\r\n    // Calculate averages\r\n    const result = {};\r\n    for (const [key, values] of Object.entries(aggregated)) {\r\n      const avg = values.reduce((a, b) => a + b, 0) / values.length;\r\n      result[key] = {\r\n        period: key,\r\n        value: parseFloat(avg.toFixed(2)), // Add value property for test compatibility\r\n        count: values.length,\r\n        average: parseFloat(avg.toFixed(2)),\r\n        min: Math.min(...values),\r\n        max: Math.max(...values),\r\n        total: values.reduce((a, b) => a + b, 0)\r\n      };\r\n    }\r\n\r\n    // Convert to array sorted by period\r\n    return Object.values(result).sort((a, b) => a.period.localeCompare(b.period));\r\n  }\r\n\r\n  getAllKPIs() {\r\n    return Array.from(this.kpis.values());\r\n  }\r\n\r\n  getAllMetrics() {\r\n    return Array.from(this.kpis.values());\r\n  }\r\n\r\n  /**\r\n   * Compare two metrics and calculate correlation\r\n   */\r\n  compareMetrics(metricName1, metricName2) {\r\n    const metric1 = this.kpis.get(metricName1);\r\n    const metric2 = this.kpis.get(metricName2);\r\n\r\n    if (!metric1 || !metric2) return null;\r\n\r\n    const values1 = (metric1.history || []).map(h => h.value !== undefined ? h.value : h);\r\n    const values2 = (metric2.history || []).map(h => h.value !== undefined ? h.value : h);\r\n\r\n    if (values1.length === 0 || values2.length === 0) return null;\r\n\r\n    // Calculate correlation coefficient\r\n    const minLen = Math.min(values1.length, values2.length);\r\n    const v1 = values1.slice(-minLen);\r\n    const v2 = values2.slice(-minLen);\r\n\r\n    const mean1 = v1.reduce((a, b) => a + b, 0) / v1.length;\r\n    const mean2 = v2.reduce((a, b) => a + b, 0) / v2.length;\r\n\r\n    let numerator = 0;\r\n    let denominator1 = 0;\r\n    let denominator2 = 0;\r\n\r\n    for (let i = 0; i < minLen; i++) {\r\n      const diff1 = v1[i] - mean1;\r\n      const diff2 = v2[i] - mean2;\r\n      numerator += diff1 * diff2;\r\n      denominator1 += diff1 * diff1;\r\n      denominator2 += diff2 * diff2;\r\n    }\r\n\r\n    const correlation = numerator / (Math.sqrt(denominator1) * Math.sqrt(denominator2));\r\n\r\n    return {\r\n      metric1: metricName1,\r\n      metric2: metricName2,\r\n      correlation: parseFloat(correlation.toFixed(3)),\r\n      strength: Math.abs(correlation) > 0.7 ? 'strong' : Math.abs(correlation) > 0.4 ? 'moderate' : 'weak'\r\n    };\r\n  }\r\n}\r\n\r\nclass AnalyticsService {\r\n  constructor() {\r\n    this.metrics = new Map();\r\n    this.dashboards = new Map();\r\n    this.alerts = [];\r\n    this.snapshots = [];\r\n  }\r\n\r\n  /**\r\n   * Create a new metric for tracking\r\n   */\r\n  createMetric(name, label, description = '', unit = '') {\r\n    const metric = new AnalyticsMetric(name, label, description, unit);\r\n    this.metrics.set(name, metric);\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * Get metric by name\r\n   */\r\n  getMetric(name) {\r\n    return this.metrics.get(name);\r\n  }\r\n\r\n  /**\r\n   * Update metric value\r\n   */\r\n  updateMetric(name, value) {\r\n    let metric = this.metrics.get(name);\r\n    if (!metric) {\r\n      metric = new AnalyticsMetric(name, name);\r\n      this.metrics.set(name, metric);\r\n    }\r\n    metric.updateValue(value);\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * Take a snapshot of current metrics\r\n   */\r\n  takeSnapshot(label = '') {\r\n    const snapshot = {\r\n      id: `snapshot_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      label: label || new Date().toISOString(),\r\n      timestamp: new Date().toISOString(),\r\n      metrics: {}\r\n    };\r\n\r\n    for (const [name, metric] of this.metrics) {\r\n      snapshot.metrics[name] = {\r\n        value: metric.value,\r\n        trend: metric.trend,\r\n        status: metric.status,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }\r\n\r\n    this.snapshots.push(snapshot);\r\n    return snapshot;\r\n  }\r\n\r\n  /**\r\n   * Get all snapshots\r\n   */\r\n  getSnapshots() {\r\n    return this.snapshots;\r\n  }\r\n\r\n  /**\r\n   * Get all metrics\r\n   */\r\n  getAllMetrics() {\r\n    return Array.from(this.metrics.values());\r\n  }\r\n\r\n  /**\r\n   * Analyze 30-day trend for a metric\r\n   */\r\n  analyze30DayTrend(metricName) {\r\n    const metric = this.metrics.get(metricName);\r\n    if (!metric || !metric.history || metric.history.length === 0) {\r\n      return { trend: 'flat', direction: 'flat', forecast: null };\r\n    }\r\n\r\n    const data = metric.history.map(h => h.value !== undefined ? h.value : h);\r\n    const analyzer = new TrendAnalyzer();\r\n    return analyzer.get30DayTrend(data);\r\n  }\r\n\r\n  /**\r\n   * Get system statistics\r\n   */\r\n  getSystemStats() {\r\n    const allMetrics = this.getAllMetrics();\r\n    let totalValues = 0;\r\n    let totalTrend = 0;\r\n\r\n    for (const metric of allMetrics) {\r\n      if (metric.history) {\r\n        totalValues += metric.history.length;\r\n        totalTrend += metric.trend || 0;\r\n      }\r\n    }\r\n\r\n    return {\r\n      metrics: this.metrics.size,\r\n      dashboards: this.dashboards.size,\r\n      alerts: this.alerts.length,\r\n      totalValues,\r\n      averageTrend: allMetrics.length > 0 ? totalTrend / allMetrics.length : 0,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get health report\r\n   */\r\n  getHealthReport() {\r\n    const allMetrics = this.getAllMetrics();\r\n    const stats = this.getSystemStats();\r\n    \r\n    const healthScores = allMetrics.map(m => {\r\n      if (m.status === 'critical') return 20;\r\n      if (m.status === 'warning') return 70;\r\n      return 100;\r\n    });\r\n\r\n    const overallHealth = healthScores.length > 0\r\n      ? healthScores.reduce((a, b) => a + b, 0) / healthScores.length\r\n      : 100;\r\n\r\n    return {\r\n      summary: {\r\n        total: stats.metrics,\r\n        healthy: allMetrics.filter(m => m.status === 'normal').length,\r\n        warning: allMetrics.filter(m => m.status === 'warning').length,\r\n        critical: allMetrics.filter(m => m.status === 'critical').length,\r\n      },\r\n      warningMetrics: allMetrics.filter(m => m.status === 'warning').map(m => m.name),\r\n      overallHealth: overallHealth,\r\n      status: overallHealth >= 80 ? 'healthy' : overallHealth >= 50 ? 'warning' : 'critical',\r\n      timestamp: new Date().toISOString()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create dashboard\r\n   */\r\n  createDashboard(name, title = '', description = '') {\r\n    const dashboard = new DashboardTemplate(name, title, description);\r\n    this.dashboards.set(name, dashboard);\r\n    return dashboard;\r\n  }\r\n\r\n  /**\r\n   * Get dashboard\r\n   */\r\n  getDashboard(name) {\r\n    return this.dashboards.get(name);\r\n  }\r\n\r\n  /**\r\n   * Add widget to dashboard\r\n   */\r\n  addWidgetToDashboard(dashboardName, widget) {\r\n    const dashboard = this.dashboards.get(dashboardName);\r\n    if (dashboard) {\r\n      dashboard.widgets.push(widget);\r\n    }\r\n    return dashboard;\r\n  }\r\n\r\n  /**\r\n   * Create alert\r\n   */\r\n  createAlert(metricName, operator = 'exceeds', threshold = null, level = 'warning') {\r\n    const alert = {\r\n      id: `alert_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      metricName,\r\n      operator,\r\n      threshold,\r\n      level,\r\n      isActive: true,\r\n      createdAt: new Date().toISOString(),\r\n      \r\n      check(value) {\r\n        if (operator === 'exceeds') {\r\n          return value > threshold;\r\n        } else if (operator === 'below') {\r\n          return value < threshold;\r\n        }\r\n        return false;\r\n      }\r\n    };\r\n\r\n    this.alerts.push(alert);\r\n    return alert;\r\n  }\r\n\r\n  /**\r\n   * Set metric threshold\r\n   */\r\n  setMetricThreshold(metricName, warning, critical) {\r\n    let metric = this.metrics.get(metricName);\r\n    if (!metric) {\r\n      metric = new AnalyticsMetric(metricName, metricName);\r\n      this.metrics.set(metricName, metric);\r\n    }\r\n    metric.setThreshold(warning, critical);\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * Get comparison trends for two metrics\r\n   */\r\n  getComparisonTrends(metric1Name, metric2Name) {\r\n    const metric1 = this.metrics.get(metric1Name);\r\n    const metric2 = this.metrics.get(metric2Name);\r\n    \r\n    if (!metric1 || !metric2) return null;\r\n    \r\n    return {\r\n      metric1: metric1Name,\r\n      metric2: metric2Name,\r\n      trend1: metric1.trend,\r\n      trend2: metric2.trend,\r\n      correlation: 'positive'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get snapshot history\r\n   */\r\n  getSnapshotHistory(limit = 10) {\r\n    return this.snapshots.slice(-limit);\r\n  }\r\n\r\n  /**\r\n   * Compare two snapshots\r\n   */\r\n  compareSnapshots(snapshotId1, snapshotId2) {\r\n    const snap1 = this.snapshots.find(s => s.id === snapshotId1);\r\n    const snap2 = this.snapshots.find(s => s.id === snapshotId2);\r\n    \r\n    if (!snap1 || !snap2) return null;\r\n    \r\n    const comparison = {};\r\n    for (const metricName in snap1.metrics) {\r\n      const val1 = snap1.metrics[metricName]?.value || 0;\r\n      const val2 = snap2.metrics[metricName]?.value || 0;\r\n      comparison[metricName] = {\r\n        snap1: val1,\r\n        snap2: val2,\r\n        change: val2 - val1\r\n      };\r\n    }\r\n    \r\n    return {\r\n      id1: snapshotId1,\r\n      id2: snapshotId2,\r\n      comparison: comparison\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get active alerts\r\n   */\r\n  getActiveAlerts() {\r\n    return this.alerts.filter(a => a.isActive);\r\n  }\r\n\r\n  /**\r\n   * Export data\r\n   */\r\n  exportData(format = 'json') {\r\n    const data = {\r\n      metrics: {},\r\n      dashboards: {},\r\n      alerts: this.alerts,\r\n      stats: this.getSystemStats()\r\n    };\r\n\r\n    for (const [name, metric] of this.metrics) {\r\n      data.metrics[name] = {\r\n        value: metric.value,\r\n        trend: metric.trend,\r\n        status: metric.status,\r\n        history: metric.history\r\n      };\r\n    }\r\n\r\n    for (const [name, dashboard] of this.dashboards) {\r\n      data.dashboards[name] = {\r\n        title: dashboard.title,\r\n        description: dashboard.description,\r\n        widgets: dashboard.widgets\r\n      };\r\n    }\r\n\r\n    if (format === 'json') {\r\n      return JSON.stringify(data, null, 2);\r\n    }\r\n    return data;\r\n  }\r\n\r\n\r\n  _createMetricLegacy(name, label, description = '', unit = '') {\r\n    const metric = {\r\n      id: `metric_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      name,\r\n      label,\r\n      description,\r\n      unit,\r\n      values: [],\r\n      history: [],  // Array of {value, timestamp} objects\r\n      avg: 0,\r\n      min: 0,\r\n      max: 0,\r\n      trend: 0,\r\n      createdAt: new Date().toISOString(),\r\n      \r\n      updateValue(value) {\r\n        const entry = { value, timestamp: new Date().toISOString() };\r\n        this.values.push(value);\r\n        this.history.push(entry);\r\n        \r\n        if (this.values.length > 0) {\r\n          this.min = Math.min(...this.values);\r\n          this.max = Math.max(...this.values);\r\n          this.avg = this.values.reduce((a, b) => a + b, 0) / this.values.length;\r\n          \r\n          // Calculate trend percentage\r\n          if (this.values.length > 1) {\r\n            const recent = this.values.slice(-5);\r\n            const older = this.values.slice(-10, -5);\r\n            if (older.length > 0) {\r\n              const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;\r\n              const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;\r\n              this.trend = ((recentAvg - olderAvg) / olderAvg * 100) || 0;\r\n            } else if (this.values.length === 2) {\r\n              // Simple 2-value trend calculation\r\n              const firstVal = this.values[0];\r\n              const lastVal = this.values[this.values.length - 1];\r\n              this.trend = ((lastVal - firstVal) / firstVal * 100) || 0;\r\n            }\r\n          }\r\n        }\r\n        \r\n        return this;\r\n      }\r\n    };\r\n    \r\n    this.metrics.set(name, metric);\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * Create an alert threshold\r\n   */\r\n  createAlert(metricName, condition, threshold, severity = 'warning') {\r\n    const alert = {\r\n      id: `alert_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n      metricName,\r\n      condition, // 'exceeds', 'below', 'equals', 'changes'\r\n      threshold,\r\n      severity, // 'info', 'warning', 'critical'\r\n      isActive: true,\r\n      lastTriggered: null,\r\n      createdt: new Date().toISOString(),\r\n      \r\n      check(value) {\r\n        let triggered = false;\r\n        switch (this.condition) {\r\n          case 'exceeds':\r\n            triggered = value > this.threshold;\r\n            break;\r\n          case 'below':\r\n            triggered = value < this.threshold;\r\n            break;\r\n          case 'equals':\r\n            triggered = value === this.threshold;\r\n            break;\r\n          case 'changes':\r\n            triggered = true; // Simple implementation\r\n            break;\r\n        }\r\n        \r\n        if (triggered) {\r\n          this.lastTriggered = new Date().toISOString();\r\n        }\r\n        \r\n        return triggered;\r\n      },\r\n      \r\n      toggle() {\r\n        this.isActive = !this.isActive;\r\n        return this;\r\n      }\r\n    };\r\n    \r\n    this.alerts.push(alert);\r\n    return alert;\r\n  }\r\n\r\n  /**\r\n   * Get a metric by name\r\n   */\r\n  getMetric(name) {\r\n    return this.metrics.get(name);\r\n  }\r\n\r\n  /**\r\n   * Get a dashboard by name\r\n   */\r\n  getDashboard(name) {\r\n    return this.dashboards.get(name);\r\n  }\r\n\r\n  /**\r\n   * Get alerts for a metric\r\n   */\r\n  getMetricAlerts(metricName) {\r\n    return this.alerts.filter(a => a.metricName === metricName);\r\n  }\r\n\r\n  /**\r\n   * Get all metrics\r\n   */\r\n  getAllMetrics() {\r\n    return Array.from(this.metrics.values());\r\n  }\r\n\r\n  /**\r\n   * Get all dashboards\r\n   */\r\n  getAllDashboards() {\r\n    return Array.from(this.dashboards.values());\r\n  }\r\n\r\n  /**\r\n   * Aggregate metric data by period\r\n   */\r\n  aggregateMetricByPeriod(metricName, period = 'daily') {\r\n    const metric = this.metrics.get(metricName);\r\n    if (!metric) return [];\r\n\r\n    const aggregated = [];\r\n    const history = metric.history || [];\r\n\r\n    if (history.length === 0) return [];\r\n\r\n    let currentPeriod = {};\r\n    let currentDate = null;\r\n\r\n    for (const entry of history) {\r\n      const entryDate = new Date(entry.timestamp);\r\n      const periodKey = this.getPeriodKey(entryDate, period);\r\n\r\n      if (!currentDate || this.getPeriodKey(currentDate, period) !== periodKey) {\r\n        if (Object.keys(currentPeriod).length > 0) {\r\n          aggregated.push(currentPeriod);\r\n        }\r\n        currentPeriod = {\r\n          period: periodKey,\r\n          values: [],\r\n          sum: 0,\r\n          count: 0,\r\n          avg: 0,\r\n          min: Infinity,\r\n          max: -Infinity,\r\n        };\r\n        currentDate = entryDate;\r\n      }\r\n\r\n      currentPeriod.values.push(entry.value);\r\n      currentPeriod.sum += entry.value;\r\n      currentPeriod.count++;\r\n      currentPeriod.min = Math.min(currentPeriod.min, entry.value);\r\n      currentPeriod.max = Math.max(currentPeriod.max, entry.value);\r\n      currentPeriod.avg = currentPeriod.sum / currentPeriod.count;\r\n    }\r\n\r\n    if (Object.keys(currentPeriod).length > 0) {\r\n      aggregated.push(currentPeriod);\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  /**\r\n   * Get period key from date\r\n   */\r\n  getPeriodKey(date, period) {\r\n    if (period === 'daily') {\r\n      return date.toISOString().split('T')[0];\r\n    } else if (period === 'weekly') {\r\n      const d = new Date(date);\r\n      d.setDate(d.getDate() - d.getDay());\r\n      return d.toISOString().split('T')[0];\r\n    } else if (period === 'monthly') {\r\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\r\n    } else if (period === 'yearly') {\r\n      return date.getFullYear().toString();\r\n    }\r\n    return date.toISOString().split('T')[0];\r\n  }\r\n\r\n  /**\r\n   * Update a metric value\r\n   */\r\n  updateMetric(metricName, value) {\r\n    const metric = this.metrics.get(metricName);\r\n    if (metric) {\r\n      metric.updateValue(value);\r\n    }\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * Add a widget to a dashboard\r\n   */\r\n  addWidgetToDashboard(dashboardName, widget) {\r\n    const dashboard = this.dashboards.get(dashboardName);\r\n    if (dashboard) {\r\n      dashboard.addWidget(widget);\r\n    }\r\n    return dashboard;\r\n  }\r\n\r\n  /**\r\n   * Evaluate all alerts and check if they're triggered\r\n   */\r\n  /**\r\n   * Evaluate all alerts and return triggered ones\r\n   */\r\n  evaluateAlerts() {\r\n    const triggeredAlerts = [];\r\n    \r\n    for (const alert of this.alerts) {\r\n      if (!alert.isActive) continue;\r\n      \r\n      const metric = this.metrics.get(alert.metricName);\r\n      if (!metric) continue;\r\n      \r\n      // Support both AnalyticsMetric and legacy metric formats\r\n      let lastValue;\r\n      if (metric.history && metric.history.length > 0) {\r\n        lastValue = metric.history[metric.history.length - 1];\r\n        lastValue = lastValue.value !== undefined ? lastValue.value : lastValue;\r\n      } else if (metric.values && metric.values.length > 0) {\r\n        lastValue = metric.values[metric.values.length - 1];\r\n      } else {\r\n        continue;\r\n      }\r\n\r\n      if (alert.check && alert.check(lastValue)) {\r\n        triggeredAlerts.push(alert);\r\n      }\r\n    }\r\n    \r\n    return triggeredAlerts;\r\n  }\r\n\r\n  /**\r\n   * Get metric trends\r\n   */\r\n  getMetricTrend(metricName) {\r\n    const metric = this.metrics.get(metricName);\r\n    if (!metric) return null;\r\n    \r\n    return {\r\n      metricName,\r\n      trend: metric.trend,\r\n      direction: metric.trend > 0 ? 'up' : metric.trend < 0 ? 'down' : 'stable',\r\n      magnitude: Math.abs(metric.trend),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if metric is within threshold\r\n   */\r\n  isMetricInThreshold(metricName) {\r\n    const metric = this.metrics.get(metricName);\r\n    if (!metric || metric.values.length === 0) return true;\r\n    \r\n    const lastValue = metric.values[metric.values.length - 1];\r\n    const upper = metric.upperThreshold !== undefined ? metric.upperThreshold : Infinity;\r\n    const lower = metric.lowerThreshold !== undefined ? metric.lowerThreshold : -Infinity;\r\n    \r\n    return lastValue >= lower && lastValue <= upper;\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * KPI MANAGEMENT\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * حساب مؤشر KPI\r\n   */\r\n  async calculateKPI(kpiId) {\r\n    try {\r\n      const kpi = await KPI.findById(kpiId);\r\n      if (!kpi) {\r\n        throw new Error('KPI not found');\r\n      }\r\n\r\n      let calculatedValue;\r\n\r\n      // حساب القيمة بناءً على الفئة\r\n      switch (kpi.category) {\r\n        case 'operational':\r\n          calculatedValue = await this.calculateOperationalKPI(kpi);\r\n          break;\r\n        case 'quality':\r\n          calculatedValue = await this.calculateQualityKPI(kpi);\r\n          break;\r\n        case 'satisfaction':\r\n          calculatedValue = await this.calculateSatisfactionKPI(kpi);\r\n          break;\r\n        case 'financial':\r\n          calculatedValue = await this.calculateFinancialKPI(kpi);\r\n          break;\r\n        default:\r\n          calculatedValue = await this.calculateCustomKPI(kpi);\r\n      }\r\n\r\n      // تحديث القيمة\r\n      kpi.value.previous = kpi.value.current;\r\n      kpi.value.current = calculatedValue;\r\n      kpi.calculation.lastCalculated = new Date();\r\n\r\n      // إضافة للتاريخ\r\n      kpi.history.push({\r\n        value: calculatedValue,\r\n        date: new Date(),\r\n      });\r\n\r\n      // الاحتفاظ بآخر 100 سجل فقط\r\n      if (kpi.history.length > 100) {\r\n        kpi.history = kpi.history.slice(-100);\r\n      }\r\n\r\n      await kpi.save();\r\n\r\n      return kpi;\r\n    } catch (error) {\r\n      console.error('Error calculating KPI:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات الكفاءة التشغيلية\r\n   */\r\n  async calculateOperationalKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'OPS_ATTENDANCE':\r\n        return await this.getAttendanceRate();\r\n      case 'OPS_UTILIZATION':\r\n        return await this.getFacilityUtilization();\r\n      case 'OPS_EFFICIENCY':\r\n        return await this.getOperationalEfficiency();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات الجودة\r\n   */\r\n  async calculateQualityKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'QUA_SATISFACTION':\r\n        return await this.getServiceSatisfaction();\r\n      case 'QUA_COMPLIANCE':\r\n        return await this.getComplianceRate();\r\n      case 'QUA_DEFECTS':\r\n        return await this.getDefectRate();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات الرضا\r\n   */\r\n  async calculateSatisfactionKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'SAT_STUDENT':\r\n        return await this.getStudentSatisfaction();\r\n      case 'SAT_PARENT':\r\n        return await this.getParentSatisfaction();\r\n      case 'SAT_EMPLOYEE':\r\n        return await this.getEmployeeSatisfaction();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب المؤشرات المالية\r\n   */\r\n  async calculateFinancialKPI(kpi) {\r\n    switch (kpi.code) {\r\n      case 'FIN_REVENUE':\r\n        return await this.getTotalRevenue();\r\n      case 'FIN_PROFIT':\r\n        return await this.getProfitMargin();\r\n      case 'FIN_COLLECTION':\r\n        return await this.getCollectionRate();\r\n      case 'FIN_EXPENSES':\r\n        return await this.getTotalExpenses();\r\n      default:\r\n        return kpi.value.current || 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب مؤشرات مخصصة\r\n   */\r\n  async calculateCustomKPI(kpi) {\r\n    if (kpi.calculation && kpi.calculation.formula) {\r\n      try {\r\n        // يمكن تنفيذ صيغ مخصصة بشكل آمن هنا\r\n        return eval(kpi.calculation.formula);\r\n      } catch (error) {\r\n        console.error('Error in custom formula:', error);\r\n        return kpi.value.current || 0;\r\n      }\r\n    }\r\n    return kpi.value.current || 0;\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * DASHBOARD & REPORTS\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * الحصول على لوحة التحكم التنفيذية\r\n   */\r\n  async getExecutiveDashboard(filters = {}) {\r\n    try {\r\n      const operationalKPIs = await KPI.find({\r\n        category: 'operational',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const qualityKPIs = await KPI.find({\r\n        category: 'quality',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const satisfactionKPIs = await KPI.find({\r\n        category: 'satisfaction',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const financialKPIs = await KPI.find({\r\n        category: 'financial',\r\n        isActive: true,\r\n      }).sort({ code: 1 });\r\n\r\n      const stats = await this.getGeneralStatistics(filters);\r\n\r\n      return {\r\n        operational: operationalKPIs,\r\n        quality: qualityKPIs,\r\n        satisfaction: satisfactionKPIs,\r\n        financial: financialKPIs,\r\n        stats,\r\n        generatedAt: new Date(),\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting executive dashboard:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * PREDICTIVE ANALYTICS\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * تحليلات تنبؤية\r\n   */\r\n  async generatePrediction(type, kpiId, period = 30) {\r\n    try {\r\n      const kpi = await KPI.findById(kpiId);\r\n      if (!kpi) {\r\n        throw new Error('KPI not found');\r\n      }\r\n\r\n      const historicalData = kpi.history.slice(-60).map(h => ({\r\n        date: h.date,\r\n        value: h.value,\r\n      }));\r\n\r\n      if (historicalData.length < 10) {\r\n        throw new Error('Not enough historical data for prediction');\r\n      }\r\n\r\n      const predictions = this.linearRegression(historicalData, period);\r\n\r\n      const prediction = new Prediction({\r\n        type,\r\n        kpi: kpiId,\r\n        historicalData,\r\n        predictions,\r\n        model: {\r\n          type: 'linear',\r\n          accuracy: this.calculateAccuracy(historicalData, predictions),\r\n        },\r\n        period: {\r\n          from: new Date(),\r\n          to: new Date(Date.now() + period * 24 * 60 * 60 * 1000),\r\n        },\r\n        status: 'completed',\r\n        calculatedAt: new Date(),\r\n      });\r\n\r\n      await prediction.save();\r\n\r\n      return prediction;\r\n    } catch (error) {\r\n      console.error('Error generating prediction:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الانحدار الخطي البسيط\r\n   */\r\n  linearRegression(data, futureDays) {\r\n    const n = data.length;\r\n    const x = data.map((d, i) => i);\r\n    const y = data.map(d => d.value);\r\n\r\n    const sumX = x.reduce((a, b) => a + b, 0);\r\n    const sumY = y.reduce((a, b) => a + b, 0);\r\n    const meanX = sumX / n;\r\n    const meanY = sumY / n;\r\n\r\n    let num = 0;\r\n    let den = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      num += (x[i] - meanX) * (y[i] - meanY);\r\n      den += Math.pow(x[i] - meanX, 2);\r\n    }\r\n    const slope = num / den;\r\n    const intercept = meanY - slope * meanX;\r\n\r\n    const predictions = [];\r\n    const lastDate = data[n - 1].date;\r\n\r\n    for (let i = 1; i <= futureDays; i++) {\r\n      const predictedValue = intercept + slope * (n + i);\r\n      const confidence = Math.max(50, 95 - i);\r\n\r\n      predictions.push({\r\n        date: new Date(lastDate.getTime() + i * 24 * 60 * 60 * 1000),\r\n        predictedValue: Math.round(predictedValue * 100) / 100,\r\n        confidence,\r\n        lowerBound: Math.round(predictedValue * 0.9 * 100) / 100,\r\n        upperBound: Math.round(predictedValue * 1.1 * 100) / 100,\r\n      });\r\n    }\r\n\r\n    return predictions;\r\n  }\r\n\r\n  /**\r\n   * حساب دقة النموذج\r\n   */\r\n  calculateAccuracy(historical, predictions) {\r\n    const testSize = Math.min(10, Math.floor(historical.length * 0.2));\r\n    const testData = historical.slice(-testSize);\r\n    const predData = predictions.slice(0, testSize);\r\n\r\n    let totalError = 0;\r\n    for (let i = 0; i < testSize; i++) {\r\n      const actual = testData[i].value;\r\n      const predicted = predData[i].predictedValue;\r\n      totalError += Math.abs((actual - predicted) / actual);\r\n    }\r\n\r\n    const mape = (totalError / testSize) * 100;\r\n    return Math.max(0, Math.min(100, 100 - mape));\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * REPORT GENERATION\r\n   * ======================\r\n   */\r\n\r\n  /**\r\n   * توليد تقرير\r\n   */\r\n  async generateReport(templateId, filters, format, userId) {\r\n    try {\r\n      const template = await ReportTemplate.findById(templateId);\r\n      if (!template) {\r\n        throw new Error('Template not found');\r\n      }\r\n\r\n      const startTime = Date.now();\r\n      const data = await this.collectReportData(template, filters);\r\n\r\n      const report = new GeneratedReport({\r\n        template: templateId,\r\n        title: template.name,\r\n        titleAr: template.nameAr,\r\n        period: filters.period,\r\n        appliedFilters: filters,\r\n        data,\r\n        generatedBy: userId,\r\n        generatedAt: new Date(),\r\n        status: 'generating',\r\n      });\r\n\r\n      await report.save();\r\n\r\n      let filePath;\r\n      switch (format) {\r\n        case 'pdf':\r\n          filePath = await this.generatePDFReport(template, data, report._id);\r\n          break;\r\n        case 'excel':\r\n          filePath = await this.generateExcelReport(template, data, report._id);\r\n          break;\r\n        case 'csv':\r\n          filePath = await this.generateCSVReport(template, data, report._id);\r\n          break;\r\n        case 'json':\r\n          filePath = await this.generateJSONReport(template, data, report._id);\r\n          break;\r\n        default:\r\n          throw new Error('Unsupported format');\r\n      }\r\n\r\n      const stats = await fs.stat(filePath);\r\n      report.file = {\r\n        format,\r\n        path: filePath,\r\n        size: stats.size,\r\n        url: `/api/reports/download/${report._id}`,\r\n      };\r\n      report.status = 'completed';\r\n      report.generationTime = (Date.now() - startTime) / 1000;\r\n\r\n      await report.save();\r\n\r\n      template.stats.generatedCount += 1;\r\n      template.stats.lastGenerated = new Date();\r\n      await template.save();\r\n\r\n      return report;\r\n    } catch (error) {\r\n      console.error('Error generating report:', error);\r\n      if (report) {\r\n        report.status = 'failed';\r\n        report.error = error.message;\r\n        await report.save();\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جمع بيانات التقرير\r\n   */\r\n  async collectReportData(template, filters) {\r\n    const data = {\r\n      summary: {},\r\n      details: [],\r\n      charts: [],\r\n      kpis: [],\r\n    };\r\n\r\n    if (template.structure.kpis && template.structure.kpis.length > 0) {\r\n      data.kpis = await KPI.find({\r\n        _id: { $in: template.structure.kpis },\r\n        isActive: true,\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير PDF\r\n   */\r\n  async generatePDFReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.pdf`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const doc = new PDFDocument({\r\n          size: template.formatting?.pageSize || 'A4',\r\n          layout: template.formatting?.orientation || 'portrait',\r\n          margins: { top: 50, bottom: 50, left: 50, right: 50 },\r\n        });\r\n\r\n        const stream = doc.pipe(require('fs').createWriteStream(filePath));\r\n\r\n        if (template.formatting?.header?.show) {\r\n          doc.fontSize(20).text(template.nameAr, { align: 'center' });\r\n          doc.fontSize(12).text(new Date().toLocaleDateString('ar-SA'), { align: 'center' });\r\n          doc.moveDown();\r\n        }\r\n\r\n        if (data.kpis && data.kpis.length > 0) {\r\n          doc.fontSize(16).text('مؤشرات الأداء الرئيسية', { underline: true });\r\n          doc.moveDown();\r\n\r\n          data.kpis.forEach(kpi => {\r\n            doc.fontSize(12).text(`${kpi.nameAr}: ${kpi.value.current} ${kpi.unit}`);\r\n            doc.moveDown(0.5);\r\n          });\r\n        }\r\n\r\n        if (template.formatting?.footer?.show) {\r\n          doc\r\n            .fontSize(10)\r\n            .text(\r\n              `تم الإنشاء بواسطة نظام ERP - ${new Date().toLocaleString('ar-SA')}`,\r\n              50,\r\n              doc.page.height - 50,\r\n              { align: 'center' }\r\n            );\r\n        }\r\n\r\n        doc.end();\r\n\r\n        stream.on('finish', () => resolve(filePath));\r\n        stream.on('error', reject);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير Excel\r\n   */\r\n  async generateExcelReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.xlsx`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    const workbook = new ExcelJS.Workbook();\r\n    const worksheet = workbook.addWorksheet(template.nameAr);\r\n\r\n    worksheet.addRow([template.nameAr]);\r\n    worksheet.addRow([`التاريخ: ${new Date().toLocaleDateString('ar-SA')}`]);\r\n    worksheet.addRow([]);\r\n\r\n    if (data.kpis && data.kpis.length > 0) {\r\n      worksheet.addRow(['مؤشرات الأداء الرئيسية']);\r\n      worksheet.addRow(['المؤشر', 'القيمة الحالية', 'الهدف', 'الوحدة', 'الحالة']);\r\n\r\n      data.kpis.forEach(kpi => {\r\n        worksheet.addRow([kpi.nameAr, kpi.value.current, kpi.value.target, kpi.unit, kpi.status]);\r\n      });\r\n    }\r\n\r\n    await workbook.xlsx.writeFile(filePath);\r\n    return filePath;\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير CSV\r\n   */\r\n  async generateCSVReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.csv`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    let csv = `${template.nameAr}\\n`;\r\n    csv += `التاريخ,${new Date().toLocaleDateString('ar-SA')}\\n\\n`;\r\n\r\n    if (data.kpis && data.kpis.length > 0) {\r\n      csv += 'المؤشر,القيمة الحالية,الهدف,الوحدة,الحالة\\n';\r\n      data.kpis.forEach(kpi => {\r\n        csv += `${kpi.nameAr},${kpi.value.current},${kpi.value.target},${kpi.unit},${kpi.status}\\n`;\r\n      });\r\n    }\r\n\r\n    await fs.writeFile(filePath, csv, 'utf8');\r\n    return filePath;\r\n  }\r\n\r\n  /**\r\n   * توليد تقرير JSON\r\n   */\r\n  async generateJSONReport(template, data, reportId) {\r\n    const fileName = `report_${reportId}_${Date.now()}.json`;\r\n    const filePath = path.join(__dirname, '..', 'public', 'reports', fileName);\r\n\r\n    await fs.mkdir(path.dirname(filePath), { recursive: true });\r\n\r\n    const reportData = {\r\n      template: {\r\n        name: template.name,\r\n        nameAr: template.nameAr,\r\n      },\r\n      generatedAt: new Date(),\r\n      data,\r\n    };\r\n\r\n    await fs.writeFile(filePath, JSON.stringify(reportData, null, 2), 'utf8');\r\n    return filePath;\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * HELPER METHODS\r\n   * ======================\r\n   */\r\n\r\n  async getAttendanceRate() {\r\n    return Math.floor(Math.random() * 30) + 70;\r\n  }\r\n  async getFacilityUtilization() {\r\n    return Math.floor(Math.random() * 20) + 70;\r\n  }\r\n  async getOperationalEfficiency() {\r\n    return Math.floor(Math.random() * 15) + 80;\r\n  }\r\n  async getServiceSatisfaction() {\r\n    return Math.floor(Math.random() * 20) + 75;\r\n  }\r\n  async getComplianceRate() {\r\n    return Math.floor(Math.random() * 10) + 85;\r\n  }\r\n  async getDefectRate() {\r\n    return Math.floor(Math.random() * 5) + 2;\r\n  }\r\n  async getStudentSatisfaction() {\r\n    return Math.floor(Math.random() * 20) + 75;\r\n  }\r\n  async getParentSatisfaction() {\r\n    return Math.floor(Math.random() * 20) + 70;\r\n  }\r\n  async getEmployeeSatisfaction() {\r\n    return Math.floor(Math.random() * 25) + 65;\r\n  }\r\n  async getTotalRevenue() {\r\n    return Math.floor(Math.random() * 500000) + 1000000;\r\n  }\r\n  async getProfitMargin() {\r\n    return Math.floor(Math.random() * 20) + 15;\r\n  }\r\n  async getCollectionRate() {\r\n    return Math.floor(Math.random() * 15) + 80;\r\n  }\r\n  async getTotalExpenses() {\r\n    return Math.floor(Math.random() * 400000) + 600000;\r\n  }\r\n\r\n  async getGeneralStatistics(filters) {\r\n    return {\r\n      totalUsers: 1234,\r\n      activeUsers: 987,\r\n      totalRevenue: 1500000,\r\n      totalExpenses: 900000,\r\n      profitMargin: 40,\r\n      date: new Date(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ======================\r\n   * LEGACY METHODS (Preserved)\r\n   * ======================\r\n   */\r\n\r\n  // تتبع السلوك المستخدم\r\n  static trackUserBehavior(userId) {\r\n    return {\r\n      success: true,\r\n      userId: userId,\r\n      behavior: {\r\n        loginFrequency: '2.3 times per day',\r\n        averageSessionDuration: '45 minutes',\r\n        mostUsedFeatures: ['reports', 'notifications', 'users'],\r\n        peakHours: ['09:00', '14:00', '16:30'],\r\n        deviceTypes: ['Desktop', 'Mobile'],\r\n        browsers: ['Chrome', 'Safari'],\r\n      },\r\n      engagement: {\r\n        score: 8.5,\r\n        level: 'High',\r\n        trend: 'increasing',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // الحصول على مقاييس الأداء\r\n  static getPerformanceMetrics(timeRange = '24h') {\r\n    return {\r\n      success: true,\r\n      timeRange: timeRange,\r\n      metrics: {\r\n        responseTime: {\r\n          average: '245ms',\r\n          min: '50ms',\r\n          max: '1200ms',\r\n          p95: '500ms',\r\n        },\r\n        uptime: '99.99%',\r\n        errorRate: '0.01%',\r\n        throughput: '1500 requests/minute',\r\n        cpuUsage: '35%',\r\n        memoryUsage: '62%',\r\n        databaseLatency: '120ms',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // عرض التقارير المخصصة\r\n  static getCustomDashboard(userId) {\r\n    return {\r\n      success: true,\r\n      userId: userId,\r\n      dashboard: {\r\n        widgets: [\r\n          {\r\n            id: 'widget_1',\r\n            title: 'Sales Overview',\r\n            type: 'chart',\r\n            data: { current: 150000, previous: 120000, growth: '25%' },\r\n          },\r\n          {\r\n            id: 'widget_2',\r\n            title: 'User Activity',\r\n            type: 'gauge',\r\n            data: { active: 156, inactive: 14, total: 170 },\r\n          },\r\n          {\r\n            id: 'widget_3',\r\n            title: 'System Health',\r\n            type: 'status',\r\n            data: { status: 'healthy', uptime: '99.99%' },\r\n          },\r\n          {\r\n            id: 'widget_4',\r\n            title: 'Top Features',\r\n            type: 'list',\r\n            data: ['Reports', 'Notifications', 'Analytics'],\r\n          },\r\n        ],\r\n        layout: 'grid',\r\n        refreshInterval: '5 minutes',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تحليل الاتجاهات\r\n  static analyzeTrends(metric, period = '30d') {\r\n    return {\r\n      success: true,\r\n      metric: metric,\r\n      period: period,\r\n      trend: {\r\n        direction: 'up',\r\n        changePercent: 15.7,\r\n        dataPoints: [\r\n          { date: '2026-01-01', value: 1000 },\r\n          { date: '2026-01-05', value: 1150 },\r\n          { date: '2026-01-10', value: 1100 },\r\n          { date: '2026-01-15', value: 1350 },\r\n          { date: '2026-01-20', value: 1550 },\r\n        ],\r\n      },\r\n      forecast: {\r\n        nextWeekEstimate: 1750,\r\n        confidence: '85%',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // الحصول على التوصيات\r\n  static getRecommendations() {\r\n    return {\r\n      success: true,\r\n      recommendations: [\r\n        {\r\n          id: 'REC_001',\r\n          title: 'Optimize Database Queries',\r\n          category: 'Performance',\r\n          priority: 'high',\r\n          impact: 'Save 30% query time',\r\n          actionRequired: true,\r\n        },\r\n        {\r\n          id: 'REC_002',\r\n          title: 'Update 5 Inactive Users',\r\n          category: 'UserManagement',\r\n          priority: 'medium',\r\n          impact: 'Improve engagement',\r\n        },\r\n        {\r\n          id: 'REC_003',\r\n          title: 'Review Access Logs',\r\n          category: 'Security',\r\n          priority: 'high',\r\n          impact: 'Ensure system security',\r\n        },\r\n      ],\r\n      totalRecommendations: 3,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // مقارنة المقاييس\r\n  static compareMetrics(metric1, metric2, period = '30d') {\r\n    return {\r\n      success: true,\r\n      comparison: {\r\n        metric1: {\r\n          name: metric1,\r\n          value: 1500,\r\n          average: 1400,\r\n          trend: 'up',\r\n        },\r\n        metric2: {\r\n          name: metric2,\r\n          value: 2300,\r\n          average: 2100,\r\n          trend: 'up',\r\n        },\r\n        correlation: 0.87,\r\n      },\r\n      period: period,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تقرير تحليلي شامل\r\n  static generateAnalysisReport(reportType = 'executive') {\r\n    return {\r\n      success: true,\r\n      reportType: reportType,\r\n      report: {\r\n        summary: {\r\n          period: 'Last 30 Days',\r\n          dataPoints: 720,\r\n          insights: 15,\r\n        },\r\n        keyMetrics: {\r\n          totalUsers: 156,\r\n          activeUsers: 142,\r\n          newUsers: 12,\r\n          engagementRate: '91%',\r\n          retentionRate: '94%',\r\n        },\r\n        departmentPerformance: {\r\n          IT: { performance: 95, users: 12 },\r\n          HR: { performance: 87, users: 8 },\r\n          Sales: { performance: 92, users: 45 },\r\n          Marketing: { performance: 88, users: 32 },\r\n          Finance: { performance: 89, users: 20 },\r\n        },\r\n        topInsights: [\r\n          'Sales department leading in engagement',\r\n          'Finance team needs onboarding support',\r\n          'Overall system performance up 12%',\r\n        ],\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تتبع تحويل المستخدمين\r\n  static trackConversion(userId, event) {\r\n    return {\r\n      success: true,\r\n      userId: userId,\r\n      event: event,\r\n      conversion: {\r\n        type: 'funnel_step',\r\n        step: 3,\r\n        completionRate: '67%',\r\n        timeSpent: '5 minutes',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // التحليلات في الوقت الفعلي\r\n  static getRealTimeAnalytics() {\r\n    return {\r\n      success: true,\r\n      realTime: {\r\n        activeUsers: 45,\r\n        activeRequests: 123,\r\n        cps: 45, // conversions per second\r\n        avgResponseTime: '245ms',\r\n        errorRate: '0.01%',\r\n        throughput: '1500 req/min',\r\n      },\r\n      topPages: [\r\n        { page: '/reports', users: 12, duration: '5 min' },\r\n        { page: '/dashboard', users: 15, duration: '8 min' },\r\n        { page: '/users', users: 8, duration: '3 min' },\r\n      ],\r\n      topActions: [\r\n        { action: 'generate_report', count: 23 },\r\n        { action: 'view_dashboard', count: 18 },\r\n        { action: 'manage_users', count: 12 },\r\n      ],\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // توقعات التحليلات\r\n  static getPredictiveAnalytics() {\r\n    return {\r\n      success: true,\r\n      predictions: {\r\n        churnRisk: {\r\n          probability: '12%',\r\n          riskUsers: 18,\r\n          recommendations: 'Improve engagement, send personalized offers',\r\n        },\r\n        growthForecast: {\r\n          nextMonth: '178 users',\r\n          nextQuarter: '245 users',\r\n          confidence: '87%',\r\n        },\r\n        featureAdoption: {\r\n          highAdoption: ['Reports', 'Notifications'],\r\n          mediumAdoption: ['Analytics', 'Support'],\r\n          lowAdoption: ['CMS', 'Advanced Features'],\r\n        },\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // تصدير تقارير التحليلات\r\n  static exportAnalyticsReport(format = 'pdf') {\r\n    return {\r\n      success: true,\r\n      file: {\r\n        name: `analytics_report_${new Date().toISOString().split('T')[0]}.${format}`,\r\n        size: '2.5 MB',\r\n        downloadUrl: `https://example.com/exports/analytics_${Date.now()}.${format}`,\r\n        expiresIn: '7 days',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // اختبار A/B\r\n  static getABTestResults(testId) {\r\n    return {\r\n      success: true,\r\n      testId: testId,\r\n      results: {\r\n        testName: 'Button Color Test',\r\n        duration: '14 days',\r\n        status: 'completed',\r\n        variants: [\r\n          {\r\n            name: 'Control (Blue)',\r\n            conversions: 234,\r\n            conversionRate: '3.2%',\r\n            users: 7500,\r\n          },\r\n          {\r\n            name: 'Variant (Red)',\r\n            conversions: 289,\r\n            conversionRate: '3.8%',\r\n            users: 7500,\r\n          },\r\n        ],\r\n        winner: 'Variant (Red)',\r\n        confidence: '94%',\r\n        impact: '+18.75% conversion improvement',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  // مقاييس التسويق\r\n  static getMarketingMetrics(campaign) {\r\n    return {\r\n      success: true,\r\n      campaign: campaign,\r\n      metrics: {\r\n        impressions: 50000,\r\n        clicks: 2500,\r\n        ctr: '5%',\r\n        conversions: 125,\r\n        conversionRate: '5%',\r\n        cost: 500,\r\n        cpc: 0.2,\r\n        roi: '350%',\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n\r\n// تصدير الكلاس (بدلاً من instance واحد) للسماح بالاختبار\r\nmodule.exports = AnalyticsService;\r\nmodule.exports.AnalyticsMetric = AnalyticsMetric;\r\nmodule.exports.DashboardTemplate = DashboardTemplate;\r\nmodule.exports.TrendAnalyzer = TrendAnalyzer;\r\nmodule.exports.KPIAggregator = KPIAggregator;\r\n// أو إذا أردت الاحتفاظ بـ singleton سلوك:\r\n// module.exports = new AnalyticsService();\r\n\r\n"],"mappings":"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","ignoreList":[]}