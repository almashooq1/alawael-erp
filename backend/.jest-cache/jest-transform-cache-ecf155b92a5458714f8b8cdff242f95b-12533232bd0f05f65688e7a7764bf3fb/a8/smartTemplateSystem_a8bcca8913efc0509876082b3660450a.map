{"version":3,"names":["mongoose","require","logger","templateSchema","Schema","templateId","type","String","unique","index","name","category","enum","default","content","ar","title","required","body","shortBody","actionText","en","variables","requiredVariables","settings","channels","priority","maxRetries","Number","expiryDays","silent","Boolean","metadata","icon","color","sound","vibration","usage","count","successRate","lastUsed","Date","isActive","createdAt","now","updatedAt","createdBy","tags","Template","model","SmartTemplateSystem","constructor","cache","Map","cacheTimeout","builtInTemplates","initializeBuiltInTemplates","loadBuiltInTemplates","SYSTEM_ALERT","TRANSACTION_SUCCESS","SECURITY_WARNING","REMINDER_UPCOMING","ERROR_OPERATION_FAILED","SUCCESS_NOTIFICATION","BUSINESS_UPDATE","WARNING_NOTICE","Object","entries","forEach","key","template","set","isBuiltIn","info","keys","length","getTemplate","language","has","get","findOne","exec","setTimeout","delete","error","message","createTemplate","templateData","validateTemplateData","Math","random","toString","substr","savedTemplate","save","updateTemplate","updates","result","updateOne","deleteTemplate","deleteOne","searchTemplates","criteria","query","templates","find","createNotificationFromTemplate","Error","missing","filter","variable","join","notificationContent","buildNotificationContent","templateContent","replaceVariables","text","replace","match","undefined","allVariables","Set","Array","from","getAllTemplates","filters","sort","getTemplatesByCategory","clearCache","size","clear","getCacheStats","cacheSize","module","exports","templateSystem"],"sources":["smartTemplateSystem.js"],"sourcesContent":["/**\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * üìã Smart Notification Templates System\r\n * ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÇŸàÿßŸÑÿ® ÿßŸÑÿ∞ŸÉŸäÿ© ŸÑŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸàÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * \r\n * ŸÜÿ∏ÿßŸÖ ŸÇŸàÿßŸÑÿ® ŸÖÿ™ŸÇÿØŸÖ Ÿàÿ∞ŸÉŸä ŸÖÿπ:\r\n * - ÿØÿπŸÖ ÿßŸÑŸÑÿ∫ÿßÿ™ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ© (ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸàÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©)\r\n * - ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿ©\r\n * - ÿ•ÿπÿßÿØÿ© ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Ÿàÿ™ÿÆÿ≤ŸäŸÜ ŸÖÿ§ŸÇÿ™\r\n * - ÿ™ÿµŸÜŸäŸÅÿßÿ™ ŸÖŸÜÿ∏ŸÖÿ©\r\n */\r\n\r\nconst mongoose = require('mongoose');\r\nconst logger = require('../utils/logger');\r\n\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n// üìã ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑŸÇÿßŸÑÿ®\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nconst templateSchema = new mongoose.Schema({\r\n  // ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©\r\n  templateId: { type: String, unique: true, index: true },\r\n  name: String,\r\n  category: {\r\n    type: String,\r\n    enum: [\r\n      'system',        // ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ\r\n      'business',      // ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿπŸÖÿßŸÑ\r\n      'transaction',   // ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™\r\n      'security',      // ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ\r\n      'reminder',      // ÿßŸÑÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™\r\n      'warning',       // ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™\r\n      'success',       // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿ¨ÿßÿ≠\r\n      'error',         // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£\r\n      'custom',        // ŸÖÿÆÿµÿµ\r\n    ],\r\n    default: 'custom',\r\n  },\r\n\r\n  // ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÖÿ™ÿπÿØÿØ ÿßŸÑŸÑÿ∫ÿßÿ™\r\n  content: {\r\n    ar: {\r\n      title: { type: String, required: true },\r\n      body: { type: String, required: true },\r\n      shortBody: String,\r\n      actionText: String,\r\n    },\r\n    en: {\r\n      title: { type: String, required: true },\r\n      body: { type: String, required: true },\r\n      shortBody: String,\r\n      actionText: String,\r\n    },\r\n  },\r\n\r\n  // ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÖÿØÿπŸàŸÖÿ©\r\n  variables: [String], // ŸÖÿ´ŸÑ: {{user_name}}, {{amount}}, {{date}}\r\n  requiredVariables: [String],\r\n\r\n  // ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™\r\n  settings: {\r\n    channels: [String], // ['email', 'sms', 'whatsapp', 'inApp', 'push']\r\n    priority: {\r\n      type: String,\r\n      enum: ['low', 'medium', 'high', 'critical'],\r\n      default: 'medium',\r\n    },\r\n    maxRetries: { type: Number, default: 3 },\r\n    expiryDays: Number,\r\n    silent: { type: Boolean, default: false },\r\n  },\r\n\r\n  // ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸàÿµŸÅŸäÿ©\r\n  metadata: {\r\n    icon: String,\r\n    color: String,\r\n    sound: String,\r\n    vibration: { type: Boolean, default: true },\r\n  },\r\n\r\n  // ÿßŸÑÿ£ÿØÿßÿ° ŸàÿßŸÑÿ™ÿ™ÿ®ÿπ\r\n  usage: {\r\n    count: { type: Number, default: 0 },\r\n    successRate: { type: Number, default: 0 },\r\n    lastUsed: Date,\r\n  },\r\n\r\n  // ÿßŸÑÿ™ÿ≠ŸÉŸÖ\r\n  isActive: { type: Boolean, default: true },\r\n  createdAt: { type: Date, default: Date.now },\r\n  updatedAt: { type: Date, default: Date.now },\r\n  createdBy: String,\r\n  tags: [String],\r\n});\r\n\r\nconst Template = mongoose.model('NotificationTemplate', templateSchema);\r\n\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n// üéØ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÇŸàÿßŸÑÿ® ÿßŸÑÿ∞ŸÉŸäÿ©\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nclass SmartTemplateSystem {\r\n  constructor() {\r\n    // ÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™\r\n    this.cache = new Map();\r\n    this.cacheTimeout = 3600000; // ÿ≥ÿßÿπÿ© Ÿàÿßÿ≠ÿØÿ©\r\n\r\n    // ÿßŸÑŸÇŸàÿßŸÑÿ® ÿßŸÑŸÖÿØŸÖÿ¨ÿ©\r\n    this.builtInTemplates = this.initializeBuiltInTemplates();\r\n\r\n    // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßŸÑÿ® ÿßŸÑŸÖÿØŸÖÿ¨ÿ© ÿ•ŸÑŸâ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n    this.loadBuiltInTemplates();\r\n  }\r\n\r\n  /**\r\n   * ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÇŸàÿßŸÑÿ® ÿßŸÑŸÖÿØŸÖÿ¨ÿ©\r\n   */\r\n  initializeBuiltInTemplates() {\r\n    return {\r\n      // ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ\r\n      SYSTEM_ALERT: {\r\n        name: 'System Alert',\r\n        category: 'system',\r\n        content: {\r\n          ar: {\r\n            title: 'ÿ™ŸÜÿ®ŸäŸá ŸÜÿ∏ÿßŸÖ',\r\n            body: 'ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ {{alert_type}} ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ. ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ: {{details}}',\r\n            shortBody: 'ÿ™ŸÜÿ®ŸäŸá: {{alert_type}}',\r\n            actionText: 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ',\r\n          },\r\n          en: {\r\n            title: 'System Alert',\r\n            body: 'A {{alert_type}} has been detected in the system. Details: {{details}}',\r\n            shortBody: 'Alert: {{alert_type}}',\r\n            actionText: 'View Details',\r\n          },\r\n        },\r\n        variables: ['alert_type', 'details'],\r\n        requiredVariables: ['alert_type'],\r\n        settings: {\r\n          channels: ['email', 'inApp', 'push'],\r\n          priority: 'high',\r\n          maxRetries: 3,\r\n        },\r\n      },\r\n\r\n      // ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™\r\n      TRANSACTION_SUCCESS: {\r\n        name: 'Transaction Success',\r\n        category: 'transaction',\r\n        content: {\r\n          ar: {\r\n            title: '‚úÖ ÿ™ŸÖÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠',\r\n            body: 'ÿ™ŸÖ ÿ•ŸÉŸÖÿßŸÑ ŸÖÿπÿßŸÖŸÑÿ™ŸÉ ÿ®ÿ±ŸÇŸÖ {{transaction_id}}. ÿßŸÑŸÖÿ®ŸÑÿ∫: {{amount}} {{currency}}. ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: {{date}}',\r\n            shortBody: 'ŸÖÿπÿßŸÖŸÑÿ© ŸÜÿßÿ¨ÿ≠ÿ©: {{amount}}',\r\n            actionText: 'ÿπÿ±ÿ∂ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©',\r\n          },\r\n          en: {\r\n            title: '‚úÖ Transaction Completed',\r\n            body: 'Your transaction {{transaction_id}} has been completed. Amount: {{amount}} {{currency}}. Date: {{date}}',\r\n            shortBody: 'Success: {{amount}}',\r\n            actionText: 'View Receipt',\r\n          },\r\n        },\r\n        variables: ['transaction_id', 'amount', 'currency', 'date'],\r\n        requiredVariables: ['transaction_id', 'amount'],\r\n        settings: {\r\n          channels: ['email', 'sms', 'whatsapp', 'inApp'],\r\n          priority: 'medium',\r\n          maxRetries: 3,\r\n        },\r\n      },\r\n\r\n      // ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ\r\n      SECURITY_WARNING: {\r\n        name: 'Security Warning',\r\n        category: 'security',\r\n        content: {\r\n          ar: {\r\n            title: '‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá ÿ£ŸÖÿßŸÜ',\r\n            body: 'ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ ŸÖÿ≠ÿßŸàŸÑÿ© {{threat_type}} ŸÅŸä ÿ≠ÿ≥ÿßÿ®ŸÉ. ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÇŸÖ ÿ®Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¢ŸÜ.',\r\n            shortBody: 'ÿ™ÿ≠ÿ∞Ÿäÿ± ÿ£ŸÖÿßŸÜ: {{threat_type}}',\r\n            actionText: 'ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±',\r\n          },\r\n          en: {\r\n            title: '‚ö†Ô∏è Security Warning',\r\n            body: 'A {{threat_type}} attempt was detected on your account. If this wasn\\'t you, please change your password immediately.',\r\n            shortBody: 'Security Alert: {{threat_type}}',\r\n            actionText: 'Change Password',\r\n          },\r\n        },\r\n        variables: ['threat_type'],\r\n        requiredVariables: ['threat_type'],\r\n        settings: {\r\n          channels: ['email', 'sms', 'whatsapp', 'inApp', 'push'],\r\n          priority: 'critical',\r\n          maxRetries: 5,\r\n          silent: false,\r\n        },\r\n      },\r\n\r\n      // ÿßŸÑÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™\r\n      REMINDER_UPCOMING: {\r\n        name: 'Reminder - Upcoming Event',\r\n        category: 'reminder',\r\n        content: {\r\n          ar: {\r\n            title: '‚è∞ ÿ™ÿ∞ŸÉŸäÿ±',\r\n            body: 'ÿ™ÿ∞ŸÉŸäÿ±: {{event_name}} ÿ≥Ÿäÿ®ÿØÿ£ {{time_until}}. {{event_details}}',\r\n            shortBody: 'ÿ™ÿ∞ŸÉŸäÿ±: {{event_name}}',\r\n            actionText: 'ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≤ŸäÿØ',\r\n          },\r\n          en: {\r\n            title: '‚è∞ Reminder',\r\n            body: 'Reminder: {{event_name}} starts {{time_until}}. {{event_details}}',\r\n            shortBody: 'Reminder: {{event_name}}',\r\n            actionText: 'Learn More',\r\n          },\r\n        },\r\n        variables: ['event_name', 'time_until', 'event_details'],\r\n        requiredVariables: ['event_name', 'time_until'],\r\n        settings: {\r\n          channels: ['email', 'inApp', 'push'],\r\n          priority: 'medium',\r\n          maxRetries: 2,\r\n        },\r\n      },\r\n\r\n      // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£\r\n      ERROR_OPERATION_FAILED: {\r\n        name: 'Operation Failed',\r\n        category: 'error',\r\n        content: {\r\n          ar: {\r\n            title: '‚ùå ŸÅÿ¥ŸÑÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©',\r\n            body: 'ŸÅÿ¥ŸÑÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©: {{operation_name}}. ÿßŸÑÿÆÿ∑ÿ£: {{error_message}}. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ÿ£Ÿà ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿßŸÑÿØÿπŸÖ.',\r\n            shortBody: 'ÿÆÿ∑ÿ£: {{operation_name}}',\r\n            actionText: 'ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿßŸÑÿØÿπŸÖ',\r\n          },\r\n          en: {\r\n            title: '‚ùå Operation Failed',\r\n            body: 'Operation {{operation_name}} failed. Error: {{error_message}}. Please try again or contact support.',\r\n            shortBody: 'Error: {{operation_name}}',\r\n            actionText: 'Contact Support',\r\n          },\r\n        },\r\n        variables: ['operation_name', 'error_message'],\r\n        requiredVariables: ['operation_name'],\r\n        settings: {\r\n          channels: ['email', 'inApp', 'push'],\r\n          priority: 'high',\r\n          maxRetries: 3,\r\n        },\r\n      },\r\n\r\n      // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜÿ¨ÿßÿ≠\r\n      SUCCESS_NOTIFICATION: {\r\n        name: 'Success Notification',\r\n        category: 'success',\r\n        content: {\r\n          ar: {\r\n            title: '‚úÖ ŸÜÿ¨ÿ≠ÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©',\r\n            body: '{{operation_name}} ŸÇÿØ ÿ™ŸÖÿ™ ÿ®ŸÜÿ¨ÿßÿ≠. {{additional_info}}',\r\n            shortBody: 'ŸÜÿ¨ÿßÿ≠: {{operation_name}}',\r\n            actionText: 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ',\r\n          },\r\n          en: {\r\n            title: '‚úÖ Success',\r\n            body: '{{operation_name}} has been completed successfully. {{additional_info}}',\r\n            shortBody: 'Success: {{operation_name}}',\r\n            actionText: 'View Details',\r\n          },\r\n        },\r\n        variables: ['operation_name', 'additional_info'],\r\n        requiredVariables: ['operation_name'],\r\n        settings: {\r\n          channels: ['email', 'inApp', 'push'],\r\n          priority: 'low',\r\n          maxRetries: 2,\r\n        },\r\n      },\r\n\r\n      // ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑÿ£ÿπŸÖÿßŸÑ\r\n      BUSINESS_UPDATE: {\r\n        name: 'Business Update',\r\n        category: 'business',\r\n        content: {\r\n          ar: {\r\n            title: 'üìä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿπŸÖÿßŸÑ',\r\n            body: '{{update_title}}\\n\\nÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ: {{update_content}}\\n\\nÿßŸÑÿ™ÿßÿ±ŸäÿÆ: {{date}}',\r\n            shortBody: '{{update_title}}',\r\n            actionText: 'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±',\r\n          },\r\n          en: {\r\n            title: 'üìä Business Update',\r\n            body: '{{update_title}}\\n\\nDetails: {{update_content}}\\n\\nDate: {{date}}',\r\n            shortBody: '{{update_title}}',\r\n            actionText: 'View Report',\r\n          },\r\n        },\r\n        variables: ['update_title', 'update_content', 'date'],\r\n        requiredVariables: ['update_title'],\r\n        settings: {\r\n          channels: ['email', 'inApp', 'push'],\r\n          priority: 'medium',\r\n          maxRetries: 3,\r\n        },\r\n      },\r\n\r\n      // ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ±\r\n      WARNING_NOTICE: {\r\n        name: 'Warning Notice',\r\n        category: 'warning',\r\n        content: {\r\n          ar: {\r\n            title: '‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá',\r\n            body: 'ÿ™ŸÜÿ®ŸäŸá: {{warning_message}}. ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑŸÖÿ∑ŸÑŸàÿ®: {{required_action}}.',\r\n            shortBody: 'ÿ™ŸÜÿ®ŸäŸá: {{warning_message}}',\r\n            actionText: 'ÿßÿ™ÿÆÿßÿ∞ ÿ•ÿ¨ÿ±ÿßÿ°',\r\n          },\r\n          en: {\r\n            title: '‚ö†Ô∏è Warning',\r\n            body: 'Warning: {{warning_message}}. Required action: {{required_action}}.',\r\n            shortBody: 'Warning: {{warning_message}}',\r\n            actionText: 'Take Action',\r\n          },\r\n        },\r\n        variables: ['warning_message', 'required_action'],\r\n        requiredVariables: ['warning_message'],\r\n        settings: {\r\n          channels: ['email', 'sms', 'inApp', 'push'],\r\n          priority: 'high',\r\n          maxRetries: 3,\r\n        },\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇŸàÿßŸÑÿ® ÿßŸÑŸÖÿØŸÖÿ¨ÿ© ÿ•ŸÑŸâ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n   */\r\n  loadBuiltInTemplates() {\r\n    Object.entries(this.builtInTemplates).forEach(([key, template]) => {\r\n      this.cache.set(key, {\r\n        ...template,\r\n        templateId: key,\r\n        isBuiltIn: true,\r\n      });\r\n    });\r\n\r\n    logger.info(`‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${Object.keys(this.builtInTemplates).length} ŸÇÿßŸÑÿ® ŸÖÿØŸÖÿ¨ ÿ•ŸÑŸâ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©`);\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * üìã ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÇŸàÿßŸÑÿ®\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÇÿßŸÑÿ®\r\n   */\r\n  async getTemplate(templateId, language = 'ar') {\r\n    try {\r\n      // ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n      if (this.cache.has(templateId)) {\r\n        return this.cache.get(templateId);\r\n      }\r\n\r\n      // ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\r\n      const template = await Template.findOne({\r\n        templateId,\r\n        isActive: true,\r\n      }).exec();\r\n\r\n      if (template) {\r\n        // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n        this.cache.set(templateId, template);\r\n\r\n        // ÿ™ÿ≠ÿØŸäÿØ ŸàŸÇÿ™ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©\r\n        setTimeout(() => this.cache.delete(templateId), this.cacheTimeout);\r\n      }\r\n\r\n      return template;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑŸÇÿßŸÑÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßŸÑÿ® ÿ¨ÿØŸäÿØ\r\n   */\r\n  async createTemplate(templateData) {\r\n    try {\r\n      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\r\n      this.validateTemplateData(templateData);\r\n\r\n      const template = new Template({\r\n        templateId: `CUSTOM_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        ...templateData,\r\n      });\r\n\r\n      const savedTemplate = await template.save();\r\n\r\n      // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n      this.cache.set(savedTemplate.templateId, savedTemplate);\r\n\r\n      logger.info(`‚úÖ ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßŸÑÿ® ÿ¨ÿØŸäÿØ: ${savedTemplate.templateId}`);\r\n\r\n      return savedTemplate;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÇÿßŸÑÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßŸÑÿ®\r\n   */\r\n  async updateTemplate(templateId, updates) {\r\n    try {\r\n      const result = await Template.updateOne(\r\n        { templateId },\r\n        {\r\n          ...updates,\r\n          updatedAt: new Date(),\r\n        }\r\n      );\r\n\r\n      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n      this.cache.delete(templateId);\r\n\r\n      logger.info(`üìù ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßŸÑÿ®: ${templateId}`);\r\n\r\n      return result;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßŸÑÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ≠ÿ∞ŸÅ ŸÇÿßŸÑÿ®\r\n   */\r\n  async deleteTemplate(templateId) {\r\n    try {\r\n      const result = await Template.deleteOne({ templateId });\r\n\r\n      // ÿ≠ÿ∞ŸÅ ŸÖŸÜ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n      this.cache.delete(templateId);\r\n\r\n      logger.info(`üóëÔ∏è ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßŸÑÿ®: ${templateId}`);\r\n\r\n      return result;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßŸÑÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÇŸàÿßŸÑÿ®\r\n   */\r\n  async searchTemplates(criteria = {}) {\r\n    try {\r\n      const query = {\r\n        isActive: true,\r\n        ...criteria,\r\n      };\r\n\r\n      const templates = await Template.find(query).exec();\r\n\r\n      return templates;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÇŸàÿßŸÑÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * üîÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÖŸÜ ÿßŸÑŸÇÿßŸÑÿ®\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿ•ŸÜÿ¥ÿßÿ° ÿ•ÿ¥ÿπÿßÿ± ŸÖŸÜ ŸÇÿßŸÑÿ®\r\n   */\r\n  async createNotificationFromTemplate(templateId, variables = {}, language = 'ar') {\r\n    try {\r\n      // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇÿßŸÑÿ®\r\n      const template = await this.getTemplate(templateId, language);\r\n\r\n      if (!template) {\r\n        throw new Error(`ÿßŸÑŸÇÿßŸÑÿ® ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ: ${templateId}`);\r\n      }\r\n\r\n      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©\r\n      const missing = template.requiredVariables.filter(\r\n        variable => !variables[variable]\r\n      );\r\n\r\n      if (missing.length > 0) {\r\n        throw new Error(`ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÖÿ∑ŸÑŸàÿ®ÿ© ŸÖŸÅŸÇŸàÿØÿ©: ${missing.join(', ')}`);\r\n      }\r\n\r\n      // ÿ®ŸÜÿßÿ° ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n      const notificationContent = this.buildNotificationContent(\r\n        template,\r\n        variables,\r\n        language\r\n      );\r\n\r\n      return {\r\n        title: notificationContent.title,\r\n        body: notificationContent.body,\r\n        shortBody: notificationContent.shortBody,\r\n        actionText: notificationContent.actionText,\r\n        type: template.category,\r\n        channels: template.settings.channels,\r\n        priority: template.settings.priority,\r\n      };\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÖŸÜ ÿßŸÑŸÇÿßŸÑÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿ®ŸÜÿßÿ° ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±\r\n   */\r\n  buildNotificationContent(template, variables, language = 'ar') {\r\n    const templateContent = template.content[language] || template.content.en;\r\n\r\n    return {\r\n      title: this.replaceVariables(templateContent.title, variables),\r\n      body: this.replaceVariables(templateContent.body, variables),\r\n      shortBody: this.replaceVariables(templateContent.shortBody || '', variables),\r\n      actionText: templateContent.actionText,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™\r\n   */\r\n  replaceVariables(text, variables) {\r\n    if (!text) return '';\r\n\r\n    return text.replace(/\\{\\{(\\w+)\\}\\}/g, (match, variable) => {\r\n      return variables[variable] !== undefined ? String(variables[variable]) : match;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   * üõ†Ô∏è ÿßŸÑÿ£ÿØŸàÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸàÿßŸÑÿ™ÿ≠ŸÇŸÇ\r\n   * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n   */\r\n\r\n  /**\r\n   * ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÇÿßŸÑÿ®\r\n   */\r\n  validateTemplateData(templateData) {\r\n    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿπÿ±ÿ®Ÿä\r\n    if (!templateData.content?.ar?.title || !templateData.content?.ar?.body) {\r\n      throw new Error('ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿπÿ±ÿ®Ÿä ŸÖÿ∑ŸÑŸàÿ® (title Ÿà body)');\r\n    }\r\n\r\n    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä\r\n    if (!templateData.content?.en?.title || !templateData.content?.en?.body) {\r\n      throw new Error('ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä ŸÖÿ∑ŸÑŸàÿ® (title Ÿà body)');\r\n    }\r\n\r\n    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™\r\n    if (templateData.requiredVariables) {\r\n      const allVariables = new Set([\r\n        ...templateData.variables || [],\r\n        ...templateData.requiredVariables,\r\n      ]);\r\n\r\n      templateData.variables = Array.from(allVariables);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßŸÑÿ≥ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©\r\n   */\r\n  async getAllTemplates(filters = {}) {\r\n    try {\r\n      const query = { isActive: true, ...filters };\r\n      const templates = await Template.find(query)\r\n        .sort({ category: 1, name: 1 })\r\n        .exec();\r\n\r\n      return templates;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸàÿßŸÑÿ®: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸàÿßŸÑÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÅÿ¶ÿ©\r\n   */\r\n  async getTemplatesByCategory(category) {\r\n    try {\r\n      const templates = await Template.find({\r\n        category,\r\n        isActive: true,\r\n      }).exec();\r\n\r\n      return templates;\r\n    } catch (error) {\r\n      logger.error(`‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑŸÇŸàÿßŸÑÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÅÿ¶ÿ©: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ŸÖÿ≥ÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n   */\r\n  clearCache() {\r\n    const size = this.cache.size;\r\n    this.cache.clear();\r\n    this.loadBuiltInTemplates();\r\n    logger.info(`üóëÔ∏è ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ© (${size} ÿπŸÜÿµÿ±)`);\r\n  }\r\n\r\n  /**\r\n   * ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©\r\n   */\r\n  getCacheStats() {\r\n    return {\r\n      cacheSize: this.cache.size,\r\n      builtInTemplates: Object.keys(this.builtInTemplates).length,\r\n      cacheTimeout: this.cacheTimeout / 1000 + 's',\r\n    };\r\n  }\r\n}\r\n\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n// üì¶ ÿßŸÑÿ™ÿµÿØŸäÿ±\r\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nmodule.exports = {\r\n  SmartTemplateSystem,\r\n  Template,\r\n  templateSystem: new SmartTemplateSystem(),\r\n};\r\n"],"mappings":"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","ignoreList":[]}