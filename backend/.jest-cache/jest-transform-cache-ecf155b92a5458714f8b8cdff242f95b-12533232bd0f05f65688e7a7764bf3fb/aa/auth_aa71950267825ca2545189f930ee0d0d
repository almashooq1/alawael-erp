2d670b462bf38f31b7203a58f49c9c56
/**
 * Authentication Middleware
 * Basic auth middleware for protected routes
 */

const jwt = require('jwt-simple');
const logger = require('../utils/logger');
const SECRET = process.env.JWT_SECRET || 'your-secret-key';

/**
 * Verify JWT token
 */
const verifyToken = (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    if (!token) {
      return res.status(401).json({
        success: false,
        error: 'No token provided'
      });
    }

    // Decode base64 token (as generated by AuthService)
    let decoded;
    try {
      decoded = JSON.parse(Buffer.from(token, 'base64').toString());
    } catch (e) {
      // If base64 decoding fails, try JWT
      try {
        decoded = jwt.decode(token, SECRET);
      } catch (jwtError) {
        // If both fail, return invalid token error
        return res.status(401).json({
          success: false,
          error: 'Invalid token'
        });
      }
    }
    if (decoded.exp && decoded.exp < Date.now()) {
      return res.status(401).json({
        success: false,
        error: 'Token expired'
      });
    }
    req.user = decoded;
    next();
  } catch (error) {
    logger.error('Token verification failed:', error);
    res.status(401).json({
      success: false,
      error: 'Invalid token'
    });
  }
};

/**
 * Optional authentication - doesn't fail if no token
 */
const optionalAuth = (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    if (token) {
      // Decode base64 token (as generated by AuthService)
      let decoded;
      try {
        decoded = JSON.parse(Buffer.from(token, 'base64').toString());
      } catch (_e) {
        // Try JWT decoding as fallback
        try {
          decoded = jwt.decode(token, SECRET);
        } catch (jwtError) {
          // If both fail, just continue without user
          return next();
        }
      }
      if (!decoded.exp || decoded.exp >= Date.now()) {
        req.user = decoded;
      }
    }
    next();
  } catch (error) {
    logger.debug('Optional auth failed:', error.message);
    next();
  }
};

/**
 * Admin authorization
 */

// RBAC متقدم: تحقق من الدور والصلاحيات والسياق المؤسسي/الفرعي
const requireAdmin = (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  // تحقق من الدور الأساسي أو الأدوار الإضافية
  const isAdmin = req.user.role === 'admin' || Array.isArray(req.user.roles) && req.user.roles.includes('admin');
  if (!isAdmin) {
    return res.status(403).json({
      error: 'Admin access required'
    });
  }
  // تحقق من المؤسسة/الفرع إذا تم تمرير orgId/branchId في الطلب
  if (req.params.orgId && req.user.organizationId && req.params.orgId !== req.user.organizationId) {
    return res.status(403).json({
      error: 'Access denied for this organization'
    });
  }
  if (req.params.branchId && req.user.branchId && req.params.branchId !== req.user.branchId) {
    return res.status(403).json({
      error: 'Access denied for this branch'
    });
  }
  next();
};

// ميدل وير لصلاحيات granular (permission string)
const requirePermission = permission => (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  // تحقق من الصلاحيات
  const hasPermission = Array.isArray(req.user.permissions) && req.user.permissions.includes(permission);
  if (!hasPermission) {
    return res.status(403).json({
      error: 'Permission denied'
    });
  }
  // تحقق من المؤسسة/الفرع إذا لزم
  if (req.params.orgId && req.user.organizationId && req.params.orgId !== req.user.organizationId) {
    return res.status(403).json({
      error: 'Access denied for this organization'
    });
  }
  if (req.params.branchId && req.user.branchId && req.params.branchId !== req.user.branchId) {
    return res.status(403).json({
      error: 'Access denied for this branch'
    });
  }
  next();
};

/**
 * Authenticate middleware (alias for verifyToken)
 */
const authenticate = verifyToken;

/**
 * Authorization middleware - checks multiple roles
 */
const authorize = (...allowedRoles) => (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  if (allowedRoles.length > 0 && !allowedRoles.includes(req.user.role)) {
    return res.status(403).json({
      error: 'Insufficient permissions'
    });
  }
  next();
};
module.exports = {
  verifyToken,
  optionalAuth,
  requireAdmin,
  requirePermission,
  authenticate,
  authorize,
  protect: verifyToken // Alias for backward compatibility
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwibG9nZ2VyIiwiU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ2ZXJpZnlUb2tlbiIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3BsaXQiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiZGVjb2RlZCIsIkpTT04iLCJwYXJzZSIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsImUiLCJkZWNvZGUiLCJqd3RFcnJvciIsImV4cCIsIkRhdGUiLCJub3ciLCJ1c2VyIiwib3B0aW9uYWxBdXRoIiwiX2UiLCJkZWJ1ZyIsIm1lc3NhZ2UiLCJyZXF1aXJlQWRtaW4iLCJpc0FkbWluIiwicm9sZSIsIkFycmF5IiwiaXNBcnJheSIsInJvbGVzIiwiaW5jbHVkZXMiLCJwYXJhbXMiLCJvcmdJZCIsIm9yZ2FuaXphdGlvbklkIiwiYnJhbmNoSWQiLCJyZXF1aXJlUGVybWlzc2lvbiIsInBlcm1pc3Npb24iLCJoYXNQZXJtaXNzaW9uIiwicGVybWlzc2lvbnMiLCJhdXRoZW50aWNhdGUiLCJhdXRob3JpemUiLCJhbGxvd2VkUm9sZXMiLCJsZW5ndGgiLCJtb2R1bGUiLCJleHBvcnRzIiwicHJvdGVjdCJdLCJzb3VyY2VzIjpbImF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEF1dGhlbnRpY2F0aW9uIE1pZGRsZXdhcmVcclxuICogQmFzaWMgYXV0aCBtaWRkbGV3YXJlIGZvciBwcm90ZWN0ZWQgcm91dGVzXHJcbiAqL1xyXG5cclxuY29uc3Qgand0ID0gcmVxdWlyZSgnand0LXNpbXBsZScpO1xyXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuLi91dGlscy9sb2dnZXInKTtcclxuXHJcbmNvbnN0IFNFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XHJcblxyXG4vKipcclxuICogVmVyaWZ5IEpXVCB0b2tlblxyXG4gKi9cclxuY29uc3QgdmVyaWZ5VG9rZW4gPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uPy5zcGxpdCgnICcpWzFdO1xyXG5cclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gdG9rZW4gcHJvdmlkZWQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERlY29kZSBiYXNlNjQgdG9rZW4gKGFzIGdlbmVyYXRlZCBieSBBdXRoU2VydmljZSlcclxuICAgIGxldCBkZWNvZGVkO1xyXG4gICAgdHJ5IHtcclxuICAgICAgZGVjb2RlZCA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20odG9rZW4sICdiYXNlNjQnKS50b1N0cmluZygpKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8gSWYgYmFzZTY0IGRlY29kaW5nIGZhaWxzLCB0cnkgSldUXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgZGVjb2RlZCA9IGp3dC5kZWNvZGUodG9rZW4sIFNFQ1JFVCk7XHJcbiAgICAgIH0gY2F0Y2ggKGp3dEVycm9yKSB7XHJcbiAgICAgICAgLy8gSWYgYm90aCBmYWlsLCByZXR1cm4gaW52YWxpZCB0b2tlbiBlcnJvclxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgdG9rZW4nIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGRlY29kZWQuZXhwICYmIGRlY29kZWQuZXhwIDwgRGF0ZS5ub3coKSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdUb2tlbiBleHBpcmVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXEudXNlciA9IGRlY29kZWQ7XHJcbiAgICBuZXh0KCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5lcnJvcignVG9rZW4gdmVyaWZpY2F0aW9uIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgdG9rZW4nIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBPcHRpb25hbCBhdXRoZW50aWNhdGlvbiAtIGRvZXNuJ3QgZmFpbCBpZiBubyB0b2tlblxyXG4gKi9cclxuY29uc3Qgb3B0aW9uYWxBdXRoID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbj8uc3BsaXQoJyAnKVsxXTtcclxuXHJcbiAgICBpZiAodG9rZW4pIHtcclxuICAgICAgLy8gRGVjb2RlIGJhc2U2NCB0b2tlbiAoYXMgZ2VuZXJhdGVkIGJ5IEF1dGhTZXJ2aWNlKVxyXG4gICAgICBsZXQgZGVjb2RlZDtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBkZWNvZGVkID0gSlNPTi5wYXJzZShCdWZmZXIuZnJvbSh0b2tlbiwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkpO1xyXG4gICAgICB9IGNhdGNoIChfZSkge1xyXG4gICAgICAgIC8vIFRyeSBKV1QgZGVjb2RpbmcgYXMgZmFsbGJhY2tcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgZGVjb2RlZCA9IGp3dC5kZWNvZGUodG9rZW4sIFNFQ1JFVCk7XHJcbiAgICAgICAgfSBjYXRjaCAoand0RXJyb3IpIHtcclxuICAgICAgICAgIC8vIElmIGJvdGggZmFpbCwganVzdCBjb250aW51ZSB3aXRob3V0IHVzZXJcclxuICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWRlY29kZWQuZXhwIHx8IGRlY29kZWQuZXhwID49IERhdGUubm93KCkpIHtcclxuICAgICAgICByZXEudXNlciA9IGRlY29kZWQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZXh0KCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5kZWJ1ZygnT3B0aW9uYWwgYXV0aCBmYWlsZWQ6JywgZXJyb3IubWVzc2FnZSk7XHJcbiAgICBuZXh0KCk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkbWluIGF1dGhvcml6YXRpb25cclxuICovXHJcblxyXG4vLyBSQkFDINmF2KrZgtiv2YU6INiq2K3ZgtmCINmF2YYg2KfZhNiv2YjYsSDZiNin2YTYtdmE2KfYrdmK2KfYqiDZiNin2YTYs9mK2KfZgiDYp9mE2YXYpNiz2LPZii/Yp9mE2YHYsdi52YpcclxuY29uc3QgcmVxdWlyZUFkbWluID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgaWYgKCFyZXEudXNlcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNiv2YjYsSDYp9mE2KPYs9in2LPZiiDYo9mIINin2YTYo9iv2YjYp9ixINin2YTYpdi22KfZgdmK2KlcclxuICBjb25zdCBpc0FkbWluID1cclxuICAgIHJlcS51c2VyLnJvbGUgPT09ICdhZG1pbicgfHxcclxuICAgIChBcnJheS5pc0FycmF5KHJlcS51c2VyLnJvbGVzKSAmJiByZXEudXNlci5yb2xlcy5pbmNsdWRlcygnYWRtaW4nKSk7XHJcbiAgaWYgKCFpc0FkbWluKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNmF2KTYs9iz2Kkv2KfZhNmB2LHYuSDYpdiw2Kcg2KrZhSDYqtmF2LHZitixIG9yZ0lkL2JyYW5jaElkINmB2Yog2KfZhNi32YTYqFxyXG4gIGlmIChyZXEucGFyYW1zLm9yZ0lkICYmIHJlcS51c2VyLm9yZ2FuaXphdGlvbklkICYmIHJlcS5wYXJhbXMub3JnSWQgIT09IHJlcS51c2VyLm9yZ2FuaXphdGlvbklkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ0FjY2VzcyBkZW5pZWQgZm9yIHRoaXMgb3JnYW5pemF0aW9uJyB9KTtcclxuICB9XHJcbiAgaWYgKHJlcS5wYXJhbXMuYnJhbmNoSWQgJiYgcmVxLnVzZXIuYnJhbmNoSWQgJiYgcmVxLnBhcmFtcy5icmFuY2hJZCAhPT0gcmVxLnVzZXIuYnJhbmNoSWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnQWNjZXNzIGRlbmllZCBmb3IgdGhpcyBicmFuY2gnIH0pO1xyXG4gIH1cclxuICBuZXh0KCk7XHJcbn07XHJcblxyXG4vLyDZhdmK2K/ZhCDZiNmK2LEg2YTYtdmE2KfYrdmK2KfYqiBncmFudWxhciAocGVybWlzc2lvbiBzdHJpbmcpXHJcbmNvbnN0IHJlcXVpcmVQZXJtaXNzaW9uID0gcGVybWlzc2lvbiA9PiAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICBpZiAoIXJlcS51c2VyKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9KTtcclxuICB9XHJcbiAgLy8g2KrYrdmC2YIg2YXZhiDYp9mE2LXZhNin2K3Zitin2KpcclxuICBjb25zdCBoYXNQZXJtaXNzaW9uID1cclxuICAgIEFycmF5LmlzQXJyYXkocmVxLnVzZXIucGVybWlzc2lvbnMpICYmIHJlcS51c2VyLnBlcm1pc3Npb25zLmluY2x1ZGVzKHBlcm1pc3Npb24pO1xyXG4gIGlmICghaGFzUGVybWlzc2lvbikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdQZXJtaXNzaW9uIGRlbmllZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNmF2KTYs9iz2Kkv2KfZhNmB2LHYuSDYpdiw2Kcg2YTYstmFXHJcbiAgaWYgKHJlcS5wYXJhbXMub3JnSWQgJiYgcmVxLnVzZXIub3JnYW5pemF0aW9uSWQgJiYgcmVxLnBhcmFtcy5vcmdJZCAhPT0gcmVxLnVzZXIub3JnYW5pemF0aW9uSWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnQWNjZXNzIGRlbmllZCBmb3IgdGhpcyBvcmdhbml6YXRpb24nIH0pO1xyXG4gIH1cclxuICBpZiAocmVxLnBhcmFtcy5icmFuY2hJZCAmJiByZXEudXNlci5icmFuY2hJZCAmJiByZXEucGFyYW1zLmJyYW5jaElkICE9PSByZXEudXNlci5icmFuY2hJZCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkIGZvciB0aGlzIGJyYW5jaCcgfSk7XHJcbiAgfVxyXG4gIG5leHQoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBdXRoZW50aWNhdGUgbWlkZGxld2FyZSAoYWxpYXMgZm9yIHZlcmlmeVRva2VuKVxyXG4gKi9cclxuY29uc3QgYXV0aGVudGljYXRlID0gdmVyaWZ5VG9rZW47XHJcblxyXG4vKipcclxuICogQXV0aG9yaXphdGlvbiBtaWRkbGV3YXJlIC0gY2hlY2tzIG11bHRpcGxlIHJvbGVzXHJcbiAqL1xyXG5jb25zdCBhdXRob3JpemUgPVxyXG4gICguLi5hbGxvd2VkUm9sZXMpID0+XHJcbiAgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICBpZiAoIXJlcS51c2VyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhbGxvd2VkUm9sZXMubGVuZ3RoID4gMCAmJiAhYWxsb3dlZFJvbGVzLmluY2x1ZGVzKHJlcS51c2VyLnJvbGUpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZXh0KCk7XHJcbiAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHZlcmlmeVRva2VuLFxyXG4gIG9wdGlvbmFsQXV0aCxcclxuICByZXF1aXJlQWRtaW4sXHJcbiAgcmVxdWlyZVBlcm1pc3Npb24sXHJcbiAgYXV0aGVudGljYXRlLFxyXG4gIGF1dGhvcml6ZSxcclxuICBwcm90ZWN0OiB2ZXJpZnlUb2tlbiwgLy8gQWxpYXMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxZQUFZLENBQUM7QUFDakMsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFFekMsTUFBTUUsTUFBTSxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJLGlCQUFpQjs7QUFFMUQ7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsV0FBVyxHQUFHQSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ3RDLElBQUk7SUFDRixNQUFNQyxLQUFLLEdBQUdILEdBQUcsQ0FBQ0ksT0FBTyxDQUFDQyxhQUFhLEVBQUVDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFdEQsSUFBSSxDQUFDSCxLQUFLLEVBQUU7TUFDVixPQUFPRixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQUVDLE9BQU8sRUFBRSxLQUFLO1FBQUVDLEtBQUssRUFBRTtNQUFvQixDQUFDLENBQUM7SUFDN0U7O0lBRUE7SUFDQSxJQUFJQyxPQUFPO0lB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