{"version":3,"names":["express","require","router","Router","trafficAccidentController","authenticate","authorize","use","post","createAccidentReport","get","getAllReports","searchReports","getStatistics","getOverdueFollowUps","getNearbyAccidents","getReportById","put","updateAccidentReport","delete","deleteAccidentReport","patch","updateReportStatus","req","res","next","body","status","closeReport","startInvestigation","completeInvestigation","determineLiability","updateDamageInfo","addInsuranceInfo","addComment","addAttachment","addWitness","exportPDF","exportExcel","module","exports"],"sources":["trafficAccidents.js"],"sourcesContent":["/**\r\n * Traffic Accident Routes - مسارات الحوادث المرورية\r\n * API endpoints لتقارير الحوادث المرورية الشاملة\r\n */\r\n\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst trafficAccidentController = require('../controllers/trafficAccidentController');\r\nconst authenticate = require('../middleware/authenticate');\r\nconst authorize = require('../middleware/authorize');\r\n\r\n// ========================================\r\n// MIDDLEWARE\r\n// ========================================\r\nrouter.use(authenticate);\r\n\r\n// ========================================\r\n// REPORTS ENDPOINTS\r\n// ========================================\r\n\r\n/**\r\n * POST /api/traffic-accidents\r\n * إنشاء تقرير حادث جديد\r\n */\r\nrouter.post(\r\n  '/',\r\n  authorize('create_accident_report'),\r\n  trafficAccidentController.createAccidentReport\r\n);\r\n\r\n/**\r\n * GET /api/traffic-accidents\r\n * الحصول على جميع التقارير مع التصفية والترقيم\r\n * Query params: status, severity, city, priority, startDate, endDate, page, limit\r\n */\r\nrouter.get(\r\n  '/',\r\n  authorize('view_accident_reports'),\r\n  trafficAccidentController.getAllReports\r\n);\r\n\r\n/**\r\n * GET /api/traffic-accidents/search\r\n * البحث المتقدم في التقارير\r\n * Query params: q, severity, status, page, limit\r\n */\r\nrouter.get(\r\n  '/search',\r\n  authorize('view_accident_reports'),\r\n  trafficAccidentController.searchReports\r\n);\r\n\r\n/**\r\n * GET /api/traffic-accidents/statistics\r\n * الحصول على الإحصائيات والتقارير\r\n * Query params: startDate, endDate, city, severity, status\r\n */\r\nrouter.get(\r\n  '/statistics',\r\n  authorize('view_accident_statistics'),\r\n  trafficAccidentController.getStatistics\r\n);\r\n\r\n/**\r\n * GET /api/traffic-accidents/overdue\r\n * الحصول على المتابعات المتأخرة\r\n * Query params: daysThreshold\r\n */\r\nrouter.get(\r\n  '/overdue',\r\n  authorize('view_accident_reports'),\r\n  trafficAccidentController.getOverdueFollowUps\r\n);\r\n\r\n/**\r\n * GET /api/traffic-accidents/nearby\r\n * الحصول على الحوادث القريبة جغرافياً\r\n * Query params: latitude, longitude, maxDistance\r\n */\r\nrouter.get(\r\n  '/nearby',\r\n  authorize('view_accident_reports'),\r\n  trafficAccidentController.getNearbyAccidents\r\n);\r\n\r\n/**\r\n * GET /api/traffic-accidents/:id\r\n * الحصول على تقرير محدد\r\n */\r\nrouter.get(\r\n  '/:id',\r\n  authorize('view_accident_reports'),\r\n  trafficAccidentController.getReportById\r\n);\r\n\r\n/**\r\n * PUT /api/traffic-accidents/:id\r\n * تحديث تقرير الحادث\r\n */\r\nrouter.put(\r\n  '/:id',\r\n  authorize('edit_accident_report'),\r\n  trafficAccidentController.updateAccidentReport\r\n);\r\n\r\n/**\r\n * DELETE /api/traffic-accidents/:id\r\n * حذف/أرشفة تقرير\r\n */\r\nrouter.delete(\r\n  '/:id',\r\n  authorize('delete_accident_report'),\r\n  trafficAccidentController.deleteAccidentReport\r\n);\r\n\r\n// ========================================\r\n// STATUS MANAGEMENT ENDPOINTS\r\n// ========================================\r\n\r\n/**\r\n * PATCH /api/traffic-accidents/:id/status\r\n * تحديث حالة التقرير\r\n * Body: { status: string, notes?: string }\r\n */\r\nrouter.patch(\r\n  '/:id/status',\r\n  authorize('edit_accident_report'),\r\n  trafficAccidentController.updateReportStatus\r\n);\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/approve\r\n * الموافقة على التقرير\r\n */\r\nrouter.post(\r\n  '/:id/approve',\r\n  authorize('approve_accident_report'),\r\n  (req, res, next) => {\r\n    req.body.status = 'approved';\r\n    trafficAccidentController.updateReportStatus(req, res);\r\n  }\r\n);\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/close\r\n * إغلاق التقرير\r\n * Body: { conclusionData: object }\r\n */\r\nrouter.post(\r\n  '/:id/close',\r\n  authorize('close_accident_report'),\r\n  trafficAccidentController.closeReport\r\n);\r\n\r\n// ========================================\r\n// INVESTIGATION ENDPOINTS\r\n// ========================================\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/investigation/start\r\n * بدء التحقيق\r\n * Body: { investigatingOfficerId: string }\r\n */\r\nrouter.post(\r\n  '/:id/investigation/start',\r\n  authorize('start_investigation'),\r\n  trafficAccidentController.startInvestigation\r\n);\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/investigation/complete\r\n * إكمال التحقيق\r\n * Body: { findings, rootCause, contributingFactors, recommendations, primaryCause }\r\n */\r\nrouter.post(\r\n  '/:id/investigation/complete',\r\n  authorize('complete_investigation'),\r\n  trafficAccidentController.completeInvestigation\r\n);\r\n\r\n// ========================================\r\n// LIABILITY & DAMAGE ENDPOINTS\r\n// ========================================\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/liability\r\n * تحديد المسؤولية\r\n * Body: { primaryResponsiblePartyId, responsibilityPercentage, determination }\r\n */\r\nrouter.post(\r\n  '/:id/liability',\r\n  authorize('determine_liability'),\r\n  trafficAccidentController.determineLiability\r\n);\r\n\r\n/**\r\n * PUT /api/traffic-accidents/:id/vehicles/:vehicleIndex/damage\r\n * تحديث معلومات الضرر\r\n * Body: damageData object\r\n */\r\nrouter.put(\r\n  '/:id/vehicles/:vehicleIndex/damage',\r\n  authorize('edit_accident_report'),\r\n  trafficAccidentController.updateDamageInfo\r\n);\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/vehicles/:vehicleIndex/insurance\r\n * إضافة معلومات التأمين\r\n * Body: insuranceData object\r\n */\r\nrouter.post(\r\n  '/:id/vehicles/:vehicleIndex/insurance',\r\n  authorize('edit_accident_report'),\r\n  trafficAccidentController.addInsuranceInfo\r\n);\r\n\r\n// ========================================\r\n// COMMENTS & ATTACHMENTS ENDPOINTS\r\n// ========================================\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/comments\r\n * إضافة تعليق\r\n * Body: { comment: string, attachments?: array }\r\n */\r\nrouter.post(\r\n  '/:id/comments',\r\n  authorize('add_comment'),\r\n  trafficAccidentController.addComment\r\n);\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/attachments\r\n * إضافة مرفق\r\n * Body: { fileName: string, fileUrl: string, fileType: string }\r\n */\r\nrouter.post(\r\n  '/:id/attachments',\r\n  authorize('upload_attachment'),\r\n  trafficAccidentController.addAttachment\r\n);\r\n\r\n// ========================================\r\n// WITNESSES ENDPOINTS\r\n// ========================================\r\n\r\n/**\r\n * POST /api/traffic-accidents/:id/witnesses\r\n * إضافة شاهد\r\n * Body: witnessData object\r\n */\r\nrouter.post(\r\n  '/:id/witnesses',\r\n  authorize('add_witness'),\r\n  trafficAccidentController.addWitness\r\n);\r\n\r\n// ========================================\r\n// EXPORT ENDPOINTS\r\n// ========================================\r\n\r\n/**\r\n * GET /api/traffic-accidents/:id/export/pdf\r\n * تصدير التقرير بصيغة PDF\r\n */\r\nrouter.get(\r\n  '/:id/export/pdf',\r\n  authorize('export_report'),\r\n  trafficAccidentController.exportPDF\r\n);\r\n\r\n/**\r\n * GET /api/traffic-accidents/export/excel\r\n * تصدير التقارير بصيغة Excel\r\n * Query params: startDate, endDate, city, severity\r\n */\r\nrouter.get(\r\n  '/export/excel',\r\n  authorize('export_report'),\r\n  trafficAccidentController.exportExcel\r\n);\r\n\r\nmodule.exports = router;\r\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAMC,yBAAyB,GAAGH,OAAO,CAAC,0CAA0C,CAAC;AACrF,MAAMI,YAAY,GAAGJ,OAAO,CAAC,4BAA4B,CAAC;AAC1D,MAAMK,SAAS,GAAGL,OAAO,CAAC,yBAAyB,CAAC;;AAEpD;AACA;AACA;AACAC,MAAM,CAACK,GAAG,CAACF,YAAY,CAAC;;AAExB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACAH,MAAM,CAACM,IAAI,CACT,GAAG,EACHF,SAAS,CAAC,wBAAwB,CAAC,EACnCF,yBAAyB,CAACK,oBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAP,MAAM,CAACQ,GAAG,CACR,GAAG,EACHJ,SAAS,CAAC,uBAAuB,CAAC,EAClCF,yBAAyB,CAACO,aAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAT,MAAM,CAACQ,GAAG,CACR,SAAS,EACTJ,SAAS,CAAC,uBAAuB,CAAC,EAClCF,yBAAyB,CAACQ,aAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAV,MAAM,CAACQ,GAAG,CACR,aAAa,EACbJ,SAAS,CAAC,0BAA0B,CAAC,EACrCF,yBAAyB,CAACS,aAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAX,MAAM,CAACQ,GAAG,CACR,UAAU,EACVJ,SAAS,CAAC,uBAAuB,CAAC,EAClCF,yBAAyB,CAACU,mBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAZ,MAAM,CAACQ,GAAG,CACR,SAAS,EACTJ,SAAS,CAAC,uBAAuB,CAAC,EAClCF,yBAAyB,CAACW,kBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACAb,MAAM,CAACQ,GAAG,CACR,MAAM,EACNJ,SAAS,CAAC,uBAAuB,CAAC,EAClCF,yBAAyB,CAACY,aAC5B,CAAC;;AAED;AACA;AACA;AACA;AACAd,MAAM,CAACe,GAAG,CACR,MAAM,EACNX,SAAS,CAAC,sBAAsB,CAAC,EACjCF,yBAAyB,CAACc,oBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACAhB,MAAM,CAACiB,MAAM,CACX,MAAM,EACNb,SAAS,CAAC,wBAAwB,CAAC,EACnCF,yBAAyB,CAACgB,oBAC5B,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACAlB,MAAM,CAACmB,KAAK,CACV,aAAa,EACbf,SAAS,CAAC,sBAAsB,CAAC,EACjCF,yBAAyB,CAACkB,kBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACApB,MAAM,CAACM,IAAI,CACT,cAAc,EACdF,SAAS,CAAC,yBAAyB,CAAC,EACpC,CAACiB,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EAClBF,GAAG,CAACG,IAAI,CAACC,MAAM,GAAG,UAAU;EAC5BvB,yBAAyB,CAACkB,kBAAkB,CAACC,GAAG,EAAEC,GAAG,CAAC;AACxD,CACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAtB,MAAM,CAACM,IAAI,CACT,YAAY,EACZF,SAAS,CAAC,uBAAuB,CAAC,EAClCF,yBAAyB,CAACwB,WAC5B,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA1B,MAAM,CAACM,IAAI,CACT,0BAA0B,EAC1BF,SAAS,CAAC,qBAAqB,CAAC,EAChCF,yBAAyB,CAACyB,kBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA3B,MAAM,CAACM,IAAI,CACT,6BAA6B,EAC7BF,SAAS,CAAC,wBAAwB,CAAC,EACnCF,yBAAyB,CAAC0B,qBAC5B,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA5B,MAAM,CAACM,IAAI,CACT,gBAAgB,EAChBF,SAAS,CAAC,qBAAqB,CAAC,EAChCF,yBAAyB,CAAC2B,kBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA7B,MAAM,CAACe,GAAG,CACR,oCAAoC,EACpCX,SAAS,CAAC,sBAAsB,CAAC,EACjCF,yBAAyB,CAAC4B,gBAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA9B,MAAM,CAACM,IAAI,CACT,uCAAuC,EACvCF,SAAS,CAAC,sBAAsB,CAAC,EACjCF,yBAAyB,CAAC6B,gBAC5B,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA/B,MAAM,CAACM,IAAI,CACT,eAAe,EACfF,SAAS,CAAC,aAAa,CAAC,EACxBF,yBAAyB,CAAC8B,UAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAhC,MAAM,CAACM,IAAI,CACT,kBAAkB,EAClBF,SAAS,CAAC,mBAAmB,CAAC,EAC9BF,yBAAyB,CAAC+B,aAC5B,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACAjC,MAAM,CAACM,IAAI,CACT,gBAAgB,EAChBF,SAAS,CAAC,aAAa,CAAC,EACxBF,yBAAyB,CAACgC,UAC5B,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACAlC,MAAM,CAACQ,GAAG,CACR,iBAAiB,EACjBJ,SAAS,CAAC,eAAe,CAAC,EAC1BF,yBAAyB,CAACiC,SAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAnC,MAAM,CAACQ,GAAG,CACR,eAAe,EACfJ,SAAS,CAAC,eAAe,CAAC,EAC1BF,yBAAyB,CAACkC,WAC5B,CAAC;AAEDC,MAAM,CAACC,OAAO,GAAGtC,MAAM","ignoreList":[]}