{"version":3,"names":["router","post","notificationController","registerFcmToken","get","getNotificationPreferences","put","updateNotificationPreferences","scheduledNotificationController","require","schedule","getMyScheduled","notificationAnalyticsController","getSummary","express","Router","NotificationService","req","res","userId","title","message","channels","email","phone","body","result","sendNotification","json","err","status","success","error","authenticateToken","checkPermission","use","getMyNotifications","getUnreadCount","markAsRead","exportNotificationPDF","markAsUnread","markAllAsRead","logClickEvent","delete","deleteNotification","deleteReadNotifications","createNotification","createBulkNotifications","cleanupOldNotifications","module","exports"],"sources":["notifications.js"],"sourcesContent":["// تسجيل أو تحديث FCM Token للمستخدم الحالي\r\nrouter.post('/register-fcm', notificationController.registerFcmToken);\r\n// جلب تفضيلات الإشعارات للمستخدم الحالي\r\nrouter.get('/preferences', notificationController.getNotificationPreferences);\r\n\r\n// تحديث تفضيلات الإشعارات للمستخدم الحالي\r\nrouter.put('/preferences', notificationController.updateNotificationPreferences);\r\nconst scheduledNotificationController = require('../controllers/scheduledNotificationController');\r\n// جدولة إشعار جديد\r\nrouter.post('/schedule', scheduledNotificationController.schedule);\r\n\r\n// جلب الإشعارات المجدولة للمستخدم الحالي\r\nrouter.get('/scheduled', scheduledNotificationController.getMyScheduled);\r\nconst notificationAnalyticsController = require('../controllers/notificationAnalyticsController');\r\n// تحليلات الإشعارات (usage, delivery, engagement)\r\nrouter.get('/analytics/summary', notificationAnalyticsController.getSummary);\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst NotificationService = require('../services/notificationService');\r\n// اختبار إرسال إشعار متعدد القنوات (للتكامل)\r\nrouter.post('/send', async (req, res) => {\r\n  try {\r\n    const { userId, title, message, channels, email, phone } = req.body;\r\n    const result = await NotificationService.sendNotification(userId, {\r\n      title,\r\n      message,\r\n      channels,\r\n      email,\r\n      phone,\r\n    });\r\n    res.json(result);\r\n  } catch (err) {\r\n    res.status(500).json({ success: false, error: err.message });\r\n  }\r\n});\r\nconst notificationController = require('../controllers/notificationController');\r\nconst { authenticateToken } = require('../middleware/auth');\r\nconst { checkPermission } = require('../middleware/rbac');\r\n\r\n/**\r\n * Routes للإشعارات\r\n * جميع المسارات تحتاج مصادقة\r\n */\r\n\r\n// المسارات العامة (لجميع المستخدمين المسجلين)\r\nrouter.use(authenticateToken);\r\n\r\n// الحصول على إشعارات المستخدم الحالي\r\nrouter.get('/', notificationController.getMyNotifications);\r\n\r\n// الحصول على عدد الإشعارات غير المقروءة\r\nrouter.get('/unread/count', notificationController.getUnreadCount);\r\n\r\n// تحديد إشعار كمقروء\r\nrouter.put('/:id/read', notificationController.markAsRead);\r\n\r\n// تصدير إشعار كـ PDF مع رقم وباركود\r\nrouter.get('/:id/export-pdf', notificationController.exportNotificationPDF);\r\n\r\n// تحديد إشعار كغير مقروء\r\nrouter.put('/:id/unread', notificationController.markAsUnread);\r\n\r\n// تحديد جميع الإشعارات كمقروءة\r\nrouter.put('/read-all', notificationController.markAllAsRead);\r\n\r\n// تسجيل حدث النقر على الإشعار (analytics)\r\nrouter.post('/:id/click', notificationController.logClickEvent);\r\n\r\n// حذف إشعار واحد\r\nrouter.delete('/:id', notificationController.deleteNotification);\r\n\r\n// حذف جميع الإشعارات المقروءة\r\nrouter.delete('/read/all', notificationController.deleteReadNotifications);\r\n\r\n// المسارات المقيدة للإداريين فقط\r\n// إنشاء إشعار جديد\r\nrouter.post(\r\n  '/',\r\n  checkPermission('notifications', 'create'),\r\n  notificationController.createNotification\r\n);\r\n\r\n// إنشاء إشعارات متعددة\r\nrouter.post(\r\n  '/bulk',\r\n  checkPermission('notifications', 'create'),\r\n  notificationController.createBulkNotifications\r\n);\r\n\r\n// حذف الإشعارات القديمة (مهمة صيانة)\r\nrouter.delete(\r\n  '/cleanup',\r\n  checkPermission('notifications', 'delete'),\r\n  notificationController.cleanupOldNotifications\r\n);\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]}