{"version":3,"names":["jwt","require","crypto","redis","logger","SSOService","constructor","useMockCache","process","env","USE_MOCK_CACHE","mockStore","Map","redisClient","createClient","host","REDIS_HOST","port","REDIS_PORT","password","REDIS_PASSWORD","connect","catch","err","error","JWT_SECRET","SESSION_TIMEOUT","parseInt","REFRESH_TOKEN_TIMEOUT","_store","key","value","ttl","set","setTimeout","delete","setEx","JSON","stringify","warn","message","_get","get","parse","_addToSet","member","Set","add","sAdd","createSession","userId","userPayload","metadata","sessionId","randomBytes","toString","now","Date","session","createdAt","lastActivity","userAgent","ipAddress","deviceId","randomUUID","tokens","accessToken","refreshToken","idToken","status","generateTokens","Math","floor","info","expiresIn","tokenType","Error","verifySession","sessionData","valid","decoded","decode","exp","user","tokenError","refreshAccessToken","type","newAccessToken","generateAccessToken","endSession","endedAt","del","sRem","success","endAllUserSessions","sessionIds","sMembers","sessionsEnded","length","getUserActiveSessions","sessions","push","encode","iat","sub","aud","iss","updateSessionMetadata","getSessionInfo","validateOAuthRequest","clientId","redirectUri","scope","state","split","generateAuthorizationCode","code","authCode","expiresAt","exchangeAuthorizationCode","clientSecret","authCodeData","OAUTH_CLIENT_SECRET","source","introspectToken","token","active","reason","disconnect","module","exports"],"sources":["sso.service.js"],"sourcesContent":["/**\r\n * SSO (Single Sign-On) Service\r\n * نظام تسجيل الدخول الموحد المركزي\r\n * يدعم OAuth 2.0, OpenID Connect, SAML 2.0\r\n */\r\n\r\nconst jwt = require('jwt-simple');\r\nconst crypto = require('crypto');\r\nconst redis = require('redis');\r\nconst logger = require('../utils/logger');\r\n\r\nclass SSOService {\r\n  constructor() {\r\n    this.useMockCache = process.env.USE_MOCK_CACHE === 'true';\r\n    this.mockStore = new Map();\r\n    \r\n    // Try to connect to Redis if not using mock\r\n    if (!this.useMockCache) {\r\n      this.redisClient = redis.createClient({\r\n        host: process.env.REDIS_HOST || 'localhost',\r\n        port: process.env.REDIS_PORT || 6379,\r\n        password: process.env.REDIS_PASSWORD\r\n      });\r\n      \r\n      this.redisClient.connect().catch(err => {\r\n        logger.error('Redis connection error:', err);\r\n        // Fallback to mock cache\r\n        this.useMockCache = true;\r\n      });\r\n    }\r\n    \r\n    this.JWT_SECRET = process.env.JWT_SECRET || 'sso-secret-key';\r\n    this.SESSION_TIMEOUT = parseInt(process.env.SESSION_TIMEOUT || 3600000); // 1 hour\r\n    this.REFRESH_TOKEN_TIMEOUT = parseInt(process.env.REFRESH_TOKEN_TIMEOUT || 604800000); // 7 days\r\n  }\r\n\r\n  /**\r\n   * Helper: Store data (Redis or Mock)\r\n   */\r\n  async _store(key, value, ttl) {\r\n    try {\r\n      if (this.useMockCache) {\r\n        this.mockStore.set(key, value);\r\n        if (ttl) {\r\n          setTimeout(() => this.mockStore.delete(key), ttl * 1000);\r\n        }\r\n      } else if (this.redisClient) {\r\n        await this.redisClient.setEx(key, ttl, JSON.stringify(value));\r\n      }\r\n    } catch (error) {\r\n      logger.warn('Store failed, falling back to mock:', error.message);\r\n      this.useMockCache = true;\r\n      this.mockStore.set(key, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper: Get stored data (Redis or Mock)\r\n   */\r\n  async _get(key) {\r\n    try {\r\n      if (this.useMockCache) {\r\n        return this.mockStore.get(key);\r\n      } else if (this.redisClient) {\r\n        const value = await this.redisClient.get(key);\r\n        return value ? JSON.parse(value) : null;\r\n      }\r\n    } catch (error) {\r\n      logger.warn('Get failed, falling back to mock:', error.message);\r\n      this.useMockCache = true;\r\n      return this.mockStore.get(key);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper: Add to set (Redis or Mock)\r\n   */\r\n  async _addToSet(key, member) {\r\n    try {\r\n      if (this.useMockCache) {\r\n        let set = this.mockStore.get(key) || new Set();\r\n        set.add(member);\r\n        this.mockStore.set(key, set);\r\n      } else if (this.redisClient) {\r\n        await this.redisClient.sAdd(key, member);\r\n      }\r\n    } catch (error) {\r\n      logger.warn('AddToSet failed, falling back to mock:', error.message);\r\n      this.useMockCache = true;\r\n      let set = this.mockStore.get(key) || new Set();\r\n      set.add(member);\r\n      this.mockStore.set(key, set);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنشاء جلسة SSO جديدة\r\n   * Create a new SSO session\r\n   */\r\n  async createSession(userId, userPayload, metadata = {}) {\r\n    try {\r\n      const sessionId = crypto.randomBytes(32).toString('hex');\r\n      const now = Date.now();\r\n      \r\n      // Create session object\r\n      const session = {\r\n        sessionId,\r\n        userId,\r\n        userPayload,\r\n        createdAt: now,\r\n        lastActivity: now,\r\n        metadata: {\r\n          ...metadata,\r\n          userAgent: metadata.userAgent || 'unknown',\r\n          ipAddress: metadata.ipAddress || 'unknown',\r\n          deviceId: metadata.deviceId || crypto.randomUUID()\r\n        },\r\n        tokens: {\r\n          accessToken: null,\r\n          refreshToken: null,\r\n          idToken: null\r\n        },\r\n        status: 'active'\r\n      };\r\n\r\n      // Generate tokens\r\n      const tokens = this.generateTokens(userId, userPayload, sessionId);\r\n      session.tokens = tokens;\r\n\r\n      // Store session with TTL\r\n      await this._store(\r\n        `session:${sessionId}`,\r\n        session,\r\n        Math.floor(this.SESSION_TIMEOUT / 1000)\r\n      );\r\n\r\n      // Index session by userId for quick lookup\r\n      await this._addToSet(`user:${userId}:sessions`, sessionId);\r\n\r\n      logger.info(`SSO Session created: ${sessionId} for user: ${userId}`);\r\n\r\n      return {\r\n        sessionId,\r\n        accessToken: tokens.accessToken,\r\n        refreshToken: tokens.refreshToken,\r\n        idToken: tokens.idToken,\r\n        expiresIn: this.SESSION_TIMEOUT,\r\n        tokenType: 'Bearer'\r\n      };\r\n    } catch (error) {\r\n      logger.error('Failed to create SSO session:', error);\r\n      throw new Error('Failed to create SSO session');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من جلسة SSO\r\n   * Verify SSO session\r\n   */\r\n  async verifySession(sessionId, accessToken) {\r\n    try {\r\n      // Get session from storage\r\n      const sessionData = await this._get(`session:${sessionId}`);\r\n      \r\n      if (!sessionData) {\r\n        logger.warn(`Session not found: ${sessionId}`);\r\n        return { valid: false, error: 'Session expired or invalid' };\r\n      }\r\n\r\n      const session = typeof sessionData === 'string' ? JSON.parse(sessionData) : sessionData;\r\n\r\n      // Verify access token\r\n      try {\r\n        const decoded = jwt.decode(accessToken, this.JWT_SECRET);\r\n        \r\n        if (decoded.sessionId !== sessionId) {\r\n          logger.warn(`Session mismatch for token`);\r\n          return { valid: false, error: 'Session mismatch' };\r\n        }\r\n\r\n        if (decoded.exp && decoded.exp < Date.now()) {\r\n          logger.warn(`Token expired for session: ${sessionId}`);\r\n          return { valid: false, error: 'Token expired' };\r\n        }\r\n\r\n        // Update last activity\r\n        session.lastActivity = Date.now();\r\n        await this.redisClient.setEx(\r\n          `session:${sessionId}`,\r\n          Math.floor(this.SESSION_TIMEOUT / 1000),\r\n          JSON.stringify(session)\r\n        );\r\n\r\n        return {\r\n          valid: true,\r\n          session,\r\n          user: decoded\r\n        };\r\n      } catch (tokenError) {\r\n        logger.error(`Token verification failed: ${tokenError.message}`);\r\n        return { valid: false, error: 'Invalid token' };\r\n      }\r\n    } catch (error) {\r\n      logger.error('Session verification failed:', error);\r\n      return { valid: false, error: 'Session verification failed' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث Access Token\r\n   * Refresh access token\r\n   */\r\n  async refreshAccessToken(sessionId, refreshToken) {\r\n    try {\r\n      // Get session from Redis\r\n      const sessionData = await this.redisClient.get(`session:${sessionId}`);\r\n      \r\n      if (!sessionData) {\r\n        throw new Error('Session not found');\r\n      }\r\n\r\n      const session = JSON.parse(sessionData);\r\n\r\n      // Verify refresh token\r\n      try {\r\n        const decoded = jwt.decode(refreshToken, this.JWT_SECRET);\r\n        \r\n        if (decoded.type !== 'refresh') {\r\n          throw new Error('Invalid token type');\r\n        }\r\n\r\n        if (decoded.exp && decoded.exp < Date.now()) {\r\n          throw new Error('Refresh token expired');\r\n        }\r\n      } catch (error) {\r\n        logger.error(`Refresh token verification failed: ${error.message}`);\r\n        throw new Error('Invalid refresh token');\r\n      }\r\n\r\n      // Generate new access token\r\n      const newAccessToken = this.generateAccessToken(\r\n        session.userId,\r\n        session.userPayload,\r\n        sessionId\r\n      );\r\n\r\n      session.tokens.accessToken = newAccessToken;\r\n      session.lastActivity = Date.now();\r\n\r\n      // Update session in Redis\r\n      await this.redisClient.setEx(\r\n        `session:${sessionId}`,\r\n        Math.floor(this.SESSION_TIMEOUT / 1000),\r\n        JSON.stringify(session)\r\n      );\r\n\r\n      logger.info(`Access token refreshed for session: ${sessionId}`);\r\n\r\n      return {\r\n        accessToken: newAccessToken,\r\n        expiresIn: this.SESSION_TIMEOUT,\r\n        tokenType: 'Bearer'\r\n      };\r\n    } catch (error) {\r\n      logger.error('Failed to refresh access token:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنهاء الجلسة\r\n   * End SSO session\r\n   */\r\n  async endSession(sessionId) {\r\n    try {\r\n      const sessionData = await this.redisClient.get(`session:${sessionId}`);\r\n      \r\n      if (sessionData) {\r\n        const session = JSON.parse(sessionData);\r\n        \r\n        // Mark session as ended\r\n        session.status = 'ended';\r\n        session.endedAt = Date.now();\r\n        \r\n        // Store ended session for audit trail (24 hours)\r\n        await this.redisClient.setEx(\r\n          `session:ended:${sessionId}`,\r\n          86400,\r\n          JSON.stringify(session)\r\n        );\r\n        \r\n        // Remove active session\r\n        await this.redisClient.del(`session:${sessionId}`);\r\n        await this.redisClient.sRem(`user:${session.userId}:sessions`, sessionId);\r\n      }\r\n\r\n      logger.info(`Session ended: ${sessionId}`);\r\n      return { success: true };\r\n    } catch (error) {\r\n      logger.error('Failed to end session:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنهاء جميع جلسات المستخدم (Logout everywhere)\r\n   * End all user sessions\r\n   */\r\n  async endAllUserSessions(userId) {\r\n    try {\r\n      const sessionIds = await this.redisClient.sMembers(`user:${userId}:sessions`);\r\n      \r\n      for (const sessionId of sessionIds) {\r\n        await this.endSession(sessionId);\r\n      }\r\n\r\n      await this.redisClient.del(`user:${userId}:sessions`);\r\n      \r\n      logger.info(`All sessions ended for user: ${userId}`);\r\n      return { success: true, sessionsEnded: sessionIds.length };\r\n    } catch (error) {\r\n      logger.error('Failed to end all user sessions:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الحصول على جميع جلسات النشطة للمستخدم\r\n   * Get all active sessions for user\r\n   */\r\n  async getUserActiveSessions(userId) {\r\n    try {\r\n      const sessionIds = await this.redisClient.sMembers(`user:${userId}:sessions`);\r\n      const sessions = [];\r\n\r\n      for (const sessionId of sessionIds) {\r\n        const sessionData = await this.redisClient.get(`session:${sessionId}`);\r\n        if (sessionData) {\r\n          const session = JSON.parse(sessionData);\r\n          sessions.push({\r\n            sessionId,\r\n            createdAt: session.createdAt,\r\n            lastActivity: session.lastActivity,\r\n            metadata: session.metadata,\r\n            status: session.status\r\n          });\r\n        }\r\n      }\r\n\r\n      return sessions;\r\n    } catch (error) {\r\n      logger.error('Failed to get user sessions:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * توليد التوكنات (Access, Refresh, ID)\r\n   * Generate JWT tokens\r\n   */\r\n  generateTokens(userId, userPayload, sessionId) {\r\n    const now = Date.now();\r\n    \r\n    // Access Token (valid for 1 hour)\r\n    const accessToken = jwt.encode({\r\n      ...userPayload,\r\n      userId,\r\n      sessionId,\r\n      type: 'access',\r\n      iat: now,\r\n      exp: now + this.SESSION_TIMEOUT\r\n    }, this.JWT_SECRET);\r\n\r\n    // Refresh Token (valid for 7 days)\r\n    const refreshToken = jwt.encode({\r\n      userId,\r\n      sessionId,\r\n      type: 'refresh',\r\n      iat: now,\r\n      exp: now + this.REFRESH_TOKEN_TIMEOUT\r\n    }, this.JWT_SECRET);\r\n\r\n    // ID Token (for client identity)\r\n    const idToken = jwt.encode({\r\n      sub: userId,\r\n      aud: 'sso-client',\r\n      iss: 'sso-server',\r\n      iat: now,\r\n      exp: now + this.SESSION_TIMEOUT\r\n    }, this.JWT_SECRET);\r\n\r\n    return { accessToken, refreshToken, idToken };\r\n  }\r\n\r\n  /**\r\n   * توليد Access Token فقط\r\n   * Generate access token only\r\n   */\r\n  generateAccessToken(userId, userPayload, sessionId) {\r\n    const now = Date.now();\r\n    \r\n    return jwt.encode({\r\n      ...userPayload,\r\n      userId,\r\n      sessionId,\r\n      type: 'access',\r\n      iat: now,\r\n      exp: now + this.SESSION_TIMEOUT\r\n    }, this.JWT_SECRET);\r\n  }\r\n\r\n  /**\r\n   * تحديث بيانات الجلسة\r\n   * Update session metadata\r\n   */\r\n  async updateSessionMetadata(sessionId, metadata) {\r\n    try {\r\n      const sessionData = await this.redisClient.get(`session:${sessionId}`);\r\n      \r\n      if (!sessionData) {\r\n        throw new Error('Session not found');\r\n      }\r\n\r\n      const session = JSON.parse(sessionData);\r\n      session.metadata = { ...session.metadata, ...metadata };\r\n      session.lastActivity = Date.now();\r\n\r\n      await this.redisClient.setEx(\r\n        `session:${sessionId}`,\r\n        Math.floor(this.SESSION_TIMEOUT / 1000),\r\n        JSON.stringify(session)\r\n      );\r\n\r\n      logger.info(`Session metadata updated: ${sessionId}`);\r\n      return session;\r\n    } catch (error) {\r\n      logger.error('Failed to update session metadata:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الحصول على معلومات الجلسة\r\n   * Get session info\r\n   */\r\n  async getSessionInfo(sessionId) {\r\n    try {\r\n      const sessionData = await this.redisClient.get(`session:${sessionId}`);\r\n      \r\n      if (!sessionData) {\r\n        return null;\r\n      }\r\n\r\n      return JSON.parse(sessionData);\r\n    } catch (error) {\r\n      logger.error('Failed to get session info:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من طلب SSO OAuth 2.0\r\n   * Validate OAuth 2.0 request\r\n   */\r\n  async validateOAuthRequest(clientId, redirectUri, scope, state) {\r\n    try {\r\n      // This would validate against registered OAuth clients\r\n      // Implementation depends on your client registration system\r\n      \r\n      return {\r\n        valid: true,\r\n        clientId,\r\n        redirectUri,\r\n        scope: scope ? scope.split(' ') : [],\r\n        state\r\n      };\r\n    } catch (error) {\r\n      logger.error('OAuth request validation failed:', error);\r\n      return { valid: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنشاء Authorization Code\r\n   * Generate authorization code\r\n   */\r\n  async generateAuthorizationCode(userId, clientId, scope, redirectUri) {\r\n    try {\r\n      const code = crypto.randomBytes(32).toString('hex');\r\n      const now = Date.now();\r\n\r\n      const authCode = {\r\n        code,\r\n        userId,\r\n        clientId,\r\n        scope,\r\n        redirectUri,\r\n        createdAt: now,\r\n        expiresAt: now + 600000 // 10 minutes\r\n      };\r\n\r\n      await this.redisClient.setEx(\r\n        `oauth:code:${code}`,\r\n        600,\r\n        JSON.stringify(authCode)\r\n      );\r\n\r\n      logger.info(`Authorization code generated for user: ${userId}, client: ${clientId}`);\r\n      return code;\r\n    } catch (error) {\r\n      logger.error('Failed to generate authorization code:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تبديل Authorization Code بـ Access Token\r\n   * Exchange authorization code for access token\r\n   */\r\n  async exchangeAuthorizationCode(code, clientId, clientSecret) {\r\n    try {\r\n      const authCodeData = await this.redisClient.get(`oauth:code:${code}`);\r\n      \r\n      if (!authCodeData) {\r\n        throw new Error('Invalid or expired authorization code');\r\n      }\r\n\r\n      const authCode = JSON.parse(authCodeData);\r\n\r\n      if (authCode.clientId !== clientId) {\r\n        throw new Error('Client ID mismatch');\r\n      }\r\n\r\n      // In production, verify clientSecret against your client registry\r\n      if (clientSecret !== process.env.OAUTH_CLIENT_SECRET) {\r\n        throw new Error('Invalid client secret');\r\n      }\r\n\r\n      if (authCode.expiresAt < Date.now()) {\r\n        throw new Error('Authorization code expired');\r\n      }\r\n\r\n      // Delete used authorization code\r\n      await this.redisClient.del(`oauth:code:${code}`);\r\n\r\n      // Create session and generate tokens\r\n      const session = await this.createSession(authCode.userId, {\r\n        scope: authCode.scope,\r\n        clientId\r\n      }, {\r\n        source: 'oauth'\r\n      });\r\n\r\n      logger.info(`Authorization code exchanged for user: ${authCode.userId}`);\r\n      return session;\r\n    } catch (error) {\r\n      logger.error('Failed to exchange authorization code:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من Token أثناء المكالمات البينية\r\n   * Introspect token (for service-to-service verification)\r\n   */\r\n  async introspectToken(token) {\r\n    try {\r\n      const decoded = jwt.decode(token, this.JWT_SECRET);\r\n      \r\n      if (decoded.exp && decoded.exp < Date.now()) {\r\n        return {\r\n          active: false,\r\n          reason: 'Token expired'\r\n        };\r\n      }\r\n\r\n      return {\r\n        active: true,\r\n        sub: decoded.userId,\r\n        scope: decoded.scope,\r\n        clientId: decoded.clientId,\r\n        exp: decoded.exp,\r\n        iat: decoded.iat\r\n      };\r\n    } catch (error) {\r\n      logger.error('Token introspection failed:', error);\r\n      return { active: false, reason: 'Invalid token' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إغلاق الاتصال مع Redis\r\n   * Disconnect Redis\r\n   */\r\n  async disconnect() {\r\n    try {\r\n      await this.redisClient.disconnect();\r\n      logger.info('Redis connection closed');\r\n    } catch (error) {\r\n      logger.error('Error closing Redis connection:', error);\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = SSOService;\r\n"],"mappings":"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","ignoreList":[]}