{"version":3,"names":["mongoose","require","digitalLibrarySchema","Schema","title","type","String","required","trim","description","resourceType","enum","disabilityCategories","default","author","name","organization","email","uploader","Types","ObjectId","ref","fileUrl","fileType","fileSize","Number","language","publicationDate","Date","publisher","categories","tags","keywords","accessibilityFormat","hasBraille","Boolean","hasLargeText","hasArabicSignLanguageInterpretation","hasAudioVersion","hasSimpleLanguageVersion","isScreenReaderFriendly","isPublic","views","downloads","rating","average","min","max","count","reviews","userId","comment","date","now","relatedResources","status","metadata","isbn","doi","issn","edition","pages","language_level","contributors","role","license","timestamps","toJSON","virtuals","toObject","index","createdAt","statics","searchResources","query","filters","searchQuery","$or","$regex","$options","$in","RegExp","find","sort","populate","limit","getByCategory","category","methods","incrementDownloads","save","addReview","push","ratings","map","r","reduce","a","b","length","module","exports","model"],"sources":["DigitalLibrary.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst digitalLibrarySchema = new mongoose.Schema(\r\n  {\r\n    title: {\r\n      type: String,\r\n      required: [true, 'عنوان المورد مطلوب'],\r\n      trim: true,\r\n    },\r\n    description: {\r\n      type: String,\r\n      required: [true, 'وصف المورد مطلوب'],\r\n    },\r\n    resourceType: {\r\n      type: String,\r\n      enum: [\r\n        'book',\r\n        'guide',\r\n        'article',\r\n        'research_paper',\r\n        'case_study',\r\n        'toolkit',\r\n        'template',\r\n        'tool',\r\n        'research_statistics',\r\n      ],\r\n      required: true,\r\n    },\r\n    disabilityCategories: {\r\n      type: [String],\r\n      enum: ['visual', 'hearing', 'mobility', 'intellectual', 'psychosocial', 'multiple'],\r\n      default: [],\r\n    },\r\n    author: {\r\n      name: String,\r\n      organization: String,\r\n      email: String,\r\n    },\r\n    uploader: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: 'User',\r\n      required: true,\r\n    },\r\n    fileUrl: {\r\n      type: String,\r\n      required: [true, 'رابط الملف مطلوب'],\r\n    },\r\n    fileType: {\r\n      type: String,\r\n      enum: ['pdf', 'doc', 'xlsx', 'video', 'audio', 'image', 'link', 'other'],\r\n      required: true,\r\n    },\r\n    fileSize: {\r\n      type: Number,\r\n      description: 'حجم الملف بالبايتات',\r\n    },\r\n    language: {\r\n      type: String,\r\n      enum: ['ar', 'en', 'fr', 'multilingual'],\r\n      default: 'ar',\r\n    },\r\n    publicationDate: Date,\r\n    publisher: String,\r\n    categories: [String],\r\n    tags: [String],\r\n    keywords: [String],\r\n    accessibilityFormat: {\r\n      hasBraille: Boolean,\r\n      hasLargeText: Boolean,\r\n      hasArabicSignLanguageInterpretation: Boolean,\r\n      hasAudioVersion: Boolean,\r\n      hasSimpleLanguageVersion: Boolean,\r\n      isScreenReaderFriendly: Boolean,\r\n    },\r\n    isPublic: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    views: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    downloads: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    rating: {\r\n      average: {\r\n        type: Number,\r\n        default: 0,\r\n        min: 0,\r\n        max: 5,\r\n      },\r\n      count: {\r\n        type: Number,\r\n        default: 0,\r\n      },\r\n    },\r\n    reviews: [\r\n      {\r\n        userId: {\r\n          type: mongoose.Schema.Types.ObjectId,\r\n          ref: 'User',\r\n        },\r\n        rating: {\r\n          type: Number,\r\n          min: 1,\r\n          max: 5,\r\n        },\r\n        comment: String,\r\n        date: {\r\n          type: Date,\r\n          default: Date.now,\r\n        },\r\n      },\r\n    ],\r\n    relatedResources: [\r\n      {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'DigitalLibrary',\r\n      },\r\n    ],\r\n    status: {\r\n      type: String,\r\n      enum: ['draft', 'pending_review', 'approved', 'archived'],\r\n      default: 'draft',\r\n    },\r\n    metadata: {\r\n      isbn: String,\r\n      doi: String,\r\n      issn: String,\r\n      edition: String,\r\n      pages: Number,\r\n      language_level: String,\r\n    },\r\n    contributors: [\r\n      {\r\n        name: String,\r\n        role: String,\r\n        email: String,\r\n      },\r\n    ],\r\n    license: {\r\n      type: String,\r\n      enum: ['cc_by', 'cc_by_sa', 'cc_by_nc', 'cc0', 'proprietary'],\r\n      default: 'cc_by',\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n    toJSON: { virtuals: true },\r\n    toObject: { virtuals: true },\r\n  }\r\n);\r\n\r\n// Indexes\r\ndigitalLibrarySchema.index({ resourceType: 1, isPublic: 1 });\r\ndigitalLibrarySchema.index({ disabilityCategories: 1 });\r\ndigitalLibrarySchema.index({ uploader: 1 });\r\ndigitalLibrarySchema.index({ categories: 1 });\r\ndigitalLibrarySchema.index({ tags: 1 });\r\ndigitalLibrarySchema.index({ createdAt: -1 });\r\ndigitalLibrarySchema.index({ fileType: 1 });\r\n\r\n// Static method to search resources\r\ndigitalLibrarySchema.statics.searchResources = function (query, filters = {}) {\r\n  const searchQuery = {\r\n    isPublic: true,\r\n    status: 'approved',\r\n    $or: [\r\n      { title: { $regex: query, $options: 'i' } },\r\n      { description: { $regex: query, $options: 'i' } },\r\n      { tags: { $in: [new RegExp(query, 'i')] } },\r\n      { keywords: { $in: [new RegExp(query, 'i')] } },\r\n    ],\r\n  };\r\n\r\n  if (filters.resourceType) searchQuery.resourceType = filters.resourceType;\r\n  if (filters.disabilityCategories)\r\n    searchQuery.disabilityCategories = { $in: [filters.disabilityCategories] };\r\n  if (filters.language) searchQuery.language = filters.language;\r\n\r\n  return this.find(searchQuery)\r\n    .sort({ 'rating.average': -1, views: -1 })\r\n    .populate('uploader', 'name email')\r\n    .limit(filters.limit || 20);\r\n};\r\n\r\n// Static method to get resources by category\r\ndigitalLibrarySchema.statics.getByCategory = function (category, limit = 15) {\r\n  return this.find({\r\n    disabilityCategories: category,\r\n    isPublic: true,\r\n    status: 'approved',\r\n  })\r\n    .sort({ createdAt: -1 })\r\n    .limit(limit)\r\n    .populate('uploader', 'name email');\r\n};\r\n\r\n// Instance method to increment downloads\r\ndigitalLibrarySchema.methods.incrementDownloads = function () {\r\n  this.downloads += 1;\r\n  return this.save();\r\n};\r\n\r\n// Instance method to add review\r\ndigitalLibrarySchema.methods.addReview = function (userId, rating, comment) {\r\n  this.reviews.push({ userId, rating, comment });\r\n\r\n  // Calculate average rating\r\n  const ratings = this.reviews.map(r => r.rating);\r\n  this.rating.average = ratings.reduce((a, b) => a + b, 0) / ratings.length;\r\n  this.rating.count = ratings.length;\r\n\r\n  return this.save();\r\n};\r\n\r\nmodule.exports = mongoose.model('DigitalLibrary', digitalLibrarySchema);\r\n"],"mappings":"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","ignoreList":[]}