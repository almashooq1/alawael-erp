d9cf63a2745c1fec290b43915e9c8ac2
/**
 * =====================================================
 * ADVANCED REQUEST LOGGER MIDDLEWARE - Phase 6
 * =====================================================
 * Comprehensive request/response logging and tracking
 */

const fs = require('fs');
const path = require('path');

// Ensure logs directory exists
const logsDir = path.join(__dirname, '../logs');
if (!fs.existsSync(logsDir)) {
  fs.mkdirSync(logsDir, {
    recursive: true
  });
}

// Log file paths
const requestLogFile = path.join(logsDir, 'requests.log');
const metricsFile = path.join(logsDir, 'metrics.json');

/**
 * Color codes for terminal output
 */
const colors = {
  reset: '\x1b[0m',
  green: '\x1b[32m',
  yellow: '\x1b[33m',
  red: '\x1b[31m',
  blue: '\x1b[34m',
  cyan: '\x1b[36m'
};

/**
 * Get status color based on HTTP status code
 */
const getStatusColor = status => {
  if (status < 300) return colors.green;
  if (status < 400) return colors.blue;
  if (status < 500) return colors.yellow;
  return colors.red;
};

/**
 * Get HTTP method color
 */
const getMethodColor = method => {
  const methodColors = {
    GET: colors.blue,
    POST: colors.green,
    PUT: colors.yellow,
    PATCH: colors.cyan,
    DELETE: colors.red,
    OPTIONS: colors.reset
  };
  return methodColors[method] || colors.reset;
};

/**
 * Format bytes to human readable
 */
const formatBytes = bytes => {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
};

/**
 * Log request to file
 */
const logRequestToFile = (req, res, duration) => {
  const timestamp = new Date().toISOString();
  const logEntry = {
    timestamp,
    method: req.method,
    url: req.originalUrl,
    path: req.path,
    query: req.query,
    statusCode: res.statusCode,
    duration: `${duration}ms`,
    ip: req.ip || req.connection.remoteAddress,
    userAgent: req.get('user-agent'),
    userId: req.user?._id || 'anonymous',
    contentLength: req.get('content-length') || 0,
    responseTime: new Date().toISOString()
  };
  const logMessage = `${timestamp} ${req.method} ${req.originalUrl} - ${res.statusCode} - ${duration}ms - ${req.ip || 'unknown'}\n`;
  fs.appendFileSync(requestLogFile, logMessage);

  // Write metrics
  const metricsExist = fs.existsSync(metricsFile);
  const metrics = metricsExist ? JSON.parse(fs.readFileSync(metricsFile, 'utf8')) : [];
  metrics.push(logEntry);
  // Keep only last 5000 entries
  const recentMetrics = metrics.slice(-5000);
  fs.writeFileSync(metricsFile, JSON.stringify(recentMetrics, null, 2));
};

/**
 * Parse request body size
 */
const getRequestSize = req => {
  const contentLength = req.get('content-length');
  return contentLength ? parseInt(contentLength) : 0;
};

/**
 * Advanced request logger middleware
 */
module.exports = (req, res, next) => {
  // Record start time
  const _startTime = Date.now();
  const startHrTime = process.hrtime();

  // Store original send method
  const originalSend = res.send;
  let responseSize = 0;

  // Override send to capture response details
  res.send = function (data) {
    // Calculate response size
    if (data) {
      responseSize = Buffer.byteLength(JSON.stringify(data));
    }

    // Call original send
    res.send = originalSend;
    return res.send(data);
  };

  // Listen to finish event
  res.on('finish', () => {
    const [seconds, nanoseconds] = process.hrtime(startHrTime);
    const nanosecondDuration = seconds * 1000000000 + nanoseconds;
    const milliseconds = nanosecondDuration / 1000000;
    const method = req.method;
    const url = req.originalUrl;
    const status = res.statusCode;
    const requestSize = getRequestSize(req);
    const totalSize = requestSize + responseSize;

    // Console logging with colors
    const methodColor = getMethodColor(method);
    const statusColor = getStatusColor(status);
    const logMessage = `${colors.cyan}[${new Date().toLocaleTimeString()}]${colors.reset} ` + `${methodColor}${method}${colors.reset} ` + `${colors.reset}${url}${colors.reset} ` + `${statusColor}${status}${colors.reset} ` + `${colors.yellow}${Math.round(milliseconds)}ms${colors.reset} ` + `${colors.blue}${formatBytes(totalSize)}${colors.reset}`;

    // Different logging level based on status
    if (status >= 500) {
      console.error(`❌ ${logMessage}`);
    } else if (status >= 400) {
      console.warn(`⚠️  ${logMessage}`);
    } else {
      console.log(`✓  ${logMessage}`);
    }

    // Log to file
    try {
      logRequestToFile(req, res, Math.round(milliseconds));
    } catch (err) {
      console.error('Failed to log request to file:', err);
    }

    // Add custom headers
    res.set('X-Response-Time', `${Math.round(milliseconds)}ms`);
    res.set('X-Response-Size', formatBytes(responseSize));
    res.set('X-Request-Time', new Date().toISOString());
  });
  next();
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJwYXRoIiwibG9nc0RpciIsImpvaW4iLCJfX2Rpcm5hbWUiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwicmVxdWVzdExvZ0ZpbGUiLCJtZXRyaWNzRmlsZSIsImNvbG9ycyIsInJlc2V0IiwiZ3JlZW4iLCJ5ZWxsb3ciLCJyZWQiLCJibHVlIiwiY3lhbiIsImdldFN0YXR1c0NvbG9yIiwic3RhdHVzIiwiZ2V0TWV0aG9kQ29sb3IiLCJtZXRob2QiLCJtZXRob2RDb2xvcnMiLCJHRVQiLCJQT1NUIiwiUFVUIiwiUEFUQ0giLCJERUxFVEUiLCJPUFRJT05TIiwiZm9ybWF0Qnl0ZXMiLCJieXRlcyIsImsiLCJzaXplcyIsImkiLCJNYXRoIiwiZmxvb3IiLCJsb2ciLCJyb3VuZCIsInBvdyIsImxvZ1JlcXVlc3RUb0ZpbGUiLCJyZXEiLCJyZXMiLCJkdXJhdGlvbiIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImxvZ0VudHJ5IiwidXJsIiwib3JpZ2luYWxVcmwiLCJxdWVyeSIsInN0YXR1c0NvZGUiLCJpcCIsImNvbm5lY3Rpb24iLCJyZW1vdGVBZGRyZXNzIiwidXNlckFnZW50IiwiZ2V0IiwidXNlcklkIiwidXNlciIsIl9pZCIsImNvbnRlbnRMZW5ndGgiLCJyZXNwb25zZVRpbWUiLCJsb2dNZXNzYWdlIiwiYXBwZW5kRmlsZVN5bmMiLCJtZXRyaWNzRXhpc3QiLCJtZXRyaWNzIiwiSlNPTiIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwicHVzaCIsInJlY2VudE1ldHJpY3MiLCJzbGljZSIsIndyaXRlRmlsZVN5bmMiLCJzdHJpbmdpZnkiLCJnZXRSZXF1ZXN0U2l6ZSIsInBhcnNlSW50IiwibW9kdWxlIiwiZXhwb3J0cyIsIm5leHQiLCJfc3RhcnRUaW1lIiwibm93Iiwic3RhcnRIclRpbWUiLCJwcm9jZXNzIiwiaHJ0aW1lIiwib3JpZ2luYWxTZW5kIiwic2VuZCIsInJlc3BvbnNlU2l6ZSIsImRhdGEiLCJCdWZmZXIiLCJieXRlTGVuZ3RoIiwib24iLCJzZWNvbmRzIiwibmFub3NlY29uZHMiLCJuYW5vc2Vjb25kRHVyYXRpb24iLCJtaWxsaXNlY29uZHMiLCJyZXF1ZXN0U2l6ZSIsInRvdGFsU2l6ZSIsIm1ldGhvZENvbG9yIiwic3RhdHVzQ29sb3IiLCJ0b0xvY2FsZVRpbWVTdHJpbmciLCJjb25zb2xlIiwiZXJyb3IiLCJ3YXJuIiwiZXJyIiwic2V0Il0sInNvdXJjZXMiOlsicmVxdWVzdExvZ2dlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogQURWQU5DRUQgUkVRVUVTVCBMT0dHRVIgTUlERExFV0FSRSAtIFBoYXNlIDZcclxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogQ29tcHJlaGVuc2l2ZSByZXF1ZXN0L3Jlc3BvbnNlIGxvZ2dpbmcgYW5kIHRyYWNraW5nXHJcbiAqL1xyXG5cclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5cclxuLy8gRW5zdXJlIGxvZ3MgZGlyZWN0b3J5IGV4aXN0c1xyXG5jb25zdCBsb2dzRGlyID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2xvZ3MnKTtcclxuaWYgKCFmcy5leGlzdHNTeW5jKGxvZ3NEaXIpKSB7XHJcbiAgZnMubWtkaXJTeW5jKGxvZ3NEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG59XHJcblxyXG4vLyBMb2cgZmlsZSBwYXRoc1xyXG5jb25zdCByZXF1ZXN0TG9nRmlsZSA9IHBhdGguam9pbihsb2dzRGlyLCAncmVxdWVzdHMubG9nJyk7XHJcbmNvbnN0IG1ldHJpY3NGaWxlID0gcGF0aC5qb2luKGxvZ3NEaXIsICdtZXRyaWNzLmpzb24nKTtcclxuXHJcbi8qKlxyXG4gKiBDb2xvciBjb2RlcyBmb3IgdGVybWluYWwgb3V0cHV0XHJcbiAqL1xyXG5jb25zdCBjb2xvcnMgPSB7XHJcbiAgcmVzZXQ6ICdcXHgxYlswbScsXHJcbiAgZ3JlZW46ICdcXHgxYlszMm0nLFxyXG4gIHllbGxvdzogJ1xceDFiWzMzbScsXHJcbiAgcmVkOiAnXFx4MWJbMzFtJyxcclxuICBibHVlOiAnXFx4MWJbMzRtJyxcclxuICBjeWFuOiAnXFx4MWJbMzZtJyxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgc3RhdHVzIGNvbG9yIGJhc2VkIG9uIEhUVFAgc3RhdHVzIGNvZGVcclxuICovXHJcbmNvbnN0IGdldFN0YXR1c0NvbG9yID0gKHN0YXR1cykgPT4ge1xyXG4gIGlmIChzdGF0dXMgPCAzMDApIHJldHVybiBjb2xvcnMuZ3JlZW47XHJcbiAgaWYgKHN0YXR1cyA8IDQwMCkgcmV0dXJuIGNvbG9ycy5ibHVlO1xyXG4gIGlmIChzdGF0dXMgPCA1MDApIHJldHVybiBjb2xvcnMueWVsbG93O1xyXG4gIHJldHVybiBjb2xvcnMucmVkO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEdldCBIVFRQIG1ldGhvZCBjb2xvclxyXG4gKi9cclxuY29uc3QgZ2V0TWV0aG9kQ29sb3IgPSAobWV0aG9kKSA9PiB7XHJcbiAgY29uc3QgbWV0aG9kQ29sb3JzID0ge1xyXG4gICAgR0VUOiBjb2xvcnMuYmx1ZSxcclxuICAgIFBPU1Q6IGNvbG9ycy5ncmVlbixcclxuICAgIFBVVDogY29sb3JzLnllbGxvdyxcclxuICAgIFBBVENIOiBjb2xvcnMuY3lhbixcclxuICAgIERFTEVURTogY29sb3JzLnJlZCxcclxuICAgIE9QVElPTlM6IGNvbG9ycy5yZXNldCxcclxuICB9O1xyXG4gIHJldHVybiBtZXRob2RDb2xvcnNbbWV0aG9kXSB8fCBjb2xvcnMucmVzZXQ7XHJcbn07XHJcblxyXG4vKipcclxuICogRm9ybWF0IGJ5dGVzIHRvIGh1bWFuIHJlYWRhYmxlXHJcbiAqL1xyXG5jb25zdCBmb3JtYXRCeXRlcyA9IChieXRlcykgPT4ge1xyXG4gIGlmIChieXRlcyA9PT0gMCkgcmV0dXJuICcwIEInO1xyXG4gIGNvbnN0IGsgPSAxMDI0O1xyXG4gIGNvbnN0IHNpemVzID0gWydCJywgJ0tCJywgJ01CJywgJ0dCJ107XHJcbiAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coaykpO1xyXG4gIHJldHVybiBNYXRoLnJvdW5kKChieXRlcyAvIE1hdGgucG93KGssIGkpKSAqIDEwMCkgLyAxMDAgKyAnICcgKyBzaXplc1tpXTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBMb2cgcmVxdWVzdCB0byBmaWxlXHJcbiAqL1xyXG5jb25zdCBsb2dSZXF1ZXN0VG9GaWxlID0gKHJlcSwgcmVzLCBkdXJhdGlvbikgPT4ge1xyXG4gIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuICBjb25zdCBsb2dFbnRyeSA9IHtcclxuICAgIHRpbWVzdGFtcCxcclxuICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcclxuICAgIHVybDogcmVxLm9yaWdpbmFsVXJsLFxyXG4gICAgcGF0aDogcmVxLnBhdGgsXHJcbiAgICBxdWVyeTogcmVxLnF1ZXJ5LFxyXG4gICAgc3RhdHVzQ29kZTogcmVzLnN0YXR1c0NvZGUsXHJcbiAgICBkdXJhdGlvbjogYCR7ZHVyYXRpb259bXNgLFxyXG4gICAgaXA6IHJlcS5pcCB8fCByZXEuY29ubmVjdGlvbi5yZW1vdGVBZGRyZXNzLFxyXG4gICAgdXNlckFnZW50OiByZXEuZ2V0KCd1c2VyLWFnZW50JyksXHJcbiAgICB1c2VySWQ6IHJlcS51c2VyPy5faWQgfHwgJ2Fub255bW91cycsXHJcbiAgICBjb250ZW50TGVuZ3RoOiByZXEuZ2V0KCdjb250ZW50LWxlbmd0aCcpIHx8IDAsXHJcbiAgICByZXNwb25zZVRpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICB9O1xyXG5cclxuICBjb25zdCBsb2dNZXNzYWdlID0gYCR7dGltZXN0YW1wfSAke3JlcS5tZXRob2R9ICR7cmVxLm9yaWdpbmFsVXJsfSAtICR7cmVzLnN0YXR1c0NvZGV9IC0gJHtkdXJhdGlvbn1tcyAtICR7cmVxLmlwIHx8ICd1bmtub3duJ31cXG5gO1xyXG5cclxuICBmcy5hcHBlbmRGaWxlU3luYyhyZXF1ZXN0TG9nRmlsZSwgbG9nTWVzc2FnZSk7XHJcblxyXG4gIC8vIFdyaXRlIG1ldHJpY3NcclxuICBjb25zdCBtZXRyaWNzRXhpc3QgPSBmcy5leGlzdHNTeW5jKG1ldHJpY3NGaWxlKTtcclxuICBjb25zdCBtZXRyaWNzID0gbWV0cmljc0V4aXN0ID8gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMobWV0cmljc0ZpbGUsICd1dGY4JykpIDogW107XHJcbiAgbWV0cmljcy5wdXNoKGxvZ0VudHJ5KTtcclxuICAvLyBLZWVwIG9ubHkgbGFzdCA1MDAwIGVudHJpZXNcclxuICBjb25zdCByZWNlbnRNZXRyaWNzID0gbWV0cmljcy5zbGljZSgtNTAwMCk7XHJcbiAgZnMud3JpdGVGaWxlU3luYyhtZXRyaWNzRmlsZSwgSlNPTi5zdHJpbmdpZnkocmVjZW50TWV0cmljcywgbnVsbCwgMikpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFBhcnNlIHJlcXVlc3QgYm9keSBzaXplXHJcbiAqL1xyXG5jb25zdCBnZXRSZXF1ZXN0U2l6ZSA9IChyZXEpID0+IHtcclxuICBjb25zdCBjb250ZW50TGVuZ3RoID0gcmVxLmdldCgnY29udGVudC1sZW5ndGgnKTtcclxuICByZXR1cm4gY29udGVudExlbmd0aCA/IHBhcnNlSW50KGNvbnRlbnRMZW5ndGgpIDogMDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZHZhbmNlZCByZXF1ZXN0IGxvZ2dlciBtaWRkbGV3YXJlXHJcbiAqL1xyXG5tb2R1bGUuZXhwb3J0cyA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIC8vIFJlY29yZCBzdGFydCB0aW1lXHJcbiAgY29uc3QgX3N0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgY29uc3Qgc3RhcnRIclRpbWUgPSBwcm9jZXNzLmhydGltZSgpO1xyXG5cclxuICAvLyBTdG9yZSBvcmlnaW5hbCBzZW5kIG1ldGhvZFxyXG4gIGNvbnN0IG9yaWdpbmFsU2VuZCA9IHJlcy5zZW5kO1xyXG4gIGxldCByZXNwb25zZVNpemUgPSAwO1xyXG5cclxuICAvLyBPdmVycmlkZSBzZW5kIHRvIGNhcHR1cmUgcmVzcG9uc2UgZGV0YWlsc1xyXG4gIHJlcy5zZW5kID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIC8vIENhbGN1bGF0ZSByZXNwb25zZSBzaXplXHJcbiAgICBpZiAoZGF0YSkge1xyXG4gICAgICByZXNwb25zZVNpemUgPSBCdWZmZXIuYnl0ZUxlbmd0aChKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FsbCBvcmlnaW5hbCBzZW5kXHJcbiAgICByZXMuc2VuZCA9IG9yaWdpbmFsU2VuZDtcclxuICAgIHJldHVybiByZXMuc2VuZChkYXRhKTtcclxuICB9O1xyXG5cclxuICAvLyBMaXN0ZW4gdG8gZmluaXNoIGV2ZW50XHJcbiAgcmVzLm9uKCdmaW5pc2gnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBbc2Vjb25kcywgbmFub3NlY29uZHNdID0gcHJvY2Vzcy5ocnRpbWUoc3RhcnRIclRpbWUpO1xyXG4gICAgY29uc3QgbmFub3NlY29uZER1cmF0aW9uID0gc2Vjb25kcyAqIDEwMDAwMDAwMDAgKyBuYW5vc2Vjb25kcztcclxuICAgIGNvbnN0IG1pbGxpc2Vjb25kcyA9IG5hbm9zZWNvbmREdXJhdGlvbiAvIDEwMDAwMDA7XHJcblxyXG4gICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZDtcclxuICAgIGNvbnN0IHVybCA9IHJlcS5vcmlnaW5hbFVybDtcclxuICAgIGNvbnN0IHN0YXR1cyA9IHJlcy5zdGF0dXNDb2RlO1xyXG4gICAgY29uc3QgcmVxdWVzdFNpemUgPSBnZXRSZXF1ZXN0U2l6ZShyZXEpO1xyXG4gICAgY29uc3QgdG90YWxTaXplID0gcmVxdWVzdFNpemUgKyByZXNwb25zZVNpemU7XHJcblxyXG4gICAgLy8gQ29uc29sZSBsb2dnaW5nIHdpdGggY29sb3JzXHJcbiAgICBjb25zdCBtZXRob2RDb2xvciA9IGdldE1ldGhvZENvbG9yKG1ldGhvZCk7XHJcbiAgICBjb25zdCBzdGF0dXNDb2xvciA9IGdldFN0YXR1c0NvbG9yKHN0YXR1cyk7XHJcblxyXG4gICAgY29uc3QgbG9nTWVzc2FnZSA9XHJcbiAgICAgIGAke2NvbG9ycy5jeWFufVske25ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCl9XSR7Y29sb3JzLnJlc2V0fSBgICtcclxuICAgICAgYCR7bWV0aG9kQ29sb3J9JHttZXRob2R9JHtjb2xvcnMucmVzZXR9IGAgK1xyXG4gICAgICBgJHtjb2xvcnMucmVzZXR9JHt1cmx9JHtjb2xvcnMucmVzZXR9IGAgK1xyXG4gICAgICBgJHtzdGF0dXNDb2xvcn0ke3N0YXR1c30ke2NvbG9ycy5yZXNldH0gYCArXHJcbiAgICAgIGAke2NvbG9ycy55ZWxsb3d9JHtNYXRoLnJvdW5kKG1pbGxpc2Vjb25kcyl9bXMke2NvbG9ycy5yZXNldH0gYCArXHJcbiAgICAgIGAke2NvbG9ycy5ibHVlfSR7Zm9ybWF0Qnl0ZXModG90YWxTaXplKX0ke2NvbG9ycy5yZXNldH1gO1xyXG5cclxuICAgIC8vIERpZmZlcmVudCBsb2dnaW5nIGxldmVsIGJhc2VkIG9uIHN0YXR1c1xyXG4gICAgaWYgKHN0YXR1cyA+PSA1MDApIHtcclxuICAgICAgY29uc29sZS5lcnJvcihg4p2MICR7bG9nTWVzc2FnZX1gKTtcclxuICAgIH0gZWxzZSBpZiAoc3RhdHVzID49IDQwMCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyAgJHtsb2dNZXNzYWdlfWApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2coYOKckyAgJHtsb2dNZXNzYWdlfWApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIExvZyB0byBmaWxlXHJcbiAgICB0cnkge1xyXG4gICAgICBsb2dSZXF1ZXN0VG9GaWxlKHJlcSwgcmVzLCBNYXRoLnJvdW5kKG1pbGxpc2Vjb25kcykpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2cgcmVxdWVzdCB0byBmaWxlOicsIGVycik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkIGN1c3RvbSBoZWFkZXJzXHJcbiAgICByZXMuc2V0KCdYLVJlc3BvbnNlLVRpbWUnLCBgJHtNYXRoLnJvdW5kKG1pbGxpc2Vjb25kcyl9bXNgKTtcclxuICAgIHJlcy5zZXQoJ1gtUmVzcG9uc2UtU2l6ZScsIGZvcm1hdEJ5dGVzKHJlc3BvbnNlU2l6ZSkpO1xyXG4gICAgcmVzLnNldCgnWC1SZXF1ZXN0LVRpbWUnLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpO1xyXG4gIH0pO1xyXG5cclxuICBuZXh0KCk7XHJcbn07XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLEVBQUUsR0FBR0MsT0FBTyxDQUFDLElBQUksQ0FBQztBQUN4QixNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxNQUFNLENBQUM7O0FBRTVCO0FBQ0EsTUFBTUUsT0FBTyxHQUFHRCxJQUFJLENBQUNFLElBQUksQ0FBQ0MsU0FBUyxFQUFFLFNBQVMsQ0FBQztBQUMvQyxJQUFJLENBQUNMLEVBQUUsQ0FBQ00sVUFBVSxDQUFDSCxPQUFPLENBQUMsRUFBRTtFQUMzQkgsRUFBRSxDQUFDTyxTQUFTLENBQUNKLE9BQU8sRUFBRTtJQUFFSyxTQUFTLEVBQUU7RUFBSyxDQUFDLENBQUM7QUFDNUM7O0FBRUE7QUFDQSxNQUFNQyxjQUFjLEdBQUdQLElBQUksQ0FBQ0UsSUFBSSxDQUFDRCxPQUFPLEVBQUUsY0FBYyxDQUFDO0FBQ3pELE1BQU1PLFdBQVcsR0FBR1IsSUFBSSxDQUFDRSxJQUFJLENBQUNELE9BQU8sRUFBRSxjQUFjLENBQUM7O0FBRXREO0FBQ0E7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