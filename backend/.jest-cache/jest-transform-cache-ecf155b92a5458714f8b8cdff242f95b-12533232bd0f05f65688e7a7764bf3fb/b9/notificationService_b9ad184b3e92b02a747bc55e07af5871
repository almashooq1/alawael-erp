6ca3b92e082bb7707e249260390b3185
/**
 * Notification Service - Multi-channel Notifications
 */

const {
  sendEmail
} = require('./emailService');
const {
  sendSMS
} = require('./smsService');
const {
  sendPush
} = require('./pushService');
const User = require('../models/User');
class NotificationService {
  static notifications = [];

  /**
   * إرسال إشعار
   */
  static async sendNotification(userId, notificationData) {
    try {
      const notif = {
        id: `notif_${Date.now()}`,
        userId,
        title: notificationData.title,
        message: notificationData.message,
        channels: notificationData.channels || ['in-app'],
        priority: notificationData.priority || 'normal',
        createdAt: new Date(),
        sent: true,
        deliveryStatus: {}
      };

      // إرسال عبر القنوات المطلوبة

      // جلب بيانات المستخدم (للحصول على البريد، الجوال، fcmTokens)
      let user = notificationData.userObj;
      if (!user) {
        user = await User.findById(userId).lean();
      }
      for (const channel of notif.channels) {
        if (channel === 'email') {
          const to = notificationData.email || user && user.email || 'test@example.com';
          const subject = notif.title;
          const text = notif.message;
          const result = await sendEmail({
            to,
            subject,
            text
          });
          notif.deliveryStatus.email = result.success ? 'sent' : 'failed';
        } else if (channel === 'sms') {
          const to = notificationData.phone || user && user.phone || '+201234567890';
          const message = notif.message;
          const result = await sendSMS({
            to,
            message
          });
          notif.deliveryStatus.sms = result.success ? 'sent' : 'failed';
        } else if (channel === 'push') {
          const tokens = user && user.fcmTokens || [];
          if (tokens.length > 0) {
            const result = await sendPush({
              tokens,
              title: notif.title,
              body: notif.message
            });
            notif.deliveryStatus.push = result.success ? 'sent' : 'failed';
          } else {
            notif.deliveryStatus.push = 'no-tokens';
          }
        } else if (channel === 'in-app') {
          notif.deliveryStatus.inApp = 'delivered';
        }
      }
      this.notifications.push(notif);
      return {
        success: true,
        notificationId: notif.id,
        sentTo: notif.channels,
        deliveryStatus: notif.deliveryStatus,
        timestamp: new Date()
      };
    } catch (err) {
      throw new Error(`Notification send failed: ${err.message}`);
    }
  }

  /**
   * الحصول على إشعارات المستخدم
   */
  static async getNotifications(userId, limit = 50, unreadOnly = false) {
    try {
      let userNotifs = this.notifications.filter(n => n.userId === userId);
      if (unreadOnly) {
        userNotifs = userNotifs.filter(n => !n.read);
      }
      return {
        success: true,
        count: userNotifs.length,
        notifications: userNotifs.slice(-limit),
        timestamp: new Date()
      };
    } catch (err) {
      throw new Error(`Get notifications failed: ${err.message}`);
    }
  }

  /**
   * وضع علامة على الإشعار كمقروء
   */
  static async markAsRead(notificationId) {
    try {
      const notif = this.notifications.find(n => n.id === notificationId);
      if (notif) {
        notif.read = true;
      }
      return {
        success: true,
        message: 'Marked as read'
      };
    } catch (err) {
      throw new Error(`Mark as read failed: ${err.message}`);
    }
  }

  /**
   * حذف الإشعار
   */
  static async deleteNotification(notificationId) {
    try {
      this.notifications = this.notifications.filter(n => n.id !== notificationId);
      return {
        success: true,
        message: 'Notification deleted'
      };
    } catch (err) {
      throw new Error(`Delete notification failed: ${err.message}`);
    }
  }

  /**
   * حذف جميع إشعارات المستخدم
   */
  static async deleteAllNotifications(userId) {
    try {
      const countBefore = this.notifications.length;
      this.notifications = this.notifications.filter(n => n.userId !== userId);
      const deletedCount = countBefore - this.notifications.length;
      return {
        success: true,
        message: `${deletedCount} notifications deleted`
      };
    } catch (err) {
      throw new Error(`Delete all notifications failed: ${err.message}`);
    }
  }

  /**
   * جدولة إشعار (محاكاة)
   */
  static async scheduleNotification(userId, notificationData, scheduleTime) {
    try {
      return {
        success: true,
        message: 'Notification scheduled',
        scheduledFor: scheduleTime,
        userId,
        status: 'pending'
      };
    } catch (err) {
      throw new Error(`Schedule notification failed: ${err.message}`);
    }
  }

  // Helper Methods
  static _simulateDelivery(channels) {
    const delivery = {};
    channels.forEach(channel => {
      delivery[channel] = {
        status: 'delivered',
        timestamp: new Date(),
        attempts: 1
      };
    });
    return delivery;
  }
}
module.exports = NotificationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzZW5kRW1haWwiLCJyZXF1aXJlIiwic2VuZFNNUyIsInNlbmRQdXNoIiwiVXNlciIsIk5vdGlmaWNhdGlvblNlcnZpY2UiLCJub3RpZmljYXRpb25zIiwic2VuZE5vdGlmaWNhdGlvbiIsInVzZXJJZCIsIm5vdGlmaWNhdGlvbkRhdGEiLCJub3RpZiIsImlkIiwiRGF0ZSIsIm5vdyIsInRpdGxlIiwibWVzc2FnZSIsImNoYW5uZWxzIiwicHJpb3JpdHkiLCJjcmVhdGVkQXQiLCJzZW50IiwiZGVsaXZlcnlTdGF0dXMiLCJ1c2VyIiwidXNlck9iaiIsImZpbmRCeUlkIiwibGVhbiIsImNoYW5uZWwiLCJ0byIsImVtYWlsIiwic3ViamVjdCIsInRleHQiLCJyZXN1bHQiLCJzdWNjZXNzIiwicGhvbmUiLCJzbXMiLCJ0b2tlbnMiLCJmY21Ub2tlbnMiLCJsZW5ndGgiLCJib2R5IiwicHVzaCIsImluQXBwIiwibm90aWZpY2F0aW9uSWQiLCJzZW50VG8iLCJ0aW1lc3RhbXAiLCJlcnIiLCJFcnJvciIsImdldE5vdGlmaWNhdGlvbnMiLCJsaW1pdCIsInVucmVhZE9ubHkiLCJ1c2VyTm90aWZzIiwiZmlsdGVyIiwibiIsInJlYWQiLCJjb3VudCIsInNsaWNlIiwibWFya0FzUmVhZCIsImZpbmQiLCJkZWxldGVOb3RpZmljYXRpb24iLCJkZWxldGVBbGxOb3RpZmljYXRpb25zIiwiY291bnRCZWZvcmUiLCJkZWxldGVkQ291bnQiLCJzY2hlZHVsZU5vdGlmaWNhdGlvbiIsInNjaGVkdWxlVGltZSIsInNjaGVkdWxlZEZvciIsInN0YXR1cyIsIl9zaW11bGF0ZURlbGl2ZXJ5IiwiZGVsaXZlcnkiLCJmb3JFYWNoIiwiYXR0ZW1wdHMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsibm90aWZpY2F0aW9uU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogTm90aWZpY2F0aW9uIFNlcnZpY2UgLSBNdWx0aS1jaGFubmVsIE5vdGlmaWNhdGlvbnNcclxuICovXHJcblxyXG5jb25zdCB7IHNlbmRFbWFpbCB9ID0gcmVxdWlyZSgnLi9lbWFpbFNlcnZpY2UnKTtcclxuY29uc3QgeyBzZW5kU01TIH0gPSByZXF1aXJlKCcuL3Ntc1NlcnZpY2UnKTtcclxuY29uc3QgeyBzZW5kUHVzaCB9ID0gcmVxdWlyZSgnLi9wdXNoU2VydmljZScpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuXHJcbmNsYXNzIE5vdGlmaWNhdGlvblNlcnZpY2Uge1xyXG4gIHN0YXRpYyBub3RpZmljYXRpb25zID0gW107XHJcblxyXG4gIC8qKlxyXG4gICAqINil2LHYs9in2YQg2KXYtNi52KfYsVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBzZW5kTm90aWZpY2F0aW9uKHVzZXJJZCwgbm90aWZpY2F0aW9uRGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgbm90aWYgPSB7XHJcbiAgICAgICAgaWQ6IGBub3RpZl8ke0RhdGUubm93KCl9YCxcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgdGl0bGU6IG5vdGlmaWNhdGlvbkRhdGEudGl0bGUsXHJcbiAgICAgICAgbWVzc2FnZTogbm90aWZpY2F0aW9uRGF0YS5tZXNzYWdlLFxyXG4gICAgICAgIGNoYW5uZWxzOiBub3RpZmljYXRpb25EYXRhLmNoYW5uZWxzIHx8IFsnaW4tYXBwJ10sXHJcbiAgICAgICAgcHJpb3JpdHk6IG5vdGlmaWNhdGlvbkRhdGEucHJpb3JpdHkgfHwgJ25vcm1hbCcsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIHNlbnQ6IHRydWUsXHJcbiAgICAgICAgZGVsaXZlcnlTdGF0dXM6IHt9LFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8g2KXYsdiz2KfZhCDYudio2LEg2KfZhNmC2YbZiNin2Kog2KfZhNmF2LfZhNmI2KjYqVxyXG5cclxuICAgICAgLy8g2KzZhNioINio2YrYp9mG2KfYqiDYp9mE2YXYs9iq2K7Yr9mFICjZhNmE2K3YtdmI2YQg2LnZhNmJINin2YTYqNix2YrYr9iMINin2YTYrNmI2KfZhNiMIGZjbVRva2VucylcclxuICAgICAgbGV0IHVzZXIgPSBub3RpZmljYXRpb25EYXRhLnVzZXJPYmo7XHJcbiAgICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCkubGVhbigpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IGNoYW5uZWwgb2Ygbm90aWYuY2hhbm5lbHMpIHtcclxuICAgICAgICBpZiAoY2hhbm5lbCA9PT0gJ2VtYWlsJykge1xyXG4gICAgICAgICAgY29uc3QgdG8gPSBub3RpZmljYXRpb25EYXRhLmVtYWlsIHx8ICh1c2VyICYmIHVzZXIuZW1haWwpIHx8ICd0ZXN0QGV4YW1wbGUuY29tJztcclxuICAgICAgICAgIGNvbnN0IHN1YmplY3QgPSBub3RpZi50aXRsZTtcclxuICAgICAgICAgIGNvbnN0IHRleHQgPSBub3RpZi5tZXNzYWdlO1xyXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VuZEVtYWlsKHsgdG8sIHN1YmplY3QsIHRleHQgfSk7XHJcbiAgICAgICAgICBub3RpZi5kZWxpdmVyeVN0YXR1cy5lbWFpbCA9IHJlc3VsdC5zdWNjZXNzID8gJ3NlbnQnIDogJ2ZhaWxlZCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChjaGFubmVsID09PSAnc21zJykge1xyXG4gICAgICAgICAgY29uc3QgdG8gPSBub3RpZmljYXRpb25EYXRhLnBob25lIHx8ICh1c2VyICYmIHVzZXIucGhvbmUpIHx8ICcrMjAxMjM0NTY3ODkwJztcclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBub3RpZi5tZXNzYWdlO1xyXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VuZFNNUyh7IHRvLCBtZXNzYWdlIH0pO1xyXG4gICAgICAgICAgbm90aWYuZGVsaXZlcnlTdGF0dXMuc21zID0gcmVzdWx0LnN1Y2Nlc3MgPyAnc2VudCcgOiAnZmFpbGVkJztcclxuICAgICAgICB9IGVsc2UgaWYgKGNoYW5uZWwgPT09ICdwdXNoJykge1xyXG4gICAgICAgICAgY29uc3QgdG9rZW5zID0gKHVzZXIgJiYgdXNlci5mY21Ub2tlbnMpIHx8IFtdO1xyXG4gICAgICAgICAgaWYgKHRva2Vucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlbmRQdXNoKHsgdG9rZW5zLCB0aXRsZTogbm90aWYudGl0bGUsIGJvZHk6IG5vdGlmLm1lc3NhZ2UgfSk7XHJcbiAgICAgICAgICAgIG5vdGlmLmRlbGl2ZXJ5U3RhdHVzLnB1c2ggPSByZXN1bHQuc3VjY2VzcyA/ICdzZW50JyA6ICdmYWlsZWQnO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbm90aWYuZGVsaXZlcnlTdGF0dXMucHVzaCA9ICduby10b2tlbnMnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoY2hhbm5lbCA9PT0gJ2luLWFwcCcpIHtcclxuICAgICAgICAgIG5vdGlmLmRlbGl2ZXJ5U3RhdHVzLmluQXBwID0gJ2RlbGl2ZXJlZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLm5vdGlmaWNhdGlvbnMucHVzaChub3RpZik7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbm90aWZpY2F0aW9uSWQ6IG5vdGlmLmlkLFxyXG4gICAgICAgIHNlbnRUbzogbm90aWYuY2hhbm5lbHMsXHJcbiAgICAgICAgZGVsaXZlcnlTdGF0dXM6IG5vdGlmLmRlbGl2ZXJ5U3RhdHVzLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vdGlmaWNhdGlvbiBzZW5kIGZhaWxlZDogJHtlcnIubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2KXYtNi52KfYsdin2Kog2KfZhNmF2LPYqtiu2K/ZhVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBnZXROb3RpZmljYXRpb25zKHVzZXJJZCwgbGltaXQgPSA1MCwgdW5yZWFkT25seSA9IGZhbHNlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgdXNlck5vdGlmcyA9IHRoaXMubm90aWZpY2F0aW9ucy5maWx0ZXIobiA9PiBuLnVzZXJJZCA9PT0gdXNlcklkKTtcclxuXHJcbiAgICAgIGlmICh1bnJlYWRPbmx5KSB7XHJcbiAgICAgICAgdXNlck5vdGlmcyA9IHVzZXJOb3RpZnMuZmlsdGVyKG4gPT4gIW4ucmVhZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBjb3VudDogdXNlck5vdGlmcy5sZW5ndGgsXHJcbiAgICAgICAgbm90aWZpY2F0aW9uczogdXNlck5vdGlmcy5zbGljZSgtbGltaXQpLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEdldCBub3RpZmljYXRpb25zIGZhaWxlZDogJHtlcnIubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINmI2LbYuSDYudmE2KfZhdipINi52YTZiSDYp9mE2KXYtNi52KfYsSDZg9mF2YLYsdmI2KFcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgbWFya0FzUmVhZChub3RpZmljYXRpb25JZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgbm90aWYgPSB0aGlzLm5vdGlmaWNhdGlvbnMuZmluZChuID0+IG4uaWQgPT09IG5vdGlmaWNhdGlvbklkKTtcclxuICAgICAgaWYgKG5vdGlmKSB7XHJcbiAgICAgICAgbm90aWYucmVhZCA9IHRydWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdNYXJrZWQgYXMgcmVhZCcgfTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1hcmsgYXMgcmVhZCBmYWlsZWQ6ICR7ZXJyLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYrdiw2YEg2KfZhNil2LTYudin2LFcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZGVsZXRlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLm5vdGlmaWNhdGlvbnMgPSB0aGlzLm5vdGlmaWNhdGlvbnMuZmlsdGVyKG4gPT4gbi5pZCAhPT0gbm90aWZpY2F0aW9uSWQpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnTm90aWZpY2F0aW9uIGRlbGV0ZWQnIH07XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBEZWxldGUgbm90aWZpY2F0aW9uIGZhaWxlZDogJHtlcnIubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINit2LDZgSDYrNmF2YrYuSDYpdi02LnYp9ix2KfYqiDYp9mE2YXYs9iq2K7Yr9mFXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGRlbGV0ZUFsbE5vdGlmaWNhdGlvbnModXNlcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjb3VudEJlZm9yZSA9IHRoaXMubm90aWZpY2F0aW9ucy5sZW5ndGg7XHJcbiAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IHRoaXMubm90aWZpY2F0aW9ucy5maWx0ZXIobiA9PiBuLnVzZXJJZCAhPT0gdXNlcklkKTtcclxuICAgICAgY29uc3QgZGVsZXRlZENvdW50ID0gY291bnRCZWZvcmUgLSB0aGlzLm5vdGlmaWNhdGlvbnMubGVuZ3RoO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6IGAke2RlbGV0ZWRDb3VudH0gbm90aWZpY2F0aW9ucyBkZWxldGVkYCxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERlbGV0ZSBhbGwgbm90aWZpY2F0aW9ucyBmYWlsZWQ6ICR7ZXJyLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYrNiv2YjZhNipINil2LTYudin2LEgKNmF2K3Yp9mD2KfYqSlcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgc2NoZWR1bGVOb3RpZmljYXRpb24odXNlcklkLCBub3RpZmljYXRpb25EYXRhLCBzY2hlZHVsZVRpbWUpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiAnTm90aWZpY2F0aW9uIHNjaGVkdWxlZCcsXHJcbiAgICAgICAgc2NoZWR1bGVkRm9yOiBzY2hlZHVsZVRpbWUsXHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgU2NoZWR1bGUgbm90aWZpY2F0aW9uIGZhaWxlZDogJHtlcnIubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEhlbHBlciBNZXRob2RzXHJcbiAgc3RhdGljIF9zaW11bGF0ZURlbGl2ZXJ5KGNoYW5uZWxzKSB7XHJcbiAgICBjb25zdCBkZWxpdmVyeSA9IHt9O1xyXG4gICAgY2hhbm5lbHMuZm9yRWFjaChjaGFubmVsID0+IHtcclxuICAgICAgZGVsaXZlcnlbY2hhbm5lbF0gPSB7XHJcbiAgICAgICAgc3RhdHVzOiAnZGVsaXZlcmVkJyxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgYXR0ZW1wdHM6IDEsXHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBkZWxpdmVyeTtcclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTm90aWZpY2F0aW9uU2VydmljZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTTtFQUFFQTtBQUFVLENBQUMsR0FBR0MsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQy9DLE1BQU07RUFBRUM7QUFBUSxDQUFDLEdBQUdELE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDM0MsTUFBTTtFQUFFRTtBQUFTLENBQUMsR0FBR0YsT0FBTyxDQUFDLGVBQWUsQ0FBQztBQUM3QyxNQUFNRyxJQUFJLEdBQUdILE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUV0QyxNQUFNSSxtQkFBbUIsQ0FBQztFQUN4QixPQUFPQyxhQUFhLEdBQUcsRUFBRTs7RUFFekI7QUFDRjtBQUNBO0VBQ0UsYUFBYUMsZ0JBQWdCQSxDQUFDQyxNQUFNLEVBQUVDLGdCQUFnQixFQUFFO0lBQ3RELElBQUk7TUFDRixNQUFNQyxLQUFLLEdBQUc7UUFDWkMsRUFBRSxFQUFFLFNBQVNDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRTtRQUN6QkwsTUFBTTtRQUNOTSxLQUFLLEVBQUVMLGdCQUFnQixDQUFDSyxLQUFLO1FBQzdCQyxPQUFPLEVBQUVOLGdCQUFnQixDQUFDTSxPQUFPO1FBQ2pDQyxRQUFRLEVBQUVQLGdCQUFnQixDQUFDTyxRQUFRLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDakRDLFFBQVEsRUFBRVIsZ0JBQWdCLENBQUNRLFFBQVEsSUFBSSxRQUFRO1FBQy9DQyxTQUFTLEVBQUUsSUFBSU4sSUFBSSxDQUFDLENB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