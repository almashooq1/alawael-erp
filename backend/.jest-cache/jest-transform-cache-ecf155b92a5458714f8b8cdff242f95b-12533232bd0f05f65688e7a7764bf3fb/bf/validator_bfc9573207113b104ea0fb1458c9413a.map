{"version":3,"names":["logger","require","Validator","constructor","schemas","customRules","registerSchema","name","schema","info","isValidEmail","email","emailRegex","test","isValidPhone","phone","phoneRegex","isValidUrl","url","URL","validateField","value","type","length","isNaN","Array","isArray","Date","parse","validate","data","schemaName","warn","valid","errors","Object","entries","forEach","field","rules","required","undefined","push","minLength","maxLength","min","max","pattern","RegExp","enum","includes","join","sanitize","replace","trim","sanitized","key","validateRange","validateUnique","array","Set","size","registerRule","validatorFn","applyCustomRule","rule","getStats","keys","schemaList","rulesList","module","exports"],"sources":["validator.js"],"sourcesContent":["/**\n * Advanced Validation Service\n * Data validation, schema checking, and business rules\n * Phase 10: Advanced Features\n */\n\nconst logger = require('../utils/logger');\n\nclass Validator {\n  constructor() {\n    this.schemas = {};\n    this.customRules = {};\n  }\n\n  /**\n   * Register validation schema\n   */\n  registerSchema(name, schema) {\n    this.schemas[name] = schema;\n    logger.info(`Schema registered: ${name}`);\n  }\n\n  /**\n   * Validate email\n   */\n  isValidEmail(email) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  /**\n   * Validate phone number\n   */\n  isValidPhone(phone) {\n    const phoneRegex = /^[\\+]?[(]?[0-9]{3}[)]?[-\\s\\.]?[0-9]{3}[-\\s\\.]?[0-9]{4,6}$/;\n    return phoneRegex.test(phone);\n  }\n\n  /**\n   * Validate URL\n   */\n  isValidUrl(url) {\n    try {\n      new URL(url);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Validate field against type\n   */\n  validateField(value, type) {\n    switch (type) {\n      case 'string':\n        return typeof value === 'string' && value.length > 0;\n      case 'number':\n        return typeof value === 'number' && !isNaN(value);\n      case 'boolean':\n        return typeof value === 'boolean';\n      case 'array':\n        return Array.isArray(value);\n      case 'object':\n        return typeof value === 'object' && value !== null;\n      case 'email':\n        return this.isValidEmail(value);\n      case 'phone':\n        return this.isValidPhone(value);\n      case 'url':\n        return this.isValidUrl(value);\n      case 'date':\n        return !isNaN(Date.parse(value));\n      default:\n        return true;\n    }\n  }\n\n  /**\n   * Validate object against schema\n   */\n  validate(data, schemaName) {\n    const schema = this.schemas[schemaName];\n    if (!schema) {\n      logger.warn(`Schema not found: ${schemaName}`);\n      return { valid: true, errors: [] };\n    }\n\n    const errors = [];\n\n    Object.entries(schema).forEach(([field, rules]) => {\n      const value = data[field];\n\n      // Check required\n      if (rules.required && (value === undefined || value === null || value === '')) {\n        errors.push(`${field} is required`);\n        return;\n      }\n\n      // Check type\n      if (value !== undefined && rules.type) {\n        if (!this.validateField(value, rules.type)) {\n          errors.push(`${field} must be of type ${rules.type}`);\n        }\n      }\n\n      // Check minLength\n      if (value && rules.minLength && value.length < rules.minLength) {\n        errors.push(`${field} must be at least ${rules.minLength} characters`);\n      }\n\n      // Check maxLength\n      if (value && rules.maxLength && value.length > rules.maxLength) {\n        errors.push(`${field} must not exceed ${rules.maxLength} characters`);\n      }\n\n      // Check min/max for numbers\n      if (typeof value === 'number') {\n        if (rules.min !== undefined && value < rules.min) {\n          errors.push(`${field} must be at least ${rules.min}`);\n        }\n        if (rules.max !== undefined && value > rules.max) {\n          errors.push(`${field} must not exceed ${rules.max}`);\n        }\n      }\n\n      // Check pattern (regex)\n      if (value && rules.pattern) {\n        if (!new RegExp(rules.pattern).test(value)) {\n          errors.push(`${field} format is invalid`);\n        }\n      }\n\n      // Check enum\n      if (value && rules.enum) {\n        if (!rules.enum.includes(value)) {\n          errors.push(`${field} must be one of: ${rules.enum.join(', ')}`);\n        }\n      }\n    });\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  }\n\n  /**\n   * Sanitize input\n   */\n  sanitize(data) {\n    if (typeof data === 'string') {\n      return data.replace(/[<>]/g, '').trim();\n    }\n\n    if (typeof data === 'object' && data !== null) {\n      const sanitized = {};\n      Object.entries(data).forEach(([key, value]) => {\n        sanitized[key] = this.sanitize(value);\n      });\n      return sanitized;\n    }\n\n    return data;\n  }\n\n  /**\n   * Validate data range\n   */\n  validateRange(value, min, max) {\n    return value >= min && value <= max;\n  }\n\n  /**\n   * Validate array uniqueness\n   */\n  validateUnique(array) {\n    return new Set(array).size === array.length;\n  }\n\n  /**\n   * Custom validation rule\n   */\n  registerRule(name, validatorFn) {\n    this.customRules[name] = validatorFn;\n  }\n\n  /**\n   * Apply custom rule\n   */\n  applyCustomRule(name, value) {\n    const rule = this.customRules[name];\n    if (!rule) {\n      logger.warn(`Custom rule not found: ${name}`);\n      return true;\n    }\n    return rule(value);\n  }\n\n  /**\n   * Get validation stats\n   */\n  getStats() {\n    return {\n      schemas: Object.keys(this.schemas).length,\n      customRules: Object.keys(this.customRules).length,\n      schemaList: Object.keys(this.schemas),\n      rulesList: Object.keys(this.customRules),\n    };\n  }\n}\n\nmodule.exports = new Validator();\n"],"mappings":"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","ignoreList":[]}