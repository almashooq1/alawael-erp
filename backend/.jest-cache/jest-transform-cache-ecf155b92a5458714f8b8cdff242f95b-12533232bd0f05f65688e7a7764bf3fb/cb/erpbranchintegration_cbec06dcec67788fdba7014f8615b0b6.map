{"version":3,"names":["express","require","router","Router","_fetch","fetch","BranchERPIntegrationService","constructor","baseURL","process","env","BRANCH_API_URL","apiKey","BRANCH_API_KEY","syncInterval","syncBranchesToERP","response","method","headers","ok","Error","statusText","branchesData","json","syncedBranches","processBranchesForERP","data","success","synced_count","length","timestamp","Date","toISOString","branches","error","console","message","map","branch","id","code","name_en","name_ar","status","mapBranchStatus","location","city","region","country","coordinates","latitude","longitude","director_name","director_email","phone","email","total_staff","max_capacity","current_utilization","annual_budget","budget_spent","parent_branch_id","sync_timestamp","source","erp_last_updated","statusMap","getBranchPerformanceMetrics","branchId","metricsData","branch_id","performance_score","kpis","trends","insights","getBranchInventory","inventoryData","items","total_value","turnover_rate","recommendations","reorder_recommendations","getBranchReports","reportType","reportsData","report_type","reports","getBranchForecasts","forecastData","demand_forecast","budget_forecast","performance_trend","startContinuousSync","log","then","result","setInterval","integrationService","post","req","res","get","params","performance","inventory","forecasts","Promise","all","dashboard","generated_at","service","version","initializeIntegration","app","use","ENABLE_CONTINUOUS_SYNC","module","exports"],"sources":["erp-branch-integration.js"],"sourcesContent":["/**\r\n * ERP System Integration Module - Advanced Branch Management Integration\r\n * This module handles the complete integration between ERP and Advanced Branch System\r\n * Version: 2.0.0\r\n * Date: February 18, 2026\r\n */\r\n\r\nconst express = require('express');\r\nconst router = express.Router();\r\nconst _fetch = typeof fetch !== 'undefined' ? fetch : require('node-fetch');\r\n\r\n// =============================================\r\n// BRANCH-ERP INTEGRATION SERVICE\r\n// =============================================\r\n\r\nclass BranchERPIntegrationService {\r\n  constructor() {\r\n    this.baseURL = process.env.BRANCH_API_URL || 'http://localhost:5000/api/v2';\r\n    this.apiKey = process.env.BRANCH_API_KEY || '';\r\n    this.syncInterval = 60000; // 1 minute\r\n  }\r\n\r\n  /**\r\n   * Sync branch data with ERP\r\n   */\r\n  async syncBranchesToERP() {\r\n    try {\r\n      const response = await _fetch(`${this.baseURL}/branches`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${this.apiKey}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch branches: ${response.statusText}`);\r\n      }\r\n\r\n      const branchesData = await response.json();\r\n      \r\n      // Transform and sync to ERP database\r\n      const syncedBranches = await this.processBranchesForERP(branchesData.data);\r\n      \r\n      return {\r\n        success: true,\r\n        synced_count: syncedBranches.length,\r\n        timestamp: new Date().toISOString(),\r\n        branches: syncedBranches\r\n      };\r\n    } catch (error) {\r\n      console.error('Branch sync error:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process branch data for ERP integration\r\n   */\r\n  async processBranchesForERP(branches) {\r\n    return branches.map(branch => ({\r\n      // ERP Core Fields\r\n      id: branch.id,\r\n      code: branch.code,\r\n      name_en: branch.name_en,\r\n      name_ar: branch.name_ar,\r\n      status: this.mapBranchStatus(branch.status),\r\n      \r\n      // Location & Contact\r\n      location: branch.location,\r\n      city: branch.city,\r\n      region: branch.region,\r\n      country: branch.country,\r\n      coordinates: {\r\n        latitude: branch.latitude,\r\n        longitude: branch.longitude\r\n      },\r\n      \r\n      // Management\r\n      director_name: branch.director_name,\r\n      director_email: branch.director_email,\r\n      phone: branch.phone,\r\n      email: branch.email,\r\n      \r\n      // Metrics\r\n      total_staff: branch.total_staff,\r\n      max_capacity: branch.max_capacity,\r\n      current_utilization: branch.current_utilization,\r\n      annual_budget: branch.annual_budget,\r\n      budget_spent: branch.budget_spent,\r\n      \r\n      // Hierarchy\r\n      parent_branch_id: branch.parent_branch_id,\r\n      \r\n      // Sync Metadata\r\n      sync_timestamp: new Date().toISOString(),\r\n      source: 'advanced_branch_system',\r\n      erp_last_updated: new Date().toISOString()\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Map branch statuses between systems\r\n   */\r\n  mapBranchStatus(status) {\r\n    const statusMap = {\r\n      'ACTIVE': 'ACTIVE',\r\n      'INACTIVE': 'INACTIVE',\r\n      'CLOSED': 'CLOSED',\r\n      'SUSPENDED': 'SUSPENDED',\r\n      'PLANNED': 'PLANNED'\r\n    };\r\n    return statusMap[status] || 'ACTIVE';\r\n  }\r\n\r\n  /**\r\n   * Get branch performance metrics for ERP reporting\r\n   */\r\n  async getBranchPerformanceMetrics(branchId) {\r\n    try {\r\n      const response = await _fetch(`${this.baseURL}/branches/${branchId}/performance`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${this.apiKey}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch performance metrics`);\r\n      }\r\n\r\n      const metricsData = await response.json();\r\n      \r\n      return {\r\n        success: true,\r\n        branch_id: branchId,\r\n        performance_score: metricsData.data.performance_score,\r\n        kpis: metricsData.data.trends,\r\n        insights: metricsData.data.insights,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    } catch (error) {\r\n      console.error('Performance metrics fetch error:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get inventory data for ERP stock management\r\n   */\r\n  async getBranchInventory(branchId) {\r\n    try {\r\n      const response = await _fetch(`${this.baseURL}/branches/${branchId}/inventory`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${this.apiKey}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch inventory`);\r\n      }\r\n\r\n      const inventoryData = await response.json();\r\n      \r\n      return {\r\n        success: true,\r\n        branch_id: branchId,\r\n        items: inventoryData.data.items,\r\n        total_value: inventoryData.data.total_value,\r\n        turnover_rate: inventoryData.data.turnover_rate,\r\n        recommendations: inventoryData.data.reorder_recommendations,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    } catch (error) {\r\n      console.error('Inventory fetch error:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get branch reports for ERP analytics\r\n   */\r\n  async getBranchReports(branchId, reportType = 'OPERATIONAL') {\r\n    try {\r\n      const response = await _fetch(\r\n        `${this.baseURL}/branches/${branchId}/reports?type=${reportType}`,\r\n        {\r\n          method: 'GET',\r\n          headers: {\r\n            'Authorization': `Bearer ${this.apiKey}`,\r\n            'Content-Type': 'application/json'\r\n          }\r\n        }\r\n      );\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch reports`);\r\n      }\r\n\r\n      const reportsData = await response.json();\r\n      \r\n      return {\r\n        success: true,\r\n        branch_id: branchId,\r\n        report_type: reportType,\r\n        reports: reportsData.data,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    } catch (error) {\r\n      console.error('Reports fetch error:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get forecasts and predictions for ERP planning\r\n   */\r\n  async getBranchForecasts(branchId) {\r\n    try {\r\n      const response = await _fetch(`${this.baseURL}/branches/${branchId}/forecasts`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${this.apiKey}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch forecasts`);\r\n      }\r\n\r\n      const forecastData = await response.json();\r\n      \r\n      return {\r\n        success: true,\r\n        branch_id: branchId,\r\n        demand_forecast: forecastData.data.demand_forecast,\r\n        budget_forecast: forecastData.data.budget_forecast,\r\n        performance_trend: forecastData.data.performance_trend,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    } catch (error) {\r\n      console.error('Forecasts fetch error:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start continuous sync\r\n   */\r\n  startContinuousSync() {\r\n    console.log('Starting continuous branch-ERP sync...');\r\n    \r\n    // Initial sync\r\n    this.syncBranchesToERP().then(result => {\r\n      console.log('Initial sync result:', result);\r\n    });\r\n\r\n    // Periodic sync\r\n    setInterval(() => {\r\n      this.syncBranchesToERP().then(result => {\r\n        if (result.success) {\r\n          console.log(`[${new Date().toISOString()}] Synced ${result.synced_count} branches`);\r\n        } else {\r\n          console.error(`[${new Date().toISOString()}] Sync failed:`, result.error);\r\n        }\r\n      });\r\n    }, this.syncInterval);\r\n  }\r\n}\r\n\r\n// =============================================\r\n// API ENDPOINTS\r\n// =============================================\r\n\r\nconst integrationService = new BranchERPIntegrationService();\r\n\r\n/**\r\n * Sync all branches\r\n */\r\nrouter.post('/sync/branches', async (req, res) => {\r\n  const result = await integrationService.syncBranchesToERP();\r\n  res.json(result);\r\n});\r\n\r\n/**\r\n * Get branch KPIs for ERP dashboard\r\n */\r\nrouter.get('/branches/:branchId/kpis', async (req, res) => {\r\n  const { branchId } = req.params;\r\n  const result = await integrationService.getBranchPerformanceMetrics(branchId);\r\n  res.json(result);\r\n});\r\n\r\n/**\r\n * Get branch inventory for stock management\r\n */\r\nrouter.get('/branches/:branchId/inventory-sync', async (req, res) => {\r\n  const { branchId } = req.params;\r\n  const result = await integrationService.getBranchInventory(branchId);\r\n  res.json(result);\r\n});\r\n\r\n/**\r\n * Get branch reports\r\n */\r\nrouter.get('/branches/:branchId/reports/:reportType', async (req, res) => {\r\n  const { branchId, reportType } = req.params;\r\n  const result = await integrationService.getBranchReports(branchId, reportType);\r\n  res.json(result);\r\n});\r\n\r\n/**\r\n * Get forecasts for planning\r\n */\r\nrouter.get('/branches/:branchId/forecasts', async (req, res) => {\r\n  const { branchId } = req.params;\r\n  const result = await integrationService.getBranchForecasts(branchId);\r\n  res.json(result);\r\n});\r\n\r\n/**\r\n * Get comprehensive branch dashboard\r\n */\r\nrouter.get('/branches/:branchId/dashboard', async (req, res) => {\r\n  const { branchId } = req.params;\r\n  \r\n  try {\r\n    const [performance, inventory, reports, forecasts] = await Promise.all([\r\n      integrationService.getBranchPerformanceMetrics(branchId),\r\n      integrationService.getBranchInventory(branchId),\r\n      integrationService.getBranchReports(branchId, 'OPERATIONAL'),\r\n      integrationService.getBranchForecasts(branchId)\r\n    ]);\r\n\r\n    const dashboard = {\r\n      success: true,\r\n      branch_id: branchId,\r\n      performance,\r\n      inventory,\r\n      reports,\r\n      forecasts,\r\n      generated_at: new Date().toISOString()\r\n    };\r\n\r\n    res.json(dashboard);\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      error: error.message,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * Health check\r\n */\r\nrouter.get('/health', (req, res) => {\r\n  res.json({\r\n    status: 'healthy',\r\n    service: 'ERP-Branch Integration',\r\n    version: '2.0.0',\r\n    timestamp: new Date().toISOString()\r\n  });\r\n});\r\n\r\n// =============================================\r\n// INITIALIZATION\r\n// =============================================\r\n\r\nfunction initializeIntegration(app) {\r\n  console.log('Initializing ERP-Branch Integration Service');\r\n  \r\n  // Mount routes\r\n  app.use('/api/integration', router);\r\n  \r\n  // Start continuous sync if enabled\r\n  if (process.env.ENABLE_CONTINUOUS_SYNC === 'true') {\r\n    integrationService.startContinuousSync();\r\n  }\r\n  \r\n  console.log('ERP-Branch Integration Service initialized successfully');\r\n}\r\n\r\nmodule.exports = {\r\n  router,\r\n  BranchERPIntegrationService,\r\n  initializeIntegration\r\n};\r\n"],"mappings":"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","ignoreList":[]}