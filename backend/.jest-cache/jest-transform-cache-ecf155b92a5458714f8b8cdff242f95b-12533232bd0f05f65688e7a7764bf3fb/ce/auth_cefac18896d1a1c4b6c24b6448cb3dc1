7bcd4d3cbe4ae8fe310da1908b31ac70
/**
 * Authentication Middleware
 * Basic auth middleware for protected routes
 */

const jwt = require('jwt-simple');
const logger = require('../utils/logger');
const SECRET = process.env.JWT_SECRET || 'your-secret-key';

/**
 * Verify JWT token
 */
const verifyToken = (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    if (!token) {
      return res.status(401).json({
        success: false,
        error: 'No token provided'
      });
    }

    // Decode base64 token (as generated by AuthService)
    let decoded;
    try {
      decoded = JSON.parse(Buffer.from(token, 'base64').toString());
    } catch (e) {
      // If base64 decoding fails, try JWT
      try {
        decoded = jwt.decode(token, SECRET);
      } catch (jwtError) {
        // If both fail, return invalid token error
        return res.status(401).json({
          success: false,
          error: 'Invalid token'
        });
      }
    }
    if (decoded.exp && decoded.exp < Date.now()) {
      return res.status(401).json({
        success: false,
        error: 'Token expired'
      });
    }
    req.user = decoded;
    next();
  } catch (error) {
    logger.error('Token verification failed:', error);
    res.status(401).json({
      success: false,
      error: 'Invalid token'
    });
  }
};

/**
 * Optional authentication - doesn't fail if no token
 */
const optionalAuth = (req, res, next) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    if (token) {
      // Decode base64 token (as generated by AuthService)
      let decoded;
      try {
        decoded = JSON.parse(Buffer.from(token, 'base64').toString());
      } catch (e) {
        // Try JWT decoding as fallback
        try {
          decoded = jwt.decode(token, SECRET);
        } catch (jwtError) {
          // If both fail, just continue without user
          return next();
        }
      }
      if (!decoded.exp || decoded.exp >= Date.now()) {
        req.user = decoded;
      }
    }
    next();
  } catch (error) {
    logger.debug('Optional auth failed:', error.message);
    next();
  }
};

/**
 * Admin authorization
 */

// RBAC متقدم: تحقق من الدور والصلاحيات والسياق المؤسسي/الفرعي
const requireAdmin = (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  // تحقق من الدور الأساسي أو الأدوار الإضافية
  const isAdmin = req.user.role === 'admin' || Array.isArray(req.user.roles) && req.user.roles.includes('admin');
  if (!isAdmin) {
    return res.status(403).json({
      error: 'Admin access required'
    });
  }
  // تحقق من المؤسسة/الفرع إذا تم تمرير orgId/branchId في الطلب
  if (req.params.orgId && req.user.organizationId && req.params.orgId !== req.user.organizationId) {
    return res.status(403).json({
      error: 'Access denied for this organization'
    });
  }
  if (req.params.branchId && req.user.branchId && req.params.branchId !== req.user.branchId) {
    return res.status(403).json({
      error: 'Access denied for this branch'
    });
  }
  next();
};

// ميدل وير لصلاحيات granular (permission string)
const requirePermission = permission => (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  // تحقق من الصلاحيات
  const hasPermission = Array.isArray(req.user.permissions) && req.user.permissions.includes(permission);
  if (!hasPermission) {
    return res.status(403).json({
      error: 'Permission denied'
    });
  }
  // تحقق من المؤسسة/الفرع إذا لزم
  if (req.params.orgId && req.user.organizationId && req.params.orgId !== req.user.organizationId) {
    return res.status(403).json({
      error: 'Access denied for this organization'
    });
  }
  if (req.params.branchId && req.user.branchId && req.params.branchId !== req.user.branchId) {
    return res.status(403).json({
      error: 'Access denied for this branch'
    });
  }
  next();
};

/**
 * Authenticate middleware (alias for verifyToken)
 */
const authenticate = verifyToken;

/**
 * Authorization middleware - checks multiple roles
 */
const authorize = (...allowedRoles) => (req, res, next) => {
  if (!req.user) {
    return res.status(401).json({
      error: 'Not authenticated'
    });
  }
  if (allowedRoles.length > 0 && !allowedRoles.includes(req.user.role)) {
    return res.status(403).json({
      error: 'Insufficient permissions'
    });
  }
  next();
};
module.exports = {
  verifyToken,
  optionalAuth,
  requireAdmin,
  requirePermission,
  authenticate,
  authorize,
  protect: verifyToken // Alias for backward compatibility
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwibG9nZ2VyIiwiU0VDUkVUIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ2ZXJpZnlUb2tlbiIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3BsaXQiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiZGVjb2RlZCIsIkpTT04iLCJwYXJzZSIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsImUiLCJkZWNvZGUiLCJqd3RFcnJvciIsImV4cCIsIkRhdGUiLCJub3ciLCJ1c2VyIiwib3B0aW9uYWxBdXRoIiwiZGVidWciLCJtZXNzYWdlIiwicmVxdWlyZUFkbWluIiwiaXNBZG1pbiIsInJvbGUiLCJBcnJheSIsImlzQXJyYXkiLCJyb2xlcyIsImluY2x1ZGVzIiwicGFyYW1zIiwib3JnSWQiLCJvcmdhbml6YXRpb25JZCIsImJyYW5jaElkIiwicmVxdWlyZVBlcm1pc3Npb24iLCJwZXJtaXNzaW9uIiwiaGFzUGVybWlzc2lvbiIsInBlcm1pc3Npb25zIiwiYXV0aGVudGljYXRlIiwiYXV0aG9yaXplIiwiYWxsb3dlZFJvbGVzIiwibGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyIsInByb3RlY3QiXSwic291cmNlcyI6WyJhdXRoLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBBdXRoZW50aWNhdGlvbiBNaWRkbGV3YXJlXHJcbiAqIEJhc2ljIGF1dGggbWlkZGxld2FyZSBmb3IgcHJvdGVjdGVkIHJvdXRlc1xyXG4gKi9cclxuXHJcbmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2p3dC1zaW1wbGUnKTtcclxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XHJcblxyXG5jb25zdCBTRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd5b3VyLXNlY3JldC1rZXknO1xyXG5cclxuLyoqXHJcbiAqIFZlcmlmeSBKV1QgdG9rZW5cclxuICovXHJcbmNvbnN0IHZlcmlmeVRva2VuID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbj8uc3BsaXQoJyAnKVsxXTtcclxuXHJcbiAgICBpZiAoIXRva2VuKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIHRva2VuIHByb3ZpZGVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWNvZGUgYmFzZTY0IHRva2VuIChhcyBnZW5lcmF0ZWQgYnkgQXV0aFNlcnZpY2UpXHJcbiAgICBsZXQgZGVjb2RlZDtcclxuICAgIHRyeSB7XHJcbiAgICAgIGRlY29kZWQgPSBKU09OLnBhcnNlKEJ1ZmZlci5mcm9tKHRva2VuLCAnYmFzZTY0JykudG9TdHJpbmcoKSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIC8vIElmIGJhc2U2NCBkZWNvZGluZyBmYWlscywgdHJ5IEpXVFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGRlY29kZWQgPSBqd3QuZGVjb2RlKHRva2VuLCBTRUNSRVQpO1xyXG4gICAgICB9IGNhdGNoIChqd3RFcnJvcikge1xyXG4gICAgICAgIC8vIElmIGJvdGggZmFpbCwgcmV0dXJuIGludmFsaWQgdG9rZW4gZXJyb3JcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHRva2VuJyB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChkZWNvZGVkLmV4cCAmJiBkZWNvZGVkLmV4cCA8IERhdGUubm93KCkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVG9rZW4gZXhwaXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVxLnVzZXIgPSBkZWNvZGVkO1xyXG4gICAgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ1Rva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHRva2VuJyB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogT3B0aW9uYWwgYXV0aGVudGljYXRpb24gLSBkb2Vzbid0IGZhaWwgaWYgbm8gdG9rZW5cclxuICovXHJcbmNvbnN0IG9wdGlvbmFsQXV0aCA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24/LnNwbGl0KCcgJylbMV07XHJcblxyXG4gICAgaWYgKHRva2VuKSB7XHJcbiAgICAgIC8vIERlY29kZSBiYXNlNjQgdG9rZW4gKGFzIGdlbmVyYXRlZCBieSBBdXRoU2VydmljZSlcclxuICAgICAgbGV0IGRlY29kZWQ7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgZGVjb2RlZCA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20odG9rZW4sICdiYXNlNjQnKS50b1N0cmluZygpKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vIFRyeSBKV1QgZGVjb2RpbmcgYXMgZmFsbGJhY2tcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgZGVjb2RlZCA9IGp3dC5kZWNvZGUodG9rZW4sIFNFQ1JFVCk7XHJcbiAgICAgICAgfSBjYXRjaCAoand0RXJyb3IpIHtcclxuICAgICAgICAgIC8vIElmIGJvdGggZmFpbCwganVzdCBjb250aW51ZSB3aXRob3V0IHVzZXJcclxuICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWRlY29kZWQuZXhwIHx8IGRlY29kZWQuZXhwID49IERhdGUubm93KCkpIHtcclxuICAgICAgICByZXEudXNlciA9IGRlY29kZWQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZXh0KCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5kZWJ1ZygnT3B0aW9uYWwgYXV0aCBmYWlsZWQ6JywgZXJyb3IubWVzc2FnZSk7XHJcbiAgICBuZXh0KCk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkbWluIGF1dGhvcml6YXRpb25cclxuICovXHJcblxyXG4vLyBSQkFDINmF2KrZgtiv2YU6INiq2K3ZgtmCINmF2YYg2KfZhNiv2YjYsSDZiNin2YTYtdmE2KfYrdmK2KfYqiDZiNin2YTYs9mK2KfZgiDYp9mE2YXYpNiz2LPZii/Yp9mE2YHYsdi52YpcclxuY29uc3QgcmVxdWlyZUFkbWluID0gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgaWYgKCFyZXEudXNlcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNiv2YjYsSDYp9mE2KPYs9in2LPZiiDYo9mIINin2YTYo9iv2YjYp9ixINin2YTYpdi22KfZgdmK2KlcclxuICBjb25zdCBpc0FkbWluID1cclxuICAgIHJlcS51c2VyLnJvbGUgPT09ICdhZG1pbicgfHxcclxuICAgIChBcnJheS5pc0FycmF5KHJlcS51c2VyLnJvbGVzKSAmJiByZXEudXNlci5yb2xlcy5pbmNsdWRlcygnYWRtaW4nKSk7XHJcbiAgaWYgKCFpc0FkbWluKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNmF2KTYs9iz2Kkv2KfZhNmB2LHYuSDYpdiw2Kcg2KrZhSDYqtmF2LHZitixIG9yZ0lkL2JyYW5jaElkINmB2Yog2KfZhNi32YTYqFxyXG4gIGlmIChyZXEucGFyYW1zLm9yZ0lkICYmIHJlcS51c2VyLm9yZ2FuaXphdGlvbklkICYmIHJlcS5wYXJhbXMub3JnSWQgIT09IHJlcS51c2VyLm9yZ2FuaXphdGlvbklkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ0FjY2VzcyBkZW5pZWQgZm9yIHRoaXMgb3JnYW5pemF0aW9uJyB9KTtcclxuICB9XHJcbiAgaWYgKHJlcS5wYXJhbXMuYnJhbmNoSWQgJiYgcmVxLnVzZXIuYnJhbmNoSWQgJiYgcmVxLnBhcmFtcy5icmFuY2hJZCAhPT0gcmVxLnVzZXIuYnJhbmNoSWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnQWNjZXNzIGRlbmllZCBmb3IgdGhpcyBicmFuY2gnIH0pO1xyXG4gIH1cclxuICBuZXh0KCk7XHJcbn07XHJcblxyXG4vLyDZhdmK2K/ZhCDZiNmK2LEg2YTYtdmE2KfYrdmK2KfYqiBncmFudWxhciAocGVybWlzc2lvbiBzdHJpbmcpXHJcbmNvbnN0IHJlcXVpcmVQZXJtaXNzaW9uID0gcGVybWlzc2lvbiA9PiAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICBpZiAoIXJlcS51c2VyKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ05vdCBhdXRoZW50aWNhdGVkJyB9KTtcclxuICB9XHJcbiAgLy8g2KrYrdmC2YIg2YXZhiDYp9mE2LXZhNin2K3Zitin2KpcclxuICBjb25zdCBoYXNQZXJtaXNzaW9uID1cclxuICAgIEFycmF5LmlzQXJyYXkocmVxLnVzZXIucGVybWlzc2lvbnMpICYmIHJlcS51c2VyLnBlcm1pc3Npb25zLmluY2x1ZGVzKHBlcm1pc3Npb24pO1xyXG4gIGlmICghaGFzUGVybWlzc2lvbikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdQZXJtaXNzaW9uIGRlbmllZCcgfSk7XHJcbiAgfVxyXG4gIC8vINiq2K3ZgtmCINmF2YYg2KfZhNmF2KTYs9iz2Kkv2KfZhNmB2LHYuSDYpdiw2Kcg2YTYstmFXHJcbiAgaWYgKHJlcS5wYXJhbXMub3JnSWQgJiYgcmVxLnVzZXIub3JnYW5pemF0aW9uSWQgJiYgcmVxLnBhcmFtcy5vcmdJZCAhPT0gcmVxLnVzZXIub3JnYW5pemF0aW9uSWQpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnQWNjZXNzIGRlbmllZCBmb3IgdGhpcyBvcmdhbml6YXRpb24nIH0pO1xyXG4gIH1cclxuICBpZiAocmVxLnBhcmFtcy5icmFuY2hJZCAmJiByZXEudXNlci5icmFuY2hJZCAmJiByZXEucGFyYW1zLmJyYW5jaElkICE9PSByZXEudXNlci5icmFuY2hJZCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkIGZvciB0aGlzIGJyYW5jaCcgfSk7XHJcbiAgfVxyXG4gIG5leHQoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBdXRoZW50aWNhdGUgbWlkZGxld2FyZSAoYWxpYXMgZm9yIHZlcmlmeVRva2VuKVxyXG4gKi9cclxuY29uc3QgYXV0aGVudGljYXRlID0gdmVyaWZ5VG9rZW47XHJcblxyXG4vKipcclxuICogQXV0aG9yaXphdGlvbiBtaWRkbGV3YXJlIC0gY2hlY2tzIG11bHRpcGxlIHJvbGVzXHJcbiAqL1xyXG5jb25zdCBhdXRob3JpemUgPVxyXG4gICguLi5hbGxvd2VkUm9sZXMpID0+XHJcbiAgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICBpZiAoIXJlcS51c2VyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnTm90IGF1dGhlbnRpY2F0ZWQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhbGxvd2VkUm9sZXMubGVuZ3RoID4gMCAmJiAhYWxsb3dlZFJvbGVzLmluY2x1ZGVzKHJlcS51c2VyLnJvbGUpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZXh0KCk7XHJcbiAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHZlcmlmeVRva2VuLFxyXG4gIG9wdGlvbmFsQXV0aCxcclxuICByZXF1aXJlQWRtaW4sXHJcbiAgcmVxdWlyZVBlcm1pc3Npb24sXHJcbiAgYXV0aGVudGljYXRlLFxyXG4gIGF1dGhvcml6ZSxcclxuICBwcm90ZWN0OiB2ZXJpZnlUb2tlbiwgLy8gQWxpYXMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxZQUFZLENBQUM7QUFDakMsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFFekMsTUFBTUUsTUFBTSxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJLGlCQUFpQjs7QUFFMUQ7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsV0FBVyxHQUFHQSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ3RDLElBQUk7SUFDRixNQUFNQyxLQUFLLEdBQUdILEdBQUcsQ0FBQ0ksT0FBTyxDQUFDQyxhQUFhLEVBQUVDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFdEQsSUFBSSxDQUFDSCxLQUFLLEVBQUU7TUFDVixPQUFPRixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQUVDLE9BQU8sRUFBRSxLQUFLO1FBQUVDLEtBQUssRUFBRTtNQUFvQixDQUFDLENBQUM7SUFDN0U7O0lBRUE7SUFDQSxJQUFJQyxPQUFPO0lBQ1gsSUFB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