a28e11a0c947ddb58df09d7a4b91100e
/**
 * Multi-Factor Authentication Service
 * تطوير نظام المصادقة متعددة العوامل
 * 
 * Supports: TOTP (Google Authenticator), Email OTP, SMS OTP, Backup Codes
 */

const speakeasy = require('speakeasy');
const QRCode = require('qrcode');
const crypto = require('crypto');
const nodemailer = require('nodemailer');
class MFAService {
  constructor() {
    this.otpExpiration = 5 * 60 * 1000; // 5 minutes
    this.backupCodesCount = 10;
  }

  /**
   * Generate TOTP Secret and QR Code
   * إنشاء رمز TOTP وكود QR
   */
  async generateTOTPSecret(userEmail, appName = 'ERP System') {
    try {
      const secret = speakeasy.generateSecret({
        name: `${appName} (${userEmail})`,
        issuer: appName,
        length: 32
      });

      // Generate QR Code
      const qrCode = await QRCode.toDataURL(secret.otpauth_url);
      return {
        secret: secret.base32,
        qrCode,
        otpauth_url: secret.otpauth_url,
        manualEntryKey: secret.base32
      };
    } catch (error) {
      throw new Error(`Failed to generate TOTP secret: ${error.message}`);
    }
  }

  /**
   * Verify TOTP Token
   * التحقق من رمز TOTP
   */
  verifyTOTP(token, secret, window = 2) {
    try {
      const isValid = speakeasy.totp.verify({
        secret,
        encodingType: 'base32',
        token,
        window // Allow 30 seconds before and after
      });
      return isValid;
    } catch (error) {
      throw new Error(`Failed to verify TOTP token: ${error.message}`);
    }
  }

  /**
   * Generate Email OTP
   * توليد رمز OTP عبر البريد الإلكتروني
   */
  generateEmailOTP() {
    const otp = crypto.randomInt(100000, 999999).toString();
    const expiresAt = new Date(Date.now() + this.otpExpiration);
    return {
      code: otp,
      expiresAt,
      expiresIn: this.otpExpiration / 1000 // seconds
    };
  }

  /**
   * Generate SMS OTP
   * توليد رمز OTP عبر الرسائل النصية
   */
  generateSMSOTP() {
    const otp = crypto.randomInt(100000, 999999).toString();
    const expiresAt = new Date(Date.now() + this.otpExpiration);
    return {
      code: otp,
      expiresAt,
      expiresIn: this.otpExpiration / 1000
    };
  }

  /**
   * Verify OTP Code
   * التحقق من رمز OTP
   */
  verifyOTP(providedCode, storedCode, expiresAt) {
    try {
      // Check if OTP has expired
      if (new Date() > new Date(expiresAt)) {
        return {
          isValid: false,
          message: 'OTP has expired',
          error: 'EXPIRED'
        };
      }

      // Check if code matches (constant time comparison)
      const isValid = crypto.timingSafeEqual(Buffer.from(providedCode.toString()), Buffer.from(storedCode.toString()));
      return {
        isValid,
        message: isValid ? 'OTP verified successfully' : 'Invalid OTP',
        error: isValid ? null : 'INVALID_OTP'
      };
    } catch (_error) {
      return {
        isValid: false,
        message: 'OTP verification failed',
        error: 'VERIFICATION_FAILED'
      };
    }
  }

  /**
   * Generate Backup Codes
   * توليد أكواد احتياطية
   */
  generateBackupCodes(count = this.backupCodesCount) {
    const codes = [];
    for (let i = 0; i < count; i++) {
      const code = crypto.randomBytes(4).toString('hex').toUpperCase();
      codes.push(`${code.slice(0, 4)}-${code.slice(4)}`);
    }
    return codes;
  }

  /**
   * Hash Backup Code (for storage)
   * تشفير رمز احتياطي للتخزين
   */
  hashBackupCode(code) {
    return crypto.createHash('sha256').update(code).digest('hex');
  }

  /**
   * Verify Backup Code
   * التحقق من الرمز الاحتياطي
   */
  verifyBackupCode(providedCode, hashedCode) {
    const hash = crypto.createHash('sha256').update(providedCode).digest('hex');
    return crypto.timingSafeEqual(Buffer.from(hash), Buffer.from(hashedCode));
  }

  /**
   * Generate MFA Recovery Key
   * إنشاء مفتاح استرجاع MFA
   */
  generateRecoveryKey() {
    return crypto.randomBytes(16).toString('hex').toUpperCase();
  }

  /**
   * Create MFA Session
   * إنشاء جلسة MFA
   */
  createMFASession(userId, method = 'totp', metadata = {}) {
    const sessionId = crypto.randomBytes(16).toString('hex');
    const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes

    return {
      sessionId,
      userId,
      method,
      expiresAt,
      attempts: 0,
      maxAttempts: 5,
      metadata
    };
  }

  /**
   * Validate MFA Session
   * التحقق من جلسة MFA
   */
  validateMFASession(session) {
    if (!session) {
      return {
        isValid: false,
        message: 'MFA session not found'
      };
    }
    if (new Date() > new Date(session.expiresAt)) {
      return {
        isValid: false,
        message: 'MFA session has expired'
      };
    }
    if (session.attempts >= session.maxAttempts) {
      return {
        isValid: false,
        message: 'Maximum verification attempts exceeded'
      };
    }
    return {
      isValid: true,
      message: 'MFA session is valid',
      attemptsRemaining: session.maxAttempts - session.attempts
    };
  }

  /**
   * Generate Trusted Device Token
   * إنشاء رمز جهاز موثوق
   */
  generateTrustedDeviceToken(userId, deviceFingerprint) {
    const token = crypto.createHash('sha256').update(`${userId}:${deviceFingerprint}:${Date.now()}`).digest('hex');
    return {
      token,
      createdAt: new Date(),
      expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30 days
    };
  }

  /**
   * Get MFA Setup Guide
   * الحصول على دليل إعداد MFA
   */
  getMFASetupGuide() {
    return {
      totp: {
        name: 'Time-based One-Time Password (TOTP)',
        description: 'Use an authenticator app like Google Authenticator or Authy',
        steps: ['Download an authenticator app (Google Authenticator, Microsoft Authenticator, or Authy)', 'Scan the QR code displayed on the setup page', 'Enter the 6-digit code from your authenticator app', 'Save your backup codes in a safe place'],
        advantages: ['Works offline', 'No need for SMS or email', 'Widely supported']
      },
      email: {
        name: 'Email One-Time Password',
        description: 'Receive a code via email for verification',
        steps: ['When logging in, you will receive a 6-digit code via email', 'Enter the code in the verification prompt', 'The code expires after 5 minutes'],
        advantages: ['No additional app needed', 'Works on any device']
      },
      sms: {
        name: 'SMS One-Time Password',
        description: 'Receive a code via text message for verification',
        steps: ['When logging in, you will receive a 6-digit code via SMS', 'Enter the code in the verification prompt', 'The code expires after 5 minutes'],
        advantages: ['Works on any phone', 'Fast delivery']
      }
    };
  }

  /**
   * Calculate Security Score
   * حساب درجة الأمان
   */
  calculateSecurityScore(mfaMethods) {
    let score = 0;
    const maxScore = 100;
    if (mfaMethods.totp) score += 40;
    if (mfaMethods.email) score += 30;
    if (mfaMethods.sms) score += 20;
    if (mfaMethods.backupCodes && mfaMethods.backupCodes.length > 0) score += 10;
    return Math.min(score, maxScore);
  }

  /**
   * Generate MFA Audit Log
   * إنشاء سجل تدقيق MFA
   */
  createAuditLog(userId, action, status, metadata = {}) {
    return {
      userId,
      action,
      status,
      timestamp: new Date(),
      ipAddress: metadata.ipAddress || null,
      userAgent: metadata.userAgent || null,
      deviceInfo: metadata.deviceInfo || null
    };
  }
}
module.exports = new MFAService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzcGVha2Vhc3kiLCJyZXF1aXJlIiwiUVJDb2RlIiwiY3J5cHRvIiwibm9kZW1haWxlciIsIk1GQVNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsIm90cEV4cGlyYXRpb24iLCJiYWNrdXBDb2Rlc0NvdW50IiwiZ2VuZXJhdGVUT1RQU2VjcmV0IiwidXNlckVtYWlsIiwiYXBwTmFtZSIsInNlY3JldCIsImdlbmVyYXRlU2VjcmV0IiwibmFtZSIsImlzc3VlciIsImxlbmd0aCIsInFyQ29kZSIsInRvRGF0YVVSTCIsIm90cGF1dGhfdXJsIiwiYmFzZTMyIiwibWFudWFsRW50cnlLZXkiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsInZlcmlmeVRPVFAiLCJ0b2tlbiIsIndpbmRvdyIsImlzVmFsaWQiLCJ0b3RwIiwidmVyaWZ5IiwiZW5jb2RpbmdUeXBlIiwiZ2VuZXJhdGVFbWFpbE9UUCIsIm90cCIsInJhbmRvbUludCIsInRvU3RyaW5nIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsImNvZGUiLCJleHBpcmVzSW4iLCJnZW5lcmF0ZVNNU09UUCIsInZlcmlmeU9UUCIsInByb3ZpZGVkQ29kZSIsInN0b3JlZENvZGUiLCJ0aW1pbmdTYWZlRXF1YWwiLCJCdWZmZXIiLCJmcm9tIiwiX2Vycm9yIiwiZ2VuZXJhdGVCYWNrdXBDb2RlcyIsImNvdW50IiwiY29kZXMiLCJpIiwicmFuZG9tQnl0ZXMiLCJ0b1VwcGVyQ2FzZSIsInB1c2giLCJzbGljZSIsImhhc2hCYWNrdXBDb2RlIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsInZlcmlmeUJhY2t1cENvZGUiLCJoYXNoZWRDb2RlIiwiaGFzaCIsImdlbmVyYXRlUmVjb3ZlcnlLZXkiLCJjcmVhdGVNRkFTZXNzaW9uIiwidXNlcklkIiwibWV0aG9kIiwibWV0YWRhdGEiLCJzZXNzaW9uSWQiLCJhdHRlbXB0cyIsIm1heEF0dGVtcHRzIiwidmFsaWRhdGVNRkFTZXNzaW9uIiwic2Vzc2lvbiIsImF0dGVtcHRzUmVtYWluaW5nIiwiZ2VuZXJhdGVUcnVzdGVkRGV2aWNlVG9rZW4iLCJkZXZpY2VGaW5nZXJwcmludCIsImNyZWF0ZWRBdCIsImdldE1GQVNldHVwR3VpZGUiLCJkZXNjcmlwdGlvbiIsInN0ZXBzIiwiYWR2YW50YWdlcyIsImVtYWlsIiwic21zIiwiY2FsY3VsYXRlU2VjdXJpdHlTY29yZSIsIm1mYU1ldGhvZHMiLCJzY29yZSIsIm1heFNjb3JlIiwiYmFja3VwQ29kZXMiLCJNYXRoIiwibWluIiwiY3JlYXRlQXVkaXRMb2ciLCJhY3Rpb24iLCJzdGF0dXMiLCJ0aW1lc3RhbXAiLCJpcEFkZHJlc3MiLCJ1c2VyQWdlbnQiLCJkZXZpY2VJbmZvIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIm1mYVNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIE11bHRpLUZhY3RvciBBdXRoZW50aWNhdGlvbiBTZXJ2aWNlXHJcbiAqINiq2LfZiNmK2LEg2YbYuNin2YUg2KfZhNmF2LXYp9iv2YLYqSDZhdiq2LnYr9iv2Kkg2KfZhNi52YjYp9mF2YRcclxuICogXHJcbiAqIFN1cHBvcnRzOiBUT1RQIChHb29nbGUgQXV0aGVudGljYXRvciksIEVtYWlsIE9UUCwgU01TIE9UUCwgQmFja3VwIENvZGVzXHJcbiAqL1xyXG5cclxuY29uc3Qgc3BlYWtlYXN5ID0gcmVxdWlyZSgnc3BlYWtlYXN5Jyk7XHJcbmNvbnN0IFFSQ29kZSA9IHJlcXVpcmUoJ3FyY29kZScpO1xyXG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcclxuY29uc3Qgbm9kZW1haWxlciA9IHJlcXVpcmUoJ25vZGVtYWlsZXInKTtcclxuXHJcbmNsYXNzIE1GQVNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5vdHBFeHBpcmF0aW9uID0gNSAqIDYwICogMTAwMDsgLy8gNSBtaW51dGVzXHJcbiAgICB0aGlzLmJhY2t1cENvZGVzQ291bnQgPSAxMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIFRPVFAgU2VjcmV0IGFuZCBRUiBDb2RlXHJcbiAgICog2KXZhti02KfYoSDYsdmF2LIgVE9UUCDZiNmD2YjYryBRUlxyXG4gICAqL1xyXG4gIGFzeW5jIGdlbmVyYXRlVE9UUFNlY3JldCh1c2VyRW1haWwsIGFwcE5hbWUgPSAnRVJQIFN5c3RlbScpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHNlY3JldCA9IHNwZWFrZWFzeS5nZW5lcmF0ZVNlY3JldCh7XHJcbiAgICAgICAgbmFtZTogYCR7YXBwTmFtZX0gKCR7dXNlckVtYWlsfSlgLFxyXG4gICAgICAgIGlzc3VlcjogYXBwTmFtZSxcclxuICAgICAgICBsZW5ndGg6IDMyLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEdlbmVyYXRlIFFSIENvZGVcclxuICAgICAgY29uc3QgcXJDb2RlID0gYXdhaXQgUVJDb2RlLnRvRGF0YVVSTChzZWNyZXQub3RwYXV0aF91cmwpO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzZWNyZXQ6IHNlY3JldC5iYXNlMzIsXHJcbiAgICAgICAgcXJDb2RlLFxyXG4gICAgICAgIG90cGF1dGhfdXJsOiBzZWNyZXQub3RwYXV0aF91cmwsXHJcbiAgICAgICAgbWFudWFsRW50cnlLZXk6IHNlY3JldC5iYXNlMzIsXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZW5lcmF0ZSBUT1RQIHNlY3JldDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVyaWZ5IFRPVFAgVG9rZW5cclxuICAgKiDYp9mE2KrYrdmC2YIg2YXZhiDYsdmF2LIgVE9UUFxyXG4gICAqL1xyXG4gIHZlcmlmeVRPVFAodG9rZW4sIHNlY3JldCwgd2luZG93ID0gMikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IHNwZWFrZWFzeS50b3RwLnZlcmlmeSh7XHJcbiAgICAgICAgc2VjcmV0LFxyXG4gICAgICAgIGVuY29kaW5nVHlwZTogJ2Jhc2UzMicsXHJcbiAgICAgICAgdG9rZW4sXHJcbiAgICAgICAgd2luZG93LCAvLyBBbGxvdyAzMCBzZWNvbmRzIGJlZm9yZSBhbmQgYWZ0ZXJcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gaXNWYWxpZDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHZlcmlmeSBUT1RQIHRva2VuOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBFbWFpbCBPVFBcclxuICAgKiDYqtmI2YTZitivINix2YXYsiBPVFAg2LnYqNixINin2YTYqNix2YrYryDYp9mE2KXZhNmD2KrYsdmI2YbZilxyXG4gICAqL1xyXG4gIGdlbmVyYXRlRW1haWxPVFAoKSB7XHJcbiAgICBjb25zdCBvdHAgPSBjcnlwdG8ucmFuZG9tSW50KDEwMDAwMCwgOTk5OTk5KS50b1N0cmluZygpO1xyXG4gICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIHRoaXMub3RwRXhwaXJhdGlvbik7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY29kZTogb3RwLFxyXG4gICAgICBleHBpcmVzQXQsXHJcbiAgICAgIGV4cGlyZXNJbjogdGhpcy5vdHBFeHBpcmF0aW9uIC8gMTAwMCwgLy8gc2Vjb25kc1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIFNNUyBPVFBcclxuICAgKiDYqtmI2YTZitivINix2YXYsiBPVFAg2LnYqNixINin2YTYsdiz2KfYptmEINin2YTZhti12YrYqVxyXG4gICAqL1xyXG4gIGdlbmVyYXRlU01TT1RQKCkge1xyXG4gICAgY29uc3Qgb3RwID0gY3J5cHRvLnJhbmRvbUludCgxMDAwMDAsIDk5OTk5OSkudG9TdHJpbmcoKTtcclxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyB0aGlzLm90cEV4cGlyYXRpb24pO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGNvZGU6IG90cCxcclxuICAgICAgZXhwaXJlc0F0LFxyXG4gICAgICBleHBpcmVzSW46IHRoaXMub3RwRXhwaXJhdGlvbiAvIDEwMDAsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVyaWZ5IE9UUCBDb2RlXHJcbiAgICog2KfZhNiq2K3ZgtmCINmF2YYg2LHZhdiyIE9UUFxyXG4gICAqL1xyXG4gIHZlcmlmeU9UUChwcm92aWRlZENvZGUsIHN0b3JlZENvZGUsIGV4cGlyZXNBdCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2hlY2sgaWYgT1RQIGhhcyBleHBpcmVkXHJcbiAgICAgIGlmIChuZXcgRGF0ZSgpID4gbmV3IERhdGUoZXhwaXJlc0F0KSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdPVFAgaGFzIGV4cGlyZWQnLFxyXG4gICAgICAgICAgZXJyb3I6ICdFWFBJUkVEJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDaGVjayBpZiBjb2RlIG1hdGNoZXMgKGNvbnN0YW50IHRpbWUgY29tcGFyaXNvbilcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IGNyeXB0by50aW1pbmdTYWZlRXF1YWwoXHJcbiAgICAgICAgQnVmZmVyLmZyb20ocHJvdmlkZWRDb2RlLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgIEJ1ZmZlci5mcm9tKHN0b3JlZENvZGUudG9TdHJpbmcoKSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaXNWYWxpZCxcclxuICAgICAgICBtZXNzYWdlOiBpc1ZhbGlkID8gJ09UUCB2ZXJpZmllZCBzdWNjZXNzZnVsbHknIDogJ0ludmFsaWQgT1RQJyxcclxuICAgICAgICBlcnJvcjogaXNWYWxpZCA/IG51bGwgOiAnSU5WQUxJRF9PVFAnLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoX2Vycm9yKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ09UUCB2ZXJpZmljYXRpb24gZmFpbGVkJyxcclxuICAgICAgICBlcnJvcjogJ1ZFUklGSUNBVElPTl9GQUlMRUQnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgQmFja3VwIENvZGVzXHJcbiAgICog2KrZiNmE2YrYryDYo9mD2YjYp9ivINin2K3YqtmK2KfYt9mK2KlcclxuICAgKi9cclxuICBnZW5lcmF0ZUJhY2t1cENvZGVzKGNvdW50ID0gdGhpcy5iYWNrdXBDb2Rlc0NvdW50KSB7XHJcbiAgICBjb25zdCBjb2RlcyA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGNvZGUgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoNCkudG9TdHJpbmcoJ2hleCcpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIGNvZGVzLnB1c2goYCR7Y29kZS5zbGljZSgwLCA0KX0tJHtjb2RlLnNsaWNlKDQpfWApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvZGVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFzaCBCYWNrdXAgQ29kZSAoZm9yIHN0b3JhZ2UpXHJcbiAgICog2KrYtNmB2YrYsSDYsdmF2LIg2KfYrdiq2YrYp9i32Yog2YTZhNiq2K7YstmK2YZcclxuICAgKi9cclxuICBoYXNoQmFja3VwQ29kZShjb2RlKSB7XHJcbiAgICByZXR1cm4gY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShjb2RlKS5kaWdlc3QoJ2hleCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVyaWZ5IEJhY2t1cCBDb2RlXHJcbiAgICog2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNix2YXYsiDYp9mE2KfYrdiq2YrYp9i32YpcclxuICAgKi9cclxuICB2ZXJpZnlCYWNrdXBDb2RlKHByb3ZpZGVkQ29kZSwgaGFzaGVkQ29kZSkge1xyXG4gICAgY29uc3QgaGFzaCA9IGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUocHJvdmlkZWRDb2RlKS5kaWdlc3QoJ2hleCcpO1xyXG4gICAgcmV0dXJuIGNyeXB0by50aW1pbmdTYWZlRXF1YWwoXHJcbiAgICAgIEJ1ZmZlci5mcm9tKGhhc2gpLFxyXG4gICAgICBCdWZmZXIuZnJvbShoYXNoZWRDb2RlKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIE1GQSBSZWNvdmVyeSBLZXlcclxuICAgKiDYpdmG2LTYp9ihINmF2YHYqtin2K0g2KfYs9iq2LHYrNin2LkgTUZBXHJcbiAgICovXHJcbiAgZ2VuZXJhdGVSZWNvdmVyeUtleSgpIHtcclxuICAgIHJldHVybiBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKS50b1VwcGVyQ2FzZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIE1GQSBTZXNzaW9uXHJcbiAgICog2KXZhti02KfYoSDYrNmE2LPYqSBNRkFcclxuICAgKi9cclxuICBjcmVhdGVNRkFTZXNzaW9uKHVzZXJJZCwgbWV0aG9kID0gJ3RvdHAnLCBtZXRhZGF0YSA9IHt9KSB7XHJcbiAgICBjb25zdCBzZXNzaW9uSWQgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKTtcclxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyAxNSAqIDYwICogMTAwMCk7IC8vIDE1IG1pbnV0ZXNcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzZXNzaW9uSWQsXHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgbWV0aG9kLFxyXG4gICAgICBleHBpcmVzQXQsXHJcbiAgICAgIGF0dGVtcHRzOiAwLFxyXG4gICAgICBtYXhBdHRlbXB0czogNSxcclxuICAgICAgbWV0YWRhdGEsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGUgTUZBIFNlc3Npb25cclxuICAgKiDYp9mE2KrYrdmC2YIg2YXZhiDYrNmE2LPYqSBNRkFcclxuICAgKi9cclxuICB2YWxpZGF0ZU1GQVNlc3Npb24oc2Vzc2lvbikge1xyXG4gICAgaWYgKCFzZXNzaW9uKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ01GQSBzZXNzaW9uIG5vdCBmb3VuZCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG5ldyBEYXRlKCkgPiBuZXcgRGF0ZShzZXNzaW9uLmV4cGlyZXNBdCkpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAnTUZBIHNlc3Npb24gaGFzIGV4cGlyZWQnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzZXNzaW9uLmF0dGVtcHRzID49IHNlc3Npb24ubWF4QXR0ZW1wdHMpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAnTWF4aW11bSB2ZXJpZmljYXRpb24gYXR0ZW1wdHMgZXhjZWVkZWQnLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlzVmFsaWQ6IHRydWUsXHJcbiAgICAgIG1lc3NhZ2U6ICdNRkEgc2Vzc2lvbiBpcyB2YWxpZCcsXHJcbiAgICAgIGF0dGVtcHRzUmVtYWluaW5nOiBzZXNzaW9uLm1heEF0dGVtcHRzIC0gc2Vzc2lvbi5hdHRlbXB0cyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBUcnVzdGVkIERldmljZSBUb2tlblxyXG4gICAqINil2YbYtNin2KEg2LHZhdiyINis2YfYp9iyINmF2YjYq9mI2YJcclxuICAgKi9cclxuICBnZW5lcmF0ZVRydXN0ZWREZXZpY2VUb2tlbih1c2VySWQsIGRldmljZUZpbmdlcnByaW50KSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IGNyeXB0b1xyXG4gICAgICAuY3JlYXRlSGFzaCgnc2hhMjU2JylcclxuICAgICAgLnVwZGF0ZShgJHt1c2VySWR9OiR7ZGV2aWNlRmluZ2VycHJpbnR9OiR7RGF0ZS5ub3coKX1gKVxyXG4gICAgICAuZGlnZXN0KCdoZXgnKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b2tlbixcclxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAzMCBkYXlzXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IE1GQSBTZXR1cCBHdWlkZVxyXG4gICAqINin2YTYrdi12YjZhCDYudmE2Ykg2K/ZhNmK2YQg2KXYudiv2KfYryBNRkFcclxuICAgKi9cclxuICBnZXRNRkFTZXR1cEd1aWRlKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG90cDoge1xyXG4gICAgICAgIG5hbWU6ICdUaW1lLWJhc2VkIE9uZS1UaW1lIFBhc3N3b3JkIChUT1RQKScsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdVc2UgYW4gYXV0aGVudGljYXRvciBhcHAgbGlrZSBHb29nbGUgQXV0aGVudGljYXRvciBvciBBdXRoeScsXHJcbiAgICAgICAgc3RlcHM6IFtcclxuICAgICAgICAgICdEb3dubG9hZCBhbiBhdXRoZW50aWNhdG9yIGFwcCAoR29vZ2xlIEF1dGhlbnRpY2F0b3IsIE1pY3Jvc29mdCBBdXRoZW50aWNhdG9yLCBvciBBdXRoeSknLFxyXG4gICAgICAgICAgJ1NjYW4gdGhlIFFSIGNvZGUgZGlzcGxheWVkIG9uIHRoZSBzZXR1cCBwYWdlJyxcclxuICAgICAgICAgICdFbnRlciB0aGUgNi1kaWdpdCBjb2RlIGZyb20geW91ciBhdXRoZW50aWNhdG9yIGFwcCcsXHJcbiAgICAgICAgICAnU2F2ZSB5b3VyIGJhY2t1cCBjb2RlcyBpbiBhIHNhZmUgcGxhY2UnLFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgYWR2YW50YWdlczogW1xyXG4gICAgICAgICAgJ1dvcmtzIG9mZmxpbmUnLFxyXG4gICAgICAgICAgJ05vIG5lZWQgZm9yIFNNUyBvciBlbWFpbCcsXHJcbiAgICAgICAgICAnV2lkZWx5IHN1cHBvcnRlZCcsXHJcbiAgICAgICAgXSxcclxuICAgICAgfSxcclxuICAgICAgZW1haWw6IHtcclxuICAgICAgICBuYW1lOiAnRW1haWwgT25lLVRpbWUgUGFzc3dvcmQnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUmVjZWl2ZSBhIGNvZGUgdmlhIGVtYWlsIGZvciB2ZXJpZmljYXRpb24nLFxyXG4gICAgICAgIHN0ZXBzOiBbXHJcbiAgICAgICAgICAnV2hlbiBsb2dnaW5nIGluLCB5b3Ugd2lsbCByZWNlaXZlIGEgNi1kaWdpdCBjb2RlIHZpYSBlbWFpbCcsXHJcbiAgICAgICAgICAnRW50ZXIgdGhlIGNvZGUgaW4gdGhlIHZlcmlmaWNhdGlvbiBwcm9tcHQnLFxyXG4gICAgICAgICAgJ1RoZSBjb2RlIGV4cGlyZXMgYWZ0ZXIgNSBtaW51dGVzJyxcclxuICAgICAgICBdLFxyXG4gICAgICAgIGFkdmFudGFnZXM6IFtcclxuICAgICAgICAgICdObyBhZGRpdGlvbmFsIGFwcCBuZWVkZWQnLFxyXG4gICAgICAgICAgJ1dvcmtzIG9uIGFueSBkZXZpY2UnLFxyXG4gICAgICAgIF0sXHJcbiAgICAgIH0sXHJcbiAgICAgIHNtczoge1xyXG4gICAgICAgIG5hbWU6ICdTTVMgT25lLVRpbWUgUGFzc3dvcmQnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUmVjZWl2ZSBhIGNvZGUgdmlhIHRleHQgbWVzc2FnZSBmb3IgdmVyaWZpY2F0aW9uJyxcclxuICAgICAgICBzdGVwczogW1xyXG4gICAgICAgICAgJ1doZW4gbG9nZ2luZyBpbiwgeW91IHdpbGwgcmVjZWl2ZSBhIDYtZGlnaXQgY29kZSB2aWEgU01TJyxcclxuICAgICAgICAgICdFbnRlciB0aGUgY29kZSBpbiB0aGUgdmVyaWZpY2F0aW9uIHByb21wdCcsXHJcbiAgICAgICAgICAnVGhlIGNvZGUgZXhwaXJlcyBhZnRlciA1IG1pbnV0ZXMnLFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgYWR2YW50YWdlczogW1xyXG4gICAgICAgICAgJ1dvcmtzIG9uIGFueSBwaG9uZScsXHJcbiAgICAgICAgICAnRmFzdCBkZWxpdmVyeScsXHJcbiAgICAgICAgXSxcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxjdWxhdGUgU2VjdXJpdHkgU2NvcmVcclxuICAgKiDYrdiz2KfYqCDYr9ix2KzYqSDYp9mE2KPZhdin2YZcclxuICAgKi9cclxuICBjYWxjdWxhdGVTZWN1cml0eVNjb3JlKG1mYU1ldGhvZHMpIHtcclxuICAgIGxldCBzY29yZSA9IDA7XHJcbiAgICBjb25zdCBtYXhTY29yZSA9IDEwMDtcclxuXHJcbiAgICBpZiAobWZhTWV0aG9kcy50b3RwKSBzY29yZSArPSA0MDtcclxuICAgIGlmIChtZmFNZXRob2RzLmVtYWlsKSBzY29yZSArPSAzMDtcclxuICAgIGlmIChtZmFNZXRob2RzLnNtcykgc2NvcmUgKz0gMjA7XHJcbiAgICBpZiAobWZhTWV0aG9kcy5iYWNrdXBDb2RlcyAmJiBtZmFNZXRob2RzLmJhY2t1cENvZGVzLmxlbmd0aCA+IDApIHNjb3JlICs9IDEwO1xyXG5cclxuICAgIHJldHVybiBNYXRoLm1pbihzY29yZSwgbWF4U2NvcmUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgTUZBIEF1ZGl0IExvZ1xyXG4gICAqINil2YbYtNin2KEg2LPYrNmEINiq2K/ZgtmK2YIgTUZBXHJcbiAgICovXHJcbiAgY3JlYXRlQXVkaXRMb2codXNlcklkLCBhY3Rpb24sIHN0YXR1cywgbWV0YWRhdGEgPSB7fSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdXNlcklkLFxyXG4gICAgICBhY3Rpb24sXHJcbiAgICAgIHN0YXR1cyxcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICBpcEFkZHJlc3M6IG1ldGFkYXRhLmlwQWRkcmVzcyB8fCBudWxsLFxyXG4gICAgICB1c2VyQWdlbnQ6IG1ldGFkYXRhLnVzZXJBZ2VudCB8fCBudWxsLFxyXG4gICAgICBkZXZpY2VJbmZvOiBtZXRhZGF0YS5kZXZpY2VJbmZvIHx8IG51bGwsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgTUZBU2VydmljZSgpO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxTQUFTLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDdEMsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLE1BQU1FLE1BQU0sR0FBR0YsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQUNoQyxNQUFNRyxVQUFVLEdBQUdILE9BQU8sQ0FBQyxZQUFZLENBQUM7QUFFeEMsTUFBTUksVUFBVSxDQUFDO0VBQ2ZDLFdBQVdBLENBQUEsRUFBRztJQUNaLElBQUksQ0FBQ0MsYUFBYSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDcEMsSUFBSSxDQUFDQyxnQkFBZ0IsR0FBRyxFQUFFO0VBQzVCOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0VBQ0UsTUFBTUMsa0JBQWtCQSxDQUFDQyxTQUFTLEVBQUVDLE9BQU8sR0FBRyxZQUFZLEVBQUU7SUFD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