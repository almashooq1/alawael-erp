{"version":3,"names":["mongoose","require","dbConfig","development","url","process","env","MONGODB_URL","options","retryWrites","serverSelectionTimeoutMS","socketTimeoutMS","connectTimeoutMS","maxPoolSize","minPoolSize","production","MONGODB_PROD_URL","w","test","MONGODB_TEST_URL","NODE_ENV","config","connectDB","USE_MOCK_DB","console","log","connection","host","name","conn","connect","Object","keys","collections","length","error","message","exit","disconnectDB","disconnect","on","module","exports"],"sources":["database.js"],"sourcesContent":["// Database Configuration\r\n// ÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™\r\n\r\nconst mongoose = require('mongoose');\r\n\r\n// MongoDB Connection Configuration\r\nconst dbConfig = {\r\n  development: {\r\n    url: process.env.MONGODB_URL || 'mongodb://localhost:27017/erp_new',\r\n    options: {\r\n      retryWrites: false,\r\n      serverSelectionTimeoutMS: 16000,  // Increased from 5000ms to handle timeout issues\r\n      socketTimeoutMS: 45000,            // Connection socket timeout\r\n      connectTimeoutMS: 10000,           // Initial connection timeout\r\n      maxPoolSize: 10,                   // Connection pooling\r\n      minPoolSize: 5,\r\n    },\r\n  },\r\n  production: {\r\n    url: process.env.MONGODB_PROD_URL || 'mongodb+srv://user:password@cluster.mongodb.net/erp_prod',\r\n    options: {\r\n      retryWrites: true,\r\n      w: 'majority',\r\n      serverSelectionTimeoutMS: 30000,\r\n      socketTimeoutMS: 45000,\r\n      connectTimeoutMS: 10000,\r\n      maxPoolSize: 20,\r\n      minPoolSize: 10,\r\n    },\r\n  },\r\n  test: {\r\n    url: process.env.MONGODB_TEST_URL || 'mongodb://localhost:27017/erp_test',\r\n    options: {\r\n      retryWrites: false,\r\n      serverSelectionTimeoutMS: 16000,\r\n      socketTimeoutMS: 45000,\r\n      connectTimeoutMS: 10000,\r\n      maxPoolSize: 10,\r\n      minPoolSize: 5,\r\n    },\r\n  },\r\n};\r\n\r\n// Get current environment config\r\nconst env = process.env.NODE_ENV || 'development';\r\nconst config = dbConfig[env];\r\n\r\n// Connection function\r\nconst connectDB = async () => {\r\n  // Check if using Mock DB\r\n  if (process.env.USE_MOCK_DB === 'true') {\r\n    console.log(`\\nüì¶ Using Mock Database (Development Mode)`);\r\n    console.log(`   Environment: ${env}`);\r\n    console.log(`   ‚úÖ Mock DB ready - No MongoDB required\\n`);\r\n    return { connection: { host: 'mock', name: 'mock-db' } };\r\n  }\r\n\r\n  try {\r\n    console.log(`\\nüì° Connecting to MongoDB (${env})...`);\r\n    console.log(`   URL: ${config.url}`);\r\n\r\n    const conn = await mongoose.connect(config.url, config.options);\r\n\r\n    console.log(`‚úÖ MongoDB connected successfully`);\r\n    console.log(`   Host: ${conn.connection.host}`);\r\n    console.log(`   Database: ${conn.connection.name}`);\r\n    console.log(`   Collections: ${Object.keys(conn.connection.collections).length}\\n`);\r\n\r\n    return conn;\r\n  } catch (error) {\r\n    console.error(`\\n‚ùå MongoDB connection failed:`);\r\n    console.error(`   Error: ${error.message}`);\r\n    console.error(`\\nüí° TIP: Set USE_MOCK_DB=true in .env to use Mock DB\\n`);\r\n\r\n    process.exit(1);\r\n  }\r\n};\r\n\r\n// Disconnect function\r\nconst disconnectDB = async () => {\r\n  try {\r\n    await mongoose.disconnect();\r\n    console.log('‚úÖ MongoDB disconnected');\r\n  } catch (error) {\r\n    console.error('‚ùå Error disconnecting MongoDB:', error.message);\r\n  }\r\n};\r\n\r\n// Connection event listeners\r\nmongoose.connection.on('connected', () => {\r\n  console.log('üîó Mongoose connected');\r\n});\r\n\r\nmongoose.connection.on('disconnected', () => {\r\n  console.log('üîå Mongoose disconnected');\r\n});\r\n\r\nmongoose.connection.on('error', error => {\r\n  console.error('‚ùå Mongoose connection error:', error.message);\r\n});\r\n\r\nmodule.exports = {\r\n  connectDB,\r\n  disconnectDB,\r\n  mongoose,\r\n};\r\n"],"mappings":"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","ignoreList":[]}