{"version":3,"names":["fs","require","path","parse","stringify","CSVProcessor","constructor","options","delimiter","encoding","maxRowsPerChunk","importedData","errorLog","importCSV","filePath","Promise","resolve","reject","results","errors","lineNumber","parser","columns","skip_empty_lines","relax_quotes","on","record","read","Array","isArray","push","error","line","message","Error","success","recordCount","length","errorCount","data","importTime","Date","toISOString","stream","createReadStream","pipe","importCSVInChunks","chunkSize","chunks","currentChunk","totalRecords","chunkCount","exportToCSV","headers","Object","keys","stringifier","header","writeStream","createWriteStream","write","end","fileSize","statSync","size","exportTime","transformData","transformRules","map","index","transformed","field","rule","entries","hasOwnProperty","mapping","type","convertType","value","undefined","String","Number","parseInt","parseFloat","JSON","mapColumns","columnMapping","mapped","sourceCol","targetCol","filterData","filterFn","filter","sampleCSV","sampleSize","samples","count","destroy","getCSVInfo","stats","rowCount","Set","isFirstRow","col","add","fileSizeKB","toFixed","columnCount","from","createdAt","birthtime","modifiedAt","mtime","validateCSVStructure","expectedColumns","info","validation","valid","warnings","missingColumns","includes","extraColumns","join","getErrorLog","clearData","module","exports"],"sources":["CSVProcessor.js"],"sourcesContent":["/**\r\n * CSV Import/Export Service\r\n * Handles reading and writing CSV files for migration\r\n */\r\n\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst { parse } = require('csv-parse');\r\nconst { stringify } = require('csv-stringify');\r\n\r\nclass CSVProcessor {\r\n  constructor(options = {}) {\r\n    this.options = {\r\n      delimiter: options.delimiter || ',',\r\n      encoding: options.encoding || 'utf-8',\r\n      maxRowsPerChunk: options.maxRowsPerChunk || 1000,\r\n      ...options,\r\n    };\r\n\r\n    this.importedData = [];\r\n    this.errorLog = [];\r\n  }\r\n\r\n  /**\r\n   * Import CSV file\r\n   */\r\n  async importCSV(filePath, options = {}) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const results = [];\r\n        const errors = [];\r\n        let lineNumber = 1;\r\n\r\n        const parser = parse({\r\n          delimiter: options.delimiter || this.options.delimiter,\r\n          columns: options.columns === true,\r\n          skip_empty_lines: true,\r\n          relax_quotes: true,\r\n          encoding: this.options.encoding,\r\n        });\r\n\r\n        parser.on('readable', function () {\r\n          let record;\r\n          while ((record = parser.read()) !== null) {\r\n            try {\r\n              lineNumber++;\r\n              if (Array.isArray(record) && options.columns) {\r\n                // Record is already parsed as object\r\n                results.push(record);\r\n              } else {\r\n                results.push(record);\r\n              }\r\n            } catch (error) {\r\n              errors.push({\r\n                line: lineNumber,\r\n                error: error.message,\r\n                record,\r\n              });\r\n            }\r\n          }\r\n        });\r\n\r\n        parser.on('error', (error) => {\r\n          reject(new Error(`CSV parsing error: ${error.message}`));\r\n        });\r\n\r\n        parser.on('end', () => {\r\n          this.importedData = results;\r\n          resolve({\r\n            success: true,\r\n            recordCount: results.length,\r\n            errorCount: errors.length,\r\n            data: results,\r\n            errors,\r\n            filePath,\r\n            importTime: new Date().toISOString(),\r\n          });\r\n        });\r\n\r\n        const stream = fs.createReadStream(filePath, { encoding: this.options.encoding });\r\n        stream.pipe(parser);\r\n      } catch (error) {\r\n        reject(new Error(`Failed to import CSV: ${error.message}`));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Import CSV in chunks (for large files)\r\n   */\r\n  async importCSVInChunks(filePath, chunkSize = null) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const results = [];\r\n        const chunks = [];\r\n        const maxRowsPerChunk = chunkSize || this.options.maxRowsPerChunk;\r\n        let currentChunk = [];\r\n        let lineNumber = 0;\r\n\r\n        const parser = parse({\r\n          delimiter: this.options.delimiter,\r\n          columns: true,\r\n          skip_empty_lines: true,\r\n        });\r\n\r\n        parser.on('readable', function () {\r\n          let record;\r\n          while ((record = parser.read()) !== null) {\r\n            lineNumber++;\r\n            currentChunk.push(record);\r\n            results.push(record);\r\n\r\n            if (currentChunk.length >= maxRowsPerChunk) {\r\n              chunks.push([...currentChunk]);\r\n              currentChunk = [];\r\n            }\r\n          }\r\n        });\r\n\r\n        parser.on('error', (error) => {\r\n          reject(new Error(`CSV parsing error: ${error.message}`));\r\n        });\r\n\r\n        parser.on('end', () => {\r\n          if (currentChunk.length > 0) {\r\n            chunks.push(currentChunk);\r\n          }\r\n\r\n          resolve({\r\n            success: true,\r\n            totalRecords: lineNumber,\r\n            chunkCount: chunks.length,\r\n            chunks,\r\n            data: results,\r\n            importTime: new Date().toISOString(),\r\n          });\r\n        });\r\n\r\n        const stream = fs.createReadStream(filePath, { encoding: this.options.encoding });\r\n        stream.pipe(parser);\r\n      } catch (error) {\r\n        reject(new Error(`Failed to import CSV: ${error.message}`));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Export data to CSV\r\n   */\r\n  async exportToCSV(data, filePath, options = {}) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        if (!Array.isArray(data) || data.length === 0) {\r\n          reject(new Error('Data must be a non-empty array'));\r\n          return;\r\n        }\r\n\r\n        // Get column headers from first record\r\n        const headers = Object.keys(data[0]);\r\n\r\n        const stringifier = stringify({\r\n          header: true,\r\n          columns: options.columns || headers,\r\n          delimiter: options.delimiter || this.options.delimiter,\r\n          encoding: this.options.encoding,\r\n        });\r\n\r\n        stringifier.on('error', (error) => {\r\n          reject(new Error(`CSV stringify error: ${error.message}`));\r\n        });\r\n\r\n        const writeStream = fs.createWriteStream(filePath, {\r\n          encoding: this.options.encoding,\r\n        });\r\n\r\n        writeStream.on('error', (error) => {\r\n          reject(new Error(`File write error: ${error.message}`));\r\n        });\r\n\r\n        stringifier.pipe(writeStream);\r\n\r\n        for (const record of data) {\r\n          stringifier.write(record);\r\n        }\r\n\r\n        stringifier.end();\r\n\r\n        writeStream.on('finish', () => {\r\n          resolve({\r\n            success: true,\r\n            recordCount: data.length,\r\n            filePath,\r\n            fileSize: fs.statSync(filePath).size,\r\n            exportTime: new Date().toISOString(),\r\n          });\r\n        });\r\n      } catch (error) {\r\n        reject(new Error(`Failed to export CSV: ${error.message}`));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Transform CSV data before import\r\n   */\r\n  transformData(data, transformRules) {\r\n    return data.map((record, index) => {\r\n      const transformed = { ...record };\r\n\r\n      for (const [field, rule] of Object.entries(transformRules)) {\r\n        if (transformed.hasOwnProperty(field)) {\r\n          if (typeof rule === 'function') {\r\n            transformed[field] = rule(transformed[field], transformed, index);\r\n          } else if (rule.mapping) {\r\n            transformed[field] = rule.mapping[transformed[field]] || transformed[field];\r\n          } else if (rule.type) {\r\n            transformed[field] = this.convertType(transformed[field], rule.type);\r\n          }\r\n        }\r\n      }\r\n\r\n      return transformed;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Convert value to specified type\r\n   */\r\n  convertType(value, type) {\r\n    if (value === null || value === undefined || value === '') return null;\r\n\r\n    switch (type) {\r\n      case 'string':\r\n        return String(value);\r\n      case 'number':\r\n        return Number(value);\r\n      case 'integer':\r\n        return parseInt(value, 10);\r\n      case 'float':\r\n        return parseFloat(value);\r\n      case 'boolean':\r\n        return value === true || value === '1' || value === 'true' || value === 'yes';\r\n      case 'date':\r\n        return new Date(value).toISOString();\r\n      case 'json':\r\n        return JSON.parse(value);\r\n      default:\r\n        return value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Map CSV columns to target fields\r\n   */\r\n  mapColumns(data, columnMapping) {\r\n    return data.map((record) => {\r\n      const mapped = {};\r\n\r\n      for (const [sourceCol, targetCol] of Object.entries(columnMapping)) {\r\n        if (record.hasOwnProperty(sourceCol)) {\r\n          mapped[targetCol] = record[sourceCol];\r\n        }\r\n      }\r\n\r\n      return mapped;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Filter CSV data\r\n   */\r\n  filterData(data, filterFn) {\r\n    return data.filter(filterFn);\r\n  }\r\n\r\n  /**\r\n   * Sample CSV file (read first N rows)\r\n   */\r\n  async sampleCSV(filePath, sampleSize = 10) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const samples = [];\r\n        let count = 0;\r\n\r\n        const parser = parse({\r\n          delimiter: this.options.delimiter,\r\n          columns: true,\r\n          skip_empty_lines: true,\r\n        });\r\n\r\n        parser.on('readable', function () {\r\n          let record;\r\n          while ((record = parser.read()) !== null && count < sampleSize) {\r\n            samples.push(record);\r\n            count++;\r\n          }\r\n\r\n          if (count >= sampleSize) {\r\n            parser.destroy();\r\n          }\r\n        });\r\n\r\n        parser.on('error', (error) => {\r\n          reject(new Error(`CSV sampling error: ${error.message}`));\r\n        });\r\n\r\n        parser.on('end', () => {\r\n          resolve({\r\n            success: true,\r\n            sampleSize: samples.length,\r\n            samples,\r\n            filePath,\r\n          });\r\n        });\r\n\r\n        const stream = fs.createReadStream(filePath, { encoding: this.options.encoding });\r\n        stream.pipe(parser);\r\n      } catch (error) {\r\n        reject(new Error(`Failed to sample CSV: ${error.message}`));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get CSV file info\r\n   */\r\n  async getCSVInfo(filePath) {\r\n    try {\r\n      const stats = fs.statSync(filePath);\r\n      let rowCount = 0;\r\n      const columns = new Set();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const parser = parse({\r\n          delimiter: this.options.delimiter,\r\n          skip_empty_lines: true,\r\n        });\r\n\r\n        let isFirstRow = true;\r\n\r\n        parser.on('readable', function () {\r\n          let record;\r\n          while ((record = parser.read()) !== null) {\r\n            if (isFirstRow) {\r\n              for (const col of record) {\r\n                columns.add(col);\r\n              }\r\n              isFirstRow = false;\r\n            } else {\r\n              rowCount++;\r\n            }\r\n          }\r\n        });\r\n\r\n        parser.on('error', (error) => {\r\n          reject(new Error(`CSV info error: ${error.message}`));\r\n        });\r\n\r\n        parser.on('end', () => {\r\n          resolve({\r\n            filePath,\r\n            fileSize: stats.size,\r\n            fileSizeKB: (stats.size / 1024).toFixed(2),\r\n            rowCount,\r\n            columnCount: columns.size,\r\n            columns: Array.from(columns),\r\n            createdAt: stats.birthtime,\r\n            modifiedAt: stats.mtime,\r\n          });\r\n        });\r\n\r\n        const stream = fs.createReadStream(filePath, { encoding: this.options.encoding });\r\n        stream.pipe(parser);\r\n      });\r\n    } catch (error) {\r\n      throw new Error(`Failed to get CSV info: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate CSV structure\r\n   */\r\n  async validateCSVStructure(filePath, expectedColumns) {\r\n    try {\r\n      const info = await this.getCSVInfo(filePath);\r\n\r\n      const validation = {\r\n        valid: true,\r\n        errors: [],\r\n        warnings: [],\r\n      };\r\n\r\n      if (expectedColumns && Array.isArray(expectedColumns)) {\r\n        const missingColumns = expectedColumns.filter((col) => !info.columns.includes(col));\r\n        const extraColumns = info.columns.filter((col) => !expectedColumns.includes(col));\r\n\r\n        if (missingColumns.length > 0) {\r\n          validation.valid = false;\r\n          validation.errors.push(`Missing columns: ${missingColumns.join(', ')}`);\r\n        }\r\n\r\n        if (extraColumns.length > 0) {\r\n          validation.warnings.push(`Extra columns: ${extraColumns.join(', ')}`);\r\n        }\r\n      }\r\n\r\n      if (info.rowCount === 0) {\r\n        validation.valid = false;\r\n        validation.errors.push('CSV file is empty');\r\n      }\r\n\r\n      return { ...info, ...validation };\r\n    } catch (error) {\r\n      throw new Error(`CSV validation error: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get import errors\r\n   */\r\n  getErrorLog() {\r\n    return this.errorLog;\r\n  }\r\n\r\n  /**\r\n   * Clear import data\r\n   */\r\n  clearData() {\r\n    this.importedData = [];\r\n    this.errorLog = [];\r\n    return this;\r\n  }\r\n}\r\n\r\nmodule.exports = CSVProcessor;\r\n"],"mappings":"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","ignoreList":[]}