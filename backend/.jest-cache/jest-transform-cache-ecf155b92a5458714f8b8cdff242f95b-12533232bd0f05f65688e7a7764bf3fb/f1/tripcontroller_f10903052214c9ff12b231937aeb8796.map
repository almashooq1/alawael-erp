{"version":3,"names":["Trip","require","Vehicle","GPSTrackingService","TripController","createTrip","req","res","activeTrip","findOne","vehicle","body","status","json","success","message","passengers","findById","capacity","trip","save","data","error","getAllTrips","date","page","limit","query","startDate","Date","endDate","setDate","getDate","scheduledStartTime","$gte","$lt","trips","find","populate","skip","sort","count","countDocuments","totalPages","Math","ceil","total","currentPage","parseInt","getTripById","params","id","startTrip","actualStartTime","console","completeTrip","actualEndTime","updateGPS","longitude","latitude","speed","heading","location","type","coordinates","currentLocation","driverBehavior","arriveAtStop","stopNumber","stopProgress","departFromStop","passengersBoarded","passengersAlighted","addIncident","severity","description","incident","incidents","length","getActiveTrips","getTodayTrips","calculateDriverScore","score","behavior","analyzeBehavior","analysis","analyzeDrivingBehavior","gpsTracking","addFeedback","userId","rating","comment","feedback","push","user","totalRatings","sumRatings","reduce","sum","f","averageRating","getTripStatistics","stats","basic","tripNumber","route","routeName","vehicleNumber","driver","name","timing","scheduledStart","actualStart","scheduledEnd","scheduledEndTime","actualEnd","totalDuration","statistics","delayTime","distance","totalDistance","averageSpeed","scheduled","boarded","filter","p","missed","completionRate","speeding","speedingIncidents","harshBraking","harshBrakingCount","harshAcceleration","harshAccelerationCount","maxSpeed","idlingTime","fuel","consumed","fuelData","cost","efficiency","average","generateDriverReport","driverId","User","report","updateTrip","Object","assign","deleteTrip","findByIdAndDelete","cancelTrip","reason","cancellationReason","updatePassengers","current","listTripStatistics","inProgress","t","completed","cancelled","module","exports"],"sources":["trip.controller.js"],"sourcesContent":["/**\r\n * Trip Controller - إدارة الرحلات\r\n */\r\n\r\nconst Trip = require('../models/Trip');\r\nconst Vehicle = require('../models/Vehicle');\r\nconst GPSTrackingService = require('../services/gpsTracking.service');\r\n\r\nclass TripController {\r\n  /**\r\n   * إنشاء رحلة جديدة\r\n   * POST /api/trips\r\n   */\r\n  static async createTrip(req, res) {\r\n    try {\r\n      // Check if vehicle is already assigned to an in-progress trip\r\n      const activeTrip = await Trip.findOne({\r\n        vehicle: req.body.vehicle,\r\n        status: 'in_progress',\r\n      });\r\n\r\n      if (activeTrip) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Vehicle already assigned to an active trip',\r\n        });\r\n      }\r\n\r\n      // Check if passengers exceed vehicle capacity\r\n      if (req.body.passengers) {\r\n        const vehicle = await Vehicle.findById(req.body.vehicle);\r\n        \r\n        if (vehicle && req.body.passengers > vehicle.capacity) {\r\n          return res.status(400).json({\r\n            success: false,\r\n            message: `Passengers count (${req.body.passengers}) exceeds vehicle capacity (${vehicle.capacity})`,\r\n          });\r\n        }\r\n      }\r\n\r\n      const trip = new Trip(req.body);\r\n      await trip.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'تم إنشاء الرحلة بنجاح',\r\n        data: trip,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إنشاء الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب جميع الرحلات\r\n   * GET /api/trips\r\n   */\r\n  static async getAllTrips(req, res) {\r\n    try {\r\n      const { status, date, page = 1, limit = 20 } = req.query;\r\n      const query = {};\r\n\r\n      if (status) query.status = status;\r\n      if (date) {\r\n        const startDate = new Date(date);\r\n        const endDate = new Date(date);\r\n        endDate.setDate(endDate.getDate() + 1);\r\n        query.scheduledStartTime = { $gte: startDate, $lt: endDate };\r\n      }\r\n\r\n      const trips = await Trip.find(query)\r\n        .populate('route', 'routeName routeCode')\r\n        .populate('vehicle', 'vehicleNumber plateNumber')\r\n        .populate('driver', 'name email phone')\r\n        .limit(limit * 1)\r\n        .skip((page - 1) * limit)\r\n        .sort({ scheduledStartTime: -1 });\r\n\r\n      const count = await Trip.countDocuments(query);\r\n      const totalPages = Math.ceil(count / limit);\r\n\r\n      res.json({\r\n        success: true,\r\n        data: {\r\n          trips,\r\n          total: count,\r\n          currentPage: parseInt(page),\r\n          totalPages: totalPages,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب الرحلات',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب رحلة بواسطة ID\r\n   * GET /api/trips/:id\r\n   */\r\n  static async getTripById(req, res) {\r\n    try {\r\n      const trip = await Trip.findById(req.params.id)\r\n        .populate('route', 'routeName routeCode')\r\n        .populate('vehicle', 'vehicleNumber plateNumber')\r\n        .populate('driver', 'name email phone')\r\n        .populate('passengers.list.user', 'name email phone');\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      res.json({\r\n        success: true,\r\n        data: trip,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * بدء رحلة\r\n   * POST /api/trips/:id/start\r\n   */\r\n  static async startTrip(req, res) {\r\n    try {\r\n      const trip = await Trip.findById(req.params.id).populate('vehicle').populate('route');\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      if (trip.status !== 'scheduled') {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'لا يمكن بدء الرحلة - الحالة غير صحيحة',\r\n        });\r\n      }\r\n\r\n      trip.status = 'in_progress';\r\n      trip.actualStartTime = new Date();\r\n      await trip.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم بدء الرحلة بنجاح',\r\n        data: trip,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error starting trip:', error);\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل بدء الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنهاء رحلة\r\n   * POST /api/trips/:id/complete\r\n   */\r\n  static async completeTrip(req, res) {\r\n    try {\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      if (trip.status !== 'in_progress') {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'لا يمكن إنهاء الرحلة - الرحلة غير جارية',\r\n        });\r\n      }\r\n\r\n      trip.status = 'completed';\r\n      trip.actualEndTime = new Date();\r\n      await trip.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم إنهاء الرحلة بنجاح',\r\n        data: trip,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error completing trip:', error);\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إنهاء الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث موقع GPS للرحلة\r\n   * POST /api/trips/:id/gps\r\n   */\r\n  static async updateGPS(req, res) {\r\n    try {\r\n      const { longitude, latitude, speed, heading } = req.body;\r\n\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      const location = {\r\n        type: 'Point',\r\n        coordinates: [longitude, latitude],\r\n        speed,\r\n        heading,\r\n      };\r\n\r\n      await trip.updateGPS(location);\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث الموقع بنجاح',\r\n        data: {\r\n          currentLocation: location,\r\n          driverBehavior: trip.driverBehavior,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تحديث الموقع',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الوصول إلى محطة\r\n   * POST /api/trips/:id/arrive-stop\r\n   */\r\n  static async arriveAtStop(req, res) {\r\n    try {\r\n      const { stopNumber } = req.body;\r\n\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      await trip.arriveAtStop(stopNumber);\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تسجيل الوصول للمحطة بنجاح',\r\n        data: {\r\n          stopProgress: trip.stopProgress[stopNumber - 1],\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تسجيل الوصول للمحطة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * المغادرة من محطة\r\n   * POST /api/trips/:id/depart-stop\r\n   */\r\n  static async departFromStop(req, res) {\r\n    try {\r\n      const { stopNumber, passengersBoarded, passengersAlighted } = req.body;\r\n\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      await trip.departFromStop(stopNumber, passengersBoarded, passengersAlighted);\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تسجيل المغادرة من المحطة بنجاح',\r\n        data: {\r\n          stopProgress: trip.stopProgress[stopNumber - 1],\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تسجيل المغادرة من المحطة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إضافة حادث\r\n   * POST /api/trips/:id/incident\r\n   */\r\n  static async addIncident(req, res) {\r\n    try {\r\n      const { type, severity, description, location } = req.body;\r\n\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      await trip.addIncident({\r\n        type,\r\n        severity,\r\n        description,\r\n        location: {\r\n          type: 'Point',\r\n          coordinates: location.coordinates,\r\n        },\r\n      });\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'تم إضافة الحادث بنجاح',\r\n        data: {\r\n          incident: trip.incidents[trip.incidents.length - 1],\r\n          status: trip.status,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إضافة الحادث',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب الرحلات النشطة\r\n   * GET /api/trips/active\r\n   */\r\n  static async getActiveTrips(req, res) {\r\n    try {\r\n      const trips = await Trip.getActiveTrips();\r\n\r\n      res.json({\r\n        success: true,\r\n        data: trips,\r\n        count: trips.length,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب الرحلات النشطة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب رحلات اليوم\r\n   * GET /api/trips/today\r\n   */\r\n  static async getTodayTrips(req, res) {\r\n    try {\r\n      const trips = await Trip.getTodayTrips();\r\n\r\n      res.json({\r\n        success: true,\r\n        data: trips,\r\n        count: trips.length,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب رحلات اليوم',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حساب تقييم سلوك السائق\r\n   * GET /api/trips/:id/driver-score\r\n   */\r\n  static async calculateDriverScore(req, res) {\r\n    try {\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      await trip.calculateDriverScore();\r\n\r\n      res.json({\r\n        success: true,\r\n        data: {\r\n          score: trip.driverBehavior.score,\r\n          behavior: trip.driverBehavior,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل حساب تقييم السائق',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحليل سلوك السائق\r\n   * GET /api/trips/:id/behavior-analysis\r\n   */\r\n  static async analyzeBehavior(req, res) {\r\n    try {\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      const analysis = GPSTrackingService.analyzeDrivingBehavior(trip, trip.gpsTracking);\r\n\r\n      res.json({\r\n        success: true,\r\n        data: analysis,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل تحليل سلوك السائق',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إضافة تقييم للرحلة\r\n   * POST /api/trips/:id/feedback\r\n   */\r\n  static async addFeedback(req, res) {\r\n    try {\r\n      const { userId, rating, comment } = req.body;\r\n\r\n      const trip = await Trip.findById(req.params.id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      trip.feedback.push({\r\n        user: userId,\r\n        rating,\r\n        comment,\r\n        date: new Date(),\r\n      });\r\n\r\n      // تحديث متوسط التقييم\r\n      const totalRatings = trip.feedback.length;\r\n      const sumRatings = trip.feedback.reduce((sum, f) => sum + f.rating, 0);\r\n      trip.averageRating = sumRatings / totalRatings;\r\n      trip.totalRatings = totalRatings;\r\n\r\n      await trip.save();\r\n\r\n      res.status(201).json({\r\n        success: true,\r\n        message: 'تم إضافة التقييم بنجاح',\r\n        data: {\r\n          averageRating: trip.averageRating,\r\n          totalRatings: trip.totalRatings,\r\n        },\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إضافة التقييم',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إحصائيات الرحلة\r\n   * GET /api/trips/:id/statistics\r\n   */\r\n  static async getTripStatistics(req, res) {\r\n    try {\r\n      const trip = await Trip.findById(req.params.id)\r\n        .populate('route', 'routeName')\r\n        .populate('vehicle', 'vehicleNumber')\r\n        .populate('driver', 'name');\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      const stats = {\r\n        basic: {\r\n          tripNumber: trip.tripNumber,\r\n          status: trip.status,\r\n          route: trip.route?.routeName,\r\n          vehicle: trip.vehicle?.vehicleNumber,\r\n          driver: trip.driver?.name,\r\n        },\r\n        timing: {\r\n          scheduledStart: trip.scheduledStartTime,\r\n          actualStart: trip.actualStartTime,\r\n          scheduledEnd: trip.scheduledEndTime,\r\n          actualEnd: trip.actualEndTime,\r\n          totalDuration: trip.statistics.totalDuration,\r\n          delayTime: trip.statistics.delayTime,\r\n        },\r\n        distance: {\r\n          total: trip.statistics.totalDistance,\r\n          averageSpeed: trip.statistics.averageSpeed,\r\n        },\r\n        passengers: {\r\n          scheduled: trip.passengers.length,\r\n          boarded: trip.passengers.filter(p => p.status === 'boarded').length,\r\n          missed: trip.passengers.filter(p => p.status === 'missed').length,\r\n          completionRate: trip.statistics.completionRate,\r\n        },\r\n        driverBehavior: {\r\n          score: trip.driverBehavior.score,\r\n          speeding: trip.driverBehavior.speedingIncidents,\r\n          harshBraking: trip.driverBehavior.harshBrakingCount,\r\n          harshAcceleration: trip.driverBehavior.harshAccelerationCount,\r\n          maxSpeed: trip.driverBehavior.maxSpeed,\r\n          idlingTime: trip.driverBehavior.idlingTime,\r\n        },\r\n        fuel: {\r\n          consumed: trip.fuelData.consumed,\r\n          cost: trip.fuelData.cost,\r\n          efficiency: trip.fuelData.efficiency,\r\n        },\r\n        incidents: trip.incidents.length,\r\n        rating: {\r\n          average: trip.averageRating,\r\n          total: trip.totalRatings,\r\n        },\r\n      };\r\n\r\n      res.json({\r\n        success: true,\r\n        data: stats,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب إحصائيات الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنشاء تقرير سلوك السائق\r\n   * POST /api/trips/driver-report\r\n   */\r\n  static async generateDriverReport(req, res) {\r\n    try {\r\n      const { driverId, startDate, endDate } = req.body;\r\n\r\n      const User = require('../models/User');\r\n      const driver = await User.findById(driverId);\r\n\r\n      if (!driver) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'السائق غير موجود',\r\n        });\r\n      }\r\n\r\n      const report = await GPSTrackingService.generateDriverReport(\r\n        driver,\r\n        new Date(startDate),\r\n        new Date(endDate)\r\n      );\r\n\r\n      res.json({\r\n        success: true,\r\n        data: report,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل إنشاء تقرير السائق',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث رحلة\r\n   * PUT /api/trips/:id\r\n   */\r\n  static async updateTrip(req, res) {\r\n    try {\r\n      const { id } = req.params;\r\n      const trip = await Trip.findById(id);\r\n\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      // Check if trip is completed\r\n      if (trip.status === 'completed') {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Cannot update completed trip',\r\n        });\r\n      }\r\n\r\n      // Update the trip\r\n      Object.assign(trip, req.body);\r\n      await trip.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث الرحلة بنجاح',\r\n        data: trip,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تحديث الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حذف رحلة\r\n   * DELETE /api/trips/:id\r\n   */\r\n  static async deleteTrip(req, res) {\r\n    try {\r\n      const { id } = req.params;\r\n      \r\n      // يمكن حذف الرحلات المجدولة فقط\r\n      const trip = await Trip.findById(id);\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      if (trip.status !== 'scheduled') {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'Cannot delete trip - only scheduled trips can be deleted',\r\n        });\r\n      }\r\n\r\n      await Trip.findByIdAndDelete(id);\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم حذف الرحلة بنجاح',\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل حذف الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إلغاء رحلة\r\n   * POST /api/trips/:id/cancel\r\n   */\r\n  static async cancelTrip(req, res) {\r\n    try {\r\n      const { id } = req.params;\r\n      const { reason } = req.body;\r\n\r\n      const trip = await Trip.findById(id);\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      if (trip.status === 'completed') {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'لا يمكن إلغاء رحلة مكتملة',\r\n        });\r\n      }\r\n\r\n      trip.status = 'cancelled';\r\n      trip.cancellationReason = reason;\r\n      await trip.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم إلغاء الرحلة بنجاح',\r\n        data: trip,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل إلغاء الرحلة',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث عدد الركاب\r\n   * PATCH /api/trips/:id/passengers\r\n   */\r\n  static async updatePassengers(req, res) {\r\n    try {\r\n      const { id } = req.params;\r\n      const { current } = req.body;\r\n\r\n      const trip = await Trip.findById(id);\r\n      if (!trip) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: 'الرحلة غير موجودة',\r\n        });\r\n      }\r\n\r\n      // التحقق من السعة\r\n      const capacity = trip.passengers?.capacity || 30;\r\n      if (current > capacity) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'عدد الركاب يتجاوز سعة المركبة',\r\n        });\r\n      }\r\n\r\n      // تحديث عدد الركاب الفعليين\r\n      if (!trip.passengers) {\r\n        trip.passengers = {};\r\n      }\r\n      trip.passengers.current = current;\r\n      trip.passengers.capacity = capacity;\r\n      \r\n      await trip.save();\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم تحديث عدد الركاب بنجاح',\r\n        data: trip,\r\n      });\r\n    } catch (error) {\r\n      res.status(400).json({\r\n        success: false,\r\n        message: 'فشل تحديث عدد الركاب',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * جلب إحصائيات الرحلات\r\n   * GET /api/trips/statistics\r\n   */\r\n  static async listTripStatistics(req, res) {\r\n    try {\r\n      const trips = await Trip.find();\r\n\r\n      const statistics = {\r\n        total: trips.length,\r\n        inProgress: trips.filter(t => t.status === 'in_progress').length,\r\n        scheduled: trips.filter(t => t.status === 'scheduled').length,\r\n        completed: trips.filter(t => t.status === 'completed').length,\r\n        cancelled: trips.filter(t => t.status === 'cancelled').length,\r\n      };\r\n\r\n      res.json({\r\n        success: true,\r\n        message: 'تم جلب إحصائيات الرحلات بنجاح',\r\n        data: statistics,\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: 'فشل جلب إحصائيات الرحلات',\r\n        error: error.message,\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = TripController;\r\n"],"mappings":"AAAA;AACA;AACA;;AAEA,MAAMA,IAAI,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AACtC,MAAMC,OAAO,GAAGD,OAAO,CAAC,mBAAmB,CAAC;AAC5C,MAAME,kBAAkB,GAAGF,OAAO,CAAC,iCAAiC,CAAC;AAErE,MAAMG,cAAc,CAAC;EACnB;AACF;AACA;AACA;EACE,aAAaC,UAAUA,CAACC,GAAG,EAAEC,GAAG,EAAE;IAChC,IAAI;MACF;MACA,MAAMC,UAAU,GAAG,MAAMR,IAAI,CAACS,OAAO,CAAC;QACpCC,OAAO,EAAEJ,GAAG,CAACK,IAAI,CAACD,OAAO;QACzBE,MAAM,EAAE;MACV,CAAC,CAAC;MAEF,IAAIJ,UAAU,EAAE;QACd,OAAOD,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;;MAEA;MACA,IAAIT,GAAG,CAACK,IAAI,CAACK,UAAU,EAAE;QACvB,MAAMN,OAAO,GAAG,MAAMR,OAAO,CAACe,QAAQ,CAACX,GAAG,CAACK,IAAI,CAACD,OAAO,CAAC;QAExD,IAAIA,OAAO,IAAIJ,GAAG,CAACK,IAAI,CAACK,UAAU,GAAGN,OAAO,CAACQ,QAAQ,EAAE;UACrD,OAAOX,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;YAC1BC,OAAO,EAAE,KAAK;YACdC,OAAO,EAAE,qBAAqBT,GAAG,CAACK,IAAI,CAACK,UAAU,+BAA+BN,OAAO,CAACQ,QAAQ;UAClG,CAAC,CAAC;QACJ;MACF;MAEA,MAAMC,IAAI,GAAG,IAAInB,IAAI,CAACM,GAAG,CAACK,IAAI,CAAC;MAC/B,MAAMQ,IAAI,CAACC,IAAI,CAAC,CAAC;MAEjBb,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,uBAAuB;QAChCM,IAAI,EAAEF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,kBAAkB;QAC3BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAaQ,WAAWA,CAACjB,GAAG,EAAEC,GAAG,EAAE;IACjC,IAAI;MACF,MAAM;QAAEK,MAAM;QAAEY,IAAI;QAAEC,IAAI,GAAG,CAAC;QAAEC,KAAK,GAAG;MAAG,CAAC,GAAGpB,GAAG,CAACqB,KAAK;MACxD,MAAMA,KAAK,GAAG,CAAC,CAAC;MAEhB,IAAIf,MAAM,EAAEe,KAAK,CAACf,MAAM,GAAGA,MAAM;MACjC,IAAIY,IAAI,EAAE;QACR,MAAMI,SAAS,GAAG,IAAIC,IAAI,CAACL,IAAI,CAAC;QAChC,MAAMM,OAAO,GAAG,IAAID,IAAI,CAACL,IAAI,CAAC;QAC9BM,OAAO,CAACC,OAAO,CAACD,OAAO,CAACE,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;QACtCL,KAAK,CAACM,kBAAkB,GAAG;UAAEC,IAAI,EAAEN,SAAS;UAAEO,GAAG,EAAEL;QAAQ,CAAC;MAC9D;MAEA,MAAMM,KAAK,GAAG,MAAMpC,IAAI,CAACqC,IAAI,CAACV,KAAK,CAAC,CACjCW,QAAQ,CAAC,OAAO,EAAE,qBAAqB,CAAC,CACxCA,QAAQ,CAAC,SAAS,EAAE,2BAA2B,CAAC,CAChDA,QAAQ,CAAC,QAAQ,EAAE,kBAAkB,CAAC,CACtCZ,KAAK,CAACA,KAAK,GAAG,CAAC,CAAC,CAChBa,IAAI,CAAC,CAACd,IAAI,GAAG,CAAC,IAAIC,KAAK,CAAC,CACxBc,IAAI,CAAC;QAAEP,kBAAkB,EAAE,CAAC;MAAE,CAAC,CAAC;MAEnC,MAAMQ,KAAK,GAAG,MAAMzC,IAAI,CAAC0C,cAAc,CAACf,KAAK,CAAC;MAC9C,MAAMgB,UAAU,GAAGC,IAAI,CAACC,IAAI,CAACJ,KAAK,GAAGf,KAAK,CAAC;MAE3CnB,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAE;UACJe,KAAK;UACLU,KAAK,EAAEL,KAAK;UACZM,WAAW,EAAEC,QAAQ,CAACvB,IAAI,CAAC;UAC3BkB,UAAU,EAAEA;QACd;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOrB,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,iBAAiB;QAC1BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAakC,WAAWA,CAAC3C,GAAG,EAAEC,GAAG,EAAE;IACjC,IAAI;MACF,MAAMY,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC,CAC5Cb,QAAQ,CAAC,OAAO,EAAE,qBAAqB,CAAC,CACxCA,QAAQ,CAAC,SAAS,EAAE,2BAA2B,CAAC,CAChDA,QAAQ,CAAC,QAAQ,EAAE,kBAAkB,CAAC,CACtCA,QAAQ,CAAC,sBAAsB,EAAE,kBAAkB,CAAC;MAEvD,IAAI,CAACnB,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEAR,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAEF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,gBAAgB;QACzBO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAaqC,SAASA,CAAC9C,GAAG,EAAEC,GAAG,EAAE;IAC/B,IAAI;MACF,MAAMY,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC,CAACb,QAAQ,CAAC,SAAS,CAAC,CAACA,QAAQ,CAAC,OAAO,CAAC;MAErF,IAAI,CAACnB,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,IAAII,IAAI,CAACP,MAAM,KAAK,WAAW,EAAE;QAC/B,OAAOL,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEAI,IAAI,CAACP,MAAM,GAAG,aAAa;MAC3BO,IAAI,CAACkC,eAAe,GAAG,IAAIxB,IAAI,CAAC,CAAC;MACjC,MAAMV,IAAI,CAACC,IAAI,CAAC,CAAC;MAEjBb,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,qBAAqB;QAC9BM,IAAI,EAAEF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdgC,OAAO,CAAChC,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;MAC5Cf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,gBAAgB;QACzBO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAawC,YAAYA,CAACjD,GAAG,EAAEC,GAAG,EAAE;IAClC,IAAI;MACF,MAAMY,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,IAAII,IAAI,CAACP,MAAM,KAAK,aAAa,EAAE;QACjC,OAAOL,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEAI,IAAI,CAACP,MAAM,GAAG,WAAW;MACzBO,IAAI,CAACqC,aAAa,GAAG,IAAI3B,IAAI,CAAC,CAAC;MAC/B,MAAMV,IAAI,CAACC,IAAI,CAAC,CAAC;MAEjBb,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,uBAAuB;QAChCM,IAAI,EAAEF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdgC,OAAO,CAAChC,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9Cf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,kBAAkB;QAC3BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAa0C,SAASA,CAACnD,GAAG,EAAEC,GAAG,EAAE;IAC/B,IAAI;MACF,MAAM;QAAEmD,SAAS;QAAEC,QAAQ;QAAEC,KAAK;QAAEC;MAAQ,CAAC,GAAGvD,GAAG,CAACK,IAAI;MAExD,MAAMQ,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAM+C,QAAQ,GAAG;QACfC,IAAI,EAAE,OAAO;QACbC,WAAW,EAAE,CAACN,SAAS,EAAEC,QAAQ,CAAC;QAClCC,KAAK;QACLC;MACF,CAAC;MAED,MAAM1C,IAAI,CAACsC,SAAS,CAACK,QAAQ,CAAC;MAE9BvD,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,uBAAuB;QAChCM,IAAI,EAAE;UACJ4C,eAAe,EAAEH,QAAQ;UACzBI,cAAc,EAAE/C,IAAI,CAAC+C;QACvB;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO5C,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,kBAAkB;QAC3BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAaoD,YAAYA,CAAC7D,GAAG,EAAEC,GAAG,EAAE;IAClC,IAAI;MACF,MAAM;QAAE6D;MAAW,CAAC,GAAG9D,GAAG,CAACK,IAAI;MAE/B,MAAMQ,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMI,IAAI,CAACgD,YAAY,CAACC,UAAU,CAAC;MAEnC7D,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,8BAA8B;QACvCM,IAAI,EAAE;UACJgD,YAAY,EAAElD,IAAI,CAACkD,YAAY,CAACD,UAAU,GAAG,CAAC;QAChD;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO9C,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,yBAAyB;QAClCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAauD,cAAcA,CAAChE,GAAG,EAAEC,GAAG,EAAE;IACpC,IAAI;MACF,MAAM;QAAE6D,UAAU;QAAEG,iBAAiB;QAAEC;MAAmB,CAAC,GAAGlE,GAAG,CAACK,IAAI;MAEtE,MAAMQ,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMI,IAAI,CAACmD,cAAc,CAACF,UAAU,EAAEG,iBAAiB,EAAEC,kBAAkB,CAAC;MAE5EjE,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,mCAAmC;QAC5CM,IAAI,EAAE;UACJgD,YAAY,EAAElD,IAAI,CAACkD,YAAY,CAACD,UAAU,GAAG,CAAC;QAChD;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO9C,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,8BAA8B;QACvCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAa0D,WAAWA,CAACnE,GAAG,EAAEC,GAAG,EAAE;IACjC,IAAI;MACF,MAAM;QAAEwD,IAAI;QAAEW,QAAQ;QAAEC,WAAW;QAAEb;MAAS,CAAC,GAAGxD,GAAG,CAACK,IAAI;MAE1D,MAAMQ,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMI,IAAI,CAACsD,WAAW,CAAC;QACrBV,IAAI;QACJW,QAAQ;QACRC,WAAW;QACXb,QAAQ,EAAE;UACRC,IAAI,EAAE,OAAO;UACbC,WAAW,EAAEF,QAAQ,CAACE;QACxB;MACF,CAAC,CAAC;MAEFzD,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,uBAAuB;QAChCM,IAAI,EAAE;UACJuD,QAAQ,EAAEzD,IAAI,CAAC0D,SAAS,CAAC1D,IAAI,CAAC0D,SAAS,CAACC,MAAM,GAAG,CAAC,CAAC;UACnDlE,MAAM,EAAEO,IAAI,CAACP;QACf;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOU,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,kBAAkB;QAC3BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAagE,cAAcA,CAACzE,GAAG,EAAEC,GAAG,EAAE;IACpC,IAAI;MACF,MAAM6B,KAAK,GAAG,MAAMpC,IAAI,CAAC+E,cAAc,CAAC,CAAC;MAEzCxE,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAEe,KAAK;QACXK,KAAK,EAAEL,KAAK,CAAC0C;MACf,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOxD,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,wBAAwB;QACjCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAaiE,aAAaA,CAAC1E,GAAG,EAAEC,GAAG,EAAE;IACnC,IAAI;MACF,MAAM6B,KAAK,GAAG,MAAMpC,IAAI,CAACgF,aAAa,CAAC,CAAC;MAExCzE,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAEe,KAAK;QACXK,KAAK,EAAEL,KAAK,CAAC0C;MACf,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOxD,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,qBAAqB;QAC9BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAakE,oBAAoBA,CAAC3E,GAAG,EAAEC,GAAG,EAAE;IAC1C,IAAI;MACF,MAAMY,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMI,IAAI,CAAC8D,oBAAoB,CAAC,CAAC;MAEjC1E,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAE;UACJ6D,KAAK,EAAE/D,IAAI,CAAC+C,cAAc,CAACgB,KAAK;UAChCC,QAAQ,EAAEhE,IAAI,CAAC+C;QACjB;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO5C,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,uBAAuB;QAChCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAaqE,eAAeA,CAAC9E,GAAG,EAAEC,GAAG,EAAE;IACrC,IAAI;MACF,MAAMY,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMsE,QAAQ,GAAGlF,kBAAkB,CAACmF,sBAAsB,CAACnE,IAAI,EAAEA,IAAI,CAACoE,WAAW,CAAC;MAElFhF,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAEgE;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO/D,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,uBAAuB;QAChCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAayE,WAAWA,CAAClF,GAAG,EAAEC,GAAG,EAAE;IACjC,IAAI;MACF,MAAM;QAAEkF,MAAM;QAAEC,MAAM;QAAEC;MAAQ,CAAC,GAAGrF,GAAG,CAACK,IAAI;MAE5C,MAAMQ,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC;MAE/C,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEAI,IAAI,CAACyE,QAAQ,CAACC,IAAI,CAAC;QACjBC,IAAI,EAAEL,MAAM;QACZC,MAAM;QACNC,OAAO;QACPnE,IAAI,EAAE,IAAIK,IAAI,CAAC;MACjB,CAAC,CAAC;;MAEF;MACA,MAAMkE,YAAY,GAAG5E,IAAI,CAACyE,QAAQ,CAACd,MAAM;MACzC,MAAMkB,UAAU,GAAG7E,IAAI,CAACyE,QAAQ,CAACK,MAAM,CAAC,CAACC,GAAG,EAAEC,CAAC,KAAKD,GAAG,GAAGC,CAAC,CAACT,MAAM,EAAE,CAAC,CAAC;MACtEvE,IAAI,CAACiF,aAAa,GAAGJ,UAAU,GAAGD,YAAY;MAC9C5E,IAAI,CAAC4E,YAAY,GAAGA,YAAY;MAEhC,MAAM5E,IAAI,CAACC,IAAI,CAAC,CAAC;MAEjBb,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,wBAAwB;QACjCM,IAAI,EAAE;UACJ+E,aAAa,EAAEjF,IAAI,CAACiF,aAAa;UACjCL,YAAY,EAAE5E,IAAI,CAAC4E;QACrB;MACF,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOzE,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,mBAAmB;QAC5BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAasF,iBAAiBA,CAAC/F,GAAG,EAAEC,GAAG,EAAE;IACvC,IAAI;MACF,MAAMY,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACX,GAAG,CAAC4C,MAAM,CAACC,EAAE,CAAC,CAC5Cb,QAAQ,CAAC,OAAO,EAAE,WAAW,CAAC,CAC9BA,QAAQ,CAAC,SAAS,EAAE,eAAe,CAAC,CACpCA,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC;MAE7B,IAAI,CAACnB,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMuF,KAAK,GAAG;QACZC,KAAK,EAAE;UACLC,UAAU,EAAErF,IAAI,CAACqF,UAAU;UAC3B5F,MAAM,EAAEO,IAAI,CAACP,MAAM;UACnB6F,KAAK,EAAEtF,IAAI,CAACsF,KAAK,EAAEC,SAAS;UAC5BhG,OAAO,EAAES,IAAI,CAACT,OAAO,EAAEiG,aAAa;UACpCC,MAAM,EAAEzF,IAAI,CAACyF,MAAM,EAAEC;QACvB,CAAC;QACDC,MAAM,EAAE;UACNC,cAAc,EAAE5F,IAAI,CAACc,kBAAkB;UACvC+E,WAAW,EAAE7F,IAAI,CAACkC,eAAe;UACjC4D,YAAY,EAAE9F,IAAI,CAAC+F,gBAAgB;UACnCC,SAAS,EAAEhG,IAAI,CAACqC,aAAa;UAC7B4D,aAAa,EAAEjG,IAAI,CAACkG,UAAU,CAACD,aAAa;UAC5CE,SAAS,EAAEnG,IAAI,CAACkG,UAAU,CAACC;QAC7B,CAAC;QACDC,QAAQ,EAAE;UACRzE,KAAK,EAAE3B,IAAI,CAACkG,UAAU,CAACG,aAAa;UACpCC,YAAY,EAAEtG,IAAI,CAACkG,UAAU,CAACI;QAChC,CAAC;QACDzG,UAAU,EAAE;UACV0G,SAAS,EAAEvG,IAAI,CAACH,UAAU,CAAC8D,MAAM;UACjC6C,OAAO,EAAExG,IAAI,CAACH,UAAU,CAAC4G,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACjH,MAAM,KAAK,SAAS,CAAC,CAACkE,MAAM;UACnEgD,MAAM,EAAE3G,IAAI,CAACH,UAAU,CAAC4G,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACjH,MAAM,KAAK,QAAQ,CAAC,CAACkE,MAAM;UACjEiD,cAAc,EAAE5G,IAAI,CAACkG,UAAU,CAACU;QAClC,CAAC;QACD7D,cAAc,EAAE;UACdgB,KAAK,EAAE/D,IAAI,CAAC+C,cAAc,CAACgB,KAAK;UAChC8C,QAAQ,EAAE7G,IAAI,CAAC+C,cAAc,CAAC+D,iBAAiB;UAC/CC,YAAY,EAAE/G,IAAI,CAAC+C,cAAc,CAACiE,iBAAiB;UACnDC,iBAAiB,EAAEjH,IAAI,CAAC+C,cAAc,CAACmE,sBAAsB;UAC7DC,QAAQ,EAAEnH,IAAI,CAAC+C,cAAc,CAACoE,QAAQ;UACtCC,UAAU,EAAEpH,IAAI,CAAC+C,cAAc,CAACqE;QAClC,CAAC;QACDC,IAAI,EAAE;UACJC,QAAQ,EAAEtH,IAAI,CAACuH,QAAQ,CAACD,QAAQ;UAChCE,IAAI,EAAExH,IAAI,CAACuH,QAAQ,CAACC,IAAI;UACxBC,UAAU,EAAEzH,IAAI,CAACuH,QAAQ,CAACE;QAC5B,CAAC;QACD/D,SAAS,EAAE1D,IAAI,CAAC0D,SAAS,CAACC,MAAM;QAChCY,MAAM,EAAE;UACNmD,OAAO,EAAE1H,IAAI,CAACiF,aAAa;UAC3BtD,KAAK,EAAE3B,IAAI,CAAC4E;QACd;MACF,CAAC;MAEDxF,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAEiF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOhF,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,yBAAyB;QAClCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAa+H,oBAAoBA,CAACxI,GAAG,EAAEC,GAAG,EAAE;IAC1C,IAAI;MACF,MAAM;QAAEwI,QAAQ;QAAEnH,SAAS;QAAEE;MAAQ,CAAC,GAAGxB,GAAG,CAACK,IAAI;MAEjD,MAAMqI,IAAI,GAAG/I,OAAO,CAAC,gBAAgB,CAAC;MACtC,MAAM2G,MAAM,GAAG,MAAMoC,IAAI,CAAC/H,QAAQ,CAAC8H,QAAQ,CAAC;MAE5C,IAAI,CAACnC,MAAM,EAAE;QACX,OAAOrG,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMkI,MAAM,GAAG,MAAM9I,kBAAkB,CAAC2I,oBAAoB,CAC1DlC,MAAM,EACN,IAAI/E,IAAI,CAACD,SAAS,CAAC,EACnB,IAAIC,IAAI,CAACC,OAAO,CAClB,CAAC;MAEDvB,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbO,IAAI,EAAE4H;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO3H,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,wBAAwB;QACjCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAamI,UAAUA,CAAC5I,GAAG,EAAEC,GAAG,EAAE;IAChC,IAAI;MACF,MAAM;QAAE4C;MAAG,CAAC,GAAG7C,GAAG,CAAC4C,MAAM;MACzB,MAAM/B,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACkC,EAAE,CAAC;MAEpC,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;;MAEA;MACA,IAAII,IAAI,CAACP,MAAM,KAAK,WAAW,EAAE;QAC/B,OAAOL,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;;MAEA;MACAoI,MAAM,CAACC,MAAM,CAACjI,IAAI,EAAEb,GAAG,CAACK,IAAI,CAAC;MAC7B,MAAMQ,IAAI,CAACC,IAAI,CAAC,CAAC;MAEjBb,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,uBAAuB;QAChCM,IAAI,EAAEF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,kBAAkB;QAC3BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAasI,UAAUA,CAAC/I,GAAG,EAAEC,GAAG,EAAE;IAChC,IAAI;MACF,MAAM;QAAE4C;MAAG,CAAC,GAAG7C,GAAG,CAAC4C,MAAM;;MAEzB;MACA,MAAM/B,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACkC,EAAE,CAAC;MACpC,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,IAAII,IAAI,CAACP,MAAM,KAAK,WAAW,EAAE;QAC/B,OAAOL,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,MAAMf,IAAI,CAACsJ,iBAAiB,CAACnG,EAAE,CAAC;MAEhC5C,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE;MACX,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOO,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,gBAAgB;QACzBO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAawI,UAAUA,CAACjJ,GAAG,EAAEC,GAAG,EAAE;IAChC,IAAI;MACF,MAAM;QAAE4C;MAAG,CAAC,GAAG7C,GAAG,CAAC4C,MAAM;MACzB,MAAM;QAAEsG;MAAO,CAAC,GAAGlJ,GAAG,CAACK,IAAI;MAE3B,MAAMQ,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACkC,EAAE,CAAC;MACpC,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEA,IAAII,IAAI,CAACP,MAAM,KAAK,WAAW,EAAE;QAC/B,OAAOL,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;MAEAI,IAAI,CAACP,MAAM,GAAG,WAAW;MACzBO,IAAI,CAACsI,kBAAkB,GAAGD,MAAM;MAChC,MAAMrI,IAAI,CAACC,IAAI,CAAC,CAAC;MAEjBb,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,uBAAuB;QAChCM,IAAI,EAAEF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,kBAAkB;QAC3BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAa2I,gBAAgBA,CAACpJ,GAAG,EAAEC,GAAG,EAAE;IACtC,IAAI;MACF,MAAM;QAAE4C;MAAG,CAAC,GAAG7C,GAAG,CAAC4C,MAAM;MACzB,MAAM;QAAEyG;MAAQ,CAAC,GAAGrJ,GAAG,CAACK,IAAI;MAE5B,MAAMQ,IAAI,GAAG,MAAMnB,IAAI,CAACiB,QAAQ,CAACkC,EAAE,CAAC;MACpC,IAAI,CAAChC,IAAI,EAAE;QACT,OAAOZ,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;;MAEA;MACA,MAAMG,QAAQ,GAAGC,IAAI,CAACH,UAAU,EAAEE,QAAQ,IAAI,EAAE;MAChD,IAAIyI,OAAO,GAAGzI,QAAQ,EAAE;QACtB,OAAOX,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAC1BC,OAAO,EAAE,KAAK;UACdC,OAAO,EAAE;QACX,CAAC,CAAC;MACJ;;MAEA;MACA,IAAI,CAACI,IAAI,CAACH,UAAU,EAAE;QACpBG,IAAI,CAACH,UAAU,GAAG,CAAC,CAAC;MACtB;MACAG,IAAI,CAACH,UAAU,CAAC2I,OAAO,GAAGA,OAAO;MACjCxI,IAAI,CAACH,UAAU,CAACE,QAAQ,GAAGA,QAAQ;MAEnC,MAAMC,IAAI,CAACC,IAAI,CAAC,CAAC;MAEjBb,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,2BAA2B;QACpCM,IAAI,EAAEF;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,sBAAsB;QAC/BO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;EACE,aAAa6I,kBAAkBA,CAACtJ,GAAG,EAAEC,GAAG,EAAE;IACxC,IAAI;MACF,MAAM6B,KAAK,GAAG,MAAMpC,IAAI,CAACqC,IAAI,CAAC,CAAC;MAE/B,MAAMgF,UAAU,GAAG;QACjBvE,KAAK,EAAEV,KAAK,CAAC0C,MAAM;QACnB+E,UAAU,EAAEzH,KAAK,CAACwF,MAAM,CAACkC,CAAC,IAAIA,CAAC,CAAClJ,MAAM,KAAK,aAAa,CAAC,CAACkE,MAAM;QAChE4C,SAAS,EAAEtF,KAAK,CAACwF,MAAM,CAACkC,CAAC,IAAIA,CAAC,CAAClJ,MAAM,KAAK,WAAW,CAAC,CAACkE,MAAM;QAC7DiF,SAAS,EAAE3H,KAAK,CAACwF,MAAM,CAACkC,CAAC,IAAIA,CAAC,CAAClJ,MAAM,KAAK,WAAW,CAAC,CAACkE,MAAM;QAC7DkF,SAAS,EAAE5H,KAAK,CAACwF,MAAM,CAACkC,CAAC,IAAIA,CAAC,CAAClJ,MAAM,KAAK,WAAW,CAAC,CAACkE;MACzD,CAAC;MAEDvE,GAAG,CAACM,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbC,OAAO,EAAE,+BAA+B;QACxCM,IAAI,EAAEgG;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO/F,KAAK,EAAE;MACdf,GAAG,CAACK,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACnBC,OAAO,EAAE,KAAK;QACdC,OAAO,EAAE,0BAA0B;QACnCO,KAAK,EAAEA,KAAK,CAACP;MACf,CAAC,CAAC;IACJ;EACF;AACF;AAEAkJ,MAAM,CAACC,OAAO,GAAG9J,cAAc","ignoreList":[]}