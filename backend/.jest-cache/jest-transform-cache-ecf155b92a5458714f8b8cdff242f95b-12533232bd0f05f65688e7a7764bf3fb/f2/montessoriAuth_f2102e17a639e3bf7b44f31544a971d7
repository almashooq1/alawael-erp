e15b4d6af203de1611425c073bf1317e
const express = require('express');
const jwt = require('jsonwebtoken');
const User = require('../models/User');
const router = express.Router();

// تسجيل الدخول (إرجاع JWT)
router.post('/login', async (req, res) => {
  const {
    username,
    password
  } = req.body;
  const user = await User.findOne({
    username
  });
  if (!user) return res.status(401).json({
    message: 'اسم المستخدم أو كلمة المرور غير صحيحة'
  });
  const valid = await user.comparePassword(password);
  if (!valid) return res.status(401).json({
    message: 'اسم المستخدم أو كلمة المرور غير صحيحة'
  });
  const token = jwt.sign({
    id: user._id,
    role: user.role,
    name: user.name
  }, process.env.JWT_SECRET, {
    expiresIn: '12h'
  });
  res.json({
    token,
    user: {
      id: user._id,
      name: user.name,
      role: user.role
    }
  });
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImp3dCIsIlVzZXIiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJwb3N0IiwicmVxIiwicmVzIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImJvZHkiLCJ1c2VyIiwiZmluZE9uZSIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwidmFsaWQiLCJjb21wYXJlUGFzc3dvcmQiLCJ0b2tlbiIsInNpZ24iLCJpZCIsIl9pZCIsInJvbGUiLCJuYW1lIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJleHBpcmVzSW4iLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsibW9udGVzc29yaUF1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5cclxuLy8g2KrYs9is2YrZhCDYp9mE2K/YrtmI2YQgKNil2LHYrNin2LkgSldUKVxyXG5yb3V0ZXIucG9zdCgnL2xvZ2luJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyB1c2VybmFtZSwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xyXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyB1c2VybmFtZSB9KTtcclxuICBpZiAoIXVzZXIpIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICfYp9iz2YUg2KfZhNmF2LPYqtiu2K/ZhSDYo9mIINmD2YTZhdipINin2YTZhdix2YjYsSDYutmK2LEg2LXYrdmK2K3YqScgfSk7XHJcbiAgY29uc3QgdmFsaWQgPSBhd2FpdCB1c2VyLmNvbXBhcmVQYXNzd29yZChwYXNzd29yZCk7XHJcbiAgaWYgKCF2YWxpZCkgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ9in2LPZhSDYp9mE2YXYs9iq2K7Yr9mFINij2Ygg2YPZhNmF2Kkg2KfZhNmF2LHZiNixINi62YrYsSDYtdit2YrYrdipJyB9KTtcclxuICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKFxyXG4gICAgeyBpZDogdXNlci5faWQsIHJvbGU6IHVzZXIucm9sZSwgbmFtZTogdXNlci5uYW1lIH0sXHJcbiAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVULFxyXG4gICAgeyBleHBpcmVzSW46ICcxMmgnIH1cclxuICApO1xyXG4gIHJlcy5qc29uKHsgdG9rZW4sIHVzZXI6IHsgaWQ6IHVzZXIuX2lkLCBuYW1lOiB1c2VyLm5hbWUsIHJvbGU6IHVzZXIucm9sZSB9IH0pO1xyXG59KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxHQUFHLEdBQUdELE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbkMsTUFBTUUsSUFBSSxHQUFHRixPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDdEMsTUFBTUcsTUFBTSxHQUFHSixPQUFPLENBQUNLLE1BQU0sQ0FBQyxDQUFDOztBQUUvQjtBQUNBRCxNQUFNLENBQUNFLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBT0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDeEMsTUFBTTtJQUFFQyxRQUFRO0lBQUVDO0VBQVMsQ0FBQyxHQUFHSCxHQUFHLENBQUNJLElBQUk7RUFDdkMsTUFBTUMsSUFBSSxHQUFHLE1BQU1ULElBQUksQ0FBQ1UsT0FBTyxDQUFDO0lBQUVKO0VBQVMsQ0FBQyxDQUFDO0VBQzdDLElBQUksQ0FBQ0csSUFBSSxFQUFFLE9BQU9KLEdBQUcsQ0FBQ00sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7SUFBRUMsT0FBTyxFQUFFO0VBQXdDLENBQUMsQ0FBQztFQUM1RixNQUFNQyxLQUFLLEdBQUcsTUFBTUwsSUFBSSxDQUFDTSxlQUFlLENBQUNSLFFBQVEsQ0FBQztFQUNsRCxJQUFJLENBQUNPLEtBQUssRUFBRSxPQUFPVCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO0lBQUVDLE9BQU8sRUFBRTtFQUF3QyxDQUFDLENBQUM7RUFDN0YsTUFBTUcsS0FBSyxHQUFHakIsR0FBRyxDQUFDa0IsSUFBSSxDQUNwQjtJQUFFQyxFQUFFLEVBQUVULElBQUksQ0FBQ1UsR0FBRztJQUFFQyxJQUFJLEVBQUVYLElBQUksQ0FBQ1csSUFBSTtJQUFFQyxJQUFJLEVBQUVaLElBQUksQ0FBQ1k7RUFBSyxDQUFDLEVBQ2xEQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxFQUN0QjtJQUFFQyxTQUFTLEVBQUU7RUFBTSxDQUNyQixDQUFDO0VBQ0RwQixHQUFHLENBQUNPLElBQUksQ0FBQztJQUFFSSxLQUFLO0lBQUVQLElBQUksRUFBRTtNQUFFUyxFQUFFLEVBQUVULElBQUksQ0FBQ1UsR0FBRztNQUFFRSxJQUFJLEVBQUVaLElBQUksQ0FBQ1ksSUFBSTtNQUFFRCxJQUFJLEVBQUVYLElBQUksQ0FBQ1c7SUFBSztFQUFFLENBQUMsQ0FBQztBQUMvRSxDQUFDLENBQUM7QUFFRk0sTUFBTSxDQUFDQyxPQUFPLEdBQUcxQixNQUFNIiwiaWdub3JlTGlzdCI6W119