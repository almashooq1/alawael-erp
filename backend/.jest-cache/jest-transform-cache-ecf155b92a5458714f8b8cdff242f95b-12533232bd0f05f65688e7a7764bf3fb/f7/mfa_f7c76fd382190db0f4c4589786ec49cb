7675295f6cd706289df6abe4bba907c5
/**
 * MFA Routes
 * مسارات المصادقة متعددة العوامل
 */

const express = require('express');
const router = express.Router();
const mfaController = require('../controllers/mfaController');
const {
  protect
} = require('../middleware/auth');

// ============ PUBLIC ROUTES ============

/**
 * GET /api/mfa/setup-guide
 * Get MFA setup guide and information
 */
router.get('/setup-guide', mfaController.getMFASetupGuide);

/**
 * POST /api/mfa/login/verify
 * Verify MFA during login (requires MFA session)
 */
router.post('/login/verify', mfaController.verifyMFALogin);

// ============ PROTECTED ROUTES (requires authentication) ============

/**
 * TOTP Setup Routes
 */

/**
 * POST /api/mfa/totp/initiate
 * Initiate TOTP setup - returns QR code
 */
router.post('/totp/initiate', protect, mfaController.initiateTOTPSetup);

/**
 * POST /api/mfa/totp/verify
 * Verify TOTP token and enable TOTP
 */
router.post('/totp/verify', protect, mfaController.verifyAndEnableTOTP);

/**
 * Email OTP Routes
 */

/**
 * POST /api/mfa/email/initiate
 * Send OTP via email
 */
router.post('/email/initiate', protect, mfaController.initiateEmailOTP);

/**
 * POST /api/mfa/email/verify
 * Verify email OTP and enable
 */
router.post('/email/verify', protect, mfaController.verifyAndEnableEmailOTP);

/**
 * SMS OTP Routes
 */

/**
 * POST /api/mfa/sms/initiate
 * Send OTP via SMS
 */
router.post('/sms/initiate', protect, mfaController.initiateSMSOTP);

/**
 * POST /api/mfa/sms/verify
 * Verify SMS OTP and enable
 */
router.post('/sms/verify', protect, mfaController.verifyAndEnableSMSOTP);

/**
 * Settings Routes
 */

/**
 * GET /api/mfa/settings
 * Get user's MFA settings
 */
router.get('/settings', protect, mfaController.getMFASettings);

/**
 * POST /api/mfa/settings/disable-method
 * Disable a specific MFA method
 */
router.post('/settings/disable-method', protect, mfaController.disableMFAMethod);

/**
 * Trusted Device Routes
 */

/**
 * POST /api/mfa/device/trust
 * Mark current device as trusted
 */
router.post('/device/trust', protect, mfaController.trustDevice);

/**
 * GET /api/mfa/device/list
 * Get list of trusted devices
 */
router.get('/device/list', protect, mfaController.getTrustedDevices);

/**
 * DELETE /api/mfa/device/:deviceId
 * Revoke trust for a device
 */
router.delete('/device/:deviceId', protect, mfaController.revokeTrustedDevice);
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIm1mYUNvbnRyb2xsZXIiLCJwcm90ZWN0IiwiZ2V0IiwiZ2V0TUZBU2V0dXBHdWlkZSIsInBvc3QiLCJ2ZXJpZnlNRkFMb2dpbiIsImluaXRpYXRlVE9UUFNldHVwIiwidmVyaWZ5QW5kRW5hYmxlVE9UUCIsImluaXRpYXRlRW1haWxPVFAiLCJ2ZXJpZnlBbmRFbmFibGVFbWFpbE9UUCIsImluaXRpYXRlU01TT1RQIiwidmVyaWZ5QW5kRW5hYmxlU01TT1RQIiwiZ2V0TUZBU2V0dGluZ3MiLCJkaXNhYmxlTUZBTWV0aG9kIiwidHJ1c3REZXZpY2UiLCJnZXRUcnVzdGVkRGV2aWNlcyIsImRlbGV0ZSIsInJldm9rZVRydXN0ZWREZXZpY2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsibWZhLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBNRkEgUm91dGVzXHJcbiAqINmF2LPYp9ix2KfYqiDYp9mE2YXYtdin2K/ZgtipINmF2KrYudiv2K/YqSDYp9mE2LnZiNin2YXZhFxyXG4gKi9cclxuXHJcbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IG1mYUNvbnRyb2xsZXIgPSByZXF1aXJlKCcuLi9jb250cm9sbGVycy9tZmFDb250cm9sbGVyJyk7XHJcbmNvbnN0IHsgcHJvdGVjdCB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZS9hdXRoJyk7XHJcblxyXG4vLyA9PT09PT09PT09PT0gUFVCTElDIFJPVVRFUyA9PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBHRVQgL2FwaS9tZmEvc2V0dXAtZ3VpZGVcclxuICogR2V0IE1GQSBzZXR1cCBndWlkZSBhbmQgaW5mb3JtYXRpb25cclxuICovXHJcbnJvdXRlci5nZXQoJy9zZXR1cC1ndWlkZScsIG1mYUNvbnRyb2xsZXIuZ2V0TUZBU2V0dXBHdWlkZSk7XHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL21mYS9sb2dpbi92ZXJpZnlcclxuICogVmVyaWZ5IE1GQSBkdXJpbmcgbG9naW4gKHJlcXVpcmVzIE1GQSBzZXNzaW9uKVxyXG4gKi9cclxucm91dGVyLnBvc3QoJy9sb2dpbi92ZXJpZnknLCBtZmFDb250cm9sbGVyLnZlcmlmeU1GQUxvZ2luKTtcclxuXHJcbi8vID09PT09PT09PT09PSBQUk9URUNURUQgUk9VVEVTIChyZXF1aXJlcyBhdXRoZW50aWNhdGlvbikgPT09PT09PT09PT09XHJcblxyXG4vKipcclxuICogVE9UUCBTZXR1cCBSb3V0ZXNcclxuICovXHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL21mYS90b3RwL2luaXRpYXRlXHJcbiAqIEluaXRpYXRlIFRPVFAgc2V0dXAgLSByZXR1cm5zIFFSIGNvZGVcclxuICovXHJcbnJvdXRlci5wb3N0KCcvdG90cC9pbml0aWF0ZScsIHByb3RlY3QsIG1mYUNvbnRyb2xsZXIuaW5pdGlhdGVUT1RQU2V0dXApO1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9tZmEvdG90cC92ZXJpZnlcclxuICogVmVyaWZ5IFRPVFAgdG9rZW4gYW5kIGVuYWJsZSBUT1RQXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL3RvdHAvdmVyaWZ5JywgcHJvdGVjdCwgbWZhQ29udHJvbGxlci52ZXJpZnlBbmRFbmFibGVUT1RQKTtcclxuXHJcbi8qKlxyXG4gKiBFbWFpbCBPVFAgUm91dGVzXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9tZmEvZW1haWwvaW5pdGlhdGVcclxuICogU2VuZCBPVFAgdmlhIGVtYWlsXHJcbiAqL1xyXG5yb3V0ZXIucG9zdCgnL2VtYWlsL2luaXRpYXRlJywgcHJvdGVjdCwgbWZhQ29udHJvbGxlci5pbml0aWF0ZUVtYWlsT1RQKTtcclxuXHJcbi8qKlxyXG4gKiBQT1NUIC9hcGkvbWZhL2VtYWlsL3ZlcmlmeVxyXG4gKiBWZXJpZnkgZW1haWwgT1RQIGFuZCBlbmFibGVcclxuICovXHJcbnJvdXRlci5wb3N0KCcvZW1haWwvdmVyaWZ5JywgcHJvdGVjdCwgbWZhQ29udHJvbGxlci52ZXJpZnlBbmRFbmFibGVFbWFpbE9UUCk7XHJcblxyXG4vKipcclxuICogU01TIE9UUCBSb3V0ZXNcclxuICovXHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL21mYS9zbXMvaW5pdGlhdGVcclxuICogU2VuZCBPVFAgdmlhIFNNU1xyXG4gKi9cclxucm91dGVyLnBvc3QoJy9zbXMvaW5pdGlhdGUnLCBwcm90ZWN0LCBtZmFDb250cm9sbGVyLmluaXRpYXRlU01TT1RQKTtcclxuXHJcbi8qKlxyXG4gKiBQT1NUIC9hcGkvbWZhL3Ntcy92ZXJpZnlcclxuICogVmVyaWZ5IFNNUyBPVFAgYW5kIGVuYWJsZVxyXG4gKi9cclxucm91dGVyLnBvc3QoJy9zbXMvdmVyaWZ5JywgcHJvdGVjdCwgbWZhQ29udHJvbGxlci52ZXJpZnlBbmRFbmFibGVTTVNPVFApO1xyXG5cclxuLyoqXHJcbiAqIFNldHRpbmdzIFJvdXRlc1xyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBHRVQgL2FwaS9tZmEvc2V0dGluZ3NcclxuICogR2V0IHVzZXIncyBNRkEgc2V0dGluZ3NcclxuICovXHJcbnJvdXRlci5nZXQoJy9zZXR0aW5ncycsIHByb3RlY3QsIG1mYUNvbnRyb2xsZXIuZ2V0TUZBU2V0dGluZ3MpO1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9tZmEvc2V0dGluZ3MvZGlzYWJsZS1tZXRob2RcclxuICogRGlzYWJsZSBhIHNwZWNpZmljIE1GQSBtZXRob2RcclxuICovXHJcbnJvdXRlci5wb3N0KCcvc2V0dGluZ3MvZGlzYWJsZS1tZXRob2QnLCBwcm90ZWN0LCBtZmFDb250cm9sbGVyLmRpc2FibGVNRkFNZXRob2QpO1xyXG5cclxuLyoqXHJcbiAqIFRydXN0ZWQgRGV2aWNlIFJvdXRlc1xyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBQT1NUIC9hcGkvbWZhL2RldmljZS90cnVzdFxyXG4gKiBNYXJrIGN1cnJlbnQgZGV2aWNlIGFzIHRydXN0ZWRcclxuICovXHJcbnJvdXRlci5wb3N0KCcvZGV2aWNlL3RydXN0JywgcHJvdGVjdCwgbWZhQ29udHJvbGxlci50cnVzdERldmljZSk7XHJcblxyXG4vKipcclxuICogR0VUIC9hcGkvbWZhL2RldmljZS9saXN0XHJcbiAqIEdldCBsaXN0IG9mIHRydXN0ZWQgZGV2aWNlc1xyXG4gKi9cclxucm91dGVyLmdldCgnL2RldmljZS9saXN0JywgcHJvdGVjdCwgbWZhQ29udHJvbGxlci5nZXRUcnVzdGVkRGV2aWNlcyk7XHJcblxyXG4vKipcclxuICogREVMRVRFIC9hcGkvbWZhL2RldmljZS86ZGV2aWNlSWRcclxuICogUmV2b2tlIHRydXN0IGZvciBhIGRldmljZVxyXG4gKi9cclxucm91dGVyLmRlbGV0ZSgnL2RldmljZS86ZGV2aWNlSWQnLCBwcm90ZWN0LCBtZmFDb250cm9sbGVyLnJldm9rZVRydXN0ZWREZXZpY2UpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNQyxhQUFhLEdBQUdILE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQztBQUM3RCxNQUFNO0VBQUVJO0FBQVEsQ0FBQyxHQUFHSixPQUFPLENBQUMsb0JBQW9CLENBQUM7O0FBRWpEOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FDLE1BQU0sQ0FBQ0ksR0FBRyxDQUFDLGNBQWMsRUFBRUYsYUFBYSxDQUFDRyxnQkFBZ0IsQ0FBQzs7QUFFMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQUwsTUFBTSxDQUFDTSxJQUFJLENBQUMsZUFBZSxFQUFFSixhQUFhLENBQUNLLGNBQWMsQ0FBQzs7QUFFMUQ7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FQLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLGdCQUFnQixFQUFFSCxPQUFPLEVBQUVELGFBQWEsQ0FBQ00saUJBQWlCLENBQUM7O0FBRXZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0FSLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLGNBQWMsRUFBRUgsT0FBTyxFQUFFRCxhQUFhLENBQUNPLG1CQUFtQixDQUFDOztBQUV2RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQVQsTUFBTSxDQUFDTSxJQUFJLENBQUMsaUJBQWlCLEVBQUVILE9BQU8sRUFBRUQsYUFBYSxDQUFDUSxnQkFBZ0IsQ0FBQzs7QUFFdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQVYsTUFBTSxDQUFDTSxJQUFJLENBQUMsZUFBZSxFQUFFSCxPQUFPLEVBQUVELGFBQWEsQ0FBQ1MsdUJBQXVCLENBQUM7O0FBRTVFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBWCxNQUFNLENBQUNNLElBQUksQ0FBQyxlQUFlLEVBQUVILE9BQU8sRUFBRUQsYUFBYSxDQUFDVSxjQUFjLENBQUM7O0FBRW5FO0FBQ0E7QUFDQTtBQUNBO0FBQ0FaLE1BQU0sQ0FBQ00sSUFBSSxDQUFDLGFBQWEsRUFBRUgsT0FBTyxFQUFFRCxhQUFhLENBQUNXLHFCQUFxQixDQUFDOztBQUV4RTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQWIsTUFBTSxDQUFDSSxHQUFHLENBQUMsV0FBVyxFQUFFRCxPQUFPLEVBQUVELGFBQWEsQ0FBQ1ksY0FBYyxDQUFDOztBQUU5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBZCxNQUFNLENBQUNNLElBQUksQ0FBQywwQkFBMEIsRUFBRUgsT0FBTyxFQUFFRCxhQUFhLENBQUNhLGdCQUFnQixDQUFDOztBQUVoRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQWYsTUFBTSxDQUFDTSxJQUFJLENBQUMsZUFBZSxFQUFFSCxPQUFPLEVBQUVELGFBQWEsQ0FBQ2MsV0FBVyxDQUFDOztBQUVoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBaEIsTUFBTSxDQUFDSSxHQUFHLENBQUMsY0FBYyxFQUFFRCxPQUFPLEVBQUVELGFBQWEsQ0FBQ2UsaUJBQWlCLENBQUM7O0FBRXBFO0FBQ0E7QUFDQTtBQUNBO0FBQ0FqQixNQUFNLENBQUNrQixNQUFNLENBQUMsbUJBQW1CLEVBQUVmLE9BQU8sRUFBRUQsYUFBYSxDQUFDaUIsbUJBQW1CLENBQUM7QUFFOUVDLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHckIsTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==