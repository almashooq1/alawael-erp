{"version":3,"names":["DatabaseMigration","constructor","sourceDB","targetDB","logger","console","migrationLog","batchSize","setBatchSize","size","migrateTable","tableName","options","startTime","Date","now","migrationRecord","table","toISOString","status","info","countResult","query","totalRecords","count","warn","recordsMigrated","push","migratedCount","offset","rows","length","insertBatch","progress","toFixed","duration","endTime","error","message","columns","Object","keys","placeholders","map","join","values","flatMap","row","col","insertQuery","skipDuplicates","insertBatchIgnoreDuplicates","Error","includes","migrateTables","tableList","results","result","continueOnError","migrateTableWithTransform","transformFn","transformedRows","verifyMigration","sourceCount","targetCount","sourceRecords","targetRecords","match","discrepancy","Math","abs","verifyAllMigrations","rollbackMigration","getMigrationLog","getMigrationSummary","log","completed","filter","l","failed","reduce","sum","totalDuration","totalTables","completedTables","failedTables","totalRecordsMigrated","averageTimePerTable","migrations","clearLog","module","exports"],"sources":["DatabaseMigration.js"],"sourcesContent":["/**\r\n * Database Migration Service\r\n * Manages data migration between databases\r\n */\r\n\r\nclass DatabaseMigration {\r\n  constructor(sourceDB, targetDB, logger = console) {\r\n    this.sourceDB = sourceDB;\r\n    this.targetDB = targetDB;\r\n    this.logger = logger;\r\n    this.migrationLog = [];\r\n    this.batchSize = 1000;\r\n  }\r\n\r\n  /**\r\n   * Set batch size for migration\r\n   */\r\n  setBatchSize(size) {\r\n    this.batchSize = size;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Copy table from source to target\r\n   */\r\n  async migrateTable(tableName, options = {}) {\r\n    const startTime = Date.now();\r\n    const migrationRecord = {\r\n      table: tableName,\r\n      startTime: new Date().toISOString(),\r\n      status: 'in_progress',\r\n    };\r\n\r\n    try {\r\n      this.logger.info(`Starting migration for table: ${tableName}`);\r\n\r\n      // Get total record count\r\n      const countResult = await this.sourceDB.query(\r\n        `SELECT COUNT(*) as count FROM ${tableName}`,\r\n      );\r\n      const totalRecords = countResult[0]?.count || 0;\r\n\r\n      if (totalRecords === 0) {\r\n        this.logger.warn(`Table ${tableName} is empty`);\r\n        migrationRecord.recordsMigrated = 0;\r\n        migrationRecord.status = 'completed';\r\n        this.migrationLog.push(migrationRecord);\r\n        return migrationRecord;\r\n      }\r\n\r\n      let migratedCount = 0;\r\n      let offset = 0;\r\n\r\n      // Migrate in batches\r\n      while (offset < totalRecords) {\r\n        const rows = await this.sourceDB.query(\r\n          `SELECT * FROM ${tableName} LIMIT ${this.batchSize} OFFSET ${offset}`,\r\n        );\r\n\r\n        if (rows.length === 0) break;\r\n\r\n        // Insert batch into target\r\n        await this.insertBatch(tableName, rows, options);\r\n\r\n        migratedCount += rows.length;\r\n        offset += this.batchSize;\r\n\r\n        const progress = ((migratedCount / totalRecords) * 100).toFixed(2);\r\n        this.logger.info(`Migration progress for ${tableName}: ${progress}%`);\r\n      }\r\n\r\n      migrationRecord.recordsMigrated = migratedCount;\r\n      migrationRecord.status = 'completed';\r\n      migrationRecord.duration = Date.now() - startTime;\r\n      migrationRecord.endTime = new Date().toISOString();\r\n\r\n      this.migrationLog.push(migrationRecord);\r\n      this.logger.info(`Successfully migrated ${migratedCount} records from ${tableName}`);\r\n\r\n      return migrationRecord;\r\n    } catch (error) {\r\n      migrationRecord.status = 'failed';\r\n      migrationRecord.error = error.message;\r\n      migrationRecord.duration = Date.now() - startTime;\r\n      this.migrationLog.push(migrationRecord);\r\n\r\n      this.logger.error(`Migration failed for table ${tableName}: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Insert batch of records\r\n   */\r\n  async insertBatch(tableName, rows, options = {}) {\r\n    if (rows.length === 0) return;\r\n\r\n    try {\r\n      const columns = Object.keys(rows[0]);\r\n      const placeholders = rows.map(() => `(${columns.map(() => '?').join(',')})`).join(',');\r\n      const values = rows.flatMap((row) => columns.map((col) => row[col]));\r\n\r\n      const insertQuery = `INSERT INTO ${tableName} (${columns.join(',')}) VALUES ${placeholders}`;\r\n\r\n      if (options.skipDuplicates) {\r\n        return await this.insertBatchIgnoreDuplicates(tableName, rows, columns);\r\n      }\r\n\r\n      await this.targetDB.query(insertQuery, values);\r\n    } catch (error) {\r\n      throw new Error(`Failed to insert batch into ${tableName}: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Insert batch ignoring duplicates\r\n   */\r\n  async insertBatchIgnoreDuplicates(tableName, rows, columns) {\r\n    for (const row of rows) {\r\n      try {\r\n        const values = columns.map((col) => row[col]);\r\n        const placeholders = columns.map(() => '?').join(',');\r\n        const query = `INSERT IGNORE INTO ${tableName} (${columns.join(',')}) VALUES (${placeholders})`;\r\n        await this.targetDB.query(query, values);\r\n      } catch (error) {\r\n        if (!error.message.includes('Duplicate')) {\r\n          throw error;\r\n        }\r\n        // Skip duplicates\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Migrate multiple tables\r\n   */\r\n  async migrateTables(tableList, options = {}) {\r\n    const results = [];\r\n\r\n    for (const table of tableList) {\r\n      try {\r\n        const result = await this.migrateTable(table, options);\r\n        results.push(result);\r\n      } catch (error) {\r\n        results.push({\r\n          table,\r\n          status: 'failed',\r\n          error: error.message,\r\n        });\r\n\r\n        if (!options.continueOnError) {\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Migrate with data transformation\r\n   */\r\n  async migrateTableWithTransform(tableName, transformFn, options = {}) {\r\n    const startTime = Date.now();\r\n    const migrationRecord = {\r\n      table: tableName,\r\n      startTime: new Date().toISOString(),\r\n      status: 'in_progress',\r\n    };\r\n\r\n    try {\r\n      this.logger.info(`Starting transformed migration for table: ${tableName}`);\r\n\r\n      const countResult = await this.sourceDB.query(\r\n        `SELECT COUNT(*) as count FROM ${tableName}`,\r\n      );\r\n      const totalRecords = countResult[0]?.count || 0;\r\n\r\n      let migratedCount = 0;\r\n      let offset = 0;\r\n\r\n      while (offset < totalRecords) {\r\n        const rows = await this.sourceDB.query(\r\n          `SELECT * FROM ${tableName} LIMIT ${this.batchSize} OFFSET ${offset}`,\r\n        );\r\n\r\n        if (rows.length === 0) break;\r\n\r\n        // Transform rows\r\n        const transformedRows = rows.map((row) => transformFn(row));\r\n\r\n        // Insert transformed batch\r\n        await this.insertBatch(tableName, transformedRows, options);\r\n\r\n        migratedCount += rows.length;\r\n        offset += this.batchSize;\r\n      }\r\n\r\n      migrationRecord.recordsMigrated = migratedCount;\r\n      migrationRecord.status = 'completed';\r\n      migrationRecord.duration = Date.now() - startTime;\r\n\r\n      this.migrationLog.push(migrationRecord);\r\n      return migrationRecord;\r\n    } catch (error) {\r\n      migrationRecord.status = 'failed';\r\n      migrationRecord.error = error.message;\r\n      this.migrationLog.push(migrationRecord);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verify migration integrity\r\n   */\r\n  async verifyMigration(tableName) {\r\n    try {\r\n      const sourceCount = await this.sourceDB.query(\r\n        `SELECT COUNT(*) as count FROM ${tableName}`,\r\n      );\r\n      const targetCount = await this.targetDB.query(\r\n        `SELECT COUNT(*) as count FROM ${tableName}`,\r\n      );\r\n\r\n      const sourceRecords = sourceCount[0]?.count || 0;\r\n      const targetRecords = targetCount[0]?.count || 0;\r\n\r\n      return {\r\n        table: tableName,\r\n        sourceRecords,\r\n        targetRecords,\r\n        match: sourceRecords === targetRecords,\r\n        discrepancy: Math.abs(sourceRecords - targetRecords),\r\n      };\r\n    } catch (error) {\r\n      throw new Error(`Verification failed for table ${tableName}: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verify all tables\r\n   */\r\n  async verifyAllMigrations(tableList) {\r\n    const results = [];\r\n\r\n    for (const table of tableList) {\r\n      try {\r\n        const result = await this.verifyMigration(table);\r\n        results.push(result);\r\n      } catch (error) {\r\n        results.push({\r\n          table,\r\n          error: error.message,\r\n        });\r\n      }\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Rollback migration\r\n   */\r\n  async rollbackMigration(tableName) {\r\n    try {\r\n      this.logger.info(`Rolling back migration for table: ${tableName}`);\r\n\r\n      // Truncate target table\r\n      await this.targetDB.query(`TRUNCATE TABLE ${tableName}`);\r\n\r\n      this.logger.info(`Successfully rolled back table: ${tableName}`);\r\n\r\n      return {\r\n        table: tableName,\r\n        status: 'rolled_back',\r\n      };\r\n    } catch (error) {\r\n      throw new Error(`Rollback failed for table ${tableName}: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get migration log\r\n   */\r\n  getMigrationLog() {\r\n    return this.migrationLog;\r\n  }\r\n\r\n  /**\r\n   * Get migration summary\r\n   */\r\n  getMigrationSummary() {\r\n    const log = this.migrationLog;\r\n    const completed = log.filter((l) => l.status === 'completed');\r\n    const failed = log.filter((l) => l.status === 'failed');\r\n    const totalRecords = completed.reduce((sum, l) => sum + (l.recordsMigrated || 0), 0);\r\n    const totalDuration = completed.reduce((sum, l) => sum + (l.duration || 0), 0);\r\n\r\n    return {\r\n      totalTables: log.length,\r\n      completedTables: completed.length,\r\n      failedTables: failed.length,\r\n      totalRecordsMigrated: totalRecords,\r\n      totalDuration,\r\n      averageTimePerTable: completed.length > 0 ? totalDuration / completed.length : 0,\r\n      migrations: log,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clear migration log\r\n   */\r\n  clearLog() {\r\n    this.migrationLog = [];\r\n    return this;\r\n  }\r\n}\r\n\r\nmodule.exports = DatabaseMigration;\r\n"],"mappings":"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","ignoreList":[]}