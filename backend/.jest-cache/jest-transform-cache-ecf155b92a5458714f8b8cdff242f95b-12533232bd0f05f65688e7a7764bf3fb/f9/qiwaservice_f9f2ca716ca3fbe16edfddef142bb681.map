{"version":3,"names":["axios","require","crypto","EventEmitter","QiwaService","constructor","config","baseUrl","process","env","QIWA_API_BASE_URL","apiKey","QIWA_API_KEY","apiSecret","QIWA_API_SECRET","establishmentId","QIWA_ESTABLISHMENT_ID","laborOfficeId","QIWA_LABOR_OFFICE_ID","cache","Map","cacheExpiry","requestQueue","rateLimitData","requestHistory","retryConfig","maxRetries","retryDelay","backoffMultiplier","metrics","totalRequests","successfulRequests","failedRequests","cachedResponses","averageResponseTime","requestTimes","validationRules","iqama","nationalId","phoneNumber","contractId","initializeAxiosClient","client","create","baseURL","timeout","headers","interceptors","request","use","randomUUID","Date","toISOString","_generateSignature","data","error","Promise","reject","response","retryCount","_isRetryableError","delay","Math","pow","resolve","setTimeout","timestamp","payload","JSON","stringify","key","createHash","update","digest","status","_makeRequest","method","endpoint","options","startTime","now","cacheKey","url","startsWith","skipCache","cachedData","_getCache","cached","statusCode","toUpperCase","get","params","post","put","delete","Error","_setCache","cacheDuration","responseTime","_trackMetrics","_log","message","responseData","_formatError","verifyEmployeeByIqama","iqamaNumber","_validate","_transformResponse","emit","verifyEmployeeByNationalId","getEmployeeLaborRecord","registerContract","contractData","_validateContract","normalizedData","_normalizeContractData","result","employeeIqama","updateContract","updates","updatedAt","terminateContract","reason","terminationDate","trim","length","terminatedAt","getContract","listContracts","filters","queryParams","limit","offset","updateEmployeeWage","wageData","normalizedWage","_normalizeWageData","updatedBy","wage","getWageHistory","months","calculateWageCompliance","newWage","submitPayrollToWPS","payrollData","normalizedPayroll","_normalizePayrollData","submittedAt","payrollId","id","submittedEmployees","employees","getWPSStatus","submissionId","getWPSComplianceReport","period","getNitaqatStatus","getNitaqatCompliance","calculateNitaqatPoints","workforce","batchRegisterContracts","contractsList","results","errors","contract","push","success","total","successful","filter","r","failed","summary","batchUpdateWages","wageUpdatesList","field","value","customMessage","rule","test","required","basicSalary","contractType","jobTitle","jobTitleArabic","round","housingAllowance","transportAllowance","otherAllowances","startDate","split","endDate","workingHours","workingDays","totalSalary","effectiveDate","submissionType","map","emp","allowances","deductions","netSalary","type","formattedError","originalError","expiry","duration","set","clearCache","pattern","clear","cleared","keys","includes","shift","totalTime","reduce","a","b","getMetrics","successRate","cacheHitRate","recentRequests","slice","healthCheck","level","metadata","logEntry","console","log","getRequestHistory","history","h","module","exports","instance"],"sources":["qiwa.service.js"],"sourcesContent":["/**\r\n * ðŸ‡¸ðŸ‡¦ Qiwa Integration Service\r\n * Ministry of Labor (MOL) - Professional Integration\r\n *\r\n * Features:\r\n * âœ… Contract Management (Register, Update, Terminate)\r\n * âœ… Employee Verification\r\n * âœ… Wage Management & Compliance\r\n * âœ… Nitaqat (Workforce Localization) Tracking\r\n * âœ… WPS (Wage Protection System) Integration\r\n * âœ… Advanced Error Handling & Retry Logic\r\n * âœ… Caching & Performance Optimization\r\n * âœ… Rate Limiting & Quota Management\r\n * âœ… Comprehensive Logging & Monitoring\r\n * âœ… Data Validation & Transformation\r\n *\r\n * @version 2.0.0\r\n * @author AI Integration Team\r\n * @date 2026-02-17\r\n */\r\n\r\nconst axios = require('axios');\r\nconst crypto = require('crypto');\r\nconst EventEmitter = require('events');\r\n\r\nclass QiwaService extends EventEmitter {\r\n  constructor(config = {}) {\r\n    super();\r\n\r\n    // Configuration\r\n    this.baseUrl = process.env.QIWA_API_BASE_URL || 'https://api.qiwa.sa/v1';\r\n    this.apiKey = process.env.QIWA_API_KEY;\r\n    this.apiSecret = process.env.QIWA_API_SECRET;\r\n    this.establishmentId = process.env.QIWA_ESTABLISHMENT_ID;\r\n    this.laborOfficeId = process.env.QIWA_LABOR_OFFICE_ID;\r\n\r\n    // Advanced features\r\n    this.cache = new Map();\r\n    this.cacheExpiry = new Map();\r\n    this.requestQueue = [];\r\n    this.rateLimitData = new Map();\r\n    this.requestHistory = [];\r\n    this.retryConfig = config.retryConfig || {\r\n      maxRetries: 3,\r\n      retryDelay: 1000,\r\n      backoffMultiplier: 2,\r\n    };\r\n\r\n    // Performance Monitoring\r\n    this.metrics = {\r\n      totalRequests: 0,\r\n      successfulRequests: 0,\r\n      failedRequests: 0,\r\n      cachedResponses: 0,\r\n      averageResponseTime: 0,\r\n      requestTimes: [],\r\n    };\r\n\r\n    // Validation Rules\r\n    this.validationRules = {\r\n      iqama: /^[0-9]{10}$/,\r\n      nationalId: /^[0-9]{10}$/,\r\n      phoneNumber: /^(\\+966|0)[0-9]{9}$/,\r\n      establishmentId: /^[0-9]{6}$/,\r\n      contractId: /^[A-Z0-9]{12}$/,\r\n    };\r\n\r\n    this.initializeAxiosClient();\r\n  }\r\n\r\n  /**\r\n   * Initialize Axios client with interceptors\r\n   */\r\n  initializeAxiosClient() {\r\n    this.client = axios.create({\r\n      baseURL: this.baseUrl,\r\n      timeout: 30000,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Accept': 'application/json',\r\n      },\r\n    });\r\n\r\n    // Request interceptor for signing requests\r\n    this.client.interceptors.request.use(\r\n      (config) => {\r\n        config.headers['X-API-Key'] = this.apiKey;\r\n        config.headers['X-Request-ID'] = crypto.randomUUID();\r\n        config.headers['X-Timestamp'] = new Date().toISOString();\r\n\r\n        // Sign request\r\n        config.headers['X-Signature'] = this._generateSignature(\r\n          config.data || {}\r\n        );\r\n\r\n        return config;\r\n      },\r\n      (error) => Promise.reject(error)\r\n    );\r\n\r\n    // Response interceptor\r\n    this.client.interceptors.response.use(\r\n      (response) => response,\r\n      async (error) => {\r\n        const config = error.config;\r\n\r\n        // Retry logic\r\n        if (!config || !config.retryCount) {\r\n          config.retryCount = 0;\r\n        }\r\n\r\n        if (\r\n          config.retryCount < this.retryConfig.maxRetries &&\r\n          this._isRetryableError(error)\r\n        ) {\r\n          config.retryCount++;\r\n          const delay =\r\n            this.retryConfig.retryDelay *\r\n            Math.pow(this.retryConfig.backoffMultiplier, config.retryCount - 1);\r\n\r\n          await new Promise((resolve) => setTimeout(resolve, delay));\r\n          return this.client(config);\r\n        }\r\n\r\n        return Promise.reject(error);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Generate request signature\r\n   */\r\n  _generateSignature(data) {\r\n    const timestamp = new Date().toISOString();\r\n    const payload = JSON.stringify({ ...data, timestamp, key: this.apiSecret });\r\n    return crypto\r\n      .createHash('sha256')\r\n      .update(payload)\r\n      .digest('hex');\r\n  }\r\n\r\n  /**\r\n   * Check if error is retryable\r\n   */\r\n  _isRetryableError(error) {\r\n    if (!error.response) {\r\n      return true; // Network error\r\n    }\r\n\r\n    const status = error.response.status;\r\n    // Retry on 429 (rate limit), 503 (service unavailable), 504 (gateway timeout)\r\n    return status === 429 || status === 503 || status === 504;\r\n  }\r\n\r\n  /**\r\n   * Make API request with caching, retry, and metrics\r\n   */\r\n  async _makeRequest(method, endpoint, data = null, options = {}) {\r\n    const startTime = Date.now();\r\n    const cacheKey = `${method}:${endpoint}:${JSON.stringify(data || {})}`;\r\n    const url = endpoint.startsWith('http') ? endpoint : `${endpoint}`;\r\n\r\n    // Check cache\r\n    if (method === 'GET' && !options.skipCache) {\r\n      const cachedData = this._getCache(cacheKey);\r\n      if (cachedData) {\r\n        this.metrics.cachedResponses++;\r\n        return { data: cachedData, cached: true, statusCode: 200 };\r\n      }\r\n    }\r\n\r\n    try {\r\n      this.metrics.totalRequests++;\r\n\r\n      let response;\r\n      switch (method.toUpperCase()) {\r\n        case 'GET':\r\n          response = await this.client.get(url, {\r\n            params: data,\r\n            ...options,\r\n          });\r\n          break;\r\n        case 'POST':\r\n          response = await this.client.post(url, data, options);\r\n          break;\r\n        case 'PUT':\r\n          response = await this.client.put(url, data, options);\r\n          break;\r\n        case 'DELETE':\r\n          response = await this.client.delete(url, options);\r\n          break;\r\n        default:\r\n          throw new Error(`Unsupported method: ${method}`);\r\n      }\r\n\r\n      this.metrics.successfulRequests++;\r\n\r\n      // Cache successful GET requests\r\n      if (method === 'GET' && response.data) {\r\n        this._setCache(cacheKey, response.data, options.cacheDuration || 3600);\r\n      }\r\n\r\n      // Track response metrics\r\n      const responseTime = Date.now() - startTime;\r\n      this._trackMetrics(responseTime);\r\n\r\n      // Log successful request\r\n      this._log('info', `${method} ${endpoint} - Success (${responseTime}ms)`, {\r\n        statusCode: response.status,\r\n        responseTime,\r\n      });\r\n\r\n      return {\r\n        data: response.data,\r\n        statusCode: response.status,\r\n        headers: response.headers,\r\n        cached: false,\r\n      };\r\n    } catch (error) {\r\n      this.metrics.failedRequests++;\r\n      const responseTime = Date.now() - startTime;\r\n\r\n      // Log error\r\n      this._log('error', `${method} ${endpoint} - Failed (${responseTime}ms)`, {\r\n        error: error.message,\r\n        statusCode: error.response?.status,\r\n        responseData: error.response?.data,\r\n      });\r\n\r\n      throw this._formatError(error);\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // EMPLOYEE VERIFICATION\r\n  // =====================================================\r\n\r\n  /**\r\n   * Verify employee identity using Iqama number\r\n   */\r\n  async verifyEmployeeByIqama(iqamaNumber) {\r\n    this._validate('iqama', iqamaNumber, 'Invalid Iqama number');\r\n\r\n    try {\r\n      const response = await this._makeRequest('GET', '/employees/verify/iqama', {\r\n        iqamaNumber,\r\n        establishmentId: this.establishmentId,\r\n      });\r\n\r\n      return this._transformResponse(response, 'verification');\r\n    } catch (error) {\r\n      this.emit('verification:error', { iqamaNumber, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verify employee identity using National ID\r\n   */\r\n  async verifyEmployeeByNationalId(nationalId) {\r\n    this._validate('nationalId', nationalId, 'Invalid National ID');\r\n\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        '/employees/verify/national-id',\r\n        {\r\n          nationalId,\r\n          establishmentId: this.establishmentId,\r\n        }\r\n      );\r\n\r\n      return this._transformResponse(response, 'verification');\r\n    } catch (error) {\r\n      this.emit('verification:error', { nationalId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get employee labor record\r\n   */\r\n  async getEmployeeLaborRecord(iqamaNumber) {\r\n    this._validate('iqama', iqamaNumber, 'Invalid Iqama number');\r\n\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        `/employees/${iqamaNumber}/labor-record`,\r\n        null,\r\n        { cacheDuration: 7200 }\r\n      );\r\n\r\n      return this._transformResponse(response, 'laborRecord');\r\n    } catch (error) {\r\n      this.emit('laborRecord:error', { iqamaNumber, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // CONTRACT MANAGEMENT\r\n  // =====================================================\r\n\r\n  /**\r\n   * Register new labor contract with Qiwa\r\n   */\r\n  async registerContract(contractData) {\r\n    this._validateContract(contractData);\r\n\r\n    try {\r\n      const normalizedData = this._normalizeContractData(contractData);\r\n\r\n      const response = await this._makeRequest(\r\n        'POST',\r\n        '/contracts/register',\r\n        {\r\n          ...normalizedData,\r\n          establishmentId: this.establishmentId,\r\n          laborOfficeId: this.laborOfficeId,\r\n          timestamp: new Date().toISOString(),\r\n        }\r\n      );\r\n\r\n      const result = this._transformResponse(response, 'contractRegistration');\r\n\r\n      // Emit event for tracking\r\n      this.emit('contract:registered', {\r\n        contractId: result.contractId,\r\n        iqama: contractData.employeeIqama,\r\n        timestamp: new Date(),\r\n      });\r\n\r\n      return result;\r\n    } catch (error) {\r\n      this.emit('contract:error', { contractData, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update existing contract\r\n   */\r\n  async updateContract(contractId, updates) {\r\n    this._validate('contractId', contractId, 'Invalid Contract ID');\r\n\r\n    try {\r\n      const normalizedData = this._normalizeContractData(updates);\r\n\r\n      const response = await this._makeRequest(\r\n        'PUT',\r\n        `/contracts/${contractId}`,\r\n        {\r\n          ...normalizedData,\r\n          updatedAt: new Date().toISOString(),\r\n        }\r\n      );\r\n\r\n      const result = this._transformResponse(response, 'contractUpdate');\r\n\r\n      this.emit('contract:updated', {\r\n        contractId,\r\n        updates,\r\n        timestamp: new Date(),\r\n      });\r\n\r\n      return result;\r\n    } catch (error) {\r\n      this.emit('contract:updateError', { contractId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Terminate labor contract\r\n   */\r\n  async terminateContract(contractId, reason, terminationDate) {\r\n    this._validate('contractId', contractId, 'Invalid Contract ID');\r\n\r\n    if (!reason || reason.trim().length === 0) {\r\n      throw new Error('Termination reason is required');\r\n    }\r\n\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'POST',\r\n        `/contracts/${contractId}/terminate`,\r\n        {\r\n          reason,\r\n          terminationDate: terminationDate || new Date(),\r\n          establishmentId: this.establishmentId,\r\n          terminatedAt: new Date().toISOString(),\r\n        }\r\n      );\r\n\r\n      const result = this._transformResponse(response, 'contractTermination');\r\n\r\n      this.emit('contract:terminated', {\r\n        contractId,\r\n        reason,\r\n        terminationDate,\r\n        timestamp: new Date(),\r\n      });\r\n\r\n      return result;\r\n    } catch (error) {\r\n      this.emit('contract:terminationError', { contractId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get contract details\r\n   */\r\n  async getContract(contractId) {\r\n    this._validate('contractId', contractId, 'Invalid Contract ID');\r\n\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        `/contracts/${contractId}`,\r\n        null,\r\n        { cacheDuration: 7200 }\r\n      );\r\n\r\n      return this._transformResponse(response, 'contractDetails');\r\n    } catch (error) {\r\n      this.emit('contract:fetchError', { contractId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * List establishment contracts\r\n   */\r\n  async listContracts(filters = {}) {\r\n    try {\r\n      const queryParams = {\r\n        establishmentId: this.establishmentId,\r\n        ...filters,\r\n        limit: filters.limit || 50,\r\n        offset: filters.offset || 0,\r\n      };\r\n\r\n      const response = await this._makeRequest('GET', '/contracts', queryParams, {\r\n        cacheDuration: 3600,\r\n      });\r\n\r\n      return this._transformResponse(response, 'contractList');\r\n    } catch (error) {\r\n      this.emit('contracts:listError', { filters, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // WAGE MANAGEMENT\r\n  // =====================================================\r\n\r\n  /**\r\n   * Update employee wage in Qiwa\r\n   */\r\n  async updateEmployeeWage(iqamaNumber, wageData) {\r\n    this._validate('iqama', iqamaNumber, 'Invalid Iqama number');\r\n\r\n    try {\r\n      const normalizedWage = this._normalizeWageData(wageData);\r\n\r\n      const response = await this._makeRequest(\r\n        'PUT',\r\n        `/employees/${iqamaNumber}/wage`,\r\n        {\r\n          ...normalizedWage,\r\n          updatedAt: new Date().toISOString(),\r\n          updatedBy: 'system-integration',\r\n        }\r\n      );\r\n\r\n      const result = this._transformResponse(response, 'wageUpdate');\r\n\r\n      this.emit('wage:updated', {\r\n        iqama: iqamaNumber,\r\n        wage: wageData,\r\n        timestamp: new Date(),\r\n      });\r\n\r\n      return result;\r\n    } catch (error) {\r\n      this.emit('wage:error', { iqamaNumber, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get employee wage history\r\n   */\r\n  async getWageHistory(iqamaNumber, months = 12) {\r\n    this._validate('iqama', iqamaNumber, 'Invalid Iqama number');\r\n\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        `/employees/${iqamaNumber}/wage-history`,\r\n        { months, establishmentId: this.establishmentId },\r\n        { cacheDuration: 86400 } // 24 hours\r\n      );\r\n\r\n      return this._transformResponse(response, 'wageHistory');\r\n    } catch (error) {\r\n      this.emit('wageHistory:error', { iqamaNumber, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate compliance for wage changes\r\n   */\r\n  async calculateWageCompliance(iqamaNumber, newWage) {\r\n    this._validate('iqama', iqamaNumber, 'Invalid Iqama number');\r\n\r\n    try {\r\n      const response = await this._makeRequest('POST', '/wages/compliance-check', {\r\n        iqamaNumber,\r\n        newWage,\r\n        establishmentId: this.establishmentId,\r\n      });\r\n\r\n      return this._transformResponse(response, 'wageCompliance');\r\n    } catch (error) {\r\n      this.emit('wageCompliance:error', { iqamaNumber, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // WAGE PROTECTION SYSTEM (WPS)\r\n  // =====================================================\r\n\r\n  /**\r\n   * Submit payroll to WPS\r\n   */\r\n  async submitPayrollToWPS(payrollData) {\r\n    try {\r\n      const normalizedPayroll = this._normalizePayrollData(payrollData);\r\n\r\n      const response = await this._makeRequest('POST', '/wps/submit', {\r\n        ...normalizedPayroll,\r\n        establishmentId: this.establishmentId,\r\n        submittedAt: new Date().toISOString(),\r\n      });\r\n\r\n      const result = this._transformResponse(response, 'wpsSubmission');\r\n\r\n      this.emit('wps:submitted', {\r\n        payrollId: result.id,\r\n        submittedEmployees: normalizedPayroll.employees.length,\r\n        timestamp: new Date(),\r\n      });\r\n\r\n      return result;\r\n    } catch (error) {\r\n      this.emit('wps:error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get WPS submission status\r\n   */\r\n  async getWPSStatus(submissionId) {\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        `/wps/${submissionId}/status`,\r\n        null,\r\n        { cacheDuration: 1800 } // 30 minutes\r\n      );\r\n\r\n      return this._transformResponse(response, 'wpsStatus');\r\n    } catch (error) {\r\n      this.emit('wpsStatus:error', { submissionId, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get WPS compliance report\r\n   */\r\n  async getWPSComplianceReport(period) {\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        '/wps/compliance-report',\r\n        { period, establishmentId: this.establishmentId },\r\n        { cacheDuration: 86400 }\r\n      );\r\n\r\n      return this._transformResponse(response, 'wpsComplianceReport');\r\n    } catch (error) {\r\n      this.emit('wpsReport:error', { period, error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // NITAQAT (WORKFORCE LOCALIZATION)\r\n  // =====================================================\r\n\r\n  /**\r\n   * Get establishment Nitaqat status\r\n   */\r\n  async getNitaqatStatus() {\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        `/establishments/${this.establishmentId}/nitaqat`,\r\n        null,\r\n        { cacheDuration: 3600 }\r\n      );\r\n\r\n      return this._transformResponse(response, 'nitaqatStatus');\r\n    } catch (error) {\r\n      this.emit('nitaqat:error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Nitaqat compliance details\r\n   */\r\n  async getNitaqatCompliance() {\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'GET',\r\n        `/establishments/${this.establishmentId}/nitaqat/compliance`,\r\n        null,\r\n        { cacheDuration: 3600 }\r\n      );\r\n\r\n      return this._transformResponse(response, 'nitaqatCompliance');\r\n    } catch (error) {\r\n      this.emit('nitaqatCompliance:error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate Nitaqat points for labor force\r\n   */\r\n  async calculateNitaqatPoints(workforce) {\r\n    try {\r\n      const response = await this._makeRequest(\r\n        'POST',\r\n        '/nitaqat/calculate-points',\r\n        {\r\n          establishmentId: this.establishmentId,\r\n          workforce,\r\n        }\r\n      );\r\n\r\n      return this._transformResponse(response, 'nitaqatPoints');\r\n    } catch (error) {\r\n      this.emit('nitaqat:calculationError', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // BATCH OPERATIONS\r\n  // =====================================================\r\n\r\n  /**\r\n   * Batch register multiple contracts\r\n   */\r\n  async batchRegisterContracts(contractsList) {\r\n    try {\r\n      const results = [];\r\n      const errors = [];\r\n\r\n      for (const contract of contractsList) {\r\n        try {\r\n          const result = await this.registerContract(contract);\r\n          results.push({ success: true, data: result });\r\n        } catch (error) {\r\n          errors.push({\r\n            iqama: contract.employeeIqama,\r\n            error: error.message,\r\n          });\r\n          results.push({ success: false, error: error.message });\r\n        }\r\n      }\r\n\r\n      this.emit('batchOperation:completed', {\r\n        total: contractsList.length,\r\n        successful: results.filter((r) => r.success).length,\r\n        failed: errors.length,\r\n      });\r\n\r\n      return {\r\n        results,\r\n        summary: {\r\n          total: contractsList.length,\r\n          successful: results.filter((r) => r.success).length,\r\n          failed: errors.length,\r\n          errors,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      this.emit('batchOperation:error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Batch update wages\r\n   */\r\n  async batchUpdateWages(wageUpdatesList) {\r\n    try {\r\n      const results = [];\r\n      const errors = [];\r\n\r\n      for (const update of wageUpdatesList) {\r\n        try {\r\n          const result = await this.updateEmployeeWage(\r\n            update.iqamaNumber,\r\n            update.wageData\r\n          );\r\n          results.push({ success: true, data: result });\r\n        } catch (error) {\r\n          errors.push({\r\n            iqama: update.iqamaNumber,\r\n            error: error.message,\r\n          });\r\n          results.push({ success: false, error: error.message });\r\n        }\r\n      }\r\n\r\n      this.emit('batchWageUpdate:completed', {\r\n        total: wageUpdatesList.length,\r\n        successful: results.filter((r) => r.success).length,\r\n        failed: errors.length,\r\n      });\r\n\r\n      return {\r\n        results,\r\n        summary: {\r\n          total: wageUpdatesList.length,\r\n          successful: results.filter((r) => r.success).length,\r\n          failed: errors.length,\r\n          errors,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      this.emit('batchWageUpdate:error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // UTILITIES & HELPERS\r\n  // =====================================================\r\n\r\n  /**\r\n   * Validate input using validation rules\r\n   */\r\n  _validate(field, value, customMessage = '') {\r\n    const rule = this.validationRules[field];\r\n    if (rule && !rule.test(value)) {\r\n      throw new Error(customMessage || `Invalid ${field}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate contract data structure\r\n   */\r\n  _validateContract(contractData) {\r\n    const required = [\r\n      'employeeIqama',\r\n      'contractType',\r\n      'jobTitle',\r\n      'basicSalary',\r\n      'startDate',\r\n    ];\r\n\r\n    for (const field of required) {\r\n      if (!contractData[field]) {\r\n        throw new Error(`Missing required field: ${field}`);\r\n      }\r\n    }\r\n\r\n    this._validate('iqama', contractData.employeeIqama);\r\n\r\n    if (contractData.basicSalary < 0) {\r\n      throw new Error('Salary cannot be negative');\r\n    }\r\n\r\n    if (\r\n      contractData.contractType !== 'limited' &&\r\n      contractData.contractType !== 'unlimited'\r\n    ) {\r\n      throw new Error('Invalid contract type');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Normalize contract data for API\r\n   */\r\n  _normalizeContractData(data) {\r\n    return {\r\n      employeeIqama: data.employeeIqama,\r\n      contractType: data.contractType,\r\n      jobTitle: data.jobTitle,\r\n      jobTitleArabic: data.jobTitleArabic || '',\r\n      basicSalary: Math.round(data.basicSalary * 100) / 100,\r\n      housingAllowance: data.housingAllowance || 0,\r\n      transportAllowance: data.transportAllowance || 0,\r\n      otherAllowances: data.otherAllowances || 0,\r\n      startDate: new Date(data.startDate).toISOString().split('T')[0],\r\n      endDate: data.endDate\r\n        ? new Date(data.endDate).toISOString().split('T')[0]\r\n        : null,\r\n      workingHours: data.workingHours || 8,\r\n      workingDays: data.workingDays || [\r\n        'sun',\r\n        'mon',\r\n        'tue',\r\n        'wed',\r\n        'thu',\r\n      ],\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Normalize wage data for API\r\n   */\r\n  _normalizeWageData(data) {\r\n    return {\r\n      basicSalary: Math.round(data.basicSalary * 100) / 100,\r\n      housingAllowance: data.housingAllowance || 0,\r\n      transportAllowance: data.transportAllowance || 0,\r\n      otherAllowances: data.otherAllowances || 0,\r\n      totalSalary:\r\n        Math.round(\r\n          ((data.basicSalary || 0) +\r\n            (data.housingAllowance || 0) +\r\n            (data.transportAllowance || 0) +\r\n            (data.otherAllowances || 0)) *\r\n            100\r\n        ) / 100,\r\n      effectiveDate: new Date(data.effectiveDate || new Date())\r\n        .toISOString()\r\n        .split('T')[0],\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Normalize payroll data\r\n   */\r\n  _normalizePayrollData(data) {\r\n    return {\r\n      period: data.period,\r\n      submissionType: data.submissionType || 'regular',\r\n      employees: (data.employees || []).map((emp) => ({\r\n        iqamaNumber: emp.iqamaNumber,\r\n        basicSalary: Math.round(emp.basicSalary * 100) / 100,\r\n        allowances: emp.allowances || {},\r\n        deductions: emp.deductions || {},\r\n        netSalary: Math.round(emp.netSalary * 100) / 100,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Transform API response to standard format\r\n   */\r\n  _transformResponse(response, type) {\r\n    if (!response.data) {\r\n      throw new Error('Invalid API response');\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      type,\r\n      data: response.data,\r\n      statusCode: response.statusCode,\r\n      timestamp: new Date(),\r\n      cached: response.cached || false,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Format error response\r\n   */\r\n  _formatError(error) {\r\n    const formattedError = new Error(\r\n      error.response?.data?.message || error.message || 'Unknown error'\r\n    );\r\n\r\n    formattedError.statusCode = error.response?.status || 500;\r\n    formattedError.data = error.response?.data || {};\r\n    formattedError.originalError = error;\r\n\r\n    return formattedError;\r\n  }\r\n\r\n  // =====================================================\r\n  // CACHING\r\n  // =====================================================\r\n\r\n  /**\r\n   * Get cached data\r\n   */\r\n  _getCache(key) {\r\n    const expiry = this.cacheExpiry.get(key);\r\n    if (expiry && Date.now() > expiry) {\r\n      this.cache.delete(key);\r\n      this.cacheExpiry.delete(key);\r\n      return null;\r\n    }\r\n    return this.cache.get(key);\r\n  }\r\n\r\n  /**\r\n   * Set cache data\r\n   */\r\n  _setCache(key, data, duration = 3600) {\r\n    this.cache.set(key, data);\r\n    this.cacheExpiry.set(key, Date.now() + duration * 1000);\r\n  }\r\n\r\n  /**\r\n   * Clear cache\r\n   */\r\n  clearCache(pattern = null) {\r\n    if (!pattern) {\r\n      this.cache.clear();\r\n      this.cacheExpiry.clear();\r\n      return { cleared: 'all' };\r\n    }\r\n\r\n    let cleared = 0;\r\n    for (const key of this.cache.keys()) {\r\n      if (key.includes(pattern)) {\r\n        this.cache.delete(key);\r\n        this.cacheExpiry.delete(key);\r\n        cleared++;\r\n      }\r\n    }\r\n\r\n    return { cleared };\r\n  }\r\n\r\n  // =====================================================\r\n  // MONITORING & METRICS\r\n  // =====================================================\r\n\r\n  /**\r\n   * Track request metrics\r\n   */\r\n  _trackMetrics(responseTime) {\r\n    this.metrics.requestTimes.push(responseTime);\r\n    if (this.metrics.requestTimes.length > 1000) {\r\n      this.metrics.requestTimes.shift();\r\n    }\r\n\r\n    const totalTime = this.metrics.requestTimes.reduce((a, b) => a + b, 0);\r\n    this.metrics.averageResponseTime =\r\n      Math.round(totalTime / this.metrics.requestTimes.length);\r\n  }\r\n\r\n  /**\r\n   * Get service metrics\r\n   */\r\n  getMetrics() {\r\n    return {\r\n      ...this.metrics,\r\n      successRate:\r\n        this.metrics.totalRequests > 0\r\n          ? Math.round(\r\n              (this.metrics.successfulRequests / this.metrics.totalRequests) *\r\n                100\r\n            )\r\n          : 0,\r\n      cacheHitRate:\r\n        this.metrics.totalRequests > 0\r\n          ? Math.round(\r\n              (this.metrics.cachedResponses / this.metrics.totalRequests) * 100\r\n            )\r\n          : 0,\r\n      recentRequests: this.requestHistory.slice(-100),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Health check\r\n   */\r\n  async healthCheck() {\r\n    try {\r\n      const response = await this._makeRequest('GET', '/health', null, {\r\n        skipCache: true,\r\n      });\r\n      return {\r\n        status: 'healthy',\r\n        timestamp: new Date(),\r\n        metrics: this.getMetrics(),\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        status: 'unhealthy',\r\n        timestamp: new Date(),\r\n        error: error.message,\r\n      };\r\n    }\r\n  }\r\n\r\n  // =====================================================\r\n  // LOGGING\r\n  // =====================================================\r\n\r\n  /**\r\n   * Internal logging method\r\n   */\r\n  _log(level, message, metadata = {}) {\r\n    const logEntry = {\r\n      timestamp: new Date(),\r\n      level,\r\n      message,\r\n      metadata,\r\n    };\r\n\r\n    this.requestHistory.push(logEntry);\r\n    if (this.requestHistory.length > 1000) {\r\n      this.requestHistory.shift();\r\n    }\r\n\r\n    if (level === 'error') {\r\n      console.error(`[Qiwa Service] ${message}`, metadata);\r\n    } else {\r\n      console.log(`[Qiwa Service] ${message}`, metadata);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get request history\r\n   */\r\n  getRequestHistory(filter = {}) {\r\n    let history = this.requestHistory;\r\n\r\n    if (filter.level) {\r\n      history = history.filter((h) => h.level === filter.level);\r\n    }\r\n\r\n    if (filter.limit) {\r\n      history = history.slice(-filter.limit);\r\n    }\r\n\r\n    return history;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nmodule.exports = QiwaService;\r\nmodule.exports.instance = new QiwaService();\r\n"],"mappings":"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","ignoreList":[]}