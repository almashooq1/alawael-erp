9ef6148d4924d4cb975edeef1d69659c
/**
 * متحكم الإشعارات الذكية
 * Smart Notifications Controller
 */

const SmartNotificationsService = require('../services/smartNotifications.service');
const Logger = require('../utils/logger');
class SmartNotificationsController {
  /**
   * إنشاء إشعار ذكي
   * POST /api/notifications/smart/create
   */
  static async createNotification(req, res) {
    try {
      const {
        title,
        message,
        type = 'info',
        priority = 'normal',
        channels = ['in-app'],
        metadata = {},
        scheduledFor = null
      } = req.body;
      const userId = req.user?.id;
      if (!title || !message) {
        return res.status(400).json({
          success: false,
          message: 'العنوان والرسالة مطلوبة',
          en: 'Title and message are required'
        });
      }
      const notification = SmartNotificationsService.createSmartNotification({
        userId,
        title,
        message,
        type,
        priority,
        channels,
        metadata,
        scheduledFor: scheduledFor ? new Date(scheduledFor) : null
      });
      Logger.info(`Notification created: ${notification.id} for user ${userId}`);
      res.status(201).json({
        success: true,
        message: 'تم إنشاء الإشعار بنجاح',
        en: 'Notification created successfully',
        data: notification
      });
    } catch (error) {
      Logger.error(`Create notification error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل إنشاء الإشعار',
        en: 'Failed to create notification',
        error: error.message
      });
    }
  }

  /**
   * إرسال إشعار مجموعي
   * POST /api/notifications/smart/broadcast
   */
  static async broadcastNotification(req, res) {
    try {
      const {
        userIds,
        title,
        message,
        type = 'info',
        priority = 'normal',
        channels = ['in-app', 'email'],
        metadata = {}
      } = req.body;
      if (!userIds || !Array.isArray(userIds) || userIds.length === 0) {
        return res.status(400).json({
          success: false,
          message: 'قائمة معرفات المستخدمين مطلوبة',
          en: 'User IDs array is required'
        });
      }
      const notifications = SmartNotificationsService.broadcastNotification(userIds, {
        title,
        message,
        type,
        priority,
        channels,
        metadata
      });
      Logger.info(`Broadcast notification sent to ${userIds.length} users`);
      res.status(201).json({
        success: true,
        message: `تم إرسال الإشعار إلى ${userIds.length} مستخدم`,
        en: `Notification sent to ${userIds.length} users`,
        data: {
          count: notifications.length,
          notifications
        }
      });
    } catch (error) {
      Logger.error(`Broadcast notification error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل إرسال الإشعار المجموعي',
        en: 'Failed to broadcast notification',
        error: error.message
      });
    }
  }

  /**
   * جلب إشعارات المستخدم
   * GET /api/notifications/smart/list
   */
  static async getNotifications(req, res) {
    try {
      const userId = req.user?.id;
      const {
        status = null,
        limit = 50,
        offset = 0,
        sortBy = 'createdAt'
      } = req.query;
      const notifications = SmartNotificationsService.getUserNotifications(userId, {
        status,
        limit: parseInt(limit),
        offset: parseInt(offset),
        sortBy
      });
      const stats = SmartNotificationsService.getNotificationStats(userId);
      res.json({
        success: true,
        message: 'تم جلب الإشعارات',
        en: 'Notifications retrieved',
        data: {
          notifications,
          stats,
          pagination: {
            limit: parseInt(limit),
            offset: parseInt(offset),
            total: stats.total
          }
        }
      });
    } catch (error) {
      Logger.error(`Get notifications error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل جلب الإشعارات',
        en: 'Failed to get notifications',
        error: error.message
      });
    }
  }

  /**
   * تحديث تفضيلات الإشعارات
   * PATCH /api/notifications/smart/preferences
   */
  static async updatePreferences(req, res) {
    try {
      const userId = req.user?.id;
      const preferences = req.body;
      const updated = SmartNotificationsService.updateUserPreferences(userId, preferences);
      Logger.info(`User ${userId} preferences updated`);
      res.json({
        success: true,
        message: 'تم تحديث التفضيلات',
        en: 'Preferences updated',
        data: updated
      });
    } catch (error) {
      Logger.error(`Update preferences error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل تحديث التفضيلات',
        en: 'Failed to update preferences',
        error: error.message
      });
    }
  }

  /**
   * تسجيل التفاعل مع الإشعار
   * POST /api/notifications/smart/:notificationId/interact
   */
  static async recordInteraction(req, res) {
    try {
      const {
        notificationId
      } = req.params;
      const {
        action
      } = req.body; // 'read', 'click', 'dismiss'

      if (!['read', 'click', 'dismiss'].includes(action)) {
        return res.status(400).json({
          success: false,
          message: 'إجراء غير صحيح',
          en: 'Invalid action'
        });
      }
      SmartNotificationsService.recordInteraction(notificationId, action);
      res.json({
        success: true,
        message: 'تم تسجيل التفاعل',
        en: 'Interaction recorded'
      });
    } catch (error) {
      Logger.error(`Record interaction error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل تسجيل التفاعل',
        en: 'Failed to record interaction',
        error: error.message
      });
    }
  }

  /**
   * حذف إشعار
   * DELETE /api/notifications/smart/:notificationId
   */
  static async deleteNotification(req, res) {
    try {
      const {
        notificationId
      } = req.params;
      const deleted = SmartNotificationsService.deleteNotification(notificationId);
      if (!deleted) {
        return res.status(404).json({
          success: false,
          message: 'الإشعار غير موجود',
          en: 'Notification not found'
        });
      }
      Logger.info(`Notification ${notificationId} deleted`);
      res.json({
        success: true,
        message: 'تم حذف الإشعار',
        en: 'Notification deleted'
      });
    } catch (error) {
      Logger.error(`Delete notification error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل حذف الإشعار',
        en: 'Failed to delete notification',
        error: error.message
      });
    }
  }

  /**
   * حذف جميع إشعارات المستخدم
   * DELETE /api/notifications/smart/all
   */
  static async clearAllNotifications(req, res) {
    try {
      const userId = req.user?.id;
      const count = SmartNotificationsService.clearUserNotifications(userId);
      Logger.info(`Cleared ${count} notifications for user ${userId}`);
      res.json({
        success: true,
        message: `تم حذف ${count} إشعار`,
        en: `Deleted ${count} notifications`,
        data: {
          deletedCount: count
        }
      });
    } catch (error) {
      Logger.error(`Clear notifications error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل حذف الإشعارات',
        en: 'Failed to clear notifications',
        error: error.message
      });
    }
  }

  /**
   * جلب إحصائيات الإشعارات
   * GET /api/notifications/smart/stats
   */
  static async getStats(req, res) {
    try {
      const userId = req.user?.id;
      const stats = SmartNotificationsService.getNotificationStats(userId);
      res.json({
        success: true,
        message: 'تم جلب الإحصائيات',
        en: 'Statistics retrieved',
        data: stats
      });
    } catch (error) {
      Logger.error(`Get stats error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل جلب الإحصائيات',
        en: 'Failed to get statistics',
        error: error.message
      });
    }
  }

  /**
   * جلب تقرير الأداء
   * GET /api/notifications/smart/performance
   */
  static async getPerformanceReport(req, res) {
    try {
      const userId = req.user?.id;
      const report = SmartNotificationsService.getPerformanceReport(userId);
      res.json({
        success: true,
        message: 'تم جلب التقرير',
        en: 'Report retrieved',
        data: report
      });
    } catch (error) {
      Logger.error(`Get performance report error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل جلب التقرير',
        en: 'Failed to get report',
        error: error.message
      });
    }
  }

  /**
   * معالجة طابور الإشعارات
   * POST /api/notifications/smart/process-queue
   */
  static async processQueue(req, res) {
    try {
      const processed = await SmartNotificationsService.processQueue();
      Logger.info(`Notification queue processed: ${processed.length} notifications sent`);
      res.json({
        success: true,
        message: `تم معالجة ${processed.length} إشعار`,
        en: `Processed ${processed.length} notifications`,
        data: {
          count: processed.length,
          notifications: processed
        }
      });
    } catch (error) {
      Logger.error(`Process queue error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'فشل معالجة الطابور',
        en: 'Failed to process queue',
        error: error.message
      });
    }
  }
}
module.exports = SmartNotificationsController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTbWFydE5vdGlmaWNhdGlvbnNTZXJ2aWNlIiwicmVxdWlyZSIsIkxvZ2dlciIsIlNtYXJ0Tm90aWZpY2F0aW9uc0NvbnRyb2xsZXIiLCJjcmVhdGVOb3RpZmljYXRpb24iLCJyZXEiLCJyZXMiLCJ0aXRsZSIsIm1lc3NhZ2UiLCJ0eXBlIiwicHJpb3JpdHkiLCJjaGFubmVscyIsIm1ldGFkYXRhIiwic2NoZWR1bGVkRm9yIiwiYm9keSIsInVzZXJJZCIsInVzZXIiLCJpZCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZW4iLCJub3RpZmljYXRpb24iLCJjcmVhdGVTbWFydE5vdGlmaWNhdGlvbiIsIkRhdGUiLCJpbmZvIiwiZGF0YSIsImVycm9yIiwiYnJvYWRjYXN0Tm90aWZpY2F0aW9uIiwidXNlcklkcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIm5vdGlmaWNhdGlvbnMiLCJjb3VudCIsImdldE5vdGlmaWNhdGlvbnMiLCJsaW1pdCIsIm9mZnNldCIsInNvcnRCeSIsInF1ZXJ5IiwiZ2V0VXNlck5vdGlmaWNhdGlvbnMiLCJwYXJzZUludCIsInN0YXRzIiwiZ2V0Tm90aWZpY2F0aW9uU3RhdHMiLCJwYWdpbmF0aW9uIiwidG90YWwiLCJ1cGRhdGVQcmVmZXJlbmNlcyIsInByZWZlcmVuY2VzIiwidXBkYXRlZCIsInVwZGF0ZVVzZXJQcmVmZXJlbmNlcyIsInJlY29yZEludGVyYWN0aW9uIiwibm90aWZpY2F0aW9uSWQiLCJwYXJhbXMiLCJhY3Rpb24iLCJpbmNsdWRlcyIsImRlbGV0ZU5vdGlmaWNhdGlvbiIsImRlbGV0ZWQiLCJjbGVhckFsbE5vdGlmaWNhdGlvbnMiLCJjbGVhclVzZXJOb3RpZmljYXRpb25zIiwiZGVsZXRlZENvdW50IiwiZ2V0U3RhdHMiLCJnZXRQZXJmb3JtYW5jZVJlcG9ydCIsInJlcG9ydCIsInByb2Nlc3NRdWV1ZSIsInByb2Nlc3NlZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJzbWFydE5vdGlmaWNhdGlvbnMuY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog2YXYqtit2YPZhSDYp9mE2KXYtNi52KfYsdin2Kog2KfZhNiw2YPZitipXHJcbiAqIFNtYXJ0IE5vdGlmaWNhdGlvbnMgQ29udHJvbGxlclxyXG4gKi9cclxuXHJcbmNvbnN0IFNtYXJ0Tm90aWZpY2F0aW9uc1NlcnZpY2UgPSByZXF1aXJlKCcuLi9zZXJ2aWNlcy9zbWFydE5vdGlmaWNhdGlvbnMuc2VydmljZScpO1xyXG5jb25zdCBMb2dnZXIgPSByZXF1aXJlKCcuLi91dGlscy9sb2dnZXInKTtcclxuXHJcbmNsYXNzIFNtYXJ0Tm90aWZpY2F0aW9uc0NvbnRyb2xsZXIge1xyXG4gIC8qKlxyXG4gICAqINil2YbYtNin2KEg2KXYtNi52KfYsSDYsNmD2YpcclxuICAgKiBQT1NUIC9hcGkvbm90aWZpY2F0aW9ucy9zbWFydC9jcmVhdGVcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgY3JlYXRlTm90aWZpY2F0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7XHJcbiAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICB0eXBlID0gJ2luZm8nLFxyXG4gICAgICAgIHByaW9yaXR5ID0gJ25vcm1hbCcsXHJcbiAgICAgICAgY2hhbm5lbHMgPSBbJ2luLWFwcCddLFxyXG4gICAgICAgIG1ldGFkYXRhID0ge30sXHJcbiAgICAgICAgc2NoZWR1bGVkRm9yID0gbnVsbCxcclxuICAgICAgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkO1xyXG5cclxuICAgICAgaWYgKCF0aXRsZSB8fCAhbWVzc2FnZSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIG1lc3NhZ2U6ICfYp9mE2LnZhtmI2KfZhiDZiNin2YTYsdiz2KfZhNipINmF2LfZhNmI2KjYqScsXHJcbiAgICAgICAgICBlbjogJ1RpdGxlIGFuZCBtZXNzYWdlIGFyZSByZXF1aXJlZCcsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IFNtYXJ0Tm90aWZpY2F0aW9uc1NlcnZpY2UuY3JlYXRlU21hcnROb3RpZmljYXRpb24oe1xyXG4gICAgICAgIHVzZXJJZCxcclxuICAgICAgICB0aXRsZSxcclxuICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgIHR5cGUsXHJcbiAgICAgICAgcHJpb3JpdHksXHJcbiAgICAgICAgY2hhbm5lbHMsXHJcbiAgICAgICAgbWV0YWRhdGEsXHJcbiAgICAgICAgc2NoZWR1bGVkRm9yOiBzY2hlZHVsZWRGb3IgPyBuZXcgRGF0ZShzY2hlZHVsZWRGb3IpIDogbnVsbCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBMb2dnZXIuaW5mbyhgTm90aWZpY2F0aW9uIGNyZWF0ZWQ6ICR7bm90aWZpY2F0aW9uLmlkfSBmb3IgdXNlciAke3VzZXJJZH1gKTtcclxuXHJcbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfYqtmFINil2YbYtNin2KEg2KfZhNil2LTYudin2LEg2KjZhtis2KfYrScsXHJcbiAgICAgICAgZW46ICdOb3RpZmljYXRpb24gY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICAgIGRhdGE6IG5vdGlmaWNhdGlvbixcclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBMb2dnZXIuZXJyb3IoYENyZWF0ZSBub3RpZmljYXRpb24gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfZgdi02YQg2KXZhti02KfYoSDYp9mE2KXYtNi52KfYsScsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gY3JlYXRlIG5vdGlmaWNhdGlvbicsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KXYsdiz2KfZhCDYpdi02LnYp9ixINmF2KzZhdmI2LnZilxyXG4gICAqIFBPU1QgL2FwaS9ub3RpZmljYXRpb25zL3NtYXJ0L2Jyb2FkY2FzdFxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBicm9hZGNhc3ROb3RpZmljYXRpb24ocmVxLCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHtcclxuICAgICAgICB1c2VySWRzLFxyXG4gICAgICAgIHRpdGxlLFxyXG4gICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgdHlwZSA9ICdpbmZvJyxcclxuICAgICAgICBwcmlvcml0eSA9ICdub3JtYWwnLFxyXG4gICAgICAgIGNoYW5uZWxzID0gWydpbi1hcHAnLCAnZW1haWwnXSxcclxuICAgICAgICBtZXRhZGF0YSA9IHt9LFxyXG4gICAgICB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICBpZiAoIXVzZXJJZHMgfHwgIUFycmF5LmlzQXJyYXkodXNlcklkcykgfHwgdXNlcklkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBtZXNzYWdlOiAn2YLYp9im2YXYqSDZhdi52LHZgdin2Kog2KfZhNmF2LPYqtiu2K/ZhdmK2YYg2YXYt9mE2YjYqNipJyxcclxuICAgICAgICAgIGVuOiAnVXNlciBJRHMgYXJyYXkgaXMgcmVxdWlyZWQnLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBub3RpZmljYXRpb25zID1cclxuICAgICAgICBTbWFydE5vdGlmaWNhdGlvbnNTZXJ2aWNlLmJyb2FkY2FzdE5vdGlmaWNhdGlvbih1c2VySWRzLCB7XHJcbiAgICAgICAgICB0aXRsZSxcclxuICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgcHJpb3JpdHksXHJcbiAgICAgICAgICBjaGFubmVscyxcclxuICAgICAgICAgIG1ldGFkYXRhLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgTG9nZ2VyLmluZm8oXHJcbiAgICAgICAgYEJyb2FkY2FzdCBub3RpZmljYXRpb24gc2VudCB0byAke3VzZXJJZHMubGVuZ3RofSB1c2Vyc2BcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6IGDYqtmFINil2LHYs9in2YQg2KfZhNil2LTYudin2LEg2KXZhNmJICR7dXNlcklkcy5sZW5ndGh9INmF2LPYqtiu2K/ZhWAsXHJcbiAgICAgICAgZW46IGBOb3RpZmljYXRpb24gc2VudCB0byAke3VzZXJJZHMubGVuZ3RofSB1c2Vyc2AsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgY291bnQ6IG5vdGlmaWNhdGlvbnMubGVuZ3RoLFxyXG4gICAgICAgICAgbm90aWZpY2F0aW9ucyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIExvZ2dlci5lcnJvcihgQnJvYWRjYXN0IG5vdGlmaWNhdGlvbiBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ9mB2LTZhCDYpdix2LPYp9mEINin2YTYpdi02LnYp9ixINin2YTZhdis2YXZiNi52YonLFxyXG4gICAgICAgIGVuOiAnRmFpbGVkIHRvIGJyb2FkY2FzdCBub3RpZmljYXRpb24nLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINis2YTYqCDYpdi02LnYp9ix2KfYqiDYp9mE2YXYs9iq2K7Yr9mFXHJcbiAgICogR0VUIC9hcGkvbm90aWZpY2F0aW9ucy9zbWFydC9saXN0XHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldE5vdGlmaWNhdGlvbnMocmVxLCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZDtcclxuICAgICAgY29uc3Qge1xyXG4gICAgICAgIHN0YXR1cyA9IG51bGwsXHJcbiAgICAgICAgbGltaXQgPSA1MCxcclxuICAgICAgICBvZmZzZXQgPSAwLFxyXG4gICAgICAgIHNvcnRCeSA9ICdjcmVhdGVkQXQnLFxyXG4gICAgICB9ID0gcmVxLnF1ZXJ5O1xyXG5cclxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9ucyA9IFNtYXJ0Tm90aWZpY2F0aW9uc1NlcnZpY2UuZ2V0VXNlck5vdGlmaWNhdGlvbnMoXHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN0YXR1cyxcclxuICAgICAgICAgIGxpbWl0OiBwYXJzZUludChsaW1pdCksXHJcbiAgICAgICAgICBvZmZzZXQ6IHBhcnNlSW50KG9mZnNldCksXHJcbiAgICAgICAgICBzb3J0QnksXHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgY29uc3Qgc3RhdHMgPSBTbWFydE5vdGlmaWNhdGlvbnNTZXJ2aWNlLmdldE5vdGlmaWNhdGlvblN0YXRzKHVzZXJJZCk7XHJcblxyXG4gICAgICByZXMuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiAn2KrZhSDYrNmE2Kgg2KfZhNil2LTYudin2LHYp9iqJyxcclxuICAgICAgICBlbjogJ05vdGlmaWNhdGlvbnMgcmV0cmlldmVkJyxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBub3RpZmljYXRpb25zLFxyXG4gICAgICAgICAgc3RhdHMsXHJcbiAgICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICAgIGxpbWl0OiBwYXJzZUludChsaW1pdCksXHJcbiAgICAgICAgICAgIG9mZnNldDogcGFyc2VJbnQob2Zmc2V0KSxcclxuICAgICAgICAgICAgdG90YWw6IHN0YXRzLnRvdGFsLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIExvZ2dlci5lcnJvcihgR2V0IG5vdGlmaWNhdGlvbnMgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfZgdi02YQg2KzZhNioINin2YTYpdi02LnYp9ix2KfYqicsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gZ2V0IG5vdGlmaWNhdGlvbnMnLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINiq2K3Yr9mK2Ksg2KrZgdi22YrZhNin2Kog2KfZhNil2LTYudin2LHYp9iqXHJcbiAgICogUEFUQ0ggL2FwaS9ub3RpZmljYXRpb25zL3NtYXJ0L3ByZWZlcmVuY2VzXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHVwZGF0ZVByZWZlcmVuY2VzKHJlcSwgcmVzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQ7XHJcbiAgICAgIGNvbnN0IHByZWZlcmVuY2VzID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVkID0gU21hcnROb3RpZmljYXRpb25zU2VydmljZS51cGRhdGVVc2VyUHJlZmVyZW5jZXMoXHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIHByZWZlcmVuY2VzXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBMb2dnZXIuaW5mbyhgVXNlciAke3VzZXJJZH0gcHJlZmVyZW5jZXMgdXBkYXRlZGApO1xyXG5cclxuICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ9iq2YUg2KrYrdiv2YrYqyDYp9mE2KrZgdi22YrZhNin2KonLFxyXG4gICAgICAgIGVuOiAnUHJlZmVyZW5jZXMgdXBkYXRlZCcsXHJcbiAgICAgICAgZGF0YTogdXBkYXRlZCxcclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBMb2dnZXIuZXJyb3IoYFVwZGF0ZSBwcmVmZXJlbmNlcyBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ9mB2LTZhCDYqtit2K/ZitirINin2YTYqtmB2LbZitmE2KfYqicsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gdXBkYXRlIHByZWZlcmVuY2VzJyxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYqtiz2KzZitmEINin2YTYqtmB2KfYudmEINmF2Lkg2KfZhNil2LTYudin2LFcclxuICAgKiBQT1NUIC9hcGkvbm90aWZpY2F0aW9ucy9zbWFydC86bm90aWZpY2F0aW9uSWQvaW50ZXJhY3RcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgcmVjb3JkSW50ZXJhY3Rpb24ocmVxLCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgbm90aWZpY2F0aW9uSWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICAgIGNvbnN0IHsgYWN0aW9uIH0gPSByZXEuYm9keTsgLy8gJ3JlYWQnLCAnY2xpY2snLCAnZGlzbWlzcydcclxuXHJcbiAgICAgIGlmICghWydyZWFkJywgJ2NsaWNrJywgJ2Rpc21pc3MnXS5pbmNsdWRlcyhhY3Rpb24pKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ9il2KzYsdin2KEg2LrZitixINi12K3ZititJyxcclxuICAgICAgICAgIGVuOiAnSW52YWxpZCBhY3Rpb24nLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBTbWFydE5vdGlmaWNhdGlvbnNTZXJ2aWNlLnJlY29yZEludGVyYWN0aW9uKG5vdGlmaWNhdGlvbklkLCBhY3Rpb24pO1xyXG5cclxuICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ9iq2YUg2KrYs9is2YrZhCDYp9mE2KrZgdin2LnZhCcsXHJcbiAgICAgICAgZW46ICdJbnRlcmFjdGlvbiByZWNvcmRlZCcsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgTG9nZ2VyLmVycm9yKGBSZWNvcmQgaW50ZXJhY3Rpb24gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfZgdi02YQg2KrYs9is2YrZhCDYp9mE2KrZgdin2LnZhCcsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gcmVjb3JkIGludGVyYWN0aW9uJyxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDYrdiw2YEg2KXYtNi52KfYsVxyXG4gICAqIERFTEVURSAvYXBpL25vdGlmaWNhdGlvbnMvc21hcnQvOm5vdGlmaWNhdGlvbklkXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGRlbGV0ZU5vdGlmaWNhdGlvbihyZXEsIHJlcykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBub3RpZmljYXRpb25JZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICAgIGNvbnN0IGRlbGV0ZWQgPVxyXG4gICAgICAgIFNtYXJ0Tm90aWZpY2F0aW9uc1NlcnZpY2UuZGVsZXRlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbklkKTtcclxuXHJcbiAgICAgIGlmICghZGVsZXRlZCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIG1lc3NhZ2U6ICfYp9mE2KXYtNi52KfYsSDYutmK2LEg2YXZiNis2YjYrycsXHJcbiAgICAgICAgICBlbjogJ05vdGlmaWNhdGlvbiBub3QgZm91bmQnLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBMb2dnZXIuaW5mbyhgTm90aWZpY2F0aW9uICR7bm90aWZpY2F0aW9uSWR9IGRlbGV0ZWRgKTtcclxuXHJcbiAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfYqtmFINit2LDZgSDYp9mE2KXYtNi52KfYsScsXHJcbiAgICAgICAgZW46ICdOb3RpZmljYXRpb24gZGVsZXRlZCcsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgTG9nZ2VyLmVycm9yKGBEZWxldGUgbm90aWZpY2F0aW9uIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAn2YHYtNmEINit2LDZgSDYp9mE2KXYtNi52KfYsScsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gZGVsZXRlIG5vdGlmaWNhdGlvbicsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2K3YsNmBINis2YXZiti5INil2LTYudin2LHYp9iqINin2YTZhdiz2KrYrtiv2YVcclxuICAgKiBERUxFVEUgL2FwaS9ub3RpZmljYXRpb25zL3NtYXJ0L2FsbFxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBjbGVhckFsbE5vdGlmaWNhdGlvbnMocmVxLCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZDtcclxuXHJcbiAgICAgIGNvbnN0IGNvdW50ID0gU21hcnROb3RpZmljYXRpb25zU2VydmljZS5jbGVhclVzZXJOb3RpZmljYXRpb25zKHVzZXJJZCk7XHJcblxyXG4gICAgICBMb2dnZXIuaW5mbyhgQ2xlYXJlZCAke2NvdW50fSBub3RpZmljYXRpb25zIGZvciB1c2VyICR7dXNlcklkfWApO1xyXG5cclxuICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogYNiq2YUg2K3YsNmBICR7Y291bnR9INil2LTYudin2LFgLFxyXG4gICAgICAgIGVuOiBgRGVsZXRlZCAke2NvdW50fSBub3RpZmljYXRpb25zYCxcclxuICAgICAgICBkYXRhOiB7IGRlbGV0ZWRDb3VudDogY291bnQgfSxcclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBMb2dnZXIuZXJyb3IoYENsZWFyIG5vdGlmaWNhdGlvbnMgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfZgdi02YQg2K3YsNmBINin2YTYpdi02LnYp9ix2KfYqicsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gY2xlYXIgbm90aWZpY2F0aW9ucycsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2KzZhNioINil2K3Ytdin2KbZitin2Kog2KfZhNil2LTYudin2LHYp9iqXHJcbiAgICogR0VUIC9hcGkvbm90aWZpY2F0aW9ucy9zbWFydC9zdGF0c1xyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBnZXRTdGF0cyhyZXEsIHJlcykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkO1xyXG5cclxuICAgICAgY29uc3Qgc3RhdHMgPSBTbWFydE5vdGlmaWNhdGlvbnNTZXJ2aWNlLmdldE5vdGlmaWNhdGlvblN0YXRzKHVzZXJJZCk7XHJcblxyXG4gICAgICByZXMuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiAn2KrZhSDYrNmE2Kgg2KfZhNil2K3Ytdin2KbZitin2KonLFxyXG4gICAgICAgIGVuOiAnU3RhdGlzdGljcyByZXRyaWV2ZWQnLFxyXG4gICAgICAgIGRhdGE6IHN0YXRzLFxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIExvZ2dlci5lcnJvcihgR2V0IHN0YXRzIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAn2YHYtNmEINis2YTYqCDYp9mE2KXYrdi12KfYptmK2KfYqicsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gZ2V0IHN0YXRpc3RpY3MnLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqINis2YTYqCDYqtmC2LHZitixINin2YTYo9iv2KfYoVxyXG4gICAqIEdFVCAvYXBpL25vdGlmaWNhdGlvbnMvc21hcnQvcGVyZm9ybWFuY2VcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0UGVyZm9ybWFuY2VSZXBvcnQocmVxLCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZDtcclxuXHJcbiAgICAgIGNvbnN0IHJlcG9ydCA9IFNtYXJ0Tm90aWZpY2F0aW9uc1NlcnZpY2UuZ2V0UGVyZm9ybWFuY2VSZXBvcnQodXNlcklkKTtcclxuXHJcbiAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICfYqtmFINis2YTYqCDYp9mE2KrZgtix2YrYsScsXHJcbiAgICAgICAgZW46ICdSZXBvcnQgcmV0cmlldmVkJyxcclxuICAgICAgICBkYXRhOiByZXBvcnQsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgTG9nZ2VyLmVycm9yKGBHZXQgcGVyZm9ybWFuY2UgcmVwb3J0IGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAn2YHYtNmEINis2YTYqCDYp9mE2KrZgtix2YrYsScsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gZ2V0IHJlcG9ydCcsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog2YXYudin2YTYrNipINi32KfYqNmI2LEg2KfZhNil2LTYudin2LHYp9iqXHJcbiAgICogUE9TVCAvYXBpL25vdGlmaWNhdGlvbnMvc21hcnQvcHJvY2Vzcy1xdWV1ZVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBwcm9jZXNzUXVldWUocmVxLCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHByb2Nlc3NlZCA9IGF3YWl0IFNtYXJ0Tm90aWZpY2F0aW9uc1NlcnZpY2UucHJvY2Vzc1F1ZXVlKCk7XHJcblxyXG4gICAgICBMb2dnZXIuaW5mbyhcclxuICAgICAgICBgTm90aWZpY2F0aW9uIHF1ZXVlIHByb2Nlc3NlZDogJHtwcm9jZXNzZWQubGVuZ3RofSBub3RpZmljYXRpb25zIHNlbnRgXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXMuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiBg2KrZhSDZhdi52KfZhNis2KkgJHtwcm9jZXNzZWQubGVuZ3RofSDYpdi02LnYp9ixYCxcclxuICAgICAgICBlbjogYFByb2Nlc3NlZCAke3Byb2Nlc3NlZC5sZW5ndGh9IG5vdGlmaWNhdGlvbnNgLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIGNvdW50OiBwcm9jZXNzZWQubGVuZ3RoLFxyXG4gICAgICAgICAgbm90aWZpY2F0aW9uczogcHJvY2Vzc2VkLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgTG9nZ2VyLmVycm9yKGBQcm9jZXNzIHF1ZXVlIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAn2YHYtNmEINmF2LnYp9mE2KzYqSDYp9mE2LfYp9io2YjYsScsXHJcbiAgICAgICAgZW46ICdGYWlsZWQgdG8gcHJvY2VzcyBxdWV1ZScsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBTbWFydE5vdGlmaWNhdGlvbnNDb250cm9sbGVyO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLHlCQUF5QixHQUFHQyxPQUFPLENBQUMsd0NBQXdDLENBQUM7QUFDbkYsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFFekMsTUFBTUUsNEJBQTRCLENBQUM7RUFDakM7QUFDRjtBQUNBO0FBQ0E7RUFDRSxhQUFhQyxrQkFBa0JBLENBQUNDLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQ3hDLElBQUk7TUFDRixNQUFNO1FBQ0pDLEtBQUs7UUFDTEMsT0FBTztRQUNQQyxJQUFJLEdBQUcsTUFBTTtRQUNiQyxRQUFRLEdBQUcsUUFBUTtRQUNuQkMsUUFBUSxHQUFHLENBQUMsUUFBUSxDQUFDO1FBQ3JCQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2JDLFlBQVksR0FBRztNQUNqQixDQUFDLEdBQUdSLEdBQUcsQ0FBQ1MsSUFBSTtNQUVaLE1BQU1DLE1BQU0sR0FBR1YsR0FBRyxDQUFDVyxJQUFJLEVBQUVDLEVBQUU7TUFFM0IsSUFBSSxDQUFDVixLQUFLLElBQUksQ0FBQ0MsT0FBTyxFQUFFO1FBQ3RCLE9BQU9GLEdBQUcsQ0FBQ1ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7VUFDMUJDLE9BQU8sRUFBRSxLQUFLO1VBQ2RaLE9BQU8sRUFBRSx5QkFBeUI7VUFDbENhLEVBQUUsRUFBRTtRQUNOLENBQUMsQ0FBQztNQUNKO01BRUEsTUFBTUMsWUFBWSxHQUFHdEIseUJBQXlCLENBQUN1Qix1QkFBdUIsQ0FBQztRQUNyRVIsTUFBTTtRQUNOUixLQUFLO1FBQ0xDLE9BQU87UUFDUEMsSUFBSTtRQUNKQyxRQUFRO1FBQ1JDLFFBQVE7UUFDUkMsUUFBUTtRQUNSQyxZQUFZLEVBQUVBLFlBQVksR0FBRyxJQUFJ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