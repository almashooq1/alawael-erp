{"version":3,"names":["mongoose","require","logger","EventEmitter","notificationPreferencesSchema","Schema","userId","type","String","required","unique","channels","email","Boolean","default","sms","whatsapp","inApp","push","dashboard","contactInfo","phoneNumber","whatsappNumber","language","enum","rateLimits","emailPerDay","Number","smsPerDay","whatsappPerDay","pushPerDay","totalPerDay","quietHours","enabled","startTime","endTime","timezone","daysOff","categoryPreferences","system","business","transaction","security","reminder","warning","success","error","priorityPreferences","low","medium","high","critical","soundAndVibration","enableSound","soundType","enableVibration","vibrationPattern","privacy","doNotTrack","doNotShare","allowAnalytics","dataRetentionDays","blacklist","categories","senders","keywords","whitelist","trustedDevices","statistics","totalNotificationsReceived","totalNotificationsRead","avgReadTime","lastUpdated","Date","now","digestPreferences","enableDigest","digestFrequency","digestTime","smartNotifications","adaptive","predictiveDelivery","contextualGrouping","consents","marketingEmails","transactionalEmails","analyticsTracking","consentDate","isActive","suspendedUntil","createdAt","updatedAt","lastModifiedBy","notes","index","NotificationPreferences","model","UserPreferencesManager","constructor","cache","Map","cacheTimeout","getPreferences","has","get","preferences","findOne","exec","createDefaultPreferences","set","setTimeout","delete","message","savedPreferences","save","info","updatePreferences","updates","updatedPreferences","findOneAndUpdate","new","upsert","emit","updateChannels","updateContactInfo","updateQuietHours","updateRateLimits","updateCategoryPreferences","canSendNotification","notificationData","allowed","reason","channel","category","priority","isBlacklisted","isWithinActiveHours","checkRateLimit","includes","sender","fullText","title","body","toLowerCase","some","keyword","day","toLocaleString","weekday","currentTime","toLocaleTimeString","hour","minute","hour12","limit","addToBlacklist","value","removeFromBlacklist","filter","item","suspendNotifications","hours","resumeNotifications","disableAllNotifications","enableAllNotifications","updateStatistics","readTime","total","getStatistics","clearCache","size","clear","module","exports","preferencesManager"],"sources":["userPreferencesManager.js"],"sourcesContent":["/**\r\n * ═══════════════════════════════════════════════════════════════\r\n * ⚙️ User Notification Preferences Manager\r\n * مدير تفضيلات الإشعارات للمستخدمين\r\n * ═══════════════════════════════════════════════════════════════\r\n * \r\n * نظام متقدم لإدارة تفضيلات الإشعارات:\r\n * - القنوات المفضلة\r\n * - ساعات العمل والراحة\r\n * - حدود التكرار (Rate Limiting)\r\n * - الفئات والأنواع المفضلة\r\n * - إعدادات الخصوصية والأمان\r\n */\r\n\r\nconst mongoose = require('mongoose');\r\nconst logger = require('../utils/logger');\r\nconst EventEmitter = require('events');\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 📋 نموذج تفضيلات الإشعارات\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\nconst notificationPreferencesSchema = new mongoose.Schema({\r\n  userId: { type: String, required: true, unique: true },\r\n\r\n  // القنوات المفعلة\r\n  channels: {\r\n    email: { type: Boolean, default: true },\r\n    sms: { type: Boolean, default: false },\r\n    whatsapp: { type: Boolean, default: false },\r\n    inApp: { type: Boolean, default: true },\r\n    push: { type: Boolean, default: true },\r\n    dashboard: { type: Boolean, default: true },\r\n  },\r\n\r\n  // معلومات الاتصال\r\n  contactInfo: {\r\n    email: { type: String, default: null },\r\n    phoneNumber: { type: String, default: null },\r\n    whatsappNumber: { type: String, default: null },\r\n    language: { type: String, enum: ['ar', 'en'], default: 'ar' },\r\n  },\r\n\r\n  // حدود التكرار\r\n  rateLimits: {\r\n    emailPerDay: { type: Number, default: 50 },\r\n    smsPerDay: { type: Number, default: 10 },\r\n    whatsappPerDay: { type: Number, default: 20 },\r\n    pushPerDay: { type: Number, default: 30 },\r\n    totalPerDay: { type: Number, default: 100 },\r\n  },\r\n\r\n  // ساعات العمل (لتجنب الإزعاج)\r\n  quietHours: {\r\n    enabled: { type: Boolean, default: false },\r\n    startTime: String, // \"22:00\"\r\n    endTime: String,   // \"08:00\"\r\n    timezone: { type: String, default: 'Asia/Riyadh' },\r\n    daysOff: [String], // [\"friday\", \"saturday\"]\r\n  },\r\n\r\n  // تفضيلات الفئات\r\n  categoryPreferences: {\r\n    system: { type: Boolean, default: true },\r\n    business: { type: Boolean, default: true },\r\n    transaction: { type: Boolean, default: true },\r\n    security: { type: Boolean, default: true },\r\n    reminder: { type: Boolean, default: true },\r\n    warning: { type: Boolean, default: true },\r\n    success: { type: Boolean, default: true },\r\n    error: { type: Boolean, default: true },\r\n  },\r\n\r\n  // تفضيلات الأولوية\r\n  priorityPreferences: {\r\n    low: { type: Boolean, default: true },\r\n    medium: { type: Boolean, default: true },\r\n    high: { type: Boolean, default: true },\r\n    critical: { type: Boolean, default: true },\r\n  },\r\n\r\n  // إعدادات الصوت والاهتزاز\r\n  soundAndVibration: {\r\n    enableSound: { type: Boolean, default: true },\r\n    soundType: {\r\n      type: String,\r\n      enum: ['default', 'bell', 'chime', 'alert', 'none'],\r\n      default: 'default',\r\n    },\r\n    enableVibration: { type: Boolean, default: true },\r\n    vibrationPattern: {\r\n      type: String,\r\n      enum: ['normal', 'strong', 'light', 'silent'],\r\n      default: 'normal',\r\n    },\r\n  },\r\n\r\n  // إعدادات الخصوصية\r\n  privacy: {\r\n    doNotTrack: { type: Boolean, default: false },\r\n    doNotShare: { type: Boolean, default: false },\r\n    allowAnalytics: { type: Boolean, default: true },\r\n    dataRetentionDays: { type: Number, default: 90 },\r\n  },\r\n\r\n  // قائمة الحظر (Blacklist)\r\n  blacklist: {\r\n    categories: [String],\r\n    senders: [String],\r\n    keywords: [String],\r\n  },\r\n\r\n  // قائمة البيضاء (Whitelist)\r\n  whitelist: {\r\n    senders: [String],\r\n    trustedDevices: [String],\r\n  },\r\n\r\n  // الإحصائيات\r\n  statistics: {\r\n    totalNotificationsReceived: { type: Number, default: 0 },\r\n    totalNotificationsRead: { type: Number, default: 0 },\r\n    avgReadTime: { type: Number, default: 0 }, // ثواني\r\n    lastUpdated: { type: Date, default: Date.now },\r\n  },\r\n\r\n  // التنبيهات المجمعة\r\n  digestPreferences: {\r\n    enableDigest: { type: Boolean, default: false },\r\n    digestFrequency: {\r\n      type: String,\r\n      enum: ['daily', 'weekly', 'monthly'],\r\n      default: 'daily',\r\n    },\r\n    digestTime: String, // \"09:00\"\r\n  },\r\n\r\n  // إعدادات التنبيهات الذكية\r\n  smartNotifications: {\r\n    adaptive: { type: Boolean, default: true },\r\n    predictiveDelivery: { type: Boolean, default: true },\r\n    contextualGrouping: { type: Boolean, default: true },\r\n  },\r\n\r\n  // موافقة المستخدم\r\n  consents: {\r\n    marketingEmails: { type: Boolean, default: false },\r\n    transactionalEmails: { type: Boolean, default: true },\r\n    analyticsTracking: { type: Boolean, default: false },\r\n    consentDate: Date,\r\n  },\r\n\r\n  // التحكم والحالة\r\n  isActive: { type: Boolean, default: true },\r\n  suspendedUntil: Date,\r\n  createdAt: { type: Date, default: Date.now },\r\n  updatedAt: { type: Date, default: Date.now },\r\n  lastModifiedBy: String,\r\n  notes: String,\r\n});\r\n\r\n// فهرسة لتحسين الأداء\r\nnotificationPreferencesSchema.index({ userId: 1 });\r\nnotificationPreferencesSchema.index({ isActive: 1 });\r\n\r\nconst NotificationPreferences = mongoose.model(\r\n  'NotificationPreferences',\r\n  notificationPreferencesSchema\r\n);\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 🎯 مدير التفضيلات\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\nclass UserPreferencesManager extends EventEmitter {\r\n  constructor() {\r\n    super();\r\n\r\n    // ذاكرة التخزين المؤقت للتفضيلات\r\n    this.cache = new Map();\r\n    this.cacheTimeout = 1800000; // 30 دقيقة\r\n  }\r\n\r\n  /**\r\n   * ═══════════════════════════════════════════════════════════════\r\n   * 📖 جلب التفضيلات\r\n   * ═══════════════════════════════════════════════════════════════\r\n   */\r\n\r\n  /**\r\n   * الحصول على تفضيلات المستخدم\r\n   */\r\n  async getPreferences(userId) {\r\n    try {\r\n      // البحث في الذاكرة المؤقتة\r\n      if (this.cache.has(userId)) {\r\n        return this.cache.get(userId);\r\n      }\r\n\r\n      // البحث في قاعدة البيانات\r\n      let preferences = await NotificationPreferences.findOne({\r\n        userId,\r\n      }).exec();\r\n\r\n      // إنشاء تفضيلات افتراضية إذا لم تكن موجودة\r\n      if (!preferences) {\r\n        preferences = await this.createDefaultPreferences(userId);\r\n      }\r\n\r\n      // إضافة إلى الذاكرة المؤقتة\r\n      this.cache.set(userId, preferences);\r\n\r\n      // تحديد وقت انتهاء الصلاحية\r\n      setTimeout(() => this.cache.delete(userId), this.cacheTimeout);\r\n\r\n      return preferences;\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في جلب التفضيلات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إنشاء تفضيلات افتراضية\r\n   */\r\n  async createDefaultPreferences(userId) {\r\n    try {\r\n      const preferences = new NotificationPreferences({\r\n        userId,\r\n      });\r\n\r\n      const savedPreferences = await preferences.save();\r\n      logger.info(`✅ تم إنشاء تفضيلات افتراضية للمستخدم: ${userId}`);\r\n\r\n      return savedPreferences;\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في إنشاء التفضيلات الافتراضية: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ═══════════════════════════════════════════════════════════════\r\n   * 🔧 تحديث التفضيلات\r\n   * ═══════════════════════════════════════════════════════════════\r\n   */\r\n\r\n  /**\r\n   * تحديث تفضيلات المستخدم\r\n   */\r\n  async updatePreferences(userId, updates) {\r\n    try {\r\n      const updatedPreferences = await NotificationPreferences.findOneAndUpdate(\r\n        { userId },\r\n        {\r\n          ...updates,\r\n          updatedAt: new Date(),\r\n        },\r\n        { new: true, upsert: true }\r\n      ).exec();\r\n\r\n      // تحديث الذاكرة المؤقتة\r\n      this.cache.delete(userId);\r\n\r\n      this.emit('preferencesUpdated', { userId, updates });\r\n\r\n      logger.info(`✅ تم تحديث التفضيلات: ${userId}`);\r\n\r\n      return updatedPreferences;\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تحديث التفضيلات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث القنوات المفعلة\r\n   */\r\n  async updateChannels(userId, channels) {\r\n    try {\r\n      return await this.updatePreferences(userId, { channels });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تحديث القنوات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث معلومات الاتصال\r\n   */\r\n  async updateContactInfo(userId, contactInfo) {\r\n    try {\r\n      return await this.updatePreferences(userId, { contactInfo });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تحديث معلومات الاتصال: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث ساعات الراحة\r\n   */\r\n  async updateQuietHours(userId, quietHours) {\r\n    try {\r\n      return await this.updatePreferences(userId, { quietHours });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تحديث ساعات الراحة: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث حدود التكرار\r\n   */\r\n  async updateRateLimits(userId, rateLimits) {\r\n    try {\r\n      return await this.updatePreferences(userId, { rateLimits });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تحديث حدود التكرار: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث تفضيلات الفئات\r\n   */\r\n  async updateCategoryPreferences(userId, categoryPreferences) {\r\n    try {\r\n      return await this.updatePreferences(userId, { categoryPreferences });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تحديث تفضيلات الفئات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ═══════════════════════════════════════════════════════════════\r\n   * 🔍 التحقق من التفضيلات\r\n   * ═══════════════════════════════════════════════════════════════\r\n   */\r\n\r\n  /**\r\n   * التحقق من إمكانية إرسال الإشعار\r\n   */\r\n  async canSendNotification(userId, notificationData) {\r\n    try {\r\n      const preferences = await this.getPreferences(userId);\r\n\r\n      // التحقق من حالة التفعيل\r\n      if (!preferences.isActive) {\r\n        return { allowed: false, reason: 'User notifications disabled' };\r\n      }\r\n\r\n      // التحقق من التعليق المؤقت\r\n      if (preferences.suspendedUntil && new Date() < preferences.suspendedUntil) {\r\n        return { allowed: false, reason: 'Notifications temporarily suspended' };\r\n      }\r\n\r\n      // التحقق من القناة\r\n      const channel = notificationData.channel;\r\n      if (channel && !preferences.channels[channel]) {\r\n        return { allowed: false, reason: `Channel ${channel} disabled` };\r\n      }\r\n\r\n      // التحقق من الفئة\r\n      const category = notificationData.category;\r\n      if (category && !preferences.categoryPreferences[category]) {\r\n        return { allowed: false, reason: `Category ${category} disabled` };\r\n      }\r\n\r\n      // التحقق من الأولوية\r\n      const priority = notificationData.priority || 'medium';\r\n      if (!preferences.priorityPreferences[priority]) {\r\n        return { allowed: false, reason: `Priority ${priority} disabled` };\r\n      }\r\n\r\n      // التحقق من قائمة الحظر\r\n      if (this.isBlacklisted(notificationData, preferences)) {\r\n        return { allowed: false, reason: 'Notification is blacklisted' };\r\n      }\r\n\r\n      // التحقق من ساعات الراحة\r\n      if (!this.isWithinActiveHours(preferences)) {\r\n        return { allowed: false, reason: 'Outside active hours' };\r\n      }\r\n\r\n      // التحقق من حدود التكرار\r\n      if (!(await this.checkRateLimit(userId, channel, preferences))) {\r\n        return { allowed: false, reason: 'Rate limit exceeded' };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في التحقق من التفضيلات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من قائمة الحظر\r\n   */\r\n  isBlacklisted(notificationData, preferences) {\r\n    const blacklist = preferences.blacklist;\r\n\r\n    // التحقق من الفئات المحظورة\r\n    if (blacklist.categories.includes(notificationData.category)) {\r\n      return true;\r\n    }\r\n\r\n    // التحقق من المرسلين المحظورين\r\n    if (blacklist.senders.includes(notificationData.sender)) {\r\n      return true;\r\n    }\r\n\r\n    // التحقق من الكلمات المحظورة\r\n    const fullText = `${notificationData.title} ${notificationData.body}`.toLowerCase();\r\n    if (blacklist.keywords.some(keyword => fullText.includes(keyword.toLowerCase()))) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * التحقق من ساعات العمل\r\n   */\r\n  isWithinActiveHours(preferences) {\r\n    if (!preferences.quietHours.enabled) {\r\n      return true;\r\n    }\r\n\r\n    const now = new Date();\r\n    const day = now.toLocaleString('en-US', { weekday: 'lowercase' });\r\n\r\n    // التحقق من أيام الراحة\r\n    if (preferences.quietHours.daysOff.includes(day)) {\r\n      return false;\r\n    }\r\n\r\n    const currentTime = now.toLocaleTimeString('en-US', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: false,\r\n    });\r\n\r\n    const startTime = preferences.quietHours.startTime;\r\n    const endTime = preferences.quietHours.endTime;\r\n\r\n    // التحقق من الفترة الزمنية\r\n    if (startTime <= endTime) {\r\n      return currentTime < startTime || currentTime >= endTime;\r\n    } else {\r\n      return currentTime < startTime && currentTime >= endTime;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من حدود التكرار\r\n   */\r\n  async checkRateLimit(userId, channel, preferences) {\r\n    try {\r\n      // هذا يتطلب نظام تتبع يومي للإشعارات المرسلة\r\n      // يمكن تنفيذه باستخدام Redis أو قاعدة بيانات\r\n\r\n      // مثال بسيط:\r\n      const limit = preferences.rateLimits[`${channel}PerDay`];\r\n\r\n      if (!limit) {\r\n        return true; // لا يوجد حد\r\n      }\r\n\r\n      // يتطلب تنفيذ عداد يومي\r\n      // return sentToday < limit;\r\n\r\n      return true; // للآن\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في التحقق من حدود التكرار: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ═══════════════════════════════════════════════════════════════\r\n   * 🛡️ إدارة قوائم الحظر والبيضاء\r\n   * ═══════════════════════════════════════════════════════════════\r\n   */\r\n\r\n  /**\r\n   * إضافة إلى قائمة الحظر\r\n   */\r\n  async addToBlacklist(userId, type, value) {\r\n    try {\r\n      const preferences = await this.getPreferences(userId);\r\n\r\n      if (!preferences.blacklist[type]) {\r\n        preferences.blacklist[type] = [];\r\n      }\r\n\r\n      if (!preferences.blacklist[type].includes(value)) {\r\n        preferences.blacklist[type].push(value);\r\n        await preferences.save();\r\n        this.cache.delete(userId);\r\n      }\r\n\r\n      return preferences;\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في إضافة إلى قائمة الحظر: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إزالة من قائمة الحظر\r\n   */\r\n  async removeFromBlacklist(userId, type, value) {\r\n    try {\r\n      const preferences = await this.getPreferences(userId);\r\n\r\n      if (preferences.blacklist[type]) {\r\n        preferences.blacklist[type] = preferences.blacklist[type].filter(\r\n          item => item !== value\r\n        );\r\n        await preferences.save();\r\n        this.cache.delete(userId);\r\n      }\r\n\r\n      return preferences;\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في إزالة من قائمة الحظر: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ═══════════════════════════════════════════════════════════════\r\n   * ⏸️ التعليق والإلغاء\r\n   * ═══════════════════════════════════════════════════════════════\r\n   */\r\n\r\n  /**\r\n   * تعليق الإشعارات مؤقتاً\r\n   */\r\n  async suspendNotifications(userId, hours = 1) {\r\n    try {\r\n      const suspendedUntil = new Date(Date.now() + hours * 3600000);\r\n\r\n      return await this.updatePreferences(userId, { suspendedUntil });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تعليق الإشعارات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إلغاء التعليق\r\n   */\r\n  async resumeNotifications(userId) {\r\n    try {\r\n      return await this.updatePreferences(userId, { suspendedUntil: null });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في إلغاء التعليق: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تعطيل جميع الإشعارات\r\n   */\r\n  async disableAllNotifications(userId) {\r\n    try {\r\n      return await this.updatePreferences(userId, { isActive: false });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تعطيل الإشعارات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تفعيل جميع الإشعارات\r\n   */\r\n  async enableAllNotifications(userId) {\r\n    try {\r\n      return await this.updatePreferences(userId, { isActive: true });\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تفعيل الإشعارات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ═══════════════════════════════════════════════════════════════\r\n   * 📊 الإحصائيات والتقارير\r\n   * ═══════════════════════════════════════════════════════════════\r\n   */\r\n\r\n  /**\r\n   * تحديث الإحصائيات\r\n   */\r\n  async updateStatistics(userId, readTime = 0) {\r\n    try {\r\n      const preferences = await this.getPreferences(userId);\r\n\r\n      preferences.statistics.totalNotificationsReceived++;\r\n      preferences.statistics.totalNotificationsRead++;\r\n      preferences.statistics.lastUpdated = new Date();\r\n\r\n      // حساب متوسط وقت القراءة\r\n      if (readTime > 0) {\r\n        const total = preferences.statistics.avgReadTime * (preferences.statistics.totalNotificationsRead - 1) + readTime;\r\n        preferences.statistics.avgReadTime = total / preferences.statistics.totalNotificationsRead;\r\n      }\r\n\r\n      await preferences.save();\r\n      this.cache.delete(userId);\r\n\r\n      return preferences.statistics;\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في تحديث الإحصائيات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الحصول على الإحصائيات\r\n   */\r\n  async getStatistics(userId) {\r\n    try {\r\n      const preferences = await this.getPreferences(userId);\r\n      return preferences.statistics;\r\n    } catch (error) {\r\n      logger.error(`❌ خطأ في جلب الإحصائيات: ${error.message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * مسح الذاكرة المؤقتة\r\n   */\r\n  clearCache() {\r\n    const size = this.cache.size;\r\n    this.cache.clear();\r\n    logger.info(`🗑️ تم مسح الذاكرة المؤقتة (${size} مستخدم)`);\r\n  }\r\n}\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// 📦 التصدير\r\n// ═══════════════════════════════════════════════════════════════\r\n\r\nmodule.exports = {\r\n  UserPreferencesManager,\r\n  NotificationPreferences,\r\n  preferencesManager: new UserPreferencesManager(),\r\n};\r\n"],"mappings":"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","ignoreList":[]}