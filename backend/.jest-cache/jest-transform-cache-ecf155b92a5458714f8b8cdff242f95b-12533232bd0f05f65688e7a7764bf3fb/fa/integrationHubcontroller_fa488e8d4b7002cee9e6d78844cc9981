8a63c3ea7486217365ef4b8de437472a
/**
 * Integration Hub Controllers
 * Controllers for connectors, workflows, and marketplace
 */

const IntegrationHubService = require('../services/integrationHub.service');
const Logger = require('../utils/logger');
class IntegrationHubController {
  /**
   * ========== CONNECTORS ==========
   */

  static async registerConnector(req, res) {
    try {
      const {
        connectorId,
        name,
        provider,
        baseUrl,
        config,
        metadata
      } = req.body;
      if (!connectorId || !name || !provider) {
        return res.status(400).json({
          success: false,
          message: 'Missing required fields: connectorId, name, provider'
        });
      }
      const result = IntegrationHubService.registerConnector(connectorId, {
        name,
        provider,
        baseUrl,
        config,
        metadata
      });
      res.status(201).json({
        success: true,
        data: result.connector,
        message: result.message
      });
    } catch (error) {
      Logger.error(`Register connector error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to register connector',
        error: error.message
      });
    }
  }
  static async authenticateConnector(req, res) {
    try {
      const {
        connectorId,
        apiKey,
        apiSecret,
        accessToken,
        refreshToken,
        webhookUrl
      } = req.body;
      if (!connectorId) {
        return res.status(400).json({
          success: false,
          message: 'Missing connectorId'
        });
      }
      const result = await IntegrationHubService.authenticateConnector(connectorId, {
        apiKey,
        apiSecret,
        accessToken,
        refreshToken,
        webhookUrl
      });
      res.json({
        success: true,
        data: {
          credentialId: result.credentialId
        },
        message: result.message
      });
    } catch (error) {
      Logger.error(`Authenticate connector error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to authenticate connector',
        error: error.message
      });
    }
  }
  static async getConnectors(req, res) {
    try {
      const connectors = IntegrationHubService.getAllConnectors();
      res.json({
        success: true,
        data: {
          connectors,
          count: connectors.length
        }
      });
    } catch (error) {
      Logger.error(`Get connectors error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to retrieve connectors',
        error: error.message
      });
    }
  }
  static async getConnector(req, res) {
    try {
      const {
        connectorId
      } = req.params;
      const connector = IntegrationHubService.getConnector(connectorId);
      if (!connector) {
        return res.status(404).json({
          success: false,
          message: `Connector ${connectorId} not found`
        });
      }
      res.json({
        success: true,
        data: connector
      });
    } catch (error) {
      Logger.error(`Get connector error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to retrieve connector',
        error: error.message
      });
    }
  }

  /**
   * ========== WORKFLOWS ==========
   */

  static async createWorkflow(req, res) {
    try {
      const {
        name,
        description,
        trigger,
        actions,
        conditions
      } = req.body;
      const tenantId = req.tenant?.id || req.body.tenantId;
      const userId = req.user?.id || req.body.userId;
      if (!name || !trigger) {
        return res.status(400).json({
          success: false,
          message: 'Missing required fields: name, trigger'
        });
      }
      const result = IntegrationHubService.createWorkflow({
        name,
        description,
        trigger,
        actions,
        conditions,
        tenantId,
        createdBy: userId
      });
      res.status(201).json({
        success: true,
        data: result.workflow,
        message: result.message
      });
    } catch (error) {
      Logger.error(`Create workflow error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to create workflow',
        error: error.message
      });
    }
  }
  static async executeWorkflow(req, res) {
    try {
      const {
        workflowId
      } = req.params;
      const {
        triggerData
      } = req.body;
      if (!workflowId) {
        return res.status(400).json({
          success: false,
          message: 'Missing workflowId'
        });
      }
      const execution = await IntegrationHubService.executeWorkflow(workflowId, triggerData || {});
      res.json({
        success: true,
        data: execution,
        message: `Workflow execution ${execution.id} completed`
      });
    } catch (error) {
      Logger.error(`Execute workflow error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to execute workflow',
        error: error.message
      });
    }
  }

  /**
   * ========== WEBHOOKS ==========
   */

  static async registerWebhook(req, res) {
    try {
      const {
        connectorId,
        webhookUrl,
        events
      } = req.body;
      if (!connectorId || !webhookUrl) {
        return res.status(400).json({
          success: false,
          message: 'Missing required fields: connectorId, webhookUrl'
        });
      }
      const result = IntegrationHubService.registerWebhook(connectorId, webhookUrl, events || []);
      res.status(201).json({
        success: true,
        data: result.webhook,
        message: result.message
      });
    } catch (error) {
      Logger.error(`Register webhook error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to register webhook',
        error: error.message
      });
    }
  }
  static async triggerWebhook(req, res) {
    try {
      const {
        webhookId
      } = req.params;
      const data = req.body;
      if (!webhookId) {
        return res.status(400).json({
          success: false,
          message: 'Missing webhookId'
        });
      }
      const result = await IntegrationHubService.triggerWebhook(webhookId, data);
      if (!result.success) {
        return res.status(400).json({
          success: false,
          message: 'Failed to trigger webhook',
          error: result.error
        });
      }
      res.json({
        success: true,
        data: result,
        message: 'Webhook triggered successfully'
      });
    } catch (error) {
      Logger.error(`Trigger webhook error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to trigger webhook',
        error: error.message
      });
    }
  }

  /**
   * ========== MARKETPLACE ==========
   */

  static async publishApp(req, res) {
    try {
      const {
        name,
        description,
        icon,
        author,
        version,
        category,
        pricing,
        features,
        documentation
      } = req.body;
      if (!name || !author || !category) {
        return res.status(400).json({
          success: false,
          message: 'Missing required fields: name, author, category'
        });
      }
      const result = IntegrationHubService.createMarketplaceApp({
        name,
        description,
        icon,
        author,
        version,
        category,
        pricing,
        features,
        documentation
      });
      res.status(201).json({
        success: true,
        data: result.app,
        message: result.message
      });
    } catch (error) {
      Logger.error(`Publish app error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to publish app',
        error: error.message
      });
    }
  }
  static async getMarketplaceApps(req, res) {
    try {
      const {
        category,
        pricing,
        search,
        limit
      } = req.query;
      const filters = {};
      if (category) filters.category = category;
      if (pricing) filters.pricing = pricing;
      if (search) filters.search = search;
      const apps = IntegrationHubService.getMarketplaceApps(filters);
      const limited = limit ? apps.slice(0, parseInt(limit)) : apps;
      res.json({
        success: true,
        data: {
          apps: limited,
          count: limited.length,
          total: apps.length
        }
      });
    } catch (error) {
      Logger.error(`Get marketplace apps error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to retrieve marketplace apps',
        error: error.message
      });
    }
  }
  static async subscribeToApp(req, res) {
    try {
      const {
        appId,
        plan
      } = req.body;
      const tenantId = req.tenant?.id || req.body.tenantId;
      if (!appId) {
        return res.status(400).json({
          success: false,
          message: 'Missing appId'
        });
      }
      const result = IntegrationHubService.subscribeToApp(tenantId, appId, plan || 'free');
      res.status(201).json({
        success: true,
        data: result.subscription,
        message: result.message
      });
    } catch (error) {
      Logger.error(`Subscribe to app error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to subscribe to app',
        error: error.message
      });
    }
  }

  /**
   * ========== STATISTICS ==========
   */

  static async getStatistics(req, res) {
    try {
      const stats = IntegrationHubService.getStatistics();
      res.json({
        success: true,
        data: stats,
        message: 'Integration hub statistics'
      });
    } catch (error) {
      Logger.error(`Get statistics error: ${error.message}`);
      res.status(500).json({
        success: false,
        message: 'Failed to retrieve statistics',
        error: error.message
      });
    }
  }
}
module.exports = IntegrationHubController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnRlZ3JhdGlvbkh1YlNlcnZpY2UiLCJyZXF1aXJlIiwiTG9nZ2VyIiwiSW50ZWdyYXRpb25IdWJDb250cm9sbGVyIiwicmVnaXN0ZXJDb25uZWN0b3IiLCJyZXEiLCJyZXMiLCJjb25uZWN0b3JJZCIsIm5hbWUiLCJwcm92aWRlciIsImJhc2VVcmwiLCJjb25maWciLCJtZXRhZGF0YSIsImJvZHkiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJyZXN1bHQiLCJkYXRhIiwiY29ubmVjdG9yIiwiZXJyb3IiLCJhdXRoZW50aWNhdGVDb25uZWN0b3IiLCJhcGlLZXkiLCJhcGlTZWNyZXQiLCJhY2Nlc3NUb2tlbiIsInJlZnJlc2hUb2tlbiIsIndlYmhvb2tVcmwiLCJjcmVkZW50aWFsSWQiLCJnZXRDb25uZWN0b3JzIiwiY29ubmVjdG9ycyIsImdldEFsbENvbm5lY3RvcnMiLCJjb3VudCIsImxlbmd0aCIsImdldENvbm5lY3RvciIsInBhcmFtcyIsImNyZWF0ZVdvcmtmbG93IiwiZGVzY3JpcHRpb24iLCJ0cmlnZ2VyIiwiYWN0aW9ucyIsImNvbmRpdGlvbnMiLCJ0ZW5hbnRJZCIsInRlbmFudCIsImlkIiwidXNlcklkIiwidXNlciIsImNyZWF0ZWRCeSIsIndvcmtmbG93IiwiZXhlY3V0ZVdvcmtmbG93Iiwid29ya2Zsb3dJZCIsInRyaWdnZXJEYXRhIiwiZXhlY3V0aW9uIiwicmVnaXN0ZXJXZWJob29rIiwiZXZlbnRzIiwid2ViaG9vayIsInRyaWdnZXJXZWJob29rIiwid2ViaG9va0lkIiwicHVibGlzaEFwcCIsImljb24iLCJhdXRob3IiLCJ2ZXJzaW9uIiwiY2F0ZWdvcnkiLCJwcmljaW5nIiwiZmVhdHVyZXMiLCJkb2N1bWVudGF0aW9uIiwiY3JlYXRlTWFya2V0cGxhY2VBcHAiLCJhcHAiLCJnZXRNYXJrZXRwbGFjZUFwcHMiLCJzZWFyY2giLCJsaW1pdCIsInF1ZXJ5IiwiZmlsdGVycyIsImFwcHMiLCJsaW1pdGVkIiwic2xpY2UiLCJwYXJzZUludCIsInRvdGFsIiwic3Vic2NyaWJlVG9BcHAiLCJhcHBJZCIsInBsYW4iLCJzdWJzY3JpcHRpb24iLCJnZXRTdGF0aXN0aWNzIiwic3RhdHMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiaW50ZWdyYXRpb25IdWIuY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEludGVncmF0aW9uIEh1YiBDb250cm9sbGVyc1xuICogQ29udHJvbGxlcnMgZm9yIGNvbm5lY3RvcnMsIHdvcmtmbG93cywgYW5kIG1hcmtldHBsYWNlXG4gKi9cblxuY29uc3QgSW50ZWdyYXRpb25IdWJTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvaW50ZWdyYXRpb25IdWIuc2VydmljZScpO1xuY29uc3QgTG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvbG9nZ2VyJyk7XG5cbmNsYXNzIEludGVncmF0aW9uSHViQ29udHJvbGxlciB7XG4gIC8qKlxuICAgKiA9PT09PT09PT09IENPTk5FQ1RPUlMgPT09PT09PT09PVxuICAgKi9cblxuICBzdGF0aWMgYXN5bmMgcmVnaXN0ZXJDb25uZWN0b3IocmVxLCByZXMpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBjb25uZWN0b3JJZCwgbmFtZSwgcHJvdmlkZXIsIGJhc2VVcmwsIGNvbmZpZywgbWV0YWRhdGEgfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIWNvbm5lY3RvcklkIHx8ICFuYW1lIHx8ICFwcm92aWRlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogY29ubmVjdG9ySWQsIG5hbWUsIHByb3ZpZGVyJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IEludGVncmF0aW9uSHViU2VydmljZS5yZWdpc3RlckNvbm5lY3Rvcihjb25uZWN0b3JJZCwge1xuICAgICAgICBuYW1lLFxuICAgICAgICBwcm92aWRlcixcbiAgICAgICAgYmFzZVVybCxcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBtZXRhZGF0YSxcbiAgICAgIH0pO1xuXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5jb25uZWN0b3IsXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIExvZ2dlci5lcnJvcihgUmVnaXN0ZXIgY29ubmVjdG9yIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHJlZ2lzdGVyIGNvbm5lY3RvcicsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGFzeW5jIGF1dGhlbnRpY2F0ZUNvbm5lY3RvcihyZXEsIHJlcykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGNvbm5lY3RvcklkLCBhcGlLZXksIGFwaVNlY3JldCwgYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgd2ViaG9va1VybCB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghY29ubmVjdG9ySWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnTWlzc2luZyBjb25uZWN0b3JJZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UuYXV0aGVudGljYXRlQ29ubmVjdG9yKGNvbm5lY3RvcklkLCB7XG4gICAgICAgIGFwaUtleSxcbiAgICAgICAgYXBpU2VjcmV0LFxuICAgICAgICBhY2Nlc3NUb2tlbixcbiAgICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgICB3ZWJob29rVXJsLFxuICAgICAgfSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogeyBjcmVkZW50aWFsSWQ6IHJlc3VsdC5jcmVkZW50aWFsSWQgfSxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgTG9nZ2VyLmVycm9yKGBBdXRoZW50aWNhdGUgY29ubmVjdG9yIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSBjb25uZWN0b3InLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRDb25uZWN0b3JzKHJlcSwgcmVzKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbm5lY3RvcnMgPSBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UuZ2V0QWxsQ29ubmVjdG9ycygpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHsgY29ubmVjdG9ycywgY291bnQ6IGNvbm5lY3RvcnMubGVuZ3RoIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgTG9nZ2VyLmVycm9yKGBHZXQgY29ubmVjdG9ycyBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byByZXRyaWV2ZSBjb25uZWN0b3JzJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0Q29ubmVjdG9yKHJlcSwgcmVzKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgY29ubmVjdG9ySWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCBjb25uZWN0b3IgPSBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UuZ2V0Q29ubmVjdG9yKGNvbm5lY3RvcklkKTtcblxuICAgICAgaWYgKCFjb25uZWN0b3IpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBgQ29ubmVjdG9yICR7Y29ubmVjdG9ySWR9IG5vdCBmb3VuZGAsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGNvbm5lY3RvcixcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoYEdldCBjb25uZWN0b3IgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcmV0cmlldmUgY29ubmVjdG9yJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogPT09PT09PT09PSBXT1JLRkxPV1MgPT09PT09PT09PVxuICAgKi9cblxuICBzdGF0aWMgYXN5bmMgY3JlYXRlV29ya2Zsb3cocmVxLCByZXMpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlvbiwgdHJpZ2dlciwgYWN0aW9ucywgY29uZGl0aW9ucyB9ID0gcmVxLmJvZHk7XG4gICAgICBjb25zdCB0ZW5hbnRJZCA9IHJlcS50ZW5hbnQ/LmlkIHx8IHJlcS5ib2R5LnRlbmFudElkO1xuICAgICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXI/LmlkIHx8IHJlcS5ib2R5LnVzZXJJZDtcblxuICAgICAgaWYgKCFuYW1lIHx8ICF0cmlnZ2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzOiBuYW1lLCB0cmlnZ2VyJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IEludGVncmF0aW9uSHViU2VydmljZS5jcmVhdGVXb3JrZmxvdyh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICB0cmlnZ2VyLFxuICAgICAgICBhY3Rpb25zLFxuICAgICAgICBjb25kaXRpb25zLFxuICAgICAgICB0ZW5hbnRJZCxcbiAgICAgICAgY3JlYXRlZEJ5OiB1c2VySWQsXG4gICAgICB9KTtcblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQud29ya2Zsb3csXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIExvZ2dlci5lcnJvcihgQ3JlYXRlIHdvcmtmbG93IGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSB3b3JrZmxvdycsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGFzeW5jIGV4ZWN1dGVXb3JrZmxvdyhyZXEsIHJlcykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHdvcmtmbG93SWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCB7IHRyaWdnZXJEYXRhIH0gPSByZXEuYm9keTtcblxuICAgICAgaWYgKCF3b3JrZmxvd0lkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ01pc3Npbmcgd29ya2Zsb3dJZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBleGVjdXRpb24gPSBhd2FpdCBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UuZXhlY3V0ZVdvcmtmbG93KHdvcmtmbG93SWQsIHRyaWdnZXJEYXRhIHx8IHt9KTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBleGVjdXRpb24sXG4gICAgICAgIG1lc3NhZ2U6IGBXb3JrZmxvdyBleGVjdXRpb24gJHtleGVjdXRpb24uaWR9IGNvbXBsZXRlZGAsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgTG9nZ2VyLmVycm9yKGBFeGVjdXRlIHdvcmtmbG93IGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGV4ZWN1dGUgd29ya2Zsb3cnLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiA9PT09PT09PT09IFdFQkhPT0tTID09PT09PT09PT1cbiAgICovXG5cbiAgc3RhdGljIGFzeW5jIHJlZ2lzdGVyV2ViaG9vayhyZXEsIHJlcykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGNvbm5lY3RvcklkLCB3ZWJob29rVXJsLCBldmVudHMgfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIWNvbm5lY3RvcklkIHx8ICF3ZWJob29rVXJsKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzOiBjb25uZWN0b3JJZCwgd2ViaG9va1VybCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UucmVnaXN0ZXJXZWJob29rKGNvbm5lY3RvcklkLCB3ZWJob29rVXJsLCBldmVudHMgfHwgW10pO1xuXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC53ZWJob29rLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoYFJlZ2lzdGVyIHdlYmhvb2sgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcmVnaXN0ZXIgd2ViaG9vaycsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGFzeW5jIHRyaWdnZXJXZWJob29rKHJlcSwgcmVzKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgd2ViaG9va0lkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgZGF0YSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIXdlYmhvb2tJZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdNaXNzaW5nIHdlYmhvb2tJZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UudHJpZ2dlcldlYmhvb2sod2ViaG9va0lkLCBkYXRhKTtcblxuICAgICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdHJpZ2dlciB3ZWJob29rJyxcbiAgICAgICAgICBlcnJvcjogcmVzdWx0LmVycm9yLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICAgIG1lc3NhZ2U6ICdXZWJob29rIHRyaWdnZXJlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIExvZ2dlci5lcnJvcihgVHJpZ2dlciB3ZWJob29rIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHRyaWdnZXIgd2ViaG9vaycsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqID09PT09PT09PT0gTUFSS0VUUExBQ0UgPT09PT09PT09PVxuICAgKi9cblxuICBzdGF0aWMgYXN5bmMgcHVibGlzaEFwcChyZXEsIHJlcykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IG5hbWUsIGRlc2NyaXB0aW9uLCBpY29uLCBhdXRob3IsIHZlcnNpb24sIGNhdGVnb3J5LCBwcmljaW5nLCBmZWF0dXJlcywgZG9jdW1lbnRhdGlvbiB9ID1cbiAgICAgICAgcmVxLmJvZHk7XG5cbiAgICAgIGlmICghbmFtZSB8fCAhYXV0aG9yIHx8ICFjYXRlZ29yeSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogbmFtZSwgYXV0aG9yLCBjYXRlZ29yeScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UuY3JlYXRlTWFya2V0cGxhY2VBcHAoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgaWNvbixcbiAgICAgICAgYXV0aG9yLFxuICAgICAgICB2ZXJzaW9uLFxuICAgICAgICBjYXRlZ29yeSxcbiAgICAgICAgcHJpY2luZyxcbiAgICAgICAgZmVhdHVyZXMsXG4gICAgICAgIGRvY3VtZW50YXRpb24sXG4gICAgICB9KTtcblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQuYXBwLFxuICAgICAgICBtZXNzYWdlOiByZXN1bHQubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBMb2dnZXIuZXJyb3IoYFB1Ymxpc2ggYXBwIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHB1Ymxpc2ggYXBwJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0TWFya2V0cGxhY2VBcHBzKHJlcSwgcmVzKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgY2F0ZWdvcnksIHByaWNpbmcsIHNlYXJjaCwgbGltaXQgfSA9IHJlcS5xdWVyeTtcblxuICAgICAgY29uc3QgZmlsdGVycyA9IHt9O1xuICAgICAgaWYgKGNhdGVnb3J5KSBmaWx0ZXJzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgICBpZiAocHJpY2luZykgZmlsdGVycy5wcmljaW5nID0gcHJpY2luZztcbiAgICAgIGlmIChzZWFyY2gpIGZpbHRlcnMuc2VhcmNoID0gc2VhcmNoO1xuXG4gICAgICBjb25zdCBhcHBzID0gSW50ZWdyYXRpb25IdWJTZXJ2aWNlLmdldE1hcmtldHBsYWNlQXBwcyhmaWx0ZXJzKTtcblxuICAgICAgY29uc3QgbGltaXRlZCA9IGxpbWl0ID8gYXBwcy5zbGljZSgwLCBwYXJzZUludChsaW1pdCkpIDogYXBwcztcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiB7IGFwcHM6IGxpbWl0ZWQsIGNvdW50OiBsaW1pdGVkLmxlbmd0aCwgdG90YWw6IGFwcHMubGVuZ3RoIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgTG9nZ2VyLmVycm9yKGBHZXQgbWFya2V0cGxhY2UgYXBwcyBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byByZXRyaWV2ZSBtYXJrZXRwbGFjZSBhcHBzJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgc3Vic2NyaWJlVG9BcHAocmVxLCByZXMpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBhcHBJZCwgcGxhbiB9ID0gcmVxLmJvZHk7XG4gICAgICBjb25zdCB0ZW5hbnRJZCA9IHJlcS50ZW5hbnQ/LmlkIHx8IHJlcS5ib2R5LnRlbmFudElkO1xuXG4gICAgICBpZiAoIWFwcElkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ01pc3NpbmcgYXBwSWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gSW50ZWdyYXRpb25IdWJTZXJ2aWNlLnN1YnNjcmliZVRvQXBwKHRlbmFudElkLCBhcHBJZCwgcGxhbiB8fCAnZnJlZScpO1xuXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdC5zdWJzY3JpcHRpb24sXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIExvZ2dlci5lcnJvcihgU3Vic2NyaWJlIHRvIGFwcCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBzdWJzY3JpYmUgdG8gYXBwJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogPT09PT09PT09PSBTVEFUSVNUSUNTID09PT09PT09PT1cbiAgICovXG5cbiAgc3RhdGljIGFzeW5jIGdldFN0YXRpc3RpY3MocmVxLCByZXMpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhdHMgPSBJbnRlZ3JhdGlvbkh1YlNlcnZpY2UuZ2V0U3RhdGlzdGljcygpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHN0YXRzLFxuICAgICAgICBtZXNzYWdlOiAnSW50ZWdyYXRpb24gaHViIHN0YXRpc3RpY3MnLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIExvZ2dlci5lcnJvcihgR2V0IHN0YXRpc3RpY3MgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcmV0cmlldmUgc3RhdGlzdGljcycsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gSW50ZWdyYXRpb25IdWJDb250cm9sbGVyO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNQSxxQkFBcUIsR0FBR0MsT0FBTyxDQUFDLG9DQUFvQyxDQUFDO0FBQzNFLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0FBRXpDLE1BQU1FLHdCQUF3QixDQUFDO0VBQzdCO0FBQ0Y7QUFDQTs7RUFFRSxhQUFhQyxpQkFBaUJBLENBQUNDLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQ3ZDLElBQUk7TUFDRixNQUFNO1FBQUVDLFdBQVc7UUFBRUMsSUFBSTtRQUFFQyxRQUFRO1FBQUVDLE9BQU87UUFBRUMsTUFBTTtRQUFFQztNQUFTLENBQUMsR0FBR1AsR0FBRyxDQUFDUSxJQUFJO01BRTNFLElBQUksQ0FBQ04sV0FBVyxJQUFJLENBQUNDLElBQUksSUFBSSxDQUFDQyxRQUFRLEVBQUU7UUFDdEMsT0FBT0gsR0FB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