4b3e8b990ebc8ea22586655787f041f1
/**
 * Multi-Factor Authentication Service
 * تطوير نظام المصادقة متعددة العوامل
 * 
 * Supports: TOTP (Google Authenticator), Email OTP, SMS OTP, Backup Codes
 */

const speakeasy = require('speakeasy');
const QRCode = require('qrcode');
const crypto = require('crypto');
const nodemailer = require('nodemailer');
class MFAService {
  constructor() {
    this.otpExpiration = 5 * 60 * 1000; // 5 minutes
    this.backupCodesCount = 10;
  }

  /**
   * Generate TOTP Secret and QR Code
   * إنشاء رمز TOTP وكود QR
   */
  async generateTOTPSecret(userEmail, appName = 'ERP System') {
    try {
      const secret = speakeasy.generateSecret({
        name: `${appName} (${userEmail})`,
        issuer: appName,
        length: 32
      });

      // Generate QR Code
      const qrCode = await QRCode.toDataURL(secret.otpauth_url);
      return {
        secret: secret.base32,
        qrCode,
        otpauth_url: secret.otpauth_url,
        manualEntryKey: secret.base32
      };
    } catch (error) {
      throw new Error(`Failed to generate TOTP secret: ${error.message}`);
    }
  }

  /**
   * Verify TOTP Token
   * التحقق من رمز TOTP
   */
  verifyTOTP(token, secret, window = 2) {
    try {
      const isValid = speakeasy.totp.verify({
        secret,
        encodingType: 'base32',
        token,
        window // Allow 30 seconds before and after
      });
      return isValid;
    } catch (error) {
      throw new Error(`Failed to verify TOTP token: ${error.message}`);
    }
  }

  /**
   * Generate Email OTP
   * توليد رمز OTP عبر البريد الإلكتروني
   */
  generateEmailOTP() {
    const otp = crypto.randomInt(100000, 999999).toString();
    const expiresAt = new Date(Date.now() + this.otpExpiration);
    return {
      code: otp,
      expiresAt,
      expiresIn: this.otpExpiration / 1000 // seconds
    };
  }

  /**
   * Generate SMS OTP
   * توليد رمز OTP عبر الرسائل النصية
   */
  generateSMSOTP() {
    const otp = crypto.randomInt(100000, 999999).toString();
    const expiresAt = new Date(Date.now() + this.otpExpiration);
    return {
      code: otp,
      expiresAt,
      expiresIn: this.otpExpiration / 1000
    };
  }

  /**
   * Verify OTP Code
   * التحقق من رمز OTP
   */
  verifyOTP(providedCode, storedCode, expiresAt) {
    try {
      // Check if OTP has expired
      if (new Date() > new Date(expiresAt)) {
        return {
          isValid: false,
          message: 'OTP has expired',
          error: 'EXPIRED'
        };
      }

      // Check if code matches (constant time comparison)
      const isValid = crypto.timingSafeEqual(Buffer.from(providedCode.toString()), Buffer.from(storedCode.toString()));
      return {
        isValid,
        message: isValid ? 'OTP verified successfully' : 'Invalid OTP',
        error: isValid ? null : 'INVALID_OTP'
      };
    } catch (error) {
      return {
        isValid: false,
        message: 'OTP verification failed',
        error: 'VERIFICATION_FAILED'
      };
    }
  }

  /**
   * Generate Backup Codes
   * توليد أكواد احتياطية
   */
  generateBackupCodes(count = this.backupCodesCount) {
    const codes = [];
    for (let i = 0; i < count; i++) {
      const code = crypto.randomBytes(4).toString('hex').toUpperCase();
      codes.push(`${code.slice(0, 4)}-${code.slice(4)}`);
    }
    return codes;
  }

  /**
   * Hash Backup Code (for storage)
   * تشفير رمز احتياطي للتخزين
   */
  hashBackupCode(code) {
    return crypto.createHash('sha256').update(code).digest('hex');
  }

  /**
   * Verify Backup Code
   * التحقق من الرمز الاحتياطي
   */
  verifyBackupCode(providedCode, hashedCode) {
    const hash = crypto.createHash('sha256').update(providedCode).digest('hex');
    return crypto.timingSafeEqual(Buffer.from(hash), Buffer.from(hashedCode));
  }

  /**
   * Generate MFA Recovery Key
   * إنشاء مفتاح استرجاع MFA
   */
  generateRecoveryKey() {
    return crypto.randomBytes(16).toString('hex').toUpperCase();
  }

  /**
   * Create MFA Session
   * إنشاء جلسة MFA
   */
  createMFASession(userId, method = 'totp', metadata = {}) {
    const sessionId = crypto.randomBytes(16).toString('hex');
    const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes

    return {
      sessionId,
      userId,
      method,
      expiresAt,
      attempts: 0,
      maxAttempts: 5,
      metadata
    };
  }

  /**
   * Validate MFA Session
   * التحقق من جلسة MFA
   */
  validateMFASession(session) {
    if (!session) {
      return {
        isValid: false,
        message: 'MFA session not found'
      };
    }
    if (new Date() > new Date(session.expiresAt)) {
      return {
        isValid: false,
        message: 'MFA session has expired'
      };
    }
    if (session.attempts >= session.maxAttempts) {
      return {
        isValid: false,
        message: 'Maximum verification attempts exceeded'
      };
    }
    return {
      isValid: true,
      message: 'MFA session is valid',
      attemptsRemaining: session.maxAttempts - session.attempts
    };
  }

  /**
   * Generate Trusted Device Token
   * إنشاء رمز جهاز موثوق
   */
  generateTrustedDeviceToken(userId, deviceFingerprint) {
    const token = crypto.createHash('sha256').update(`${userId}:${deviceFingerprint}:${Date.now()}`).digest('hex');
    return {
      token,
      createdAt: new Date(),
      expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30 days
    };
  }

  /**
   * Get MFA Setup Guide
   * الحصول على دليل إعداد MFA
   */
  getMFASetupGuide() {
    return {
      totp: {
        name: 'Time-based One-Time Password (TOTP)',
        description: 'Use an authenticator app like Google Authenticator or Authy',
        steps: ['Download an authenticator app (Google Authenticator, Microsoft Authenticator, or Authy)', 'Scan the QR code displayed on the setup page', 'Enter the 6-digit code from your authenticator app', 'Save your backup codes in a safe place'],
        advantages: ['Works offline', 'No need for SMS or email', 'Widely supported']
      },
      email: {
        name: 'Email One-Time Password',
        description: 'Receive a code via email for verification',
        steps: ['When logging in, you will receive a 6-digit code via email', 'Enter the code in the verification prompt', 'The code expires after 5 minutes'],
        advantages: ['No additional app needed', 'Works on any device']
      },
      sms: {
        name: 'SMS One-Time Password',
        description: 'Receive a code via text message for verification',
        steps: ['When logging in, you will receive a 6-digit code via SMS', 'Enter the code in the verification prompt', 'The code expires after 5 minutes'],
        advantages: ['Works on any phone', 'Fast delivery']
      }
    };
  }

  /**
   * Calculate Security Score
   * حساب درجة الأمان
   */
  calculateSecurityScore(mfaMethods) {
    let score = 0;
    const maxScore = 100;
    if (mfaMethods.totp) score += 40;
    if (mfaMethods.email) score += 30;
    if (mfaMethods.sms) score += 20;
    if (mfaMethods.backupCodes && mfaMethods.backupCodes.length > 0) score += 10;
    return Math.min(score, maxScore);
  }

  /**
   * Generate MFA Audit Log
   * إنشاء سجل تدقيق MFA
   */
  createAuditLog(userId, action, status, metadata = {}) {
    return {
      userId,
      action,
      status,
      timestamp: new Date(),
      ipAddress: metadata.ipAddress || null,
      userAgent: metadata.userAgent || null,
      deviceInfo: metadata.deviceInfo || null
    };
  }
}
module.exports = new MFAService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzcGVha2Vhc3kiLCJyZXF1aXJlIiwiUVJDb2RlIiwiY3J5cHRvIiwibm9kZW1haWxlciIsIk1GQVNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsIm90cEV4cGlyYXRpb24iLCJiYWNrdXBDb2Rlc0NvdW50IiwiZ2VuZXJhdGVUT1RQU2VjcmV0IiwidXNlckVtYWlsIiwiYXBwTmFtZSIsInNlY3JldCIsImdlbmVyYXRlU2VjcmV0IiwibmFtZSIsImlzc3VlciIsImxlbmd0aCIsInFyQ29kZSIsInRvRGF0YVVSTCIsIm90cGF1dGhfdXJsIiwiYmFzZTMyIiwibWFudWFsRW50cnlLZXkiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsInZlcmlmeVRPVFAiLCJ0b2tlbiIsIndpbmRvdyIsImlzVmFsaWQiLCJ0b3RwIiwidmVyaWZ5IiwiZW5jb2RpbmdUeXBlIiwiZ2VuZXJhdGVFbWFpbE9UUCIsIm90cCIsInJhbmRvbUludCIsInRvU3RyaW5nIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsImNvZGUiLCJleHBpcmVzSW4iLCJnZW5lcmF0ZVNNU09UUCIsInZlcmlmeU9UUCIsInByb3ZpZGVkQ29kZSIsInN0b3JlZENvZGUiLCJ0aW1pbmdTYWZlRXF1YWwiLCJCdWZmZXIiLCJmcm9tIiwiZ2VuZXJhdGVCYWNrdXBDb2RlcyIsImNvdW50IiwiY29kZXMiLCJpIiwicmFuZG9tQnl0ZXMiLCJ0b1VwcGVyQ2FzZSIsInB1c2giLCJzbGljZSIsImhhc2hCYWNrdXBDb2RlIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsInZlcmlmeUJhY2t1cENvZGUiLCJoYXNoZWRDb2RlIiwiaGFzaCIsImdlbmVyYXRlUmVjb3ZlcnlLZXkiLCJjcmVhdGVNRkFTZXNzaW9uIiwidXNlcklkIiwibWV0aG9kIiwibWV0YWRhdGEiLCJzZXNzaW9uSWQiLCJhdHRlbXB0cyIsIm1heEF0dGVtcHRzIiwidmFsaWRhdGVNRkFTZXNzaW9uIiwic2Vzc2lvbiIsImF0dGVtcHRzUmVtYWluaW5nIiwiZ2VuZXJhdGVUcnVzdGVkRGV2aWNlVG9rZW4iLCJkZXZpY2VGaW5nZXJwcmludCIsImNyZWF0ZWRBdCIsImdldE1GQVNldHVwR3VpZGUiLCJkZXNjcmlwdGlvbiIsInN0ZXBzIiwiYWR2YW50YWdlcyIsImVtYWlsIiwic21zIiwiY2FsY3VsYXRlU2VjdXJpdHlTY29yZSIsIm1mYU1ldGhvZHMiLCJzY29yZSIsIm1heFNjb3JlIiwiYmFja3VwQ29kZXMiLCJNYXRoIiwibWluIiwiY3JlYXRlQXVkaXRMb2ciLCJhY3Rpb24iLCJzdGF0dXMiLCJ0aW1lc3RhbXAiLCJpcEFkZHJlc3MiLCJ1c2VyQWdlbnQiLCJkZXZpY2VJbmZvIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIm1mYVNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIE11bHRpLUZhY3RvciBBdXRoZW50aWNhdGlvbiBTZXJ2aWNlXHJcbiAqINiq2LfZiNmK2LEg2YbYuNin2YUg2KfZhNmF2LXYp9iv2YLYqSDZhdiq2LnYr9iv2Kkg2KfZhNi52YjYp9mF2YRcclxuICogXHJcbiAqIFN1cHBvcnRzOiBUT1RQIChHb29nbGUgQXV0aGVudGljYXRvciksIEVtYWlsIE9UUCwgU01TIE9UUCwgQmFja3VwIENvZGVzXHJcbiAqL1xyXG5cclxuY29uc3Qgc3BlYWtlYXN5ID0gcmVxdWlyZSgnc3BlYWtlYXN5Jyk7XHJcbmNvbnN0IFFSQ29kZSA9IHJlcXVpcmUoJ3FyY29kZScpO1xyXG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcclxuY29uc3Qgbm9kZW1haWxlciA9IHJlcXVpcmUoJ25vZGVtYWlsZXInKTtcclxuXHJcbmNsYXNzIE1GQVNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5vdHBFeHBpcmF0aW9uID0gNSAqIDYwICogMTAwMDsgLy8gNSBtaW51dGVzXHJcbiAgICB0aGlzLmJhY2t1cENvZGVzQ291bnQgPSAxMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIFRPVFAgU2VjcmV0IGFuZCBRUiBDb2RlXHJcbiAgICog2KXZhti02KfYoSDYsdmF2LIgVE9UUCDZiNmD2YjYryBRUlxyXG4gICAqL1xyXG4gIGFzeW5jIGdlbmVyYXRlVE9UUFNlY3JldCh1c2VyRW1haWwsIGFwcE5hbWUgPSAnRVJQIFN5c3RlbScpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHNlY3JldCA9IHNwZWFrZWFzeS5nZW5lcmF0ZVNlY3JldCh7XHJcbiAgICAgICAgbmFtZTogYCR7YXBwTmFtZX0gKCR7dXNlckVtYWlsfSlgLFxyXG4gICAgICAgIGlzc3VlcjogYXBwTmFtZSxcclxuICAgICAgICBsZW5ndGg6IDMyLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEdlbmVyYXRlIFFSIENvZGVcclxuICAgICAgY29uc3QgcXJDb2RlID0gYXdhaXQgUVJDb2RlLnRvRGF0YVVSTChzZWNyZXQub3RwYXV0aF91cmwpO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzZWNyZXQ6IHNlY3JldC5iYXNlMzIsXHJcbiAgICAgICAgcXJDb2RlLFxyXG4gICAgICAgIG90cGF1dGhfdXJsOiBzZWNyZXQub3RwYXV0aF91cmwsXHJcbiAgICAgICAgbWFudWFsRW50cnlLZXk6IHNlY3JldC5iYXNlMzIsXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZW5lcmF0ZSBUT1RQIHNlY3JldDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVyaWZ5IFRPVFAgVG9rZW5cclxuICAgKiDYp9mE2KrYrdmC2YIg2YXZhiDYsdmF2LIgVE9UUFxyXG4gICAqL1xyXG4gIHZlcmlmeVRPVFAodG9rZW4sIHNlY3JldCwgd2luZG93ID0gMikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IHNwZWFrZWFzeS50b3RwLnZlcmlmeSh7XHJcbiAgICAgICAgc2VjcmV0LFxyXG4gICAgICAgIGVuY29kaW5nVHlwZTogJ2Jhc2UzMicsXHJcbiAgICAgICAgdG9rZW4sXHJcbiAgICAgICAgd2luZG93LCAvLyBBbGxvdyAzMCBzZWNvbmRzIGJlZm9yZSBhbmQgYWZ0ZXJcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gaXNWYWxpZDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHZlcmlmeSBUT1RQIHRva2VuOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBFbWFpbCBPVFBcclxuICAgKiDYqtmI2YTZitivINix2YXYsiBPVFAg2LnYqNixINin2YTYqNix2YrYryDYp9mE2KXZhNmD2KrYsdmI2YbZilxyXG4gICAqL1xyXG4gIGdlbmVyYXRlRW1haWxPVFAoKSB7XHJcbiAgICBjb25zdCBvdHAgPSBjcnlwdG8ucmFuZG9tSW50KDEwMDAwMCwgOTk5OTk5KS50b1N0cmluZygpO1xyXG4gICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIHRoaXMub3RwRXhwaXJhdGlvbik7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY29kZTogb3RwLFxyXG4gICAgICBleHBpcmVzQXQsXHJcbiAgICAgIGV4cGlyZXNJbjogdGhpcy5vdHBFeHBpcmF0aW9uIC8gMTAwMCwgLy8gc2Vjb25kc1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIFNNUyBPVFBcclxuICAgKiDYqtmI2YTZitivINix2YXYsiBPVFAg2LnYqNixINin2YTYsdiz2KfYptmEINin2YTZhti12YrYqVxyXG4gICAqL1xyXG4gIGdlbmVyYXRlU01TT1RQKCkge1xyXG4gICAgY29uc3Qgb3RwID0gY3J5cHRvLnJhbmRvbUludCgxMDAwMDAsIDk5OTk5OSkudG9TdHJpbmcoKTtcclxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgKyB0aGlzLm90cEV4cGlyYXRpb24pO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGNvZGU6IG90cCxcclxuICAgICAgZXhwaXJlc0F0LFxyXG4gICAgICBleHBpcmVzSW46IHRoaXMub3RwRXhwaXJhdGlvbiAvIDEwMDAsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVyaWZ5IE9UUCBDb2RlXHJcbiAgICog2KfZhNiq2K3ZgtmCINmF2YYg2LHZhdiyIE9UUFxyXG4gICAqL1xyXG4gIHZlcmlmeU9UUChwcm92aWRlZENvZGUsIHN0b3JlZENvZGUsIGV4cGlyZXNBdCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2hlY2sgaWYgT1RQIGhhcyBleHBpcmVkXHJcbiAgICAgIGlmIChuZXcgRGF0ZSgpID4gbmV3IERhdGUoZXhwaXJlc0F0KSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdPVFAgaGFzIGV4cGlyZWQnLFxyXG4gICAgICAgICAgZXJyb3I6ICdFWFBJUkVEJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDaGVjayBpZiBjb2RlIG1hdGNoZXMgKGNvbnN0YW50IHRpbWUgY29tcGFyaXNvbilcclxuICAgICAgY29uc3QgaXNWYWxpZCA9IGNyeXB0by50aW1pbmdTYWZlRXF1YWwoXHJcbiAgICAgICAgQnVmZmVyLmZyb20ocHJvdmlkZWRDb2RlLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgIEJ1ZmZlci5mcm9tKHN0b3JlZENvZGUudG9TdHJpbmcoKSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaXNWYWxpZCxcclxuICAgICAgICBtZXNzYWdlOiBpc1ZhbGlkID8gJ09UUCB2ZXJpZmllZCBzdWNjZXNzZnVsbHknIDogJ0ludmFsaWQgT1RQJyxcclxuICAgICAgICBlcnJvcjogaXNWYWxpZCA/IG51bGwgOiAnSU5WQUxJRF9PVFAnLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAnT1RQIHZlcmlmaWNhdGlvbiBmYWlsZWQnLFxyXG4gICAgICAgIGVycm9yOiAnVkVSSUZJQ0FUSU9OX0ZBSUxFRCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBCYWNrdXAgQ29kZXNcclxuICAgKiDYqtmI2YTZitivINij2YPZiNin2K8g2KfYrdiq2YrYp9i32YrYqVxyXG4gICAqL1xyXG4gIGdlbmVyYXRlQmFja3VwQ29kZXMoY291bnQgPSB0aGlzLmJhY2t1cENvZGVzQ291bnQpIHtcclxuICAgIGNvbnN0IGNvZGVzID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgY29uc3QgY29kZSA9IGNyeXB0by5yYW5kb21CeXRlcyg0KS50b1N0cmluZygnaGV4JykudG9VcHBlckNhc2UoKTtcclxuICAgICAgY29kZXMucHVzaChgJHtjb2RlLnNsaWNlKDAsIDQpfS0ke2NvZGUuc2xpY2UoNCl9YCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29kZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIYXNoIEJhY2t1cCBDb2RlIChmb3Igc3RvcmFnZSlcclxuICAgKiDYqti02YHZitixINix2YXYsiDYp9it2KrZitin2LfZiiDZhNmE2KrYrtiy2YrZhlxyXG4gICAqL1xyXG4gIGhhc2hCYWNrdXBDb2RlKGNvZGUpIHtcclxuICAgIHJldHVybiBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKGNvZGUpLmRpZ2VzdCgnaGV4Jyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWZXJpZnkgQmFja3VwIENvZGVcclxuICAgKiDYp9mE2KrYrdmC2YIg2YXZhiDYp9mE2LHZhdiyINin2YTYp9it2KrZitin2LfZilxyXG4gICAqL1xyXG4gIHZlcmlmeUJhY2t1cENvZGUocHJvdmlkZWRDb2RlLCBoYXNoZWRDb2RlKSB7XHJcbiAgICBjb25zdCBoYXNoID0gY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShwcm92aWRlZENvZGUpLmRpZ2VzdCgnaGV4Jyk7XHJcbiAgICByZXR1cm4gY3J5cHRvLnRpbWluZ1NhZmVFcXVhbChcclxuICAgICAgQnVmZmVyLmZyb20oaGFzaCksXHJcbiAgICAgIEJ1ZmZlci5mcm9tKGhhc2hlZENvZGUpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgTUZBIFJlY292ZXJ5IEtleVxyXG4gICAqINil2YbYtNin2KEg2YXZgdiq2KfYrSDYp9iz2KrYsdis2KfYuSBNRkFcclxuICAgKi9cclxuICBnZW5lcmF0ZVJlY292ZXJ5S2V5KCkge1xyXG4gICAgcmV0dXJuIGNyeXB0by5yYW5kb21CeXRlcygxNikudG9TdHJpbmcoJ2hleCcpLnRvVXBwZXJDYXNlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgTUZBIFNlc3Npb25cclxuICAgKiDYpdmG2LTYp9ihINis2YTYs9ipIE1GQVxyXG4gICAqL1xyXG4gIGNyZWF0ZU1GQVNlc3Npb24odXNlcklkLCBtZXRob2QgPSAndG90cCcsIG1ldGFkYXRhID0ge30pIHtcclxuICAgIGNvbnN0IHNlc3Npb25JZCA9IGNyeXB0by5yYW5kb21CeXRlcygxNikudG9TdHJpbmcoJ2hleCcpO1xyXG4gICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDE1ICogNjAgKiAxMDAwKTsgLy8gMTUgbWludXRlc1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHNlc3Npb25JZCxcclxuICAgICAgdXNlcklkLFxyXG4gICAgICBtZXRob2QsXHJcbiAgICAgIGV4cGlyZXNBdCxcclxuICAgICAgYXR0ZW1wdHM6IDAsXHJcbiAgICAgIG1heEF0dGVtcHRzOiA1LFxyXG4gICAgICBtZXRhZGF0YSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWYWxpZGF0ZSBNRkEgU2Vzc2lvblxyXG4gICAqINin2YTYqtit2YLZgiDZhdmGINis2YTYs9ipIE1GQVxyXG4gICAqL1xyXG4gIHZhbGlkYXRlTUZBU2Vzc2lvbihzZXNzaW9uKSB7XHJcbiAgICBpZiAoIXNlc3Npb24pIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiAnTUZBIHNlc3Npb24gbm90IGZvdW5kJyxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobmV3IERhdGUoKSA+IG5ldyBEYXRlKHNlc3Npb24uZXhwaXJlc0F0KSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdNRkEgc2Vzc2lvbiBoYXMgZXhwaXJlZCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNlc3Npb24uYXR0ZW1wdHMgPj0gc2Vzc2lvbi5tYXhBdHRlbXB0cykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdNYXhpbXVtIHZlcmlmaWNhdGlvbiBhdHRlbXB0cyBleGNlZWRlZCcsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXNWYWxpZDogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogJ01GQSBzZXNzaW9uIGlzIHZhbGlkJyxcclxuICAgICAgYXR0ZW1wdHNSZW1haW5pbmc6IHNlc3Npb24ubWF4QXR0ZW1wdHMgLSBzZXNzaW9uLmF0dGVtcHRzLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIFRydXN0ZWQgRGV2aWNlIFRva2VuXHJcbiAgICog2KXZhti02KfYoSDYsdmF2LIg2KzZh9in2LIg2YXZiNir2YjZglxyXG4gICAqL1xyXG4gIGdlbmVyYXRlVHJ1c3RlZERldmljZVRva2VuKHVzZXJJZCwgZGV2aWNlRmluZ2VycHJpbnQpIHtcclxuICAgIGNvbnN0IHRva2VuID0gY3J5cHRvXHJcbiAgICAgIC5jcmVhdGVIYXNoKCdzaGEyNTYnKVxyXG4gICAgICAudXBkYXRlKGAke3VzZXJJZH06JHtkZXZpY2VGaW5nZXJwcmludH06JHtEYXRlLm5vdygpfWApXHJcbiAgICAgIC5kaWdlc3QoJ2hleCcpO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRva2VuLFxyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCksIC8vIDMwIGRheXNcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgTUZBIFNldHVwIEd1aWRlXHJcbiAgICog2KfZhNit2LXZiNmEINi52YTZiSDYr9mE2YrZhCDYpdi52K/Yp9ivIE1GQVxyXG4gICAqL1xyXG4gIGdldE1GQVNldHVwR3VpZGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RwOiB7XHJcbiAgICAgICAgbmFtZTogJ1RpbWUtYmFzZWQgT25lLVRpbWUgUGFzc3dvcmQgKFRPVFApJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ1VzZSBhbiBhdXRoZW50aWNhdG9yIGFwcCBsaWtlIEdvb2dsZSBBdXRoZW50aWNhdG9yIG9yIEF1dGh5JyxcclxuICAgICAgICBzdGVwczogW1xyXG4gICAgICAgICAgJ0Rvd25sb2FkIGFuIGF1dGhlbnRpY2F0b3IgYXBwIChHb29nbGUgQXV0aGVudGljYXRvciwgTWljcm9zb2Z0IEF1dGhlbnRpY2F0b3IsIG9yIEF1dGh5KScsXHJcbiAgICAgICAgICAnU2NhbiB0aGUgUVIgY29kZSBkaXNwbGF5ZWQgb24gdGhlIHNldHVwIHBhZ2UnLFxyXG4gICAgICAgICAgJ0VudGVyIHRoZSA2LWRpZ2l0IGNvZGUgZnJvbSB5b3VyIGF1dGhlbnRpY2F0b3IgYXBwJyxcclxuICAgICAgICAgICdTYXZlIHlvdXIgYmFja3VwIGNvZGVzIGluIGEgc2FmZSBwbGFjZScsXHJcbiAgICAgICAgXSxcclxuICAgICAgICBhZHZhbnRhZ2VzOiBbXHJcbiAgICAgICAgICAnV29ya3Mgb2ZmbGluZScsXHJcbiAgICAgICAgICAnTm8gbmVlZCBmb3IgU01TIG9yIGVtYWlsJyxcclxuICAgICAgICAgICdXaWRlbHkgc3VwcG9ydGVkJyxcclxuICAgICAgICBdLFxyXG4gICAgICB9LFxyXG4gICAgICBlbWFpbDoge1xyXG4gICAgICAgIG5hbWU6ICdFbWFpbCBPbmUtVGltZSBQYXNzd29yZCcsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdSZWNlaXZlIGEgY29kZSB2aWEgZW1haWwgZm9yIHZlcmlmaWNhdGlvbicsXHJcbiAgICAgICAgc3RlcHM6IFtcclxuICAgICAgICAgICdXaGVuIGxvZ2dpbmcgaW4sIHlvdSB3aWxsIHJlY2VpdmUgYSA2LWRpZ2l0IGNvZGUgdmlhIGVtYWlsJyxcclxuICAgICAgICAgICdFbnRlciB0aGUgY29kZSBpbiB0aGUgdmVyaWZpY2F0aW9uIHByb21wdCcsXHJcbiAgICAgICAgICAnVGhlIGNvZGUgZXhwaXJlcyBhZnRlciA1IG1pbnV0ZXMnLFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgYWR2YW50YWdlczogW1xyXG4gICAgICAgICAgJ05vIGFkZGl0aW9uYWwgYXBwIG5lZWRlZCcsXHJcbiAgICAgICAgICAnV29ya3Mgb24gYW55IGRldmljZScsXHJcbiAgICAgICAgXSxcclxuICAgICAgfSxcclxuICAgICAgc21zOiB7XHJcbiAgICAgICAgbmFtZTogJ1NNUyBPbmUtVGltZSBQYXNzd29yZCcsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdSZWNlaXZlIGEgY29kZSB2aWEgdGV4dCBtZXNzYWdlIGZvciB2ZXJpZmljYXRpb24nLFxyXG4gICAgICAgIHN0ZXBzOiBbXHJcbiAgICAgICAgICAnV2hlbiBsb2dnaW5nIGluLCB5b3Ugd2lsbCByZWNlaXZlIGEgNi1kaWdpdCBjb2RlIHZpYSBTTVMnLFxyXG4gICAgICAgICAgJ0VudGVyIHRoZSBjb2RlIGluIHRoZSB2ZXJpZmljYXRpb24gcHJvbXB0JyxcclxuICAgICAgICAgICdUaGUgY29kZSBleHBpcmVzIGFmdGVyIDUgbWludXRlcycsXHJcbiAgICAgICAgXSxcclxuICAgICAgICBhZHZhbnRhZ2VzOiBbXHJcbiAgICAgICAgICAnV29ya3Mgb24gYW55IHBob25lJyxcclxuICAgICAgICAgICdGYXN0IGRlbGl2ZXJ5JyxcclxuICAgICAgICBdLFxyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSBTZWN1cml0eSBTY29yZVxyXG4gICAqINit2LPYp9ioINiv2LHYrNipINin2YTYo9mF2KfZhlxyXG4gICAqL1xyXG4gIGNhbGN1bGF0ZVNlY3VyaXR5U2NvcmUobWZhTWV0aG9kcykge1xyXG4gICAgbGV0IHNjb3JlID0gMDtcclxuICAgIGNvbnN0IG1heFNjb3JlID0gMTAwO1xyXG5cclxuICAgIGlmIChtZmFNZXRob2RzLnRvdHApIHNjb3JlICs9IDQwO1xyXG4gICAgaWYgKG1mYU1ldGhvZHMuZW1haWwpIHNjb3JlICs9IDMwO1xyXG4gICAgaWYgKG1mYU1ldGhvZHMuc21zKSBzY29yZSArPSAyMDtcclxuICAgIGlmIChtZmFNZXRob2RzLmJhY2t1cENvZGVzICYmIG1mYU1ldGhvZHMuYmFja3VwQ29kZXMubGVuZ3RoID4gMCkgc2NvcmUgKz0gMTA7XHJcblxyXG4gICAgcmV0dXJuIE1hdGgubWluKHNjb3JlLCBtYXhTY29yZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSBNRkEgQXVkaXQgTG9nXHJcbiAgICog2KXZhti02KfYoSDYs9is2YQg2KrYr9mC2YrZgiBNRkFcclxuICAgKi9cclxuICBjcmVhdGVBdWRpdExvZyh1c2VySWQsIGFjdGlvbiwgc3RhdHVzLCBtZXRhZGF0YSA9IHt9KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB1c2VySWQsXHJcbiAgICAgIGFjdGlvbixcclxuICAgICAgc3RhdHVzLFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIGlwQWRkcmVzczogbWV0YWRhdGEuaXBBZGRyZXNzIHx8IG51bGwsXHJcbiAgICAgIHVzZXJBZ2VudDogbWV0YWRhdGEudXNlckFnZW50IHx8IG51bGwsXHJcbiAgICAgIGRldmljZUluZm86IG1ldGFkYXRhLmRldmljZUluZm8gfHwgbnVsbCxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBNRkFTZXJ2aWNlKCk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLFNBQVMsR0FBR0MsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUN0QyxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLE1BQU1HLFVBQVUsR0FBR0gsT0FBTyxDQUFDLFlBQVksQ0FBQztBQUV4QyxNQUFNSSxVQUFVLENBQUM7RUFDZkMsV0FBV0EsQ0FBQSxFQUFHO0lBQ1osSUFBSSxDQUFDQyxhQUFhLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztJQUNwQyxJQUFJLENBQUNDLGdCQUFnQixHQUFHLEVBQUU7RUFDNUI7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRSxNQUFNQyxrQkFBa0JBLENBQUNDLFNBQVMsRUFBRUMsT0FBTyxHQUFHLFlBQVksRUFBRTtJQUMxRCxJQUFJO01B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