/**
 * Phase 10 Analytics Services Tests
 * Comprehensive test suite for Dashboard, Report, and Metrics services
 */\n\nconst dashboardService = require('../services/analytics/dashboardService');\nconst reportService = require('../services/analytics/reportService');\nconst metricsService = require('../services/analytics/metricsService');\n\nclass AnalyticsTestSuite {\n  constructor() {\n    this.testResults = [];\n    this.testCount = 0;\n    this.passCount = 0;\n    this.failCount = 0;\n  }\n\n  /**\n   * Run all tests\n   */\n  runAllTests() {\n    console.log('\\n' + '='.repeat(70));\n    console.log('  PHASE 10 - ANALYTICS SERVICES TEST SUITE');\n    console.log('='.repeat(70) + '\\n');\n\n    this.testDashboardService();\n    this.testReportService();\n    this.testMetricsService();\n\n    this.printSummary();\n  }\n\n  /**\n   * Test Dashboard Service\n   */\n  testDashboardService() {\n    console.log('\\nüìä DASHBOARD SERVICE TESTS\\n');\n\n    // Test 1: Create dashboard\n    this.test('Create dashboard', () => {\n      const dashboard = dashboardService.createDashboard('user-1', {\n        name: 'Sales Dashboard',\n        description: 'Q1 Sales Performance'\n      });\n      return dashboard.id && dashboard.userId === 'user-1';\n    });\n\n    // Test 2: Get dashboard\n    this.test('Get dashboard by ID', () => {\n      const dashboard = dashboardService.createDashboard('user-2', { name: 'Test' });\n      const retrieved = dashboardService.getDashboard(dashboard.id);\n      return retrieved.id === dashboard.id;\n    });\n\n    // Test 3: List dashboards\n    this.test('List user dashboards', () => {\n      dashboardService.createDashboard('user-3', { name: 'Dashboard 1' });\n      dashboardService.createDashboard('user-3', { name: 'Dashboard 2' });\n      const dashboards = dashboardService.listDashboards('user-3');\n      return dashboards.length >= 2;\n    });\n\n    // Test 4: Update dashboard\n    this.test('Update dashboard', () => {\n      const dashboard = dashboardService.createDashboard('user-4', { name: 'Old Name' });\n      const updated = dashboardService.updateDashboard(dashboard.id, { name: 'New Name' });\n      return updated.name === 'New Name';\n    });\n\n    // Test 5: Delete dashboard\n    this.test('Delete dashboard', () => {\n      const dashboard = dashboardService.createDashboard('user-5', { name: 'To Delete' });\n      const success = dashboardService.deleteDashboard(dashboard.id);\n      return success;\n    });\n\n    // Test 6: Add widget\n    this.test('Add widget to dashboard', () => {\n      const dashboard = dashboardService.createDashboard('user-6', { name: 'Widget Test' });\n      const widget = dashboardService.addWidget(dashboard.id, {\n        type: 'metric-card',\n        title: 'Total Revenue'\n      });\n      return widget.id && dashboard.widgets.includes(widget.id);\n    });\n\n    // Test 7: Update widget\n    this.test('Update widget configuration', () => {\n      const dashboard = dashboardService.createDashboard('user-7', { name: 'Test' });\n      const widget = dashboardService.addWidget(dashboard.id, { type: 'line-chart' });\n      const updated = dashboardService.updateWidget(widget.id, { refreshInterval: 60000 });\n      return updated.config.refreshInterval === 60000;\n    });\n\n    // Test 8: Remove widget\n    this.test('Remove widget from dashboard', () => {\n      const dashboard = dashboardService.createDashboard('user-8', { name: 'Test' });\n      const widget = dashboardService.addWidget(dashboard.id, { type: 'bar-chart' });\n      const success = dashboardService.removeWidget(dashboard.id, widget.id);\n      return success && !dashboard.widgets.includes(widget.id);\n    });\n\n    // Test 9: Get widget data\n    this.test('Get widget data', () => {\n      const dashboard = dashboardService.createDashboard('user-9', { name: 'Test' });\n      const widget = dashboardService.addWidget(dashboard.id, { type: 'pie-chart' });\n      const data = dashboardService.getWidgetData(widget.id);\n      return data.id === widget.id && data.data !== undefined;\n    });\n\n    // Test 10: Refresh widget\n    this.test('Refresh widget data', () => {\n      const dashboard = dashboardService.createDashboard('user-10', { name: 'Test' });\n      const widget = dashboardService.addWidget(dashboard.id, { type: 'metric-card' });\n      const refreshed = dashboardService.refreshWidget(widget.id);\n      return refreshed.status === 'success' && refreshed.lastUpdate !== undefined;\n    });\n\n    // Test 11: Share dashboard\n    this.test('Share dashboard with users', () => {\n      const dashboard = dashboardService.createDashboard('user-11', { name: 'Test' });\n      const shared = dashboardService.shareDashboard(dashboard.id, ['user-12', 'user-13']);\n      return shared.sharedWith.includes('user-12') && shared.sharedWith.includes('user-13');\n    });\n\n    // Test 12: Subscribe to dashboard\n    this.test('Subscribe to dashboard updates', () => {\n      const dashboard = dashboardService.createDashboard('user-14', { name: 'Test' });\n      const callback = () => {};\n      const subId = dashboardService.subscribeToDashboard(dashboard.id, callback);\n      return subId !== undefined;\n    });\n\n    // Test 13: Get dashboard stats\n    this.test('Get dashboard statistics', () => {\n      const dashboard = dashboardService.createDashboard('user-15', { name: 'Test' });\n      dashboardService.addWidget(dashboard.id, { type: 'line-chart' });\n      dashboardService.addWidget(dashboard.id, { type: 'bar-chart' });\n      const stats = dashboardService.getDashboardStats(dashboard.id);\n      return stats.totalWidgets === 2;\n    });\n  }\n\n  /**\n   * Test Report Service\n   */\n  testReportService() {\n    console.log('\\nüìã REPORT SERVICE TESTS\\n');\n\n    // Test 1: Create report\n    this.test('Create report', () => {\n      const report = reportService.createReport('user-1', {\n        name: 'Monthly Sales',\n        type: 'sales'\n      });\n      return report.id && report.generationStatus === 'draft';\n    });\n\n    // Test 2: Get report\n    this.test('Get report by ID', () => {\n      const report = reportService.createReport('user-2', { name: 'Test' });\n      const retrieved = reportService.getReport(report.id);\n      return retrieved.id === report.id;\n    });\n\n    // Test 3: List reports\n    this.test('List user reports', () => {\n      reportService.createReport('user-3', { name: 'Report 1' });\n      reportService.createReport('user-3', { name: 'Report 2' });\n      const reports = reportService.listReports('user-3');\n      return reports.length >= 2;\n    });\n\n    // Test 4: Generate report\n    this.test('Generate report', () => {\n      const report = reportService.createReport('user-4', { name: 'Sales' });\n      const testData = [{ product: 'A', revenue: 1000 }];\n      const result = reportService.generateReport(report.id, testData);\n      return result.status === 'success';\n    });\n\n    // Test 5: Schedule report\n    this.test('Schedule recurring report', () => {\n      const report = reportService.createReport('user-5', { name: 'Test' });\n      const schedule = reportService.scheduleReport(report.id, {\n        frequency: 'daily',\n        recipients: ['user@example.com']\n      });\n      return schedule.frequency === 'daily';\n    });\n\n    // Test 6: Update report\n    this.test('Update report', () => {\n      const report = reportService.createReport('user-6', { name: 'Old Name' });\n      const updated = reportService.updateReport(report.id, { name: 'New Name' });\n      return updated.name === 'New Name';\n    });\n\n    // Test 7: Delete report\n    this.test('Delete report', () => {\n      const report = reportService.createReport('user-7', { name: 'To Delete' });\n      const success = reportService.deleteReport(report.id);\n      return success;\n    });\n\n    // Test 8: Get templates\n    this.test('Get report templates', () => {\n      const templates = reportService.getTemplates();\n      return templates.salesSummary !== undefined && templates.hrReport !== undefined;\n    });\n\n    // Test 9: Export report\n    this.test('Export report', () => {\n      const report = reportService.createReport('user-9', { name: 'Test', format: 'pdf' });\n      const testData = [{ id: 1, value: 100 }];\n      reportService.generateReport(report.id, testData);\n      const exported = reportService.exportReport(report.id);\n      return exported.format === 'pdf';\n    });\n\n    // Test 10: Apply filters\n    this.test('Generate report with filters', () => {\n      const report = reportService.createReport('user-10', {\n        name: 'Filtered Report',\n        filters: { status: 'completed' }\n      });\n      const testData = [\n        { id: 1, status: 'completed', value: 100 },\n        { id: 2, status: 'pending', value: 50 }\n      ];\n      const result = reportService.generateReport(report.id, testData);\n      return result.rowCount === 1;\n    });\n  }\n\n  /**\n   * Test Metrics Service\n   */\n  testMetricsService() {\n    console.log('\\nüìà METRICS SERVICE TESTS\\n');\n\n    // Test 1: Record metric\n    this.test('Record metric value', () => {\n      const metric = metricsService.recordMetric('cpu_usage', 45.5, { server: 'prod-1' });\n      return metric.name === 'cpu_usage' && metric.value === 45.5;\n    });\n\n    // Test 2: Get metric values\n    this.test('Get metric values', () => {\n      metricsService.recordMetric('memory_usage', 60, { server: 'prod-1' });\n      const now = new Date();\n      const startDate = new Date(now.getTime() - 3600000);\n      const values = metricsService.getMetricValues('memory_usage', startDate, now);\n      return values.length > 0;\n    });\n\n    // Test 3: Calculate metric stats\n    this.test('Calculate metric statistics', () => {\n      metricsService.recordMetric('latency', 100);\n      metricsService.recordMetric('latency', 150);\n      metricsService.recordMetric('latency', 200);\n      const stats = metricsService.calculateMetricStats('latency');\n      return stats.count === 3 && stats.average === 150;\n    });\n\n    // Test 4: Define KPI\n    this.test('Define KPI', () => {\n      const kpi = metricsService.defineKPI('conversion_rate', {\n        description: 'Website conversion rate',\n        target: 5,\n        unit: '%'\n      });\n      return kpi.name === 'conversion_rate' && kpi.target === 5;\n    });\n\n    // Test 5: Calculate KPI\n    this.test('Calculate KPI value', () => {\n      const kpi = metricsService.defineKPI('sales_target', {\n        target: 100000,\n        unit: '$'\n      });\n      const result = metricsService.calculateKPI(kpi.id, { value: 75000 });\n      return result.percentage === '75.00';\n    });\n\n    // Test 6: List KPIs\n    this.test('List KPIs', () => {\n      metricsService.defineKPI('kpi1', { category: 'sales' });\n      metricsService.defineKPI('kpi2', { category: 'sales' });\n      const kpis = metricsService.listKPIs({ category: 'sales' });\n      return kpis.length >= 2;\n    });\n\n    // Test 7: Get KPI dashboard\n    this.test('Get KPI dashboard', () => {\n      metricsService.defineKPI('dashboard_kpi', { category: 'general' });\n      const dashboard = metricsService.getKPIDashboard('general');\n      return dashboard.totalKPIs > 0 && dashboard.statusCounts !== undefined;\n    });\n\n    // Test 8: Get metric trend\n    this.test('Get metric trend', () => {\n      for (let i = 0; i < 5; i++) {\n        metricsService.recordMetric('trend_test', 50 + i * 10);\n      }\n      const trend = metricsService.getMetricTrend('trend_test', 7);\n      return trend.length > 0;\n    });\n\n    // Test 9: Compare metrics\n    this.test('Compare metrics', () => {\n      metricsService.recordMetric('metric_a', 100);\n      metricsService.recordMetric('metric_b', 200);\n      const now = new Date();\n      const startDate = new Date(now.getTime() - 3600000);\n      const comparison = metricsService.compareMetrics(['metric_a', 'metric_b'], startDate, now);\n      return 'metric_a' in comparison && 'metric_b' in comparison;\n    });\n  }\n\n  /**\n   * Test helper - Run single test\n   */\n  test(description, testFn) {\n    this.testCount++;\n    try {\n      const result = testFn();\n      if (result) {\n        this.passCount++;\n        console.log(`  ‚úÖ ${description}`);\n      } else {\n        this.failCount++;\n        console.log(`  ‚ùå ${description} - Assertion failed`);\n      }\n    } catch (error) {\n      this.failCount++;\n      console.log(`  ‚ùå ${description} - ${error.message}`);\n    }\n  }\n\n  /**\n   * Print test summary\n   */\n  printSummary() {\n    const successRate = ((this.passCount / this.testCount) * 100).toFixed(1);\n    console.log('\\n' + '='.repeat(70));\n    console.log('  TEST SUMMARY');\n    console.log('='.repeat(70));\n    console.log(`\\n  Total Tests: ${this.testCount}`);\n    console.log(`  ‚úÖ Passed: ${this.passCount}`);\n    console.log(`  ‚ùå Failed: ${this.failCount}`);\n    console.log(`\\n  Success Rate: ${successRate}%`);\n    console.log(`\\n  Status: ${this.failCount === 0 ? '‚úÖ ALL TESTS PASSED' : '‚ùå SOME TESTS FAILED'}`);\n    console.log('\\n' + '='.repeat(70) + '\\n');\n  }\n}\n\n// Run tests if executed directly\nif (require.main === module) {\n  const testSuite = new AnalyticsTestSuite();\n  testSuite.runAllTests();\n}\n\nmodule.exports = AnalyticsTestSuite;\n