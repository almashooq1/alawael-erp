/**\n * RBAC Controller\n * Handles role and permission management\n * Maps requests to RBACService methods\n */\n\nconst RBACService = require('../services/rbacService');\n\nclass RBACController {\n  constructor() {\n    this.rbacService = new RBACService();\n  }\n\n  /**\n   * Create a new role\n   * POST /api/v1/roles\n   */\n  async createRole(req, res, next) {\n    try {\n      const { name, description, permissions } = req.body;\n\n      if (!name) {\n        return res.status(400).json({\n          error: 'validation_error',\n          message: 'Role name is required',\n          code: 'MISSING_NAME'\n        });\n      }\n\n      const role = this.rbacService.createRole({\n        name,\n        description: description || '',\n        permissions: permissions || []\n      });\n\n      res.status(201).json({\n        success: true,\n        data: role\n      });\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Get role by ID\n   * GET /api/v1/roles/:id\n   */\n  async getRole(req, res, next) {\n    try {\n      const { id } = req.params;\n\n      const role = this.rbacService.getRole(id);\n\n      res.json({\n        success: true,\n        data: role\n      });\n    } catch (error) {\n      if (error.message.includes('not found')) {\n        return res.status(404).json({\n          error: 'not_found',\n          message: error.message,\n          code: 'ROLE_NOT_FOUND'\n        });\n      }\n      next(error);\n    }\n  }\n\n  /**\n   * List all roles\n   * GET /api/v1/roles\n   */\n  async listRoles(req, res, next) {\n    try {\n      const roles = this.rbacService.listRoles();\n\n      res.json({\n        success: true,\n        data: roles,\n        count: roles.length\n      });\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Update role\n   * PUT /api/v1/roles/:id\n   */\n  async updateRole(req, res, next) {\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n\n      const updated = this.rbacService.updateRole(id, updates);\n\n      res.json({\n        success: true,\n        data: updated\n      });\n    } catch (error) {\n      if (error.message.includes('not found')) {\n        return res.status(404).json({\n          error: 'not_found',\n          message: error.message,\n          code: 'ROLE_NOT_FOUND'\n        });\n      }\n      next(error);\n    }\n  }\n\n  /**\n   * Delete role\n   * DELETE /api/v1/roles/:id\n   */\n  async deleteRole(req, res, next) {\n    try {\n      const { id } = req.params;\n\n      this.rbacService.deleteRole(id);\n\n      res.status(204).send();\n    } catch (error) {\n      if (error.message.includes('not found')) {\n        return res.status(404).json({\n          error: 'not_found',\n          message: error.message,\n          code: 'ROLE_NOT_FOUND'\n        });\n      }\n      next(error);\n    }\n  }\n\n  /**\n   * Assign role to user\n   * POST /api/v1/users/:userId/roles/:roleId\n   */\n  async assignRoleToUser(req, res, next) {\n    try {\n      const { userId, roleId } = req.params;\n\n      const result = this.rbacService.assignRoleToUser(userId, roleId);\n\n      res.status(201).json({\n        success: true,\n        data: result\n      });\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Revoke role from user\n   * DELETE /api/v1/users/:userId/roles/:roleId\n   */\n  async revokeRoleFromUser(req, res, next) {\n    try {\n      const { userId, roleId } = req.params;\n\n      this.rbacService.revokeRoleFromUser(userId, roleId);\n\n      res.status(204).send();\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Get user roles\n   * GET /api/v1/users/:userId/roles\n   */\n  async getUserRoles(req, res, next) {\n    try {\n      const { userId } = req.params;\n\n      const roles = this.rbacService.getUserRoles(userId);\n\n      res.json({\n        success: true,\n        data: roles,\n        count: roles.length\n      });\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Get user permissions\n   * GET /api/v1/users/:userId/permissions\n   */\n  async getUserPermissions(req, res, next) {\n    try {\n      const { userId } = req.params;\n\n      const permissions = this.rbacService.getUserPermissions(userId);\n\n      res.json({\n        success: true,\n        data: permissions,\n        count: permissions.length\n      });\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Check if user has permission\n   * GET /api/v1/users/:userId/permissions/:permissionKey\n   */\n  async checkPermission(req, res, next) {\n    try {\n      const { userId, permissionKey } = req.params;\n\n      const hasPermission = this.rbacService.hasPermission(userId, permissionKey);\n\n      res.json({\n        success: true,\n        data: {\n          userId,\n          permission: permissionKey,\n          hasPermission\n        }\n      });\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Check resource access\n   * POST /api/v1/users/:userId/access\n   */\n  async checkResourceAccess(req, res, next) {\n    try {\n      const { userId } = req.params;\n      const { action, resource } = req.body;\n\n      if (!action || !resource) {\n        return res.status(400).json({\n          error: 'validation_error',\n          message: 'Action and resource are required',\n          code: 'MISSING_FIELDS'\n        });\n      }\n\n      const hasAccess = this.rbacService.checkResourceAccess(userId, action, resource);\n\n      res.json({\n        success: true,\n        data: {\n          userId,\n          action,\n          resource,\n          hasAccess\n        }\n      });\n    } catch (error) {\n      next(error);\n    }\n  }\n}\n\nmodule.exports = RBACController;\n