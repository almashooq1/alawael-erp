// Mock Models
const Employee = require('../models/Employee'); // For Interns
const TherapySession = require('../models/TherapySession');

/**
 * PHASE 54: Academic & Research Hub
 * Manages the "Teaching Center" aspect: University Interns and Clinical Research.
 */
class SmartAcademicService {
  /**
   * Internship Supervisor
   * Tracks clinical hours against University requirements.
   */
  static async trackInternProgress(internId) {
    // Mock Data
    const supervisorConfig = {
      requiredDirectHours: 100, // Client contact
      requiredIndirectHours: 50, // Documentation/Planning
      university: 'King Saud University',
    };

    const completedSessions = await TherapySession.countDocuments({ therapist: internId, status: 'COMPLETED' });
    const directHours = completedSessions * 0.75; // 45 min sessions

    const progress = (directHours / supervisorConfig.requiredDirectHours) * 100;

    return {
      internId,
      university: supervisorConfig.university,
      hoursLog: {
        direct: directHours,
        required: supervisorConfig.requiredDirectHours,
        remaining: supervisorConfig.requiredDirectHours - directHours,
      },
      status: progress >= 100 ? 'READY_FOR_GRADUATION' : 'IN_PROGRESS',
      feedback: progress < 50 ? 'Behind schedule based on semester timeline.' : 'On track.',
    };
  }

  /**
   * Clinical Case Study Generator (Auto-Draft)
   * Compiles patient history into a standardized case study format for educational review.
   * *Strictly Anonymized*
   */
  static async generateCaseStudy(patientId) {
    // In real app, fetch deep history.

    const caseStudyDraft = {
      title: 'Impact of Sensory Integration on 5-year-old with ASD',
      background: 'Patient X presented with severe tactile defensiveness...',
      intervention: 'Applied Wilbarger Protocol over 6 weeks...',
      outcomes: {
        preInterventionScore: 12,
        postInterventionScore: 28,
        improvement: '133%',
      },
      citation: 'Generated by AlAwael Smart System v6.0',
    };

    return caseStudyDraft;
  }
}

module.exports = SmartAcademicService;
