import React, { useState, useEffect } from 'react';\nimport './AIAnalyticsPanel.css';\n\n/**\n * AIAnalyticsPanel Component\n * \n * Provides AI-powered analytics with trend analysis, anomaly detection,\n * pattern recognition, correlation analysis, and forecasting\n */\nfunction AIAnalyticsPanel({ datasetName = 'payroll', timeRange = 12 }) {\n  const [analysisType, setAnalysisType] = useState('trend');\n  const [inputData, setInputData] = useState([]);\n  const [dataInput, setDataInput] = useState('');\n  const [results, setResults] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [selectedFields, setSelectedFields] = useState(['value']);\n\n  const analyzeData = () => {\n    if (!dataInput.trim()) {\n      setError('Please enter data to analyze');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    try {\n      // Parse input data (CSV format: value1,value2,value3...)\n      const values = dataInput\n        .split(',\\n')\n        .map(v => parseFloat(v.trim()))\n        .filter(v => !isNaN(v));\n\n      if (values.length === 0) {\n        throw new Error('No valid numeric values found in input');\n      }\n\n      let analysisResult;\n\n      switch (analysisType) {\n        case 'trend':\n          analysisResult = window.aiService?.analyzeTrend?.(values);\n          break;\n        case 'anomaly':\n          analysisResult = window.aiService?.detectAnomalies?.(values);\n          break;\n        case 'pattern':\n          analysisResult = window.aiService?.findPatterns?.(values);\n          break;\n        case 'predict':\n          analysisResult = window.aiService?.forecastValues?.(values, values.length);\n          break;\n        case 'correlation':\n          // For correlation, we need paired data\n          const pairs = values.slice(0, Math.floor(values.length / 2));\n          const pairs2 = values.slice(Math.floor(values.length / 2));\n          analysisResult = window.aiService?.correlateData?.([pairs, pairs2]);\n          break;\n        default:\n          analysisResult = window.aiService?.analyzeTrend?.(values);\n      }\n\n      setResults(analysisResult || {});\n    } catch (err) {\n      setError(`Analysis error: ${err.message}`);\n      console.error('Analysis error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDataInputChange = (e) => {\n    setDataInput(e.target.value);\n    setResults(null);\n  };\n\n  const exampleData = () => {\n    const examples = {\n      trend: '100, 102, 105, 103, 108, 110, 112, 115, 118, 120, 122, 125',\n      anomaly: '50, 51, 49, 52, 50, 48, 200, 49, 51, 50, 49, 52',\n      pattern: '10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120',\n      predict: '100, 110, 115, 125, 130, 140, 145, 155, 160, 170, 175, 185',\n      correlation: '10,20,30,40,50,60,15,25,35,45,55,65'\n    };\n    setDataInput(examples[analysisType]);\n  };\n\n  const analysisOptions = [\n    { id: 'trend', label: 'ğŸ“ˆ Trend Analysis', icon: 'ğŸ“Š' },\n    { id: 'anomaly', label: 'ğŸš¨ Anomaly Detection', icon: 'âš ï¸' },\n    { id: 'pattern', label: 'ğŸ” Pattern Recognition', icon: 'ğŸ¯' },\n    { id: 'predict', label: 'ğŸ”® Forecasting', icon: 'ğŸ“‘', beta: true },\n    { id: 'correlation', label: 'ğŸ”— Correlation', icon: 'ğŸ“ˆ' }\n  ];\n\n  return (\n    <div className=\"ai-analytics-panel\">\n      <div className=\"analytics-header\">\n        <h2>ğŸ“Š AI Analytics Engine</h2>\n        <p className=\"analytics-subtitle\">Advanced data analysis and insights</p>\n      </div>\n\n      {/* Analysis Type Selection */}\n      <div className=\"analysis-type-selector\">\n        <label htmlFor=\"analysis-select\">Select Analysis Type:</label>\n        <div className=\"analysis-buttons\">\n          {analysisOptions.map(option => (\n            <button\n              key={option.id}\n              onClick={() => {\n                setAnalysisType(option.id);\n                setResults(null);\n                setError(null);\n              }}\n              className={`analysis-btn ${analysisType === option.id ? 'active' : ''}`}\n              title={option.label}\n            >\n              {option.icon} {option.label.split(' ')[0]}\n              {option.beta && <span className=\"beta-badge\">BETA</span>}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Data Input Section */}\n      <div className=\"data-input-section\">\n        <label htmlFor=\"data-input\">Enter Data (comma or newline separated numbers):</label>\n        <div className=\"input-wrapper\">\n          <textarea\n            id=\"data-input\"\n            value={dataInput}\n            onChange={handleDataInputChange}\n            placeholder=\"Example: 100, 102, 105, 103, 108...\\nOr paste from Excel/CSV\"\n            rows=\"5\"\n            className=\"data-textarea\"\n            spellCheck=\"false\"\n          />\n          <button\n            onClick={exampleData}\n            className=\"btn-example\"\n            title=\"Load sample data for current analysis type\"\n          >\n            ğŸ“‹ Load Example\n          </button>\n        </div>\n      </div>\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"error-box\" role=\"alert\">\n          âŒ {error}\n        </div>\n      )}\n\n      {/* Analyze Button */}\n      <button\n        onClick={analyzeData}\n        disabled={loading}\n        className=\"btn-analyze\"\n      >\n        {loading ? 'â³ Analyzing...' : 'â–¶ï¸ Run Analysis'}\n      </button>\n\n      {/* Results Section */}\n      {results && Object.keys(results).length > 0 && (\n        <div className=\"results-section\">\n          <h3>ğŸ“ˆ Analysis Results</h3>\n          <div className=\"results-grid\">\n            {Object.entries(results).map(([key, value]) => (\n              <div key={key} className=\"result-item\">\n                <span className=\"result-label\">{key}:</span>\n                <span className=\"result-value\">\n                  {typeof value === 'object' ? (\n                    JSON.stringify(value, null, 2)\n                  ) : typeof value === 'number' ? (\n                    value.toFixed(2)\n                  ) : (\n                    String(value)\n                  )}\n                </span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Empty State */}\n      {!loading && !results && !error && (\n        <div className=\"empty-results\">\n          ğŸ’¡ Enter data and click \"Run Analysis\" to get started\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default AIAnalyticsPanel;\n