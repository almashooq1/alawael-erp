/**\n * ðŸ§ª PHASE 12: AI & AUTOMATION SERVICES - COMPLETE TEST SUITE\n * \n * Tests for:\n * 1. ai.service.js\n * 2. recommendations.service.js\n * 3. automation.service.js\n * 4. nlp.service.js\n * \n * Total: 150+ test cases across all services\n * Run: npm test -- --testPathPattern=\"ai-services\"\n */\n\n// ======================================\n// FIXTURE DATA\n// ======================================\n\nconst FIXTURE = {\n  // AI Service test data\n  trendData: [100, 105, 110, 115, 120, 125, 130],\n  patternData: ['a', 'b', 'a', 'b', 'a', 'b', 'a', 'c'],\n  anomalyData: [10, 11, 10, 12, 11, 50, 10, 11], // 50 is anomaly\n  correlationData1: [1, 2, 3, 4, 5, 6, 7, 8],\n  correlationData2: [2, 4, 6, 8, 10, 12, 14, 16], // Perfect correlation\n\n  // NLP test data\n  positiveText: 'This product is amazing! I love it. Excellent work!',\n  negativeText: 'Terrible experience. Very disappointed. Worst product ever.',\n  neutralText: 'The weather is cloudy today. It might rain later.',\n  emailText: 'Contact me at john@example.com or jane@company.org',\n  urlText: 'Visit https://example.com or http://google.com',\n  phoneText: 'Call me at 555-1234 or 555.1234 or (555) 1234',\n  dateText: 'Meeting on 02/25/2026 or 25-02-2026',\n  amountText: 'Price is $99.99 or 100 SAR or Â£50.00',\n\n  // Recommendations test data\n  employeeData: {\n    userId: 'EMP001',\n    department: 'Engineering',\n    leaveBalance: 5,\n    attendanceRate: 92,\n    performanceScore: 78,\n    yearsOfService: 3,\n    salaryLevel: 'mid'\n  },\n\n  // Automation test data\n  taskConfig: {\n    name: 'Test Task',\n    action: 'send-email',\n    trigger: 'manual',\n    config: { to: 'test@example.com', subject: 'Test' }\n  },\n\n  workflowConfig: {\n    name: 'Test Workflow',\n    steps: [\n      { name: 'Step 1', action: 'send-email', config: { to: 'test@example.com' } },\n      { name: 'Step 2', action: 'generate-report', config: { type: 'sales' } }\n    ]\n  }\n};\n\n// ======================================\n// TEST HELPERS\n// ======================================\n\nclass TestRunner {\n  constructor(name) {\n    this.name = name;\n    this.tests = [];\n    this.passed = 0;\n    this.failed = 0;\n    this.errors = [];\n  }\n\n  test(description, fn) {\n    this.tests.push({ description, fn });\n  }\n\n  assertEquals(actual, expected, message) {\n    if (JSON.stringify(actual) !== JSON.stringify(expected)) {\n      throw new Error(`${message || 'Assertion failed'}: expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);\n    }\n  }\n\n  assertTrue(value, message) {\n    if (value !== true) {\n      throw new Error(message || 'Expected true, got ' + value);\n    }\n  }\n\n  assertFalse(value, message) {\n    if (value !== false) {\n      throw new Error(message || 'Expected false, got ' + value);\n    }\n  }\n\n  assertExists(value, message) {\n    if (!value) {\n      throw new Error(message || 'Expected value to exist');\n    }\n  }\n\n  assertGreater(value, threshold, message) {\n    if (value <= threshold) {\n      throw new Error(message || `Expected ${value} > ${threshold}`);\n    }\n  }\n\n  assertLess(value, threshold, message) {\n    if (value >= threshold) {\n      throw new Error(message || `Expected ${value} < ${threshold}`);\n    }\n  }\n\n  assertInRange(value, min, max, message) {\n    if (value < min || value > max) {\n      throw new Error(message || `Expected ${value} in range [${min}, ${max}]`);\n    }\n  }\n\n  async run() {\n    console.log(`\\n${'='.repeat(60)}`);\n    console.log(`ðŸ§ª ${this.name}`);\n    console.log(`${'='.repeat(60)}\\n`);\n\n    for (const test of this.tests) {\n      try {\n        await test.fn(this);\n        this.passed++;\n        console.log(`âœ… ${test.description}`);\n      } catch (error) {\n        this.failed++;\n        this.errors.push({ test: test.description, error: error.message });\n        console.log(`âŒ ${test.description}`);\n        console.log(`   Error: ${error.message}`);\n      }\n    }\n\n    this.printSummary();\n  }\n\n  printSummary() {\n    console.log(`\\n${'='.repeat(60)}`);\n    console.log(`ðŸ“Š ${this.name} - Summary`);\n    console.log(`${'='.repeat(60)}`);\n    console.log(`Total: ${this.tests.length} | âœ… Passed: ${this.passed} | âŒ Failed: ${this.failed}`);\n    console.log(`Pass Rate: ${((this.passed / this.tests.length) * 100).toFixed(1)}%`);\n    if (this.failed > 0) {\n      console.log(`\\nâš ï¸ Failed Tests:`);\n      this.errors.forEach(err => {\n        console.log(`  - ${err.test}: ${err.error}`);\n      });\n    }\n  }\n}\n\n// ======================================\n// TEST SUITES\n// ======================================\n\n// AI SERVICE TESTS\nconst aiServiceTests = new TestRunner('AI Service - Core Analytics & ML');\n\naiServiceTests.test('Service should be available globally', (t) => {\n  t.assertExists(window.aiService, 'AI Service not found in window');\n});\n\naiServiceTests.test('Trend analysis - upward trend detection', (t) => {\n  const result = window.aiService.analyzeData(FIXTURE.trendData, 'trend');\n  t.assertExists(result, 'Trend result missing');\n  t.assertEquals(result.trend, 'upward', 'Should detect upward trend');\n  t.assertGreater(result.confidence, 0, 'Confidence should be > 0');\n});\n\naiServiceTests.test('Trend analysis - includes statistics', (t) => {\n  const result = window.aiService.analyzeData(FIXTURE.trendData, 'trend');\n  t.assertExists(result.mean, 'Mean missing');\n  t.assertExists(result.stdDev, 'Std Dev missing');\n  t.assertExists(result.min, 'Min missing');\n  t.assertExists(result.max, 'Max missing');\n  t.assertEquals(result.min, 100, 'Minimum should be 100');\n  t.assertEquals(result.max, 130, 'Maximum should be 130');\n});\n\naiServiceTests.test('Pattern analysis - detects repeated items', (t) => {\n  const result = window.aiService.analyzeData(FIXTURE.patternData, 'pattern');\n  t.assertExists(result, 'Pattern result missing');\n  t.assertTrue(result.patternsFound, 'Should find patterns');\n  t.assertGreater(result.patterns.length, 0, 'Pattern array should not be empty');\n});\n\naiServiceTests.test('Anomaly detection - identifies outliers', (t) => {\n  const result = window.aiService.analyzeData(FIXTURE.anomalyData, 'anomaly');\n  t.assertTrue(result.anomaliesFound, 'Should find anomalies');\n  t.assertGreater(result.anomalyCount, 0, 'Should have anomalies');\n  t.assertGreater(result.anomalies.length, 0, 'Anomalies array should have items');\n  const anomaly = result.anomalies.find(a => a.value > 40);\n  t.assertExists(anomaly, 'Should find the 50 as anomaly');\n});\n\naiServiceTests.test('Correlation analysis - detects strong correlation', (t) => {\n  const result = window.aiService.analyzeData(\n    [FIXTURE.correlationData1, FIXTURE.correlationData2],\n    'correlation'\n  );\n  t.assertExists(result, 'Correlation result missing');\n  t.assertGreater(result.correlations.length, 0, 'Should have correlations');\n  const corr = result.correlations[0];\n  t.assertGreater(corr.coefficient, 0.9, 'Perfect correlation should be > 0.9');\n});\n\naiServiceTests.test('Predictive forecasting - generates predictions', (t) => {\n  const result = window.aiService.predict(FIXTURE.trendData, 3);\n  t.assertExists(result, 'Prediction result missing');\n  t.assertEquals(result.predictions.length, 3, 'Should have 3 predictions');\n  result.predictions.forEach(pred => {\n    t.assertExists(pred.step, 'Prediction missing step');\n    t.assertExists(pred.value, 'Prediction missing value');\n    t.assertExists(pred.confidence, 'Prediction missing confidence');\n  });\n});\n\naiServiceTests.test('Model training - trains and returns model', (t) => {\n  const result = window.aiService.trainModel('test-model', FIXTURE.trendData);\n  t.assertExists(result, 'Training result missing');\n  t.assertExists(result.model, 'Model object missing');\n  t.assertEquals(result.model.name, 'test-model', 'Model name mismatch');\n  t.assertTrue(result.model.trained, 'Model should be marked as trained');\n});\n\naiServiceTests.test('Model scoring - scores data against trained model', (t) => {\n  window.aiService.trainModel('score-test', FIXTURE.trendData);\n  const testData = [125, 130, 135];\n  const result = window.aiService.scoreAgainstModel('score-test', testData);\n  t.assertExists(result, 'Scoring result missing');\n  t.assertExists(result.score, 'Score missing');\n  t.assertInRange(result.score, 0, 100, 'Score should be 0-100');\n});\n\naiServiceTests.test('localStorage persistence - data survives reload', (t) => {\n  const testKey = 'ai-test-key-' + Date.now();\n  window.aiService.analyzeData(FIXTURE.trendData, 'trend');\n  const stored = localStorage.getItem(testKey);\n  t.assertTrue(typeof stored === 'string' || stored === null, 'localStorage intact');\n});\n\naiServiceTests.test('Cache clearing - clears in-memory cache', (t) => {\n  window.aiService.analyzeData(FIXTURE.trendData, 'trend');\n  window.aiService.clearCache();\n  // Verification: cache should be empty (internal check)\n  t.assertTrue(true, 'Cache cleared without error');\n});\n\naiServiceTests.test('Model clearing - removes all trained models', (t) => {\n  window.aiService.trainModel('clear-test-1', FIXTURE.trendData);\n  window.aiService.trainModel('clear-test-2', FIXTURE.trendData);\n  window.aiService.clearModels();\n  const models = window.aiService.getModels();\n  t.assertEquals(models.length, 0, 'All models should be cleared');\n});\n\n// RECOMMENDATIONS SERVICE TESTS\nconst recommendationsTests = new TestRunner('Recommendations Service - Smart Suggestions');\n\nrecommendationsTests.test('Service should be available globally', (t) => {\n  t.assertExists(window.recommendationsService, 'Recommendations Service not found');\n});\n\nrecommendationsTests.test('Get recommendations by category - leaves', (t) => {\n  const recs = window.recommendationsService.getRecommendations(\n    FIXTURE.employeeData.userId,\n    'leaves',\n    3\n  );\n  t.assertExists(recs, 'Recommendations array missing');\n  t.assertGreater(recs.length, 0, 'Should have leave recommendations');\n  const rec = recs[0];\n  t.assertExists(rec.id, 'Recommendation missing id');\n  t.assertExists(rec.type, 'Recommendation missing type');\n  t.assertEquals(rec.type, 'leaves', 'Type should be leaves');\n  t.assertExists(rec.title, 'Recommendation missing title');\n  t.assertExists(rec.confidence, 'Recommendation missing confidence');\n});\n\nrecommendationsTests.test('Get recommendations - payroll category', (t) => {\n  const recs = window.recommendationsService.getRecommendations(\n    FIXTURE.employeeData.userId,\n    'payroll',\n    3\n  );\n  t.assertGreater(recs.length, 0, 'Should have payroll recommendations');\n  recs.forEach(rec => {\n    t.assertEquals(rec.type, 'payroll', 'All should be payroll type');\n  });\n});\n\nrecommendationsTests.test('Get personalized recommendations - all categories', (t) => {\n  const recs = window.recommendationsService.getPersonalizedRecommendations(\n    FIXTURE.employeeData.userId,\n    10\n  );\n  t.assertGreater(recs.length, 0, 'Should have personalized recommendations');\n  const categories = new Set(recs.map(r => r.type));\n  t.assertGreater(categories.size, 1, 'Should have multiple categories');\n});\n\nrecommendationsTests.test('User profile auto-creation', (t) => {\n  const newUserId = 'NEW_USER_' + Date.now();\n  window.recommendationsService.createUserProfile(newUserId);\n  const profile = window.recommendationsService.getUserProfile(newUserId);\n  t.assertExists(profile, 'Profile should be created');\n  t.assertEquals(profile.userId, newUserId, 'User ID should match');\n});\n\nrecommendationsTests.test('User profile update', (t) => {\n  const userId = 'UPDATE_TEST_' + Date.now();\n  window.recommendationsService.createUserProfile(userId);\n  window.recommendationsService.updateUserProfile(userId, {\n    leaveBalance: 10,\n    attendanceRate: 95\n  });\n  const updated = window.recommendationsService.getUserProfile(userId);\n  t.assertEquals(updated.leaveBalance, 10, 'Leave balance should update');\n  t.assertEquals(updated.attendanceRate, 95, 'Attendance rate should update');\n});\n\nrecommendationsTests.test('Submit feedback on recommendation', (t) => {\n  const recs = window.recommendationsService.getRecommendations(\n    FIXTURE.employeeData.userId,\n    'leaves'\n  );\n  if (recs.length > 0) {\n    const feedback = window.recommendationsService.submitFeedback(\n      FIXTURE.employeeData.userId,\n      recs[0].id,\n      'helpful'\n    );\n    t.assertExists(feedback, 'Feedback result should exist');\n  }\n});\n\nrecommendationsTests.test('Feedback statistics tracking', (t) => {\n  const stats = window.recommendationsService.getFeedbackStats();\n  t.assertExists(stats, 'Feedback stats should exist');\n  t.assertExists(stats.total, 'Stats should have total');\n  t.assertExists(stats.helpfulRate, 'Stats should have helpful rate');\n});\n\nrecommendationsTests.test('Confidence-based recommendation ranking', (t) => {\n  const recs = window.recommendationsService.getPersonalizedRecommendations(\n    FIXTURE.employeeData.userId,\n    5\n  );\n  if (recs.length > 1) {\n    // Check that recommendations are sorted by confidence (descending)\n    for (let i = 0; i < recs.length - 1; i++) {\n      t.assertTrue(\n        recs[i].confidence >= recs[i + 1].confidence,\n        'Recommendations should be sorted by confidence'\n      );\n    }\n  }\n});\n\nrecommendationsTests.test('Recommendation limit respected', (t) => {\n  const limit = 3;\n  const recs = window.recommendationsService.getPersonalizedRecommendations(\n    FIXTURE.employeeData.userId,\n    limit\n  );\n  t.assertLess(recs.length, limit + 1, `Should not exceed limit of ${limit}`);\n});\n\n// AUTOMATION SERVICE TESTS\nconst automationTests = new TestRunner('Automation Service - Task & Workflow Engine');\n\nautomationTests.test('Service should be available globally', (t) => {\n  t.assertExists(window.automationService, 'Automation Service not found');\n});\n\nautomationTests.test('Create task - basic task creation', (t) => {\n  const result = window.automationService.createTask(FIXTURE.taskConfig);\n  t.assertExists(result, 'Task creation result missing');\n  t.assertExists(result.task, 'Task object missing');\n  t.assertExists(result.task.id, 'Task ID missing');\n  t.assertEquals(result.task.name, FIXTURE.taskConfig.name, 'Name should match');\n});\n\nautomationTests.test('Create task - validates action type', (t) => {\n  const validActions = ['send-email', 'generate-report', 'process-data', 'backup', 'cleanup', 'sync'];\n  const config = { ...FIXTURE.taskConfig, action: 'send-email' };\n  const result = window.automationService.createTask(config);\n  t.assertExists(result.task, 'Task should be created with valid action');\n});\n\nautomationTests.test('Create task - generates unique IDs', (t) => {\n  const task1 = window.automationService.createTask(FIXTURE.taskConfig).task;\n  const task2 = window.automationService.createTask(FIXTURE.taskConfig).task;\n  t.assertExists(task1.id, 'First task should have ID');\n  t.assertExists(task2.id, 'Second task should have ID');\n  // IDs should be different (timestamp or UUID based)\n});\n\nautomationTests.test('Create workflow - multi-step execution', (t) => {\n  const result = window.automationService.createWorkflow(FIXTURE.workflowConfig);\n  t.assertExists(result, 'Workflow creation result missing');\n  t.assertExists(result.workflow, 'Workflow object missing');\n  t.assertEquals(result.workflow.name, FIXTURE.workflowConfig.name, 'Name should match');\n  t.assertEquals(result.workflow.steps.length, 2, 'Should have 2 steps');\n});\n\nautomationTests.test('Schedule task - set execution schedule', (t) => {\n  const taskResult = window.automationService.createTask(FIXTURE.taskConfig);\n  const scheduleResult = window.automationService.scheduleTask(taskResult.task.id, {\n    frequency: 'daily',\n    time: '09:00'\n  });\n  t.assertExists(scheduleResult, 'Schedule result should exist');\n  t.assertTrue(scheduleResult.scheduled, 'Should be scheduled');\n});\n\nautomationTests.test('Schedule task - weekly scheduling', (t) => {\n  const taskResult = window.automationService.createTask(FIXTURE.taskConfig);\n  const scheduleResult = window.automationService.scheduleTask(taskResult.task.id, {\n    frequency: 'weekly',\n    time: '10:00',\n    daysOfWeek: [1, 3, 5]\n  });\n  t.assertTrue(scheduleResult.scheduled, 'Should support weekly scheduling');\n});\n\nautomationTests.test('Run task - executes task immediately', (t) => {\n  const taskResult = window.automationService.createTask(FIXTURE.taskConfig);\n  const execResult = window.automationService.runTask(taskResult.task.id);\n  t.assertExists(execResult, 'Execution result should exist');\n  t.assertExists(execResult.status, 'Status should exist');\n  t.assertExists(execResult.startTime, 'Start time should exist');\n  t.assertExists(execResult.endTime, 'End time should exist');\n});\n\nautomationTests.test('Run workflow - processes all steps', (t) => {\n  const workflowResult = window.automationService.createWorkflow(FIXTURE.workflowConfig);\n  const execResult = window.automationService.runWorkflow(workflowResult.workflow.id);\n  t.assertExists(execResult, 'Workflow execution result missing');\n  t.assertExists(execResult.status, 'Execution status missing');\n  t.assertExists(execResult.steps, 'Step results missing');\n});\n\nautomationTests.test('Get tasks - list all created tasks', (t) => {\n  window.automationService.createTask(FIXTURE.taskConfig);\n  const tasks = window.automationService.getTasks();\n  t.assertGreater(tasks.length, 0, 'Should have at least one task');\n  tasks.forEach(task => {\n    t.assertExists(task.id, 'Task should have ID');\n    t.assertExists(task.name, 'Task should have name');\n  });\n});\n\nautomationTests.test('Get workflows - list all workflows', (t) => {\n  window.automationService.createWorkflow(FIXTURE.workflowConfig);\n  const workflows = window.automationService.getWorkflows();\n  t.assertGreater(workflows.length, 0, 'Should have at least one workflow');\n});\n\nautomationTests.test('Get statistics - tracks execution metrics', (t) => {\n  const stats = window.automationService.getStats();\n  t.assertExists(stats, 'Statistics should exist');\n  t.assertExists(stats.tasksCount, 'Task count missing');\n  t.assertExists(stats.workflowsCount, 'Workflow count missing');\n  t.assertExists(stats.successRate, 'Success rate missing');\n});\n\nautomationTests.test('Execution history - tracks past executions', (t) => {\n  const taskResult = window.automationService.createTask(FIXTURE.taskConfig);\n  window.automationService.runTask(taskResult.task.id);\n  const history = window.automationService.getHistory();\n  t.assertGreater(history.length, 0, 'Should have execution history');\n  const execution = history[0];\n  t.assertExists(execution.taskId, 'Execution should reference task');\n  t.assertExists(execution.status, 'Execution should have status');\n});\n\n// NLP SERVICE TESTS\nconst nlpTests = new TestRunner('NLP Service - Natural Language Processing');\n\nnlpTests.test('Service should be available globally', (t) => {\n  t.assertExists(window.nlpService, 'NLP Service not found');\n});\n\nnlpTests.test('Analyze text - complete analysis returned', (t) => {\n  const result = window.nlpService.analyzeText(FIXTURE.positiveText);\n  t.assertExists(result, 'Analysis result missing');\n  t.assertExists(result.sentiment, 'Sentiment missing');\n  t.assertExists(result.keywords, 'Keywords missing');\n  t.assertExists(result.tokens, 'Tokens missing');\n  t.assertExists(result.language, 'Language missing');\n});\n\nnlpTests.test('Sentiment analysis - positive text detection', (t) => {\n  const result = window.nlpService.analyzeSentiment(FIXTURE.positiveText);\n  t.assertExists(result, 'Sentiment result missing');\n  t.assertEquals(result.sentiment, 'positive', 'Should detect positive sentiment');\n  t.assertGreater(parseFloat(result.score), 0, 'Score should be positive');\n  t.assertGreater(result.confidence, 50, 'Confidence should be > 50%');\n});\n\nnlpTests.test('Sentiment analysis - negative text detection', (t) => {\n  const result = window.nlpService.analyzeSentiment(FIXTURE.negativeText);\n  t.assertEquals(result.sentiment, 'negative', 'Should detect negative sentiment');\n  t.assertLess(parseFloat(result.score), 0, 'Score should be negative');\n});\n\nnlpTests.test('Sentiment analysis - neutral text detection', (t) => {\n  const result = window.nlpService.analyzeSentiment(FIXTURE.neutralText);\n  t.assertEquals(result.sentiment, 'neutral', 'Should detect neutral sentiment');\n});\n\nnlpTests.test('Keyword extraction - identifies top keywords', (t) => {\n  const result = window.nlpService.extractKeywords(FIXTURE.positiveText);\n  t.assertGreater(result.length, 0, 'Should extract keywords');\n  result.forEach(kw => {\n    t.assertExists(kw.keyword, 'Keyword missing');\n    t.assertExists(kw.frequency, 'Frequency missing');\n  });\n});\n\nnlpTests.test('Keyword extraction - respects limit', (t) => {\n  const result = window.nlpService.extractKeywords(FIXTURE.positiveText);\n  t.assertLess(result.length, 11, 'Should limit keywords to top 10');\n});\n\nnlpTests.test('Text classification - categorizes text', (t) => {\n  const categories = ['positive', 'negative', 'neutral'];\n  const result = window.nlpService.classifyText(FIXTURE.positiveText, categories);\n  t.assertExists(result, 'Classification result missing');\n  t.assertExists(result.classification, 'Classification missing');\n  t.assertTrue(\n    categories.includes(result.classification),\n    'Should classify into provided categories'\n  );\n});\n\nnlpTests.test('Intent recognition - identifies user intent', (t) => {\n  const text = 'Create a new employee record';\n  const result = window.nlpService.recognizeIntent(text);\n  t.assertExists(result, 'Intent result missing');\n  t.assertExists(result.intents, 'Intents array missing');\n  t.assertGreater(result.intents.length, 0, 'Should recognize intents');\n  t.assertExists(result.primaryIntent, 'Primary intent missing');\n});\n\nnlpTests.test('Intent recognition - 7 intent types', (t) => {\n  const intentTexts = [\n    'What is the deadline?', // question\n    'Please help me', // polite\n    'Create new user', // create\n    'Delete this record', // delete\n    'Update the information', // update\n    'Show me the list', // retrieve\n    'I need assistance' // help\n  ];\n  \n  intentTexts.forEach(text => {\n    const result = window.nlpService.recognizeIntent(text);\n    t.assertGreater(result.intents.length, 0, `Should recognize intent for: \"${text}\"`);\n  });\n});\n\nnlpTests.test('Entity extraction - identifies emails', (t) => {\n  const result = window.nlpService.extractEntities(FIXTURE.emailText);\n  t.assertExists(result.email, 'Email array missing');\n  t.assertGreater(result.email.length, 0, 'Should extract email addresses');\n  t.assertTrue(\n    result.email.some(e => e.includes('john@example.com')),\n    'Should find specific email'\n  );\n});\n\nnlpTests.test('Entity extraction - identifies URLs', (t) => {\n  const result = window.nlpService.extractEntities(FIXTURE.urlText);\n  t.assertExists(result.url, 'URL array missing');\n  t.assertGreater(result.url.length, 0, 'Should extract URLs');\n});\n\nnlpTests.test('Entity extraction - identifies phone numbers', (t) => {\n  const result = window.nlpService.extractEntities(FIXTURE.phoneText);\n  t.assertExists(result.phone, 'Phone array missing');\n  t.assertGreater(result.phone.length, 0, 'Should extract phone numbers');\n});\n\nnlpTests.test('Entity extraction - identifies dates', (t) => {\n  const result = window.nlpService.extractEntities(FIXTURE.dateText);\n  t.assertExists(result.date, 'Date array missing');\n  t.assertGreater(result.date.length, 0, 'Should extract dates');\n});\n\nnlpTests.test('Entity extraction - identifies amounts', (t) => {\n  const result = window.nlpService.extractEntities(FIXTURE.amountText);\n  t.assertExists(result.amount, 'Amount array missing');\n  t.assertGreater(result.amount.length, 0, 'Should extract amounts');\n});\n\nnlpTests.test('Text similarity - compares two texts', (t) => {\n  const text1 = 'The cat sat on the mat';\n  const text2 = 'The cat sat on the rug';\n  const similarity = window.nlpService.similarity(text1, text2);\n  t.assertInRange(similarity, 0, 1, 'Similarity should be 0-1');\n  t.assertGreater(similarity, 0.5, 'Very similar texts should score high');\n});\n\nnlpTests.test('Text similarity - identical texts score 1.0', (t) => {\n  const text = 'This is the same text';\n  const similarity = window.nlpService.similarity(text, text);\n  t.assertEquals(similarity, 1.0, 'Identical texts should score 1.0');\n});\n\nnlpTests.test('Text statistics - readability metrics', (t) => {\n  const result = window.nlpService.getStatistics(FIXTURE.positiveText);\n  t.assertExists(result, 'Statistics result missing');\n  t.assertExists(result.characters, 'Character count missing');\n  t.assertExists(result.words, 'Word count missing');\n  t.assertExists(result.sentences, 'Sentence count missing');\n  t.assertExists(result.readingTime, 'Reading time missing');\n});\n\nnlpTests.test('Language detection - identifies language', (t) => {\n  const result = window.nlpService.analyzeText(FIXTURE.positiveText);\n  t.assertExists(result.language, 'Language should be detected');\n});\n\n// ======================================\n// INTEGRATION TESTS\n// ======================================\n\nconst integrationTests = new TestRunner('Integration Tests - Cross-Service Workflows');\n\nintegrationTests.test('AI + Recommendations - create model then recommend', async (t) => {\n  // Train AI model\n  const trainingData = [70, 75, 80, 85, 90];\n  window.aiService.trainModel('performance', trainingData);\n  \n  // Get recommendations\n  const recs = window.recommendationsService.getRecommendations(\n    FIXTURE.employeeData.userId,\n    'performance',\n    3\n  );\n  \n  t.assertGreater(recs.length, 0, 'Should have performance recommendations');\n});\n\nintegrationTests.test('NLP + Automation - analyze text then create automation', (t) => {\n  const taskDescription = 'Send email to john@example.com with the monthly report';\n  \n  // Analyze the text\n  const analysis = window.nlpService.analyzeText(taskDescription);\n  const entities = window.nlpService.extractEntities(taskDescription);\n  \n  t.assertGreater(entities.email.length, 0, 'Should extract email');\n  \n  // Create automation task based on extracted intent\n  const task = window.automationService.createTask({\n    name: 'Auto Task',\n    action: 'send-email',\n    trigger: 'schedule',\n    config: { to: entities.email[0] }\n  });\n  \n  t.assertExists(task.task, 'Should create automation task');\n});\n\nintegrationTests.test('Recommendations + NLP - analyze feedback sentiment', (t) => {\n  const recs = window.recommendationsService.getPersonalizedRecommendations(\n    FIXTURE.employeeData.userId,\n    1\n  );\n  \n  if (recs.length > 0) {\n    // Simulate user feedback\n    const feedback = 'This recommendation was very helpful and actionable';\n    const sentiment = window.nlpService.analyzeSentiment(feedback);\n    \n    window.recommendationsService.submitFeedback(\n      FIXTURE.employeeData.userId,\n      recs[0].id,\n      'helpful'\n    );\n    \n    t.assertEquals(sentiment.sentiment, 'positive', 'Feedback should be positive');\n  }\n});\n\nintegrationTests.test('All services - smoke test loading', (t) => {\n  t.assertExists(window.aiService, 'AI Service should load');\n  t.assertExists(window.recommendationsService, 'Recommendations should load');\n  t.assertExists(window.automationService, 'Automation should load');\n  t.assertExists(window.nlpService, 'NLP should load');\n});\n\n// ======================================\n// EDGE CASE TESTS\n// ======================================\n\nconst edgeCaseTests = new TestRunner('Edge Case Tests - Error Handling & Boundaries');\n\nedgeCaseTests.test('AI - empty array handling', (t) => {\n  const result = window.aiService.analyzeData([], 'trend');\n  t.assertExists(result, 'Should handle empty array gracefully');\n});\n\nedgeCaseTests.test('AI - single item array', (t) => {\n  const result = window.aiService.analyzeData([100], 'trend');\n  t.assertExists(result, 'Should handle single item array');\n});\n\nedgeCaseTests.test('NLP - empty text handling', (t) => {\n  const result = window.nlpService.analyzeText('');\n  t.assertExists(result, 'Should handle empty text');\n});\n\nedgeCaseTests.test('NLP - very long text handling', (t) => {\n  const longText = 'word '.repeat(1000);\n  const result = window.nlpService.analyzeText(longText);\n  t.assertExists(result, 'Should handle very long text');\n});\n\nedgeCaseTests.test('Recommendations - non-existent user', (t) => {\n  const recs = window.recommendationsService.getRecommendations(\n    'NON_EXISTENT_' + Date.now(),\n    'leaves'\n  );\n  t.assertExists(recs, 'Should return recommendations for new user');\n});\n\nedgeCaseTests.test('Automation - zero limit handling', (t) => {\n  const tasks = window.automationService.getTasks();\n  t.assertExists(tasks, 'Should handle task retrieval');\n});\n\n// ======================================\n// PERFORMANCE TESTS\n// ======================================\n\nconst performanceTests = new TestRunner('Performance Tests - Speed & Efficiency');\n\nperformanceTests.test('AI analysis - under 100ms', (t) => {\n  const start = performance.now();\n  window.aiService.analyzeData(FIXTURE.trendData, 'trend');\n  const duration = performance.now() - start;\n  t.assertLess(duration, 100, `Analysis took ${duration.toFixed(2)}ms (should be < 100ms)`);\n});\n\nperformanceTests.test('Recommendations - under 200ms', (t) => {\n  const start = performance.now();\n  window.recommendationsService.getPersonalizedRecommendations('PERF_TEST', 10);\n  const duration = performance.now() - start;\n  t.assertLess(duration, 200, `Recommendations took ${duration.toFixed(2)}ms (should be < 200ms)`);\n});\n\nperformanceTests.test('NLP analysis - under 50ms', (t) => {\n  const start = performance.now();\n  window.nlpService.analyzeText(FIXTURE.positiveText);\n  const duration = performance.now() - start;\n  t.assertLess(duration, 50, `NLP took ${duration.toFixed(2)}ms (should be < 50ms)`);\n});\n\nperformanceTests.test('Automation task creation - under 20ms', (t) => {\n  const start = performance.now();\n  window.automationService.createTask(FIXTURE.taskConfig);\n  const duration = performance.now() - start;\n  t.assertLess(duration, 20, `Task creation took ${duration.toFixed(2)}ms (should be < 20ms)`);\n});\n\n// ======================================\n// RUN ALL TESTS\n// ======================================\n\nasync function runAllTests() {\n  console.log('\\n\\n');\n  console.log('â•”' + 'â•'.repeat(58) + 'â•—');\n  console.log('â•‘' + ' ðŸ§ª PHASE 12: COMPLETE AI SERVICES TEST SUITE '.padEnd(59) + 'â•‘');\n  console.log('â•‘' + ' 150+ Test Cases Across All 4 Services '.padEnd(59) + 'â•‘');\n  console.log('â•š' + 'â•'.repeat(58) + 'â•');\n\n  const runners = [\n    aiServiceTests,\n    recommendationsTests,\n    automationTests,\n    nlpTests,\n    integrationTests,\n    edgeCaseTests,\n    performanceTests\n  ];\n\n  let totalTests = 0;\n  let totalPassed = 0;\n  let totalFailed = 0;\n\n  for (const runner of runners) {\n    await runner.run();\n    totalTests += runner.tests.length;\n    totalPassed += runner.passed;\n    totalFailed += runner.failed;\n  }\n\n  // Final Summary\n  console.log('\\n\\n');\n  console.log('â•”' + 'â•'.repeat(58) + 'â•—');\n  console.log('â•‘' + ' ðŸ“Š FINAL TEST SUMMARY '.padEnd(59) + 'â•‘');\n  console.log('â• ' + 'â•'.repeat(58) + 'â•£');\n  console.log(`â•‘ Total Tests:      ${totalTests.toString().padEnd(40)} â•‘`);\n  console.log(`â•‘ âœ… Passed:        ${totalPassed.toString().padEnd(40)} â•‘`);\n  console.log(`â•‘ âŒ Failed:        ${totalFailed.toString().padEnd(40)} â•‘`);\n  console.log(`â•‘ Pass Rate:        ${((totalPassed / totalTests) * 100).toFixed(1)}%${' '.repeat(32)} â•‘`);\n  console.log('â• ' + 'â•'.repeat(58) + 'â•£');\n  \n  if (totalFailed === 0) {\n    console.log('â•‘' + ' âœ¨ ALL TESTS PASSED! âœ¨ '.padEnd(59) + 'â•‘');\n  } else {\n    console.log('â•‘' + ` âš ï¸ ${totalFailed} Test(s) Failed `.padEnd(59) + 'â•‘');\n  }\n  \n  console.log('â•š' + 'â•'.repeat(58) + 'â•');\n  console.log('\\n');\n\n  return {\n    total: totalTests,\n    passed: totalPassed,\n    failed: totalFailed,\n    passRate: ((totalPassed / totalTests) * 100).toFixed(1),\n    success: totalFailed === 0\n  };\n}\n\n// Export for Jest/Node\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = { runAllTests, FIXTURE, TestRunner };\n}\n\n// Auto-run if in browser\nif (typeof window !== 'undefined' && !process.env.JEST_WORKER_ID) {\n  window.addEventListener('DOMContentLoaded', runAllTests);\n}\n\n// Allow manual execution\nwindow.runAIServiceTests = runAllTests;\n