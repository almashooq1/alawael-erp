import React, { createContext, useContext, useState } from 'react';

type TranslationKeys = {
  [key: string]: string;
};
const translations: {
  ar: TranslationKeys;
  en: TranslationKeys;
  fr: TranslationKeys;
} = {
  ar: {
    compliancePolicies: 'سياسات الامتثال',
    riskScore: 'درجة المخاطرة',
    violations: 'عدد الانتهاكات',
    unresolved: 'غير محلولة',
    lastViolation: 'آخر انتهاك',
    details: 'تفاصيل',
    export: 'تصدير',
    print: 'طباعة',
    add: 'إضافة',
    edit: 'تعديل',
    delete: 'حذف',
    enabled: 'مفعلة',
    disabled: 'معطلة',
    riskTrends: 'اتجاهات المخاطر',
    date: 'التاريخ',
    loading: 'جاري التحميل...',
    noData: 'لا توجد بيانات',
    noPolicies: 'لا توجد سياسات',
    noViolations: 'لا توجد خروقات مسجلة.',
    smartSuggestion: 'اقتراح ذكي:',
    repeatedViolationsDetectedForPolicy: 'تم رصد خروقات متكررة لسياسة',
    recommendUpdateOrAddPolicy: 'يوصى بتحديث السياسة أو إضافة سياسة جديدة بناءً على التحليل الذكي.',
    recommendationAdoptedSuccessfully: 'تم اعتماد التوصية كسياسة بنجاح',
    adoptAsPolicy: 'اعتماد التوصية كسياسة',
    smartRecommendation: 'توصية ذكية:',
    adoptRecommendation: 'اعتماد التوصية كسياسة جديدة',
    mostViolatedPolicies: 'السياسات الأكثر تعرضًا للخرق:',
    notEnoughData: 'لا توجد بيانات كافية للعرض.',
    errorFetching: 'خطأ في جلب البيانات',
    loadingShort: 'تحميل...',
    advancedAnalyticsPanel: 'لوحة التحليل المتقدم للامتثال',
    aiComplianceAnalysis: 'تحليل ذكي للامتثال (AI)',
    eventsCount: 'عدد الأحداث',
    escalationRisk: 'مخاطر التصعيد',
    advancedAISummary: 'تحليل AI متقدم',
    statusDistribution: 'توزيع الحالات',
    timelineDistribution: 'توزيع زمني (30 يوم)',
    violationsPerPolicy: 'خروقات لكل سياسة',
    violationsPerResource: 'خروقات لكل مورد',
    mostViolatedResources: 'أكثر الموارد تعرضًا للخرق',
    undefined: 'غير محدد',
    smartSourcesManagement: 'إدارة مصادر البيانات الذكية',
    type: 'النوع',
    name: 'الاسم',
    cronSchedule: 'جدولة كرون',
    configJSON: 'إعدادات (JSON)',
    addSource: 'إضافة مصدر',
    status: 'الحالة',
    schedule: 'الجدولة',
    lastImport: 'آخر استيراد',
    failedToLoadArticles: 'فشل تحميل المقالات',
    confirmDelete: 'تأكيد الحذف',
    areYouSureDelete: 'هل أنت متأكد من حذف هذه المقالة؟',
    deleted: 'تم الحذف',
    updated: 'تم التحديث',
    added: 'تمت الإضافة',
    question: 'السؤال',
    repeated: 'تكرر',
    times: 'مرة',
    notDocumentedAsArticle: 'ولم يتم توثيقه كمقالة معرفة.',
    recommendCreateArticle: 'يوصى بإنشاء مقالة معرفة للإجابة عليه.',
    createArticleForQuestion: 'إنشاء مقالة لهذا السؤال',
    searchArticles: 'بحث في المقالات...',
    search: 'بحث',
    newArticle: 'مقالة جديدة',
    title: 'العنوان',
    tags: 'الوسوم',
    aiSummary: 'الملخص الذكي',
    createdAt: 'تاريخ الإنشاء',
    updatedAt: 'آخر تحديث',
    actions: 'إجراءات',
    editArticle: 'تعديل مقالة',
    addArticle: 'إضافة مقالة',
    update: 'تحديث',
    cancel: 'إلغاء',
    titleRequired: 'العنوان مطلوب',
    content: 'المحتوى',
    contentRequired: 'المحتوى مطلوب',
    tagsRequired: 'أدخل وسوماً (مفصولة بفاصلة)',
    tagsPlaceholder: 'مثال: إدارة, تقنية, ذكاء اصطناعي',
    rolesManagement: 'إدارة الأدوار والصلاحيات',
    roleName: 'اسم الدور',
    permissionsComma: 'الصلاحيات (مفصولة بفاصلة)',
    addRole: 'إضافة دور',
    role: 'الدور',
    permissions: 'الصلاحيات',
    meetingsManagement: 'إدارة الاجتماعات',
    confirmDeleteMeeting: 'تأكيد حذف الاجتماع؟',
    meetingTitle: 'عنوان الاجتماع',
    location: 'المكان',
    participantsComma: 'المشاركون (مفصولة بفاصلة)',
    agenda: 'جدول الأعمال',
    notes: 'ملاحظات',
    createdBy: 'أنشئ بواسطة',
    addMeeting: 'إضافة اجتماع',
    participants: 'المشاركون',
    contractsDashboardCharts: 'لوحة تحكم العقود - رسوم بيانية',
    contractsByStatus: 'توزيع العقود حسب الحالة',
    contractsByParty: 'توزيع العقود حسب الطرف (أكثر 6)',
    contractsTotals: 'إجمالي العقود والقيمة',
    totalContracts: 'إجمالي العقود',
    totalValue: 'إجمالي القيمة',
    avgValue: 'متوسط القيمة',
    soonToExpire: 'ستنتهي خلال 30 يوم',
    active: 'نشط',
    expired: 'منتهي',
    terminated: 'منتهي مبكراً',
    pending: 'معلق',
    processDashboard: 'لوحة العمليات',
    hiringProcess: 'عملية توظيف',
    onboardingProcess: 'إعداد موظف جديد',
    smartDashboard: 'لوحة التحكم الذكية',
    notificationChannels: 'قنوات التنبيهات',
    riskDashboard: 'لوحة المخاطر',
    saveAndSyncBPMN: 'حفظ ومزامنة BPMN',
    processEditor: 'محرر سير العمل',
    processName: 'اسم العملية',
    addProcess: 'إضافة عملية جديدة',
    noProcesses: 'لا توجد عمليات',
    view: 'عرض',
    saveProcess: 'حفظ العملية',
    addStep: 'إضافة خطوة',
    stepName: 'اسم الخطوة',
    manual: 'يدوي',
    automated: 'مؤتمت',
    approval: 'موافقة',
    switchToDark: 'وضع ليلي',
    switchToLight: 'وضع فاتح',
    months: 'أشهر',
    january: 'يناير',
    february: 'فبراير',
    march: 'مارس',
    april: 'أبريل',
    may: 'مايو',
    june: 'يونيو',
    july: 'يوليو',
    august: 'أغسطس',
    september: 'سبتمبر',
    october: 'أكتوبر',
    november: 'نوفمبر',
    december: 'ديسمبر',
    arabic: 'العربية',
    english: 'الإنجليزية',
    french: 'الفرنسية',
    languageSelector: 'اختيار اللغة',
    dashboardTitle: 'لوحة تحكم الذكاء الذاتي',
    totalInteractions: 'إجمالي التفاعلات',
    weeklyInteractions: 'تفاعلات هذا الأسبوع',
    weeklyErrors: 'عدد الأخطاء هذا الأسبوع',
    topQuestions: 'أكثر الأسئلة تكراراً',
    maxRating: 'أعلى تقييم',
    minRating: 'أقل تقييم',
    allRatings: 'كل التقييمات',
    loadingCompliancePanel: 'تحميل لوحة الامتثال...',
    loadingRiskAnalysis: 'تحميل تحليل المخاطر الذكي...',
    loadingRiskTrends: 'تحميل اتجاهات المخاطر...',
    loadingKnowledgeArticles: 'تحميل مقالات المعرفة...'
  },
  en: {
    compliancePolicies: 'Compliance Policies',
    riskScore: 'Risk Score',
    violations: 'Violations',
    unresolved: 'Unresolved',
    lastViolation: 'Last Violation',
    details: 'Details',
    export: 'Export',
    print: 'Print',
    add: 'Add',
    edit: 'Edit',
    delete: 'Delete',
    enabled: 'Enabled',
    disabled: 'Disabled',
    riskTrends: 'Risk Trends',
    date: 'Date',
    loading: 'Loading...',
    noData: 'No data available',
    noPolicies: 'No policies found',
    noViolations: 'No violations recorded.',
    smartSuggestion: 'Smart Suggestion:',
    repeatedViolationsDetectedForPolicy: 'Repeated violations detected for policy',
    recommendUpdateOrAddPolicy: 'It is recommended to update the policy or add a new one based on smart analysis.',
    recommendationAdoptedSuccessfully: 'Recommendation adopted as policy successfully',
    adoptAsPolicy: 'Adopt as Policy',
    smartRecommendation: 'Smart Recommendation:',
    adoptRecommendation: 'Adopt recommendation as new policy',
    mostViolatedPolicies: 'Most Violated Policies:',
    notEnoughData: 'Not enough data to display.',
    errorFetching: 'Error fetching data',
    loadingShort: 'Loading...',
    advancedAnalyticsPanel: 'Advanced Compliance Analytics Panel',
    aiComplianceAnalysis: 'AI Compliance Analysis',
    eventsCount: 'Events Count',
    escalationRisk: 'Escalation Risk',
    advancedAISummary: 'Advanced AI Summary',
    statusDistribution: 'Status Distribution',
    timelineDistribution: 'Timeline Distribution (30 days)',
    violationsPerPolicy: 'Violations per Policy',
    violationsPerResource: 'Violations per Resource',
    mostViolatedResources: 'Most Violated Resources',
    undefined: 'Undefined',
    smartSourcesManagement: 'Smart Data Sources Management',
    type: 'Type',
    name: 'Name',
    cronSchedule: 'Cron Schedule',
    configJSON: 'Config (JSON)',
    addSource: 'Add Source',
    status: 'Status',
    schedule: 'Schedule',
    lastImport: 'Last Import',
    failedToLoadArticles: 'Failed to load articles',
    confirmDelete: 'Confirm Delete',
    areYouSureDelete: 'Are you sure you want to delete this article?',
    deleted: 'Deleted',
    updated: 'Updated',
    added: 'Added',
    question: 'Question',
    repeated: 'Repeated',
    times: 'times',
    notDocumentedAsArticle: 'and it is not documented as a knowledge article.',
    recommendCreateArticle: 'It is recommended to create a knowledge article to answer it.',
    createArticleForQuestion: 'Create article for this question',
    searchArticles: 'Search articles...',
    search: 'Search',
    newArticle: 'New Article',
    title: 'Title',
    tags: 'Tags',
    aiSummary: 'AI Summary',
    createdAt: 'Created At',
    updatedAt: 'Updated At',
    actions: 'Actions',
    editArticle: 'Edit Article',
    addArticle: 'Add Article',
    update: 'Update',
    cancel: 'Cancel',
    titleRequired: 'Title is required',
    content: 'Content',
    contentRequired: 'Content is required',
    tagsRequired: 'Enter tags (comma separated)',
    tagsPlaceholder: 'e.g. management, technology, AI',
    rolesManagement: 'Roles & Permissions Management',
    roleName: 'Role Name',
    permissionsComma: 'Permissions (comma separated)',
    addRole: 'Add Role',
    role: 'Role',
    permissions: 'Permissions',
    meetingsManagement: 'Meetings Management',
    confirmDeleteMeeting: 'Confirm meeting deletion?',
    meetingTitle: 'Meeting Title',
    location: 'Location',
    participantsComma: 'Participants (comma separated)',
    agenda: 'Agenda',
    notes: 'Notes',
    createdBy: 'Created By',
    addMeeting: 'Add Meeting',
    participants: 'Participants',
    contractsDashboardCharts: 'Contracts Dashboard - Charts',
    contractsByStatus: 'Contracts by Status',
    contractsByParty: 'Contracts by Party (Top 6)',
    contractsTotals: 'Contracts & Value Totals',
    totalContracts: 'Total Contracts',
    totalValue: 'Total Value',
    avgValue: 'Average Value',
    soonToExpire: 'Expiring in 30 days',
    active: 'Active',
    expired: 'Expired',
    terminated: 'Terminated Early',
    pending: 'Pending',
    processDashboard: 'Process Dashboard',
    hiringProcess: 'Hiring Process',
    onboardingProcess: 'Onboarding Process',
    smartDashboard: 'Smart Dashboard',
    notificationChannels: 'Notification Channels',
    riskDashboard: 'Risk Dashboard',
    saveAndSyncBPMN: 'Save & Sync BPMN',
    processEditor: 'Process Editor',
    processName: 'Process Name',
    addProcess: 'Add New Process',
    noProcesses: 'No processes found',
    view: 'View',
    saveProcess: 'Save Process',
    addStep: 'Add Step',
    stepName: 'Step Name',
    manual: 'Manual',
    automated: 'Automated',
    approval: 'Approval',
    switchToDark: 'Dark mode',
    switchToLight: 'Light mode',
    months: 'months',
    january: 'January',
    february: 'February',
    march: 'March',
    april: 'April',
    may: 'May',
    june: 'June',
    july: 'July',
    august: 'August',
    september: 'September',
    october: 'October',
    november: 'November',
    december: 'December',
    arabic: 'Arabic',
    english: 'English',
    french: 'French',
    languageSelector: 'Language selector',
    dashboardTitle: 'Self-Intelligence Dashboard',
    totalInteractions: 'Total Interactions',
    weeklyInteractions: 'Weekly Interactions',
    weeklyErrors: 'Weekly Errors',
    topQuestions: 'Top Questions',
    maxRating: 'Max Rating',
    minRating: 'Min Rating',
    allRatings: 'All Ratings',
    loadingCompliancePanel: 'Loading Compliance Panel...',
    loadingRiskAnalysis: 'Loading Risk Analysis...',
    loadingRiskTrends: 'Loading Risk Trends...',
    loadingKnowledgeArticles: 'Loading Knowledge Articles...'
  },
  fr: {
    compliancePolicies: 'Politiques de conformité',
    riskScore: 'Score de risque',
    violations: 'Violations',
    unresolved: 'Non résolu',
    lastViolation: 'Dernière violation',
    details: 'Détails',
    export: 'Exporter',
    print: 'Imprimer',
    add: 'Ajouter',
    edit: 'Modifier',
    delete: 'Supprimer',
    enabled: 'Activée',
    disabled: 'Désactivée',
    riskTrends: 'Tendances des risques',
    date: 'Date',
    loading: 'Chargement...',
    noData: 'Aucune donnée disponible',
    noPolicies: 'Aucune politique trouvée',
    noViolations: 'Aucune violation enregistrée.',
    smartSuggestion: 'Suggestion intelligente :',
    repeatedViolationsDetectedForPolicy: 'Violations répétées détectées pour la politique',
    recommendUpdateOrAddPolicy: 'Il est recommandé de mettre à jour la politique ou d’en ajouter une nouvelle sur la base de l’analyse intelligente.',
    recommendationAdoptedSuccessfully: 'Recommandation adoptée comme politique avec succès',
    adoptAsPolicy: 'Adopter comme politique',
    smartRecommendation: 'Recommandation intelligente :',
    adoptRecommendation: 'Adopter la recommandation comme nouvelle politique',
    mostViolatedPolicies: 'Politiques les plus violées :',
    notEnoughData: 'Pas assez de données à afficher.',
    errorFetching: 'Erreur lors de la récupération des données',
    loadingShort: 'Chargement...',
    advancedAnalyticsPanel: 'Tableau d\'analyse avancée de conformité',
    aiComplianceAnalysis: 'Analyse de conformité intelligente (IA)',
    eventsCount: 'Nombre d\'événements',
    escalationRisk: 'Risque d\'escalade',
    advancedAISummary: 'Résumé avancé IA',
    statusDistribution: 'Répartition des statuts',
    timelineDistribution: 'Répartition chronologique (30 jours)',
    violationsPerPolicy: 'Violations par politique',
    violationsPerResource: 'Violations par ressource',
    mostViolatedResources: 'Ressources les plus violées',
    undefined: 'Non défini',
    smartSourcesManagement: 'Gestion intelligente des sources de données',
    type: 'Type',
    name: 'Nom',
    cronSchedule: 'Planification Cron',
    configJSON: 'Paramètres (JSON)',
    addSource: 'Ajouter une source',
    status: 'Statut',
    schedule: 'Planification',
    lastImport: 'Dernière importation',
    failedToLoadArticles: 'Échec du chargement des articles',
    confirmDelete: 'Confirmer la suppression',
    areYouSureDelete: 'Êtes-vous sûr de vouloir supprimer cet article ?',
    deleted: 'Supprimé',
    updated: 'Mis à jour',
    added: 'Ajouté',
    question: 'Question',
    repeated: 'Répété',
    times: 'fois',
    notDocumentedAsArticle: 'et il n\'est pas documenté comme article de connaissance.',
    recommendCreateArticle: 'Il est recommandé de créer un article de connaissance pour y répondre.',
    createArticleForQuestion: 'Créer un article pour cette question',
    searchArticles: 'Rechercher dans les articles...',
    search: 'Rechercher',
    newArticle: 'Nouvel article',
    title: 'Titre',
    tags: 'Étiquettes',
    aiSummary: 'Résumé IA',
    createdAt: 'Créé le',
    updatedAt: 'Mis à jour le',
    actions: 'Actions',
    editArticle: 'Modifier l\'article',
    addArticle: 'Ajouter un article',
    update: 'Mettre à jour',
    cancel: 'Annuler',
    titleRequired: 'Le titre est requis',
    content: 'Contenu',
    contentRequired: 'Le contenu est requis',
    tagsRequired: 'Entrez des étiquettes (séparées par des virgules)',
    tagsPlaceholder: 'ex : gestion, technologie, IA',
    rolesManagement: 'Gestion des rôles et des autorisations',
    roleName: 'Nom du rôle',
    permissionsComma: 'Autorisations (séparées par des virgules)',
    addRole: 'Ajouter un rôle',
    role: 'Rôle',
    permissions: 'Autorisations',
    meetingsManagement: 'Gestion des réunions',
    confirmDeleteMeeting: 'Confirmer la suppression de la réunion ?',
    meetingTitle: 'Titre de la réunion',
    location: 'Lieu',
    participantsComma: 'Participants (séparés par des virgules)',
    agenda: 'Ordre du jour',
    notes: 'Remarques',
    createdBy: 'Créé par',
    addMeeting: 'Ajouter une réunion',
    participants: 'Participants',
    contractsDashboardCharts: 'Tableau de bord des contrats - Graphiques',
    contractsByStatus: 'Répartition des contrats par statut',
    contractsByParty: 'Répartition des contrats par partie (Top 6)',
    contractsTotals: 'Totaux des contrats et des valeurs',
    totalContracts: 'Nombre total de contrats',
    totalValue: 'Valeur totale',
    avgValue: 'Valeur moyenne',
    soonToExpire: 'Expirant dans 30 jours',
    active: 'Actif',
    expired: 'Expiré',
    terminated: 'Résilié prématurément',
    pending: 'En attente',
    processDashboard: 'Tableau des processus',
    hiringProcess: 'Processus de recrutement',
    onboardingProcess: 'Processus d’intégration',
    smartDashboard: 'Tableau de bord intelligent',
    notificationChannels: 'Canaux de notification',
    riskDashboard: 'Tableau des risques',
    saveAndSyncBPMN: 'Enregistrer et synchroniser BPMN',
    processEditor: 'Éditeur de processus',
    processName: 'Nom du processus',
    addProcess: 'Ajouter un nouveau processus',
    noProcesses: 'Aucun processus trouvé',
    view: 'Voir',
    saveProcess: 'Enregistrer le processus',
    addStep: 'Ajouter une étape',
    stepName: 'Nom de l\'étape',
    manual: 'Manuel',
    automated: 'Automatisé',
    approval: 'Approbation',
    switchToDark: 'Mode sombre',
    switchToLight: 'Mode clair',
    months: 'mois',
    january: 'Janvier',
    february: 'Février',
    march: 'Mars',
    april: 'Avril',
    may: 'Mai',
    june: 'Juin',
    july: 'Juillet',
    august: 'Août',
    september: 'Septembre',
    october: 'Octobre',
    november: 'Novembre',
    december: 'Décembre',
    arabic: 'Arabe',
    english: 'Anglais',
    french: 'Français',
    languageSelector: 'Sélecteur de langue',
    dashboardTitle: 'Tableau de bord intelligent',
    totalInteractions: 'Total des interactions',
    weeklyInteractions: 'Interactions hebdomadaires',
    weeklyErrors: 'Erreurs hebdomadaires',
    topQuestions: 'Questions les plus fréquentes',
    maxRating: 'Note maximale',
    minRating: 'Note minimale',
    allRatings: 'Toutes les notes',
    loadingCompliancePanel: 'Chargement du panneau de conformité...',
    loadingRiskAnalysis: 'Chargement de l’analyse des risques...',
    loadingRiskTrends: 'Chargement des tendances des risques...',
    loadingKnowledgeArticles: 'Chargement des articles de connaissance...'
  }
};

interface I18nContextType {
  t: (k: string) => string;
  lang: 'ar' | 'en' | 'fr';
  setLang: React.Dispatch<React.SetStateAction<'ar' | 'en' | 'fr'>>;
}
const I18nContext = createContext<I18nContextType>({
  t: (k: string) => k,
  lang: 'ar',
  setLang: () => {},
});

interface I18nProviderProps {
  children: React.ReactNode;
}
export function I18nProvider({ children }: I18nProviderProps) {
  // Load initial language from localStorage if available
  const getInitialLang = () => {
    if (typeof window !== 'undefined') {
      const stored = window.localStorage.getItem('dashboard-lang');
      if (stored === 'ar' || stored === 'en' || stored === 'fr') return stored;
    }
    return 'ar';
  };
  const [lang, setLangState] = useState<'ar' | 'en' | 'fr'>(getInitialLang());
  const setLang = (l: 'ar' | 'en' | 'fr') => {
    setLangState(l);
    if (typeof window !== 'undefined') {
      window.localStorage.setItem('dashboard-lang', l);
    }
  };
  const t = (k: string) => translations[lang][k] || k;
  return (
    <I18nContext.Provider value={{ t, lang, setLang }}>
      {children}
    </I18nContext.Provider>
  );
}


// Date formatting utility
export function formatDate(date: Date | string, lang: 'ar' | 'en' | 'fr' = 'ar', options?: Intl.DateTimeFormatOptions) {
  const d = typeof date === 'string' ? new Date(date) : date;
  const locale = lang === 'ar' ? 'ar-EG' : lang === 'fr' ? 'fr-FR' : 'en-US';
  return new Intl.DateTimeFormat(locale, options || { year: 'numeric', month: '2-digit', day: '2-digit' }).format(d);
}

// Number formatting utility
export function formatNumber(num: number, lang: 'ar' | 'en' | 'fr' = 'ar', options?: Intl.NumberFormatOptions) {
  const locale = lang === 'ar' ? 'ar-EG' : lang === 'fr' ? 'fr-FR' : 'en-US';
  return new Intl.NumberFormat(locale, options).format(num);
}

export function useI18n() {
  return useContext(I18nContext);
}
