import React, { useState, useEffect } from 'react';
import AIStreamingDashboard from './components/AIStreamingDashboard';
import AIRecommendations from './components/AIRecommendations';
import AIMetricsDashboard from './components/AIMetricsDashboard';
import AIProcessReports from './components/AIProcessReports';
import AIAdvancedDashboard from './components/AIAdvancedDashboard';
import AIDataVisualizations from './components/AIDataVisualizations';
import AIClient from './services/AIClient';
import { ThemeProvider, useTheme } from './contexts/ThemeContext';
import ThemeToggle from './components/ThemeToggle';
import './styles/theme.css';

interface NavItem {
  id: string;
  label: string;
  icon: string;
}

const AppContent: React.FC = () => {
  const { theme } = useTheme();
  const [currentPage, setCurrentPage] = useState<'main' | 'recommendations' | 'metrics' | 'reports' | 'advanced' | 'visualizations'>('main');
  const [systemStatus, setSystemStatus] = useState<'online' | 'offline' | 'error'>('online');
  const [lastUpdate, setLastUpdate] = useState<string>('');

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…
  useEffect(() => {
    const checkServerStatus = async () => {
      try {
        const data = await AIClient.getDashboard();
        setSystemStatus('online');
        setLastUpdate(new Date().toLocaleTimeString('ar-SA'));
      } catch (error) {
        setSystemStatus('error');
      }
    };

    checkServerStatus();
    const interval = setInterval(checkServerStatus, 10000); // ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
    return () => clearInterval(interval);
  }, []);

  const navItems: NavItem[] = [
    { id: 'main', label: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', icon: 'ğŸ ' },
    { id: 'recommendations', label: 'Ø§Ù„ØªÙˆØµÙŠØ§Øª', icon: 'ğŸ’¡' },
    { id: 'metrics', label: 'Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³', icon: 'ğŸ“Š' },
    { id: 'reports', label: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', icon: 'ğŸ“‹' },
    { id: 'advanced', label: 'Ù…ØªÙ‚Ø¯Ù…', icon: 'âš™ï¸' },
    { id: 'visualizations', label: 'ØªØµÙˆØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', icon: 'ğŸ“ˆ' }
  ];

  const renderPage = () => {
    switch (currentPage) {
      case 'main':
        return <AIStreamingDashboard />;
      case 'recommendations':
        return <AIRecommendations />;
      case 'metrics':
        return <AIMetricsDashboard />;
      case 'reports':
        return <AIProcessReports />;
      case 'advanced':
        return <AIAdvancedDashboard />;
      case 'visualizations':
        return <AIDataVisualizations />;
      default:
        return <AIStreamingDashboard />;
    }
  };

  return (
    <div className="min-h-screen" dir="rtl" style={{ 
      backgroundColor: theme.colors.background.default,
      color: theme.colors.text.primary
    }}>
      {/* Header */}
      <header className="sticky top-0 z-40" style={{ 
        background: `linear-gradient(to right, ${theme.colors.background.paper}, ${theme.colors.surface.main})`,
        borderBottom: `1px solid ${theme.colors.border.main}`
      }}>
        <div className="max-w-full px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <span className="text-3xl">ğŸ¤–</span>
              <div>
                <h1 className="text-2xl font-bold" style={{ color: theme.colors.text.primary }}>
                  Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„
                </h1>
                <p className="text-sm" style={{ color: theme.colors.text.secondary }}>
                  Smart Process Management System
                </p>
              </div>
            </div>

            <div className="flex items-center gap-4">
              {/* Theme Toggle */}
              <ThemeToggle /
            <div className="flex items-center gap-4">
              <div className="text-right">
                <div className="flex items-center gap-2 justify-end">
                  <span className={`w-2 h-2 rounded-full animate-pulse`} style={{
                    backgroundColor: systemStatus === 'online' ? theme.colors.success.main :
                                   systemStatus === 'offline' ? theme.colors.error.main :
                                   theme.colors.warning.main
                  }}></span>
                  <span className="text-sm font-medium" style={{
                    color: systemStatus === 'online' ? theme.colors.success.main :
                          systemStatus === 'offline' ? theme.colors.error.main :
                          theme.colors.warning.main
                  }}>
                    {systemStatus === 'online' ? 'Ø§Ù„Ù†Ø¸Ø§Ù… Ù†Ø´Ø·' :
                     systemStatus === 'offline' ? 'ØºÙŠØ± Ù…ØªØµÙ„' :
                     'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„'}
                  </span>
                </div>
                <p className="text-xs mt-1" style={{ color: theme.colors.text.disabled }}>
                  Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {lastUpdate}
                </p>
              </div>
            </div>
          </div>
        </div>
      </header>

      <div className="flex h-screen">
        {/* Sidebar Navigation */}
        <aside className="w-64 overflow-y-auto" style={{ 
          background: `linear-gradient(to bottom, ${theme.colors.surface.main}, ${theme.colors.surface.dark})`,
          borderLeft: `1px solid ${theme.colors.border.main}`
        }}>
          <nav className="p-4 space-y-2">
            <div className="mb-6 px-4">
              <h2 className="text-sm font-semibold uppercase tracking-wider" style={{ 
                color: theme.colors.text.secondary 
              }}>
                Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
              </h2>"w-full text-right px-4 py-3 font-medium transition-all flex items-center gap-3"
                style={{
                  borderRadius: theme.borderRadius.md,
                  background: currentPage === item.id 
                    ? `linear-gradient(to right, ${theme.colors.primary[600]}, ${theme.colors.primary[500]})`
                    : 'transparent',
                  color: currentPage === item.id ? theme.colors.primary.contrast : theme.colors.text.secondary,
                  boxShadow: currentPage === item.id ? theme.shadows.md : 'none'
                }}
                onMouseEnter={(e) => {
                  if (currentPage !== item.id) {
                    e.currentTarget.style.backgroundColor = theme.colors.surface.hover;
                    e.currentTarget.style.color = theme.colors.text.primary;
                  }
                }}
                onMouseLeave={(e) => {
                  if (currentPage !== item.id) {
                    e.currentTarget.style.backgroundColor = 'transparent';
                    e.currentTarget.style.color = theme.colors.text.secondary;
                  }
                }ton
                key={item.id}
                onClick={() => setCurrentPage(item.id as any)}
                className={`w-full text-right px-4 py-3 rounded-lg font-medium transition-all flex items-center gap-3 ${
                  currentPage === item.id
                    ? 'bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-lg'
                    : 'text-slate-300 hover:bg-slate-800 hover:text-white'
                }`}
              >
                <span className="text-xl">{item.icon}</span>
                <span>{item.label}</span>
              </button>
            ))}

            <div className="my-6" style={{ borderTop: `1px solid ${theme.colors.border.main}` }}></div>

            {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */}
            <div className="px-4 space-y-3 text-sm">
              <div className="themed-card p-3">
                <h3 className="font-semibold mb-2" style={{ color: theme.colors.text.primary }}>
                  âš¡ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
                </h3>
                <div className="space-y-1" style={{ color: theme.colors.text.secondary }}>
                  <div className="flex justify-between">
                    <span>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</span>
                    <span className="font-semibold" style={{ color: theme.colors.success.main }}>95%</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Ø§Ù„Ø£Ø¯Ø§Ø¡</span>
                    <span className="font-semibold" style={{ color: theme.colors.primary.main }}>88%</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Ø§Ù„Ø£ØªÙ…ØªØ©</span>
                    <span className="font-semibold" style={{ color: theme.colors.secondary.main }}>76%</span>
                  </div>
                </div>
              </div>

              <div className="themed-card p-3">
                <h3 className="font-semibold mb-2" style={{ color: theme.colors.text.primary }}>
                  ğŸ“Œ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
                </h3>
                <button 
                  className="w-full py-2 text-xs font-medium mb-2 transition-colors"
                  style={{
                    backgroundColor: theme.colors.success.main,
                    color: theme.colors.success.contrast,
                    borderRadius: theme.borderRadius.sm
                  }}
                  onMouseEnter={(e) => e.currentTarget.style.backgroundColor = theme.colors.success.dark}
                  onMouseLeave={(e) => e.currentTarget.style.backgroundColor = theme.colors.success.main}
                >
                  ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button 
                  className="themed-button-primary w-full py-2 text-xs font-medium mb-2"
                >
                  ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
                <button 
                  className="w-full py-2 text-xs font-medium transition-colors"
                  style={{
                    backgroundColor: theme.colors.secondary.main,
                    color: theme.colors.secondary.contrast,
                    borderRadius: theme.borderRadius.sm
                  }}
                  onMouseEnter={(e) => e.currentTarget.style.backgroundColor = theme.colors.secondary.dark}
                  onMouseLeave={(e) => e.currentTarget.style.backgroundColor = theme.colors.secondary.main}
                >
                  Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
              </div>

              <div className="themed-card p-3">
                <h3 className="font-semibold mb-2" style={{ color: theme.colors.text.primary }}>
                  â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                </h3>
                <p className="text-xs leading-relaxed" style={{ color: theme.colors.text.secondary }}>
                  Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙˆÙØ± Ø¥Ø¯Ø§Ø±Ø© Ø°ÙƒÙŠØ© Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø¹ ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆØªÙ†Ø¨Ø¤Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©.
                </p>
              </div>
            </div>
          </nav>
        </aside>

        {/* Main Content */}
        <main className="flex-1 overflow-y-auto">
          {renderPage()}

          {/* Footer */}
          <footer className="mt-8" style={{ 
            background: `linear-gradient(to right, ${theme.colors.surface.main}, ${theme.colors.surface.dark})`,
            borderTop: `1px solid ${theme.colors.border.main}`
          }}>
            <div className="max-w-7xl mx-auto px-6 py-6 text-right">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div>
                  <h4 className="font-semibold mb-2" style={{ color: theme.colors.text.primary }}>
                    ğŸ“Š Ø§Ù„Ù†Ø¸Ø§Ù…
                  </h4>
                  <ul className="text-sm space-y-1" style={{ color: theme.colors.text.secondary }}>
                    <li>âœ“ 8 Ù†Ù…Ø§Ø°Ø¬ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</li>
                    <li>âœ“ 30+ ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬ÙŠØ©</li>
                    <li>âœ“ 6 Ù„ÙˆØ­Ø§Øª ØªØ­ÙƒÙ…</li>
                  </ul>
                </div>
                <div>
                  <h4 className="font-semibold mb-2" style={{ color: theme.colors.text.primary }}>
                    ğŸ”§ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª
                  </h4>
                  <ul className="text-sm space-y-1" style={{ color: theme.colors.text.secondary }}>
                    <li>React + TypeScript</li>
                    <li>Express.js + MongoDB</li>
                    <li>Tailwind CSS</li>
                  </ul>
                </div>
                <div>
                  <h4 className="font-semibold mb-2" style={{ color: theme.colors.text.primary }}>
                    ğŸ“ˆ Ø§Ù„Ø£Ø¯Ø§Ø¡
                  </h4>
                  <ul className="text-sm space-y-1" style={{ color: theme.colors.text.secondary }}>
                    <li>ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ</li>
                    <li>Ø£Ù…Ø§Ù† Ø¹Ø§Ù„ÙŠ</li>
                    <li>ØªÙˆØ³Ø¹ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯</li>
                  </ul>
                </div>
              </div>

              <div className="pt-4 text-center text-sm" style={{ 
                borderTop: `1px solid ${theme.colors.border.main}`,
                color: theme.colors.text.secondary
              }}>
                <p>Â© 2025 Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
                <p className="mt-1">Version 1.0.0 - Production Ready âœ…</p>
              </div>
            </div>
          </footer>
        </main>
      </div>
    </div>
  );
};

// Main App with Theme Provider
const MainApp: React.FC = () => {
  return (
    <ThemeProvider defaultMode="dark">
      <AppContent />
    </ThemeProvider>
  );
};

export default MainApp;
