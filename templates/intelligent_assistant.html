<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المساعد الذكي المتقدم - مراكز الأوائل</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .chat-container {
            height: 70vh;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .message {
            margin-bottom: 15px;
            animation: fadeInUp 0.3s ease-out;
        }
        
        .message.user {
            text-align: left;
        }
        
        .message.assistant {
            text-align: right;
        }
        
        .message-bubble {
            display: inline-block;
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            margin-left: auto;
        }
        
        .message.assistant .message-bubble {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
            margin-right: auto;
        }
        
        .typing-indicator {
            display: none;
            text-align: right;
            margin-bottom: 15px;
        }
        
        .typing-dots {
            display: inline-block;
            background: #6c757d;
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
        }
        
        .typing-dots::after {
            content: '';
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 60%, 100% { content: '...'; }
            20% { content: '.'; }
            40% { content: '..'; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .quick-responses {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .quick-response-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-response-btn:hover {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .conversation-types {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .conversation-type {
            padding: 8px 16px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .conversation-type.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .conversation-type:hover {
            border-color: #007bff;
            transform: translateY(-2px);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stats-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .knowledge-card {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            transition: all 0.3s;
        }
        
        .knowledge-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .rating-stars {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .rating-star {
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .rating-star:hover,
        .rating-star.active {
            color: #ffc107;
        }
        
        .preferences-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .message-metadata {
            font-size: 11px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .confidence-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            margin-right: 5px;
        }
        
        .confidence-high { background: #d4edda; color: #155724; }
        .confidence-medium { background: #fff3cd; color: #856404; }
        .confidence-low { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- الشريط الجانبي -->
            <div class="col-md-2 sidebar">
                <div class="sidebar-header">
                    <h4><i class="fas fa-robot"></i> المساعد الذكي</h4>
                </div>
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" data-tab="chat" href="#"><i class="fas fa-comments"></i> المحادثة</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-tab="knowledge" href="#"><i class="fas fa-book"></i> قاعدة المعرفة</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-tab="preferences" href="#"><i class="fas fa-cog"></i> التفضيلات</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-tab="analytics" href="#"><i class="fas fa-chart-bar"></i> التحليلات</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-tab="feedback" href="#"><i class="fas fa-star"></i> التقييم</a>
                    </li>
                </ul>
            </div>

            <!-- المحتوى الرئيسي -->
            <div class="col-md-10 main-content">
                <!-- الإحصائيات -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h3 id="totalConversations">0</h3>
                            <p>إجمالي المحادثات</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <h3 id="totalMessages">0</h3>
                            <p>إجمالي الرسائل</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <h3 id="avgSatisfaction">0</h3>
                            <p>متوسط الرضا</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <h3 id="totalKnowledge">0</h3>
                            <p>قاعدة المعرفة</p>
                        </div>
                    </div>
                </div>

                <!-- تبويب المحادثة -->
                <div id="chatTab" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-robot"></i> المساعد الذكي المتقدم</h5>
                            <div class="conversation-types">
                                <div class="conversation-type active" data-type="general">
                                    <i class="fas fa-comments"></i> عام
                                </div>
                                <div class="conversation-type" data-type="medical">
                                    <i class="fas fa-stethoscope"></i> طبي
                                </div>
                                <div class="conversation-type" data-type="educational">
                                    <i class="fas fa-graduation-cap"></i> تعليمي
                                </div>
                                <div class="conversation-type" data-type="behavioral">
                                    <i class="fas fa-brain"></i> سلوكي
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chat-container" id="chatContainer">
                                <div class="text-center text-muted">
                                    <i class="fas fa-robot fa-3x mb-3"></i>
                                    <p>مرحباً! أنا المساعد الذكي لمراكز الأوائل</p>
                                    <p>اختر نوع المحادثة أعلاه وابدأ بطرح أسئلتك</p>
                                </div>
                            </div>
                            <div class="typing-indicator" id="typingIndicator">
                                <div class="typing-dots">المساعد يكتب</div>
                            </div>
                            <div class="quick-responses" id="quickResponses"></div>
                        </div>
                        <div class="card-footer">
                            <div class="input-group">
                                <input type="text" class="form-control" id="messageInput" 
                                       placeholder="اكتب رسالتك هنا..." disabled>
                                <button class="btn btn-primary" id="sendButton" disabled>
                                    <i class="fas fa-paper-plane"></i> إرسال
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- تبويب قاعدة المعرفة -->
                <div id="knowledgeTab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-book"></i> قاعدة المعرفة</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="knowledgeSearch" 
                                           placeholder="البحث في قاعدة المعرفة...">
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="knowledgeCategory">
                                        <option value="">جميع الفئات</option>
                                        <option value="medical">طبي</option>
                                        <option value="educational">تعليمي</option>
                                        <option value="behavioral">سلوكي</option>
                                        <option value="administrative">إداري</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-success" id="addKnowledgeBtn">
                                        <i class="fas fa-plus"></i> إضافة
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="knowledgeList"></div>
                            <nav id="knowledgePagination"></nav>
                        </div>
                    </div>
                </div>

                <!-- تبويب التفضيلات -->
                <div id="preferencesTab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-cog"></i> تفضيلات المساعد الذكي</h5>
                        </div>
                        <div class="card-body">
                            <form id="preferencesForm">
                                <div class="preferences-section">
                                    <h6><i class="fas fa-language"></i> إعدادات اللغة والتواصل</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label class="form-label">اللغة المفضلة</label>
                                            <select class="form-select" name="preferred_language">
                                                <option value="ar">العربية</option>
                                                <option value="en">English</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">أسلوب التواصل</label>
                                            <select class="form-select" name="communication_style">
                                                <option value="formal">رسمي</option>
                                                <option value="casual">ودود</option>
                                                <option value="technical">تقني</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">طول الإجابة</label>
                                            <select class="form-select" name="response_length">
                                                <option value="short">مختصر</option>
                                                <option value="medium">متوسط</option>
                                                <option value="detailed">مفصل</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="preferences-section">
                                    <h6><i class="fas fa-heart"></i> المواضيع المفضلة</h6>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="topics" value="medical">
                                                <label class="form-check-label">الاستفسارات الطبية</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="topics" value="educational">
                                                <label class="form-check-label">البرامج التعليمية</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="topics" value="behavioral">
                                                <label class="form-check-label">التأهيل السلوكي</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="topics" value="administrative">
                                                <label class="form-check-label">الأمور الإدارية</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="preferences-section">
                                    <h6><i class="fas fa-shield-alt"></i> الخصوصية والأمان</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">مستوى الخصوصية</label>
                                            <select class="form-select" name="privacy_level">
                                                <option value="minimal">الحد الأدنى</option>
                                                <option value="standard">قياسي</option>
                                                <option value="full">كامل</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mt-4">
                                                <input class="form-check-input" type="checkbox" name="learning_mode">
                                                <label class="form-check-label">تفعيل وضع التعلم التلقائي</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> حفظ التفضيلات
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- تبويب التحليلات -->
                <div id="analyticsTab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-chart-bar"></i> تحليلات الاستخدام</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <canvas id="intentChart"></canvas>
                                </div>
                                <div class="col-md-6">
                                    <canvas id="usageChart"></canvas>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <h6>أكثر النوايا استخداماً</h6>
                                    <div id="topIntentsList"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- تبويب التقييم -->
                <div id="feedbackTab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-star"></i> تقييم المساعد الذكي</h5>
                        </div>
                        <div class="card-body">
                            <div class="text-center">
                                <h6>كيف تقيم تجربتك مع المساعد الذكي؟</h6>
                                <div class="rating-stars" id="ratingStars">
                                    <i class="fas fa-star rating-star" data-rating="1"></i>
                                    <i class="fas fa-star rating-star" data-rating="2"></i>
                                    <i class="fas fa-star rating-star" data-rating="3"></i>
                                    <i class="fas fa-star rating-star" data-rating="4"></i>
                                    <i class="fas fa-star rating-star" data-rating="5"></i>
                                </div>
                                <div class="mt-3">
                                    <textarea class="form-control" id="feedbackComment" 
                                              placeholder="شاركنا ملاحظاتك واقتراحاتك..." rows="4"></textarea>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-primary" id="submitFeedback">
                                        <i class="fas fa-paper-plane"></i> إرسال التقييم
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة معرفة جديدة -->
    <div class="modal fade" id="addKnowledgeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة معرفة جديدة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addKnowledgeForm">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">الفئة</label>
                                <select class="form-select" name="category" required>
                                    <option value="">اختر الفئة</option>
                                    <option value="medical">طبي</option>
                                    <option value="educational">تعليمي</option>
                                    <option value="behavioral">سلوكي</option>
                                    <option value="administrative">إداري</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">الفئة الفرعية</label>
                                <input type="text" class="form-control" name="subcategory">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">العنوان</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">المحتوى</label>
                            <textarea class="form-control" name="content" rows="5" required></textarea>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">الكلمات المفتاحية (مفصولة بفاصلة)</label>
                            <input type="text" class="form-control" name="keywords" 
                                   placeholder="كلمة1, كلمة2, كلمة3">
                        </div>
                        <div class="mt-3">
                            <label class="form-label">المرجع</label>
                            <input type="text" class="form-control" name="source_reference">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" id="saveKnowledgeBtn">حفظ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/intelligent_assistant.js') }}"></script>
</body>
</html>
