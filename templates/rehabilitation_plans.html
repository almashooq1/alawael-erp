{% extends "base.html" %}

{% block title %}إدارة الخطط التأهيلية الفردية - مراكز الأوائل{% endblock %}

{% block extra_css %}
<style>
    .plans-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 15px;
    }
    
    .plan-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
        transition: transform 0.3s ease;
        border-right: 4px solid #667eea;
    }
    
    .plan-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    
    .plan-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e9ecef;
    }
    
    .plan-status {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .status-active { background: #d4edda; color: #155724; }
    .status-completed { background: #d1ecf1; color: #0c5460; }
    .status-paused { background: #f8d7da; color: #721c24; }
    .status-review { background: #fff3cd; color: #856404; }
    
    .goal-section {
        margin-bottom: 1.5rem;
    }
    
    .goal-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        border-right: 3px solid #28a745;
    }
    
    .goal-item.long-term {
        border-right-color: #007bff;
    }
    
    .intervention-tag {
        display: inline-block;
        background: #e9ecef;
        color: #495057;
        padding: 0.25rem 0.5rem;
        border-radius: 10px;
        font-size: 0.8rem;
        margin: 0.25rem 0.25rem 0.25rem 0;
    }
    
    .plan-timeline {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    .timeline-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .timeline-icon {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 1rem;
        font-size: 0.8rem;
    }
    
    .timeline-icon.start { background: #28a745; color: white; }
    .timeline-icon.review { background: #ffc107; color: white; }
    .timeline-icon.end { background: #dc3545; color: white; }
    
    .plan-progress {
        background: white;
        border-radius: 10px;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    .progress-bar-custom {
        height: 20px;
        border-radius: 10px;
        background: #e9ecef;
        overflow: hidden;
        position: relative;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(45deg, #28a745, #20c997);
        transition: width 0.3s ease;
        position: relative;
    }
    
    .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        font-size: 0.8rem;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    
    .session-info {
        display: flex;
        gap: 2rem;
        margin-top: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .session-detail {
        text-align: center;
    }
    
    .session-number {
        font-size: 1.5rem;
        font-weight: bold;
        color: #667eea;
    }
    
    .session-label {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .plan-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .btn-plan {
        border-radius: 20px;
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
        border: none;
        transition: all 0.3s ease;
    }
    
    .btn-plan:hover {
        transform: scale(1.05);
    }
    
    .filter-section {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .search-box {
        border-radius: 25px;
        border: 1px solid #dee2e6;
        padding: 0.75rem 1.5rem;
    }
    
    .search-box:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="plans-header text-center">
        <h1><i class="fas fa-route me-3"></i>إدارة الخطط التأهيلية الفردية</h1>
        <p class="mb-0">تصميم ومتابعة الخطط التأهيلية المخصصة لكل مستفيد</p>
    </div>

    <!-- Filters and Search -->
    <div class="filter-section">
        <div class="row">
            <div class="col-md-4 mb-3">
                <input type="text" class="form-control search-box" id="searchPlans" placeholder="البحث في الخطط...">
            </div>
            <div class="col-md-2 mb-3">
                <select class="form-select" id="filterStatus">
                    <option value="">جميع الحالات</option>
                    <option value="active">نشط</option>
                    <option value="completed">مكتمل</option>
                    <option value="paused">متوقف</option>
                    <option value="review">قيد المراجعة</option>
                </select>
            </div>
            <div class="col-md-2 mb-3">
                <select class="form-select" id="filterProgram">
                    <option value="">جميع البرامج</option>
                    <!-- Options will be loaded dynamically -->
                </select>
            </div>
            <div class="col-md-2 mb-3">
                <select class="form-select" id="sortBy">
                    <option value="created_at">تاريخ الإنشاء</option>
                    <option value="start_date">تاريخ البداية</option>
                    <option value="review_date">تاريخ المراجعة</option>
                    <option value="beneficiary_name">اسم المستفيد</option>
                </select>
            </div>
            <div class="col-md-2 mb-3">
                <button class="btn btn-primary w-100" onclick="openCreatePlanModal()">
                    <i class="fas fa-plus me-2"></i>خطة جديدة
                </button>
            </div>
        </div>
    </div>

    <!-- Plans Grid -->
    <div class="row" id="plansContainer">
        <!-- Plans will be loaded here -->
    </div>

    <!-- Pagination -->
    <nav aria-label="صفحات الخطط" class="mt-4">
        <ul class="pagination justify-content-center" id="plansPagination">
            <!-- Pagination will be loaded here -->
        </ul>
    </nav>
</div>

<!-- Create/Edit Plan Modal -->
<div class="modal fade" id="planModal" tabindex="-1" aria-labelledby="planModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="planModalLabel">إنشاء خطة تأهيلية فردية</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="planForm">
                    <input type="hidden" id="planId">
                    
                    <!-- Basic Information -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">المعلومات الأساسية</h6>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="planBeneficiary" class="form-label">المستفيد *</label>
                            <select class="form-select" id="planBeneficiary" required>
                                <option value="">اختر المستفيد</option>
                                <!-- Options will be loaded dynamically -->
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="planProgram" class="form-label">البرنامج التأهيلي *</label>
                            <select class="form-select" id="planProgram" required>
                                <option value="">اختر البرنامج</option>
                                <!-- Options will be loaded dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">الجدول الزمني</h6>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="planStartDate" class="form-label">تاريخ البداية *</label>
                            <input type="date" class="form-control" id="planStartDate" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="planEndDate" class="form-label">تاريخ النهاية المتوقع</label>
                            <input type="date" class="form-control" id="planEndDate">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="planReviewDate" class="form-label">تاريخ المراجعة *</label>
                            <input type="date" class="form-control" id="planReviewDate" required>
                        </div>
                    </div>

                    <!-- Goals -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">الأهداف التأهيلية</h6>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="planShortTermGoals" class="form-label">الأهداف قصيرة المدى</label>
                            <textarea class="form-control" id="planShortTermGoals" rows="4" placeholder="أدخل كل هدف في سطر منفصل"></textarea>
                            <small class="text-muted">الأهداف التي يمكن تحقيقها خلال 1-3 أشهر</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="planLongTermGoals" class="form-label">الأهداف طويلة المدى</label>
                            <textarea class="form-control" id="planLongTermGoals" rows="4" placeholder="أدخل كل هدف في سطر منفصل"></textarea>
                            <small class="text-muted">الأهداف التي يمكن تحقيقها خلال 6-12 شهر</small>
                        </div>
                    </div>

                    <!-- Intervention Strategies -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">استراتيجيات التدخل</h6>
                        </div>
                        <div class="col-12 mb-3">
                            <label for="planInterventions" class="form-label">الاستراتيجيات والأساليب</label>
                            <textarea class="form-control" id="planInterventions" rows="4" placeholder="أدخل كل استراتيجية في سطر منفصل"></textarea>
                        </div>
                    </div>

                    <!-- Session Details -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">تفاصيل الجلسات</h6>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="planFrequency" class="form-label">تكرار الجلسات</label>
                            <input type="text" class="form-control" id="planFrequency" placeholder="مثال: 3 مرات أسبوعياً">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="planDuration" class="form-label">مدة الجلسة (بالدقائق)</label>
                            <input type="number" class="form-control" id="planDuration" min="15" max="180">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="planLocation" class="form-label">مكان الجلسات</label>
                            <input type="text" class="form-control" id="planLocation" placeholder="مثال: قاعة العلاج الطبيعي">
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">معلومات إضافية</h6>
                        </div>
                        <div class="col-12 mb-3">
                            <label for="planNotes" class="form-label">ملاحظات خاصة</label>
                            <textarea class="form-control" id="planNotes" rows="3" placeholder="أي ملاحظات أو اعتبارات خاصة"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                <button type="button" class="btn btn-primary" onclick="savePlan()">حفظ الخطة</button>
            </div>
        </div>
    </div>
</div>

<!-- Plan Details Modal -->
<div class="modal fade" id="planDetailsModal" tabindex="-1" aria-labelledby="planDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="planDetailsModalLabel">تفاصيل الخطة التأهيلية</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="planDetailsContent">
                <!-- Plan details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                <button type="button" class="btn btn-primary" id="editPlanBtn">تعديل الخطة</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/rehabilitation_plans.js') }}"></script>
{% endblock %}
