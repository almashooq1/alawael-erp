<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام طلب الإمداد بالمواد - مراكز الأوائل</title>
    
    <!-- Bootstrap CSS (RTL) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Arabic -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa;
        }
        
        .supply-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            transition: transform 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .nav-tabs .nav-link {
            border: none;
            border-radius: 10px 10px 0 0;
            margin-left: 5px;
            color: #6c757d;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            background-color: #667eea;
            color: white;
        }
        
        .tab-content {
            background: white;
            border-radius: 0 15px 15px 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .request-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .request-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .priority-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
        }
        
        .priority-urgent {
            background-color: #dc3545;
            color: white;
        }
        
        .priority-high {
            background-color: #fd7e14;
            color: white;
        }
        
        .priority-normal {
            background-color: #198754;
            color: white;
        }
        
        .priority-low {
            background-color: #6c757d;
            color: white;
        }
        
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
        }
        
        .status-pending {
            background-color: #ffc107;
            color: #000;
        }
        
        .status-approved {
            background-color: #198754;
            color: white;
        }
        
        .status-rejected {
            background-color: #dc3545;
            color: white;
        }
        
        .status-shipped {
            background-color: #0dcaf0;
            color: #000;
        }
        
        .status-received {
            background-color: #6f42c1;
            color: white;
        }
        
        .notification-item {
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0 8px 8px 0;
        }
        
        .notification-urgent {
            border-left-color: #dc3545;
        }
        
        .notification-high {
            border-left-color: #fd7e14;
        }
        
        .btn-supply {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            border-radius: 25px;
            padding: 0.5rem 1.5rem;
            font-weight: 500;
        }
        
        .btn-supply:hover {
            background: linear-gradient(45deg, #5a6fd8, #6a4190);
            color: white;
        }
        
        .inventory-low-stock {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .inventory-out-of-stock {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="supply-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-0">
                        <i class="fas fa-boxes me-3"></i>
                        نظام طلب الإمداد بالمواد
                    </h1>
                    <p class="mb-0 mt-2">إدارة شاملة لطلبات الإمداد والمخزون بين الفروع</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light btn-lg" onclick="showNewRequestModal()">
                        <i class="fas fa-plus me-2"></i>
                        طلب إمداد جديد
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-primary bg-opacity-10 text-primary mx-auto">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3 class="mb-1" id="totalRequestsCount">0</h3>
                    <p class="text-muted mb-0">إجمالي الطلبات</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-warning bg-opacity-10 text-warning mx-auto">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3 class="mb-1" id="pendingRequestsCount">0</h3>
                    <p class="text-muted mb-0">طلبات معلقة</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-success bg-opacity-10 text-success mx-auto">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="mb-1" id="approvedRequestsCount">0</h3>
                    <p class="text-muted mb-0">طلبات مُوافق عليها</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-danger bg-opacity-10 text-danger mx-auto">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3 class="mb-1" id="urgentRequestsCount">0</h3>
                    <p class="text-muted mb-0">طلبات عاجلة</p>
                </div>
            </div>
        </div>

        <!-- Main Tabs -->
        <ul class="nav nav-tabs" id="supplyTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-tachometer-alt me-2"></i>لوحة التحكم
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests" type="button" role="tab">
                    <i class="fas fa-file-alt me-2"></i>طلبات الإمداد
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory" type="button" role="tab">
                    <i class="fas fa-warehouse me-2"></i>المخزون
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="items-tab" data-bs-toggle="tab" data-bs-target="#items" type="button" role="tab">
                    <i class="fas fa-boxes me-2"></i>المواد والإمدادات
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab">
                    <i class="fas fa-bell me-2"></i>الإشعارات
                    <span class="badge bg-danger ms-1" id="notificationsBadge" style="display: none;">0</span>
                </button>
            </li>
        </ul>

        <div class="tab-content" id="supplyTabContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <h4 class="mb-3">
                            <i class="fas fa-chart-line me-2"></i>
                            إحصائيات الطلبات
                        </h4>
                        <canvas id="requestsChart" width="400" height="200"></canvas>
                    </div>
                    <div class="col-md-4">
                        <h4 class="mb-3">
                            <i class="fas fa-history me-2"></i>
                            الطلبات الحديثة
                        </h4>
                        <div id="recentRequestsList">
                            <!-- سيتم تحميل الطلبات الحديثة هنا -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Supply Requests Tab -->
            <div class="tab-pane fade" id="requests" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>
                        طلبات الإمداد
                    </h4>
                    <button class="btn btn-supply" onclick="showNewRequestModal()">
                        <i class="fas fa-plus me-2"></i>
                        طلب جديد
                    </button>
                </div>

                <!-- Filters -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <select class="form-select" id="statusFilter">
                            <option value="">جميع الحالات</option>
                            <option value="pending">معلق</option>
                            <option value="approved">مُوافق عليه</option>
                            <option value="rejected">مرفوض</option>
                            <option value="shipped">تم الشحن</option>
                            <option value="received">تم الاستلام</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="priorityFilter">
                            <option value="">جميع الأولويات</option>
                            <option value="urgent">عاجل</option>
                            <option value="high">عالي</option>
                            <option value="normal">عادي</option>
                            <option value="low">منخفض</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="branchFilter">
                            <option value="">جميع الفروع</option>
                            <!-- سيتم تحميل الفروع -->
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-primary w-100" onclick="applyRequestsFilter()">
                            <i class="fas fa-filter me-2"></i>
                            تطبيق الفلتر
                        </button>
                    </div>
                </div>

                <!-- Requests List -->
                <div id="requestsList">
                    <!-- سيتم تحميل قائمة الطلبات هنا -->
                </div>

                <!-- Pagination -->
                <nav aria-label="صفحات الطلبات">
                    <ul class="pagination justify-content-center" id="requestsPagination">
                        <!-- سيتم إنشاء الترقيم هنا -->
                    </ul>
                </nav>
            </div>

            <!-- Inventory Tab -->
            <div class="tab-pane fade" id="inventory" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                        <i class="fas fa-warehouse me-2"></i>
                        مخزون الفروع
                    </h4>
                    <div>
                        <button class="btn btn-outline-warning me-2" onclick="loadLowStockItems()">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            المواد قليلة المخزون
                        </button>
                        <button class="btn btn-supply" onclick="showUpdateInventoryModal()">
                            <i class="fas fa-edit me-2"></i>
                            تحديث المخزون
                        </button>
                    </div>
                </div>

                <!-- Inventory Filters -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="inventoryBranchFilter">
                            <option value="">جميع الفروع</option>
                            <!-- سيتم تحميل الفروع -->
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="inventorySearchInput" placeholder="البحث في المواد...">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="applyInventoryFilter()">
                            <i class="fas fa-search me-2"></i>
                            بحث
                        </button>
                    </div>
                </div>

                <!-- Inventory List -->
                <div id="inventoryList">
                    <!-- سيتم تحميل قائمة المخزون هنا -->
                </div>
            </div>

            <!-- Items Tab -->
            <div class="tab-pane fade" id="items" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                        <i class="fas fa-boxes me-2"></i>
                        المواد والإمدادات
                    </h4>
                    <button class="btn btn-supply" onclick="showNewItemModal()">
                        <i class="fas fa-plus me-2"></i>
                        إضافة مادة جديدة
                    </button>
                </div>

                <!-- Items Filters -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="categoryFilter">
                            <option value="">جميع الفئات</option>
                            <!-- سيتم تحميل الفئات -->
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="itemsSearchInput" placeholder="البحث في المواد...">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="applyItemsFilter()">
                            <i class="fas fa-search me-2"></i>
                            بحث
                        </button>
                    </div>
                </div>

                <!-- Items List -->
                <div id="itemsList">
                    <!-- سيتم تحميل قائمة المواد هنا -->
                </div>
            </div>

            <!-- Notifications Tab -->
            <div class="tab-pane fade" id="notifications" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                        <i class="fas fa-bell me-2"></i>
                        الإشعارات والتنبيهات
                    </h4>
                    <button class="btn btn-outline-secondary" onclick="markAllNotificationsRead()">
                        <i class="fas fa-check-double me-2"></i>
                        تحديد الكل كمقروء
                    </button>
                </div>

                <!-- Notifications Filters -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="notificationStatusFilter">
                            <option value="unread">غير مقروءة</option>
                            <option value="read">مقروءة</option>
                            <option value="all">جميع الإشعارات</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="notificationTypeFilter">
                            <option value="">جميع الأنواع</option>
                            <option value="low_stock">نقص مخزون</option>
                            <option value="urgent_request">طلب عاجل</option>
                            <option value="approval_needed">يحتاج موافقة</option>
                            <option value="shipment_update">تحديث الشحن</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary w-100" onclick="applyNotificationsFilter()">
                            <i class="fas fa-filter me-2"></i>
                            تطبيق الفلتر
                        </button>
                    </div>
                </div>

                <!-- Notifications List -->
                <div id="notificationsList">
                    <!-- سيتم تحميل قائمة الإشعارات هنا -->
                </div>
            </div>
        </div>
    </div>

    <!-- New Request Modal -->
    <div class="modal fade" id="newRequestModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>
                        طلب إمداد جديد
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newRequestForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">الفرع المورد *</label>
                                    <select class="form-select" id="supplyingBranchSelect" required>
                                        <option value="">اختر الفرع المورد</option>
                                        <!-- سيتم تحميل الفروع -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">نوع الطلب *</label>
                                    <select class="form-select" id="requestTypeSelect" required>
                                        <option value="normal">عادي</option>
                                        <option value="urgent">عاجل</option>
                                        <option value="scheduled">مجدول</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">مستوى الأولوية *</label>
                                    <select class="form-select" id="priorityLevelSelect" required>
                                        <option value="normal">عادي</option>
                                        <option value="high">عالي</option>
                                        <option value="urgent">عاجل</option>
                                        <option value="low">منخفض</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">التاريخ المطلوب *</label>
                                    <input type="datetime-local" class="form-control" id="requiredDateInput" required>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">سبب الطلب *</label>
                            <textarea class="form-control" id="reasonTextarea" rows="3" required placeholder="اشرح سبب الحاجة لهذه المواد..."></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">ملاحظات إضافية</label>
                            <textarea class="form-control" id="notesTextarea" rows="2" placeholder="أي ملاحظات إضافية..."></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">طريقة الشحن</label>
                            <select class="form-select" id="shippingMethodSelect">
                                <option value="internal_transport">النقل الداخلي</option>
                                <option value="courier">شركة شحن</option>
                                <option value="pickup">استلام مباشر</option>
                            </select>
                        </div>

                        <hr>

                        <h6 class="mb-3">
                            <i class="fas fa-list me-2"></i>
                            المواد المطلوبة
                        </h6>

                        <div id="requestItemsList">
                            <!-- سيتم إضافة المواد هنا -->
                        </div>

                        <button type="button" class="btn btn-outline-primary" onclick="addRequestItem()">
                            <i class="fas fa-plus me-2"></i>
                            إضافة مادة
                        </button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-supply" onclick="submitNewRequest()">
                        <i class="fas fa-paper-plane me-2"></i>
                        إرسال الطلب
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="text-center" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">جاري التحميل...</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="{{ url_for('static', filename='js/supply_management.js') }}"></script>
</body>
</html>
